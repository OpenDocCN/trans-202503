<html><head></head><body>
<h2 class="h2" id="ch09"><span epub:type="pagebreak" id="page_246"/><span class="num">9</span> Drag Race Timer</h2>&#13;
<p class="noindent1"><span epub:type="pagebreak" id="page_247"/><span class="red">In</span> <a class="red" href="ch04.xhtml#ch04">Project 4</a><span class="red">, you built a reaction timer to measure how fast you can hit a button. In this project, you’ll build on the techniques you learned there to make a race timer for a Hot Wheels-inspired race track (see</span> <a class="red" href="ch09.xhtml#ch09fig01">Figure 9-1</a><span class="red">). We’ll show you how to display the finish time on a small, portable LCD screen so that you can detach your <span epub:type="pagebreak" id="page_248"/>project from your computer. We’ll also show you how to hack this project to add a second track and indicator lamps (LEDs) to show which car has won. Are you ready?</span></p>&#13;
<p class="figuret"><a id="ch09fig01"/><strong>FIGURE 9-1:</strong> The completed Drag Race Timer</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_1.jpg"/></div>&#13;
<h3 class="h3" id="ch09lev1sec1"><strong>MATERIALS TO GATHER</strong></h3>&#13;
<p class="noindent">Many of the parts used in this project will be familiar to you already (see <a href="ch09.xhtml#ch09fig02">Figures 9-2</a> and <a href="ch09.xhtml#ch09fig03">9-3</a>). We’ll introduce only one new part: the 16 × 2 character LCD that you’ll use to display your race time directly, rather than displaying it in the Serial Monitor on your computer screen.</p>&#13;
<div class="noter">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>In “<a href="ch09.xhtml#ch09lev1sec9">Going Further</a>” on page <a href="ch09.xhtml#page_273">273</a>, we’ll show you how to modify your Drag Race Timer so you can race two cars and display the winning time. The standard SparkFun Inventor’s Kit includes one photoresistor (SEN-09088), but you’ll need two for this final hack. Thankfully, the photoresistor is a pretty inexpensive part, so you could either buy another one or partner with a friend who has an Inventor’s Kit to build the two-player version.</em></p>&#13;
</div>&#13;
<h4 class="h4" id="ch09lev2sec1"><strong>Electronic Parts</strong></h4>&#13;
<p class="bull">• One SparkFun RedBoard (DEV-13975), Arduino Uno (DEV-11021), or any other Arduino-compatible board</p>&#13;
<p class="bull">• One USB Mini-B cable (CAB-11301 or your board’s USB cable)</p>&#13;
<p class="bull">• One solderless breadboard (PRT-12002)</p>&#13;
<p class="bull">• One 10 kΩ resistor, or two if you want to build the two-player version (COM-08374, or COM-11508 for a pack of 20)</p>&#13;
<p class="bull">• One photoresistor (SEN-09088), or two* if you want to build the two-player version</p>&#13;
<p class="bull">• One push button (COM-10302)</p>&#13;
<p class="bull"><span epub:type="pagebreak" id="page_249"/>• One 10 kΩ potentiometer (COM-09806)</p>&#13;
<p class="bull">• One 16 × 2 character LCD (LCD-00255)</p>&#13;
<p class="bull">• One submicro size servo motor (ROB-09065)</p>&#13;
<p class="bull">• Male-to-male jumper wires (PRT-11026)</p>&#13;
<p class="bull">• Male-to-female jumper wires (PRT-09140*)</p>&#13;
<div class="noter">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>The parts marked with an asterisk (*) do not come with the standard SparkFun Inventor’s Kit but are available in the separate add-on kit.</em></p>&#13;
</div>&#13;
<p class="figuret"><a id="ch09fig02"/><strong>FIGURE 9-2:</strong> Components for the Drag Race Timer</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_2.jpg"/></div>&#13;
<h4 class="h4" id="ch09lev2sec2"><strong>Other Materials and Tools</strong></h4>&#13;
<p class="bull">• Craft knife</p>&#13;
<p class="bull">• Metal ruler</p>&#13;
<p class="bull">• Needle-nose pliers</p>&#13;
<p class="bull">• Wire cutters</p>&#13;
<p class="bull">• Masking tape</p>&#13;
<p class="bull">• Glue (hot glue gun or craft glue)</p>&#13;
<p class="bull">• Cardboard (about 8.5 × 11 inches), a small cardboard box, or thick cardstock</p>&#13;
<p class="bull">• Bamboo skewer</p>&#13;
<p class="bull">• Enclosure template (see <a href="ch09.xhtml#ch09fig15">Figure 9-15</a> on page <a href="ch09.xhtml#page_266">266</a>)</p>&#13;
<p class="bull">• Hot Wheels or other small toy cars to race (not shown)</p>&#13;
<p class="bull">• (Optional) Toy car race track (not shown)</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_250"/><a id="ch09fig03"/><strong>FIGURE 9-3:</strong> Recommended tools and materials</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_3.jpg"/></div>&#13;
<p class="indent">In previous projects, we’ve used the Serial Monitor to display information sent from the Arduino on your computer. In this project, we’ll show you how to add an LCD directly to your project, a skill well worth learning. The LCD requires a lot of wires, but don’t worry— we’ll take it one step at a time. After you’ve mastered the use of this part, you can go back and add it to some of your past projects to make them fully portable!</p>&#13;
<h3 class="h3" id="ch09lev1sec2"><strong>NEW COMPONENT: THE 16 × 2 CHARACTER LCD</strong></h3>&#13;
<p class="noindent"><em>LCD</em> is short for <em>liquid crystal display</em>. Invented over 40 years ago, liquid crystal technology is used in digital watches, alarm clocks, projectors, televisions, computer monitors, and more.</p>&#13;
<p class="indent">The LCD you’ll use in this project is a simple <em>monochromatic</em> display, meaning it displays only one color. Beneath the screen of the display is a layer of liquid crystal. This is a unique chemical that, when a small electric current is applied to it, changes from transparent to opaque. Combined with a backlight or a reflective mirror, liquid crystal is used to build very simple displays. Light comes through or is blocked depending on which areas of the liquid crystal electricity is applied to—which means you can make shapes if you can control the current.</p>&#13;
<p class="indent">The 16 × 2 character LCD displays up to 32 characters of information, each of which is broken down into a 5 × 8 pixel matrix. Each individual pixel can be made either opaque or transparent depending on the applied electric current, controlled by the Arduino. The letter <em>A</em>, <span epub:type="pagebreak" id="page_251"/>for example, will display on the LCD screen when the yellow pixels in <a href="ch09.xhtml#ch09fig04">Figure 9-4</a> are made opaque.</p>&#13;
<p class="figuret"><a id="ch09fig04"/><strong>FIGURE 9-4:</strong> The uppercase letter <em>A</em> represented on a 5 × 8 pixel matrix</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_4.jpg"/></div>&#13;
<p class="indent">There are 40 individual pixels in a single character, each controlled by the Arduino, meaning there are 1,280 different control lines! Thankfully, the LCD used in this project has a special parallel interface LCD driver IC by Hitachi called the HD44780. This chip allows you to display almost any character on the screen using just six control lines from the Arduino. <a href="ch09.xhtml#ch09fig05">Figure 9-5</a> shows the pins on an LCD.</p>&#13;
<p class="figuret"><a id="ch09fig05"/><strong>FIGURE 9-5:</strong> A simple 16 × 2 character LCD</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_5.jpg"/></div>&#13;
<div class="noter">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>The LCD can use up to eight pins for data (d0–d7), but the way we are going to use the LCD, it only uses four. These are labeled d4–d7.</em></p>&#13;
</div>&#13;
<p class="indent">The LCD has a total of 16 pins, but this project uses only pins 1–6 and 11–16. The pins are numbered 1 through 16 from left to right (with the pins at the top of the screen). <a href="ch09.xhtml#ch09tab01">Table 9-1</a> describes each of the pins on the LCD. In some datasheets you might see a line over a label, as with the <img alt="Image" src="../images/251fig01.jpg"/> label on pin 5. This line indicates that the feature is an <em>active low</em>, which means the pin is activated at low voltage. So, in this case, when you want to write <span epub:type="pagebreak" id="page_252"/>to the LCD, pin 5 needs to be set to <span class="literal">LOW</span>. We’ll discuss this more in “<a href="ch09.xhtml#ch09lev2sec5">Connect the Data and Control Wiring</a>” on page <a href="ch09.xhtml#page_255">255</a>.</p>&#13;
<p class="tabcapt"><a id="ch09tab01"/><strong>TABLE 9-1:</strong> Pin descriptions for 16 × 2 character LCD</p>&#13;
<table class="all">&#13;
<tr>&#13;
<td class="pink"><p class="center"><strong>PIN</strong></p></td>&#13;
<td class="tablec"><p class="center"><strong>DESCRIPTION</strong></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">1</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Ground (GND)</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">2</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">VDD power for the LCD (5 V)</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">3</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Contrast adjust (0–5 V)</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">4</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Register select (RS)</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">5</span></p></td>&#13;
<td class="tablec"><p class="center"><img alt="Image" src="../images/252fig01.jpg"/></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">6</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Enable</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">7–10</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Data lines d0–d3 (not used)</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">11–14</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Data lines d4–d7 (data transferred in 4 bits at a time)</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">15</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Backlight power (5 V)</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink2"><p class="center"><span class="red1">16</span></p></td>&#13;
<td class="tablec1"><p class="center"><span class="red1">Backlight ground (GND)</span></p></td>&#13;
</tr>&#13;
</table>&#13;
<p class="indent">Rather than having to control each of the 40 pixels for each character separately, the HD44780 driver chip interprets data sent over by the Arduino using four data lines and two control lines and converts this into the character to display. To further simplify the interface, the Arduino community has written an LCD library for writing code to the LCD. We’ll look at that in the code.</p>&#13;
<h3 class="h3" id="ch09lev1sec3"><strong>DRAG RACE TIMER OPERATION</strong></h3>&#13;
<p class="noindent">Before we start wiring the electronics, let’s discuss how the sketch will function. We designed this race timer so that when we push a button the servo moves up, opening the starting gate that allows the car to roll down the track. At the same time, the Arduino records the starting time and waits to see when the car reaches the photoresistor at the bottom of the track, which uses the same light-sensor circuit used in the Night-Light in <a href="ch05.xhtml#ch05">Project 5</a>. You’ll embed the light sensor in the center of the track so that when the car passes over it, it will create a shadow that the Arduino can detect. When the Arduino detects the shadow, it will record the stopping time and calculate the total time as the stopping time minus the starting time. If this seems similar to the Reaction Timer from <a href="ch04.xhtml#ch04">Project 4</a>, that’s because it is!</p>&#13;
<h3 class="h3" id="ch09lev1sec4"><span epub:type="pagebreak" id="page_253"/><strong>BUILD THE LCD CIRCUIT</strong></h3>&#13;
<p class="noindent">You’ll start by building the LCD circuit. The LCD has 16 pins in total, but you’ll use just 12 of them. <a href="ch09.xhtml#ch09fig06">Figure 9-6</a> shows the schematic for the LCD wiring.</p>&#13;
<p class="figuret"><a id="ch09fig06"/><strong>FIGURE 9-6:</strong> Schematic diagram of LCD wiring</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_6.jpg"/></div>&#13;
<p class="indent">With 16 pins, the LCD will take up 16 rows on the breadboard, so you’ll have to be careful about positioning with this project. You’ll mount the LCD in the first 16 rows on the right side of the breadboard. Be sure to connect the power and ground from the Arduino to the power and ground rails on the left side of the breadboard.</p>&#13;
<p class="indent">Note that the pins on the LCD are not labeled. As we walk you through wiring it up, we’ll refer to the pins on the LCD in order, starting with pin 1 at the bottom.</p>&#13;
<h4 class="h4" id="ch09lev2sec3"><strong>Power the LCD</strong></h4>&#13;
<p class="noindent">The LCD has two separate power supplies for the backlight and for the control logic. You’ll need to wire these separately.</p>&#13;
<p class="indent">Connect pin 1 of the LCD to GND and pin 2 of the LCD to 5 V using the power rails on the breadboard. This provides power for the LCD’s control circuitry and the HD44780 LCD driver chip. Next, connect pin 15 on the LCD to 5 V and pin 16 on the LCD to GND, again using the power rails. These two connections power the LCD’s built-in backlight (see <a href="ch09.xhtml#ch09fig07">Figure 9-7</a>).</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_254"/><a id="ch09fig07"/><strong>FIGURE 9-7:</strong> Connect the power for the LCD and the backlight.</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_7.jpg"/></div>&#13;
<h4 class="h4" id="ch09lev2sec4"><strong>Control the Contrast</strong></h4>&#13;
<p class="noindent">You can adjust the contrast on the LCD screen. To do so, you control the voltage on pin 3 of the LCD using a simple voltage divider circuit with a potentiometer, similar to what you did for the Balance Beam in <a href="ch06.xhtml#ch06">Project 6</a>. Recall that a potentiometer is the same thing as a variable resistor: it has three pins, and as you turn the knob the resistance between the center pin and either of the end pins changes. If you connect the top and bottom pins of the potentiometer to 5 V and GND, you have a variable voltage divider where the voltage on the center pin will vary between 5 V and GND depending on how far you turn the knob (see <a href="ch09.xhtml#ch09fig08">Figure 9-8</a>).</p>&#13;
<p class="figuret"><a id="ch09fig08"/><strong>FIGURE 9-8:</strong> Potentiometer schematic connected up as a variable voltage divider</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_8.jpg"/></div>&#13;
<p class="indent">Add the potentiometer to the breadboard just below the LCD. Connect the outside pins of the potentiometer to 5 V and GND, and connect the center pin to pin 3 on the LCD for the contrast control.</p>&#13;
<p class="indent">Now all you need to do is add the data and control wiring for the LCD.</p>&#13;
<h4 class="h4" id="ch09lev2sec5"><span epub:type="pagebreak" id="page_255"/><strong>Connect the Data and Control Wiring</strong></h4>&#13;
<p class="noindent">You need seven more wires to connect to the LCD, including four data lines and three control lines. Pin 5 on the LCD is the read/write functionality that allows the Arduino to read from and write data to the display. You’re only going to use this read/write connection to send data to the LCD, or write to the device, so you can connect this to ground, known as “tying the pin low.” If you look back at <a href="ch09.xhtml#ch09tab01">Table 9-1</a>, you’ll notice that the <img alt="Image" src="../images/251fig01.jpg"/> label has a line over <em>Write</em>. As we mentioned earlier, this notation is often used in datasheets and documentation to indicate that a low signal will activate this feature. A low input is equivalent to ground, so add a wire to connect pin 5 of the LCD to GND, as shown in <a href="ch09.xhtml#ch09fig09">Figure 9-9</a>.</p>&#13;
<p class="figuret"><a id="ch09fig09"/><strong>FIGURE 9-9:</strong> Connect pin 5 of the LCD to GND for the <img alt="Image" src="../images/255fig01.jpg"/> control.</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_9.jpg"/></div>&#13;
<p class="indent">The final six wires will connect the LCD to the Arduino. Pins 11–14 on the LCD are the four data lines the Arduino will use to send information to the LCD. Connect these to the Arduino pins 10, 11, 12, and 13, as shown in <a href="ch09.xhtml#ch09fig10">Figure 9-10</a>. The wires should go straight across from the Arduino board to the LCD without crossing.</p>&#13;
<p class="indent">The last two connections are Enable at pin 6 and Register Select at pin 4. The Enable pin is used to signal the data transfer to the LCD, and the Register Select pin determines whether the data represents a character to display or an instruction, like clearing the screen or moving the cursor; this gives you greater control over what’s displayed on the screen. Connect pin 9 on the Arduino to pin 6 on the LCD, and pin 8 on the Arduino to pin 4 on the LCD, as shown in <a href="ch09.xhtml#ch09fig10">Figure 9-10</a>.</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_256"/><a id="ch09fig10"/><strong>FIGURE 9-10:</strong> Final wiring of the LCD circuit</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_10.jpg"/></div>&#13;
<p class="indent"><a href="ch09.xhtml#ch09tab02">Table 9-2</a> shows the LCD screen connections to help you make sure you have everything connected correctly.</p>&#13;
<p class="tabcapt"><a id="ch09tab02"/><strong>TABLE 9-2:</strong> LCD pin connections</p>&#13;
<table class="all">&#13;
<tr>&#13;
<td class="pink"><p class="center"><strong>LCD PIN</strong></p></td>&#13;
<td class="tablec"><p class="center"><strong>CONNECTION</strong></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">16</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">15</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">5 V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">14</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Arduino pin 13</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">13</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Arduino pin 12</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">12</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Arduino pin 11</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">11</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Arduino pin 10</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">10</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">N/A</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">9</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">N/A</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">8</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">N/A</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">7</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">N/A</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">6</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Arduino pin 9</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">5</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">4</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Arduino pin 8</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">3</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Middle pin of potentiometer</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink"><p class="center"><span class="red1">2</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">5 V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="pink2"><p class="center"><span class="red1">1</span></p></td>&#13;
<td class="tablec1"><p class="center"><span class="red1">GND</span></p></td>&#13;
</tr>&#13;
</table>&#13;
<h4 class="h4" id="ch09lev2sec6"><span epub:type="pagebreak" id="page_257"/><strong>Test the LCD</strong></h4>&#13;
<p class="noindent">Before you wire up more of the circuit, test it to make sure it’s working as expected so far. Connect your Arduino to your computer.</p>&#13;
<p class="indent">As soon as you apply power, the backlight should turn on. Try turning the potentiometer knob. Even with nothing displayed on the LCD, you should see the contrast of the screen change as you twist, from all dark at its lowest to 32 brightly lit rectangles at its highest.</p>&#13;
<p class="indent">If you don’t see this, double-check the wiring. Make sure that all of the power connections to the LCD match <a href="ch09.xhtml#ch09tab02">Table 9-2</a>.</p>&#13;
<p class="indent">Once you have the LCD working, copy the code from <a href="ch09.xhtml#ch09ex01">Listing 9-1</a> into Arduino and upload it to your device. This simple example should display the text <em>SparkFun Arduino</em> on the first line and a running counter on the second line.</p>&#13;
<p class="ex-caption"><a id="ch09ex01"/><strong>LISTING 9-1:</strong> Test code to display text and a running <span class="literal">millis()</span> counter to the LCD</p>&#13;
<div class="pre">&#13;
<p class="programs"><span class="ent">➊</span> <span class="green1">#include</span>&lt;<span class="orange"><strong>LiquidCrystal</strong></span>.h&gt;<br/><span class="ent">➋</span> <span class="orange"><strong>LiquidCrystal</strong></span> lcd(8, 9, 10, 11, 12, 13);<br/><br/>  <span class="green">void</span> <span class="green1">setup</span>()<br/>  {<br/><span class="ent">➌</span>   lcd.<span class="orange">begin</span>(16, 2);  <span class="ash">//initializes interface to LCD</span><br/><span class="ent">➍</span>   lcd.<span class="orange">clear</span>();<br/><span class="ent">➎</span>   lcd.<span class="orange">print</span>("<span class="blue1">SparkFun Arduino")</span>;<br/>  }<br/><br/>  <span class="green">void</span> <span class="green1">loop</span>()<br/>  {<br/><span class="ent">➏</span>   lcd.<span class="orange">setCursor</span>(0, 1);      <span class="ash">//move cursor to the 2nd line</span><br/>                              <span class="ash">//(col 0, row 1)</span><br/><span class="ent">➐</span>   lcd.<span class="orange">print</span>(<span class="orange">millis</span>()/1000); <span class="ash">//print the number of</span><br/>                              <span class="ash">//seconds elapsed</span><br/>  }</p>&#13;
</div>&#13;
<p class="indent">Let’s take a look at what’s going on in this example. First, it includes the <em>LiquidCrystal.h</em> library <span class="ent">➊</span> created by the Arduino community to simplify the six different control and data lines. This will make it easier for you to send instructions to the LCD.</p>&#13;
<p class="indent">Next, this code creates an object named <span class="literal">lcd</span> that uses the LiquidCrystal library <span class="ent">➋</span>. Notice that this time when you create the object, you pass it a set of parameters that correspond with the LCD pins: the Register Select, Enable, and four data pins. This is where you configure which pin controls each function on the LCD. In some documentation, you may see this command as <span class="literal">LiquidCrystal lcd(RS, Enable, d4, d5, d6, d7)</span>.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_258"/>You may be wondering why we don’t use four of the LCD pins. This LCD is able to transfer data on either four or eight data lines. According to the datasheet on the LCD, when you use four data lines, you use the top four pins on the LCD—the pins labeled d4, d5, d6, and d7. While it takes the Arduino twice as long to transfer data to the LCD this way, this helps to keep the circuit as simple as possible, and remember, the Arduino operates with a 16 MHz clock. That’s really fast!</p>&#13;
<p class="indent">The LiquidCrystal library has around 20 different commands that simplify control of this LCD. In this example, we’ll show you a few basic commands that allow you to configure the screen size, clear the screen, display information, and move the cursor.</p>&#13;
<p class="indent">The <span class="literal">setup()</span> part of the sketch has a few instructions that will run just once when the Arduino starts up. The first of these is <span class="literal">lcd.begin(16, 2);</span> <span class="ent">➌</span>, which sets up the size of the LCD as a 16 × 2 character LCD, allowing the library to correctly wrap text and move from one line to the next.</p>&#13;
<p class="indent">The next instruction, <span class="literal">lcd.clear();</span> <span class="ent">➍</span>, allows you to clear the screen before providing new text to display. It also resets the position of the cursor to the first character on the first line of the screen. Without this, the LCD would retain the last thing displayed.</p>&#13;
<p class="indent">Then, the command <span class="literal">lcd.print("SparkFun Arduino");</span> <span class="ent">➎</span> displays the text <em>SparkFun Arduino</em> on the LCD. Because the <span class="literal">lcd.clear()</span> instruction just cleared the screen, this text will appear on the first line of the display. This string of text is exactly 16 characters long and should fill the entire first line of the LCD. This command is similar to <span class="literal">Serial.print()</span>, but with <span class="literal">lcd.print()</span> you don’t need to be connected to a computer or have the Serial Monitor open to see text and information from your device.</p>&#13;
<p class="indent">The <span class="literal">loop()</span> refreshes the screen with new information each time it repeats. First it moves the cursor to the second line of the LCD using <span class="literal">lcd.setCursor(0, 1);</span> <span class="ent">➏</span> so it doesn’t overwrite the <em>SparkFun Arduino</em> text on the first line. The two numbers used in the <span class="literal">setCursor()</span> method indicate the position of the character (0) and the row (1). As is common in a lot of programming environments, Arduino counts starting with an index of 0, not 1.</p>&#13;
<div class="noter">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>The LiquidCrystal library only works with character LCD displays. Graphic LCD screens are also available, but they use a different library called OpenGLCD, which allows you to display graphics such as lines, rectangles, and circles as well as text.</em></p>&#13;
</div>&#13;
<p class="indent">Finally, the sketch prints a counter <span class="ent">➐</span> using another <span class="literal">lcd.print()</span> instruction. This counter uses the <span class="literal">millis()</span> function, which reports the number of milliseconds since the Arduino was powered on. Dividing this value by 1,000 shows a counter in seconds. We will use a similar technique for the race timer.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_259"/>Now, can you figure out how to change the text to display your name on the first line? How about changing the time display to show the time elapsed in minutes instead of seconds? Play around with the code example until you’re comfortable with displaying data to the LCD. With just six GPIO pins from your Arduino, you can add an LCD readout to any project!</p>&#13;
<p class="indent">This example demonstrates the most commonly used instructions in the Arduino LiquidCrystal library, but if you want to check out the other commands that you can use, see <em><a href="https://www.arduino.cc/en/Reference/LiquidCrystal/">https://www.arduino.cc/en/Reference/LiquidCrystal/</a>.</em></p>&#13;
<p class="indent">Now that you have the LCD circuit working, it’s time to add the button, servo, and light-sensor circuit.</p>&#13;
<h3 class="h3" id="ch09lev1sec5"><strong>ADD THE REST OF THE ELECTRONICS</strong></h3>&#13;
<p class="noindent">The Drag Race Timer will use a few parts that you’ve already put together in previous projects: a push button to start the race, a servo to control the starting gate for the car, and a photo resistor to detect when the car reaches the end of the track. <a href="ch09.xhtml#ch09fig11">Figure 9-11</a> shows schematic diagrams of these three additional components.</p>&#13;
<p class="figuret"><a id="ch09fig11"/><strong>FIGURE 9-11:</strong> Schematic diagrams for additional components in the Drag Race Timer</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_11.jpg"/></div>&#13;
<p class="indent">Place a push button on the breadboard so that two legs are on either side of the center divide, and connect two of the legs on one side to pin 5 on the Arduino and GND. The parts will fill up most of the breadboard, so pay close attention to the rows on the breadboard and how the components are connected. To save space, this project uses the push button without the external pull-up resistor used in <a href="ch04.xhtml#ch04">Project 4</a> with the Reaction Timer. Instead, we’ll enable a pull-up resistor in the code.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_260"/>Next, connect the servo motor that will open the starting gate. Using three male-to-male jumper wires, connect the signal wire (either yellow or white) to pin 4 on the Arduino, the red wire to the 5 V rail, and the black wire to the GND rail.</p>&#13;
<p class="indent">Finally, add the light-sensor circuit with a voltage divider circuit. Connect one end of a photoresistor to the 5 V power rail and the other end to the GND power rail, via a 10 kΩ pull-down resistor placed directly in the power rail. Connect the row that has both the photoresistor and the 10 kΩ pull-up resistor to pin A0 on the Arduino. This circuit should look similar to the circuit you used in the Night-Light in <a href="ch05.xhtml#ch05">Project 5</a>.</p>&#13;
<p class="indent">There are a lot of components in this circuit, so take your time and double-check your wiring against the diagram in <a href="ch09.xhtml#ch09fig12">Figure 9-12</a>.</p>&#13;
<p class="figuret"><a id="ch09fig12"/><strong>FIGURE 9-12:</strong> Complete electronics for the Drag Race Timer, including a starting button and gate</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_12.jpg"/></div>&#13;
<h3 class="h3" id="ch09lev1sec6"><strong>PROGRAM THE DRAG RACE TIMER</strong></h3>&#13;
<p class="noindent">Now let’s put it all together. Start a new sketch, and enter the code from <a href="ch09.xhtml#ch09ex02">Listing 9-2</a> or download it from <em><a href="https://www.nostarch.com/arduinoinventor/">https://www.nostarch.com/arduinoinventor/</a></em>. This example will bring together several concepts and ideas we’ve used separately in past projects.</p>&#13;
<p class="ex-caption"><span epub:type="pagebreak" id="page_261"/><a id="ch09ex02"/><strong>LISTING 9-2:</strong> Drag Race Timer sketch</p>&#13;
<div class="pre">&#13;
<p class="programs"><span class="ent">➊</span> <span class="green1">#include</span>&lt;<span class="orange"><strong>LiquidCrystal</strong></span>.h&gt;<br/>  <span class="green1">#include</span>&lt;<span class="orange"><strong>Servo</strong></span>.h&gt;<br/><br/>  <span class="orange"><strong>LiquidCrystal</strong></span> lcd(8, 9, 10, 11, 12, 13);<br/><span class="ent">➋</span> <span class="orange"><strong>Servo</strong></span> startingGate;<br/><br/><span class="ent">➌</span> <span class="green">const</span> <span class="green">byte</span> buttonPin = 5;<br/>  <span class="green">const</span> <span class="green">byte</span> servoPin = 4;<br/>  <span class="green">const</span> <span class="green">byte</span> finishSensor1Pin = A0;<br/>  <span class="green">const int</span> darkThreshold = 500;<br/><br/><span class="ent">➍</span> <span class="green">int</span> finishSensor1;<br/>  <span class="green">boolean</span> finishFlag = <span class="green">false</span>;<br/>  <span class="green">long</span> startTime;<br/>  <span class="green">long</span> stopTime;<br/>  <span class="green">float</span> raceTime;<br/><br/>  <span class="green">void</span> <span class="green1">setup</span>()<br/>  {<br/><span class="ent">➎</span>   <span class="orange">pinMode</span>(buttonPin, INPUT_PULLUP);<br/><br/>    startingGate.<span class="orange">attach</span>(servoPin, 1000, 2000);<br/>    startingGate.<span class="orange">write</span>(0);<br/><br/><span class="ent">➏</span>   lcd.<span class="orange">begin</span>(16, 2);<br/>    lcd.<span class="orange">clear</span>();<br/>    lcd.<span class="orange">print</span>(<span class="blue1">"Drag Race Timer"</span>);<br/>    lcd.<span class="orange">setCursor</span>(0, 1);<br/>    lcd.<span class="orange">print</span>(<span class="blue1">"Push to start!"</span>);<br/><br/><span class="ent">➐</span>   <span class="green1">while</span> (<span class="orange">digitalRead</span>(buttonPin) == <span class="green">HIGH</span>)<br/>    {<br/>    }<br/><br/>    lcd.clear();<br/>    lcd.print(<span class="blue1">"Go!"</span>);<br/><br/>    startingGate.write(180);<br/>    startTime = millis();<br/>  }<br/><br/>  <span class="green">void</span> <span class="green1">loop</span>()<br/>  {<br/><span class="ent">➑</span>   finishSensor1 = <span class="orange">analogRead</span>(finishSensor1Pin);<br/><span class="ent">➒</span>   if ((finishFlag == <span class="green">false</span>) &amp;&amp; (finishSensor1 &lt; darkThreshold))<br/>    {<br/>      finishFlag = <span class="green">true</span>;<br/>      stopTime = <span class="orange">millis</span>();<br/>      raceTime = stopTime - startTime;<br/><span epub:type="pagebreak" id="page_262"/>      lcd.<span class="orange">clear</span>();<br/>      lcd.<span class="orange">print</span>(<span class="blue1">"Finish Time:"</span>);<br/>      lcd.<span class="orange">setCursor</span>(0, 1);<br/><span class="ent">➐</span>   lcd.<span class="orange">print</span>(raceTime / 1000, 3);<br/>    }<br/>  }</p>&#13;
</div>&#13;
<p class="indent">Let’s take a look at how all this works. First, the sketch includes two libraries using the <span class="literal">#include</span> directive <span class="ent">➊</span>, <em>LiquidCrystal.h</em> and <em>Servo.h</em>. Next, it initializes a <span class="literal">LiquidCrystal</span> object named <span class="literal">lcd</span>, similar to <a href="ch09.xhtml#ch09ex01">Listing 9-1</a>, and a <span class="literal">Servo</span> object named <span class="literal">startingGate</span> <span class="ent">➋</span>.</p>&#13;
<p class="indent">Then, the sketch declares a set of constants for the pin connections used for the button, servo, and photoresistor circuits <span class="ent">➌</span>. This means that, as you make changes and modifications, if you need to move a wire to a different pin on the Arduino, you’ll only have to change a single number in the code. The last constant, a threshold value named <span class="literal">darkThreshold</span>, is used to set the light level to detect when the car is blocking the light sensor. Here it’s set to <span class="literal">500</span>, roughly in the middle of the range of 0–1023, but you may need to adjust this value to suit the environment of your own room.</p>&#13;
<p class="indent">Next, the sketch declares a few variables <span class="ent">➍</span>. The <span class="literal">finishSensor1</span> variable is used to store the raw value of the photoresistor sensor. The next variable, <span class="literal">finishFlag</span>, is a <em>state variable</em>, which is used to keep track of what state the sketch is in. The <span class="literal">finishFlag</span> variable is initialized to <span class="literal">false</span> and is used to indicate when the race is over (like the flag waved at the finish line to mark the winner of a Formula One race). We’ll set it later in the code based on the input value from the sensor. The next three variables are used to calculate the race time using the built-in <span class="literal">millis()</span> timer in Arduino.</p>&#13;
<p class="indent">Now, the <span class="literal">setup()</span> part of the code sets up the button pin to use an internal pull-up resistor that’s built into the Arduino by declaring the pin mode as an <span class="literal">INPUT_PULLUP</span> <span class="ent">➎</span>. This trick removes the need for the external pull-up resistor used in <a href="ch04.xhtml#ch04">Project 4</a>.</p>&#13;
<p class="indent">Next, the sketch initializes the servo motor and sets its default position to <span class="literal">0</span>. This will be the position of the starting gate when it’s down.</p>&#13;
<p class="indent">The sketch then displays a little information to the LCD <span class="ent">➏</span> to let the user know how to start the race. These few lines of code set up the LCD, clear the screen, and display two lines of text. Be careful that your text is limited to 16 characters per line; any more than <span epub:type="pagebreak" id="page_263"/>16, and your characters will run off the screen to the right. The code then waits for a button press using the blocking <span class="literal">while()</span> loop technique <span class="ent">➐</span> used in the Reaction Timer; this blocks the sketch from proceeding until the button is pressed. When the button is pressed, <span class="literal">digitalRead(buttonPin)</span> will read <span class="literal">LOW</span> and the code will move the servo to the up position and set the <span class="literal">startTime</span> variable.</p>&#13;
<p class="indent">In the <span class="literal">loop()</span>, the sketch reads the light sensor and stores its current reading to the variable <span class="literal">finishSensor1</span> <span class="ent">➑</span>. The sensor will be embedded at the end of the ramp. The car will roll over it as it crosses the finish line, covering the sensor and blocking most of the light. Similar to the Night-Light sketch in <a href="ch05.xhtml#ch05">Project 5</a>, the sketch will compare the value of the sensor to the <span class="literal">darkThreshold</span> value.</p>&#13;
<div class="noter">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>Your sensor needs to be in a decently lit area so that the contrast between the sensor being lit and being shaded is great enough to cause that drop in voltage. Be aware that overhead lights can create a false detection if your body casts a shadow over the sensor. If you want to make sure that the sensor works well, get a small desk lamp and set it over the sensor.</em></p>&#13;
</div>&#13;
<p class="indent">Remember that in the time it takes the car to pass the sensor, the <span class="literal">loop()</span> may repeat several times. Because we only want to look for the first moment the car crosses the finish line, the sketch uses a compound <span class="literal">if()</span> statement <span class="ent">➒</span> to capture the moment when the <span class="literal">finishFlag</span> variable is <span class="literal">false</span> <em>and</em> the finish sensor is blocked (that is, its value is less than <span class="literal">darkThreshold</span>). The <span class="literal">&amp;&amp;</span> indicates a logical AND (see “<a href="ch09.xhtml#ch09sb02">Compound Logic Operators</a>” on page <a href="ch09.xhtml#page_264">264</a>). Pay careful attention to the number of parentheses used in the <span class="literal">if()</span> statement—they indicate order of operation and how the logic is used.</p>&#13;
<p class="indent">Now, inside the <span class="literal">if()</span> statement, the <span class="literal">finishFlag</span> state variable switches to <span class="literal">true</span>. Because the <span class="literal">finishFlag</span> state variable is now set to <span class="literal">true</span>, the compound <span class="literal">if()</span> statement will only catch the first moment the car crosses the sensor.</p>&#13;
<p class="indent">The sketch then records the stopping time and calculates the elapsed race time. Finally, the sketch prints the race time to the LCD.</p>&#13;
<p class="indent">The <span class="literal">raceTime</span> variable is declared as a <span class="literal">float</span> (floating-point variable) so it can store numbers with decimals. By default, the <span class="literal">lcd.print()</span> method will display two decimal places of precision for a floating-point value, but you can add a second parameter to the <span class="literal">lcd.print()</span> method to specify more or less. At <span class="ent">➓</span>, the sketch calculates the number of seconds elapsed by dividing the millisecond count by 1,000. The extra <span class="literal">3</span> in the instruction <span class="literal">lcd.print(raceTime / 1000, 3);</span> tells Arduino to display three values past the decimal point, so the time will be accurate to the millisecond. Don’t forget the last two curly brackets in the code. Double-check to make sure that your code matches <a href="ch09.xhtml#ch09ex02">Listing 9-2</a>, and upload the sketch to your device.</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch09sb02"><span epub:type="pagebreak" id="page_264"/><strong>COMPOUND LOGIC OPERATORS</strong></p>&#13;
<p class="noindent">In Chapter 4, we introduced simple logical comparison operators to compare two values. Recall that logic comparisons or expressions can only be either true or false. In programming, there are times when you need to compare multiple conditions together; for example, when you need to run some code only when a variable is false AND a sensor value is less than the threshold: <span class="literal">((finishFlag == false) &amp;&amp; (finishSensor1 &lt; darkThreshold))</span>. Here, notice that the logic comparisons are grouped together in parentheses on either side of the compound AND (<span class="literal">&amp;&amp;</span>).</p>&#13;
<p class="indent">A combination of two or more logic comparisons is known as a <em>compound logic expression</em>. Expressions are <em>evaluated</em> (or read) from left to right. To keep everything together and observe the correct order of operations, it’s a good idea to use parentheses to separate out the individual expressions. The two main operators used to combine logic expressions are AND and OR, which are described in the following table.</p>&#13;
<table class="all">&#13;
<tr>&#13;
<td class="tablecr"><p class="center"><strong>SYMBOL</strong></p></td>&#13;
<td class="tablecr"><p class="center"><strong>COMPOUND OPERATOR</strong></p></td>&#13;
<td class="tablec"><p class="center"><strong>DESCRIPTION</strong></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="tablecr"><p class="center"><span class="red1"><span class="literal">(<em>expression A</em>) &amp;&amp; (<em>expression B</em>)</span></span></p></td>&#13;
<td class="tablecr"><p class="center"><span class="red1">AND</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Both <span class="literal"><em>expression A</em></span> and <span class="literal"><em>expression B</em></span> must be <span class="literal">true</span>.</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="tablecr1"><p class="center"><span class="red1">(<span class="literal"><em>expression A</em>) || (<em>expression B</em>)</span></span></p></td>&#13;
<td class="tablecr1"><p class="center"><span class="red1">OR</span></p></td>&#13;
<td class="tablec1"><p class="center"><span class="red1">Either <span class="literal"><em>expression A</em></span> or <span class="literal"><em>expression B</em></span> must be <span class="literal">true</span>.</span></p></td>&#13;
</tr>&#13;
</table>&#13;
</div>&#13;
<h3 class="h3" id="ch09lev1sec7"><strong>A QUICK TEST</strong></h3>&#13;
<p class="noindent">If you have everything wired up correctly and the code uploaded successfully, you’ll hear the servo motor move to the 0 degree position and see a message displayed on the LCD, as shown in <a href="ch09.xhtml#ch09fig13">Figure 9-13</a>. If the text is garbled or otherwise incorrect, double-check the wiring of the LCD, push button, and light sensor.</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_265"/><a id="ch09fig13"/><strong>FIGURE 9-13:</strong> LCD display text at the start of the race</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_13.jpg"/></div>&#13;
<p class="indent">Push the button and see what happens. The servo motor should move, and the display should change to the message “Go!” Now, cover the photoresistor with your finger. The LCD should display the time elapsed since you pressed the button and covered the photo-resistor (<a href="ch09.xhtml#ch09fig14">Figure 9-14</a>).</p>&#13;
<p class="indent">With the electronics all working properly, it’s time to build the starting gate and track. If the sensor is not behaving as expected, try changing the <span class="literal">darkThreshold</span> value. If it’s too sensitive or triggering immediately, reduce the value of <span class="literal">darkThreshold</span>. If it’s not reacting when you cover up the sensor, try increasing the value. After you’ve made these changes, reupload your code and test it again.</p>&#13;
<p class="figuret"><a id="ch09fig14"/><strong>FIGURE 9-14:</strong> LCD display with time elapsed</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_14.jpg"/></div>&#13;
<h3 class="h3" id="ch09lev1sec8"><strong>BUILD THE DRAG RACE TRACK</strong></h3>&#13;
<p class="noindent">The Drag Race Track includes a starting tower with a rotating gate that controls the release of the car onto the track. For the track, you can either use a section of a toy car race track or build your own from cardstock. The template for the tower is shown in <a href="ch09.xhtml#ch09fig15">Figure 9-15</a>. You can download a PDF of this template from <em><a href="https://www.nostarch.com/arduinoinventor/">https://www.nostarch.com/arduinoinventor/</a></em>.</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_266"/><a id="ch09fig15"/><strong>FIGURE 9-15:</strong> Template of cardboard cutout pieces for starting gate (not full size)</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_15.jpg"/></div>&#13;
<h4 class="h4" id="ch09lev2sec7"><strong>Build the Starting Tower</strong></h4>&#13;
<p class="noindent">Carefully cut the template out from a sheet of cardboard (see <a href="ch09.xhtml#ch09fig16">Figure 9-16</a>). The template has an opening for mounting the servo on one side and a hole on the other to mount the bamboo skewer axle for the starting gate. The other pieces are the support beams and the starting gate.</p>&#13;
<p class="figuret"><a id="ch09fig16"/><strong>FIGURE 9-16:</strong> Trace the template and carefully cut out the pieces using a sharp craft knife.</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_16.jpg"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_267"/>With the pieces cut out, first mount the servo in the opening, labeled in <a href="ch09.xhtml#ch09fig15">Figure 9-15</a>. Insert the servo from the outside of the support beam so that the servo horn faces in toward the car. You can use the small screws included with the servo, or a small amount of glue, to secure the servo in place as shown in <a href="ch09.xhtml#ch09fig17">Figure 9-17</a>. Don’t attach the servo horn just yet. You’ll attach that to the starting gate in the next step.</p>&#13;
<p class="figuret"><a id="ch09fig17"/><strong>FIGURE 9-17:</strong> Securing the servo using hot glue</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_17.jpg"/></div>&#13;
<p class="indent">Now, glue the two support beams in place. The lower support beam will insert into the slots cut into each of the side pieces. The top support beam should fit right into the notch on the top of each side piece. Use a small dab of glue to secure each of these pieces in place. When you’re done, you should have a starting support tower like the one in <a href="ch09.xhtml#ch09fig18">Figure 9-18</a>.</p>&#13;
<p class="figuret"><a id="ch09fig18"/><strong>FIGURE 9-18:</strong> Adding the support beams</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_18.jpg"/></div>&#13;
<h4 class="h4" id="ch09lev2sec8"><span epub:type="pagebreak" id="page_268"/><strong>Assemble the Starting Gate</strong></h4>&#13;
<p class="noindent">To build the starting gate, you’ll need a piece of cardboard that is 2.5 × 1 inches and a short length of bamboo skewer or thin coffee stirring rod. This will serve as an axle for the starting gate. To start, add a small bead of glue to the edge of the starting gate piece, and glue the servo horn on so that the hub hangs just off the edge, as shown in <a href="ch09.xhtml#ch09fig19">Figure 9-19</a>.</p>&#13;
<p class="figuret"><a id="ch09fig19"/><strong>FIGURE 9-19:</strong> Gluing the servo horn onto the edge of the starting gate</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_19.jpg"/></div>&#13;
<p class="indent">Cut down the bamboo skewer to 3.5 inches. Place a line of glue along the edge, and line the axle up with the hub of the servo horn, as shown in <a href="ch09.xhtml#ch09fig20">Figure 9-20</a>.</p>&#13;
<p class="figuret"><a id="ch09fig20"/><strong>FIGURE 9-20:</strong> Gluing the axle to the starting gate</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_20.jpg"/></div>&#13;
<p class="indent">Plug in your Arduino and push the reset button to reset the position of the servo. Remember that the code will start off with the servo in the 0 degree position; this will be the down position, where the starting gate is holding the car in place. To place the starting gate into the support tower, first insert the axle into the hole on the side piece opposite of the servo, as shown in <a href="ch09.xhtml#ch09fig21">Figure 9-21</a>. Keep in mind that when the gate opens, it will rotate clockwise.</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_269"/><a id="ch09fig21"/><strong>FIGURE 9-21:</strong> Inserting the axle into the side piece for the starting gate</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_21.jpg"/></div>&#13;
<p class="indent">The finished starting tower with the gate is shown in <a href="ch09.xhtml#ch09fig22">Figure 9-22</a>.</p>&#13;
<p class="figuret"><a id="ch09fig22"/><strong>FIGURE 9-22:</strong> Completed starting tower</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_22.jpg"/></div>&#13;
<p class="indent">Now you need a track. You can use a standard Hot Wheels track, which will fit on the lower support, or build your own track. If you want to use a Hot Wheels track, skip ahead to “<a href="ch09.xhtml#ch09lev2sec10">Add the Photoresistor</a>” on page <a href="ch09.xhtml#page_270">270</a>.</p>&#13;
<h4 class="h4" id="ch09lev2sec9"><span epub:type="pagebreak" id="page_270"/><strong>Build Your Own Track</strong></h4>&#13;
<p class="noindent">To build your own track, you’ll need at least one sheet of cardstock, cut down to 3.5 × 11 inches. You can make several lengths of track and tape them together for a longer track, but for our example, we’ll just use a single track.</p>&#13;
<p class="indent">You’ll fold two side rails on the track. On each side, measure and mark a line that is a quarter inch from the edge. Now, fold along the lines so that you have a quarter-inch lip on each side of your track. (It’s often helpful to use a metal ruler or the edge of a table to make a nice straight fold in cardstock.) The lip will keep your car from flying off the track and also adds a small amount of structural integrity. Your track should look similar to the one pictured in <a href="ch09.xhtml#ch09fig23">Figure 9-23</a>.</p>&#13;
<p class="indent">Now, using a small handheld hole punch, make a hole about a half inch from the end of your track for your photoresistor. If you don’t have a hole punch, a craft knife or sharp pencil will also work. Just be careful when cutting through the paper, and always use a cutting mat when using a knife. The hole needs to be just large enough for the head of the photoresistor to fit inside.</p>&#13;
<p class="figuret"><a id="ch09fig23"/><strong>FIGURE 9-23:</strong> Completed track with two sides folded up</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_23.jpg"/></div>&#13;
<h4 class="h4" id="ch09lev2sec10"><strong>Add the Photoresistor</strong></h4>&#13;
<p class="noindent">Whether you’re using a homemade track or a standard toy track, the next step is to add the photoresistor at the bottom of the ramp. The photoresistor will be your finish-line sensor. (There is a small hole at the end of a standard Hot Wheels track, slightly smaller than the diameter of the photoresistor sensor. Thankfully, the plastic track is flexible enough that you can simply press the head of the photo-resistor through this hole.)</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_271"/>Remove the photoresistor from the breadboard and bend the legs at a right angle along the head so that it looks like <a href="ch09.xhtml#ch09fig24">Figure 9-24</a>.</p>&#13;
<p class="figuret"><a id="ch09fig24"/><strong>FIGURE 9-24:</strong> Bend the head of the photoresistor at a right angle.</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_24.jpg"/></div>&#13;
<p class="indent">Insert the head of the photoresistor through the hole in your track. Make sure that the photoresistor does not stick out too much, or your car will catch on it; the car should be able to roll over the sensor without interference. With the legs bent at right angles, you should be able to tape them down securely to the bottom side of the track, as shown in <a href="ch09.xhtml#ch09fig25">Figure 9-25</a>.</p>&#13;
<p class="figuret"><a id="ch09fig25"/><strong>FIGURE 9-25:</strong> Securing the photo resistor to the race track</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_25.jpg"/></div>&#13;
<p class="indent">Reconnect the photoresistor to your breadboard using a pair of male-to-female jumper wires. If you extended the track too far and can’t reach the breadboard, add more male-to-female jumpers to extend your wires as needed.</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart"><span epub:type="pagebreak" id="page_272"/><strong>FEEL THE NEED FOR SPEED? CALCULATING AVERAGE SPEED</strong></p>&#13;
<p class="noindent">With this project you can accurately measure how long it takes the car to roll down the ramp and cross the finish line, but you don’t know how <em>fast</em> the car is moving—or do you?</p>&#13;
<p class="indent">Well, you have the total time it takes for the car to reach the bottom of the track, and you know the length of the track. With these two pieces of information, you can <em>estimate</em> how fast the car is moving. We describe this as an estimate because it’s really an average speed, as opposed to the exact speed of your car when it meets the sensor at the bottom of the ramp. If you watch as the car rolls down, you’ll see that it starts at the top of the ramp unmoving, then moves slowly, and then continues to speed up as it goes down the track.</p>&#13;
<p class="indent">Average speed is defined as distance traveled per unit of time. So, to find the average speed, you need to measure the length of the track and divide this value by the time elapsed.</p>&#13;
<div class="image"><img alt="Image" src="../images/272fig01.jpg"/></div>&#13;
<p class="indent">Our track measures about 8.5 inches from the starting gate to the finish-line sensor, and in our last test we had a time of 0.581 seconds. If we divide these two numbers, we get an average speed of 14.6 inches per second.</p>&#13;
<div class="image"><img alt="Image" src="../images/272fig02.jpg"/></div>&#13;
<p class="indent">Remember that this is the <em>average</em> speed of the car. For our simple setup with a straight ramp, this is roughly how fast the car is moving at the middle of the ramp, and since it wasn’t moving at the top of the ramp, this means it was moving at twice this speed at the bottom of the ramp. How fast is your car moving?</p>&#13;
</div>&#13;
<h4 class="h4" id="ch09lev2sec11"><strong>Test and Troubleshoot</strong></h4>&#13;
<p class="noindent">Finally, rest the end of your race track without the photoresistor on the starting tower so that the ramp extends past the tower by about the length of your toy car (see <a href="ch09.xhtml#ch09fig26">Figure 9-26</a>). This will be the starting position.</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_273"/><a id="ch09fig26"/><strong>FIGURE 9-26:</strong> Finished Drag Race Timer with car ready to launch</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_26.jpg"/></div>&#13;
<p class="indent">If you haven’t already done so, plug the Arduino back into your computer or into a power source. Push the reset button to make sure that the sketch starts over, and find your favorite Matchbox or Hot Wheels car and set it behind the starting gate. Push the starting button and watch your car go!</p>&#13;
<p class="indent">How long did it take to reach the bottom? On our track, our toy cars took just over 0.5 seconds. Try a few different cars, or invite some friends over to see whose car is the fastest. If you tape a few pennies to your car, does it go faster? Experiment and see how different things affect the drag race time of your car.</p>&#13;
<h3 class="h3" id="ch09lev1sec9"><strong>GOING FURTHER</strong></h3>&#13;
<p class="noindent">In this project, we introduced you to using the LCD to display information directly from your Arduino sketch. Here are a few ideas of how you can take what you’ve done in this project further.</p>&#13;
<h4 class="h4" id="ch09lev2sec12"><strong>Hack</strong></h4>&#13;
<p class="noindent">Racing against yourself is only so much fun. Let’s look at how to add a second track and have two cars race against each other. (See <a href="ch09.xhtml#ch09fig27">Figure 9-27</a>.) For this hack, you’ll need an extra photoresistor, which isn’t included in the standard SparkFun Inventor’s Kit. Find a friend who also has a kit, buy one separately, or find one in the additional parts kit for this book.</p>&#13;
<p class="indent">First you need to create a separate finish-line sensor circuit. We were able to sneak in one more photoresistor and a pull-down resistor circuit near the bottom of the breadboard, as shown in <a href="ch09.xhtml#ch09fig28">Figure 9-28</a>. Connect the second photoresistor circuit to pin 2 on <span epub:type="pagebreak" id="page_274"/>the Arduino through a 10 kΩ pull-down resistor, and connect the other leg to the 5 V power rail.</p>&#13;
<p class="indent">Place the photoresistor in the second track, and add male-to-female jumper wires to connect this to your circuit on the breadboard. Set your second track next to the first one on the starting tower. Now, it’s time to upload some new code that will use both sensors. You only need to add a few extra lines to allow for the two cars to race. Download the <em>P9_TwoCarDragRaceTimer.ino</em> file from <em><a href="https://www.nostarch.com/arduinoinventor/">https://www.nostarch.com/arduinoinventor/</a></em> and open it.</p>&#13;
<p class="indent">Let’s take a look at the additions to this code. First, the code adds a new constant and variable for the second photoresistor finishline sensor, <span class="literal">finishSensor2Pin</span> and <span class="literal">finishSensor2</span>.</p>&#13;
<p class="indent">Then, it checks which sensor was crossed first using a compound <span class="literal">if()</span> statement. If car #1 crosses first, <span class="literal">finishSensor1</span> will be <span class="literal">0</span> and <span class="literal">finishSensor2</span> will still be <span class="literal">1</span>. Inside this <span class="literal">if()</span> statement, instructions display the winning information to the LCD and set the state variable, <span class="literal">finishFlag</span>, to <span class="literal">true</span>.</p>&#13;
<p class="indent">The <span class="literal">else-if()</span> statement checks whether car #2 crosses the finish line first; in this case, <span class="literal">finishSensor2</span> will be <span class="literal">0</span> and <span class="literal">finishSensor1</span> will still be <span class="literal">1</span>. In the unlikely event that both cars do actually cross the line at the same time, this code does nothing. See if you can figure out how to add a draw feature in the event of a tie.</p>&#13;
<p class="indent">The code is full of comments to help explain more. Now, upload the code to your board and race! Whose car is fastest?</p>&#13;
<p class="figuret"><a id="ch09fig27"/><strong>FIGURE 9-27:</strong> Drag Race Timer with two race tracks</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_27.jpg"/></div>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_275"/><a id="ch09fig28"/><strong>FIGURE 9-28:</strong> Adding a second photo-resistor for racing two cars at the same time</p>&#13;
<div class="image"><img alt="Image" src="../images/fig9_28.jpg"/></div>&#13;
<h4 class="h4" id="ch09lev2sec13"><strong>Modify</strong></h4>&#13;
<p class="noindent">Now that you’ve seen how to use the LCD circuit, try going back and adding an LCD to one of the projects you’ve already built. In any of the projects where you used the Serial Monitor to display information, like the Reaction Timer from <a href="ch04.xhtml#ch04">Project 4</a> or the Tiny Desktop Greenhouse in <a href="ch07.xhtml#ch07">Project 7</a>, you can replace the Serial Monitor with the LCD.</p>&#13;
<p class="indent">You’ll need to check the wiring and the pin configuration used; you’ll need six GPIO pins from your Arduino to control the LCD. If you want to see an example of the Reaction Timer project that uses the LCD, take a look at the tutorial we created on our InventorSpace at <em><a href="https://invent.sparkfun.com/cwists/preview/1145-sik-lcd-reaction-timer/">https://invent.sparkfun.com/cwists/preview/1145-sik-lcd-reaction-timer/</a></em>.</p>&#13;
</body></html>