<html><head></head><body>
  <div class="chapter" title="Chapter&#xA0;11.&#xA0;Second Time&#x2019;s the Charm">&#13;
    <div class="titlepage">&#13;
      <h1 class="title" id="heading_id_2"><a id="second_timeapostrophes_the_charm"/>Chapter 11. Second Time’s the Charm</h1>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="Refactoring at the Refactory">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_3"><a id="refactoring_at_the_refactory"/>Refactoring at the Refactory</h1>&#13;
      </div>&#13;
&#13;
      <p><a class="indexterm" id="iddle1714"/><a class="indexterm" id="iddle1828"/>The King, the Queen, Ruben, and Scarlet leapt from the Loop platform the moment it eased to a halt at the Center o’ the Kingdom station and the doors <span class="emphasis"><em>whoosh</em></span>ed open. They made a beeline for the gleaming red metal gates of the Refactory, which they could already see from the station exit.</p>&#13;
&#13;
      <p>“Right through here!” said the King. “Quickly now!” As they approached, the two guards manning the gates hastily pulled them open, trying to salute at the same time.</p>&#13;
&#13;
      <p>The four of them sped through the gates and down a long paved road. The Refactory loomed ahead: a huge red metal block of a building with a dozen chimneys puffing a pleasant-looking pink smoke.</p>&#13;
&#13;
      <div class="informalfigure">&#13;
        <a id="med_id00052a"/>&#13;
&#13;
        <div class="mediaobject"><a id="med_id00052"/><img alt="image with no caption" src="../Images/httpatomoreillycomsourcenostarchimages2160057.png.jpg"/></div>&#13;
      </div>&#13;
&#13;
      <p>They arrived at a large set of gleaming double doors that were propped open. A warm red light shone from within. Without hesitating, the King and Queen strode inside, and Ruben and Scarlet followed.</p>&#13;
&#13;
      <p>“My good man!” called the King, waving at a man in a hard hat holding a clipboard. “We’ve got an emergency! We need to speak to the Foreman, posthaste!”</p>&#13;
&#13;
      <p>The man looked up and nearly dropped his clipboard. “Your Majesty!” he said. “Of course, of course! Right away!” He dashed off into the recesses of the Refactory, clutching his helmet to his head with one hand and his clipboard with the other.</p>&#13;
&#13;
      <p>The King, the Queen, Ruben, and Scarlet stood in the entry-way, catching their breath. Scarlet looked around. “Where are we?” she asked.</p>&#13;
&#13;
      <p>“This is the main entrance to the Refactory,” said the Queen. She nodded toward the glow coming from farther inside the building. “Over that way is the Refactory floor, where all the actual work takes place.”</p>&#13;
&#13;
      <p>“That’s where they make Key-a-ma-Jiggers?” asked Ruben.</p>&#13;
&#13;
      <p>The Queen nodded. “Among other things,” she said.</p>&#13;
&#13;
      <p>Ruben opened his mouth to ask what else the Refactory made, but at that instant, the young man in the hard hat returned, followed by a much older man with twinkling eyes and a great big bushy beard.</p>&#13;
&#13;
      <div class="informalfigure">&#13;
        <a id="med_id00053a"/>&#13;
&#13;
        <div class="mediaobject"><a id="med_id00053"/><img alt="image with no caption" src="../Images/httpatomoreillycomsourcenostarchimages2160059.png.jpg"/></div>&#13;
      </div>&#13;
&#13;
      <p>“Your Majesty! Your Highness!” the older man said to the King and Queen, bowing to each in turn. “What can I do for you?”</p>&#13;
&#13;
      <p>“Seal the factory!” said the Queen. “We have reason to believe there are intruders in the Refactory, and they must be stopped!”</p>&#13;
&#13;
      <p>The bearded man nodded curtly and walked across the Refactory’s narrow entryway to a bright red telephone. He picked up the receiver and dialed a single digit. When he spoke into the phone, his voice echoed throughout the entire Refactory:</p>&#13;
&#13;
      <div class="itemizedlist">&#13;
        <ul class="itemizedlist">&#13;
          <li class="listitem">&#13;
            <p><span class="smaller">SEAL ALL EXITS! THIS IS NOT A DRILL!</span></p>&#13;
          </li>&#13;
&#13;
          <li class="listitem">&#13;
            <p><span class="smaller">SEAL ALL EXITS! THIS IS NOT A DRILL!</span></p>&#13;
          </li>&#13;
        </ul>&#13;
      </div>&#13;
&#13;
      <p>The old man placed a hand over the phone’s receiver. “What do these intruders look like?” he asked.</p>&#13;
&#13;
      <p>“We’re not sure,” said the Queen.</p>&#13;
&#13;
      <p>“but there are four of them.” The man nodded again and got back on the phone:</p>&#13;
&#13;
      <div class="blockquote">&#13;
        <blockquote class="blockquote">&#13;
          <p><span class="smaller">BEGIN SECTOR-BY-SECTOR SEARCH FOR FOUR INTRUDERS! DETAIN ANY SUSPICIOUS PERSONS AND REPORT IMMEDIATELY!</span></p>&#13;
        </blockquote>&#13;
      </div>&#13;
&#13;
      <p>With that, he hung up the phone and strode back to the rest of them, smiling.</p>&#13;
&#13;
      <p>“That should do the trick,” he said. “If there are any intruders in the Refactory, my team will find them and call us at once.”</p>&#13;
&#13;
      <p>“Thank you so much!” said Scarlet. “But, um, who exactly <span class="emphasis"><em>are</em></span> you?”</p>&#13;
&#13;
      <p>“Why, I’m the Foreman, Rusty Fourman!” the man said, tipping his hard hat. “I’m in charge of all operations here at the Refactory.” He gestured to the young man who had fetched him. “This is Marshall Fiveman, my right-hand man.”</p>&#13;
&#13;
      <p>“Pleased to meet you,” Marshall said.</p>&#13;
&#13;
      <p>“Pleased to meet you, too!” said Ruben.</p>&#13;
&#13;
      <p>“Rusty has been running the Refactory for as long as I can remember,” said the King.</p>&#13;
&#13;
      <p>“How long is that?” asked Scarlet.</p>&#13;
&#13;
      <p>“Oh, I don’t know,” said the King. “At least several days.”</p>&#13;
&#13;
      <p>“Years and years!” said Rusty, laughing. He tugged on his beard and suddenly became serious. “I imagine these intruders are what brought you out my way. I have no doubt we’ll catch them soon, but do you know what they might be doing here?”</p>&#13;
&#13;
      <p>“Yes!” Scarlet said, fishing around in her pocket. “Do you make these?” she asked, holding out the Key-a-ma-Jigger.</p>&#13;
&#13;
      <p>Rusty peered at the small piece of metal in her hand. “Well, yes, we do make Key-a-ma-Jiggers here,” he said. “And a few other things. Mostly, though, we’re in the business of refactoring Ruby code.”</p>&#13;
&#13;
      <div class="informalfigure">&#13;
        <a id="med_id00054a"/>&#13;
&#13;
        <div class="mediaobject"><a id="med_id00054"/><img alt="image with no caption" src="../Images/httpatomoreillycomsourcenostarchimages2160061.png.jpg"/></div>&#13;
      </div>&#13;
&#13;
      <p>“Refactoring?” said Ruben. “What’s that?”</p>&#13;
&#13;
      <p>“It’s basically when you rewrite your programs,” Rusty said.</p>&#13;
&#13;
      <p>“Rewrite them?!” Ruben said. “But I spent so much time writing them the first time! Why would I do it again?”</p>&#13;
&#13;
      <p>“Because you can make your code faster, easier to read, or easier to update, and it still does the same work.” Rusty said. He thought for a moment. “It might be easier if I show you. We can do a few of the more common Ruby refactorings, and I think you’ll get the idea pretty quickly.” He looked at his watch. “With the factory sealed tight, it’s only a matter of time before my crew finds your culprits. In the meantime, let’s refactor a little Ruby!”</p>&#13;
&#13;
      <p>The Foreman beckoned them closer and led them deeper into the Refactory, toward the warm glow that turned everything inside the building a deep red. He walked over to a long, arched railing overlooking a gently bubbling pool of what looked like molten red metal and opened up a familiar-looking machine—a Computing Contraption! The King, the Queen, Scarlet, and Ruben walked up to him as he began to type at the keyboard.</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1065"/><a class="indexterm" id="iddle1233"/><a class="indexterm" id="iddle1601"/><a class="indexterm" id="iddle1917"/><a class="indexterm" id="iddle1922"/>“Now then,” said Rusty, scratching his nose with one hand and continuing to type with the other, “in all my years at the Refactory, I’ve seen a lot of Ruby. Over time, I’ve found patterns in the code that work very well, and patterns that don’t work so well. Would you like to see a few of the good ones?” he asked.</p>&#13;
&#13;
      <p>“Absolutely!” answered the King.</p>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="Variable Assignment Tricks">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_4"><a id="variable_assignment_tricks"/>Variable Assignment Tricks</h1>&#13;
      </div>&#13;
&#13;
      <p>“For example,” Rusty said, “I often see code where the person who wrote it would like to set a variable to a particular value, but <span class="emphasis"><em>only</em></span> if the value hasn’t already been set. So I might write something like this that checks whether a particular variable is <code class="literal">nil</code> and, if so, sets it to a default value.” And he typed:</p><a id="pro_id00351"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">rubens_number = nil</span></strong></span>&#13;
=&gt; nil&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">if rubens_number.nil?</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">rubens_number = 42</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
=&gt; 42&#13;
</pre>&#13;
&#13;
      <p>“That looks perfectly all right to me,” said the King.</p>&#13;
&#13;
      <p>“Oh, it’s quite correct Ruby,” said Rusty, “and it will do exactly what we think it will—because <code class="literal">rubens_number</code> is <code class="literal">nil</code>, Ruby sets it to <code class="literal">42</code>. But there’s a much clearer way to write it!” He typed some more:</p><a id="pro_id00352"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">rubens_number ||= 42</span></strong></span>&#13;
=&gt; 42&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">rubens_number</span></strong></span>&#13;
=&gt; 42&#13;
</pre>&#13;
&#13;
      <p>“You can think of <code class="literal">||=</code> as being a combination of <code class="literal">||</code> for ‘or’ and <code class="literal">=</code> for variable assignment,” said Rusty. “That combination <a class="indexterm" id="iddle1210"/><a class="indexterm" id="iddle1393"/><a class="indexterm" id="iddle1416"/><a class="indexterm" id="iddle1904"/><a class="indexterm" id="iddle1921"/>says: ‘Set <code class="literal">rubens_number</code> to <code class="literal">42</code> if it doesn’t already have a value.’ It’s the same thing as typing this!” He typed some more:</p><a id="pro_id00353"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">rubens_number = nil</span></strong></span>&#13;
=&gt; nil&#13;
&gt;&gt; <span class="strong"><strong><span class="red">rubens_number = rubens_number || 43</span></strong></span>&#13;
=&gt; 43&#13;
</pre>&#13;
&#13;
      <p>“What if the variable <span class="emphasis"><em>does</em></span> already have a value?” Scarlet asked.</p>&#13;
&#13;
      <p>“Let’s find out!” said Rusty. He typed some more:</p><a id="pro_id00354"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">scarlets_number = 700</span></strong></span>&#13;
=&gt; 700&#13;
&gt;&gt; <span class="strong"><strong><span class="red">scarlets_number ||= 42</span></strong></span>&#13;
=&gt; 700&#13;
&gt;&gt; <span class="strong"><strong><span class="red">scarlets_number</span></strong></span>&#13;
=&gt; 700&#13;
</pre>&#13;
&#13;
      <p>“In this case,” Rusty said, “<code class="literal">scarlets_number</code> already has a value of <code class="literal">700</code>, so <code class="literal">||=</code> doesn’t do anything. As I mentioned, <code class="literal">||</code> means ‘or,’ and you’ve likely seen that <code class="literal">=</code> means ‘assign this value to a variable.’” Scarlet and Ruben nodded.</p>&#13;
&#13;
      <p>“So,” Rusty continued, “when we write <code class="literal">||=</code>, we’re telling Ruby: ‘Hey! You should <span class="emphasis"><em>conditionally assign</em></span> this value to this variable.’ That’s just a fancy way of saying we want Ruby to use the value it already knows <span class="emphasis"><em>or</em></span> use the new value if the variable isn’t set. For <code class="literal">rubens_number</code>, there was no value, so <code class="literal">42</code> was set; for <code class="literal">scarlets_number</code>, we’d already set <code class="literal">700</code> as the value, so <code class="literal">||= 42</code> did nothing.”</p>&#13;
&#13;
      <p>“But couldn’t we write this?” Scarlet asked, and typed:</p><a id="pro_id00355"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">rubens_number = 42 if rubens_number.nil?</span></strong></span>&#13;
=&gt; 42&#13;
</pre>&#13;
&#13;
      <p>“Why, yes!” Rusty said, and his great bushy beard turned upward as he smiled. “I wouldn’t necessarily use that code in this example, since I can just as easily use <code class="literal">||=</code>, but it’s a very common refactoring to use inline <code class="literal">if</code>s and <code class="literal">unless</code>es in Ruby.”</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1264"/><a class="indexterm" id="iddle1906"/>“What do you mean by <span class="emphasis"><em>inline</em></span>?” asked Scarlet.</p>&#13;
&#13;
      <p>“I’ll show you!” said the Foreman, and he typed more code into the Computing Contraption:</p><a id="pro_id00356"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">if !rubens_number.nil?</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts 'Not nil!'</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
Not nil!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“That’ll get the job done,” said Rusty, “but why use <code class="literal">if</code> and <code class="literal">!</code> if we can just use <code class="literal">unless</code>?”</p><a id="pro_id00357"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">unless rubens_number.nil?</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts 'Not nil!'</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
Not nil!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“Now, that’s a bit better,” Rusty continued, “but it’s still more lines of code than we need. If we’ve got an <code class="literal">if</code> or <code class="literal">unless</code> but no <code class="literal">else</code>, we can write the whole thing in one line, like this.”</p><a id="pro_id00358"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">puts 'Not nil!' unless rubens_number.nil?</span></strong></span>&#13;
Not nil!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“Now <span class="emphasis"><em>this</em></span> is the best!” said Rusty. “Not only can we convert <code class="literal">if !</code>s to <code class="literal">unless</code>es, but we can also write <code class="literal">unless</code> on a single line with the variable we’re testing!”</p>&#13;
&#13;
      <p>“And we can do that with <code class="literal">if</code>, too?” asked Scarlet.</p>&#13;
&#13;
      <p>“You bet!” said Rusty, and he typed:</p><a id="pro_id00359"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">puts '42! My favorite number!' if rubens_number == 42</span></strong></span>&#13;
42! My favorite number!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“Now, just as with <code class="literal">if</code>, we can use <code class="literal">else</code> with <code class="literal">unless</code>,” said Rusty, “but while <code class="literal">if</code>/<code class="literal">else</code> makes a lot of sense to me, I find <code class="literal">unless</code>/<code class="literal">else</code> confusing.”</p>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="Crystal-Clear Conditionals">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_5"><a id="crystal-clear_conditionals"/>Crystal-Clear Conditionals</h1>&#13;
      </div>&#13;
&#13;
      <p><a class="indexterm" id="iddle1213"/>“I agree,” said the King, rubbing his head. “So we should convert <code class="literal">if !</code>s to <code class="literal">unless</code>es, and we can make <code class="literal">if</code> or <code class="literal">unless</code> one line if there’s no <code class="literal">else</code>?”</p>&#13;
&#13;
      <p>“Precisely,” said Rusty. “This is confusing:</p><a id="pro_id00360"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">unless rubens_number.nil?</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts 'Not nil!'</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">else</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts 'Totally nil.'</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
Not nil!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“But <span class="emphasis"><em>this</em></span> is clear as day!”</p><a id="pro_id00361"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">if rubens_number.nil?</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts 'Totally nil.'</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">else</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts 'Not nil!'</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
Not nil!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“In fact,” Rusty continued, “we could write these as two one-line statements—one <code class="literal">if</code> and one <code class="literal">unless</code>. I don’t think that’s as easy to understand, but I’ll show it to you in case you’re curious.”</p><a id="pro_id00362"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">puts 'Not nil!' unless rubens_number.nil?</span></strong></span>&#13;
Not nil!&#13;
=&gt; nil&#13;
&gt;&gt; <span class="strong"><strong><span class="red">puts 'Totally nil.' if rubens_number.nil?</span></strong></span>&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“Remember,” said Rusty, “<code class="literal">puts</code> returns <code class="literal">nil</code>, so that’s why we see it after the <code class="literal">=&gt;</code>. But since <code class="literal">rubens_number</code> is <code class="literal">42</code> and <span class="emphasis"><em>not</em></span> <code class="literal">nil</code>, Ruby doesn’t print <code class="literal">'Totally nil.'</code>.”</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1053"/><a class="indexterm" id="iddle1394"/><a class="indexterm" id="iddle1696"/><a class="indexterm" id="iddle1873"/>“I think the <code class="literal">if</code>/<code class="literal">else</code> one is the easiest to understand,” said Ruben, “but it’s still a lot of extra lines. If there <span class="emphasis"><em>is</em></span> an <code class="literal">else</code>, is there any simpler way to write it?”</p>&#13;
&#13;
      <p>“As it happens, there is,” said Rusty. “We can use a <span class="emphasis"><em>ternary operator</em></span>. It looks like this!”</p><a id="pro_id00363"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">puts 1 &lt; 2 ? 'One is less than two!' : 'One is greater than two!'</span></strong></span>&#13;
One is less than two!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“Sweet limbo of lost twist-ties!” cried the King. “What in our peaceful kingdom is that?”</p>&#13;
&#13;
      <p>“It’s not nearly as scary as it looks. We’ll just use a question mark followed by a colon in our code,” said Rusty. “In this case, we want our code to print something out using <code class="literal">puts</code>. Next, we give Ruby an <span class="emphasis"><em>expression</em></span>: something that will either turn out to be true or false. In this case, that’s <code class="literal">1 &lt; 2</code>.” Rusty scratched his beard. “Then we write a question mark, followed by what Ruby should do if the expression is true. Finally, we write a colon, followed by what Ruby should do if the expression is false. Since 1 <span class="emphasis"><em>is</em></span> less than 2, Ruby prints out <code class="literal">One is less than two!</code>” He thought for a moment. “Really, you can think of it as writing an <code class="literal">if</code>/<code class="literal">else</code>, just all on one line. The <code class="literal">?</code> is like a shorthand <code class="literal">if</code>, and the <code class="literal">:</code> is like a shorthand <code class="literal">else</code>.”</p>&#13;
&#13;
      <p>“That’s quite marvelous,” said the Queen, “but don’t you find it a bit hard to read?”</p>&#13;
&#13;
      <p>“Sometimes,” admitted Rusty, “so I’ll often stick to a regular <code class="literal">if</code>/<code class="literal">else</code>. But if it’s a very short bit of code, I’ll sometimes refactor an <code class="literal">if</code>/<code class="literal">else</code> into a <code class="literal">? :</code>.”</p>&#13;
&#13;
      <p>“What if the expression you want to check is a method with a question mark?” Ruben asked. “Will the ternary operator still work?”</p>&#13;
&#13;
      <p>“Oh, yes,” said Rusty, and he quickly typed:</p><a id="pro_id00364"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">bill = nil</span></strong></span>&#13;
=&gt; nil&#13;
&gt;&gt; <span class="strong"><strong><span class="red">puts bill.nil? ? "Bill's nil!" : "Bill's not nil at all."</span></strong></span>&#13;
Bill's nil!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p><a class="indexterm" id="iddle1145"/><a class="indexterm" id="iddle1603"/>“That third line can look tricky with the two question marks so close together,” said Rusty, “so you want to be a bit careful with them. Remember, <code class="literal">nil?</code> is a built-in Ruby method that returns <code class="literal">true</code> if the object it’s called on is <code class="literal">nil</code> and <code class="literal">false</code> otherwise.”</p>&#13;
&#13;
      <p>“It’s also important to remember that <code class="literal">nil</code> gets returned because <code class="literal">puts</code> has no return value, not because it’s returning <code class="literal">bill</code>!” said the Queen.</p>&#13;
&#13;
      <p>“Quite right, quite right,” said Rusty.</p>&#13;
&#13;
      <p>“This looks pretty good,” said Scarlet, squinting at the Computing Contraption screen, “but I feel like a whole bunch of <code class="literal">? :</code> symbols in a row—or even <code class="literal">if</code>/<code class="literal">elses</code>!—would get hard to read. Is there a good way to write code when Ruby should do a lot of different things without our having to write <code class="literal">if</code>s and <code class="literal">else</code>s all over the place?”</p>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="When You Need a case Statement">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_6"><a id="when_you_need_a_case_statement"/>When You Need a case Statement</h1>&#13;
      </div>&#13;
&#13;
      <p>“You’ve got a keen eye for refactoring,” said Rusty. “There <span class="emphasis"><em>is</em></span> something we can use to replace <code class="literal">if</code>s and <code class="literal">else</code>s in Ruby. And while I don’t find myself using it a lot,” he continued, “it <span class="emphasis"><em>can</em></span> be much more readable than a long chain of <code class="literal">if</code>s, <code class="literal">elsif</code>s, and <code class="literal">else</code>s. It’s called a <code class="literal">case</code> statement. Have a look!” He typed:</p><a id="pro_id00365"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">number = 1</span></strong></span>&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">case number</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">when 0</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts "Zero!"</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">when 1</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts "One is fun!"</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">when 2</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts "Two. It's true!"</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">when 3</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts "Three for me."</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">else</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts "#{number}? I don't know that one."</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
&#13;
One is fun!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p><a class="indexterm" id="iddle1962"/>“We use the <code class="literal">case</code> keyword to tell Ruby which variable to pay attention to,” Rusty explained. “Then we can use <code class="literal">when</code> to say: <span class="emphasis"><em>when</em></span> this value is the case—that is, when this value is the variable we’re looking at—do this thing!”</p>&#13;
&#13;
      <p>“And just like with <code class="literal">if</code> and <code class="literal">unless</code>, we use <code class="literal">else</code> to have Ruby do something when nothing matches,” Ruben said.</p>&#13;
&#13;
      <p>“Exactly right,” said Rusty.</p>&#13;
&#13;
      <p>“But is this all <code class="literal">case</code> statements can do?” Marshall piped up. “It seems to me it’s not that interesting to just have them check whether a variable is a certain number.”</p>&#13;
&#13;
      <p>“Oh my, no,” said Rusty. “They can get mighty fancy!” He typed:</p><a id="pro_id00366"/>&#13;
      <pre class="programlisting">&#13;
  &gt;&gt; <span class="strong"><strong><span class="red">number = 7</span></strong></span>&#13;
&#13;
  &gt;&gt; <span class="strong"><strong><span class="red">case number</span></strong></span>&#13;
➊ &gt;&gt; <span class="strong"><strong><span class="red">when 0</span></strong></span>&#13;
  &gt;&gt;   <span class="strong"><strong><span class="red">puts "That's definitely zero."</span></strong></span>&#13;
➋ &gt;&gt; <span class="strong"><strong><span class="red">when 1..10</span></strong></span>&#13;
  &gt;&gt;   <span class="strong"><strong><span class="red">puts "It's a number between 1 and 10, all right."</span></strong></span>&#13;
➌ &gt;&gt; <span class="strong"><strong><span class="red">when 42</span></strong></span>&#13;
  &gt;&gt;   <span class="strong"><strong><span class="red">puts "Ah yes, 42. My favorite number!"</span></strong></span>&#13;
➍ &gt;&gt; <span class="strong"><strong><span class="red">when String</span></strong></span>&#13;
  &gt;&gt;   <span class="strong"><strong><span class="red">puts "What? That's a string!"</span></strong></span>&#13;
  &gt;&gt; <span class="strong"><strong><span class="red">else</span></strong></span>&#13;
  &gt;&gt;   <span class="strong"><strong><span class="red">puts "A #{number}? What in the world is a #{number}?"</span></strong></span>&#13;
  &gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
&#13;
It's a number between 1 and 10, all right.&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“We can check whether a number is a certain value like <code class="literal">0</code> (➊) or <code class="literal">42</code> (➌), whether it falls in a range (➋), or even whether it’s an instance of a particular class, like <code class="literal">String</code> (➍),” said Rusty. “<code class="literal">case</code> statements can quickly do a lot of work that <code class="literal">if</code> and <code class="literal">else</code> would take a long time to handle.”</p>&#13;
&#13;
      <p>“That <span class="emphasis"><em>is</em></span> quite fancy,” said the King, “but if there’s anything I’ve learned from Ruby, it’s that the most delightful moments are when I can get something done without having to write out every last detail. Are there any refactorings like that?”</p>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="Simplifying Methods">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_7"><a id="simplifying_methods"/>Simplifying Methods</h1>&#13;
      </div>&#13;
&#13;
      <p><a class="indexterm" id="iddle1141"/><a class="indexterm" id="iddle1540"/><a class="indexterm" id="iddle1725"/>“I thought you’d never ask,” said the Foreman. “This is an old one, but a good one. Do you know about methods and <code class="literal">return</code>?”</p>&#13;
&#13;
      <p>They all nodded.</p>&#13;
&#13;
      <p>“Perfect,” he said. “As you may or may not know, Ruby methods will automatically return the result of the last bit of code they evaluate. That means that if you want your method to return the last expression it evaluates, you can leave off the <code class="literal">return</code> keyword completely. Let’s define a method that simply checks if the argument it gets is <code class="literal">true</code>.”</p><a id="pro_id00367"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">def true?(idea_we_have)</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">return idea_we_have == true</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“Now, that’ll <code class="literal">return true</code> if <code class="literal">idea_we_have</code> is <code class="literal">true</code> and <code class="literal">false</code> if it isn’t,” Rusty said, “but it turns out that Ruby automatically returns the result of the last bit of code it runs. We don’t need <code class="literal">return</code> at all!”</p><a id="pro_id00368"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">def true?(idea_we_have)</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">idea_we_have == true</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“Ah, yes!” said the King. “I think we’ve seen this bit of Ruby wizardry before.”</p>&#13;
&#13;
      <p>“All right,” said Rusty, “but try <span class="emphasis"><em>this</em></span> one on for size. If you have an expression that will give you back a Boolean—that is, it will end up being <code class="literal">true</code> or <code class="literal">false</code>—you don’t have to compare it to <code class="literal">true</code> or <code class="literal">false</code> with <code class="literal">==</code>. That’s just an extra step! You can just return the variable that will be <code class="literal">true</code> or <code class="literal">false</code> <span class="emphasis"><em>itself</em></span>.” He typed into the Computing Contraption:</p><a id="pro_id00369"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">def true?(idea_we_have)</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">idea_we_have</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
=&gt; nil&#13;
&gt;&gt; <span class="strong"><strong><span class="red">most_true_variable = true</span></strong></span>&#13;
=&gt; true&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">true?(most_true_variable)</span></strong></span>&#13;
=&gt; true&#13;
</pre>&#13;
&#13;
      <p><a class="indexterm" id="iddle1894"/>“<code class="literal">most_true_variable</code> is <code class="literal">true</code>, and since our method automatically returns whatever argument gets passed in, it returns <code class="literal">true</code>,” the Foreman explained.</p>&#13;
&#13;
      <p>“Wonderful!” said the Queen. “I love how simple that method was. But will this work only for variables that are <code class="literal">true</code> or <code class="literal">false</code>?”</p>&#13;
&#13;
      <p>Rusty nodded. “Though there’s another good refactoring that will let us determine whether a Ruby value is <span class="emphasis"><em>truthy</em></span> or not.”</p>&#13;
&#13;
      <div class="informalfigure">&#13;
        <a id="med_id00055a"/>&#13;
&#13;
        <div class="mediaobject"><a id="med_id00055"/><img alt="image with no caption" src="../Images/httpatomoreillycomsourcenostarchimages2160063.png.jpg"/></div>&#13;
      </div>&#13;
&#13;
      <p>“Truthy?” asked Ruben and Scarlet together.</p>&#13;
&#13;
      <p>“Truthy!” said Rusty. “When I say a Ruby value is <span class="emphasis"><em>truthy</em></span>, what I mean is: this value is not <code class="literal">false</code> or <code class="literal">nil</code>. Remember how those two values work with <code class="literal">if</code> and <code class="literal">unless</code>?” he asked, and he typed:</p><a id="pro_id00370"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">my_variable = true</span></strong></span>&#13;
=&gt; true&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">puts 'Truthy!' if my_variable</span></strong></span>&#13;
Truthy!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“Because <code class="literal">my_variable</code> is <code class="literal">true</code> and <code class="literal">true</code> is a truthy value, the <code class="literal">if</code> statement code runs and Ruby prints out <code class="literal">'Truthy!'</code>,” Rusty said. “Now let’s see what happens if we do the same thing with <code class="literal">false</code>.”</p><a id="pro_id00371"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">my_variable = false</span></strong></span>&#13;
=&gt; false&#13;
&gt;&gt; <span class="strong"><strong><span class="red">puts 'Truthy!' if my_variable</span></strong></span>&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p><a class="indexterm" id="iddle1314"/>“Nothing!” said the King.</p>&#13;
&#13;
      <p>“That’s right,” said the Foreman. “<code class="literal">my_variable</code> is <code class="literal">false</code>, so <code class="literal">'Truthy!'</code> doesn’t get printed out on the screen. The same thing happens with <code class="literal">nil</code>.”</p><a id="pro_id00372"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">my_variable = nil</span></strong></span>&#13;
=&gt; nil&#13;
&gt;&gt; <span class="strong"><strong><span class="red">puts 'Truthy!' if my_variable</span></strong></span>&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“Nothing was printed for <code class="literal">false</code> or <code class="literal">nil</code> because they’re <span class="emphasis"><em>falsey</em></span> values; every other value in Ruby is truthy,” Rusty explained. “Have a look!” He typed some more:</p><a id="pro_id00373"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">my_variable = 99</span></strong></span>&#13;
=&gt; 99&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">puts 'Truthy!' if my_variable</span></strong></span>&#13;
Truthy!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“You’ll see, though, that <code class="literal">nil</code> and <code class="literal">false</code> aren’t <span class="emphasis"><em>exactly</em></span> the same, and <code class="literal">99</code> and <code class="literal">true</code> also aren’t <span class="emphasis"><em>exactly</em></span> the same.” He typed again:</p><a id="pro_id00374"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">nil == false</span></strong></span>&#13;
=&gt; false&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">99 == true</span></strong></span>&#13;
=&gt; false&#13;
</pre>&#13;
&#13;
      <p>“But!” he exclaimed, raising a single finger, “we can turn a <span class="emphasis"><em>truthy</em></span> value into <code class="literal">true</code> and a <span class="emphasis"><em>falsey</em></span> value into <code class="literal">false</code> with a simple <code class="literal">!!</code>. You see, the first <code class="literal">!</code> makes Ruby return a Boolean, but since <code class="literal">!</code> means ‘not,’ it’s the opposite of what you want. The second <code class="literal">!</code> fixes this by undoing the opposite you got from <a class="indexterm" id="iddle1315"/><a class="indexterm" id="iddle1895"/>the first one!” The King, Scarlet, Ruben, and even the Queen looked puzzled. “Here, I’ll show you,” the Foreman offered, and he typed into the Computing Contraption:</p><a id="pro_id00375"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">truthy_value = 'A fancy string'</span></strong></span>&#13;
=&gt; "A fancy string"&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">falsey_value = nil</span></strong></span>&#13;
=&gt; nil&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">truthy_value</span></strong></span>&#13;
=&gt; "A fancy string"&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">!truthy_value</span></strong></span>&#13;
=&gt; false&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">!!truthy_value</span></strong></span>&#13;
=&gt; true&#13;
</pre>&#13;
&#13;
      <p>“So <code class="literal">truthy_value</code> is a string,” said Scarlet, “and since it’s not <code class="literal">false</code> or <code class="literal">nil</code>, if you put it in an <code class="literal">if</code> statement, the code will run.”</p>&#13;
&#13;
      <p>“Right,” said Rusty.</p>&#13;
&#13;
      <p>“So,” Scarlet said, “<code class="literal">!truthy_value</code> is <code class="literal">false</code>, and <span class="emphasis"><em>not</em></span> <code class="literal">!truthy_value</code>—that is, <code class="literal">!!truthy_value</code>—is <code class="literal">true</code>!”</p>&#13;
&#13;
      <p>“You’ve got it!” said Rusty. “Now, here’s how it works for falsey values.”</p><a id="pro_id00376"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">falsey_value</span></strong></span>&#13;
=&gt; nil&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">!falsey_value</span></strong></span>&#13;
=&gt; true&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">!!falsey_value</span></strong></span>&#13;
=&gt; false&#13;
</pre>&#13;
&#13;
      <p>“It’s just the opposite!” said Ruben. “<code class="literal">nil</code> is falsey, so <code class="literal">!nil</code> is <code class="literal">true</code> and <code class="literal">!!nil</code> is <code class="literal">false</code>.”</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1569"/>“Exactly,” said the Foreman. “We could even write a method to see if something is truthy, like this.”</p><a id="pro_id00377"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">def truthy?(thing)</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">!!thing</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
=&gt; nil&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">truthy?('A fancy string')</span></strong></span>&#13;
=&gt; true&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">truthy?(nil)</span></strong></span>&#13;
=&gt; false&#13;
</pre>&#13;
&#13;
      <p>“In this case, we’ve defined a <code class="literal">truthy?</code> method that takes a single argument, <code class="literal">thing</code>,” said Rusty. “Then we call <code class="literal">!!thing</code>: the first <code class="literal">!</code> returns <code class="literal">false</code> if <code class="literal">thing</code> is truthy and <code class="literal">true</code> if <code class="literal">thing</code> is falsey. Since this is the opposite of what we want, we use <code class="literal">!!</code> to make our method return <code class="literal">true</code> if <code class="literal">thing</code> is truthy and <code class="literal">false</code> if <code class="literal">thing</code> is falsey.”</p>&#13;
&#13;
      <p>“That’s amazing!” said Scarlet.</p>&#13;
&#13;
      <p>“Isn’t it?” said Rusty. “Once we’ve defined <code class="literal">truthy?</code>, we can call it on <code class="literal">'A fancy string'</code> to see that it’s a truthy value, then on <code class="literal">nil</code> to see that <code class="literal">nil</code> is falsey.”</p>&#13;
&#13;
      <p>“What else can we do to make our Ruby programs shorter and clearer?” Ruben asked.</p>&#13;
&#13;
      <p>“Well, this one might seem obvious,” said Rusty, “but it’s actually one of the hardest parts of programming—giving variables, methods, and constants good names!”</p>&#13;
&#13;
      <p>“What do you mean?” said Marshall, who was scribbling furiously on his clipboard.</p>&#13;
&#13;
      <p>“Well, let’s use our <code class="literal">truthy?</code> method as an example,” Rusty said. “Check out what would’ve happened if we’d picked a clumsier name.” He quickly typed:</p><a id="pro_id00378"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">def is_this_a_truthy_thing_or_not?(thing)</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">return !!thing</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“That looks terrible,” said the King.</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1181"/><a class="indexterm" id="iddle1226"/>“Yes, it does,” said Rusty. “Not only that, but it also has an extra <code class="literal">return</code> that we don’t need. The simpler method is much nicer.”</p><a id="pro_id00379"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">def truthy?(thing)</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">!!thing</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“Aha! I see,” said the King. “We want to give the Ruby objects we create simple, easy-to-remember names so we type less code and make fewer mistakes when we want to reference our code later.”</p>&#13;
&#13;
      <p>“Bingo!” said Rusty. “Imagine if we had to type <code class="literal">is_this_a_truthy_thing_or_not?</code> every time we wanted to check if a value was truthy. It’d be pure madness!”</p>&#13;
&#13;
      <p>“How else can we cut down on rewriting code?” asked Marshall.</p>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="De-duplicating Code">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_8"><a id="de-duplicating_code"/>De-duplicating Code</h1>&#13;
      </div>&#13;
&#13;
      <p>“Well, one nice way is to remove duplicated code whenever we can!” said Rusty. “It’s much too easy to cut and paste code all through our programs, which then makes it very hard to change those programs if variable names or values change. Take a look at this,” he said, typing:</p><a id="pro_id00380"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">def king?(dude)</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">if dude == 'The King'</span></strong></span>&#13;
&gt;&gt;      <span class="strong"><strong><span class="red">puts 'Royal!'</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">else</span></strong></span>&#13;
&gt;&gt;      <span class="strong"><strong><span class="red">puts 'Not royal.'</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
=&gt; nil&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">def queen?(lady)</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">if lady == 'The Queen'</span></strong></span>&#13;
&gt;&gt;     <span class="strong"><strong><span class="red">puts 'Royal!'</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">else</span></strong></span>&#13;
&gt;&gt;     <span class="strong"><strong><span class="red">puts 'Not royal.'</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“I’ve defined two methods here,” said Rusty. “The first one, <code class="literal">king?</code>, checks whether the argument passed in is <code class="literal">'The King'</code>; if so, it <code class="literal">puts 'Royal!'</code>, and otherwise it puts <code class="literal">'Not royal.'</code>. I’ve also defined a second method, <code class="literal">queen?</code>, that checks whether the argument passed in is <code class="literal">'The Queen'</code>. See how much of that code is repeated?” Rusty continued. “It was very boring to type, and what’s more, if we want to change any of the messages that get printed out, we have to do it in two places! I’d much rather type this,” he said, and so he did:</p><a id="pro_id00381"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">royal?(person)</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">if person == 'The King' || person == 'The Queen'</span></strong></span>&#13;
&gt;&gt;     <span class="strong"><strong><span class="red">puts 'Royal!'</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">else</span></strong></span>&#13;
&gt;&gt;     <span class="strong"><strong><span class="red">puts 'Not royal.'</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“Now we’ve got one method that does the work of two,” Rusty said.</p><a id="pro_id00382"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">royal?('The King')</span></strong></span>&#13;
Royal!&#13;
=&gt; nil&#13;
&gt;&gt; <span class="strong"><strong><span class="red">royal?('The Queen')</span></strong></span>&#13;
Royal!&#13;
=&gt; nil&#13;
&gt;&gt; <span class="strong"><strong><span class="red">royal?('The jester')</span></strong></span>&#13;
Not royal.&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“I like that a lot better,” said Ruben. “And we could have written that with the ternary operator if we wanted, right?”</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1201"/><a class="indexterm" id="iddle1527"/>“Of course!” said Rusty. “We can get to that in a little while, if you like.”</p>&#13;
&#13;
      <p>“Before we do,” interrupted the King, “I worry that if we go <span class="emphasis"><em>too</em></span> far down this road of combining methods, we might get methods that do <span class="emphasis"><em>too much</em></span> work and are very hard to think about.”</p>&#13;
&#13;
      <p>“Happens all the time!” said the Foreman. “While it’s true that you often want to write the least amount of code you can, sometimes you end up writing very large, hard-to-think-about methods that really should be broken up into smaller pieces. Take a look at this method that came through the Refactory just the other day,” he said, and he typed into the Computing Contraption:</p><a id="pro_id00383"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">list_of_numbers = [1, 2, 3, 4, 5]</span></strong></span>&#13;
=&gt; [1, 2, 3, 4, 5]&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">def tally_odds_and_evens(numbers)</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">evens = []</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">odds = []</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">numbers.each do |number|</span></strong></span>&#13;
&gt;&gt;     <span class="strong"><strong><span class="red">if number.even?</span></strong></span>&#13;
&gt;&gt;       <span class="strong"><strong><span class="red">puts 'Even!'</span></strong></span>&#13;
&gt;&gt;       <span class="strong"><strong><span class="red">evens.push(number)</span></strong></span>&#13;
&gt;&gt;     <span class="strong"><strong><span class="red">else</span></strong></span>&#13;
&gt;&gt;       <span class="strong"><strong><span class="red">puts 'Odd!'</span></strong></span>&#13;
&gt;&gt;       <span class="strong"><strong><span class="red">odds.push(number)</span></strong></span>&#13;
&gt;&gt;     <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts "#{evens}"</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts "#{odds}"</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“First, it sets up a few variables,” Rusty said. “The <code class="literal">evens</code> array stores even numbers, the <code class="literal">odds</code> array stores odd numbers, and the <code class="literal">list_of_numbers</code> stores the numbers to check for evenness or oddness.”</p>&#13;
&#13;
      <p>“Next, the <code class="literal">tally_odds_and_evens</code> method iterates over a list of numbers and checks to see whether each one is even or odd <a class="indexterm" id="iddle1302"/><a class="indexterm" id="iddle1631"/>with Ruby’s built-in <code class="literal">even?</code> and <code class="literal">odd?</code> methods. For each number, <code class="literal">tally_odds_and_evens</code> prints out whether it’s even or odd, then adds it to the appropriate array.”</p><a id="pro_id00384"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">tally_odds_and_evens(list_of_numbers)</span></strong></span>&#13;
&#13;
Odd!&#13;
Even!&#13;
Odd!&#13;
Even!&#13;
Odd!&#13;
[2, 4]&#13;
[1, 3, 5]&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“As you can see,” Rusty said, “it’s pretty complicated.”</p>&#13;
&#13;
      <p>“I’ll say!” said the King. “I can hardly follow a word of it.”</p>&#13;
&#13;
      <p>“It might be easier if we broke down this big method, <code class="literal">tally_odds_and_evens</code>, into a few smaller, well-named ones,” said Rusty, and he typed:</p><a id="pro_id00385"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt;  <span class="strong"><strong><span class="red">list_of_numbers = [1, 2, 3, 4, 5]</span></strong></span>&#13;
=&gt; [1, 2, 3, 4, 5]&#13;
&#13;
&gt;&gt;  <span class="strong"><strong><span class="red">def tally_odds_and_evens(numbers)</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">evens = []</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">odds = []</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">numbers.each do |number|</span></strong></span>&#13;
&gt;&gt;     <span class="strong"><strong><span class="red">alert_odd_or_even(number)</span></strong></span>&#13;
&gt;&gt;     <span class="strong"><strong><span class="red">update_tally(number, evens, oddsna)</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts "#{evens}"</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts "#{odds}"</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“First, we’ll rewrite the <code class="literal">tally_odds_and_evens</code> method. We’ll move the code that prints <code class="literal">Odd!</code> or <code class="literal">Even!</code> to its own method, <code class="literal">alert_odd_or_even</code>, and we’ll move the code that updates the tally to <a class="indexterm" id="iddle1874"/><a class="indexterm" id="iddle1911"/>its own method, <code class="literal">update_tally</code>. We’ll write each method in just a minute,” Rusty said.</p>&#13;
&#13;
      <p>“That makes sense,” said the King.</p>&#13;
&#13;
      <p>“Next, we’ll take out the part that writes <code class="literal">Odd!</code> or <code class="literal">Even!</code> on the screen and wrap it up in a method called <code class="literal">alert_odd_or_even</code>. In fact, we can use the ternary operator we learned about to make it a one-line method!”</p><a id="pro_id00386"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">def alert_odd_or_even(number)</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts number.even? ? 'Even!' : 'Odd!'</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“After that,” Rusty continued, “we’ll put the code that updates the <code class="literal">evens</code> and <code class="literal">odds</code> arrays into its own method, <code class="literal">update_tally</code>.”</p><a id="pro_id00387"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">def update_tally(number, evens, odd)</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">if number.even?</span></strong></span>&#13;
&gt;&gt;     <span class="strong"><strong><span class="red">evens.push(number)</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">else</span></strong></span>&#13;
&gt;&gt;     <span class="strong"><strong><span class="red">odds.push(number)</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“That’s the same code we had before, just wrapped up in its own method. It makes the overall <code class="literal">tally_odds_and_evens</code> method look much better, though, and it still works the same way,” Rusty explained.</p><a id="pro_id00388"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">tally_odds_and_evens(list_of_numbers)</span></strong></span>&#13;
&#13;
Odd!&#13;
Even!&#13;
Odd!&#13;
Even!&#13;
Odd!&#13;
[2, 4]&#13;
[1, 3, 5]&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“Overall, it’s a bit more code,” Rusty admitted, “but now it’s clearer what’s doing what, and we can change what gets printed out or how we update our lists of even and odd numbers independently from one another if we want to.”</p>&#13;
&#13;
      <p>“Excellent!” said the King, beaming. “I like my Ruby methods to be just like me: short and simple!” The Queen, Ruben, and Scarlet stifled a laugh.</p>&#13;
&#13;
      <p>Rusty pushed his hard hat up on his head. “That’s all the refactoring I can think of off the top of my head,” he said. He looked at his watch again. “I’m surprised we haven’t heard back from any of the search teams yet. What were you telling me these ne’er-do-wells were after?” He thought for a moment, then snapped his fingers. “Ah, yes! Your Key-a-ma-Jigger. That’s why you’re here in the first place, I take it?”</p>&#13;
&#13;
      <p>“Yes!” said Scarlet. “We found this plugged into the Panda Provisionator 3000 over at the Royal Stables, and we thought that it might be the last one our mysterious bad guys had, so they might have come back here for more.” She held the small piece of metal out to the Foreman once more.</p>&#13;
&#13;
      <p>Rusty nodded. “Yes, that’s one of ours,” he said. “And if your troublemakers are looking for more, they’d almost certainly be trying to get into the Vault of Tricky Things and Trinkets!”</p>&#13;
&#13;
      <p>“My word!” said the Queen. “What’s that?”</p>&#13;
&#13;
      <p>“It’s where we keep a large number of items,” said Rusty, “like Ruby code we’ve found particularly hard to refactor and various things and trinkets. It’s also where we keep a lot of our inventory, including our Key-a-ma-Jiggers.”</p>&#13;
&#13;
      <div class="informalfigure">&#13;
        <a id="med_id00056a"/>&#13;
&#13;
        <div class="mediaobject"><a id="med_id00056"/><img alt="image with no caption" src="../Images/httpatomoreillycomsourcenostarchimages2160065.png.jpg"/></div>&#13;
      </div>&#13;
&#13;
      <p>The King struck his palm with his fist. “If that’s where the Key-a-ma-Jiggers are, I’m sure that’s where we’ll find our culprits!” he said. “Could you call down and have your teams head there right away?”</p>&#13;
&#13;
      <p>No sooner had the King asked than the Foreman’s red telephone began ringing off the hook.</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1341"/><a class="indexterm" id="iddle1715"/>Rusty ran to the phone and picked it up. “Hello?” he said. He listened intently for a moment, then gasped. He covered the receiver with his hand. “One of my teams caught four intruders down by the Vault!” he said. He put the phone to his ear again, then sighed deeply. “All right,” he said. “Send every available worker. And hurry!” He hung up.</p>&#13;
&#13;
      <p>“What was it?” asked the Queen. “Did your team catch them?”</p>&#13;
&#13;
      <p>“No,” groaned the Foreman, “they’ve escaped!” The Queen’s face fell; the King covered his face with his hands; Scarlet and Ruben turned to each other, mouths open.</p>&#13;
&#13;
      <p>“But!” Rusty said, holding up a single finger, “every one of my workers is in hot pursuit. Our four villains were seen heading straight for the Refactory’s loading docks, and that’s a one-way street! We’ll have them surrounded faster than you can rename a Ruby method.”</p>&#13;
&#13;
      <p>“Then what are we waiting for?” said the Queen. “Let’s go see who we’ve been chasing all this time!” And with that, all five of them charged off to the loading docks in the depths of the Refactory.</p>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="Re-refactoring">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_9"><a id="re-refactoring"/>Re-refactoring</h1>&#13;
      </div>&#13;
&#13;
      <p>Practice makes perfect! Now that you’ve learned a whole bunch of ways to make your Ruby code even shorter and simpler to read, it’s time to apply them to a couple of particularly gnarly methods. Not to worry, though: if you didn’t have any trouble with the refactorings we saw earlier, these’ll be a breeze! (Even if you stumbled here and there, you’ll be a refactoring master by the time you’re through with these examples.)</p>&#13;
&#13;
      <p>Let’s begin by making a new file called <span class="bolditalic red">first_try.rb</span> and typing the following code. We’ll actually be making <span class="emphasis"><em>two</em></span> files this time: one for the initial code and one for the refactoring we’ll do. <span class="emphasis"><em>first_try.rb</em></span> defines a method, <code class="literal">all_about_my_number</code>, and sets the number to <code class="literal">42</code> if no number is passed in. After that, it prints some information about the number, including what the number is and whether it’s positive, negative, or zero.</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1713"/><span class="bolditalic red">first_try.rb</span></p><a id="pro_id00389"/>&#13;
      <pre class="programlisting">&#13;
def all_about_my_number(number)&#13;
  if number.nil?&#13;
    number = 42&#13;
  end&#13;
&#13;
  puts "My number is: #{number}"&#13;
&#13;
  if number &gt; 0 == true&#13;
    return 'Positive'&#13;
  elsif number &lt; 0 == true&#13;
    return 'Negative'&#13;
  else&#13;
    return 'Zero'&#13;
  end&#13;
end&#13;
</pre>&#13;
&#13;
      <p>If this doesn’t look like great code to you, don’t worry! We’re about to refactor it. In the same folder on your computer, create another file called <span class="bolditalic red">refactored.rb</span> and type the following code into it. This code will do exactly the same thing as the code in <span class="emphasis"><em>first_try.rb</em></span>, but it will look much nicer.</p>&#13;
&#13;
      <p><span class="bolditalic red">refactored.rb</span></p><a id="pro_id00390"/>&#13;
      <pre class="programlisting">&#13;
def describe_number(number)&#13;
  number ||= 42&#13;
&#13;
  puts "My number is: #{number}"&#13;
&#13;
  sign(number)&#13;
end&#13;
&#13;
def sign(number)&#13;
  case&#13;
  when number &gt; 0&#13;
    'Positive'&#13;
  when number &lt; 0&#13;
    'Negative'&#13;
  else&#13;
    'Zero'&#13;
  end&#13;
end&#13;
</pre>&#13;
&#13;
      <p><a class="indexterm" id="iddle1146"/>As always, you can run the code in your file by typing <span class="strong"><strong><span class="red"><code class="literal">ruby first_try.rb</code></span></strong></span> and <span class="strong"><strong><span class="red"><code class="literal">ruby refactored.rb</code></span></strong></span> from the command line. Since we made two files in the previous chapter and there’s no new code here, there shouldn’t be any big surprises! (Though there may be some small ones.)</p>&#13;
&#13;
      <p>The first difference you’ll probably notice is in the <code class="literal">case</code> statement; earlier, we did something like this:</p><a id="pro_id00391"/>&#13;
      <pre class="programlisting">&#13;
<span class="ash">case number</span>&#13;
<span class="ash">when 0</span>&#13;
<span class="ash">puts 'Zero!'</span>&#13;
<span class="ash"># ... and so on</span>&#13;
</pre>&#13;
&#13;
      <p>And now we’re doing this:</p><a id="pro_id00392"/>&#13;
      <pre class="programlisting">&#13;
<span class="ash">case</span>&#13;
  <span class="ash">when number &gt; 0</span>&#13;
<span class="ash"># ... and so on</span>&#13;
</pre>&#13;
&#13;
      <p>These are both 100 percent correct Ruby. If you have a variable and you just want to check whether it equals a certain value, is a certain class, or is in a certain range, you’d use the first syntax; if you want to do specific checks on a value (like <code class="literal">number &gt; 0</code>), you’d use the second one.</p>&#13;
&#13;
      <p>You probably also saw that we skipped right over some refactorings. For instance, we removed the <code class="literal">==</code> check from lines like <code class="literal">if number &gt; 0 == true</code>. Sometimes you’ll start to refactor one way, then realize there’s an even better way to do it! Other times there are a whole bunch of ways to refactor your code that are all equally good, and you just happen to pick one over another.</p>&#13;
&#13;
      <p>Finally, we managed to pull out a bunch of repetition (including some <code class="literal">return</code> statements that we can let Ruby handle implicitly!) and broke out the code that checks the sign of a number (positive, negative, or zero) into its own method.</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1211"/>How could we make this refactoring even more awesome? There are probably an unlimited number of ways, but here are a few to get your gears turning. For example, we refactored the <code class="literal">nil?</code> check into an <code class="literal">||=</code>. This works okay, but is there something else we could do? (Hint: We learned about setting default arguments in <a class="xref" href="../Text/ch07.html" title="Chapter 7. The Magic of Methods and Blocks">Chapter 7</a>.) Also, we have an <code class="literal">if</code>/<code class="literal">else</code> statement that we converted to a <code class="literal">case</code>, but would it have made sense to use a ternary operator somewhere instead? Why or why not? Explain your answer in 6,000 words or more. (Hint: Don’t do that—it would be unbelievably boring.)</p>&#13;
&#13;
      <p>One more example to bake your noodle: we don’t do any checking to make sure that the argument that gets passed to our method really <span class="emphasis"><em>is</em></span> a number. What happens if we put in a Boolean? A string? What could we do to refactor our method so it would be okay with non-number inputs?</p>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="You Know This!">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_10"><a id="you_know_thisexclamation_mark-id00011"/>You Know This!</h1>&#13;
      </div>&#13;
&#13;
      <p>Okay! It might have seemed at first that this chapter wouldn’t have a whole lot to offer—after all, we’re just rewriting the sort of code that we’ve been writing all along—but it turns out that <span class="emphasis"><em>re</em></span>writing our Ruby code can be even more challenging than writing it the first time. Just to make sure you’re up to those challenges (hint: you absolutely are), let’s go over the refactorings we covered one more time.</p>&#13;
&#13;
      <p>First, you saw that we can set a value <span class="emphasis"><em>conditionally</em></span> with <code class="literal">||=</code>. In other words, we can tell Ruby to set a value for a variable if that variable doesn’t already have one, but to use the existing value if it does:</p><a id="pro_id00393"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">my_variable ||= 'pink smoke'</span></strong></span>&#13;
=&gt; "pink smoke"&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">my_variable</span></strong></span>&#13;
=&gt; "pink smoke"&#13;
</pre>&#13;
&#13;
      <p><a class="indexterm" id="iddle1395"/><a class="indexterm" id="iddle1905"/>Here, <code class="literal">my_variable</code> isn’t already set, so <code class="literal">||=</code> sets it to <code class="literal">'pink smoke'</code>. If the variable already has a value, though, <code class="literal">||=</code> won’t change it. Check it out!</p><a id="pro_id00394"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="red">your_variable = 'blue smoke'</span>&#13;
=&gt; "blue smoke"&#13;
&#13;
&gt;&gt; <span class="red">your_variable ||= 'pink smoke'</span>&#13;
=&gt; "blue smoke"&#13;
&#13;
&gt;&gt; <span class="red">your_variable</span>&#13;
=&gt; "blue smoke"&#13;
</pre>&#13;
&#13;
      <p>You also saw that we can replace <code class="literal">if !</code> with <code class="literal">unless</code>:</p><a id="pro_id00395"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="red">if !my_variable.nil?</span>&#13;
&gt;&gt;    <span class="red">puts 'Not nil!'</span>&#13;
&gt;&gt; <span class="red">end</span>&#13;
Not nil!&#13;
=&gt; nil&#13;
&#13;
&gt;&gt; <span class="red">unless my_variable.nil?</span>&#13;
&gt;&gt;    <span class="red">puts 'Not nil!'</span>&#13;
&gt;&gt; <span class="red">end</span>&#13;
Not nil!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>And you saw that we can even put an <code class="literal">if</code> or <code class="literal">unless</code> <span class="emphasis"><em>inline</em></span> if we don’t need an <code class="literal">else</code>:</p><a id="pro_id00396"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="red">puts 'Not nil!' unless my_variable.nil?</span>&#13;
Not nil!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>If an <code class="literal">else</code> is involved, it’s usually better to stick to a regular <code class="literal">if</code>/<code class="literal">else</code>.</p><a id="pro_id00397"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="red">if true</span>&#13;
&gt;&gt;   <span class="red">puts 'True!'</span>&#13;
&gt;&gt; <span class="red">else</span>&#13;
&gt;&gt;   <span class="red">puts 'False!'</span>&#13;
&gt;&gt; <span class="red">end</span>&#13;
True!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p><a class="indexterm" id="iddle1054"/><a class="indexterm" id="iddle1147"/><a class="indexterm" id="iddle1521"/><a class="indexterm" id="iddle1697"/><a class="indexterm" id="iddle1875"/>However, for very short <code class="literal">if</code>/<code class="literal">elses</code>, sometimes it makes sense to use the <span class="emphasis"><em>ternary operator</em></span>, like so:</p><a id="pro_id00398"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="red">puts true ? 'True!' : 'False!'</span>&#13;
True!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>You learned that we can even use the ternary operator with methods that have question marks in them! Just be sure to use two question marks: one that’s part of the method name and one that’s part of the ternary statement:</p><a id="pro_id00399"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="red">jill = nil</span>&#13;
&gt;&gt; <span class="red">puts jill.nil? ? "Jill's nil!" : "Jill's not nil at all."</span>&#13;
&gt;&gt; <span class="red">Jill's nil!</span>&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>We also talked about replacing long chains of <code class="literal">if</code>/<code class="literal">elsif</code>/<code class="literal">else</code> with <code class="literal">case</code> statements. A <code class="literal">case</code> statement takes a variable and does different things depending on its value:</p><a id="pro_id00400"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="red">random_trinket = 'plastic cup'</span>&#13;
=&gt; "Plastic cup"&#13;
&#13;
&gt;&gt; <span class="red">case random_trinket</span>&#13;
&gt;&gt; <span class="red">when 'plastic cup'</span>&#13;
&gt;&gt;   <span class="red">puts "Plastic cup's on the up and up!"</span>&#13;
&gt;&gt; <span class="red">when 'pet ham'</span>&#13;
&gt;&gt;   <span class="red">puts "A pet ham! What are you, an elf?"</span>&#13;
&gt;&gt; <span class="red">when 'star monkey'</span>&#13;
&gt;&gt;   <span class="red">puts "I've always wanted one of those!"</span>&#13;
&gt;&gt; <span class="red">else</span>&#13;
&gt;&gt;   <span class="red">puts "A #{random_trinket}, huh? Never heard of it!"</span>&#13;
&gt;&gt; <span class="red">end</span>&#13;
Plastic cup's on the up and up!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p><a class="indexterm" id="iddle1140"/><a class="indexterm" id="iddle1398"/>Next up, we reminisced about Ruby’s <span class="emphasis"><em>implicit return</em></span>. Ruby methods automatically return the result of the last bit of code they evaluate, so these two methods do exactly the same thing:</p><a id="pro_id00401"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="red">def number_42?(number)</span>&#13;
&gt;&gt;   <span class="red">return number == 42</span>&#13;
&gt;&gt; <span class="red">end</span>&#13;
=&gt; nil&#13;
&#13;
&gt;&gt; <span class="red">number_42?(42)</span>&#13;
=&gt; true&#13;
&#13;
&gt;&gt; <span class="red">number_42?(43)</span>&#13;
=&gt; false&#13;
&#13;
&gt;&gt; <span class="red">def number_42?(number)</span>&#13;
&gt;&gt;   <span class="red">number == 42</span>&#13;
&gt;&gt; <span class="red">end</span>&#13;
=&gt; nil&#13;
&#13;
&gt;&gt; <span class="red">number_42?(42)</span>&#13;
=&gt; true&#13;
&#13;
&gt;&gt; <span class="red">number_42?(43)</span>&#13;
=&gt; false&#13;
</pre>&#13;
&#13;
      <p>Next, you found out that when we’re using variables that are Booleans (<code class="literal">true</code> or <code class="literal">false</code>), we can just return those variables directly instead of comparing them to <code class="literal">true</code> or <code class="literal">false</code> with <code class="literal">==</code>. This works:</p><a id="pro_id00402"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="red">def thing_true?(thing)</span>&#13;
&gt;&gt;   <span class="red">thing == true</span>&#13;
&gt;&gt; <span class="red">end</span>&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>But this does the exact same thing and uses a little less code:</p><a id="pro_id00403"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="red">def thing_true?(thing)</span>&#13;
&gt;&gt;   <span class="red">thing</span>&#13;
&gt;&gt; <span class="red">end</span>&#13;
=&gt; nil&#13;
&gt;&gt; <span class="red">the_truest_thing_ever = true</span>&#13;
=&gt; true&#13;
&#13;
&gt;&gt; <span class="red">thing_true?(the_truest_thing_ever)</span>&#13;
=&gt; true&#13;
</pre>&#13;
&#13;
      <p><a class="indexterm" id="iddle1313"/><a class="indexterm" id="iddle1316"/><a class="indexterm" id="iddle1602"/><a class="indexterm" id="iddle1896"/>In fact, we can get the <span class="emphasis"><em>truthiness</em></span> of any Ruby value by using two “not” symbols (<code class="literal">!</code>) in front of the object. A <span class="emphasis"><em>truthy</em></span> Ruby value will act like <code class="literal">true</code> in an <code class="literal">if</code> statement, and a <span class="emphasis"><em>falsey</em></span> one will act like <code class="literal">false</code>. All Ruby values are truthy except for <code class="literal">false</code> and <code class="literal">nil</code>. Truthy values run the code in the <code class="literal">if</code> statement:</p><a id="pro_id00404"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="red">if true</span>&#13;
&gt;&gt;   <span class="red">puts 'Woohoo!'</span>&#13;
&gt;&gt; <span class="red">end</span>&#13;
&#13;
Woohoo!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>And falsey ones don’t:</p><a id="pro_id00405"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="red">if false</span>&#13;
&gt;&gt;   <span class="red">puts 'A waltz.'</span>&#13;
&gt;&gt; <span class="red">end</span>&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>Nothing happens! Nothing happens with <code class="literal">nil</code>, either:</p><a id="pro_id00406"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="red">if nil</span>&#13;
&gt;&gt;   <span class="red">puts 'A dill (pickle).'</span>&#13;
&gt;&gt; <span class="red">end</span>&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>Since all values except <code class="literal">false</code> and <code class="literal">nil</code> are truthy, a regular string will be truthy in an <code class="literal">if</code> statement:</p><a id="pro_id00407"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="red">if 'fancy string'</span>&#13;
&gt;&gt;   <span class="red">puts 'For a fancy king!'</span>&#13;
&gt;&gt; <span class="red">end</span>&#13;
&#13;
For a fancy king!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p><a class="indexterm" id="iddle1418"/><a class="indexterm" id="iddle1444"/><a class="indexterm" id="iddle1570"/><a class="indexterm" id="iddle1642"/>You can always check the truthiness of a value in Ruby with <code class="literal">!!</code>:</p><a id="pro_id00408"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="red">!!nil</span>&#13;
=&gt; false&#13;
&#13;
&gt;&gt; <span class="red">!!'fancy string'</span>&#13;
=&gt; true&#13;
</pre>&#13;
&#13;
      <p>I also mentioned something you probably already knew in the back of your mind: giving good names to our constants, variables, and methods is important! See how much better the second method name is than the first?</p><a id="pro_id00409"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="red">def is_this_value_truthy?(value)</span>&#13;
&gt;&gt;   <span class="red">!!value</span>&#13;
&gt;&gt; <span class="red">end</span>&#13;
=&gt; nil&#13;
&#13;
&gt;&gt; <span class="red">def truthy?(value)</span>&#13;
&gt;&gt;   <span class="red">!!value</span>&#13;
&gt;&gt; <span class="red">end</span>&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>Last but not least, you saw that removing duplicated code and breaking our programs apart into small methods that do very specific jobs can make our Ruby code easier to write, understand, and change. The more code you read, the more you’ll see this is true, so don’t hesitate to ask your local adult to help you find snippets of Ruby code on the Internet to read through!</p>&#13;
&#13;
      <p>Speaking of bits of code, we’re about to see a fresh delivery of Ruby syntax when we follow the King, the Queen, Scarlet, Ruben, and Rusty down to the loading docks. The constant picking up and dropping off that occurs down there will be a perfect opportunity to explore Ruby <span class="emphasis"><em>input</em></span> and <span class="emphasis"><em>output</em></span>—also called <span class="emphasis"><em>I/O</em></span>—and we just might catch our first glimpse of the evil doers who have been turning this peaceful kingdom completely upside down.</p>&#13;
    </div>&#13;
  </div>&#13;
</body></html>