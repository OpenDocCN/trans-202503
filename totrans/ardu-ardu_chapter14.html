<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" lang="en" xml:lang="en">
<head>
<title>Arduino for Arduinians</title>
<meta content="text/html; charset=utf-8" http-equiv="default-style"/>
<link href="../styles/stylesheet.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:67118b6d-3178-4c1c-99a1-6e412fe74179" name="Adept.expected.resource"/>
</head>
<body epub:type="bodymatter">
<section aria-labelledby="ch14" epub:type="chapter" role="doc-chapter">
<header>
<h1 class="CHAPTER" id="ch14">
<span class="CN"><span aria-label=" Page 225. " epub:type="pagebreak" id="pg_225" role="doc-pagebreak"/><samp class="SANS_Futura_Std_Bold_Condensed_B_11">14</samp></span>
<span class="CT"><samp class="SANS_Dogma_OT_Bold_B_11">CONTROLLING THE ARDUINO WITH BLUETOOTH</samp></span>
</h1>
</header>
<figure class="opener"><img alt="" class="opener" src="../images/opener-img.png"/>
</figure>
<p class="INTRO">Most contemporary smartphones, PCs, or tablets can communicate wirelessly with other devices using Bluetooth. In this chapter, you’ll use inexpensive Bluetooth modules along with Windows, Android, or Apple machines to control your Arduino projects.</p>
<p class="TX">You’ll learn to:</p>
<ul class="ul">
<li class="BL">Use level converter boards with serial Bluetooth interface modules for voltage translation</li>
<li class="BL">Pair Bluetooth modules with Android-, Apple-, and Windows-based devices</li>
<li class="BL">Edit the parameters of a serial Bluetooth module</li>
</ul>
<p class="TX">You’ll also send data to and from an Arduino project via Bluetooth and then build your own Android app with the MIT App Inventor to remotely control your project.</p>
<section aria-labelledby="sec1" epub:type="division">
<h2 class="H1" id="sec1"><span id="h1-98"/><span aria-label=" Page 226. " epub:type="pagebreak" id="pg_226" role="doc-pagebreak"/><samp class="SANS_Futura_Std_Bold_B_11">Bluetooth Modules</samp></h2>
<p class="TNI">There are many types of Bluetooth modules. This chapter relies on the HC-05-type Bluetooth module, such as PMD Way part 590526, as shown in <a href="chapter14.xhtml#fig14-1">Figure 14-1</a>.</p>
<figure class="IMG"><img alt="A PHOTO OF THE HC-05 BLUETOOTH MODULE" class="img4" id="fig14-1" src="../images/fig14-1.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-1: An HC-05 Bluetooth module</samp></p></figcaption>
</figure>
<p class="TX">Other modules on the market like the HC-06 won’t work with the examples and projects in this chapter, as they can only transmit data, not receive it. These modules use a TX and RX line for serial communication between the module and your Arduino, which can be used with the SoftwareSerial library as usual. The data rate will default to 9,600 bps. I’ll explain how to set this up later in the chapter.</p>
<p class="TX">Physically wiring the modules to your Arduino projects is easy, thanks to the standard pin spacing at the end of the module, and pins are always labeled on the rear of the module. They will both operate using a 5 V DC power supply. However, the communication pins use a lower logic voltage of 3.3 V DC. The best way to convert 5 V to 3.3 V is to use a level converter module, which I’ll explain next.</p>
</section>
<section aria-labelledby="sec2" epub:type="division">
<h2 class="H1" id="sec2"><span id="h1-99"/><samp class="SANS_Futura_Std_Bold_B_11">Level Converter Modules</samp></h2>
<p class="TNI">Many devices have data communication pins designed to operate at 3.3 V instead of the usual 5 V DC. This can be for serial commutations such as Bluetooth modules or when using other data buses such as SPI or I<sup>2</sup>C. However, these pins do not work reliably with 5 V devices such as the Arduino Uno or compatible, so you’ll need to convert signals between 3.3 V and 5 V DC with a voltage converter board.</p>
<p class="TX">To do so, you can use a level converter module such as the one shown in <a href="chapter14.xhtml#fig14-2">Figure 14-2</a>, PMD Way part 441079.</p>
<figure class="IMG"><img alt="A PHOTO OF THE 5 TO 3.3 V LEVEL CONVERTER" class="img4" id="fig14-2" src="../images/fig14-2.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-2: A level converter module</samp></p></figcaption>
</figure>
<p class="TX">Most level converter modules include inline header pins, which you will need to solder to the board. Different level converters will have varying <span aria-label=" Page 227. " epub:type="pagebreak" id="pg_227" role="doc-pagebreak"/>number of channels; you need at least two channels for our Bluetooth devices, one for serial TX and one for serial RX.</p>
<p class="TX">All level converters require connections to both a 5 V and 3.3 V supply for operation. Simply connect the lower voltage device to the LV channels side of the level converter and connect the Arduino to the matching HV channels side. I’ll explain how to use the level converter in this chapter’s projects.</p>
<p class="TX">Before using a Bluetooth module with your PC or other device, you’ll need to pair the Bluetooth module with that device, as you would with Bluetooth headphones or speakers. For future reference and when working through this chapter, the following sections give instructions for pairing Windows PCs, Android devices, and macOS computers with the module that you can follow as required for the projects. Note that the LED on the Bluetooth module will blink slowly when successfully paired with any of these devices.</p>
<section aria-labelledby="sec3" epub:type="division">
<h3 class="H2" id="sec3"><span id="h2-18"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Pairing with Windows Devices</samp></h3>
<p class="TNI">The steps to pair the Bluetooth module with a Windows machine are similar to those for any other Bluetooth device, such as headphones or speakers. First ensure the module is connected to the 5V and GND pins for power. Once power is connected, the LED on the module will blink rapidly, meaning there’s no Bluetooth connection between the module and a device.</p>
<p class="TX">When using a Windows-based PC, simply search for a new Bluetooth device from the Bluetooth &amp; devices page in Settings. Select the HC-05 device in the list and you’ll be prompted for a PIN. Enter <b>1234</b>, click <b>Connect</b>, and you’re ready to go.</p>
<p class="TX">You can then send and receive data to the Bluetooth module via a COM: port address. These addresses can be found in the Windows Device Manager.</p>
<p class="TX">To continue, skip to the “<span class="Xref">Sending Data via Bluetooth</span>” section on <span class="Xref">page 228</span>.</p>
</section>
<section aria-labelledby="sec4" epub:type="division">
<h3 class="H2" id="sec4"><span id="h2-19"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Pairing with macOS Devices</samp></h3>
<p class="TNI">Open the System Preferences window from the Apple menu and select <b>Bluetooth</b>. Make sure Bluetooth is turned on, so that the computer begins to search for nearby devices.</p>
<p class="TX">Find HC-05 among the connection options and click <b>Connect</b>. In a moment, you should be shown a passkey error; that’s okay. Click <b>Options</b>, enter the PIN <b>1234</b>, and then click <b>Connect</b>.</p>
<p class="TX">After another moment, your Mac should pair with the Bluetooth module.</p>
<p class="TX">To continue, skip forward to the “<span class="Xref">Sending Data via Bluetooth</span>” section on <span class="Xref">page 228</span>.</p>
</section>
<section aria-labelledby="sec5" epub:type="division">
<h3 class="H2" id="sec5"><span id="h2-20"/><span aria-label=" Page 228. " epub:type="pagebreak" id="pg_228" role="doc-pagebreak"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Pairing with Android Devices</samp></h3>
<p class="TNI">The steps to pair the Bluetooth module with an Android are similar to those for any other Bluetooth device, such as headphones or speakers. Turn on Bluetooth on your Android device, search for a new device, and then tap the listing for <b>HC-05</b>. You should be prompted for the PIN. Enter <b>1234</b> to pair your module.</p>
<p class="TX">Now that you’ve paired your module with an Android or computer, I’ll show you how to send data from your Arduino via Bluetooth.</p>
</section>
</section>
<section aria-labelledby="sec6" epub:type="division">
<h2 class="H1" id="sec6"><span id="h1-100"/><samp class="SANS_Futura_Std_Bold_B_11">Sending Data via Bluetooth</samp></h2>
<p class="TNI">The Bluetooth module is a serial device, and you can easily send data out using the SoftwareSerial library. Let’s test this now.</p>
<p class="TX">You’ll need the following parts for this project:</p>
<ul class="ul">
<li class="BL">An Arduino Uno or compatible board and USB cable</li>
<li class="BL">A solderless breadboard</li>
<li class="BL">A level converter module</li>
<li class="BL">Various jumper wires</li>
<li class="BL">An HC-05 Bluetooth module</li>
</ul>
<p class="TX">Assemble the circuit as shown in <a href="chapter14.xhtml#fig14-3">Figure 14-3</a>.</p>
<figure class="IMG"><img alt="THE SCHEMATIC FOR CONNECTION OF THE BLUETOOTH MODULE TO THE ARDUINO VIA A LEVEL CONVERTER" class="img5" id="fig14-3" src="../images/fig14-3.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-3: The schematic for connecting a Bluetooth module to Arduino via a level converter</samp></p></figcaption>
</figure>
<p class="TX">Now enter and upload <a href="#LiT-14-1">Listing 14-1</a>.</p>
<span id="LiT-14-1"/>

<pre><code><span aria-label="annotation1" class="CodeAnnotationHang">❶</span> #define PIN_BT_TX 3
#define PIN_BT_RX 2
#include &lt;SoftwareSerial.h&gt;
SoftwareSerial BT(PIN_BT_RX, PIN_BT_TX);
void setup()
{
    // Set the data rate for the SoftwareSerial port:
  <span aria-label="annotation2" class="CodeAnnotationHang1">❷</span> BT.begin(9600);
    // Send test message to other device:
}

void loop()
{
    BT.print("millis = ");
    BT.println(millis());
    delay(500);
}
</code></pre>

<span aria-label=" Page 229. " epub:type="pagebreak" id="pg_229" role="doc-pagebreak"/>
<p class="CodeListingCaption"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Listing 14-1: Testing the Bluetooth output</samp></p>
<p class="TX">Sketch operation is simple. Since the Bluetooth module is a serial data device, the sketch configures it to use a software serial port defined on pins D2 and D3 <span aria-label="annotation1" class="CodeAnnotationCode">❶</span>. The sketch then starts the software serial port <span aria-label="annotation2" class="CodeAnnotationCode">❷</span> and uses the <samp class="SANS_TheSansMonoCd_W5Regular_11">print()</samp> and <samp class="SANS_TheSansMonoCd_W5Regular_11">println()</samp> functions to send the data out via the module. The LED will blink twice around every five seconds when there’s a data connection between it and another device.</p>
<p class="TX">You now need to select a method to receive the data being sent from the Arduino via Bluetooth. I’ll show you how to do this with a PC, a macOS computer, and an Android device. Follow the instructions for all the platforms you have available to you.</p>
<section aria-labelledby="sec7" epub:type="division">
<h3 class="H2" id="sec7"><span id="h2-21"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">To Windows Devices</samp></h3>
<p class="TNI">To receive Arduino data on your Bluetooth-enabled PC, you can use any terminal software that can communicate using a COM: port. For this chapter, I suggest using the CoolTerm software by Roger Meier, available from <a href="http://freeware.the-meiers.org"><i>http://<wbr/>freeware<wbr/>.the<wbr/>-meiers<wbr/>.org</i></a>.</p>
<p class="TX">Once you’ve installed CoolTerm, use the Options menu to select the appropriate COM: port and click <b>Connect</b>. After a few moments, the data from the Arduino should scroll down the window, as shown in <a href="chapter14.xhtml#fig14-4">Figure 14-4</a>.</p>
<figure class="IMG"><img alt="SCREENSHOTS OF THE OUTPUT FROM LISTING 14-1 ON A WINDOWS PC" class="img5" id="fig14-4" src="../images/fig14-4.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-4: Example output of <a href="#LiT-14-1">Listing 14-1</a> on a PC terminal</samp></p></figcaption>
</figure>
<p class="TX">Now that you can receive Arduino data on your Windows device, skip to Project #41 to put this capability to use.</p>
</section>
<section aria-labelledby="sec8" epub:type="division">
<h3 class="H2" id="sec8"><span id="h2-22"/><span aria-label=" Page 230. " epub:type="pagebreak" id="pg_230" role="doc-pagebreak"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">To macOS Devices</samp></h3>
<p class="TNI">To receive the data on your Bluetooth-enabled Mac, you can use any terminal software that can communicate using a COM: port. For this chapter, I suggest using the CoolTerm software by Roger Meier available from <a href="http://freeware.the-meiers.org"><i>http://<wbr/>freeware<wbr/>.the<wbr/>-meiers<wbr/>.org</i></a>.</p>
<p class="TX">Once you’ve installed CoolTerm, you may be presented with a macOS security error when trying to run the software. To get around this, locate the CoolTerm icon in the Applications folder, right-click it, and select <b>Open</b>; you may need to click <b>Open Anyway</b> in the Privacy and Security tab in the macOS System Preferences. Afterward, CoolTerm should run as normal when you use it in future.</p>
<p class="TX">Once you’ve resolved the error, the data from the Arduino should begin to scroll down the terminal window, as shown in <a href="chapter14.xhtml#fig14-5">Figure 14-5</a>.</p>
<figure class="IMG"><img alt="SCREENSHOTS OF THE OUTPUT FROM LISTING 14-1 ON A MACOS COMPUTER" class="img5" id="fig14-5" src="../images/fig14-5.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-5: Example output of <a href="#LiT-14-1">Listing 14-1</a> on a macOS computer</samp></p></figcaption>
</figure>
<p class="TX">Next, move on to Project #41 to put this capability to use.</p>
</section>
<section aria-labelledby="sec9" epub:type="division">
<h3 class="H2" id="sec9"><span id="h2-23"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">To Android Devices</samp></h3>
<p class="TNI">On your Android device, find the Bluetooth Terminal HC-05 app in the Google Play store and download it. Once you install and open the terminal app, it should prompt you with a list of paired Bluetooth devices. Select <b>HC-05</b>. Once the connection is complete, the terminal should display the <samp class="SANS_TheSansMonoCd_W5Regular_11">millis()</samp> values from the Arduino in the terminal app window. <a href="chapter14.xhtml#fig14-6">Figure 14-6</a> demonstrates this sequence.</p>
<figure class="IMG"><img alt="SCREENSHOTS OF THE OUTPUT FROM LISTING 14-1 ON AN ANDROID DEVICE" class="img8" id="fig14-6" src="../images/fig14-6.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-6: Example output of <a href="#LiT-14-1">Listing 14-1</a> on an Android device</samp></p></figcaption>
</figure>
<p class="TX"><span aria-label=" Page 231. " epub:type="pagebreak" id="pg_231" role="doc-pagebreak"/>Now that you can receive Arduino data on your Android device, move on to Project #41 to put this capability to use.</p>
<p class="TX">You’ll use your new ability to view data from the Arduino on your device in the following project.</p>
<p class="HeadProject"><span id="h1-101"/><samp class="SANS_Futura_Std_Heavy_B_21">Project #41: Capturing Data for Real-Time Monitoring</samp></p>
<p class="TNI">In this project, using the BMP180 temperature and air pressure sensor introduced in <span class="Xref"><a href="chapter10.xhtml">Chapter 10</a></span>, you’ll build a system to monitor data using the Arduino and the Bluetooth module you just set up. You can use this type of data capture with a smartphone for real-time monitoring if you need to stay mobile in your area or with a PC running CoolTerm for recording and analysis. You can also try both if you have both devices available.</p>
<p class="TX">You’ll need the following parts for this project:</p>
<ul class="ul">
<li class="BL">An Arduino Uno or compatible board and USB cable</li>
<li class="BL">A solderless breadboard</li>
<li class="BL">A level converter module</li>
<li class="BL">Various jumper wires</li>
<li class="BL">An HC-05 Bluetooth module</li>
<li class="BL">A BMP180 temperature and air pressure sensor board</li>
</ul>
<p class="TX">Next, assemble the circuit as shown in <a href="chapter14.xhtml#fig14-7">Figure 14-7</a>.</p>
<figure class="IMG"><img alt="THE SCHEMATIC FOR PROJECT #41" class="img8" id="fig14-7" src="../images/fig14-7.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-7: The schematic for Project #41</samp></p></figcaption>
</figure>
<p class="TX">Now enter and upload the Project #41 sketch. Next, open the terminal app on your Android device or Windows or Mac machine and connect to the Bluetooth module as described in the previous section. You should begin to see the temperature and air pressure displayed, as shown in <a href="chapter14.xhtml#fig14-8">Figure 14-8</a>.<span aria-label=" Page 232. " epub:type="pagebreak" id="pg_232" role="doc-pagebreak"/></p>
<figure class="IMG"><img alt="A SCREENSHOT OF THE OUTPUT FROM PROJECT #41 ON AN ANDROID DEVICE" class="img6" id="fig14-8" src="../images/fig14-8.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-8: Example output from Project #41</samp></p></figcaption>
</figure>
<p class="TX">Let’s see how this works:</p>
<span id="pro-41"/>

<pre><code>// Project #41 - Capturing Data via Bluetooth

<span aria-label="annotation1" class="CodeAnnotationHang">❶</span> #define PIN_BT_TX 3
#define PIN_BT_RX 2
#include &lt;SoftwareSerial.h&gt;
#include "Wire.h"
#include "Adafruit_BMP085.h"
SoftwareSerial BT(PIN_BT_RX, PIN_BT_TX);
Adafruit_BMP085 bmp;

<span aria-label="annotation2" class="CodeAnnotationHang">❷</span> int temperature;
int pressure;

void setup()
{
    // Set the data rate for the SoftwareSerial port:
  <span aria-label="annotation3" class="CodeAnnotationHang1">❸</span> BT.begin(9600);
    bmp.begin();
}

void loop()
{
  <span aria-label="annotation4" class="CodeAnnotationHang1">❹</span> BT.print("Temperature = ");
    temperature = bmp.readTemperature();
    BT.print(temperature);
    BT.print(" degrees C");
    BT.print(" Pressure = ");
  <span aria-label="annotation5" class="CodeAnnotationHang1">❺</span> BT.print(int(bmp.readPressure() / 100));
    BT.println(" hPa");
    delay(1000);
}
</code></pre>

<p class="TX">This sketch combines reading data from the BMP180, neatly formatting the data, and sending it to the Bluetooth module. The sketch includes and configures the required libraries <span aria-label="annotation1" class="CodeAnnotationCode">❶</span> and then declares two variables <span aria-label="annotation2" class="CodeAnnotationCode">❷</span> to store the temperature and air pressure data. It starts the software serial connection and BMP180 sensor <span aria-label="annotation3" class="CodeAnnotationCode">❸</span> and sends out the temperature data <span aria-label="annotation4" class="CodeAnnotationCode">❹</span>. The pressure readings from the BMP180 are converted from pascals to hectopascals <span aria-label="annotation5" class="CodeAnnotationCode">❺</span> and then sent out as well.</p>
<p class="TX"><span aria-label=" Page 233. " epub:type="pagebreak" id="pg_233" role="doc-pagebreak"/>Now that the data is being sent out via Bluetooth, you can capture it to a text file using the CoolTerm software. If you have a device connected to the project, disconnect it, and then connect your macOS or Windows PC as described in the previous section. Open CoolTerm and connect. The data should be shown in the terminal window, as in <a href="chapter14.xhtml#fig14-9">Figure 14-9</a>.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF THE OUTPUT FROM PROJECT #41 ON A WINDOWS PC" class="img7" id="fig14-9" src="../images/fig14-9.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-9: Example output displayed on a PC</samp></p></figcaption>
</figure>
<p class="TX">Press <small>CTRL</small>-R to open the Capture to Text File dialog, enter a filename, select a location, and click <b>Save</b>. All the data from the Arduino should be written to the text file. When you’re finished, press <small>CTRL</small>-<small>SHIFT</small>-R to stop and finalize the text file.</p>
<p class="TX">You can now open the text file in a spreadsheet such as Microsoft Excel, as shown in <a href="chapter14.xhtml#fig14-10">Figure 14-10</a>, using space as the delimiter during the import process. Your data is now ready for analysis.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF THE OUTPUT FROM PROJECT #41 IN AN EXCEL SPREADSHEET" class="img7" id="fig14-10" src="../images/fig14-10.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-10: The captured data in Excel</samp></p></figcaption>
</figure>
<p class="TX">The ease of working with any data sent from your Arduino will depend on how it’s formatted for transmission. However, you now have a wireless option for capturing any data your Arduino projects can generate and transforming the data into a user-friendly format.</p>
<p class="TX">Furthermore, by using either a smartphone and a terminal app or a laptop computer with Bluetooth, you can create a walk-up monitoring system for various devices rather than going to the expense of building a display system for the local data. Just bring your computer or Android phone within range of your Bluetooth Arduino project and connect to the project to monitor the data readings. With this technique, you can create secure data transmission known only to yourself, monitoring it with your devices rather than displaying it for anyone to see.</p>
<p class="TX"><span aria-label=" Page 234. " epub:type="pagebreak" id="pg_234" role="doc-pagebreak"/>In the next project, you’ll learn to send data to and from the Arduino and another device by creating a Bluetooth remote-controlled project.</p>
<p class="HeadProject"><span id="h1-102"/><samp class="SANS_Futura_Std_Heavy_B_21">Project #42: Using Bluetooth for Digital I/O Control</samp></p>
<p class="TNI">Like any external serial device, the Bluetooth module can both send and receive data, allowing you to send data to your Arduino for various purposes. With this project, you’ll make a simple remote control for LEDs connected to four digital pins, which will serve as a framework for your own wireless remote-control projects.</p>
<p class="TX">You’ll need the following parts for this project:</p>
<ul class="ul">
<li class="BL">An Arduino Uno or compatible board and USB cable</li>
<li class="BL">A solderless breadboard</li>
<li class="BL">A level converter module</li>
<li class="BL">Various jumper wires</li>
<li class="BL">An HC-05 Bluetooth module</li>
<li class="BL">Four LEDs</li>
<li class="BL">Four 1 kΩ, 0.25 W, 1 percent resistors</li>
</ul>
<p class="TX">Assemble the circuit as shown in <a href="chapter14.xhtml#fig14-11">Figure 14-11</a>. Once you’re finished with this project, keep the circuit assembled, as you’ll use it in the following project.</p>
<figure class="IMG"><img alt="THE SCHEMATIC FOR PROJECT #42" class="img7" id="fig14-11" src="../images/fig14-11.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-11: The schematic for Project #42</samp></p></figcaption>
</figure>
<p class="TX">Enter and upload the Project #42 sketch and then open the terminal app on your Android device or computer and connect to the Bluetooth module. Send a question mark (<samp class="SANS_TheSansMonoCd_W7Bold_B_11">?</samp>) with the terminal app, and the Arduino should respond with a quick control summary.</p>
<p class="TX">You can also send a 0, 1, 2, or 3 to turn on digital pins D8 to D11, respectively. To turn them off, send 4, 5, 6, or 7, respectively. After each command, the Arduino will return it as confirmation. <a href="chapter14.xhtml#fig14-12">Figure 14-12</a> shows this output in the Android terminal app.<span aria-label=" Page 235. " epub:type="pagebreak" id="pg_235" role="doc-pagebreak"/></p>
<figure class="IMG"><img alt="A SCREENSHOT OF CONTROLLING PROJECT #42 ON AN ANDROID DEVICE" class="img5" id="fig14-12" src="../images/fig14-12.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-12: Controlling Project #42 from an Android phone</samp></p></figcaption>
</figure>
<p class="TX">As with the previous project, you can use the Bluetooth-equipped computer for the same control methods, as shown in <a href="chapter14.xhtml#fig14-13">Figure 14-13</a>.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF CONTROLLING PROJECT #42 ON A WINDOWS PC" class="img7" id="fig14-13" src="../images/fig14-13.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-13: Controlling Project #42 from a PC</samp></p></figcaption>
</figure>
<p class="TX">Let’s see how this works:</p>
<span id="pro-42"/>

<pre><code>// Project 42 - Digital I/O control with Android and Bluetooth

<span aria-label="annotation1" class="CodeAnnotationHang">❶</span> #define PIN_BT_TX 3
#define PIN_BT_RX 2
#include &lt;SoftwareSerial.h&gt;
SoftwareSerial BT(PIN_BT_RX, PIN_BT_TX);
void sendHelp()
{
    BT.println("Send 0~3 to turn on D8~11");
    BT.println("Send 4~7 to turn off D8~11");
}

void setup()
{
    // Set digital pin to control as an output:
  <span aria-label="annotation2" class="CodeAnnotationHang1">❷</span> DDRB = B111111;
    // Set the data rate for the SoftwareSerial port:
<span aria-label=" Page 236. " epub:type="pagebreak" id="pg_236" role="doc-pagebreak"/>  <span aria-label="annotation3" class="CodeAnnotationHang1">❸</span> BT.begin(9600);
    // Send test message to other device:
    BT.println("Hello from Arduino");
}

void loop()
{
  <span aria-label="annotation4" class="CodeAnnotationHang1">❹</span> char a; // Stores incoming character from other device
    if (BT.available())
    {
      <span aria-label="annotation5" class="CodeAnnotationHang1">❺</span> a = (BT.read());
        if (a == '0') {digitalWrite(8, HIGH); BT.println("D8 on");   }
        if (a == '1') {digitalWrite(9, HIGH); BT.println("D9 on");   }
        if (a == '2') {digitalWrite(10, HIGH); BT.println("D10 on");}
        if (a == '3') {digitalWrite(11, HIGH); BT.println("D11 on");}
        if (a == '4') {digitalWrite(8, LOW); BT.println("D8 off");   }
        if (a == '5') {digitalWrite(9, LOW); BT.println("D9 off");   }
        if (a == '6') {digitalWrite(10, LOW); BT.println("D10 off");}
        if (a == '7') {digitalWrite(11, LOW); BT.println("D11 off");}
      <span aria-label="annotation6" class="CodeAnnotationHang1">❻</span> if (a == '?') {sendHelp();}
    }
}
</code></pre>

<p class="TX">The software serial port for the Bluetooth module is first set up <span aria-label="annotation1" class="CodeAnnotationCode">❶</span>. The custom function <samp class="SANS_TheSansMonoCd_W5Regular_11">sendHelp()</samp> sends out the instructions when the user sends a question mark to the Arduino. The sketch sets the digital output pins for D13 to D8 to outputs <span aria-label="annotation2" class="CodeAnnotationCode">❷</span> and starts the software serial connection <span aria-label="annotation3" class="CodeAnnotationCode">❸</span>. It also declares the character variable used to store the incoming command from Bluetooth <span aria-label="annotation4" class="CodeAnnotationCode">❹</span>.</p>
<p class="TX">When a character is received from the Bluetooth module, it’s stored into the character variable <samp class="SANS_TheSansMonoCd_W5Regular_11">a</samp> <span aria-label="annotation5" class="CodeAnnotationCode">❺</span>; a series of <samp class="SANS_TheSansMonoCd_W5Regular_11">if</samp> functions then convert the character into the required actions. Along with turning digital pins on or off, a message is sent out to confirm that the command has taken place. If the Arduino receives a question mark, the sketch calls the <samp class="SANS_TheSansMonoCd_W5Regular_11">sendHelp()</samp> function <span aria-label="annotation6" class="CodeAnnotationCode">❻</span>, which tells the user how to operate the project.</p>
<p class="TX">You can use this project’s remote-control framework in your own future work to keep controls out of the public view, by using Bluetooth on an Android phone or a computer rather than a control panel. You can also modify this project to control the relay board described in <span class="Xref">Project #26</span> in <span class="Xref"><a href="chapter8.xhtml">Chapter 8</a></span>.</p>
<p class="TX">You’ll now make your own smartphone app to control this project to make it more user-friendly.</p>
<p class="HeadProject"><span id="h1-103"/><samp class="SANS_Futura_Std_Heavy_B_21">Project #43: Using an Android App for Bluetooth Control</samp></p>
<p class="TNI">Controlling the Arduino digital outputs with the terminal app on an Android device is simple enough for you, the creator. When others need to control the output, however, a custom Android smartphone app is preferable, as it insulates the end user from any chances of incorrect usage. <span aria-label=" Page 237. " epub:type="pagebreak" id="pg_237" role="doc-pagebreak"/>Instead of writing the code for such an app from scratch, in this project I’ll show you how to create your own Android app to control the hardware in Project #42 using the free MIT App Inventor, an online service provided by Google and the Massachusetts Institute of Technology.</p>
<blockquote>
<p class="NOTE"><span class="NoteHead"><samp class="SANS_Dogma_OT_Bold_B_21">NOTE</samp></span></p>
</blockquote>
<p class="NOTE-TXT"><i>You can use the MIT App Inventor website on Windows, macOS, or Linux, but the resulting app will run only on an Android device.</i></p>
<p class="TX"><a href="chapter14.xhtml#fig14-14">Figure 14-14</a> shows what your complete app interface will look like, showing buttons to connect the Android phone or tablet to the project via Bluetooth and then turn the Arduino digital outputs D8 to D11 on or off.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF PROJECT #43 IN THE ANDROID APP" class="img6" id="fig14-14" src="../images/fig14-14.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-14: The completed Android App to control Project #42</samp></p></figcaption>
</figure>
<p class="TX">The process of building your own app involves two main stages. The first revolves around the design of the app, such as location of buttons and text on the display. The second stage involves determining what actions the app takes in response to user input or interactions with the hardware. With the MIT App Inventor, each stage involves a drag-and-drop process of moving items into place to build the app interface and operational instructions. I’ll show you how to navigate the process to create your app.</p>
<p class="TX">The hardware for this project is identical to that in Project #42. Once you have set up the circuit for that project, visit the MIT App Inventor website at <a href="https://appinventor.mit.edu"><i>https://<wbr/>appinventor<wbr/>.mit<wbr/>.edu</i></a>. Click the <b>Create Apps</b> button at the top of the home page. A new window should appear and ask you to log in with a Google account. You will need to create a Google account if you don’t have one.</p>
<p class="TX">Once you’ve logged in and agreed to the terms of service, a welcome screen should appear. Click <b>Start a Blank Project</b> and enter a project name when prompted. I’ve named mine Project42, but you can choose whatever name you like. This will also be the name of the app when you later download it to your Android device. Note that you can save and load your progress as with any other editor using the Projects menu at the top of the screen.</p>
<p class="TX">Your screen should now look like the one in <a href="chapter14.xhtml#fig14-15">Figure 14-15</a>, with a blank phone screen and various menus.<span aria-label=" Page 238. " epub:type="pagebreak" id="pg_238" role="doc-pagebreak"/></p>
<figure class="IMG"><img alt="A SCREENSHOT OF THE MIT APP INVENTOR WEBSITE" class="img6" id="fig14-15" src="../images/fig14-15.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-15: The Android app to control Project #42</samp></p></figcaption>
</figure>
<p class="TX">You’ll start building the interface from top to bottom, beginning with the header text. On the left of the display is the Palette. Click <b>User Interface</b>, which reveals various interface options. Place the mouse pointer over <b>Label</b>, and then click and drag it into the display of the phone, as shown in <a href="chapter14.xhtml#fig14-16">Figure 14-16</a>.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF ADDING THE APP LABEL IN APP INVENTOR" class="img7" id="fig14-16" src="../images/fig14-16.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-16: Building a label</samp></p></figcaption>
</figure>
<p class="TX">To edit the label, click the <b>Label1</b> entry in the Components windows to the right of the phone. This should allow you to edit the properties of the label using the Properties window on the right side of the screen, shown in <a href="chapter14.xhtml#fig14-17">Figure 14-17</a>.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF THE LABEL PROPERTIES WINDOW IN APP INVENTOR" class="img5" id="fig14-17" src="../images/fig14-17.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-17: The label properties</samp></p></figcaption>
</figure>
<p class="TX">Turn on <b>FontBold</b>, set the size to <b>28</b>, and enter <b>Bluetooth GPIO Control</b> into the text field. These changes should take place immediately and be reflected in the phone display in the center of the screen, as shown in <a href="chapter14.xhtml#fig14-18">Figure 14-18</a>.<span aria-label=" Page 239. " epub:type="pagebreak" id="pg_239" role="doc-pagebreak"/></p>
<figure class="IMG"><img alt="A SCREENSHOT OF THE COMPLETED APP LABEL IN APP INVENTOR" class="img5" id="fig14-18" src="../images/fig14-18.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-18: The completed label</samp></p></figcaption>
</figure>
<p class="TX">Notice that when you add an item to the phone display, it appears in the Components list on the right. Clicking that item in the list allows you to edit its properties in the Properties box on the far right. You’ll use this feature in a moment.</p>
<p class="TX">Next, you’ll start adding the buttons to the app. The first button will activate the Bluetooth connection menu on the phone. To add this button, click and drag <b>ListPicker</b> from the User Interface list on the left of the web page into the phone display. Then click <b>ListPicker</b> in the Components list and edit the properties to the right. Change the text field to <b>Connect to BT</b>. Your button should now resemble that shown in <a href="chapter14.xhtml#fig14-19">Figure 14-19</a>.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF ADDING THE BUTTON TO THE APP IN APP INVENTOR" class="img5" id="fig14-19" src="../images/fig14-19.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-19: The completed button</samp></p></figcaption>
</figure>
<p class="TX">Now it’s time to ensure everything is centered in the display. Click <b>Screen1</b> in the Components list and change the AlignHorizontal setting to <b>Center</b>. The items on the display should now be aligned in the center, as shown in <a href="chapter14.xhtml#fig14-20">Figure 14-20</a>.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF THE CENTERED BUTTON IN APP INVENTOR" class="img5" id="fig14-20" src="../images/fig14-20.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-20: The items are now centered.</samp></p></figcaption>
</figure>
<p class="TX">Next, you’ll create a table of eight buttons, one to turn on and off each of the four digital output pins. Click the <b>Layout</b> list in the Palette and then drag <b>TableArrangement</b> into the display. This should leave a box below the <span aria-label=" Page 240. " epub:type="pagebreak" id="pg_240" role="doc-pagebreak"/>connect button, as shown in <a href="chapter14.xhtml#fig14-21">Figure 14-21</a>. Also change the number of rows in the TableArrangement properties to four.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF ADDING A TABLE TO THE APP IN APP INVENTOR" class="img5" id="fig14-21" src="../images/fig14-21.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-21: The table has been inserted.</samp></p></figcaption>
</figure>
<p class="TX">Now for the buttons: click and drag eight buttons from the User Interface list on the left into the gray table in the phone display. Thanks to TableArrangement, you can easily arrange them in four rows of two columns, as shown in <a href="chapter14.xhtml#fig14-22">Figure 14-22</a>.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF ADDING BUTTONS TO THE APP IN APP INVENTOR" class="img5" id="fig14-22" src="../images/fig14-22.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-22: Working with the buttons</samp></p></figcaption>
</figure>
<p class="TX">Click <b>Button2</b> in the Components list and change the text to <b>D8 On</b>. Work through each of the other seven buttons, changing their text properties, until they match the buttons in <a href="chapter14.xhtml#fig14-23">Figure 14-23</a>.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF THE COMPLETED BUTTONS IN APP INVENTOR" class="img5" id="fig14-23" src="../images/fig14-23.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-23: The buttons are now complete.</samp></p></figcaption>
</figure>
<p class="TX"><span aria-label=" Page 241. " epub:type="pagebreak" id="pg_241" role="doc-pagebreak"/>To make the buttons easier to work with in the later steps of app development, rename the buttons in the Components window: click each button in turn, click <b>Rename</b>, and change the name of the button to its function. For example, change the name of Button2 to <b>D8 On</b>, as shown in <a href="chapter14.xhtml#fig14-24">Figure 14-24</a>.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF EDITING THE BUTTON REFERENCES IN APP INVENTOR" class="img6" id="fig14-24" src="../images/fig14-24.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-24: Editing the button references</samp></p></figcaption>
</figure>
<p class="TX">Next, we need to add a reference to Bluetooth. This is a virtual link between the app and the phone’s Bluetooth hardware. Click the <b>Connectivity</b> tab in the Palette, drag <b>BluetoothClient</b> into the main window, and place it on top of the phone. The Bluetooth icon should appear below the phone, as shown in <a href="chapter14.xhtml#fig14-25">Figure 14-25</a>.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF ADDING THE BLUETOOTH LINK TO THE APP IN APP INVENTOR" class="img3" id="fig14-25" src="../images/fig14-25.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-25: Bluetooth added to the app design</samp></p></figcaption>
</figure>
<p class="TX">Finally, you can edit the text in the top line of the app or remove it by editing the Screen1 item in the Components menu. To change the name of the app to something more useful or interesting to your needs, edit the title field that appears at the bottom of the Properties window, or uncheck the <b>TitleVisible</b> box if you don’t want to show the app’s title.</p>
<p class="TX">At this point, you’ve created the app design and interface in the Designer window. You’ll now begin the second stage of the app design: determining what actions the app will take upon user interaction. Start by clicking the <b>Blocks</b> button at the top right of the display, as shown in <a href="chapter14.xhtml#fig14-26">Figure 14-26</a>.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF SWITCHING TO THE BLOCKS EDITOR PAGE IN APP INVENTOR" class="img3" id="fig14-26" src="../images/fig14-26.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-26: Switching to the Blocks editor</samp></p></figcaption>
</figure>
<p class="TX">In MIT App Inventor, the Designer screen is used to build the user interface of your app and the Blocks page is used to build the code that defines how the app works. Instead of writing code, you can use the Blocks editor page to drag and drop various “blocks” together to form sequences <span aria-label=" Page 242. " epub:type="pagebreak" id="pg_242" role="doc-pagebreak"/>of instructions or activates based on user input. Each block represents a type of instruction, a function, or an activity. You can move between the two design screens by alternating between the <b>Designer</b> and <b>Blocks</b> buttons.</p>
<p class="TX">I’ll now show you how to create the required block structure to enable app operation. In the Blocks editor page, click <b>ListPicker1</b> in the Blocks menu. A list of blocks will appear, some of which are shown in <a href="chapter14.xhtml#fig14-27">Figure 14-27</a>.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF VARIOUS CONTROL BLOCKS IN APP INVENTOR" class="img7" id="fig14-27" src="../images/fig14-27.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-27: Various blocks</samp></p></figcaption>
</figure>
<p class="TX">Drag and drop the <b>when ListPicker1 BeforePicking</b> block from the <b>Blocks</b> menu on the left into the Viewer window. Once again, click <b>ListPicker1</b> in the Blocks menu and then drag and drop a <b>set ListPicker1 elements to</b> block into the <b>when</b> block from the previous step. It should click into the <b>when</b> block.</p>
<p class="TX">To delete an unwanted block during this process, simply drag it over the garbage can at the bottom right of the Viewer window.</p>
<p class="TX">Next, click the <b>BluetoothClient1</b> item in the Blocks menu and drag the <b>BluetoothClient1 AddressesAndNames</b> item so it clicks into the last added item.</p>
<p class="TX">You now need to create the set of instructions to connect to the selected Bluetooth device as selected by the user. Assemble the blocks together. You can find the <b>if then</b> block in the Control section of the Blocks menu.</p>
<p class="TX">Now you need to configure the operations for each of the eight control buttons. To mirror the way Project #42 controlled the LEDs, you want the app to send a 0 through 3 to turn on D8 to D11, respectively, and send a 4 through 7 to turn them off. Click the <b>D8</b> button in the TableArrangement1 list in the Blocks menu and then drag and drop a <b>when D8_On.click</b> block into the viewer window.</p>
<p class="TX">Drag and drop <b>call BluetoothClient1. SendText text</b> block from the BluetoothClient1 list into the <b>when</b> block.</p>
<p class="TX">To complete the button action group, click the <b>Math</b> item in the Blocks menu and drag the first block (which just holds a 0) into the notch to the right of the word <b>text</b>.</p>
<p class="TX"><span aria-label=" Page 243. " epub:type="pagebreak" id="pg_243" role="doc-pagebreak"/>This group of blocks will activate when the user presses the button D8 On; this will send the text character 0 out via Bluetooth.</p>
<p class="TX">You’ll need to create another seven of these groups so that you end up with eight in total to match the buttons. To save time, you can right-click over the first block in a group and select <b>Duplicate</b> to repeat the group you’re editing. The other groups must refer to different buttons. Click the <b>D8_ON</b> and a list of all the available buttons should drop down, as shown in <a href="chapter14.xhtml#fig14-28">Figure 14-28</a>.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF ADDING A DIGITAL PIN REFERENCE TO CONTROL THE BLOCK IN APP INVENTOR" class="img4" id="fig14-28" src="../images/fig14-28.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-28: The button group selection</samp></p></figcaption>
</figure>
<p class="TX">Ensure you have changed this setting in each of the eight button groups to match the eight buttons and then change the value of the text character being sent for the rest of the buttons. That is, pressing D8 off should send 4, D9 on should send 1, and so on. You can just click over the 0 in each group and enter a new value. When you’ve finished, your screen should resemble that shown in <a href="chapter14.xhtml#fig14-29">Figure 14-29</a>.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF THE COMPLETED BUTTON CONTROL BLOCKS IN APP INVENTOR" class="img5" id="fig14-29" src="../images/fig14-29.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-29: The completed control block groups</samp></p></figcaption>
</figure>
<p class="TX">Your app is now complete and ready for installation on your Android phone or tablet. Save your project using the Projects menu (in case you want to alter it later) and then select <b>Android App (.apk)</b> in the Build menu. The App Inventor should compile the instructions and, after a minute or two, present you with a download button and QR code, as shown in <a href="chapter14.xhtml#fig14-30">Figure 14-30</a>.<span aria-label=" Page 244. " epub:type="pagebreak" id="pg_244" role="doc-pagebreak"/></p>
<figure class="IMG"><img alt="A SCREENSHOT OF THE APP DOWNLOAD PAGE IN APP INVENTOR" class="img4" id="fig14-30" src="../images/fig14-30.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-30: Download your app!</samp></p></figcaption>
</figure>
<p class="TX">You can then download and save the app’s <i>.apk</i> file to load it onto your device or just scan the QR code with your device’s camera. When prompted, visit the URL decoded from the image and go through the download and installation prompts. Click <b>Yes</b> or <b>Agree</b> to any dialogs that Android may produce.</p>
<p class="TX">At long last, your app should pop up. Drag it onto the home screen, as shown in <a href="chapter14.xhtml#fig14-31">Figure 14-31</a>.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF THE APP ICON ON AN ANDROID PHONE" class="img4" id="fig14-31" src="../images/fig14-31.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-31: Your app installed on a phone</samp></p></figcaption>
</figure>
<p class="TX">Congratulations! You’ve made an Android app. Now to give it a test: ensure you have the Project #42 hardware correctly wired up and then open your app. Turn on your device’s Bluetooth function and then touch the app’s <b>Connect to BT</b> button. You should be presented with a list of paired Bluetooth devices. Select the HC-05 listing, and the app should return to the main page.</p>
<p class="TX">You should now be able to press each button to turn on or off the digital output pins on the Arduino, with the LEDs reflecting the Arduino’s status. If the app isn’t working, first go back to Project #42 and ensure that the hardware can be controlled via the terminal app or a Bluetooth-enabled PC. Failing that, review the app setup in the App Inventor. You can also download the AI project file in the <i>Project #43</i> folder of the downloadable files on the book web page, <a href="https://nostarch.com/arduino-arduinians"><i>https://<wbr/>nostarch<wbr/>.com<wbr/>/arduino<wbr/>-arduinians</i></a>.</p>
<p class="TX">This simple example demonstrates just one way you can use the Android App Inventor to make your own remote-controlled projects with professional <span aria-label=" Page 245. " epub:type="pagebreak" id="pg_245" role="doc-pagebreak"/>user interfaces. If you like, spend more time experimenting with App Inventor. I know you’ll come up with some interesting use cases of your own.</p>
<p class="TX">Let’s learn one more way to keep your projects user-friendly by making some modifications to the Bluetooth module.</p>
</section>
</section>
<section aria-labelledby="sec10" epub:type="division">
<h2 class="H1" id="sec10"><span id="h1-104"/><samp class="SANS_Futura_Std_Bold_B_11">Updating the Module Name and PIN</samp></h2>
<p class="TNI">Now that you’ve built an Android app, the final step is to update the module’s name and PIN/password for additional security, as every unit generally ships from the factory with a PIN of 1234. To do so, you must change the module’s operation mode to AT command mode, allowing you to send AT commands to update and review various parameters (in the same way you would with a cellular shield for Arduino).</p>
<p class="TX">To switch to AT command mode, wire up the module to your Arduino as shown in <a href="chapter14.xhtml#fig14-3">Figure 14-3</a> and then add the connection from 3.3 V to the Bluetooth module’s EN pin. This extra connection is required only when altering the parameters—remove or disconnect the connection for normal use.</p>
<p class="TX">Next, enter and upload the sketch in <a href="#LiT-14-2">Listing 14-2</a>, which enables communication between the Arduino Serial Monitor and the Bluetooth module.</p>
<span id="LiT-14-2"/>

<pre><code>#define PIN_BT_TX 3
#define PIN_BT_RX 2
#include &lt;SoftwareSerial.h&gt;
<span aria-label="annotation1" class="CodeAnnotationHang">❶</span> SoftwareSerial BT(PIN_BT_RX, PIN_BT_TX);

void setup()
{
  <span aria-label="annotation2" class="CodeAnnotationHang1">❷</span> BT.begin(38400);
  <span aria-label="annotation3" class="CodeAnnotationHang1">❸</span> Serial.begin(9600);
}

void loop()
{
    if (BT.available())
        Serial.write(BT.read());
    if (Serial.available())
        BT.write(Serial.read());
}
</code></pre>

<p class="CodeListingCaption"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Listing 14-2: Configuring the HC-05 Bluetooth module</samp></p>
<p class="TX">This sketch first sets up a serial connection between the Arduino and your Bluetooth module <span aria-label="annotation1" class="CodeAnnotationCode">❶</span>. The serial speed for the Bluetooth module in AT mode is set at 38,400 baud <span aria-label="annotation2" class="CodeAnnotationCode">❷</span>. The serial connection between your PC and the Arduino stays at 9,600 baud <span aria-label="annotation3" class="CodeAnnotationCode">❸</span>. The module’s LED should blink slowly to indicate that AT command mode is operating.</p>
<p class="TX">Open the Serial Monitor and ensure that both NL (for “new line”) and CR (for “carriage return”) are selected in the menu next to the speed. Enter <span aria-label=" Page 246. " epub:type="pagebreak" id="pg_246" role="doc-pagebreak"/><b>AT</b> and press <b>Send</b>. The Bluetooth module should reply <samp class="SANS_TheSansMonoCd_W5Regular_11">OK</samp> in the Serial Monitor. If it doesn’t, double-check your wiring and that the LED is blinking slowly.</p>
<p class="TX">Just like network devices, each Bluetooth module has a unique media access control (MAC) address. Send <samp class="SANS_TheSansMonoCd_W7Bold_B_11">AT+ADDR?</samp> in the Serial Monitor, which should return your module’s MAC address.</p>
<p class="TX">My unit returned a MAC address of 00:21:06:08:30:BF. To change the four-digit pairing PIN, send <samp class="SANS_TheSansMonoCd_W7Bold_B_11">AT+PSWD</samp> <samp class="SANS_TheSansMonoCd_W7Bold_B_11">=</samp><samp class="SANS_TheSansMonoCd_W7Bold_Italic_I_11">xxxx</samp>, where <samp class="SANS_TheSansMonoCd_W7Bold_Italic_I_11">xxxx</samp> is the new four-digit PIN, such as 8675, for example. You can then test the new PIN by forgetting the device in the Bluetooth menu and then searching for it again.</p>
<p class="TX">To change the Bluetooth’s name from HC-05 to something more descriptive, send <samp class="SANS_TheSansMonoCd_W7Bold_B_11">AT+NAME</samp> <samp class="SANS_TheSansMonoCd_W7Bold_B_11">=</samp><samp class="SANS_TheSansMonoCd_W7Bold_Italic_I_11">NewName</samp>, where <samp class="SANS_TheSansMonoCd_W7Bold_Italic_I_11">NewName</samp> is the name you’d like the module to transmit when in operation. For example, if you were building a project that used a relay to operate a relay in your garage, you might change its name to GarageRelay by sending <samp class="SANS_TheSansMonoCd_W7Bold_B_11">AT+NAME</samp> <samp class="SANS_TheSansMonoCd_W7Bold_B_11">=GarageRelay</samp>. The new name should show up on your device’s Bluetooth screen when pairing, as shown in <a href="chapter14.xhtml#fig14-32">Figure 14-32</a>.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF THE BLUETOOTH MODULE WITH THE CHANGED NAME IN AN ANDROID PHONE" class="img4" id="fig14-32" src="../images/fig14-32.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 14-32: Results of changing the module name</samp></p></figcaption>
</figure>
<p class="TX">Changing the module’s name can be useful when working with several Bluetooth-equipped projects in the same area, allowing you to easily keep track of which devices you’d like to pair with. If you’d ever like to reset the module’s name and pin back to HC-05 and 1234, send <samp class="SANS_TheSansMonoCd_W7Bold_B_11">AT + ORGL</samp> to reset the unit to factory default. You might do this if your project was temporary or if you’re passing the module on to another person.</p>
</section>
<section aria-labelledby="sec11" epub:type="division">
<h2 class="H1" id="sec11"><span id="h1-105"/><span aria-label=" Page 247. " epub:type="pagebreak" id="pg_247" role="doc-pagebreak"/><samp class="SANS_Futura_Std_Bold_B_11">Moving On</samp></h2>
<p class="TNI">In this chapter, you learned several ways to use serial Bluetooth modules with your Arduino projects. You can now use Bluetooth for wireless remote control, capturing data from an Arduino to a computer via Bluetooth and building your own remote-control apps for Android devices. In the future, you can use these skills in plenty of applications, such as remote-control relay boards, logging data from sensors in hard-to-reach places, or building customized remote-control Christmas lights.</p>
<p class="TX">In the next chapter, you’ll learn to reduce your Arduino’s power consumption.</p>
</section>
</section>
</body>
</html>