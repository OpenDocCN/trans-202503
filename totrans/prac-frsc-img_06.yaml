- en: '**5**'
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '**5**'
- en: '**ATTACHING SUBJECT MEDIA TO AN ACQUISITION HOST**'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '**将目标存储介质连接到采集主机**'
- en: '![image](../images/common-01.jpg)'
  id: totrans-2
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/common-01.jpg)'
- en: This chapter discusses the physical attachment of subject storage media to an
    examination host, identification of the subject device on the system, and querying
    the device firmware for information. You’ll also learn about methods for removing
    HPA and DCO, unlocking ATA passwords, and decrypting self-encrypting drives. The
    chapter ends with several special storage topics. Let’s start by examining the
    subject PC hardware.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章讨论将目标存储介质物理连接到检查主机，识别系统中的目标设备，以及查询设备固件以获取信息。你还将学习移除 HPA 和 DCO、解锁 ATA 密码以及解密自加密驱动器的方法。本章最后会介绍一些特殊的存储话题。让我们从检查目标
    PC 硬件开始。
- en: '**Examine Subject PC Hardware**'
  id: totrans-4
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**检查目标 PC 硬件**'
- en: When a PC or notebook is seized in the field or delivered to a forensic lab
    for examination, more than just the internal disks can be examined. Included in
    the examination should be a complete review of the PC hardware configuration,
    BIOS settings, hardware clock, and so on.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 当 PC 或笔记本电脑在现场被没收或交付到取证实验室进行检查时，除了内部磁盘外，还可以检查其他硬件。检查内容应包括完整的 PC 硬件配置审查、BIOS
    设置、硬件时钟等。
- en: '**NOTE**'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: '**注意**'
- en: '*The scope of this book covers “dead” disk acquisition, that is, drives and
    PCs that are already powered off. Depending on the organization, a triage process
    will exist for arriving at a crime or incident scene with live, running machines.
    This triage process may include taking photographs of screens, using mouse jigglers
    to prevent password-protected screensavers from activating, or running memory-dumping
    tools. First responder triage of live PCs is outside the scope of this book.*'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: '*本书的范围涵盖了“死”磁盘获取，即已经关闭电源的驱动器和 PC。根据组织的不同，现场到达犯罪或事件现场时可能会有一个分诊过程，处理正在运行的机器。这个分诊过程可能包括拍摄屏幕照片、使用鼠标振动器防止密码保护的屏幕保护程序启动，或者运行内存转储工具。对于现场运行的
    PC 的首次响应分诊，超出了本书的范围。*'
- en: '***Physical PC Examination and Disk Removal***'
  id: totrans-8
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***物理 PC 检查和磁盘移除***'
- en: Before you unplug any drive cables or unscrew any drives from the drive bays,
    take photographs of the subject PC to document the hardware configuration, the
    number of disks it contains, and how the disks are cabled to the mainboard.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 在拔掉任何驱动器电缆或卸下任何驱动器之前，拍摄目标 PC 的照片，记录硬件配置、其中包含的磁盘数量，以及磁盘如何连接到主板。
- en: Remove disks with care, especially if they’re in old PCs that may not have been
    opened for many years. The top of each drive can be photographed to capture the
    serial number and other information on the label. For each disk, note the cable
    location on the mainboard. If a mainboard has multiple SATA ports, note which
    port each disk was using.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 小心移除驱动器，尤其是如果它们位于多年未打开的旧 PC 中。每个驱动器的顶部可以拍照，记录标签上的序列号和其他信息。对于每个磁盘，记下电缆在主板上的位置。如果主板有多个
    SATA 端口，记录每个磁盘使用的端口。
- en: Open optical drive trays to confirm they don’t contain any discs. Most optical
    drives have a pinhole that can manually release the drive door without powering
    on the drive.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 打开光驱托盘，确认里面没有光盘。大多数光驱都有一个针孔，可以在不开机的情况下手动释放驱动器门。
- en: Examine the PCI slots for PCI SATA Express drives or PCI NVME drives. If a mainboard
    has an M.2 or mSATA slot, check for SSD circuit boards.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 检查 PCI 插槽，查看是否有 PCI SATA Express 驱动器或 PCI NVME 驱动器。如果主板上有 M.2 或 mSATA 插槽，请检查是否有
    SSD 电路板。
- en: '***Subject PC Hardware Review***'
  id: totrans-13
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***目标 PC 硬件审查***'
- en: After removing all the drives from the subject PC enclosure, power on the subject
    mainboard and note the BIOS configuration, clock, boot order, potential BIOS logs,
    version, and so forth.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 从目标 PC 外壳中移除所有驱动器后，打开目标主板电源，记录 BIOS 配置、时钟、启动顺序、可能的 BIOS 日志、版本等信息。
- en: If you require further information about the subject PC, examine it using a
    forensic boot CD that contains various hardware analysis tools, such as lshw,
    dmidecode, biosdecode, lspic, and more.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 如果需要进一步了解目标 PC，请使用包含各种硬件分析工具（如 lshw、dmidecode、biosdecode、lspic 等）的取证启动 CD 进行检查。
- en: You might be able to retrieve some vendor-specific information by using vendor-specific
    tools—for example, vpddecode for IBM and Lenovo hardware or ownership for Compaq
    hardware ownership tags.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能能够通过使用特定厂商的工具来获取一些厂商特定的信息，例如，使用 vpddecode 获取 IBM 和 Lenovo 硬件信息，或获取 Compaq
    硬件的所有权标签。
- en: Examine and document any additional hardware components as well, such as memory
    modules or PCI cards.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 还应检查并记录任何额外的硬件组件，如内存模块或 PCI 卡。
- en: '**Attach Subject Disk to an Acquisition Host**'
  id: totrans-18
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**将目标磁盘连接到采集主机**'
- en: After physically attaching the subject drive to the examiner workstation (using
    a write-blocking mechanism), you need to identify the correct block device associated
    with the subject drive. To reliably identify the subject drive on the acquisition
    host, list the storage media devices, confirm any unique identifiers associated
    with the physical drive, and determine the corresponding device file in */dev*.
    This section examines these steps in more detail.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 在将目标驱动器物理连接到检验工作站后（使用写保护机制），你需要识别与目标驱动器相关联的正确块设备。为了可靠地识别采集主机上的目标驱动器，列出存储介质设备，确认与物理驱动器关联的唯一标识符，并确定相应的设备文件（位于
    */dev* 中）。本节将更详细地探讨这些步骤。
- en: '***View Acquisition Host Hardware***'
  id: totrans-20
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***查看采集主机硬件***'
- en: Understanding the examination host’s hardware configuration is useful for performance
    tuning, capacity planning, maintaining a stable platform, troubleshooting, isolating
    faults, and reducing the risk of human error. In this section, you’ll see examples
    of tools you can use for listing and viewing PC hardware.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 了解检验主机的硬件配置对于性能调优、容量规划、维持平台稳定性、故障排除、隔离故障以及减少人为错误的风险非常有用。在本节中，你将看到一些工具的示例，帮助你列出和查看计算机硬件。
- en: 'Using the lshw tool, you can generate a quick overview of the examiner workstation
    hardware:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 lshw 工具，你可以生成一个关于检验工作站硬件的快速概览：
- en: '[PRE0]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The bus information describes the device specific addresses, such as [pci@domain:bus:slot.function](mailto:pci@domain:bus:slot.function),
    [scsi@host.channel.target.lun](mailto:scsi@host.channel.target.lun), and [usb@bus:device](mailto:usb@bus:device).
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 总线信息描述了设备的具体地址，如 [pci@domain:bus:slot.function](mailto:pci@domain:bus:slot.function)、[scsi@host.channel.target.lun](mailto:scsi@host.channel.target.lun)
    和 [usb@bus:device](mailto:usb@bus:device)。
- en: 'You can also use lshw to specifically look for an attached device type. For
    example:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以使用 lshw 特别查找连接的设备类型。例如：
- en: '[PRE1]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Note that `scsi22` links to `scsi@22:.0.0.0`, which links to */dev/sdp*. Identifying
    the Linux device file for an attached physical drive is discussed further in the
    following sections.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，`scsi22` 链接到 `scsi@22:.0.0.0`，该链接指向 */dev/sdp*。附加物理驱动器的 Linux 设备文件的识别将在后续章节中进一步讨论。
- en: If the subject drive has been externally attached, it’s likely connected via
    USB, Thunderbolt, FireWire, or eSATA (and in rare cases, possibly Fibre Channel).
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 如果目标驱动器已外部连接，它很可能是通过 USB、Thunderbolt、FireWire 或 eSATA 连接的（在少数情况下，可能是通过光纤通道）。
- en: If the drive has been internally attached, it’s likely connected via SATA cable,
    a PCI Express slot, an M.2 interface, or SAS cable (or possibly legacy interfaces,
    such as parallel SCSI or IDE).
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 如果驱动器已内部连接，它很可能是通过 SATA 电缆、PCI Express 插槽、M.2 接口或 SAS 电缆连接的（也可能是通过遗留接口，如并行 SCSI
    或 IDE）。
- en: 'You can list the devices attached to the PCI bus (including parallel PCI and
    PCI Express) using the lspci tool:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用 lspci 工具列出连接到 PCI 总线的设备（包括并行 PCI 和 PCI Express）：
- en: '[PRE2]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The PCI bus categorizes devices by class (see *[http://pci-ids.ucw.cz/](http://pci-ids.ucw.cz/)*
    for more information about PCI IDs and device classes). Devices matching the *Mass
    storage controller* class (class ID 01) are of interest because they manage attached
    storage media.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: PCI 总线通过类别对设备进行分类（有关 PCI ID 和设备类别的更多信息，请参见 *[http://pci-ids.ucw.cz/](http://pci-ids.ucw.cz/)*）。匹配
    *大容量存储控制器* 类别（类别 ID 01）的设备很重要，因为它们管理连接的存储介质。
- en: 'Newer versions of lspci (as of pciutils version 3.30) can list the PCI bus
    by device class, which can be useful to isolate specific hardware of interest.
    The following command lists all SATA mass storage controller (class ID 01, subclass
    ID 06) devices:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 更新版的 lspci（从 pciutils 版本 3.30 起）可以按设备类别列出 PCI 总线，这对于隔离特定硬件很有帮助。以下命令列出所有 SATA
    大容量存储控制器（类别 ID 01，子类 ID 06）设备：
- en: '[PRE3]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'This command enumerates all the SCSI, IDE, RAID, ATA, SATA, SAS, and NVME mass
    storage controller devices on a system:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令列出系统上的所有 SCSI、IDE、RAID、ATA、SATA、SAS 和 NVME 大容量存储控制器设备：
- en: '[PRE4]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Another PCI class that can manage connected storage media is the *serial bus
    controller* class (class ID 0C). The following command lists all devices with
    the USB serial bus controller class (class ID 0C, subclass ID 03):'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个可以管理连接存储介质的 PCI 类别是 *串行总线控制器* 类别（类别 ID 0C）。以下命令列出所有 USB 串行总线控制器类（类别 ID 0C，子类
    ID 03）的设备：
- en: '[PRE5]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'This command enumerates all FireWire, USB, and Fibre Channel serial bus controllers
    on the examiner host:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令列出检验主机上的所有 FireWire、USB 和光纤通道串行总线控制器：
- en: '[PRE6]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'If the subject drive is attached via USB, it won’t appear on the PCI bus. You
    can list USB devices separately using lsusb. Without options, the command generates
    a list of all attached USB devices:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 如果主题驱动器是通过 USB 连接的，它不会出现在 PCI 总线上。你可以使用 lsusb 单独列出 USB 设备。如果没有选项，该命令会生成一个所有连接的
    USB 设备的列表：
- en: '[PRE7]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Here a USB thumb drive is attached to USB bus 1 and assigned a USB device ID
    of 5\. Running `lsusb -v` will provide more detailed output about the USB device.^([1](footnote.xhtml#fn22))
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，一个 USB 闪存驱动器连接到 USB 总线 1，并被分配了一个 USB 设备 ID 为 5。运行 `lsusb -v` 会提供关于 USB 设备的更详细输出。^([1](footnote.xhtml#fn22))
- en: The preceding tools and examples provide an overview of the storage media controllers
    and the hardware attached to an examiner workstation. The lshw(1), lspci(8), and
    lsusb(8) manual pages explain additional parameters and features, which you can
    use to view more detail about the hardware.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 上述工具和示例提供了一个关于存储介质控制器和连接到考官工作站的硬件的概述。lshw(1)、lspci(8) 和 lsusb(8) 的手册页面解释了更多参数和特性，你可以使用它们来查看硬件的更详细信息。
- en: '***Identify the Subject Drive***'
  id: totrans-45
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***识别主题驱动器***'
- en: Having an understanding of the examiner workstation hardware, especially the
    available bus systems and controllers, will help you locate where a subject disk
    is attached. The next step is to positively confirm the identity of the subject
    drive using some distinct information, such as a serial number, unique model number,
    or other unique property.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 了解考官工作站的硬件，尤其是可用的总线系统和控制器，将帮助你确定主题磁盘的连接位置。下一步是通过一些独特的信息，如序列号、唯一型号或其他独特属性，确认主题驱动器的身份。
- en: 'You can use multiple approaches to identify the subject device. If the subject
    disk is attached via the USB bus and listed with the lsusb tool, you can retrieve
    more information by specifying the subject disk’s `vendor`:productID, as shown
    here:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用多种方法来识别主题设备。如果主题磁盘是通过 USB 总线连接的，并且在 lsusb 工具中列出，你可以通过指定主题磁盘的 `vendor`:productID
    来获取更多信息，如下所示：
- en: '[PRE8]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: From this output, you can use the unique information (serial number and so on)
    about the device to confirm the identity of the attached device as the subject
    drive. If the serial number or other unique properties match the physically attached
    drive, you’ve identified the correct device.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 从这个输出中，你可以使用设备的唯一信息（如序列号等）来确认连接设备是否为主题驱动器。如果序列号或其他唯一属性与物理连接的驱动器匹配，那么你就确认了正确的设备。
- en: 'Nearly all drives are accessible via SCSI commands (directly attached NVME
    drives are a notable exception). To query for an attached storage device, you
    can use the lsscsi tool. It supports a number of transport layer protocols, including
    SATA, USB, SAS, FireWire, ATA, SCSI, Fibre Channel, and more. lsscsi is also useful
    for linking kernel device paths with device files in */dev*:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 几乎所有驱动器都可以通过 SCSI 命令访问（直接连接的 NVME 驱动器是一个显著的例外）。要查询连接的存储设备，你可以使用 lsscsi 工具。它支持多种传输层协议，包括
    SATA、USB、SAS、FireWire、ATA、SCSI、Fibre Channel 等等。lsscsi 还可以用来将内核设备路径与 */dev* 中的设备文件关联起来：
- en: '[PRE9]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'The kernel outputs an informational message when devices are attached or detached
    from a host system. This is the kernel *ring buffer* and is viewed with the dmesg
    tool. Running `dmesg` with the `-T` flag prints human-readable timestamps, which
    are useful when you’re determining which device was added at a known time:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 当设备从主机系统连接或断开时，内核会输出一条信息性消息。这是内核的*环形缓冲区*，可以通过 dmesg 工具查看。使用 `dmesg` 并加上 `-T`
    参数可以打印出人类可读的时间戳，这在你确定某设备在已知时间被添加时非常有用：
- en: '[PRE10]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: You can use this output to identify an attached physical device, linking the
    USB device to a SCSI host ID and a block device name. In this example, `usb 2-1:`
    refers to bus 2 and physical port 1 (the plug). The USB drive is assigned `device
    number 9` and uses the *xhci_hcd driver* (which has USB3 support). The vendor
    and product ID strings, `idVendor=0781`, `idProduct=5583`, are displayed, followed
    by informational strings for the manufacturer, product, and serial number (these
    can be different from `idVendor` and `idProduct`). The Bulk-Only Transport `usb-storage`
    driver detects the device (not needed for UASP devices), and `scsi host24:` indicates
    a SCSI host number has been assigned to the device and corresponds to the SCSI
    address `24:0:0:0:`. Two devices are created, `sg5` (generic SCSI) and `sdf` (block
    device), which correspond to */dev/sg5* and */dev/sdf*. Some information about
    the (now established) SCSI device is queried, and partition tables are detected
    (`sdf1`).
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用这些输出信息来识别附加的物理设备，将USB设备与SCSI主机ID和块设备名称关联。在这个示例中，`usb 2-1:`指的是总线2和物理端口1（插口）。该USB驱动器被分配了`设备号9`，并使用*xhci_hcd驱动程序*（支持USB3）。显示了供应商和产品ID字符串，`idVendor=0781`，`idProduct=5583`，后面跟着制造商、产品和序列号的信息字符串（这些可能与`idVendor`和`idProduct`不同）。Bulk-Only
    Transport `usb-storage`驱动程序检测到该设备（对于UASP设备不需要），并且`scsi host24:`表示设备已分配了SCSI主机编号，并对应SCSI地址`24:0:0:0:`。创建了两个设备，`sg5`（通用SCSI）和`sdf`（块设备），它们分别对应*/dev/sg5*和*/dev/sdf*。查询了有关（现已建立的）SCSI设备的一些信息，并检测到分区表（`sdf1`）。
- en: 'A simpler command to list all attached storage devices, including descriptive
    information and device paths, is the `lsblk` command. Newer versions of lsblk
    provide output options for vendor, model, revision, serial number, and *WWN* (*World
    Wide Name*; *[https://en.wikipedia.org/wiki/World_Wide_Name](https://en.wikipedia.org/wiki/World_Wide_Name)*)
    number. In addition, lsblk provides useful technical details, such as the device
    name, size, physical and logical sector size, transport (USB, SATA, SAS, and so
    on), SCSI address, and more:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 一个更简单的命令来列出所有附加的存储设备，包括描述信息和设备路径，是`lsblk`命令。较新版本的lsblk提供了有关供应商、型号、版本、序列号以及*WWN*（*世界唯一名称*；*[https://en.wikipedia.org/wiki/World_Wide_Name](https://en.wikipedia.org/wiki/World_Wide_Name)*)编号的输出选项。此外，lsblk还提供了有用的技术细节，例如设备名称、大小、物理和逻辑扇区大小、传输方式（USB、SATA、SAS等）、SCSI地址等：
- en: '[PRE11]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Most of the tools demonstrated here are simply reading different files and directories
    from the Linux */proc* directory. You’ll find more information about attached
    drives and other kernel structures in the */proc* tree. Consult the proc(5) manual
    page for more information about the proc filesystem.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 此处展示的大多数工具只是从Linux的*/proc*目录中读取不同的文件和目录。你可以在*/proc*树中找到关于附加硬盘和其他内核结构的更多信息。有关proc文件系统的更多信息，请查阅proc(5)手册页。
- en: '**Query the Subject Disk for Information**'
  id: totrans-58
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**查询目标磁盘信息**'
- en: After attaching the subject drive to the examiner workstation and positively
    identifying the correct Linux device to work with, you can gather additional meta
    information about the device. You can query the device directly for information
    about the drive, the firmware, SMART data, and other configuration details.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 在将目标硬盘连接到检查工作站并准确识别要操作的正确Linux设备后，你可以收集有关该设备的更多元信息。你可以直接查询该设备，获取有关硬盘、固件、SMART数据和其他配置信息。
- en: A number of tools are available to query information stored in the hard drive.
    Typically, you access this firmware information using lower-level ATA or SCSI
    interface commands, which interact directly with the drive electronics.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 有多种工具可用于查询存储在硬盘中的信息。通常，你使用较低级别的ATA或SCSI接口命令来访问这些固件信息，这些命令直接与硬盘电子设备交互。
- en: '***Document Device Identification Details***'
  id: totrans-61
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***文档设备识别详细信息***'
- en: 'At this point, you should have a number of details and technical identifiers
    about the drive attached to the examiner host, including the following:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 此时，你应该已获得关于连接到检查主机的硬盘的一些详细信息和技术标识符，包括以下内容：
- en: • Vendor, make, and model
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: • 供应商、品牌和型号
- en: • Serial number or WWN
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: • 序列号或WWN
- en: • Linux device name
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: • Linux设备名称
- en: • PCI `domain`:bus:slot.function
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: • PCI `domain`:bus:slot.function
- en: • PCI `vendorID`:deviceID
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: • PCI `vendorID`:deviceID
- en: • USB `bus`:device
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: • USB `bus`:device
- en: • USB `vendorID`:productID
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: • USB `vendorID`:productID
- en: • SCSI `host`:channel:target:lun
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: • SCSI `host`:channel:target:lun
- en: You can save this information for reporting purposes by redirecting the various
    tool command outputs to text files.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过将各种工具命令输出重定向到文本文件来保存这些信息以备报告使用。
- en: 'Document evidence for the use of a write blocker. If you’re using a hardware
    write blocker, such as Tableau, query it and save the results:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 记录使用写保护器的证据。如果你使用的是硬件写保护器，如Tableau，查询并保存结果：
- en: '[PRE12]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Here */dev/sdc* should be replaced with the relevant device of the subject drive.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 此处*/dev/sdc*应替换为目标驱动器的相关设备。
- en: 'If you’re using a software write blocker, such as wrtblk, query `blockdev`
    for a report on the current status of the device (including the read-only flag):'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用的是软件写保护器，如wrtblk，可以查询`blockdev`以获取设备当前状态的报告（包括只读标志）：
- en: '[PRE13]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Here */dev/sda* should be replaced with the relevant device of the subject drive.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 此处*/dev/sda*应替换为目标驱动器的相关设备。
- en: 'If the subject drive is attached via USB, you can specify it either by the
    `bus`:device (using `-s`) or by `vendor`:product (using `-d`). The following two
    commands will produce and save the same verbose output:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 如果目标驱动器通过USB连接，可以通过`bus`:device（使用`-s`）或`vendor`:product（使用`-d`）来指定。以下两个命令将生成并保存相同的详细输出：
- en: '[PRE14]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Here `2:2` and `13fe:5200` should be replaced with the relevant values for the
    subject drive on your acquisition host.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 此处`2:2`和`13fe:5200`应替换为你的获取主机上目标驱动器的相关值。
- en: 'The `lsblk` command can specify a Linux device, and the `-O` flag will output
    all available columns in the output:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: '`lsblk`命令可以指定Linux设备，`-O`标志将输出所有可用的列：'
- en: '[PRE15]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Here */dev/sda* should be replaced with the relevant device of the subject drive
    on your acquisition host.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 此处*/dev/sda*应替换为你的获取主机上目标驱动器的相关设备。
- en: 'The `lsscsi` command can also save a certain perspective of the attached drive,
    specifying the SCSI address to use:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: '`lsscsi`命令也可以保存连接驱动器的某种视角，并指定要使用的SCSI地址：'
- en: '[PRE16]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Here `16:0:0:0` should be replaced with the relevant SCSI address of the subject
    drive on your acquisition host.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 此处`16:0:0:0`应替换为你的获取主机上目标驱动器的相关SCSI地址。
- en: Relevant dmesg output could also be copied into a text file if desired.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 如果需要，也可以将相关的dmesg输出复制到文本文件中。
- en: The examples shown in this section illustrated how to save command output for
    a specific subject drive. For brevity, subsequent chapters sometimes will not
    include examples of saving data to files, focusing instead on the construction
    of commands.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 本节展示的示例说明了如何保存特定目标驱动器的命令输出。为了简洁，后续章节有时不会包括保存数据到文件的示例，而是专注于命令的构造。
- en: '***Query Disk Capabilities and Features with hdparm***'
  id: totrans-89
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***使用hdparm查询磁盘功能和特性***'
- en: Many of the tools discussed previously (lsusb, lspci, lsblk, and so on) have
    queried the Linux system and kernel structures for information. However, it’s
    possible to query a drive directly for additional information. The hdparm tool
    is useful for sending commands to most drives attached to a Linux system.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 之前讨论的许多工具（如lsusb、lspci、lsblk等）已经查询了Linux系统和内核结构中的信息。然而，也可以直接查询驱动器以获取额外的信息。hdparm工具对于向大多数连接到Linux系统的驱动器发送命令非常有用。
- en: 'The hdparm tool operates by sending requests to the OS disk drivers (using
    ioctls) to retrieve information about the disk. From a forensics perspective,
    a number of items may be of interest or useful to document:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: hdparm工具通过向操作系统磁盘驱动程序发送请求（使用ioctl）来检索有关磁盘的信息。从取证的角度来看，可能有一些项目值得关注或记录：
- en: • Details about the drive geometry (physical and logical)
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: • 驱动器几何信息（物理和逻辑）
- en: • The disk’s supported standards, features, and capabilities
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: • 磁盘支持的标准、特性和功能
- en: • States and flags related to the drive configuration
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: • 与驱动器配置相关的状态和标志
- en: • DCO and HPA information
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: • DCO和HPA信息
- en: • Security information
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: • 安全信息
- en: • Vendor information, such as make, model, and serial number
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: • 厂商信息，如品牌、型号和序列号
- en: • The WWN device identifier (if it exists)
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: • WWN设备标识符（如果存在）
- en: • Time needed for secure erase (for most disks, this is roughly the acquisition
    time)
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: • 安全擦除所需的时间（对于大多数磁盘来说，大约是获取时间）
- en: For more detailed information about hdparm’s features, see the hdparm(8) manual
    page.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 有关hdparm功能的详细信息，请参阅hdparm(8)手册页面。
- en: The following example shows how to use hdparm to get an overview of the disk
    using the `-I` flag together with the raw disk device. The listing is annotated
    with comments relevant to forensic investigators.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例展示了如何使用hdparm工具，通过`-I`标志和原始磁盘设备一起获取磁盘概述。列表中注释了与取证调查人员相关的内容。
- en: The output begins with documenting information about the drive, including manufacturer,
    model, serial number, and the standards with which it is compliant. Also in the
    output are various drive parameters, such as physical and logical sector size,
    number of sectors, form factor, and other physical properties.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 输出开始时会记录关于硬盘的信息，包括制造商、型号、序列号以及它符合的标准。输出中还包括各种硬盘参数，如物理和逻辑扇区大小、扇区数量、外形尺寸以及其他物理特性。
- en: '[PRE17]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: The next section of the output describes the features available on a drive,
    and the star (`[*]`) indicates if a feature is currently enabled. (To understand
    vendor-specific features, you might need additional proprietary documentation.)
    This is useful when you’re preparing for a forensic acquisition, because it indicates
    the status of security feature sets and other things like the DCO (`Device Configuration
    Overlay feature set`).
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 输出的下一部分描述了硬盘上可用的功能，星号（`[*]`）表示某个功能是否当前启用。（为了理解厂商特定的功能，你可能需要额外的专有文档。）当你准备进行法证采集时，这非常有用，因为它表明了安全功能集以及其他功能（如
    DCO（`设备配置覆盖功能集`））的状态。
- en: '[PRE18]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: The next section of the hdparm output provides more detail about the currently
    active security features, which are important when you’re determining if a drive
    is locked or encrypted. The time needed for a secure erase is also a rough estimate
    of how long an acquisition might take (if the subject drive is the performance
    bottleneck).
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: hdparm 输出的下一部分提供了有关当前活动的安全功能的更多细节，当你确定硬盘是否被锁定或加密时，这些信息非常重要。安全擦除所需的时间也是对获取过程可能需要的时间的粗略估算（如果目标硬盘是性能瓶颈的话）。
- en: '[PRE19]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: The final section of the hdparm output displays the WWN again, but this time
    it’s broken down into the NAA (which describes the rest of the WWN), the IEEE
    OUI assigned vendor ID, and the rest of the WWN (which isunique to the drive).
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: hdparm 输出的最后一部分再次显示了 WWN，但这次它被分解成 NAA（描述 WWN 其余部分的部分）、IEEE OUI 分配的厂商 ID 和 WWN
    其余部分（它是唯一的，针对特定硬盘）。
- en: '[PRE20]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: The hdparm output contains a number of items of interest to forensic investigators,
    either for documentation or as information for further analysis. To include the
    entire output of `hdparm -I` in a forensic report, you can redirect it to a text
    file.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: hdparm 输出包含了许多法证调查员感兴趣的项目，既可以作为文档记录，也可以作为进一步分析的信息。如果需要将 `hdparm -I` 的完整输出包含在法证报告中，可以将其重定向到文本文件中。
- en: A similar tool for querying SCSI drives is sdparm, which you can use to access
    SCSI mode pages. Running `sdparm` with the flags `-a -l` retrieves a verbose list
    of disk parameters. A more concise query using `sdparm -i` can extract the Vital
    Product Data (VPD), which provides unique identifying information about the make,
    model, and serial number of SCSI and SAS drives.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 查询 SCSI 硬盘的类似工具是 sdparm，你可以使用它来访问 SCSI 模式页面。运行 `sdparm` 并加上标志 `-a -l` 会获取磁盘参数的详细列表。使用
    `sdparm -i` 的更简洁查询可以提取重要产品数据（VPD），提供有关 SCSI 和 SAS 硬盘的唯一识别信息，如制造商、型号和序列号。
- en: '***Extract SMART Data with smartctl***'
  id: totrans-112
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***使用 smartctl 提取 SMART 数据***'
- en: 'SMART was developed in the early 1990s to help monitor hard disks and predict
    failures. It was added to the SCSI-3 standard in 1995(SCSI-3 standard: X3T10/94-190
    Rev 4) and the ATA-3 standard in 1997 (ATA-3 standard: X3.298-1997). Because certain
    details about the disk hardware may be of value in forensic investigations, in
    this section, you’ll learn several techniques to extract SMART information about
    the disk hardware.'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: SMART 是在 1990 年代初期开发的，用于帮助监控硬盘并预测故障。它在 1995 年被加入到 SCSI-3 标准中（SCSI-3 标准：X3T10/94-190
    Rev 4），并在 1997 年加入到 ATA-3 标准中（ATA-3 标准：X3.298-1997）。由于磁盘硬件的某些细节可能在法证调查中具有价值，在本节中，你将学习几种提取磁盘硬件
    SMART 信息的技术。
- en: The `smartctl` command is part of the smartmontools package and provides access
    to the SMART interface built into nearly all modern hard drives. The `smartctl`
    command queries attached ATA, SATA, SAS, and SCSI hardware.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: '`smartctl` 命令是 smartmontools 包的一部分，提供对几乎所有现代硬盘内置的 SMART 接口的访问。`smartctl` 命令查询连接的
    ATA、SATA、SAS 和 SCSI 硬件。'
- en: 'SMART provides a number of variables and statistics about a disk, some of which
    could be of interest to a forensic investigator. For example:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: SMART 提供了关于磁盘的一些变量和统计信息，其中一些可能对法证调查员很有帮助。例如：
- en: • Statistics about errors on the disk and the overall health of the disk
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: • 磁盘错误和磁盘整体健康状态的统计信息
- en: • Number of times the disk was powered on
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: • 磁盘开机的次数
- en: • Number of hours the disk was in operation
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: • 磁盘运行的小时数
- en: • Number of bytes read and written (often expressed in gigabytes)
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: • 读取和写入的字节数（通常以千兆字节为单位表示）
- en: • Various SMART logs (temperature history, and so on)^([2](footnote.xhtml#fn23))
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: • 各种SMART日志（温度历史等）^([2](footnote.xhtml#fn23))
- en: The following example shows SMART data requested from a drive. The listing is
    annotated with comments relevant to forensic investigators.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例显示了从驱动器请求的SMART数据。列表中附有与取证调查员相关的注释。
- en: The `-x` flag instructs smartctl to print all available information. The first
    block of output is the information section, which provides unique identifying
    information about the drive. You can also retrieve most of this information using
    other tools, such as hdparm, as shown in previous examples.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '`-x`标志指示smartctl打印所有可用的信息。输出的第一个块是信息部分，提供有关驱动器的唯一标识信息。您也可以使用其他工具，如hdparm，检索大部分这些信息，如之前的示例所示。'
- en: '[PRE21]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: The following SMART data section shows the health of the drive and the results
    of self-tests. An unhealthy drive is an early warning of possible acquisition
    issues. Additional SMART capabilities are then listed.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 以下SMART数据部分显示了驱动器的健康状况和自检结果。不健康的驱动器是潜在采集问题的早期警告。接下来列出了其他SMART功能。
- en: '[PRE22]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: The next section provides more statistics about the drive. Of possible forensic
    interest here are statistics on the history of the drive usage; for example, the
    cumulative number of hours the drive has been powered on (`Power_On_Hours`) and
    how many times the drive has been powered up (`Power_Cycle_Count`). Both attributes
    may correlate with the PC from where they were taken. The total logical block
    addresses (LBAs) read and written indicates the drive volume usage in the past.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 下一部分提供了关于驱动器的更多统计信息。这里可能与取证相关的统计数据包括驱动器使用历史；例如，驱动器通电的累计小时数（`Power_On_Hours`）和驱动器启动的次数（`Power_Cycle_Count`）。这两个属性可能与取自的PC相关联。读取和写入的总逻辑块地址（LBAs）指示了驱动器过去的使用量。
- en: '[PRE23]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: The next section is the log directory, which describes the SMART logs available
    on the drive. The logs are included in the `smartctl -x` output with repeating
    entries removed (“skipped”). Some of these logs may be of interest in a forensic
    investigation.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 下一部分是日志目录，描述了驱动器上的SMART日志。这些日志包含在`smartctl -x`输出中，重复的条目会被移除（“跳过”）。这些日志中的一些可能在取证调查中具有重要性。
- en: '[PRE24]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: The next section of log information displays the results of self-tests. Failed
    self-tests are an early warning that the acquisition could have issues.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 下一部分的日志信息显示了自检结果。自检失败是采集可能存在问题的早期警告。
- en: '[PRE25]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: The next output block describes a drive’s temperature statistics. This information
    could be useful to monitor during the acquisition process. For investigation purposes,
    the minimum and maximum temperatures reached during the drive’s lifetime might
    be of interest if correlated with environ-mental factors linked to a suspect’s
    PC. Vendor-specific SMART data is not part of the generic SMART standard, and
    you may need additional proprietary documentation to understand it.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 下一输出块描述了驱动器的温度统计信息。在采集过程中，监控这些信息可能会很有用。为了调查目的，可能对驱动器在其生命周期内达到的最小和最大温度感兴趣，特别是如果它们与与嫌疑人PC相关的环境因素相关联的话。供应商特定的SMART数据不属于通用SMART标准的一部分，您可能需要额外的专有文档来理解它。
- en: '[PRE26]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Some SMART-capable drives maintain a log of temperature history. You can calculate
    the history from the interval multiplied by the history size. In this example,
    478 minutes are roughly 8 hours of temperature data. Some disks have a temperature-logging
    interval set much higher (one hour or more). The temperature-logging interval
    is potentially useful for investigations: if a disk were seized immediately after
    a crime, known temperature variations might be correlated with the disk temperature
    record.'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 一些支持SMART的驱动器会保持温度历史日志。您可以通过将间隔乘以历史大小来计算历史数据。在这个例子中，478分钟大约是8小时的温度数据。有些磁盘的温度记录间隔设置得更长（一个小时或更长）。温度记录间隔对于调查可能非常有用：如果在犯罪发生后立即扣押磁盘，已知的温度变化可能与磁盘的温度记录相关联。
- en: '[PRE27]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: The final section of output in this example shows statistics of physical errors.
    It can be useful to compare these statistics with values during or at the end
    of an acquisition to ensure no physical errors arose during the process.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 本示例的输出的最后一部分显示了物理错误的统计数据。将这些统计数据与采集过程中的或采集结束时的值进行比较，可能有助于确保在过程中没有出现物理错误。
- en: '[PRE28]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Other SMART logs might exist depending on the drive vendor. Consult the smartctl(8)
    manual page for more information about additional flags and queries that you can
    send to attached subject drives.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 根据驱动器厂商的不同，可能还会有其他SMART日志。有关更多关于附加标志和查询的信息，请查阅smartctl(8)手册页面，以了解可以发送到附加目标驱动器的命令。
- en: '**Enable Access to Hidden Sectors**'
  id: totrans-139
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**启用对隐藏扇区的访问**'
- en: Forensic literature often includes handling the HPA and DCO as part of the imaging
    process. Indeed, some imaging software has the capability to detect and remove
    these hidden areas at acquisition time. This book positions the detection and
    removal of the HPA/DCO as part of the preparation process, not the actual imaging.
    There is no special technique to image these hidden areas once they’ve been made
    accessible. They’re simply disk sectors protected by drive configuration parameters.
    It is a simple preparatory step to make them available for a subsequent imaging
    process. Removing the HPA or DCO modifies the drive’s configuration, but it does
    not modify its contents.^([3](footnote.xhtml#fn24))
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 取证文献通常将处理HPA和DCO作为成像过程的一部分。事实上，一些成像软件在获取时就具备检测和移除这些隐藏区域的能力。本书将HPA/DCO的检测和移除定位为准备过程的一部分，而非实际的成像过程。一旦这些隐藏区域变得可访问，就没有特别的技术来成像它们。它们只是被驱动器配置参数保护的磁盘扇区。将它们提供给后续成像过程是一个简单的准备步骤。移除HPA或DCO会修改驱动器的配置，但不会修改其内容。^([3](footnote.xhtml#fn24))
- en: This section also covers drive maintenance sectors and service areas on a disk,
    but this topic is mentioned only briefly, because these areas are not easily accessible
    using common open source tools.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 本节还涉及磁盘上的驱动器维护扇区和服务区域，但这个话题仅简要提及，因为这些区域无法通过常见的开源工具轻松访问。
- en: '***Remove a DCO***'
  id: totrans-142
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***移除DCO***'
- en: The DCO was developed to allow PC system manufacturers to make different drive
    models appear to have the same features. Using a DCO, certain features can be
    disabled, and the capacity of a drive (number of usable sectors) can be reduced
    to fit a vendor’s requirements. Identifying and removing the DCO is standard forensic
    practice when you’re analyzing a suspect drive.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: DCO的开发旨在使PC系统制造商能够使不同的驱动器型号看起来具有相同的功能。使用DCO，可以禁用某些功能，并将驱动器的容量（可用扇区的数量）减少，以符合厂商的要求。在分析可疑驱动器时，识别并移除DCO是标准的取证实践。
- en: The DCO is a general configuration overlay, and multiple features can be overridden.
    It does not only refer to the number of sectors on a drive.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: DCO是一个通用的配置覆盖层，可以覆盖多个功能。它不仅仅指驱动器上的扇区数量。
- en: 'Two hdparm commands can determine if a DCO exists and provide the number of
    real sectors available. The first command determines if the drive has the DCO
    feature set enabled. In this example, the current size of the disk is reported
    to be 474GB or 926773168 sectors (512-byte sector size) and the asterisk (`[*]`)
    next to `Device Configuration Overlay feature set` indicates it is active:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 两个hdparm命令可以确定是否存在DCO，并提供可用的实际扇区数量。第一个命令用于确定驱动器是否启用了DCO功能集。在这个例子中，报告的磁盘当前大小为474GB或926773168个扇区（512字节扇区大小），并且`Device
    Configuration Overlay feature set`旁边的星号（`[*]`）表示该功能已启用：
- en: '[PRE29]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'The second command specifically queries for the features modified by a DCO:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个命令专门查询由DCO修改的功能：
- en: '[PRE30]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: In this example, “Real max sectors” is 976773168, which is 25GB less than the
    reported size, indicating the existence of a DCO. The reported size of 474GB is
    also a mismatch to the 500GB label on the physical drive. You can confirm the
    expected number of sectors by checking the drive model number with the vendor’s
    product documentation.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，“Real max sectors”是976773168，比报告的大小少了25GB，这表明存在DCO。报告的474GB大小与物理驱动器上的500GB标签不匹配。你可以通过检查驱动器型号与厂商的产品文档来确认预期的扇区数量。
- en: 'Having confirmed the existence of a DCO using hdparm, you can use the same
    command to remove it. First, run `hdparm` to ensure the drive configuration is
    not locked or frozen:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 确认使用hdparm存在DCO后，可以使用相同的命令将其移除。首先，运行`hdparm`以确保驱动器配置未被锁定或冻结：
- en: '[PRE31]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Some BIOSes or OSes will issue an ATA command to freeze the DCO configuration
    during boot to prevent malicious changes. In this case, hot plugging the drive
    power cable after booting should cause the drive to spin up in an unfrozen state.^([4](footnote.xhtml#fn25))
    Many USB bridges automatically spin up an attached disk in an unfrozen state.
    If the drive is locked, refer to “[Identify and Unlock ATA Password-Protected
    Disks](ch05.xhtml#ch05lev2sec11)” on [page 126](ch05.xhtml#page_126).
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 一些BIOS或操作系统会在启动时发出ATA命令冻结DCO配置，以防止恶意更改。在这种情况下，启动后热插拔驱动器电源线应使驱动器以未冻结的状态启动。^([4](footnote.xhtml#fn25))
    许多USB桥接器会自动使附加的磁盘在未冻结的状态下启动。如果驱动器被锁定，请参阅“[识别和解锁ATA密码保护磁盘](ch05.xhtml#ch05lev2sec11)”第126页中的内容。
- en: Once the drive is ready, you can send the appropriate ATA command to reset the
    DCO, making the additional hidden sectors available.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦驱动器准备好，你可以发送适当的ATA命令来重置DCO，使额外的隐藏扇区可用。
- en: 'Simply running the `hdparm` command with the `--dco-restore` option will do
    nothing but generate a warning message:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 仅仅运行带有`--dco-restore`选项的`hdparm`命令不会做任何事情，只会生成一个警告信息：
- en: '[PRE32]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Following the instructions, and including the `--yes-i-know-what-i-am-doing`
    flag, you can remove the DCO as follows:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 按照说明并包含`--yes-i-know-what-i-am-doing`标志，你可以按照以下步骤移除DCO：
- en: '[PRE33]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: Now when you run the `hdparm -I` command again, the full sectors will be revealed.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，当你再次运行`hdparm -I`命令时，所有扇区将被显示。
- en: '[PRE34]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: Now you can acquire the drive or analyze it with forensic tools. It’s important
    to note the DCO hidden area’s exact sector offset, which will be useful when you
    want to extract only the DCO sectors for separate analysis.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你可以获取驱动器或使用取证工具对其进行分析。需要注意的是DCO隐藏区域的确切扇区偏移量，这在你只想提取DCO扇区进行单独分析时会非常有用。
- en: Removing the DCO using `hdparm` can be tricky. Read the hdparm(8) manual page
    if a particular drive is causing problems with the removal commands.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`hdparm`移除DCO可能会有些棘手。如果特定驱动器在执行移除命令时出现问题，请查阅hdparm(8)手册页面。
- en: The tableau-parm tool has an `-r` flag that should remove the DCO (and possibly
    the HPA) from the drive.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: tableau-parm工具有一个`-r`标志，应该能从驱动器中移除DCO（并可能移除HPA）。
- en: '***Remove an HPA***'
  id: totrans-163
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***移除HPA***'
- en: The HPA was developed to allow PC system manufacturers to store data in a way
    that is normally inaccessible to a customer. Examples of HPA uses include diagnostic
    tools, recovery partitions, and so on. These special areas are often activated
    with BIOS hotkeys during startup.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: HPA是为了让PC系统制造商能够以通常客户无法访问的方式存储数据而开发的。HPA的使用示例包括诊断工具、恢复分区等。这些特殊区域通常在启动时通过BIOS热键激活。
- en: 'You can detect the existence of an HPA using a single `hdparm` command:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用一个简单的`hdparm`命令来检测HPA的存在：
- en: '[PRE35]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: Here `HPA is enabled` indicates that an HPA exists. The `max sectors` provides
    the visible sector count followed by the real sector count. In this example, subtracting
    the two sector counts reveals a 50GB difference, which is the host protected area.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 这里`HPA已启用`表示存在HPA。`最大扇区数`提供了可见的扇区数，后跟实际扇区数。在此示例中，减去这两个扇区数可以揭示出50GB的差异，这就是主机保护区。
- en: 'You can temporarily remove the HPA using the same command (as with the DCO
    removal, a warning message appears, and you need to use the `--yes-i-know-what-i-am-doing`
    flag):'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用相同的命令临时移除HPA（与DCO移除类似，出现警告信息，你需要使用`--yes-i-know-what-i_am_doing`标志）：
- en: '[PRE36]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'The result of this command is only temporary; the original HPA will be in place
    next time you cycle the drive’s power. To make the change permanent, add `p` to
    the sector count number as follows:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 该命令的结果只是暂时的；下次你重新启动驱动器时，原来的HPA将会恢复。要使该更改永久生效，可以按如下方式将`p`添加到扇区计数数字中：
- en: '[PRE37]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: The HPA is now removed, and you can acquire the drive or analyze it with forensic
    tools. It’s important to note the HPA hidden area’s exact sector offset, which
    will be useful when you want to extract only the HPA sectors for separate analysis.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: HPA现在已被移除，你可以获取驱动器或使用取证工具对其进行分析。需要注意的是HPA隐藏区域的确切扇区偏移量，这在你只想提取HPA扇区进行单独分析时会非常有用。
- en: Removing the HPA with hdparm can be tricky. Read the hdparm(8) manual page if
    a particular drive is causing problems with the removal commands.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 使用hdparm移除HPA可能会有些棘手。如果特定驱动器在执行移除命令时出现问题，请查阅hdparm(8)手册页面。
- en: 'Previously, the Sleuth Kit forensic suite had two utilities to detect and temporarily
    remove the HPA: disk_stat and disk_sreset. These were removed in 2009 because
    other tools, such as hdparm, included the same features.'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 之前，Sleuth Kit取证套件有两个实用工具用于检测并临时移除HPA：disk_stat 和 disk_sreset。这些工具在2009年被移除，因为其他工具，如hdparm，已包含相同的功能。
- en: '***Drive Service Area Access***'
  id: totrans-175
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***驱动器服务区域访问***'
- en: Hard disk drives need to store information such as SMART logs, ATA passwords,
    bad sector lists, firmware, and other persistent information. This information
    is typically stored on the disk platters in reserved, user-inaccessible sectors
    called the *system area* (also known as the *service area*, *negative sectors*,
    or *maintenance sectors*). Access to this area is done through proprietary vendor
    commands, which are usually not public.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 硬盘驱动器需要存储如SMART日志、ATA密码、不良扇区列表、固件和其他持久信息等数据。这些信息通常存储在磁盘盘片的保留区域，用户无法访问，这些区域被称为*系统区域*（也叫*服务区域*、*负扇区*或*维护扇区*）。访问这些区域是通过厂商专有命令完成的，这些命令通常不对外公开。
- en: There is no common systematic approach to access a disk’s system areas. Each
    disk manufacturer implements system areas differently, there are no industry standards,
    and there are few publicly available tools. Some specialized commercial tools
    exist, such as Ace Laboratory’s PC-3000 (*[http://www.acelaboratory.com/catalog/](http://www.acelaboratory.com/catalog/)*)
    or Atola Insight Forensic (*[http://www.atola.com/products/insight/supported-drives.html](http://www.atola.com/products/insight/supported-drives.html)*),
    which can access service areas of many disks.^([5](footnote.xhtml#fn26), [6](footnote.xhtml#fn27))
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 目前并没有统一的系统方法来访问磁盘的系统区域。每个磁盘制造商实现系统区域的方式不同，且没有行业标准，公开的工具也很少。存在一些专业的商业工具，如Ace
    Laboratory的PC-3000 (*[http://www.acelaboratory.com/catalog/](http://www.acelaboratory.com/catalog/)*
    ) 或 Atola Insight Forensic (*[http://www.atola.com/products/insight/supported-drives.html](http://www.atola.com/products/insight/supported-drives.html)*
    )，这些工具可以访问许多磁盘的服务区域。^([5](footnote.xhtml#fn26), [6](footnote.xhtml#fn27))
- en: In some cases, it’s possible to bypass the standard SATA, USB, or SAS interfaces
    and access storage media using debug or diagnostic ports built into the drive
    electronics. These interfaces may use serial RS-232/TTL, JTAG for chip access,^([7](footnote.xhtml#fn28))
    or undocumented vendor proprietary commands over the regular drive interface.
    Media access in this manner is not standard across manufacturers or even across
    drives from the same manufacturer.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，可以绕过标准的SATA、USB或SAS接口，通过驱动器电子组件内置的调试或诊断端口访问存储介质。这些接口可能使用串行RS-232/TTL、JTAG进行芯片访问，^([7](footnote.xhtml#fn28))或通过常规驱动器接口使用未公开的厂商专有命令。以这种方式访问介质在不同厂商之间，甚至在同一厂商的不同驱动器之间并不统一。
- en: For illustration purposes, the following example shows reading information over
    a serial interface on a Seagate Barracuda ST500DM002 drive. The drive has a serial
    port next to the SATA data plug and can be accessed with a USB 3V TTL cable. Standard
    serial terminal emulation software such as the Linux `cu` (connect UNIX) command
    is used in this example.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 为了说明，以下示例展示了如何通过串行接口读取Seagate Barracuda ST500DM002驱动器的信息。该驱动器在SATA数据插头旁边有一个串口，可以通过USB
    3V TTL电缆进行访问。在此示例中，使用标准的串行终端仿真软件，如Linux的`cu`（连接UNIX）命令。
- en: '[Figure 5-1](ch05.xhtml#ch5fig1) shows a photo of the USB cable connected to
    the pin block at the back of the drive.'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: '[图5-1](ch05.xhtml#ch5fig1)展示了连接到驱动器背面针脚块的USB电缆照片。'
- en: '![image](../images/f05-01.jpg)'
  id: totrans-181
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f05-01.jpg)'
- en: '*Figure 5-1: Serial port access to disk firmware*'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: '*图5-1：通过串口访问磁盘固件*'
- en: '**NOTE**'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: '**注意**'
- en: '***Warning:** This method should not be used without specialized training or
    tools. There is a risk of physically damaging the disk beyond repair.*'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: '***警告：** 在没有专业培训或工具的情况下，不应使用此方法。存在对磁盘造成无法修复的物理损坏的风险。*'
- en: After connecting a terminal and powering on the drive, a boot message is displayed.
    Entering CTRL-Z puts the drive in diagnostic mode with a command prompt from the
    drive firmware (similar to UNIX terminals or analog modems).
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 连接终端并打开驱动器电源后，会显示启动信息。按下CTRL-Z进入诊断模式，驱动器固件会显示命令提示符（类似于UNIX终端或模拟调制解调器）。
- en: '[PRE38]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'From thisdiagnostic interface, detailed underlying information about the disk
    can be retrieved. In the following example, a Level 2 `x` command reveals the
    internal physical drive geometry and partitioning for User and System areas:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 从这个诊断界面可以获取有关磁盘的详细底层信息。在以下示例中，Level 2 `x` 命令揭示了用户和系统区域的内部物理驱动器几何结构和分区：
- en: '[PRE39]'
  id: totrans-188
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: Diagnostic interfaces, such as this one, can provide access to disk sectors
    in the system areas and other information that is not otherwise accessible.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 诊断接口，例如此接口，可以提供访问系统区域中的磁盘扇区以及其他通常无法访问的信息。
- en: Online forums exist that discuss low-level disk access and recovery, for example,
    HDDGURU (*[http://forum.hddguru.com/index.php](http://forum.hddguru.com/index.php)*)
    and The HDD Oracle (*[http://www.hddoracle.com/index.php](http://www.hddoracle.com/index.php)*).
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 存在一些在线论坛讨论低级磁盘访问和恢复技术，例如HDDGURU (*[http://forum.hddguru.com/index.php](http://forum.hddguru.com/index.php)*)
    和 The HDD Oracle (*[http://www.hddoracle.com/index.php](http://www.hddoracle.com/index.php)*).
- en: Methods of accessing the underlying areas of SSD or flash storage media include
    the physical removal (desoldering) of memory chips, sometimes called *chip-off*.
    The memory contents from these chips can then be extracted and reconstructed into
    readable blocks of data.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 访问SSD或闪存存储介质底层区域的方法包括物理拆卸（去焊）内存芯片，有时被称为*chip-off*。然后可以提取这些芯片的内存内容，并将其重构为可读的数据块。
- en: Some devices (Internet-of-Things, mobile devices, and so on) may have a JTAG
    interface providing access to memory contents. JTAG is a well-documented standard
    and can be applied in a forensic context to extract data (see *[http://www.evidencemagazine.com/index.php?option=com_content&task=view&id=922](http://www.evidencemagazine.com/index.php?option=com_content&task=view&id=922)*).
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 一些设备（如物联网设备、移动设备等）可能具有JTAG接口，可以访问内存内容。JTAG是一个文档齐全的标准，并且可以在取证环境中应用来提取数据（参见 *[http://www.evidencemagazine.com/index.php?option=com_content&task=view&id=922](http://www.evidencemagazine.com/index.php?option=com_content&task=view&id=922)*）。
- en: Covering these techniques in more depth is beyond the scope of this book. I’ve
    mentioned JTAG interfaces and Serial access to disks for illustration purposes
    to make you aware that such techniques exist in the forensics industry.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 详细讲解这些技术已经超出了本书的范围。我提到JTAG接口和串行访问磁盘是为了说明这些技术在取证行业中是存在的。
- en: '**ATA Password Security and Self-Encrypting Drives**'
  id: totrans-194
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**ATA密码安全和自加密驱动器**'
- en: This section covers the standard security features implemented by the disk vendors.
    These features include drive locking, password protection, self-encrypting drives,
    and other security mechanisms. Although some of the features discussed here are
    not widely used, they are still important to understand in a professional forensic
    lab setting.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 本节内容涵盖了磁盘厂商实施的标准安全功能。这些功能包括驱动器锁定、密码保护、自加密驱动器和其他安全机制。尽管这里讨论的一些功能并未广泛使用，但在专业的取证实验室环境中了解它们仍然很重要。
- en: Password recovery techniques are not described in detail here. The examples
    demonstrate how to attach password-protected media to an acquisition host in preparation
    for imaging. It is assumed that passwords are already known.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 本书未详细描述密码恢复技术。示例展示了如何将密码保护的媒体连接到采集主机以准备镜像。假设密码已经是已知的。
- en: 'Methods of acquiring passwords are beyond the scope of this book, but recovery
    techniques may include the following:'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 获取密码的方法超出了本书的范围，但恢复技术可能包括以下几种：
- en: • Brute force, exhaustively attempting multiple passwords until the correct
    one is found.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: • 暴力破解，反复尝试多个密码直到找到正确的密码。
- en: • Finding passwords hidden or stored in an accessible location.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: • 找到隐藏或存储在可访问位置的密码。
- en: • Knowledge of password reuse across different accounts or devices. Recovery
    from one location provides access to all.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: • 了解不同账户或设备之间的密码复用。从一个地方恢复密码即可访问所有账户。
- en: • Depending on the jurisdiction, a person may be legally compelled to provide
    passwords.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: • 根据不同司法管辖区的规定，可能会依法强制要求提供密码。
- en: • The password may be volunteered by a friendly or cooperative owner (the victim
    perhaps) or a cooperating accomplice.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: • 密码可能由友好或合作的所有者（可能是受害人）或合作的同伙提供。
- en: • Enterprise IT environments may have key escrow or backups in place.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: • 企业IT环境中可能已设置密钥托管或备份。
- en: '***Identify and Unlock ATA Password-Protected Disks***'
  id: totrans-204
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***识别并解锁ATA密码保护的磁盘***'
- en: The ATA/ATAPI commands (*[http://www.t13.org/](http://www.t13.org/)*) specify
    a security feature set that restricts access to a disk using passwords. When this
    feature is enabled, the firmware prevents the execution of certain ATA commands,
    including access to content, until the required password is provided. This is
    only an access control feature and doesn’t use encryption to protect data on the
    disk.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: ATA/ATAPI 命令 (*[http://www.t13.org/](http://www.t13.org/)*) 指定了一组安全功能，使用密码限制对磁盘的访问。当启用此功能时，固件将阻止执行某些
    ATA 命令，包括访问内容，直到提供所需的密码。这仅仅是一种访问控制功能，并不使用加密来保护磁盘上的数据。
- en: 'The hdparm tool can determine if a disk has the security feature set enabled.
    For example:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: hdparm 工具可以确定磁盘是否启用了安全功能。例如：
- en: '[PRE40]'
  id: totrans-207
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: The `Commands/features:` information indicates the `Security Mode feature set`
    exists and is enabled, and the `Security:` information also confirms the feature
    is supported and enabled.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: '`Commands/features:` 信息表明 `Security Mode feature set` 存在并已启用，而 `Security:`
    信息也确认该功能已被支持并启用。'
- en: If `Security:` has `enabled` listed, a user password has been set, and the drive
    will be locked on boot. If the drive is locked, as in the preceding example, access
    to the drive is prevented until a correct password is provided. The OS may generate
    a device error or failed command error as it tries to access the disk. The T13
    standard outlines which commands are allowed when a disk is locked. Access to
    a number of commands, including to query SMART information, is still possible
    when a disk is locked.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 `Security:` 显示为 `enabled`，则表示已设置用户密码，并且磁盘将在启动时被锁定。如果磁盘被锁定，如前所述，磁盘的访问将被阻止，直到输入正确密码。操作系统在尝试访问磁盘时可能会生成设备错误或命令失败错误。T13
    标准概述了磁盘被锁定时允许哪些命令。即使磁盘被锁定，仍然可以访问一些命令，包括查询 SMART 信息。
- en: Two passwords can be set, user and master. If the user password is set, security
    is enabled (as shown in the preceding example). Setting the master password alone
    does not enable security.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 可以设置两个密码：用户密码和管理员密码。如果设置了用户密码，安全功能将启用（如前所述）。仅设置管理员密码不会启用安全功能。
- en: If a master password has never been set (it may still have a factory default
    password set), the `Master password revision code` will be set to 65534\. The
    first time the master password is set, this value is set to 1 and incremented
    each time the master password is set again.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 如果从未设置过管理员密码（它可能仍然使用出厂默认密码），则 `Master password revision code` 将设置为 65534。第一次设置管理员密码时，此值设置为
    1，并且每次重新设置管理员密码时都会递增。
- en: Two security levels control how correct passwords behave. The `Security level`
    refers to the `MASTER PASSWORD CAPABILITY` bit in the T13 standard and can be
    “high” or “maximum.” If the security level is set to high, either user or master
    passwords can unlock the drive. If the security level is set to maximum, the master
    password will allow security erase commands but only the user password can unlock
    the drive.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 两个安全级别控制密码的正确行为。`Security level` 指的是 T13 标准中的 `MASTER PASSWORD CAPABILITY` 位，安全级别可以是“高”或“最大”。如果安全级别设置为高，用户或管理员密码都可以解锁磁盘。如果安全级别设置为最大，管理员密码将允许执行安全擦除命令，但只有用户密码可以解锁磁盘。
- en: 'Some PCs might issue a security freeze command after booting to prevent further
    security commands from being sent, even with correct passwords (to prevent malicious
    password-setting attacks). The Security output from hdparm will indicate if a
    drive is frozen. Many USB bridges automatically spin up an attached disk in an
    unfrozen state, but if you still have difficulty, here are several possibilities
    to try:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 一些 PC 可能在启动后发出安全冻结命令，以防止进一步发送安全命令，即使提供了正确的密码（防止恶意密码设置攻击）。hdparm 的安全输出将指示磁盘是否被冻结。许多
    USB 桥接器会自动以未冻结状态启动连接的磁盘，但如果您仍然遇到困难，可以尝试以下几种方法：
- en: • Checking the BIOS for settings to enable/disable the freeze command
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: • 检查 BIOS 设置以启用/禁用冻结命令
- en: • Using a forensic boot CD that prevents freeze commands from being issued
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: • 使用防止发出冻结命令的取证启动 CD
- en: • Attaching the disk to a separate controller card (not built into the mainboard)
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: • 将磁盘连接到单独的控制卡（非主板集成）
- en: • Hot plugging the disk into the system (if supported)
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: • 热插拔磁盘到系统中（如果支持）
- en: • Using a mainboard that does not issue freeze commands
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: • 使用不发出冻结命令的主板
- en: 'If you know the user password and the drive security is not frozen, you can
    unlock the drive as follows:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您知道用户密码，并且磁盘安全未被冻结，您可以按以下方式解锁磁盘：
- en: '[PRE41]'
  id: totrans-220
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'By default, the user password is provided using hdparm, and the master password
    needs to be explicitly specified with an additional command line parameter. If
    you know the master password and the security level is set to high, you can use
    the master password to unlock the drive as follows:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，用户密码通过 hdparm 提供，主密码需要通过额外的命令行参数明确指定。如果您知道主密码并且安全级别设置为高，则可以使用主密码解锁硬盘，如下所示：
- en: '[PRE42]'
  id: totrans-222
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: If no passwords are known, access to the disk is not possible with regular tools.
    The password information is stored on the service/system areas of a disk and is
    generally not accessible without special hardware or tools. However, several further
    options are available and are discussed here.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 如果不知道任何密码，则无法使用常规工具访问硬盘。密码信息存储在硬盘的服务/系统区域，通常没有特殊硬件或工具是无法访问的。然而，仍然有若干其他选项可用，下面将进行讨论。
- en: The master password might be set to a factory default and can be used to gain
    access to the drive (if the security level is set to high and not maximum). You
    can easily find lists of factory default master passwords on the internet.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 主密码可能被设置为出厂默认密码，并可以用于访问硬盘（如果安全级别设置为高而非最高）。您可以轻松地在互联网上找到出厂默认主密码的列表。
- en: Using brute force to identify either the master or user password is inefficient,
    because the drive must be reset after five failed attempts. However, if you have
    a small set of likely passwords, multiple attempts become feasible and may lead
    to lucky success.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 使用暴力破解来识别主密码或用户密码是低效的，因为在五次失败尝试后，硬盘必须重置。然而，如果您有一个小的可能密码集，多次尝试就变得可行，并且可能会有幸运的成功。
- en: Specialized data recovery companies provide services and hardware tools that
    can recover or reset ATA Security Feature Set passwords from the service areas
    of a disk. Success is not guaranteed for all disks, but data recovery firms often
    list the disks they do support. In some cases, you might have to ship the disk
    to the firm’s laboratory, which may have chain-of-custody implications. See “[Drive
    Service Area Access](ch05.xhtml#ch05lev2sec10)” on [page 122](ch05.xhtml#page_122)
    for more information.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 专业的数据恢复公司提供服务和硬件工具，可以从硬盘的服务区域恢复或重置 ATA 安全功能集密码。并非所有硬盘都能成功恢复，但数据恢复公司通常会列出他们支持的硬盘型号。在某些情况下，您可能需要将硬盘寄送到公司的实验室，这可能涉及到所有权链的问题。有关更多信息，请参见[“驱动器服务区域访问”](ch05.xhtml#ch05lev2sec10)，见[第122页](ch05.xhtml#page_122)。
- en: The hard disk vendor may be able to provide assistance to disable or reset the
    ATA password. This will depend on the cooperation of the drive vendor, the ability
    to prove ownership of the disk and its contents, the authority of the requesting
    party, and the motivation for recovering the data.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 硬盘厂商可能能够提供帮助以禁用或重置 ATA 密码。这将取决于硬盘厂商的合作、证明硬盘及其内容所有权的能力、请求方的权限以及数据恢复的动机。
- en: Hardware and firmware hacks and published methods by researchers may exist that
    provide access for certain hard drive models. The security research community
    is regularly finding innovative ways to access and modify data in hard-to-reach
    places.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 可能存在硬件和固件破解方法以及研究人员发布的其他方法，可以为某些硬盘型号提供访问权限。安全研究社区定期发现创新的方式来访问和修改难以接触到的地方的数据。
- en: '***Identify and Unlock Opal Self-Encrypting Drives***'
  id: totrans-229
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***识别和解锁 Opal 自加密驱动器***'
- en: '*Self-encrypting drives (SEDs)* are a form of full-disk encryption (FDE). Unlike
    software-based FDE (TrueCrypt, FileVault, LUKS, and so on) where the OS manages
    the encryption, SEDs have encryption capabilities built directly into the drive
    electronics and firmware. SEDs are OS agnostic and are based on vendor-independent
    standards. The international body responsible for defining the standard is the
    Trusted Computing Group (TCG; *[http://www.trustedcomputinggroup.org/](http://www.trustedcomputinggroup.org/)*).
    The standard is the TCG Storage Security Subsystem Class: Opal, Specification
    Version 2.00.'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: '*自加密硬盘（SEDs）* 是一种全盘加密（FDE）的形式。与软件基础的 FDE（如 TrueCrypt、FileVault、LUKS 等）不同，后者由操作系统管理加密，而
    SEDs 则将加密功能直接集成到硬盘的电子和固件中。SEDs 与操作系统无关，基于厂商独立的标准。负责定义该标准的国际机构是可信计算集团（TCG；*[http://www.trustedcomputinggroup.org/](http://www.trustedcomputinggroup.org/)*）。该标准是
    TCG 存储安全子系统类：Opal，规范版本 2.00。'
- en: This section identifies drives with Opal encryption and describes how appropriate
    keys can be used to unlock the drive. The recovery of encryption keys is outside
    the scope of this book. The examples shown here assume the key is known.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 本节介绍具有Opal加密的驱动器，并描述如何使用适当的密钥解锁驱动器。加密密钥的恢复不在本书范围内。这里显示的示例假定密钥是已知的。
- en: A physical examination of the drive can already indicate if it is an Opal SED.
    The existence of a *Physical Secure ID (PSID)* string printed on the label of
    the drive is shown in [Figure 5-2](ch05.xhtml#ch5fig2). This string is used for
    the Opal RevertSP feature, which generates a new key securely, destroying all
    data and resetting the drive to its original factory state. The PSID cannot be
    queried from the drive and must be physically read or scanned if a QR code exists.
    The existence of a PSID string does not mean the drive is locked and passwords
    are set; it just indicates the drive supports Opal full-disk encryption.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 对驱动器进行物理检查可以判断它是否为Opal SED。驱动器标签上打印的*物理安全ID（PSID）*字符串如[图5-2](ch05.xhtml#ch5fig2)所示。该字符串用于Opal
    RevertSP功能，它会安全地生成一个新密钥，销毁所有数据并将驱动器重置为原始工厂状态。PSID不能从驱动器中查询，如果存在二维码，必须通过物理读取或扫描。PSID字符串的存在并不意味着驱动器已被锁定且设置了密码；它仅表示该驱动器支持Opal全盘加密。
- en: '![image](../images/f05-02.jpg)'
  id: totrans-233
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f05-02.jpg)'
- en: '*Figure 5-2: Opal SED PSID*'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: '*图5-2：Opal SED PSID*'
- en: Full-disk encryption has a chicken-and-egg problem. If an entire drive is encrypted,
    including the boot sector, how can the system execute the master boot record (MBR)
    and ask for a password or other security credentials? The solution was to implement
    a *shadow MBR* and store it in the system area of a disk (the same place where
    SMART data, bad block lists, and so on are stored). When an Opal disk is in a
    locked state, only the shadow MBR is visible to the host. It is a group of unencrypted
    sectors (can be large— 150MB in size, for example) that is executed as a normal
    MBR (the host is completely unaware that it is using a shadow MBR). This alternate
    boot area can execute code to request a password, access a Trusted Platform Module
    (TPM) chip or smartcard, or get other credentials. Once the disk has been unlocked,
    the proper MBR becomes visible, and a normal boot process can begin.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 全盘加密存在一个鸡和蛋的问题。如果整个驱动器被加密，包括引导扇区，那么系统如何执行主引导记录（MBR）并要求输入密码或其他安全凭证？解决方案是实现一个*影像MBR*并将其存储在磁盘的系统区域（与SMART数据、坏道列表等存储的地方相同）。当Opal磁盘处于锁定状态时，只有影像MBR对主机可见。它是一组未加密的扇区（可以很大——例如150MB），作为普通MBR执行（主机完全不知道它正在使用影像MBR）。这个替代启动区域可以执行代码来请求密码、访问受信任的平台模块（TPM）芯片或智能卡，或获取其他凭证。一旦磁盘解锁，正确的MBR就会变得可见，并且可以开始正常的启动过程。
- en: An open source command line tool was created to manage Opal SED encryption under
    Linux. Originally called msed, it was available at *[https://github.com/r0m30/msed/](https://github.com/r0m30/msed/)*,
    but the tool was recently renamed sedutil-cli and moved to *[https://github.com/Drive-Trust-Alliance/sedutil/](https://github.com/Drive-Trust-Alliance/sedutil/)*.
    This tool is still under development and may not work on all drives. Follow the
    instructions carefully and ensure that `libata.allow_tpm` is enabled in the kernel.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 创建了一个开源命令行工具来管理Linux下的Opal SED加密。最初称为msed，它可以在*[https://github.com/r0m30/msed/](https://github.com/r0m30/msed/)*找到，但该工具最近更名为sedutil-cli并移至*[https://github.com/Drive-Trust-Alliance/sedutil/](https://github.com/Drive-Trust-Alliance/sedutil/)*。该工具仍在开发中，可能无法在所有驱动器上工作。请仔细按照说明操作，并确保内核中启用了`libata.allow_tpm`。
- en: 'The following command scans the local system for all Opal-compliant SED drives.
    Out of four attached drives, one disk is detected as Opal version 2:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 以下命令扫描本地系统中的所有Opal兼容SED驱动器。在四个连接的驱动器中，检测到一个磁盘为Opal版本2：
- en: '[PRE43]'
  id: totrans-238
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'You can query the drive to find information about the Opal status, including
    if a disk is encrypted, locked, or has a shadow MBR (all three are shown in this
    example):'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以查询驱动器以查找有关Opal状态的信息，包括磁盘是否加密、锁定或是否有影像MBR（这三种情况在本示例中都有显示）：
- en: '[PRE44]'
  id: totrans-240
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Two commands can be issued: one to disable locking and the second to inform
    the disk that the shadow MBR is not needed (MBR is “Done”). In this example, *xxmonkey*
    is the password:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 可以发出两个命令：一个用于禁用锁定，另一个则告知磁盘不需要影像MBR（MBR为“完成”）。在本示例中，*xxmonkey*是密码：
- en: '[PRE45]'
  id: totrans-242
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'At this point, a kernel message (dmesg) might show a change in available devices.
    The status in this example now shows the following:'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 此时，内核消息（dmesg）可能显示可用设备的变化。此示例中的状态现在显示如下：
- en: '[PRE46]'
  id: totrans-244
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'The drive is no longer locked, and the shadow MBR is no longer visible. The
    proper MBR and the rest of the decrypted disk are available, and they can be accessed
    with regular forensic tools. Now the partition table of a Linux installation becomes
    visible, as shown in this example:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 驱动器不再被锁定，影子MBR不再可见。正确的MBR和解密后的磁盘其他部分可用，并且可以通过常规的取证工具访问。现在，Linux安装的分区表变得可见，如此示例所示：
- en: '[PRE47]'
  id: totrans-246
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: A locked drive that has no shadow MBR enabled will produce multiple error messages
    in the kernel dmesg output.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 一个没有启用影子MBR的锁定驱动器会在内核的dmesg输出中产生多个错误消息。
- en: The simple example described in this section was provided for illustration purposes
    only. Some Opal disks may behave differently with this tool. In real scenarios,
    the key might not be a simple password but instead be tied to the TPM or some
    other enterprise security mechanism. If the wrong commands are given in this situation,
    the data on the disk can be irrevocably destroyed (in an instant if the key is
    destroyed).
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 本节中描述的简单示例仅用于说明目的。一些Opal磁盘在使用该工具时可能会有不同的表现。在实际场景中，密钥可能不是简单的密码，而是与TPM或其他企业安全机制绑定。如果在这种情况下输入错误的命令，磁盘上的数据可能会被不可逆转地销毁（如果密钥被销毁，瞬间就会丧失）。
- en: From a forensics perspective, it may be useful to image the shadow MBR for analysis
    as well. It could contain interesting artifacts from the time the disk encryption
    was set up. It is also conceivable that data could be hidden in the shadow MBR
    region of Opal-capable drives.
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 从取证的角度来看，镜像影子MBR以供分析可能是有用的。它可能包含在磁盘加密设置时产生的有趣文物。也可以设想，数据可能隐藏在Opal兼容驱动器的影子MBR区域中。
- en: '***Encrypted Flash Thumb Drives***'
  id: totrans-250
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***加密闪存驱动器***'
- en: USB thumb drives sold as “secure” devices often come with a proprietary software
    encryption solution provided by the vendor. Some drives offer OS-independent encryption
    with authentication using keypads, fingerprint readers, or smartcards (see [Figure
    5-3](ch05.xhtml#ch5fig3)).
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 被销售为“安全”设备的USB闪存驱动器通常附带供应商提供的专有软件加密解决方案。一些驱动器提供操作系统独立的加密，并通过键盘、指纹识别器或智能卡进行身份验证（见[图5-3](ch05.xhtml#ch5fig3)）。
- en: '![image](../images/f05-03.jpg)'
  id: totrans-252
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f05-03.jpg)'
- en: '*Figure 5-3: Encrypted USB sticks*'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: '*图5-3：加密USB闪存驱动器*'
- en: Proprietary solutions might not have a compatible tool to manage access, making
    it difficult to acquire decrypted data with Linux. Devices with an onboard authentication
    mechanism should appear as a normal USB storage device after authentication.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 专有解决方案可能没有兼容的工具来管理访问权限，这使得使用Linux获取解密数据变得困难。带有内部认证机制的设备在认证后应显示为普通的USB存储设备。
- en: Secure thumb drives that are locked may behave differently when attached to
    a host. Some don’t provide any indication that they’ve been plugged into the host.
    Some appear as a removable media device without media (like a memory card reader).
    Some will appear as a CD-ROM and have software available to run or install, which
    manages the drive.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 被锁定的安全闪存驱动器在连接到主机时可能表现不同。有些不会提供任何已插入主机的提示。有些会表现为没有介质的可移动存储设备（如存储卡读取器）。有些会表现为CD-ROM，并提供软件运行或安装，以管理驱动器。
- en: Larger hardware-encrypted external drives also exist and may require a pin to
    unlock. An example of such a drive is described in [Chapter 7](ch07.xhtml#ch07)
    (see [Figure 7-1](ch07.xhtml#ch7fig1) on [page 216](ch07.xhtml#page_216)).
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 更大的硬件加密外部驱动器也存在，可能需要一个PIN码来解锁。此类驱动器的示例在[第7章](ch07.xhtml#ch07)中有所描述（见[图7-1](ch07.xhtml#ch7fig1)于[第216页](ch07.xhtml#page_216)）。
- en: '**Attach Removable Media**'
  id: totrans-257
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**附加可移动存储介质**'
- en: This section covers the attachment of devices that use removable storage media.
    The most common examples of removable media are optical discs, memory cards, and
    magnetic tapes. In a way, attaching removable storage media to an acquisition
    host occurs twice. First the device electronics are attached, and then in an additional
    step, the removable media is inserted. Let’s begin with a discussion on optical
    media drives.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 本节讨论了使用可移动存储介质的设备的连接。可移动介质最常见的例子是光盘、存储卡和磁带。以某种方式，将可移动存储介质连接到采集主机的过程分为两步。首先是设备电子组件的连接，然后在另一步中插入可移动介质。让我们从讨论光盘驱动器开始。
- en: '***Optical Media Drives***'
  id: totrans-259
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***光盘驱动器***'
- en: 'Optical drives are typically attached internally via SATA or externally via
    USB. The drives appear in the Linux device tree but without media. Running forensic
    commands on an empty drive produces obvious results, as shown here:'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 光盘驱动器通常通过SATA连接内部或通过USB连接外部。驱动器出现在Linux设备树中，但没有介质。在空驱动器上运行取证命令会产生明显的结果，如下所示：
- en: '[PRE48]'
  id: totrans-261
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Two useful commands provide information about the attached drive and inserted
    discs. The `cd-drive` command provides details about an attached optical drive
    (internal or external), including various features, supported media, and so on:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 两个有用的命令提供有关附加驱动器和插入光盘的信息。`cd-drive`命令提供关于附加光盘驱动器（内部或外部）的详细信息，包括各种功能、支持的媒体等：
- en: '[PRE49]'
  id: totrans-263
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'When you insert a disc into the drive, you can retrieve information about the
    media using the `cd-info` command. The result includes the mode, format, and information
    about the publisher:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 当你将光盘插入驱动器时，可以使用`cd-info`命令获取关于媒体的信息。结果包括模式、格式以及出版商的信息：
- en: '[PRE50]'
  id: totrans-265
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: You can eject the optical media using the `eject` shell command.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用`eject` shell命令弹出光盘媒体。
- en: Using write blockers on optical drives is unnecessary. No timestamps are updated
    simply by accessing files on a disc. Modifying an optical disc requires explicit
    burn instructions, reducing the risk of accidental modification.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 在光盘驱动器上使用写保护器是不必要的。仅仅通过访问光盘上的文件并不会更新时间戳。修改光盘需要明确的刻录指令，从而降低了意外修改的风险。
- en: '***Magnetic Tape Drives***'
  id: totrans-268
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***磁带驱动器***'
- en: You can determine a list of attached tape drives using the lshw tool and the
    tape class. The output provides information about the drive vendor, serial number,
    and device information.
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用lshw工具和磁带类来确定附加的磁带驱动器列表。输出提供关于驱动器供应商、序列号和设备信息的详细信息。
- en: 'In this example, two tape drives are found (LTO and DAT):'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，发现了两个磁带驱动器（LTO和DAT）：
- en: '[PRE51]'
  id: totrans-271
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'Magnetic tape drives are typically SCSI devices, which you can query using
    standard SCSI commands. The standard tool for controlling tapes is mt, which provides
    information about the drive status, controls the position of the tape, and ejects
    the media. The mt tool can provide basic information about the tape, but the tapeinfo
    tool is more comprehensive. In this example, the mt and tapeinfo tools query the
    status of an LTO tape drive with a loaded tape:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 磁带驱动器通常是SCSI设备，你可以使用标准SCSI命令查询。控制磁带的标准工具是mt，它提供关于驱动器状态的信息，控制磁带位置，并弹出媒体。mt工具可以提供有关磁带的基本信息，但tapeinfo工具更为全面。在这个例子中，mt和tapeinfo工具查询加载磁带的LTO磁带驱动器的状态：
- en: '[PRE52]'
  id: totrans-273
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: The tape head is positioned at the second file on the tape (file 1 is after
    file 0). The block offset and file offset are useful when you’re forensically
    acquiring individual files from a tape.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 磁带头位于磁带上的第二个文件位置（文件1位于文件0之后）。块偏移和文件偏移在法医收集磁带上的单个文件时非常有用。
- en: 'Using mt, you can rewind tapes and take them offline (eject them):'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 使用mt命令，你可以倒带磁带并将其下线（弹出它们）：
- en: '[PRE53]'
  id: totrans-276
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: When a tape device is attached to a Linux system, a number of corresponding
    devices are created.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 当磁带设备连接到Linux系统时，会创建多个相应的设备。
- en: '[PRE54]'
  id: totrans-278
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: The `st*` devices auto-rewind the tape after each command (which is not always
    desired), and the `nst*` devices are the nonrewinding devices. The `a`, `l`, and
    `m` characters represent the same device but with different characteristics (block
    size, compression). When you’re performing a forensic acquisition, you should
    use the `nst[*]` devices (without an additional `a`, `l`, or `m` character).
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: '`st*`设备在每个命令之后会自动倒带磁带（这并非总是所需的），而`nst*`设备则是非倒带设备。`a`、`l`和`m`字符代表相同的设备，只是具有不同的特性（如块大小、压缩）。在进行法医收集时，应该使用`nst[*]`设备（没有附加的`a`、`l`或`m`字符）。'
- en: '***Memory Cards***'
  id: totrans-280
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***内存卡***'
- en: Memory cards typically attach to a host using a USB adapter with multiple slots
    for different types of memory cards. When attached, the adapter creates a removable
    SCSI device for each slot (even when the slots are empty). This behavior can be
    observed in the following dmesg output.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 内存卡通常通过带有多个插槽的USB适配器连接到主机，以支持不同类型的内存卡。连接后，适配器为每个插槽创建一个可移动的SCSI设备（即使插槽为空）。这种行为可以通过以下的dmesg输出观察到。
- en: '[PRE55]'
  id: totrans-282
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'As you insert media into the slots, the media is made available as a USB mass
    storage device with a linear sequence of “sectors,” which you can forensically
    acquire. Continuing on from the previous example, a memory card has now been inserted
    into a slot of the card reader and appears as block device:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 当你将媒体插入插槽时，媒体会作为USB大容量存储设备提供，并具有线性的“扇区”序列，你可以进行法医收集。从前面的例子继续，一个内存卡现在已经插入到读卡器的插槽中，并作为块设备出现：
- en: '[PRE56]'
  id: totrans-284
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: Hardware-querying tools, such as hdparm and smartctl, may produce unreliable
    results, because memory cards don’t have the ATA features of more complex drives
    with dedicated drive circuitry.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 硬件查询工具，如hdparm和smartctl，可能会产生不可靠的结果，因为内存卡没有更复杂的驱动器和专用驱动电路的ATA功能。
- en: '**Attach Other Storage**'
  id: totrans-286
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**连接其他存储设备**'
- en: Sometimes storage media is attached to a forensic acquisition host and behaves
    in a unique way. In particular, it is useful to know about special behavior with
    portable devices, Apple computer systems, and NVME drives.
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，存储介质会连接到取证采集主机，并以独特的方式运行。特别是，了解便携设备、苹果计算机系统和NVME驱动器的特殊行为非常有用。
- en: '***Apple Target Disk Mode***'
  id: totrans-288
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***苹果目标磁盘模式***'
- en: TDM allows Apple computers with OpenBoot firmware or newer firmware to boot
    into a state where the Mac system appears as an external disk enclosure and the
    internal disks are available as SCSI target devices. Earlier TDM implementations
    used the FireWire bus but have since moved to Thunderbolt. You activate this mode
    by holding down the T key while powering on the Apple computer.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: TDM（Target Disk Mode）允许带有OpenBoot固件或更新固件的苹果计算机启动到一个状态，此时Mac系统会作为外部磁盘外壳显示，内部磁盘作为SCSI目标设备可用。早期的TDM实现使用FireWire总线，但现在已转向Thunderbolt。你可以通过在开机时按住T键来激活此模式。
- en: A Linux machine without a Thunderbolt adapter can use FireWire to achieve the
    same result with an adapter. [Figure 5-4](ch05.xhtml#ch5fig4) shows a photo of
    a Thunderbolt-to-FireWire adapter.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 没有Thunderbolt适配器的Linux机器可以使用FireWire适配器实现相同的效果。[图5-4](ch05.xhtml#ch5fig4)展示了一张Thunderbolt到FireWire适配器的照片。
- en: '![image](../images/f05-04.jpg)'
  id: totrans-291
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f05-04.jpg)'
- en: '*Figure 5-4: Thunderbolt to Firewire adapter*'
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: '*图5-4：Thunderbolt到FireWire适配器*'
- en: Be sure to boot the Apple device (while holding the T key) with the Thunderbolt-to-FireWire
    adapter already plugged in; otherwise, the Apple firmware will not use the FireWire
    adapter for the target device.
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 确保在插入Thunderbolt到FireWire适配器后（并按住T键）启动苹果设备，否则苹果固件不会使用FireWire适配器来作为目标设备。
- en: 'The following example shows dmesg output of an Apple notebook in TDM that is
    connected to a Linux machine using a Thunderbolt to FireWire adapter (Thunderbolt
    on the Apple; FireWire on the Linux machine):'
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例显示了一个连接到Linux机器的苹果笔记本的dmesg输出，该机器通过Thunderbolt到FireWire适配器连接（苹果使用Thunderbolt；Linux机器使用FireWire）：
- en: '[PRE57]'
  id: totrans-295
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: PC-based Linux systems with Thunderbolt ports are not common, and Linux kernel
    support is still under development. As an alternative, you can boot recent Apple
    computers with a forensic boot CD/USB device and acquire them to a locally attached
    evidence drive.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 配有Thunderbolt端口的PC型Linux系统不常见，而且Linux内核的支持仍在开发中。作为替代方案，你可以使用取证启动CD/USB设备启动最近的苹果计算机，并将其数据获取到本地连接的证据驱动器中。
- en: '***NVME SSDs***'
  id: totrans-297
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***NVME SSD***'
- en: NVME drives compete with SATA Express in the way they attach directly to a PCI
    Express bus. As of this writing, hardware write blockers for NVME drives are very
    new. There are hot-pluggable USB bridges for NVME and SATA Express drives from
    Tableau (Guidance Software). For illustration purposes, the examples shown here
    use an NVME device directly attached to a Linux system.
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: NVME驱动器与SATA Express在连接到PCI Express总线的方式上竞争。截止目前，NVME驱动器的硬件写保护器非常新。Tableau（Guidance
    Software）提供了适用于NVME和SATA Express驱动器的热插拔USB桥接器。为了说明，下面的示例使用了直接连接到Linux系统的NVME设备。
- en: 'You can use the nvme tool from the nvme-cli software package to list the attached
    NVME devices:'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用nvme-cli软件包中的nvme工具列出已连接的NVME设备：
- en: '[PRE58]'
  id: totrans-300
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'You should also check each NVME drive for multiple namespaces by using the
    nvme tool. In this example, only a single namespace exists:'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 你还应该使用nvme工具检查每个NVME驱动器的多个命名空间。在这个示例中，只有一个命名空间存在：
- en: '[PRE59]'
  id: totrans-302
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: Multiple namespaces may need to be acquired individually. This is a fundamental
    difference from other drives where a single drive is viewed as a linear set of
    sectors, which you can acquire in a single pass. NVME drives with multiple namespaces
    will likely need special consideration.^([8](footnote.xhtml#fn29))
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 可能需要单独获取多个命名空间。这与其他驱动器有根本区别，后者将单个驱动器视为一组线性的扇区，可以一次性获取。具有多个命名空间的NVME驱动器可能需要特别注意。^([8](footnote.xhtml#fn29))
- en: 'It’s important to note that the NVME standard was created from scratch without
    backward compatibility with SCSI or ATA standards (AHCI, and so on). It has its
    own command set and operates independently from other disk systems. For this reason,
    some tools may not work as expected with NVME hardware. Any forensic tool operating
    directly on low-level device drivers, such as SATA or SAS, will not work with
    NVME. However, if forensic tools operate on the virtual block layer, they should
    continue to work normally. In addition, PCI forensic write blockers may act as
    a bridge and make the device appear as a SCSI device. For example, here the Sleuth
    Kit mmls tool is used on an NVME drive attached to the examination host:'
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 需要注意的是，NVME标准是从零开始创建的，并且与SCSI或ATA标准（如AHCI等）不具备向后兼容性。它有自己的一套命令集，并独立于其他磁盘系统运行。因此，一些工具可能无法与NVME硬件正常配合使用。任何直接操作低级设备驱动程序的取证工具（如SATA或SAS）将无法与NVME配合使用。然而，如果取证工具操作的是虚拟块层，它们应该能够正常工作。此外，PCI取证写保护器可能充当桥接作用，使设备看起来像SCSI设备。例如，以下是使用Sleuth
    Kit mmls工具对连接到检查主机的NVME驱动器进行操作的示例：
- en: '[PRE60]'
  id: totrans-305
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: Notice that the device is `nvme1n1` and not simply `nvme1`. The namespace of
    the drive must be specified when you’re using commands on NVME drives.
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，设备是`nvme1n1`而不仅仅是`nvme1`。在对NVME驱动器使用命令时，必须指定驱动器的命名空间。
- en: 'As with other drives, NVME drives have a SMART log, but you can’t access it
    with current versions of smartctl (as of this writing). However, you can use the
    nvme tool to extract the SMART log as follows:'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 与其他驱动器一样，NVME驱动器也有SMART日志，但你无法通过当前版本的smartctl访问它（截至目前）。然而，你可以使用nvme工具提取SMART日志，方法如下：
- en: '[PRE61]'
  id: totrans-308
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: The nvme tool has a number of features for querying attached NVME drives. See
    the nvme(1) manual page or visit *[https://github.com/linux-nvme/](https://github.com/linux-nvme/)*
    for more information.
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: nvme工具有许多用于查询连接的NVME驱动器的功能。请参阅nvme(1)手册页面或访问*[https://github.com/linux-nvme/](https://github.com/linux-nvme/)*了解更多信息。
- en: As of this writing, NVME drives are an emerging technology. Because they have
    numerous benefits in terms of performance and efficiency, they may become more
    popular in the future.
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 截至目前，NVME驱动器是一项新兴技术。由于它们在性能和效率方面有许多优点，未来它们可能会变得更加流行。
- en: '***Other Devices with Block or Character Access***'
  id: totrans-311
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***其他具有块或字符访问权限的设备***'
- en: You can image any device that is detected as a block device by the Linux kernel.
    Some devices will appear as a block device the moment they are attached to the
    host system. For example, many generic MP3/music players, cameras, and other mobile
    devices behave in this manner.
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以对任何被Linux内核识别为块设备的设备进行成像。一些设备在连接到主机系统时会立即显示为块设备。例如，许多通用的MP3/音乐播放器、相机和其他移动设备就是如此。
- en: Some devices need to be switched into a different “disk” mode before they can
    become accessible as a block device. Often, you can select this mode from the
    device’s user interface.
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 一些设备需要切换到不同的“磁盘”模式，才能作为块设备进行访问。通常，你可以通过设备的用户界面选择该模式。
- en: Some USB devices are multifunctional and may provide other USB modes in addition
    to storage. You might need to switch the mode on these devices to usb-storage
    before acquiring them. A Linux tool called usb_modeswitch is able to query some
    multifunction USB devices and switch modes.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 一些USB设备是多功能的，除了存储功能外，它们还可能提供其他USB模式。在进行采集之前，你可能需要将这些设备切换到usb-storage模式。一个名为usb_modeswitch的Linux工具能够查询一些多功能USB设备并切换模式。
- en: '**Closing Thoughts**'
  id: totrans-315
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**结束思考**'
- en: In this chapter, you learned to attach a subject drive to an acquisition machine
    and positively identify the device for imaging. You learned different aspects
    of PC hardware (USB, PCI, block devices, and so on), how to query your acquisition
    system, and how to query your drive for firmware and SMART information. I demonstrated
    the removal of the HPA and DCO as well as various types of security built into
    the hardware of some drives. You are now equipped with the knowledge necessary
    to perform a forensic acquisition, which will be the focus of [Chapter 6](ch06.xhtml#ch06).
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你学习了如何将一个主题驱动器连接到采集机器并正确识别设备以进行成像。你学习了计算机硬件的不同方面（如USB、PCI、块设备等），如何查询你的采集系统，以及如何查询驱动器的固件和SMART信息。我演示了如何移除HPA和DCO，以及一些驱动器硬件中内置的各种安全功能。现在，你已经掌握了进行取证采集所需的知识，而这将是[第六章](ch06.xhtml#ch06)的重点内容。
