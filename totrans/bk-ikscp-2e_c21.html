<html xmlns="http://www.w3.org/1999/xhtml" xmlns:dk="http://www.kirsanov.com" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:svg="http://www.w3.org/2000/svg" epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en">
	<head>
		<meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>
		<title>Chapter 21: Tutorial: Creating an Animation</title>
		<link href="NSTemplate_v1_inkbook.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:53262340-c02e-40d5-9273-c34656cedc88" name="Adept.expected.resource"/>
	</head>
	<body>
		<section><a id="ch21"/>
		<header>
				<h1 class="chapterTitle"><span class="ChapterNumber"><span epub:type="pagebreak" id="Page_423" title="423"/>21</span><br/><span class="ChapterTitle">Tutorial: Creating an Animation</span></h1>
			</header>
			<p class="ChapterIntro"><a id="423"/>From the start, SVG was meant as a language for both static and animated vector
graphics. It supports both scripted and declarative animation.
For better or worse, however, animated SVG on the web never really caught on, and now it seems like
the days of vector animation of any kind (such as Flash) are behind us. HTML + JavaScript or pure video are now what mostly move things online.</p>
			<p>Inkscape does not 
support animated SVG documents (although you can add animation attributes
manually via the XML Editor) and can display SVG documents only statically. Still, you 
can use Inkscape to create static frames and then combine them into an animated GIF
or a video—although without timeline control, it's difficult to work on anything longer than
several frames long.</p>
			<a id="section21.1"/><h2>21.1 Creating the Template</h2>
			<p>
				The easiest way to create animation frames in Inkscape is by putting them on
separate layers (<a href="c04.xhtml#section4.9">4.9</a>). By toggling adjacent layers to be visible, you can see how your
frames stack up and control what changes from one frame to the next. <a id="424"/><span epub:type="pagebreak" id="Page_424" title="424"/>Creating
many layers manually is tedious, so I wrote a simple Python
script that creates a 200×200 px document with 100 empty layers:</p>
			<pre>print ("""&lt;svg width="200" height="200"  xmlns:svg="http://www.w3.org/2000/svg"  xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"&gt;""")
for i in range(100): print ('&lt;g inkscape:groupmode="layer" display="none" id="%03d"/&gt;' % (i + 1))
print ('&lt;/svg&gt;')</pre>
			<p>
				All layers are created hidden (that's what <code>display="none"</code> is for), so in
Inkscape, you will need to unhide them one by one (<a href="c04.xhtml#section4.9.3">4.9.3</a>) to draw on them. You can change
the number of layers that the script creates (<code>range(100)</code>) as well as the artboard’s dimensions
(<code>width="200" height="200"</code>). Save the script into a file named generate-layers.py, and at a command prompt,
run it and capture its output to an SVG file. (You will need Python installed on your computer; get it at<a href="https://python.org/">https://python.org/</a>.) Then, run Inkscape on this file:</p>
			<pre>$ python generate-layers.py &gt; ani.svg
$ inkscape ani.svg</pre>
			<p>
				You can also put the resulting file
(ani.svg) into your ~/.inkscape/templates folder, where it will
work as a template, so the next time you will be able to create an empty 100-layer file
by choosing it from the <span class="ui">File<span class="MenuArrow"> ▶ </span>New</span> list. <a href="#fig21-1">Figure 21-1</a> shows Inkscape's <span class="ui">Layers</span> dialog (<a href="c04.xhtml#section4.9.4">4.9.4</a>) with the multilayer file loaded.</p>
			<a id="fig21-1"/><figure>
				<img alt="" src="tuts/t03-01.svg.png"/>
				<figcaption>
					<p>Figure 21-1: A 100-layer animation template loaded into Inkscape</p>
				</figcaption>
			</figure>
			<a id="section21.2"/>
			<h2>21.2 Creating the Character</h2>
			<p>
				Let's make an animation of a dancing man, which is fun yet simple enough not to require much drawing skill and fits the animation’s small format.
My hero's claim to fame will be the way he moves, so I don't need to make
him look too sophisticated. A simple stick figure will do (<a href="#fig21-2">Figure 21-2</a>).</p>
			<a id="fig21-2"/><figure>
				<img alt="" src="tuts/t03-02.svg.png"/>
				<figcaption>
					<p>Figure 21-2: The stick figure, showing its nodes in the Node tool</p>
				</figcaption>
			</figure>
			<p><a id="425"/><span epub:type="pagebreak" id="Page_425" title="425"/>It consists of three simple paths (arms, legs, and body) and one ellipse (head). Use
the Pen tool (<a href="c14.xhtml#section14.1.1">14.1.1</a>) with Ctrl to draw horizontal/vertical straight lines;
use the Ellipse tool (<a href="c11.xhtml#section11.4">11.4</a>) to create the head. To facilitate
interpolation, do <span class="ui"><strong>Path<span class="MenuArrow"> ▶ </span>Combine</strong></span> on the body and limbs so they become one path,
and use Ctrl-Alt-click in the Node tool (<a href="c12.xhtml#section12.5.3">12.5.3</a>) to add nodes in his elbow and
knee joints.</p>
			<a id="section21.3"/><h2>21.3 Tweening</h2>
			<p>
				Now make a copy of the character by duplicating it (Ctrl-D with both head
and body selected), move it to the right, and play with its nodes (in the Node tool) to give
our man a funky dancing pose (<a href="#fig21-3">Figure 21-3</a>). This provides the two <em>keyframes</em>, and the entire animation
could be as simple as alternating between them.</p>
			<a id="fig21-3"/><figure>
				<img alt="" src="tuts/t03-03.svg.png"/>
				<figcaption>
					<p>Figure 21-3: Two keyframes</p>
				</figcaption>
			</figure>
			<p>
				Let's add some intermediate frames to make the transition
between the keyframes smoother. Animators call this <em>tweening</em> (derived from<em>between</em>). Select both
bodies (that is, the two path objects) and do <span class="ui"><strong>Extensions<span class="MenuArrow"> ▶ </span>Generate from Path<span class="MenuArrow"> ▶ </span>Interpolate</strong></span>. 
Specify the number of <span class="ui"><strong>Interpolation steps</strong></span> (say, 4), select <span class="ui"><strong>Interpolation
method 1</strong></span>, and, if desired, use a nonzero <span class="ui"><strong>Exponent</strong></span> value to make the movement speed up
or slow down nonlinearly. Then, create the heads for each of the tweened bodies
by interpolating the two ellipses, using the same number of steps and the same <span class="ui">Exponent</span> (<a href="#fig21-4">Figure 21-4</a>).</p>
			<a id="fig21-4"/><figure>
				<img alt="" src="tuts/t03-04.svg.png"/>
				<figcaption>
					<p>Figure 21-4: Interpolating the keyframes</p>
				</figcaption>
			</figure>
			<p>
				If the tweening steps don't look right to you, undo the interpolation, tweak
the keyframes, and re-interpolate until you get what you like. <span class="ui">Interpolation method 1</span>
matches the nodes that are at the same position along the path, so it works best
when one keyframe path was created by tweaking the other one without
adding or removing nodes (as in our case). If two paths are of different origin and have
incompatible nodes, <span class="ui">method 2</span> is better.</p>
			<a id="section21.4"/><h2>
				21.4 <a id="426"/><span epub:type="pagebreak" id="Page_426" title="426"/>Compositing</h2>
			<p>
				Let's place our animation in its proper place on the canvas and distribute
the frames across layers. Remove the tweening and move the second keyframe
right over the first. (Note that the dancer's right foot coincides in both
keyframes because it rests on the floor.) Select both overlapping figures and place them
on the canvas, scaling if necessary and leaving space for whatever
other elements you plan to add (such as a text heading). Finally, interpolate the bodies
and the heads again—in place, as shown in <a href="#fig21-5">Figure 21-5</a>.</p>
			<a id="fig21-5"/><figure>
				<img alt="" src="tuts/t03-05.svg.png"/>
				<figcaption>
					<p>Figure 21-5: Interpolating in place</p>
				</figcaption>
			</figure>
			<p>The next task is a bit boring.
You need to ungroup the interpolation paths and manually place
each one on its own layer, from 002 to 005, with the keyframes occupying layers 001 and
006. Then, duplicate the frames in the reverse order: frames 005 to 001 will go into
range 007 to 011 to make the dancer smoothly return into the original position.</p>
			<p>Use Shift-Page Up and Shift-Page Down to move the selected objects one
layer up/down, and watch the status bar that shows in which layer your selected
objects are located. Alternatively, you can cut (Ctrl-X) an object, switch to the
destination layer, and paste it in place (Ctrl-Alt-V).  Finally, make sure
all the layers you've used are visible, and save the SVG file.</p>
			<a id="section21.5"/><h2>21.5 Exporting</h2>
			<p>You can export the layers manually, but that would be tedious—especially
if you need to do it again after viewing the result and making changes
to the source. Fortunately, Inkscape has convenient command line parameters, so I wrote
another Python script to automate the export:</p>
			<pre>import os, sys
for i in range(int(sys.argv[2]), int(sys.argv[3]) + 1): os.system("""inkscape --export-fileid=%s-%03d.png --export-id=%03d \ --export-id-only --export-dpi=400 --export-area-page \ --export-background-opacity=1 %s""" % (sys.argv[1], i, i, sys.argv[1]))
os.system("convert -loop 0 -delay 10 %s-*.png %s" % (sys.argv[1], sys.argv[4]))</pre>
			<p><a id="427"/><span epub:type="pagebreak" id="Page_427" title="427"/>The script takes as parameters the name of the
source file, the numbers of the start and end layers to export, and the name of the
resulting GIF. It calls Inkscape to export each layer separately; then, it calls the <code>convert</code> utility from ImageMagick to combine the frames into an animated GIF file
that can then be viewed in any web browser.</p>
			<p>Save it as produce-gif.py and run:</p>
			<pre>$ python produce-gif.py ani.svg 001 011 stick.gif
Exporting only object with id="001"; all other objects hidden
DPI: 400
Background RRGGBBAA: ffffffff
Area 0:0:100:100 exported to 444 x 444 pixels (400 dpi)
Bitmap saved as: ani.svg-001.png
Exporting only object with id="002"; all other objects hidden
...
Exporting only object with id="011"; all other objects hidden
...</pre>
			<p>
				View the output at <a href="http://www.kirsanov.com/inkscape-animation/stick.gif">http://www.kirsanov.com/inkscape-animation/stick.gif</a>.</p>
			<aside epub:type="sidebar">
				<div class="top hr">
					<hr/>
				</div>
				<section class="note">
					<h2><span class="NoteHead">NOTE</span></h2>
					<p>
						Instead of the <code>convert</code> utility from ImageMagick, you
can use the open source Gifsicle program (<a href="http://www.lcdf.org/gifsicle">http://www.lcdf.org/gifsicle</a>) for composing
frames into an animated GIF file. Its advantage is that it can optimize the animation to 
reduce its file size.</p>
					<div class="bottom hr">
						<hr/>
					</div>
				</section>
			</aside>
			<a id="section21.6"/>
			<h2>21.6 Freehand Drawing</h2>
			<p>So far, our stick-figure animation looks at best mildly engaging. This smooth, vectory style
is good for technical animations, such as demonstrating the workings of a machine, but
it's not too inspiring for an animated dance.</p>
			<p>
				To improve the stick figure, hide all layers except <code>001</code>, select the figure, and lower its
opacity. Then arm yourself with the Calligraphic pen (<a href="c14.xhtml#section14.2">14.2</a>), select a <span class="ui"><strong>Width</strong></span> of 20
with <span class="ui"><strong>Tremor</strong></span> of 40, and draw freehand strokes over the stick figure. Try to make it more random, funky, and
personalized; add more pronounced feet and fists and more human-like body forms (<a href="#fig21-6">Figure 21-6</a>).</p>
			<a id="fig21-6"/><figure>
				<img alt="" src="tuts/t03-07.svg.png"/>
				<figcaption>
					<p>Figure 21-6: Humanizing the figure with Calligraphic pen</p>
				</figcaption>
			</figure>
			<p>
				When done, delete the original skeleton figure. It has served its function of a blueprint
and is no longer needed. The result looks a bit foreign in its
roughness upon the immaculate white background. To fix this, reduce the width of the pen
to 1 and add some thin random strokes around the dancer, hinting at his limbs' motion
and shadows on the floor, as shown in <a href="#fig21-7">Figure 21-7</a>.  Don't <a id="428"/><span epub:type="pagebreak" id="Page_428" title="428"/>worry if this looks <em>too</em> random—in the moving figure, this randomness will come alive and seem natural.</p>
			<a id="fig21-7"/><figure>
				<img alt="" src="tuts/t03-08.svg.png"/>
				<figcaption>
					<p>Figure 21-7: Skeleton removed, motion noise added</p>
				</figcaption>
			</figure>
			<p>
				The main rule with this kind of project is <em>don't copy</em>. Freehand roughness
cannot be recycled. No matter how similar one frame is to another, you need to sketch
each frame entirely from scratch, using nothing but the stick figure as your
guide. Duplicating the freehand strokes—even if you move or scale them—instantly
kills the rough, natural feel and makes your animation wooden and dull. Don't be lazy; the
more you draw the easier it gets. Check out the complete hand-drawn
animation at<a href="http://www.kirsanov.com/inkscape-animation/rough.gif">http://www.kirsanov.com/inkscape-animation/rough.gif</a>.</p>
			<p>You can use the same technique to trace with the Calligraphic pen over an imported bitmap manually.
Make the bitmap half-transparent and sketch on top of it,
trying to highlight the most important features and ignore the rest. In an animation,
the source bitmaps might be frames of a video, still photos, or rendered 3D
images.</p>
			<a id="section21.7"/><h2>21.7 Adding Text</h2>
			<p>Let's move the entire animation down to free up some space for a
text heading above it. Unhide all layers, select all objects on all layers (Ctrl-Alt-A), and
move them downward.</p>
			<p>The banner on our animation will be just a single word: "dance!". Can
we do something more interesting than copying the same static text object into each
frame?</p>
			<p>
				We could use the Calligraphic pen to draw ruffled handwritten letters
over some text object used as a guide—rendering the entire animation in the same 
style. However, for the purpose of demonstration, let's try something different: make the
text banner wave smoothly as if on a flag. We could use the<span class="ui">Envelope Deformation</span> path effect (<a href="c13.xhtml#section13.3.3">13.3.3</a>), but it's probably easier to apply some
node sculpting instead (<a href="c12.xhtml#section12.5.7.2">12.5.7.2</a>).</p>
			<p>
				To begin, create a text object using a nice-looking font, convert it to path
(Shift-Ctrl-C), ungroup (Ctrl-U), union (Ctrl-+), switch to the Node tool (F2), select all nodes
(Ctrl-A), and Alt-drag one of them. The entire shape will smoothly
bend and stretch, as <a href="#fig21-8">Figure 21-8</a> demonstrates. If the letter shapes become too distorted, undo the drag and
press Insert a couple times, each time <a id="429"/><span epub:type="pagebreak" id="Page_429" title="429"/>doubling the number of nodes—this
usually helps make the path you're sculpting behave more naturally.</p>
			<a id="fig21-8"/><figure>
				<img alt="" src="tuts/t03-09.svg.png"/>
				<figcaption>
					<p>Figure 21-8: Node sculpting on a text banner</p>
				</figcaption>
			</figure>
			<p>
				Make two copies of the text object, sculpt each one differently—so they look like
two shots of a banner floating in the wind—and interpolate between them. Then, just as
we did for the dancer figure, distribute the interpolation steps into layers, placing
them above the figure on the canvas (<a href="#fig21-9">Figure 21-9</a>). Don't worry about precise placement; slight banner wobbling isn’t a problem.</p>
			<a id="fig21-9"/><figure>
				<img alt="" src="tuts/t03-10.svg.png"/>
				<figcaption>
					<p>Figure 21-9: Interpolating the banner</p>
				</figcaption>
			</figure>
			<p>
				To see where to place each object relative to the previous layer, use the<span class="ui"><strong>Opacity</strong></span> control on the <span class="ui"><strong>Layers</strong></span> dialog to make the previous layer temporarily
half-transparent. Compose the animated GIF again using the produce-gif.py
script. <a href="#fig21-10">Figure 21-10</a> shows the frames 001
to 005.</p>
			<a id="fig21-10"/><figure>
				<img alt="" src="tuts/t03-11.svg.png"/>
				<figcaption>
					<p>Figure 21-10: Half of the animation's frames (forward movement)</p>
				</figcaption>
			</figure>
			<p>
				Visit <a href="http://www.kirsanov.com/inkscape-animation/with-banner.gif">http://www.kirsanov.com/inkscape-animation/with-banner.gif</a> to see the result so far.</p>
				<a id="section21.8"/>
				<h2>
				21.8 <a id="430"/><span epub:type="pagebreak" id="Page_430" title="430"/>Adding Color</h2>
			<p>
				The only thing not to like about our animation is its total lack of color. Let's add a different colored background to each frame—for a real stroboscopic
dance floor effect. To automate the random color selection, create a
rectangle with an unset color and use the <span class="ui"><strong>Create Tiled Clones</strong></span> dialog (<a href="c16.xhtml#section16.6">16.6</a>) to multiply it
with some hue variation.</p>
			<p>
				Paint the "dance!" banner with a contrasting bright color, also varying from frame to
frame. Finally, to make the dancing man stand out from the background, add an elliptic
gradient "spotlight" behind him; randomly move, scale, and rotate the spotlight on each
frame for an additional energizing effect. The final version is at<a href="http://www.kirsanov.com/inkscape-animation/final.gif">http://www.kirsanov.com/inkscape-animation/final.gif</a>. Enjoy!</p>
		</section>
	</body>
</html>