<html><head></head><body>
<div id="sbo-rt-content" class="calibre1"><section aria-labelledby="ch21" epub:type="chapter" role="doc-chapter">
<hgroup>
<h2 class="title" id="ch21">
<span class="cn"><span aria-label=" Page 247. " epub:type="pagebreak" id="pg_247" role="doc-pagebreak" class="calibre2"/><span class="sans_dogma_ot_bold_b_">21</span></span>
<span class="ct1"><span class="sans_dogma_ot_bold_b_">PSEUDO-ENVIRONMENT VARIABLES</span></span>
</h2>
</hgroup>
<figure class="opener"><img alt="" class="opener1" height="407" src="../images/chapter.jpg" width="408"/>
</figure>
<p class="chapterintro">I introduced environment variables in <span class="xref1"><a href="chapter2.xhtml" class="calibre4">Chapter 2</a></span> with the <span class="sans_thesansmonocd_w5regular_1">set</span> command, and they have found their way onto nearly every page since. You can define and resolve a simple variable and then maybe reset and use it again in various ways. <i class="calibre13">Pseudo-environment variables</i> are similar but also quite distinct. You can resolve them just like regular environment variables, but their origins or how they are set are substantially different.</p>
<p class="tx">We’ve already discussed a few pseudo-environment variables, including <span class="sans_thesansmonocd_w5regular_">path</span>, <span class="sans_thesansmonocd_w5regular_">pathext</span>, <span class="sans_thesansmonocd_w5regular_">cd</span>, and <span class="sans_thesansmonocd_w5regular_">errorlevel</span>. All pseudo-environment variables share some characteristics, but many have unique qualities. There are different means of setting many of them, and some you should never set at all. Some are active before you run a bat file, and the interpreter updates others repeatedly during an execution.</p>
<p class="tx"><span aria-label=" Page 248. " epub:type="pagebreak" id="pg_248" role="doc-pagebreak"/>Each pseudo-environment variable has an intrinsic quality in the Batch universe that you must understand before properly using it. In this chapter, I’ll explain the intricacies of some pseudo-environment variables already touched on and explore some useful ones that we’ll use in future chapters. I’ll also provide the long-promised explanation of the primary difference between bat and cmd files from the coder’s perspective.</p>
<section aria-labelledby="sec1" epub:type="division">
<h3 class="h" id="sec1"><span id="h1-143"/><span class="sans_futura_std_bold_b_">Date and Time</span></h3>
<p class="tni">You can easily retrieve the current date and time with the aptly named <span class="sans_thesansmonocd_w5regular_">date</span> and <span class="sans_thesansmonocd_w5regular_">time</span> pseudo-environment variables, respectively:</p>
<pre class="pre"><code class="calibre11">&gt; con echo Date = "%date%";  Time = "%time%"</code></pre>
<p class="tx">This command would have produced the following output if executed shortly after the Boston Red Sox snapped their 86-year championship drought:</p>
<pre class="pre"><code class="calibre11">Date = "Wed 10/27/2004";  Time = "23:39:12.34"</code></pre>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">date</span> variable contains the current date, formatted as day of week, month, day, and year. The day of the week always presents as a three-character mixed-case abbreviation, followed by a space, a two-byte month, a forward slash, a two-byte day, another slash, and a four-byte year. For instance, <span class="sans_thesansmonocd_w5regular_">Sun 06/08/1986</span> is an example from the early Batch era.</p>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">time</span> variable contains the current time, formatted as hours, minutes, seconds, and hundredths of seconds. It uses military time or a 24-hour clock, so 11:39 <small class="calibre5">PM</small> translates to <span class="sans_thesansmonocd_w5regular_">23:39:00.00</span>. If the hour is a single digit, Batch precedes it with a space instead of a leading zero; just before the stroke of 10:00 <small class="calibre5">AM</small>, <span class="sans_thesansmonocd_w5regular_">time</span> resolves to a space followed by <span class="sans_thesansmonocd_w5regular_">9:59:59.99</span>, and midnight presents as a space followed by <span class="sans_thesansmonocd_w5regular_">0:00:00.00</span>.</p>
<p class="tx">It’s certainly an oddity, but keep in mind that <span class="sans_thesansmonocd_w5regular_">time</span> has a leading space in lieu of a zero, while <span class="sans_thesansmonocd_w5regular_">date</span> has a leading <span class="sans_thesansmonocd_w5regular_">0</span> for all the one-digit months and days of the month.</p>
<p class="tx">Since <span class="sans_thesansmonocd_w5regular_">date</span> and <span class="sans_thesansmonocd_w5regular_">time</span> are nicely formatted, you can easily use them to enhance reports and logfiles, and because <span class="sans_thesansmonocd_w5regular_">date</span> is consistently formatted, it’s easy to substring out a datestamp, formatted as <span class="sans_thesansmonocd_w5regular_">CCYYMMDD</span>, as shown in <a href="#Lis21-1" class="calibre3">Listing 21-1</a>.</p>
<span id="Lis21-1"/>
<pre class="pre"><code class="calibre11">set #=%date%
set datestamp=%#:~10,4%%#:~4,2%%#:~7,2%
</code></pre>
<p class="listingcaption"><span class="futura_std_book_oblique_i_">Listing 21-1: Two commands in the</span> <span class="sans_futura_std_book_">Datestamp.bat</span> <span class="futura_std_book_oblique_i_">bat file to build a datestamp</span></p>
<p class="tni">(To save keystrokes I like to use the pound sign as a very short variable name, but only for a very concise and limited use. Using this variable much later in the bat file would be confusing, but using it immediately within the next line or two is a nice way to condense the code. Though I must admit that <span class="sans_thesansmonocd_w5regular_">%#:~7,2%</span> is esoteric and not to everyone’s liking.)</p>
<p class="tx"><span aria-label=" Page 249. " epub:type="pagebreak" id="pg_249" role="doc-pagebreak"/>Using a different technique, here’s the code to build a timestamp formatted as <span class="sans_thesansmonocd_w5regular_">HHMMSSss</span>:</p>
<pre class="pre"><code class="calibre11">set timestamp=%time: =0%
set timestamp=%timestamp::=%
set timestamp=%timestamp:.=%
</code></pre>
<p class="tni">The first command replaces the leading space, if it exists, with a <span class="sans_thesansmonocd_w5regular_">0</span>. The next two commands remove the two colons and the decimal point.</p>
<p class="tx">Unless coding and testing before 10 <small class="calibre5">AM</small>, it’s disturbingly easy to forget about the leading space, but it’s critical. If you miss it while testing in the afternoon, the variable will suddenly contain a space at the stroke of midnight, and depending on how you plan to use it, failures could ensue at a very inopportune time of day. Consider this one more batveat.</p>
<p class="tx">Datestamps and timestamps have many uses. You can use them in filenames to indicate their creation date and time. In an <span class="sans_thesansmonocd_w5regular_">if</span> command, you can compare them to other datestamps or timestamps to turn on logic at a specific date and time. You can even capture them before and after some process to measure elapsed time.</p>
</section>
<section aria-labelledby="sec2" epub:type="division">
<h3 class="h" id="sec2"><span id="h1-144"/><span class="sans_futura_std_bold_b_">Prompt</span></h3>
<p class="tni">The <span class="sans_thesansmonocd_w5regular_">prompt</span> pseudo-environment variable does double duty as a command. Just as <span class="sans_thesansmonocd_w5regular_">path</span> is a command to change the <span class="sans_thesansmonocd_w5regular_">path</span> variable, <span class="sans_thesansmonocd_w5regular_">prompt</span> is a command to change the <span class="sans_thesansmonocd_w5regular_">prompt</span> variable.</p>
<p class="tx">In <span class="xref"><a href="chapter12.xhtml" class="calibre3">Chapter 12</a></span>, when discussing the interpreter-generated output (stdout), I mentioned that the interpreter prefixes the output from every command, whether it ends up on the console or redirected to a trace file, with the prompt. By default, the prompt is the current directory followed by a greater-than symbol. For instance, if the two lines of code producing a datestamp in <i class="calibre6">Datestamp.bat</i> from <a href="#Lis21-1" class="calibre3">Listing 21-1</a> were run from the <i class="calibre6">C:\Batch\</i> directory, it might generate the following output to a trace file:</p>
<pre class="pre"><code class="calibre11">C:\Batch&gt;set #=Wed 10/27/2004
C:\Batch&gt;set datestamp=20041027
</code></pre>
<p class="tx">But defaults are made to be changed. The <span class="sans_thesansmonocd_w5regular_">prompt</span> variable contains hardcoded text and/or special codes that define the content of the prompt seen in stdout, and the <span class="sans_thesansmonocd_w5regular_">prompt</span> command is the tool that updates the <span class="sans_thesansmonocd_w5regular_">prompt</span> variable. The command’s lone argument is the new <span class="sans_thesansmonocd_w5regular_">prompt</span> variable, which’ll change what we see in stdout.</p>
<p class="tx">To demonstrate, if I were particularly self-absorbed and wanted my signature on every line of executed code, this simple command would assuage my ego:</p>
<pre class="pre"><code class="calibre11">prompt Jack's$SCode$G</code></pre>
<p class="tx"><span aria-label=" Page 250. " epub:type="pagebreak" id="pg_250" role="doc-pagebreak"/>Two pieces of hardcoded text are in the argument, <span class="sans_thesansmonocd_w5regular_">Jack's</span> and <span class="sans_thesansmonocd_w5regular_">Code</span>. Additionally, two special codes insert a space (<span class="sans_thesansmonocd_w5regular_">$S</span>) in between the words and a greater-than sign (<span class="sans_thesansmonocd_w5regular_">$G</span>) at the end. Running the same two lines of code on the same date now produces this output:</p>
<pre class="pre"><code class="calibre11">Jack's Code&gt;set #=Wed 10/27/2004
Jack's Code&gt;set datestamp=20041027
</code></pre>
<p class="tx">But this command and variable were not created for vanity; they were created to populate the prompt with customized information. Consider this far more complex and esoteric example:</p>
<pre class="pre"><code class="calibre11">prompt %~NX0$A$N:$$$C$D$B$T$F$G</code></pre>
<p class="tni">This <span class="sans_thesansmonocd_w5regular_">prompt</span> command isn’t the easiest to read, but here it’s broken down:</p>
<p class="runinpara"><span class="sans_thesansmonocd_w7bold_b_">%~NX0</span>    Bat filename and extension; perhaps resolves to <span class="sans_thesansmonocd_w5regular_">Datestamp.bat</span></p>
<p class="runinpara1"><span class="sans_thesansmonocd_w7bold_b_">$A</span>    Ampersand; resolves to <span class="sans_thesansmonocd_w5regular_">&amp;</span></p>
<p class="runinpara1"><span class="sans_thesansmonocd_w7bold_b_">$N</span>    Drive letter; perhaps resolves to <span class="sans_thesansmonocd_w5regular_">C</span></p>
<p class="runinpara1"><span class="sans_thesansmonocd_w7bold_b_">:</span>    Hardcoded text; appears as <span class="sans_thesansmonocd_w5regular_">:</span></p>
<p class="runinpara1"><span class="sans_thesansmonocd_w7bold_b_">$$</span>    Dollar sign; resolves to <span class="sans_thesansmonocd_w5regular_">$</span></p>
<p class="runinpara1"><span class="sans_thesansmonocd_w7bold_b_">$C</span>    Open parenthesis; resolves to <span class="sans_thesansmonocd_w5regular_">(</span></p>
<p class="runinpara1"><span class="sans_thesansmonocd_w7bold_b_">$D</span>    Date; perhaps resolves to <span class="sans_thesansmonocd_w5regular_">Wed 10/27/2004</span></p>
<p class="runinpara1"><span class="sans_thesansmonocd_w7bold_b_">$B</span>    Pipe; resolves to <span class="sans_thesansmonocd_w5regular_">|</span></p>
<p class="runinpara1"><span class="sans_thesansmonocd_w7bold_b_">$T</span>    Time; perhaps resolves to <span class="sans_thesansmonocd_w5regular_">23:39:12.34</span></p>
<p class="runinpara1"><span class="sans_thesansmonocd_w7bold_b_">$F</span>    Close parenthesis; resolves to)</p>
<p class="runinpara2"><span class="sans_thesansmonocd_w7bold_b_">$G</span>    Greater-than sign; resolves to <span class="sans_thesansmonocd_w5regular_">&gt;</span></p>
<p class="tx">After you assign this <span class="sans_thesansmonocd_w5regular_">prompt</span> variable, executing the same two lines might result in this output:</p>
<pre class="pre"><code class="calibre11">Datestamp.bat&amp;C:$(Wed 10/27/2004|23:39:12.34)&gt;set #=Wed 10/27/2004
Datestamp.bat&amp;C:$(Wed 10/27/2004|23:39:12.35)&gt;set datestamp=20041027
</code></pre>
<p class="tx">Of these entities in this <span class="sans_thesansmonocd_w5regular_">prompt</span> variable, all but a couple are special codes specific to the <span class="sans_thesansmonocd_w5regular_">prompt</span> command. One byte, the colon, is hardcoded, and the first item, <span class="sans_thesansmonocd_w5regular_">%~NX0</span>, is just a resolved variable. It happens to be the name and extension of the bat file being executed, but most any variable would work here.</p>
<p class="tx">The special code for time (<span class="sans_thesansmonocd_w5regular_">$T</span>) allows you to see exactly when each and every command executes. If a bat file seems to take longer to execute than it should, this is a simple means of pinpointing the bottleneck. In the previous example, the fact that the second command executed a hundredth of a second after the first is displayed in the prompt, while the rest of the prompt is unchanged.</p>
<p class="tx"><span aria-label=" Page 251. " epub:type="pagebreak" id="pg_251" role="doc-pagebreak"/>Also, notice that the greater-than sign (<span class="sans_thesansmonocd_w5regular_">$G</span>) is the last character in the prompt. Without it, the prompt bleeds into the command following it, producing a rather unreadable stdout. It isn’t required, but it’s good form to conclude the prompt with the greater-than sign or some sort of special character.</p>
<p class="tx">You can even add a space or two after the greater-than sign to further distinguish the prompt from the output. Regardless of the current <span class="sans_thesansmonocd_w5regular_">prompt</span> variable, this command will add two spaces to it:</p>
<pre class="pre"><code class="calibre11">prompt %prompt%$S$S</code></pre>
<p class="tx">This command clearly shows the two uses of <span class="sans_thesansmonocd_w5regular_">prompt</span>. Assuming that the default prompt was active, the <span class="sans_thesansmonocd_w5regular_">prompt</span> variable resolves to <span class="sans_thesansmonocd_w5regular_">$P$G</span> (current directory and greater-than sign). The command then appends this with <span class="sans_thesansmonocd_w5regular_">$S$S</span> and uses it as the argument to the <span class="sans_thesansmonocd_w5regular_">prompt</span> command:</p>
<pre class="pre"><code class="calibre11">C:\Batch&gt;prompt $P$G$S$S</code></pre>
<p class="tni">This command activates the new prompt with trailing spaces for the execution of any subsequent commands:</p>
<pre class="pre"><code class="calibre11">C:\Batch&gt;  set #=Wed 10/27/2004
C:\Batch&gt;  set datestamp=20041027
</code></pre>
<p class="tx">With hardcoded text and all the characters available with the special codes, you can easily customize the prompt to virtually any text imaginable to suit any need. I showed a number of the special codes earlier, but the <span class="sans_thesansmonocd_w5regular_">help</span> command provides a complete list.</p>
</section>
<section aria-labelledby="sec3" epub:type="division">
<h3 class="h" id="sec3"><span id="h1-145"/><span class="sans_futura_std_bold_b_">Random Numbers</span></h3>
<p class="tni">The <span class="sans_thesansmonocd_w5regular_">random</span> pseudo-environment variable resolves to a random number between 0 and 32,767, inclusive. You can use this to simulate a coin flip; an even number is heads, and an odd is tails. If you want to randomly launch a process on one of any number of servers, this pseudo-environment variable gives you that ability.</p>
<p class="tx">To demonstrate one use of <span class="sans_thesansmonocd_w5regular_">random</span>, in <span class="xref"><a href="chapter15.xhtml" class="calibre3">Chapter 15</a></span> I demonstrated interactive Batch with a bat file that offered up a joke, pun, or riddle—but just one of each. Unfortunately, it didn’t take long to exhaust the material. Now imagine a library of 100 bat jokes, 100 bat puns, and 100 bat riddles. Unfortunately (or fortunately), I won’t list them here. Imagine further that when the user asks for a pun, we randomly select one of the 100 puns from the library.</p>
<p class="tx">To make this happen, we need a couple of things. First, we need to put the 100 puns into an array so that we can select them individually. (That’ll come in <span class="xref"><a href="chapter29.xhtml" class="calibre3">Chapter 29</a></span>.) More important at this moment, we need a means of generating one random number out of 100 possible numbers. The following <span aria-label=" Page 252. " epub:type="pagebreak" id="pg_252" role="doc-pagebreak"/><span class="sans_thesansmonocd_w5regular_">set /A</span> command uses the <span class="sans_thesansmonocd_w5regular_">random</span> pseudo-environment variable and the modulo operator to generate a <i class="calibre6">random</i> number between 0 and 99 (sort of):</p>
<pre class="pre"><code class="calibre11">set /A punNbr = %random% %% 100</code></pre>
<p class="tx">If the puns are labeled 0 through 99, we can simply choose the pun based on the value of <span class="sans_thesansmonocd_w5regular_">punNbr</span>. If the puns are labeled 1 through 100, we merely need to add <span class="sans_thesansmonocd_w5regular_">1</span> to the result:</p>
<pre class="pre"><code class="calibre11">set /A punNbr = %random% %% 100 + 1</code></pre>
<p class="tx">There are two reasons I mentioned that this “sort of” works. First, like the vast majority of computer-generated random numbers, this is actually a pseudo-random number and not truly random. (Yes, this is the pseudo-random pseudo-environment variable.) When the bat file first starts, the interpreter seeds the random function with the current time, which it uses in the algorithm that generates all future random numbers on request. This means that two bat files starting at the very same moment will see the same set of pseudo-random numbers generated—even two bat files launched within seconds of each other will see very similar <i class="calibre6">random</i> numbers, at least for the first few invocations. It’s important to be aware of this, although pseudo-random numbers are more than acceptable for most applications.</p>
<p class="tx">The second reason <span class="sans_thesansmonocd_w5regular_">punNbr</span> isn’t truly random is that 32,768, the total number of random numbers, isn’t divisible by 100. If you executed the first <span class="sans_thesansmonocd_w5regular_">set</span> command in this section 32,768 times (once for each number from 0 to 32,767), <span class="sans_thesansmonocd_w5regular_">0</span> would be the result 328 times. Likewise, <span class="sans_thesansmonocd_w5regular_">1</span> through <span class="sans_thesansmonocd_w5regular_">67</span> would be the result 328 times each. But you would see <span class="sans_thesansmonocd_w5regular_">68</span> as the result only 327 times, and the same goes for all of the numbers up to and including <span class="sans_thesansmonocd_w5regular_">99</span>. The upshot is that some numbers will be <i class="calibre6">randomly</i> selected just slightly more often than other numbers.</p>
<p class="tx">The remainder of this section is the inevitable result of a just slightly obsessive-compulsive mathematician becoming a coder who ultimately deals with random numbers. The vast majority of the time a pseudo-random number and modulo arithmetic will more than get the job done, but if you want to find out how to get as close as possible to a truly random number, read on.</p>
<aside aria-label="box-5" class="box">
<p class="boxtitle" id="box-5"><span class="sans_futura_std_bold_b_">AN ARITHMETIC DIGRESSION FOR MY FELLOW MATH GEEKS</span></p>
<p class="boxbodyfirst"><span class="sans_futura_std_book_">Since 32,768 is a power of two, the modulo function weights all results equally when finding a random number out of possible values equaling a power of two, that is, 2, 4, 8, 16, and so on. If the library has 128 bat puns,</span> <span class="sans_thesansmonocd_w5regular_">%random% %% 128</span> <span class="sans_futura_std_book_">weights each pun equally. In the case of 100 puns, it selects 68 numbers</span> <span aria-label=" Page 253. " epub:type="pagebreak" id="pg_253" role="doc-pagebreak"/><span class="sans_futura_std_book_">slightly more often than the other 32. A popular alternative method involves multiplying the pseudo-random number by the desired number of possible values and dividing by 32,768:</span></p>
<pre class="pre"><code class="calibre11"><span class="sans_thesansmonocd_w5regular_">set /A punNbr = %random% * 100 / 32768</span>
</code></pre>
<p class="boxbody"><span class="sans_futura_std_book_">Although this method is widely used, it offers only a slight improvement. The same number of results still occur more often, but instead of being grouped together as the first few numbers in the set, they’re now dispersed throughout the set. Out of 100 puns, 68 will still be selected more often; the fact that those 68 aren’t consecutive numbers offers little solace.</span></p>
<p class="boxbody"><span class="sans_futura_std_book_">The following is an example of overthinking in most instances, but these few lines of code ensure that every number from 1 through 100 is weighted equally. Each has 327 chances of being selected:</span></p>
<pre class="pre"><code class="calibre11"><span class="sans_thesansmonocd_w5regular_"> set nbrPossVal=100</span>
<span class="sans_thesansmonocd_w5regular_"> set /A maxRandNbr = 32768 / %nbrPossVal% * %nbrPossVal% - 1</span>
<span class="sans_thesansmonocd_w5regular_">:GetAnotherRand</span>
<span class="sans_thesansmonocd_w5regular_"> set randNbr=%random%</span>
<span class="sans_thesansmonocd_w5regular_"> if %randNbr% gtr %maxRandNbr% goto :GetAnotherRand</span>
<span class="sans_thesansmonocd_w5regular_"> set /A punNbr = %randNbr% %% %nbrPossVal% + 1</span>
</code></pre>
<p class="boxbody"><span class="sans_futura_std_book_">You can set the number of possible values,</span> <span class="sans_thesansmonocd_w5regular_">nbrPossVal</span><span class="sans_futura_std_book_">, to any reasonable number, but I’m still using 100 here. When we divide 32,768 by this number, the decimal part vanishes into the ether, leaving a whole number; multiplying the result by the same number provides the greatest multiple of</span> <span class="sans_thesansmonocd_w5regular_">nbrPossVal</span> <span class="sans_futura_std_book_">less than or equal to 32,768; subtracting 1 provides the maximum random number that we’ll accept,</span> <span class="sans_thesansmonocd_w5regular_">maxRandNbr</span><span class="sans_futura_std_book_">. In this example, that’s 32,699: 32,768 / 100 = 327; then 327 × 100 = 32,700; finally, 32,700 – 1 = 32,699.</span></p>
<p class="boxbodylast"><span class="sans_futura_std_book_">With the use of a</span> <span class="sans_thesansmonocd_w5regular_">do...while</span> <span class="sans_futura_std_book_">command, we’ll simply get another random number after throwing away the rare random number between 32,700 and 32,767, inclusive. Those are the 68 values that gave the results of 0 through 67 each one extra possibility of being chosen. With those gone, we can perform the modulo operation in the last command to get a number between 1 and 100. We haven’t eliminated the issue of the variable being a pseudo-random number, but this is as random as random can get in most coding languages without a cryptographic algorithm.</span></p>
</aside>
</section>
<section aria-labelledby="sec4" epub:type="division">
<h3 class="h" id="sec4"><span id="h1-146"/><span class="sans_futura_std_bold_b_">The cmdcmdline Variable</span></h3>
<p class="tni">Another interesting pseudo-environment variable is <span class="sans_thesansmonocd_w5regular_">cmdcmdline</span>, or <i class="calibre6">command command line</i>. It looks redundant, but it’s the command line command that originally started the current execution. On Windows computers, the <i class="calibre6">.bat</i> extension is associated with the Windows <i class="calibre6">cmd.exe</i> program by default, and <span aria-label=" Page 254. " epub:type="pagebreak" id="pg_254" role="doc-pagebreak"/>when you open a bat file, this program executes it. To demonstrate, assume that the <i class="calibre6">DateTime.bat</i> bat file contains this command:</p>
<pre class="pre"><code class="calibre11">&gt; con echo %cmdcmdline%</code></pre>
<p class="tni">Executing the bat file might write this to the console:</p>
<pre class="pre"><code class="calibre11">C:\WINDOWS\system32\cmd.exe /C ""C:\Batch\DateTime.bat" "</code></pre>
<p class="tx">When you open or double-click a bat file, behind the scenes Windows is calling the <i class="calibre6">cmd.exe</i> program with the <span class="sans_thesansmonocd_w5regular_">/C</span> option and the bat file as its argument. If this bat file calls another bat file, the value of <span class="sans_thesansmonocd_w5regular_">cmdcmdline</span> won’t change. It’s consistently the command that started the high-level process.</p>
<p class="tx">You can parse this variable to get some useful information. Even from a called bat file, you can retrieve the original parameter list. If you have redirected stdout to a trace file, the path and name of the trace file are at the end of the variable’s value, ready to be extracted. A bat file might be designed to run in two different modes, stand-alone or invoked by another bat file, with slightly different logic needed in each mode. To intelligently determine the mode, compare the contents of this variable to the <span class="sans_thesansmonocd_w5regular_">%0</span> hidden parameter. If you find the name of the same bat file in both fields, it’s the high-level bat file and, therefore, stand-alone. If not, it must be a called bat file.</p>
</section>
<section aria-labelledby="sec5" epub:type="division">
<h3 class="h" id="sec5"><span id="h1-147"/><span class="sans_futura_std_bold_b_">System Variables</span></h3>
<p class="tni">Another class of pseudo-environment variables informs you about the machine where a bat file executes. They are called <i class="calibre6">system variables</i>.</p>
<p class="tx">A sampling of these system variables includes <span class="sans_thesansmonocd_w5regular_">USERNAME</span>, <span class="sans_thesansmonocd_w5regular_">USERPROFILE</span>, <span class="sans_thesansmonocd_w5regular_">PROCESS_ARCHITECTURE</span>, <span class="sans_thesansmonocd_w5regular_">NUMBER_OF_PROCESSORS</span>, and others that’ll be meaningful to anyone familiar with the workings of a Windows computer. The variable <span class="sans_thesansmonocd_w5regular_">ProgramFiles</span> resolves to the root directory where Microsoft has installed its 64-bit program files, and <span class="sans_thesansmonocd_w5regular_">ProgramFiles(x86)</span> does the same for its 32-bit counterpart.</p>
<p class="tx">After all of these verbosely named variables, it might seem odd, but <span class="sans_thesansmonocd_w5regular_">OS</span> is a severe abbreviation of <i class="calibre6">operating system</i>. The directory for holding <i class="calibre6">temporary</i> files is special enough to warrant two system variables, <span class="sans_thesansmonocd_w5regular_">TEMP</span> and <span class="sans_thesansmonocd_w5regular_">TMP</span>, while you can reference the root <i class="calibre6">Windows directory</i> via <span class="sans_thesansmonocd_w5regular_">windir</span>.</p>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">USERDOMAIN</span> variable is very handy when your bat file can run in different domains, perhaps even different physical locations. Each domain likely has differing infrastructure, such as pathing for certain resources, and this one variable is the key to making the code intelligent enough to run in those multiple locations. Another system variable that I’ve used often is <span class="sans_thesansmonocd_w5regular_">COMPUTERNAME</span>. If a process can be launched on any one of dozens of servers, you can use this variable to easily determine exactly where the bat file is being executed.</p>
<span aria-label=" Page 255. " epub:type="pagebreak" id="pg_255" role="doc-pagebreak"/>
<blockquote class="calibre8">
<p class="warning"><span class="sans_dogma_ot_bold_b_1">NOTE</span></p>
</blockquote>
<p class="warning-txt"><i class="calibre6">Despite appearances, I’m not being arbitrary with the capitalization of the system variable names in this section. You’re probably aware that all Batch variables are case-insensitive and that I typically use camel case, but I show each pseudo-environment variable as Microsoft presents them—that is, what would be displayed by running a set command with no arguments at the command prompt to avoid any confusion. Some are entirely uppercase, some entirely lowercase, some are camel case, some are even snake case (words separated by underscores), and a couple even have parentheses in the variable name. It’s truly a nightmare for anyone yearning for consistency.</i></p>
<p class="tx">Explore further on your own. Pull up the command prompt and enter the three-byte command, <span class="sans_thesansmonocd_w7bold_b_">set</span>, to see a list of all the variables set on your machine. All of them are available at the onset of any bat file’s execution on that particular computer.</p>
</section>
<section aria-labelledby="sec6" epub:type="division">
<h3 class="h" id="sec6"><span id="h1-148"/><span class="sans_futura_std_bold_b_">Bat Files vs. cmd Files</span></h3>
<p class="tni">In <span class="xref"><a href="chapter1.xhtml" class="calibre3">Chapter 1</a></span>, I introduced bat files and cmd files. At the time, I mentioned that the only significant difference from a coder’s perspective concerned how and when the interpreter sets the return code. Here I’ll detail those differences.</p>
<p class="tx">We’ve discussed three commands that set <span class="sans_thesansmonocd_w5regular_">errorlevel</span> to a nonzero value when the command fails to execute properly: <span class="sans_thesansmonocd_w5regular_">set</span>, <span class="sans_thesansmonocd_w5regular_">path</span>, and <span class="sans_thesansmonocd_w5regular_">prompt</span>. Actually, most commands do this, but these differ in that when the command executes successfully, they don’t set <span class="sans_thesansmonocd_w5regular_">errorlevel</span> to <span class="sans_thesansmonocd_w5regular_">0</span>. The upshot is that you can’t trust the value of <span class="sans_thesansmonocd_w5regular_">errorlevel</span> after you execute one of these commands.</p>
<p class="tx">In a cmd file, however, executing these commands successfully always sets <span class="sans_thesansmonocd_w5regular_">errorlevel</span> to <span class="sans_thesansmonocd_w5regular_">0</span>, and when they fail, they always set <span class="sans_thesansmonocd_w5regular_">errorlevel</span> to a nonzero value. (I said that this was <i class="calibre6">the</i> biggest difference. I didn’t say it was a <i class="calibre6">big</i> difference.)</p>
<p class="tx">Most coders, including myself, rarely interrogate the return code for these commands. Even if you pass a nonexistent directory to the <span class="sans_thesansmonocd_w5regular_">path</span> command, it won’t fail; it fails only when it can’t reset the variable with a valid path for some reason, and I’ve never seen that happen. Likewise, the <span class="sans_thesansmonocd_w5regular_">prompt</span> command accepts pretty much anything as the <span class="sans_thesansmonocd_w5regular_">prompt</span> variable, and I’ve never seen it fail either. Setting a simple variable with the <span class="sans_thesansmonocd_w5regular_">set</span> command is also difficult to get wrong. The one possible exception is when using <span class="sans_thesansmonocd_w5regular_">set /A</span> to do some arithmetic. For instance, a missing operand or division by zero generates nonzero values of <span class="sans_thesansmonocd_w5regular_">errorlevel</span>.</p>
<p class="tx">That said, if you want to interrogate <span class="sans_thesansmonocd_w5regular_">errorlevel</span> after executing one of these commands, there are two solutions. First, when using a bat file, in some way, shape, or fashion, you need to reset <span class="sans_thesansmonocd_w5regular_">errorlevel</span> to zero before executing the <span class="sans_thesansmonocd_w5regular_">set</span>, <span class="sans_thesansmonocd_w5regular_">path</span>, or <span class="sans_thesansmonocd_w5regular_">prompt</span> command. If the command fails, the interpreter resets <span class="sans_thesansmonocd_w5regular_">errorlevel</span> to a nonzero value; if it succeeds, <span class="sans_thesansmonocd_w5regular_">errorlevel</span> will still be zero. The other option is to use a cmd file.</p>
<p class="tx">There’s one hurdle to overcome with setting the return code to zero in a bat file. In general, the issue is how to set pseudo-environment variables. <span aria-label=" Page 256. " epub:type="pagebreak" id="pg_256" role="doc-pagebreak"/>More specifically, <span class="sans_thesansmonocd_w5regular_">errorlevel</span> should never be set to anything with a <span class="sans_thesansmonocd_w5regular_">set</span> command, but there’s always a way.</p>
</section>
<section aria-labelledby="sec7" epub:type="division">
<h3 class="h" id="sec7"><span id="h1-149"/><span class="sans_futura_std_bold_b_">Setting Pseudo-Environment Variables</span></h3>
<p class="tni">You have the power to set and reset some pseudo-environment variables. You’ve learned that <span class="sans_thesansmonocd_w5regular_">path</span>, <span class="sans_thesansmonocd_w5regular_">cd</span>, and <span class="sans_thesansmonocd_w5regular_">prompt</span> act as both commands and variables, where the command resets the variable of the same name. They’re set to defaults when a bat file starts, but you can change the values.</p>
<p class="tx">Other pseudo-environment variables, such as <span class="sans_thesansmonocd_w5regular_">windir</span>, are already set when a bat file starts, and it would be foolish to reset them. The interpreter sets and resets still other such variables during a bat file’s execution, perhaps many times. For instance, most commands reset <span class="sans_thesansmonocd_w5regular_">errorlevel</span>; the <span class="sans_thesansmonocd_w5regular_">time</span> variable takes on a new value every 100th of a second, and if the bat file is running at midnight, <span class="sans_thesansmonocd_w5regular_">date</span> will change as well. You should never set those variables. Notice that I didn’t write that you <i class="calibre6">cannot</i> set these variables. There’s nothing to stop you from executing this command:</p>
<pre class="pre"><code class="calibre11">set errorlevel=0&amp; rem Never Never Never Do This... Ever</code></pre>
<p class="tx">There’s no compiler to prevent this hubris. The interpreter doesn’t abort and crash the execution. It essentially says, “So you want to set <span class="sans_thesansmonocd_w5regular_">errorlevel</span> now? This was my variable, but if you want it, fine, it’s yours now. But I’ll have nothing more to do with it.” I probably personify the interpreter more than I should, but it can be so very passive-aggressive.</p>
<p class="tx">This simple yet ill-advised <span class="sans_thesansmonocd_w5regular_">set</span> command transforms the variable into a simple user variable and removes it from the domain of the pseudo-environment variables. Subsequent commands will succeed or fail, commands that would normally generate a return code, but since <span class="sans_thesansmonocd_w5regular_">errorlevel</span> is no longer a pseudo-environment variable, it’ll remain as is, unchanged from its erroneously assigned value, until the run stream ends or another ill-advised <span class="sans_thesansmonocd_w5regular_">set</span> command erroneously resets it again.</p>
<p class="tx">Some of the pseudo-environment variables that should never be set with a <span class="sans_thesansmonocd_w5regular_">set</span> command are <span class="sans_thesansmonocd_w5regular_">errorlevel</span>, <span class="sans_thesansmonocd_w5regular_">date</span>, <span class="sans_thesansmonocd_w5regular_">time</span>, <span class="sans_thesansmonocd_w5regular_">cmdcmdline</span>, and <span class="sans_thesansmonocd_w5regular_">random</span>. When in doubt, it’s best to assume that any pseudo-environment variable shouldn’t be reset. It wouldn’t make sense to reset most of these variables, but there’s just one that you might want to reset: <span class="sans_thesansmonocd_w5regular_">errorlevel</span>. In the prior section, I detail just such a scenario.</p>
<p class="tx">The following command resets <span class="sans_thesansmonocd_w5regular_">errorlevel</span> to <span class="sans_thesansmonocd_w5regular_">0</span> without even mentioning <span class="sans_thesansmonocd_w5regular_">errorlevel</span>:</p>
<pre class="pre"><code class="calibre11">cmd /C exit 0</code></pre>
<p class="tni">The <span class="sans_thesansmonocd_w5regular_">cmd</span> command opens a new command shell, and the <span class="sans_thesansmonocd_w5regular_">/C</span> option tells the interpreter to execute the command that comes after it and then terminate the new command shell when it’s through. In this example, it executes a simple <span class="sans_thesansmonocd_w5regular_">exit</span> command returning <span class="sans_thesansmonocd_w5regular_">0</span>. The result is that it sets <span class="sans_thesansmonocd_w5regular_">errorlevel</span> to <span class="sans_thesansmonocd_w5regular_">0</span>—without a <span class="sans_thesansmonocd_w5regular_">set</span> command.</p>
<p class="tx"><span aria-label=" Page 257. " epub:type="pagebreak" id="pg_257" role="doc-pagebreak"/>If this looks oddly familiar, that’s because I mentioned the <i class="calibre6">cmd.exe</i> program earlier in this chapter. You can invoke the same program, which also happens to be the interpreter, with the <span class="sans_thesansmonocd_w5regular_">cmd</span> command to execute a bat file or another command.</p>
</section>
<section aria-labelledby="sec8" epub:type="division">
<h3 class="h" id="sec8"><span id="h1-150"/><span class="sans_futura_std_bold_b_">Summary</span></h3>
<p class="tni">Truly understanding pseudo-environment variables will give you more tools, allowing you to complete more tasks. I didn’t provide an exhaustive list, but I touched on the important ones. You learned how to manipulate the prompt, how to generate random numbers, and about the dangers of erroneously setting certain pseudo-environment variables. I also discussed the <span class="sans_thesansmonocd_w5regular_">errorlevel</span> pseudo-environment variable in two contexts. You can reset it to any number, but not how you probably imagined, and it behaves a little differently in bat files compared to cmd files.</p>
<p class="tx">In the next chapter, you’ll learn how to create and format reports in Batch using the <span class="sans_thesansmonocd_w5regular_">date</span> and <span class="sans_thesansmonocd_w5regular_">time</span> pseudo-environment variables.</p>
</section>
</section>
</div></body></html>