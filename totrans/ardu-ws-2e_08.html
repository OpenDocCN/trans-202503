<html><head></head><body>
		<section>&#13;
			<header>&#13;
				<h1 class="chapter"><span class="ChapterNumber"><span epub:type="pagebreak" id="Page_167" title="167"/>9</span><br/><span class="ChapterTitle">Liquid Crystal Displays</span></h1>&#13;
			</header>&#13;
			<p class="ChapterIntro">In this chapter you will</p>&#13;
			<ul>&#13;
				<li>Use character LCD modules to display text and numeric data</li>&#13;
				<li>Create custom characters to display on character LCD modules</li>&#13;
				<li>Use color LCD modules to display text and data</li>&#13;
				<li>Create a temperature history–graphing thermometer display</li>&#13;
			</ul>&#13;
			<p>For some projects, you’ll want to display information to the user somewhere other than on a desktop computer monitor. One of the easiest and most versatile ways to display information is with a liquid crystal display (LCD) module and your Arduino. You can display text, custom characters, and numeric data using a character LCD module and color graphics with a graphic LCD module.</p>&#13;
			<h2 id="h1-500587c09-0001">Character LCD Modules</h2>&#13;
			<p class="BodyFirst">LCD modules that display characters such as text and numbers are the most inexpensive and simplest to use of all LCDs. They can be purchased <span epub:type="pagebreak" id="Page_168" title="168"/>in various sizes, which are measured by the number of rows and columns of characters they can display. Some include a backlight and allow you to choose the color of the characters and the background color. Any LCD with an HD44780- or KS0066-compatible interface and a 5 V backlight should work with your Arduino. The first LCD we’ll use is a 16-character–by–2-row LCD module with a backlight, as shown in <a href="#figure9-1" id="figureanchor9-1">Figure 9-1</a>.</p>&#13;
			<figure>&#13;
				<img alt="f09001" src="image_fi/500587c09/f09001.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure9-1">Figure 9-1</a>: Example LCD module with trimpot and header pins</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>&#13;
				The trimpot (the variable resistor for the LCD) has a value of 10 k<span class="NSSymbol">Ω</span> and is used to adjust the display contrast. If the header pins have not already been soldered into the row of holes along the top of the LCD, you’ll need to do this to make insertion into the breadboard straightforward.</p>&#13;
			<p>&#13;
				The holes along the top of the LCD are numbered 1 through 16. Number 1 is closest to the corner of the module and marked as VSS (connected to GND) in the schematic shown in <a href="#figure9-2" id="figureanchor9-2">Figure 9-2</a>. We’ll refer to this schematic for all of the LCD examples in this book. In some rare situations, you could find yourself with an LCD that has a 4.2 V instead of a 5 V backlight. (If you are unsure of this, check with your supplier.) If this is the case, place a 1N4004 diode in series between the Arduino 5 V and the LCD LED+ pin.</p>&#13;
				<span epub:type="pagebreak" id="Page_169" title="169"/>&#13;
				<figure>&#13;
				<img alt="f09002" src="image_fi/500587c09/f09002.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure9-2">Figure 9-2</a>: Basic LCD schematic</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h3 id="h2-500587c09-0001">Using a Character LCD in a Sketch</h3>&#13;
			<p class="BodyFirst">To use the character LCD shown in <a href="#figure9-1">Figure 9-1</a>, we will first explore the required functions and how they work through some simple demonstrations. Before moving on, you’ll need to install the required Arduino library from the Library Manager. Using the method described in Chapter 7, search for and install the “LiquidCrystal by Arduino, Adafruit” library. Then you can enter and upload the basic sketch shown in <a href="#listing9-1" id="listinganchor9-1">Listing 9-1</a>.</p>&#13;
			<pre><code>// Listing 9-1&#13;
#include &lt;LiquidCrystal.h&gt;&#13;
LiquidCrystal lcd(4, 5, 6, 7, 8, 9);  // pins for RS, E, DB4, DB5, DB6, DB7&#13;
void setup()&#13;
{ lcd.begin(16, 2); lcd.clear();&#13;
}&#13;
void loop()<span epub:type="pagebreak" id="Page_170" title="170"/>{ lcd.setCursor(0, 5); lcd.print("Hello"); lcd.setCursor(1, 6); lcd.print("world!"); delay(10000);&#13;
}</code></pre>&#13;
			<p class="CodeListingCaption"><a id="listing9-1">Listing 9-1</a>: LCD demonstration sketch</p>&#13;
			<p><a href="#figure9-3" id="figureanchor9-3">Figure 9-3</a> shows the result of <a href="#listing9-1">Listing 9-1</a>.</p>&#13;
			<figure>&#13;
				<img alt="f09003" src="image_fi/500587c09/f09003.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure9-3">Figure 9-3</a>: LCD demonstration: “Hello world!”</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>&#13;
				Now to see how the sketch in <a href="#listing9-1">Listing 9-1</a> works. First, we need to add a line whose purpose is to include the library for LCD modules (which is automatically installed with the Arduino IDE). Then we need to tell the library which pins are connected to the Arduino. To do this, we add the following lines <em>before </em>the <code>void setup()</code> method:</p>&#13;
			<pre><code>#include &lt;LiquidCrystal.h&gt;&#13;
LiquidCrystal lcd(4, 5, 6, 7, 8, 9);  // pins for RS, E, DB4, DB5, DB6, DB7</code></pre>&#13;
			<p>The numbers entered in the LiquidCrystal function match the pins labeled on the LCD. If you’re unsure about your LCD’s pinouts, contact the supplier.</p>&#13;
			<p>If you need to use different digital pins on the Arduino, adjust the pin numbers in the second line of this code.</p>&#13;
			<p>&#13;
				Next, in <code>void setup()</code>, we tell the Arduino the size of the LCD in columns and rows. For example, here’s how we’d tell the Arduino that the LCD has 2 rows of 16 characters each:</p>&#13;
			<pre><code>  lcd.begin(16, 2);</code></pre>&#13;
			<h3 id="h2-500587c09-0002">Displaying Text</h3>&#13;
			<p class="BodyFirst">With the LCD setup complete, clear the LCD’s display with the following:</p>&#13;
			<pre><code>  lcd.clear(); </code></pre>&#13;
			<p>Then, to position the cursor, which is the starting point for the text, use this:</p>&#13;
			<pre><code>  lcd.setCursor(<var>x</var>, <var>y</var>);</code></pre>&#13;
			<p><span epub:type="pagebreak" id="Page_171" title="171"/>Here, <var>x</var> is the column (0 to 15) and <var>y</var> is the row (0 or 1). Next, to display the word <em>text</em>, for example, you would enter the following:</p>&#13;
			<pre><code>  lcd.print("text");</code></pre>&#13;
			<p>Now that you can position and locate text, let’s move on to displaying variable data.</p>&#13;
			<h3 id="h2-500587c09-0003">Displaying Variables or Numbers</h3>&#13;
			<p class="BodyFirst">To display the contents of variables on the LCD screen, use this line:</p>&#13;
			<pre><code>  lcd.print(<var>variable</var>);</code></pre>&#13;
			<p>&#13;
				If you’re displaying a <code>float</code> variable, you can specify the number of decimal places to use. For example, here <code>lcd.print(pi, 3)</code> tells the Arduino to display the value of pi to three decimal places, as shown in <a href="#figure9-4" id="figureanchor9-4">Figure 9-4</a>:</p>&#13;
			<pre><code>  float pi = 3.141592654; lcd.print("pi: "); lcd.print(pi, 3); </code></pre>&#13;
			<figure>&#13;
				<img alt="f09004" src="image_fi/500587c09/f09004.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure9-4">Figure 9-4</a>: LCD displaying a floating-point number</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>&#13;
				When you want to display an integer on the LCD screen, you can display it in hexadecimal or binary, as shown in <a href="#listing9-2" id="listinganchor9-2">Listing 9-2</a>.</p>&#13;
			<pre><code>// Listing 9-2 int zz = 170; lcd.setCursor(0, 0); lcd.print("Binary: ");       lcd.print(zz, BIN);    // display 170 in binary lcd.setCursor(0, 1); lcd.print("Hexadecimal: "); lcd.print(zz, HX);     // display 170 in hexadecimal</code></pre>&#13;
			<p class="CodeListingCaption"><a id="listing9-2">Listing 9-2</a>: Functions for displaying binary and hexadecimal numbers</p>&#13;
			<p>&#13;
				The LCD will then display the text shown in <a href="#figure9-5" id="figureanchor9-5">Figure 9-5</a>.</p>&#13;
			<figure>&#13;
				<img alt="f09005" src="image_fi/500587c09/f09005.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure9-5">Figure 9-5</a>: Results of the code in <a href="#listing9-2">Listing 9-2</a></p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h2 class="HeadProject" id="h1-500587c09-0002"><span><span epub:type="pagebreak" id="Page_172" title="172"/>Project #28: Defining Custom Characters</span></h2>&#13;
			<p class="BodyFirst">In addition to using the standard letters, numbers, and symbols available on your keyboard, you can define up to eight of your own characters in each sketch. Notice in the LCD module that each character is made up of eight rows of five dots, or <em>pixels</em>. <a href="#figure9-6" id="figureanchor9-6">Figure 9-6</a> shows a close-up.</p>&#13;
			<figure>&#13;
				<img alt="f09006" src="image_fi/500587c09/f09006.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure9-6">Figure 9-6</a>: Each character is made up of eight rows of five pixels.</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>&#13;
				To display your own characters, you must first define each one using an <em>array</em>. For example, to create a smiley face, you could use the following:</p>&#13;
			<pre><code>byte a[8] = {  B00000,  B01010, B01010,  B00000,  B00100,  B10001,  B01110,  B00000  };</code></pre>&#13;
			<p>Each number in the array addresses an individual pixel in the display. A 0 turns off a pixel, and a 1 turns it on. The elements in the array represent the rows of pixels in the display; the top element is the top row, the next element is the second row down, and so on.</p>&#13;
			<aside epub:type="sidebar">&#13;
				<div class="top hr">&#13;
					<hr/>&#13;
				</div>&#13;
				<section class="note">&#13;
					<h2><span class="NoteHead">NOTE</span></h2>&#13;
					<p>	When you’re planning your custom characters, it can be helpful to plan the character using some graph paper. Each square that is filled in represents a 1, and each empty square represents a 0 in the array.</p>&#13;
					<div class="bottom hr">&#13;
						<hr/>&#13;
					</div>&#13;
				</section>&#13;
			</aside>&#13;
			<p>&#13;
				In this example, since the first element is <code>B00000</code>, all the pixels in the top row are turned off. In the next element, <code>B01010</code>, every other pixel is turned on, and the 1s form the tops of the eyes. The following rows continue to fill out the character.</p>&#13;
			<p>&#13;
				Next, assign the array (which defines your new character) to the first of the eight custom character slots in <code>void setup()</code> with the following function:</p>&#13;
			<pre><code>  lcd.createChar(0, a); // assign the array a[8] to custom character slot 0</code></pre>&#13;
			<p>&#13;
				Finally, to display the character, add the following in <code>void loop()</code>:</p>&#13;
			<pre><code>  lcd.write(byte(0)); </code></pre>&#13;
			<p><span epub:type="pagebreak" id="Page_173" title="173"/>To display our custom character, we’d use the following code:</p>&#13;
			<pre><code>// Project 28 - Defining Custom Characters&#13;
#include &lt;LiquidCrystal.h&gt;&#13;
LiquidCrystal lcd(4, 5, 6, 7, 8, 9);  // pins for RS, E, DB4, DB5, DB6, DB7&#13;
byte a[8] = {  B00000,  B01010, B01010,  B00000,  B00100,  B10001,  B01110,  B00000  };&#13;
void setup()&#13;
{ lcd.begin(16, 2); lcd.createChar(0, a);&#13;
}&#13;
void loop()&#13;
{ lcd.write(byte(0));  // write the custom character 0 to the next cursor  // position&#13;
}</code></pre>&#13;
			<p><a href="#figure9-7" id="figureanchor9-7">Figure 9-7</a> shows the smiley faces displayed on the LCD screen.</p>&#13;
			<figure>&#13;
				<img alt="f09007" src="image_fi/500587c09/f09007.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure9-7">Figure 9-7</a>: The result of Project 28</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>&#13;
				Character LCD modules are simple to use and somewhat versatile. For example, using what you’ve learned, you could create a detailed digital thermometer by combining this LCD and the temperature measurement part of Project 20, <span class="xref" itemid="xref_target_on page 122 in Chapter 6">on page 122 in Chapter 6</span>. However, if you need to display a lot of data or graphical items, you will need to use a <em>graphic LCD module</em>.</p>&#13;
			<h2 id="h1-500587c09-0003">Graphic LCD Modules</h2>&#13;
			<p class="BodyFirst">Graphic LCD modules are larger and more expensive than character modules, but they’re also more versatile. You can use them not only to display text but also to draw lines, dots, circles, and more to create visual effects. The graphic LCD used in this book is a 128 <span class="NSSymbol">×</span> 160-pixel color module with an ST7735-compatible interface, as shown in <a href="#figure9-8" id="figureanchor9-8">Figure 9-8</a>.</p>&#13;
			<figure>&#13;
				<img alt="f09008" src="image_fi/500587c09/f09008.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure9-8">Figure 9-8</a>: A graphic LCD module</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h3 id="h2-500587c09-0004"><span epub:type="pagebreak" id="Page_174" title="174"/>Connecting the Graphic LCD</h3>&#13;
			<p class="BodyFirst">Before you can use the graphic LCD, you’ll need to connect eight wires between the LCD and the Arduino. This is easily done with male-to-female jumper wires, as the LCD has the connection pins presoldered at the factory. Make the connections as shown in <a href="#table9-1" id="tableanchor9-1">Table 9-1</a>.</p>&#13;
			<figure>&#13;
				<figcaption class="TableTitle">&#13;
					<p><a id="table9-1">Table 9-1</a>: Connections Between the Graphic LCD Module and Arduino</p>&#13;
				</figcaption>&#13;
				<table border="1" id="table-500587c09-0001">&#13;
					<thead>&#13;
						<tr>&#13;
							<td><b>LCD pin label</b></td>&#13;
							<td><b>To Arduino pin</b></td>&#13;
							<td><b>LCD pin function</b></td>&#13;
						</tr>&#13;
					</thead>&#13;
					<tbody>&#13;
						<tr>&#13;
							<td>Vcc</td>&#13;
							<td>5 V</td>&#13;
							<td>VDD</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>GND</td>&#13;
							<td>GND</td>&#13;
							<td>VSS (GND)</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>CS</td>&#13;
							<td>D10</td>&#13;
							<td>Chip select</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>RST</td>&#13;
							<td>D8</td>&#13;
							<td>Reset</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>A0 (or DC)</td>&#13;
							<td>D9</td>&#13;
							<td>Control</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>SDA</td>&#13;
							<td>D11</td>&#13;
							<td>Data in	</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>SCK</td>&#13;
							<td>D13</td>&#13;
							<td>Clock in</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>LED</td>&#13;
							<td>3.3 V</td>&#13;
							<td>Backlight LED</td>&#13;
						</tr>&#13;
					</tbody>&#13;
				</table>&#13;
			</figure>&#13;
			<h3 id="h2-500587c09-0005">Using the LCD</h3>&#13;
			<p class="BodyFirst">Before moving on, you’ll need to install the required Arduino library from the Library Manager. Using the method described in Chapter 7, search for and install the “TFT by Arduino, Adafruit” library.</p>&#13;
			<p>&#13;
				To use the LCD, insert the following three lines before <code>void setup()</code>:</p>&#13;
			<pre><code>#include &lt;TFT.h&gt;               // include the graphics LCD library&#13;
#include &lt;SPI.h&gt;               // include the library for the SPI data bus&#13;
TFT TFTscreen = TFT(10, 9, 8); // allocate pins to LCD&#13;
#include &lt;SPI.h&gt;               // library for SPI data bus</code></pre>&#13;
			<p>&#13;
				(Don’t panic about the “SPI data bus”; for now, the line above is all you need to know. We’ll examine the SPI bus in more detail in <span class="xref" itemid="xref_target_Chapter 19">Chapter 19</span>.)</p>&#13;
			<p>&#13;
				Then add the following lines inside <code>void setup()</code> to prepare the display:</p>&#13;
			<pre><code>  TFTscreen.begin();             // activate LCD   TFTscreen.background(0, 0, 0); // clear the LCD screen</code></pre>&#13;
			<h3 id="h2-500587c09-0006">Controlling the Display</h3>&#13;
			<p class="BodyFirst">There are five text sizes you can choose from, as shown in Figures 9-9 and 9-10.</p>&#13;
			<p>The first thing you need to consider is the background color for the display you are generating. This is set with:</p>&#13;
			<pre><code>  TFTscreen.background(b, g, r); // set background color</code></pre>&#13;
			<span epub:type="pagebreak" id="Page_175" title="175"/>&#13;
			<figure><img alt="f09009" src="image_fi/500587c09/f09009.png"/><figcaption>&#13;
					<p><a id="figure9-9">Figure 9-9</a>: Four of the five text sizes available on the LCD</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<figure>&#13;
				<img alt="f09010" src="image_fi/500587c09/f09010.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure9-10">Figure 9-10</a>: The largest of the five text sizes available on the LCD</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>&#13;
				You set the color of the background using RGB (red, green, blue) values between 0 and 255. For example, a white background would be maximum red, maximum green, and maximum blue—so 255, 255, 255. A pure red background would have a value of 255 for red and values of 0 for green and blue. For a black background, use zero for all three values. (You can find a handy list of RGB color tables at <a class="LinkURL" href="https://www.rapidtables.com/web/color/RGB_Color.html">https://www.rapidtables.com/web/color/RGB_Color.html</a>.)</p>&#13;
			<p>Next, you need to set the text size if you’re writing text to the LCD for the first time or if you need to change the size mid-sketch. To do this, use:</p>&#13;
			<pre><code>TFTscreen.setTextSize(<var>x</var>);</code></pre>&#13;
			<p class="BodyContinued">where <var>x</var> is a number between 1 and 5 that matches the text sizes shown in Figures 9-9 and 9-10.</p>&#13;
			<p>Then you set the color of the text with the following function:</p>&#13;
			<pre><code>TFTscreen.stroke(<var>B</var>, <var>G</var>, <var>R</var>);</code></pre>&#13;
			<p class="BodyContinued">where <var>B</var>,<em> </em><var>G</var>,<em> </em>and<em> </em><var>R</var> are the corresponding values for your blue, green, and red color levels, respectively.</p>&#13;
			<p>Finally, to write text to your screen, use the following function:</p>&#13;
			<pre><code>TFTscreen.text("Hello, world!", <var>x</var>, <var>y</var>);</code></pre>&#13;
			<p class="BodyContinued">This will display the text “Hello, world!” with the top left of the text positioned on the LCD at <var>x</var>, <var>y</var>.</p>&#13;
			<p>This works great for static text. However, if you want to display a numeric variable, you need to do a little more work. The variable needs to be converted from a number type to a character array whose size will match the largest possible value. For example, if you’re reading the Arduino’s analog input 0 and want to display the value, use this:</p>&#13;
			<pre><code>char analogZero[4];</code></pre>&#13;
			<p><span epub:type="pagebreak" id="Page_176" title="176"/>Then during the sketch, before sending the analog value to the LCD, convert the value to a string, like so:</p>&#13;
			<pre><code>String sensorVal = String(analogRead(A0));</code></pre>&#13;
			<p>This string gets converted and inserted into the character array:</p>&#13;
			<pre><code>sensorVal.toCharArray(analogZero, 4);</code></pre>&#13;
			<p>&#13;
				Finally,  to display the value on the LCD, we can use the <code>.text()</code> command as usual:</p>&#13;
			<pre><code>TFTscreen.text(<var>analogZero</var>, <var>x</var>, <var>y</var>);</code></pre>&#13;
			<p class="BodyContinued">where the value of <var>analogZero</var> is displayed with the top left of the text positioned at <var>x</var>, <var>y</var>.</p>&#13;
			<p>Now that we’ve been through all the commands for using text on the LCD, let’s put them into action in the next project.</p>&#13;
			<h2 class="HeadProject" id="h1-500587c09-0004"><span>Project #29: Seeing the Text Functions in Action</span></h2>&#13;
			<p class="BodyFirst">With this project, you’ll make your LCD display text in five sizes as well as the numeric value read from your Arduino’s analog input 0.</p>&#13;
			<h3 id="h2-500587c09-0007">The Sketch</h3>&#13;
			<p class="BodyFirst">Wire up your LCD as described in <a href="#table9-1">Table 9-1</a> and then upload the following sketch:</p>&#13;
			<pre><code>// Project 29 - Seeing the Text Functions in Action&#13;
#include &lt;TFT.h&gt;  // Arduino TFT LCD library&#13;
#include &lt;SPI.h&gt;  // SPI bus library&#13;
TFT TFTscreen = TFT(10, 9, 8);     // allocate digital pins to LCD&#13;
char analogZero[4];&#13;
void setup()&#13;
{ TFTscreen.begin();               // activate LCD TFTscreen.background(0, 0, 0);   // set display to black&#13;
}&#13;
void loop()&#13;
{ TFTscreen.stroke(255, 255, 255); // white text TFTscreen.setTextSize(1); TFTscreen.text("Size One", 0, 0); TFTscreen.setTextSize(2); TFTscreen.text("Size Two", 0, 10); TFTscreen.setTextSize(3);<span epub:type="pagebreak" id="Page_177" title="177"/>  TFTscreen.text("Size 3", 0, 30); TFTscreen.setTextSize(4); TFTscreen.text("Size 4", 0, 55); delay(2000); TFTscreen.background(0, 0, 0);   // set display to black TFTscreen.setTextSize(5); TFTscreen.text("Five", 0, 0); delay(2000); TFTscreen.background(0, 0, 0);   // set display to black TFTscreen.stroke(255, 255, 255); // white text TFTscreen.setTextSize(1); TFTscreen.text("Sensor Value :\n ", 0, 0); TFTscreen.setTextSize(3); String sensorVal = String(analogRead(A0)); // convert the reading to a char array sensorVal.toCharArray(analogZero, 4); TFTscreen.text(analogZero, 0, 20); delay(2000); TFTscreen.background(0, 0, 0);   // set display to black&#13;
}</code></pre>&#13;
			<h3 id="h2-500587c09-0008">Running the Sketch</h3>&#13;
			<p class="BodyFirst">You should see all five sizes of text displayed on the LCD over two screens. Then you should see a third screen with the value from analog input 0, like the example shown in <a href="#figure9-11" id="figureanchor9-11">Figure 9-11</a>.</p>&#13;
			<figure>&#13;
				<img alt="f09011" src="image_fi/500587c09/f09011.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure9-11">Figure 9-11</a>: Analog input value shown on TFT LCD</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h2 id="h1-500587c09-0005">Creating More Complex Display Effects with Graphic Functions</h2>&#13;
			<p class="BodyFirst">Now let’s look at the functions we can use to create various display effects. Keep in mind that the graphic LCD screen has a resolution of 160 columns by 128 pixels, but when we refer to these columns and pixels in functions in our sketches, they are counted from 0 to 159 across and 0 to 127 down. Also, as with the text example earlier, we still need to use the five lines of code mentioned in “Using a Character LCD in a Sketch” on <span class="xref" itemid="xref_target_page 169">page 169</span> to initialize the display.</p>&#13;
			<p><span epub:type="pagebreak" id="Page_178" title="178"/>There are various functions that allow you to display dots (single pixels), lines, rectangles, and circles on the display. Apply your project requirements and add a dash of imagination to create a colorful and useful display output. We’ll run through those functions now, and then you can see them in action through a demonstration sketch.</p>&#13;
			<p>Before drawing any object, you need to define its color. This is done with</p>&#13;
			<pre><code>TFTscreen.stroke(<var>B</var>, <var>G</var>, <var>R</var>);</code></pre>&#13;
			<p class="BodyContinued">where <var>B</var>,<em> </em><var>G</var>,<em> </em>and<em> </em><var>R</var> are the corresponding values for your blue, green, and red color levels, respectively.</p>&#13;
			<p>To draw a single dot on the display, we use</p>&#13;
			<pre><code>TFTscreen.point(<var>X</var>, <var>Y</var>);</code></pre>&#13;
			<p class="BodyContinued">where <var>X</var> and <var>Y</var> are the horizontal and vertical coordinates of the dot. With our LCD, the <var>X</var> range falls between 0 and 159 and the <var>Y</var> range falls between 0 and 127.</p>&#13;
			<p>To draw a line from one point to another, we use</p>&#13;
			<pre><code>TFTscreen.line(<var>X1</var>, <var>Y1</var>, <var>X2</var>, <var>Y2</var>);</code></pre>&#13;
			<p class="BodyContinued">where <var>X1</var> and <var>Y1</var> are the coordinates of the starting point and <var>X2</var> and <var>Y2</var> are the coordinates of the end of the line.</p>&#13;
			<p>To draw a circle, we use</p>&#13;
			<pre><code>TFTscreen.circle(<var>X</var>, <var>Y</var>, <var>R</var>);</code></pre>&#13;
			<p class="BodyContinued">where <var>X</var> and <var>Y</var> are the coordinates of the center of the circle, and <var>R</var> is the radius of the circle in pixels. If you wish to fill the circle (or a rectangle, described a bit later) with a color, instead of just drawing an outline, precede the <code>circle()</code> function with</p>&#13;
			<pre><code>TFTscreen.fill(<var>B</var>, <var>G</var>, <var>R</var>);</code></pre>&#13;
			<p class="BodyContinued">where <var>B</var>,<em> </em><var>G</var>,<em> </em>and<em> </em><var>R</var> are the corresponding values for your blue, green, and red fill levels, respectively. Note that a fill color doesn’t change the shape’s outline, so you still need to precede the shape function with the <code>stroke()</code> function.</p>&#13;
			<p>&#13;
				If you wish to draw more than one filled item, you only need to use the <code>fill()</code> command once. If you then want to turn off the fill and revert to outlines only, use this:</p>&#13;
			<pre><code>TFTscreen.noFill();</code></pre>&#13;
			<p>Finally, you can draw rectangles with the following function:</p>&#13;
			<pre><code>TFTscreen.rect(<var>X1</var>, <var>Y1</var>, <var>X2</var>, <var>Y2</var>);</code></pre>&#13;
			<p class="BodyContinued">where <var>X1</var>, <var>Y1</var> are the coordinates for the top left of the rectangle and <var>X2</var>, <var>Y2</var> are the coordinates for the bottom right of the rectangle.</p>&#13;
			<h2 class="HeadProject" id="h1-500587c09-0006"><span><span epub:type="pagebreak" id="Page_179" title="179"/>Project #30: Seeing the Graphic Functions in Action</span></h2>&#13;
			<p class="BodyFirst">Now that we’ve been through all the commands for using the graphic functions on the LCD, let’s put them into action in this project.</p>&#13;
			<h3 id="h2-500587c09-0009">The Sketch</h3>&#13;
			<p class="BodyFirst">Wire up your LCD as described in <a href="#table9-1">Table 9-1</a> and then upload the following sketch:</p>&#13;
			<pre><code>// Project 30 - Seeing the Graphic Functions in Action&#13;
#include &lt;TFT.h&gt;                 // Arduino TFT LCD library&#13;
#include &lt;SPI.h&gt;                 // SPI bus library&#13;
TFT TFTscreen = TFT(10, 9, 8);   // allocate digital pins to LCD&#13;
int a;&#13;
void setup()&#13;
{ TFTscreen.begin(); // activate LCD TFTscreen.background(0, 0, 0); // set display to black randomSeed(analogRead(0));     // for random numbers&#13;
}&#13;
void loop()&#13;
{ // random dots for (a = 0; a &lt; 100; a++) { TFTscreen.stroke(random(256), random(256), random(256)); TFTscreen.point(random(160), random(120)); delay(10); } delay(1000); TFTscreen.background(0, 0, 0); // set display to black // random lines for (a = 0; a &lt; 100; a++) { TFTscreen.stroke(random(256), random(256), random(256)); TFTscreen.line(random(160), random(120), random(160), random(120)); delay(10); } delay(1000); TFTscreen.background(0, 0, 0); // set display to black // random circles for (a = 0; a &lt; 50; a++) { TFTscreen.stroke(random(256), random(256), random(256)); TFTscreen.circle(random(160), random(120), random(50));<span epub:type="pagebreak" id="Page_180" title="180"/>    delay(10); } delay(1000); TFTscreen.background(0, 0, 0); // set display to black // random filled circles for (a = 0; a &lt; 50; a++) { TFTscreen.fill(random(256), random(256), random(256)); TFTscreen.stroke(random(256), random(256), random(256)); TFTscreen.circle(random(160), random(120), random(50)); delay(10); } delay(1000); TFTscreen.background(0, 0, 0); // set display to black // random rectangles TFTscreen.noFill(); for (a = 0; a &lt; 50; a++) { TFTscreen.stroke(random(256), random(256), random(256)); TFTscreen.rect(random(160), random(120), random(160), random(120)); delay(10); } delay(1000); TFTscreen.background(0, 0, 0); // set display to black // random filled rectangles TFTscreen.noFill(); for (a = 0; a &lt; 50; a++) { TFTscreen.fill(random(256), random(256), random(256)); TFTscreen.stroke(random(256), random(256), random(256)); TFTscreen.rect(random(160), random(120), random(160), random(120)); delay(10); } delay(1000); TFTscreen.background(0, 0, 0); // set display to black&#13;
}</code></pre>&#13;
			<p>&#13;
				After the sketch has uploaded, the display will run through all the graphic functions we have examined in this chapter. For example, you should see the lines shown in <a href="#figure9-12" id="figureanchor9-12">Figure 9-12</a>.</p>&#13;
			<p>With the functions discussed so far and some imagination, you can create a variety of display effects or display data graphically. In the next section, we’ll build on our quick-read thermometer project using the LCD screen and some of these functions.</p>&#13;
			<span epub:type="pagebreak" id="Page_181" title="181"/>&#13;
			<figure>&#13;
				<img alt="f09012" src="image_fi/500587c09/f09012.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure9-12">Figure 9-12</a>: Random lines on the LCD</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h2 class="HeadProject" id="h1-500587c09-0007"><span>Project #31: Creating a Temperature History Monitor</span></h2>&#13;
			<p class="BodyFirst">In this project, our goal is to measure the temperature once every 20 minutes and display the last 120 readings in a dot graph. Each reading will be represented as a pixel, with the temperature on the vertical axis and time on the horizontal axis.</p>&#13;
			<p>The most current reading will appear on the left, and the display will continually scroll the readings from left to right. The current temperature will also be displayed as a numeral.</p>&#13;
			<h3 id="h2-500587c09-0010">The Algorithm</h3>&#13;
			<p class="BodyFirst">Although it may sound complex, this project is fairly easy, requiring only two functions. The first function takes a temperature reading from the TMP36 temperature sensor and stores it in an array of 120 values. Each time a new reading is taken, the previous 119 values are moved down the array to make way for the new reading, and the oldest reading is erased.</p>&#13;
			<p>The second function draws on the LCD screen. It displays the current temperature, a scale for the graph, and the positions of each pixel for the display of the temperature data over time.</p>&#13;
			<h3 id="h2-500587c09-0011">The Hardware</h3>&#13;
			<p class="BodyFirst">Here’s what you’ll need to create this project:</p>&#13;
			<ul>&#13;
				<li>&#13;
					One 160 <span class="NSSymbol">×</span> 128-pixel ST7735 TFT LCD module, as used in this chapter</li>&#13;
				<li>One TMP36 temperature sensor</li>&#13;
				<li>Various connecting wires</li>&#13;
				<li>One breadboard</li>&#13;
				<li>Arduino and USB cable</li>&#13;
			</ul>&#13;
			<p><span epub:type="pagebreak" id="Page_182" title="182"/>Connect the graphic LCD as described in <a href="#table9-1">Table 9-1</a> and connect the TMP36 sensor to 5 V, analog 5, and GND as you did in Project 20 in <span class="xref" itemid="xref_target_Chapter 6">Chapter 6</span>.</p>&#13;
			<h3 id="h2-500587c09-0012">The Sketch</h3>&#13;
			<p class="BodyFirst">Our sketch combines the code we used to measure temperature in <span class="xref" itemid="xref_target_Chapter 6">Chapter 6</span> and the graphic functions described earlier in this chapter. Enter and upload the following sketch, which includes relevant comments about the functions used:</p>&#13;
			<pre><code>// Project 31 - Creating a Temperature History Monitor&#13;
#include &lt;TFT.h&gt;  // Arduino TFT LCD library&#13;
#include &lt;SPI.h&gt;  // SPI bus library&#13;
TFT TFTscreen = TFT(10, 9, 8); &#13;
// allocate digital pins to LCD&#13;
int tcurrent = 0;&#13;
int tempArray[120];&#13;
char currentString[3];&#13;
void getTemp() // function to read temperature from TMP36&#13;
{ float sum = 0; float voltage = 0; float sensor = 0; float celsius; // read the temperature sensor and convert the result to degrees C sensor   = analogRead(5); voltage  = (sensor * 5000) / 1024; voltage  = voltage - 500; celsius  = voltage / 10; tcurrent = int(celsius); // insert the new temperature at the start of the array of past temperatures for (int a = 119 ; a &gt;= 0 ; --a ) { tempArray[a] = tempArray[a - 1]; } tempArray[0] = tcurrent;&#13;
}&#13;
void drawScreen() // generate TFT LCD display effects<span epub:type="pagebreak" id="Page_183" title="183"/>{ int q; // display current temperature TFTscreen.background(0, 0, 0);   // clear screen to black TFTscreen.stroke(255, 255, 255); // white text TFTscreen.setTextSize(2); TFTscreen.text("Current:", 20, 0); String tempString = String(tcurrent); tempString.toCharArray(currentString, 3); TFTscreen.text(currentString, 115, 0); // draw scale for graph TFTscreen.setTextSize(1); TFTscreen.text("50", 0, 20); TFTscreen.text("45", 0, 30); TFTscreen.text("40", 0, 40); TFTscreen.text("35", 0, 50); TFTscreen.text("30", 0, 60); TFTscreen.text("25", 0, 70); TFTscreen.text("20", 0, 80); TFTscreen.text("15", 0, 90); TFTscreen.text("10", 0, 100); TFTscreen.text(" 5", 0, 110); TFTscreen.text(" 0", 0, 120); TFTscreen.line(20, 20, 20, 127); // plot temperature data points for (int a = 25 ; a &lt; 145 ; a++) { // convert the temperature value to a suitable y-axis position on the LCD q = (123 - (tempArray[a - 25] * 2)); TFTscreen.point(a, q); }&#13;
}&#13;
void setup()&#13;
{ TFTscreen.begin();             // activate LCD TFTscreen.background(0, 0, 0); // set display to black&#13;
}&#13;
void loop()&#13;
{ getTemp(); drawScreen(); for (int a = 0 ; a &lt; 20 ; a++) // wait 20 minutes until the next reading { delay(60000);                // wait 1 minute }&#13;
}</code></pre>&#13;
			<h3 id="h2-500587c09-0013"><span epub:type="pagebreak" id="Page_184" title="184"/>Running the Sketch</h3>&#13;
			<p class="BodyFirst">The resulting display should look something like <a href="#figure9-13" id="figureanchor9-13">Figure 9-13</a>.</p>&#13;
			<figure>&#13;
				<img alt="f09013" src="image_fi/500587c09/f09013.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure9-13">Figure 9-13</a>: Results of Project 31</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h3 id="h2-500587c09-0014">Modifying the Sketch</h3>&#13;
			<p class="BodyFirst">Different people can interpret data better when they see it presented in different visual formats. For this reason, you may want to create a bar graph instead, with vertical lines indicating the values.</p>&#13;
			<p>This type of project could also be used to display other kinds of data, such as the voltage from various sensors as measured by analog input pins. Or you could add another temperature sensor and show both values at once. Almost anything that returns a value can be displayed using the graphic LCD module.</p>&#13;
			<h2 id="h1-500587c09-0008">Looking Ahead</h2>&#13;
			<p class="BodyFirst">Now that you have experience with LCDs, you can see that the Arduino is in fact a small computer: it can accept and process incoming data and display it to the outside world. But this is only the beginning. In the next chapter, you’ll examine libraries in much more depth, learn to write your own library, and then use your new library with the temperature sensor used in previous projects.</p>&#13;
		</section>&#13;
	</body></html>