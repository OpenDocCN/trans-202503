<html><head></head><body>
<h1 class="part" id="part01"><span epub:type="pagebreak" id="page_21"/><strong>PART 1</strong><br/><img alt="image" class="middle" src="../images/common-01.jpg"/><br/><span class="big"><strong>LEDS</strong></span></h1>&#13;


<h2 class="h2a" id="ch01"><span epub:type="pagebreak" id="page_22"/>PROJECT 1: PUSHBUTTON-CONTROLLED LED</h2>&#13;
<p class="h2sub"><strong><span class="red">IN THIS PROJECT, YOU’LL ADD A PUSHBUTTON SWITCH TO AN LED CIRCUIT TO CONTROL WHEN THE LED IS LIT.</span></strong></p>&#13;
<div class="image2"><img alt="image" src="../images/f0022-01.jpg"/></div>&#13;
<div class="image2"><span epub:type="pagebreak" id="page_23"/><img alt="image" src="../images/f0023-01.jpg"/></div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="red"><strong>PARTS REQUIRED</strong></span></p>&#13;
<p class="bull">• Arduino board</p>&#13;
<p class="bull">• Breadboard</p>&#13;
<p class="bull">• Jumper wires</p>&#13;
<p class="bull">• LED</p>&#13;
<p class="bull">• Momentary tactile four-pin pushbutton</p>&#13;
<p class="bull">• 10k-ohm resistor</p>&#13;
<p class="bull">• 220-ohm resistor</p>&#13;
</div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_24"/>This project will take you through the basics of switches, which you’ll be using a lot throughout this book. Almost all electrical items use switches to turn an element on or off. There are many types of switches, and the one you’ll use now is a pushbutton (<a href="ch01.xhtml#ch1fig1">Figure 1-1</a>).</p>&#13;
<p class="figcaption"><a id="ch1fig1"/><strong>FIGURE 1-1:</strong><br/>A pushbutton</p>&#13;
<div class="image"><img alt="image" src="../images/f01-01.jpg"/></div>&#13;
<h3 class="h3" id="ch01lev1sec01"><span class="red"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">When pressed, a pushbutton completes a circuit, turning it on. As soon as the button is released, the connection will spring back and break that circuit, turning it off. The pushbutton switch is also known as a <em>momentary</em> or <em>normally open</em> switch, and is used in, for example, computer keyboards. This is in contrast to a <em>toggle switch</em>, which stays either on or off until you toggle it to the other position, like a light switch.</p>&#13;
<p class="indent">This type of pushbutton has four pins, but you generally use only two at a time for connection. You’ll use the top connections in this project, although the two unused pins at the bottom would do the same job. As <a href="ch01.xhtml#ch1fig2">Figure 1-2</a> shows, the pins work in a circuit. Pins A and C are always connected, as are pins B and D. When the button is pressed, the circuit is complete.</p>&#13;
<p class="figcaption"><a id="ch1fig2"/><strong>FIGURE 1-2:</strong><br/>A pushbutton’s incomplete circuit</p>&#13;
<div class="image"><img alt="image" src="../images/f01-02.jpg"/></div>&#13;
<h3 class="h3" id="ch01lev1sec02"><span epub:type="pagebreak" id="page_25"/><span class="red"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindenta">Place your pushbutton in a breadboard, as shown in <a href="ch01.xhtml#ch1fig3">Figure 1-3</a>.</p>&#13;
<p class="figcaption"><a id="ch1fig3"/><strong>FIGURE 1-3:</strong><br/>Placing your pushbutton</p>&#13;
<div class="image"><img alt="image" src="../images/f01-03.jpg"/></div></li>&#13;
<li><p class="noindenta">Connect pin A to one leg of a 10k-ohm resistor, and connect that same resistor leg to Arduino pin 2. Connect the other resistor leg to the GND rail, and connect the GND rail to the Arduino’s GND. Connect pin B on the switch to the +5V rail, and connect this rail to +5V on the Arduino.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a" style="vertical-align: middle;"><p class="tablec"><strong>PUSHBUTTON</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a" style="vertical-align: middle;"><p class="tablec"><span class="red">Pin A</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="red">GND and pin 2 via 10k-ohm resistor</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a" style="vertical-align: middle;"><p class="tablec"><span class="red">Pin B</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="red">+5V</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Add the LED to your breadboard, connecting the longer, positive leg to Arduino pin 13 via a 220-ohm resistor and the shorter leg to GND.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a" style="vertical-align: middle;"><p class="tablec"><strong>LED</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a" style="vertical-align: middle;"><p class="tablec"><span class="red">Positive leg</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="red">Pin 13 via 220-ohm resistor</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a" style="vertical-align: middle;"><p class="tablec"><span class="red">Negative leg</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="red">GND</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Confirm that your setup matches the circuit diagram shown in <a href="ch01.xhtml#ch1fig4">Figure 1-4</a>, and then upload the code in “<a href="ch01.xhtml#ch01lev1sec03">The Sketch</a>” on <a href="ch01.xhtml#page_27">page 27</a>.</p>&#13;
<p class="figcaption"><a id="ch1fig4"/><strong>FIGURE 1-4:</strong><br/>Circuit diagram for the pushbutton-controlled LED</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_26"/><img alt="image" src="../images/f01-04.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch01lev1sec03"><span epub:type="pagebreak" id="page_27"/><span class="red"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">In this sketch, you assign a pin for the pushbutton and set it as <code>INPUT</code>, and a pin for the LED and set it as <code>OUTPUT</code>. The code tells the Arduino to turn the LED on as long as the button is being pressed (completing the circuit), and to keep the LED off when the button is not being pressed. When the button is released, the circuit breaks and the LED will turn off again.</p>&#13;
<pre><span class="ash">/* by DojoDave &lt;http://www.0j0.org&gt;</span><br/>   <span class="ash">modified 30 Aug 2011 by Tom Igoe</span><br/>   <span class="ash">This example code is in the public domain.</span><br/>   <span class="ash">http://www.arduino.cc/en/Tutorial/Button</span><br/><span class="ash">*/</span><br/><br/><span class="green2">const int</span> buttonPin = 2;      <span class="ash">// Pin connected to pushbutton</span><br/><span class="green2">const int</span> ledPin = 13;        <span class="ash">// Pin connected to LED</span><br/><span class="green2">int</span> buttonState = 0;          <span class="ash">// Give pushbutton a value</span><br/><br/><span class="green2">void</span> <span class="green3">setup</span>() {<br/>  <span class="orange1">pinMode</span>(ledPin, <span class="green2">OUTPUT</span>);    <span class="ash">// Set LED pin as output</span><br/>  <span class="orange1">pinMode</span>(buttonPin, <span class="green2">INPUT</span>);  <span class="ash">// Set pushbutton pin as input</span><br/>}<br/><br/><span class="green2">void</span> <span class="green3">loop</span>() {<br/>  buttonState = <span class="orange1">digitalRead</span>(buttonPin); <span class="ash">// Read input from pin 2</span><br/>  <span class="green3">if</span> (buttonState == <span class="green2">HIGH</span>) { <span class="ash">// If pushbutton is pressed, set as HIGH</span><br/>    <span class="orange1">digitalWrite</span>(ledPin, <span class="green2">HIGH</span>); <span class="ash">// Turn on LED</span><br/>  }<br/>  <span class="green3">else</span> {<br/>    <span class="orange1">digitalWrite</span>(ledPin, <span class="green2">LOW</span>);  <span class="ash">// Otherwise, turn off LED</span><br/>  }<br/>}</pre>&#13;


<h2 class="h2a" id="ch02"><span epub:type="pagebreak" id="page_28"/>PROJECT 2: LIGHT DIMMER</h2>&#13;
<p class="h2sub"><strong><span class="red">IN THIS PROJECT, YOU’LL CREATE A DIMMER SWITCH BY ADDING A POTENTIOMETER TO CONTROL THE BRIGHTNESS OF AN LED.</span></strong></p>&#13;
<div class="image2"><img alt="image" src="../images/f0028-01.jpg"/></div>&#13;
<div class="image2"><span epub:type="pagebreak" id="page_29"/><img alt="image" src="../images/f0029-01.jpg"/></div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="red"><strong>PARTS REQUIRED</strong></span></p>&#13;
<p class="bull">• Arduino board</p>&#13;
<p class="bull">• Breadboard</p>&#13;
<p class="bull">• Jumper wires</p>&#13;
<p class="bull">• LED</p>&#13;
<p class="bull">• 50k-ohm potentiometer</p>&#13;
<p class="bull">• 470-ohm resistor</p>&#13;
</div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_30"/>A <em>potentiometer</em> is a variable resistor with a knob that allows you to alter the resistance of the potentiometer as you turn it. It is commonly used in electrical devices such as volume controls on audio equipment. This project uses a 50k-ohm potentiometer.</p>&#13;
<h3 class="h3" id="ch02lev1sec01"><span class="red"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">The potentiometer manipulates a continuous <em>analog</em> signal, which represents physical measurements. Humans perceive the world in analog; everything we see and hear is a continuous transmission of information to our senses. This continuous stream is what defines analog data. Digital information, on the other hand, estimates analog data using only numbers. To approximate the continuous analog data from the potentiometer, the Arduino must represent the signal as a series of discrete numbers—in this case, voltages. The center pin of the potentiometer sends the signal to an Arduino analog IN—any pin from A0 to A5—to read the value.</p>&#13;
<p class="indent">The LED is actually being switched on and off, but it happens so quickly that our eyes compensate and we see a continuously lit LED at varying light levels. This is known as <em>persistence of vision</em>.</p>&#13;
<p class="indent">To create persistence of vision, the Arduino uses a technique called <em>pulse width modulation (PWM)</em>. The Arduino creates a pulse by switching the power on and off very quickly. The duration that the power is on or off (known as the <em>pulse width</em>) in the cycle determines the average output, and by varying this pulse width the pattern can simulate voltages between full on (5 volts) and off (0 volts). If the signal from the Arduino is on for half the time and off for half, the average output will be 2.5 volts, halfway between 0 and 5. If the signal is on for 80 percent and off for 20 percent, then the average voltage is 4 volts, and so on. You can vary the signal, which in turn varies the pulse width, by turning the potentiometer left or right, increasing or decreasing the resistance.</p>&#13;
<p class="indent">Using this technique, you can change the voltage sent to the LED and make it dimmer or brighter to match the analog signal from the potentiometer. Only pins 3, 5, 6, 9, 10, or 11 on the Arduino can use PWM. <a href="ch02.xhtml#ch2fig1">Figure 2-1</a> gives examples of how PWM would look as a waveform.</p>&#13;
<p class="figcaption"><a id="ch2fig1"/><strong>FIGURE 2-1:</strong><br/>Pulse width modulation as a waveform</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_31"/><img alt="image" src="../images/f02-01.jpg"/></div>&#13;
<h3 class="h3" id="ch02lev1sec02"><span class="red"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindenta">Insert the potentiometer into your breadboard and connect the center pin to the Arduino’s A0 pin. Connect one of the outer pins to the +5V rail of the breadboard and the other outer pin to GND on the breadboard (it doesn’t actually matter which way around the outer potentiometer pins are connected; these instructions just reflect the diagrams in this project), as shown in <a href="ch02.xhtml#ch2fig2">Figure 2-2</a>.</p>&#13;
<p class="figcaption"><a id="ch2fig2"/><strong>FIGURE 2-2:</strong><br/>Connecting the potentiometer to the Arduino</p>&#13;
<div class="image"><img alt="image" src="../images/f02-02.jpg"/></div>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a" style="vertical-align: middle;"><p class="tablec"><span epub:type="pagebreak" id="page_32"/><strong>POTENTIOMETER</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a" style="vertical-align: middle;"><p class="tablec"><span class="red">Left pin</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="red">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a" style="vertical-align: middle;"><p class="tablec"><span class="red">Center pin</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="red">A0</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a" style="vertical-align: middle;"><p class="tablec"><span class="red">Right pin</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="red">GND</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Insert the LED into the breadboard. Attach the positive leg (the longer leg) to pin 9 of the Arduino via the 470-ohm resistor, and the negative leg to GND, as shown in <a href="ch02.xhtml#ch2fig3">Figure 2-3</a>.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a" style="vertical-align: middle;"><p class="tablec"><strong>LED</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a" style="vertical-align: middle;"><p class="tablec"><span class="red">Positive leg</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="red">Pin 9</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a" style="vertical-align: middle;"><p class="tablec"><span class="red">Negative leg</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="red">GND via 470-ohm resistor</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="figcaption"><a id="ch2fig3"/><strong>FIGURE 2-3:</strong><br/>Circuit diagram for the light dimmer</p>&#13;
<div class="image"><img alt="image" src="../images/f02-03.jpg"/></div></li>&#13;
<li><p class="noindenta"><span epub:type="pagebreak" id="page_33"/>Upload the code in “<a href="ch01.xhtml#ch01lev1sec03">The Sketch</a>” below.</p></li>&#13;
<li><p class="noindenta">Turn the potentiometer to control the brightness of the LED.</p></li>&#13;
</ol>&#13;
<p class="indent">This project has many potential uses: you can cluster a number of LEDs together to create an adjustable flashlight, a night-light, a display case light, or anything else that uses dimming lights.</p>&#13;
<h3 class="h3" id="ch02lev1sec03"><span class="red"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">This sketch works by setting pin A0 as your potentiometer and pin 9 as an <code>OUTPUT</code> to power the LED. You then run a loop that continually reads the value from the potentiometer and sends that value as voltage to the LED. The voltage value is between 0–5 volts, and the brightness of the LED will vary accordingly.</p>&#13;
<pre><span class="ash">/* http://arduino.cc/en/Reference/AnalogWrite by Tom Igoe</span><br/>   <span class="ash">from http:itp.nyu.edu/physcomp/Labs/AnalogIn */</span><br/><br/><span class="green2">int</span> potPin = A0; <span class="ash">// Analog input pin connected to the potentiometer</span><br/><span class="green2">int</span> potValue = 0; <span class="ash">// Value that will be read from the potentiometer</span><br/><span class="green2">int</span> led = 9; <span class="ash">// Pin 9 (connected to the LED) is capable of PWM</span><br/><br/><span class="ash">// Runs once at beginning of the program</span><br/><span class="green2">void</span> <span class="green3">setup</span>() {<br/>  <span class="orange1">pinMode</span>(led, <span class="green2">OUTPUT</span>); <span class="ash">// Set pin 9 to output</span><br/>}<br/><br/><span class="ash">// Loops continuously</span><br/><span class="green2">void</span> <span class="green3">loop</span>() {<br/>  potValue = <span class="orange1">analogRead</span>(potPin); <span class="ash">// Read potentiometer value</span><br/>                                 <span class="ash">// from A0 pin</span><br/>  <span class="orange1">analogWrite</span>(led, potValue/4);  <span class="ash">// Send potentiometer value to LED</span><br/>                                 <span class="ash">// to control brightness with PWM</span><br/>  <span class="orange1">delay</span>(10);                     <span class="ash">// Wait for 10 ms</span><br/>}</pre>&#13;


<h2 class="h2a" id="ch03"><span epub:type="pagebreak" id="page_34"/>PROJECT 3: BAR GRAPH</h2>&#13;
<p class="h2sub"><strong><span class="red">IN THIS PROJECT, YOU’LL COMBINE WHAT YOU’VE LEARNED IN THE PREVIOUS LED PROJECTS TO CREATE AN LED BAR GRAPH THAT YOU CAN CONTROL WITH A POTENTIOMETER.</span></strong></p>&#13;
<div class="image2"><img alt="image" src="../images/f0034-01.jpg"/></div>&#13;
<div class="image2"><span epub:type="pagebreak" id="page_35"/><img alt="image" src="../images/f0035-01.jpg"/></div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="red"><strong>PARTS REQUIRED</strong></span></p>&#13;
<p class="bull">• Arduino board</p>&#13;
<p class="bull">• Breadboard</p>&#13;
<p class="bull">• Jumper wires</p>&#13;
<p class="bull">• 9 LEDs</p>&#13;
<p class="bull">• 50k-ohm potentiometer</p>&#13;
<p class="bull">• 9 220-ohm resistors</p>&#13;
</div>&#13;
<h3 class="h3" id="ch03lev1sec01"><span epub:type="pagebreak" id="page_36"/><span class="red"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">A bar graph is a series of LEDs in a line, similar to what you might see on an audio display. It’s made up of a row of LEDs with an analog input, like a potentiometer or microphone. In this project, you use the analog signal from the potentiometer to control which LEDs are lit. When you turn the potentiometer one way, the LEDs light up one at a time in sequence, as shown in <a href="ch03.xhtml#ch3fig1">Figure 3-1</a>(a), until they are all on, shown in <a href="ch03.xhtml#ch3fig1">Figure 3-1</a>(b). When you turn it the other way, they turn off in sequence, as shown in <a href="ch03.xhtml#ch3fig1">Figure 3-1</a>(c).</p>&#13;
<p class="figcaption"><a id="ch3fig1"/><strong>FIGURE 3-1:</strong><br/>The LEDs light up and turn off in sequence as you turn the potentiometer.</p>&#13;
<div class="image"><img alt="image" src="../images/f03-01.jpg"/></div>&#13;
<h3 class="h3" id="ch03lev1sec02"><span epub:type="pagebreak" id="page_37"/><span class="red"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindenta">Insert the LEDs into the breadboard with their shorter, negative legs in the GND rail. Connect this rail to Arduino GND using a jumper wire.</p></li>&#13;
<li><p class="noindenta">Insert a 220-ohm resistor for each LED into the breadboard, with one resistor leg connected to the positive LED leg. Connect the other legs of the resistors to digital pins 2–10 in sequence, as shown in <a href="ch03.xhtml#ch3fig2">Figure 3-2</a>. It’s important that the resistors bridge the break in the breadboard as shown.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a" style="vertical-align: middle;"><p class="tablec"><strong>LEDS</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a" style="vertical-align: middle;"><p class="tablec"><span class="red">Positive legs</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="red">Pins 2–10 via 220-ohm resistor</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a" style="vertical-align: middle;"><p class="tablec"><span class="red">Negative legs</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="red">GND</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="figcaption"><a id="ch3fig2"/><strong>FIGURE 3-2:</strong><br/>Circuit diagram for the bar graph</p>&#13;
<div class="image"><img alt="image" src="../images/f03-02.jpg"/></div>&#13;
<div class="note">&#13;
<p class="notet"><span epub:type="pagebreak" id="page_38"/><strong>NOTE</strong></p>&#13;
<p class="notep"><em>As mentioned in <a href="ch02.xhtml#ch02">Project 2</a>, it doesn’t actually matter which way the outer potentiometer pins are connected, but I’ve given instructions here to reflect the images.</em></p>&#13;
</div></li>&#13;
<li><p class="noindenta">Place the potentiometer in the breadboard and connect the center pin to Arduino A0. Connect the right outer pin to +5V and the left potentiometer pin to GND.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a" style="vertical-align: middle;"><p class="tablec"><strong>POTENTIOMETER</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a" style="vertical-align: middle;"><p class="tablec"><span class="red">Left pin</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="red">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a" style="vertical-align: middle;"><p class="tablec"><span class="red">Center pin</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="red">A0</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a" style="vertical-align: middle;"><p class="tablec"><span class="red">Right pin</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="red">+5V</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Upload the code in “<a href="ch03.xhtml#ch03lev1sec03">The Sketch</a>” below.</p></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch03lev1sec03"><span class="red"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">The sketch first reads the input from the potentiometer. It maps the input value to the output range, in this case nine LEDs. Then it sets up a <code>for</code> loop over the outputs. If the output number of the LED in the series is lower than the mapped input range, the LED turns on; if not, it turns off. See? Simple! If you turn the potentiometer to the right, the LEDs light up in sequence. Turn it to the left, and they turn off in sequence.</p>&#13;
<pre><span class="ash">/* By Tom Igoe. This example code is in the public domain.</span><br/>   <span class="ash">http://www.arduino.cc/en/Tutorial/BarGraph */</span><br/><br/><span class="green2">const int</span> analogPin = A0; <span class="ash">// Pin connected to the potentiometer</span><br/><span class="green2">const int</span> ledCount = 9;   <span class="ash">// Number of LEDs</span><br/><span class="green2">int</span> ledPins[] = {2,3,4,5,6,7,8,9,10}; <span class="ash">// Pins connected to the LEDs</span><br/><br/><span class="green2">void</span> <span class="green3">setup</span>() {<br/>  <span class="green3">for</span> (<span class="green2">int</span> thisLed = 0; thisLed &lt; ledCount; thisLed++) {<br/>    <span class="orange1">pinMode</span>(ledPins[thisLed], <span class="green2">OUTPUT</span>); <span class="ash">// Set the LED pins as output</span><br/>  }<br/>}<br/><br/><span class="ash">// Start a loop</span><br/><span class="green2">void</span> <span class="green3">loop</span>() {<br/>  <span class="green2">int</span> sensorReading = <span class="orange1">analogRead</span>(analogPin); <span class="ash">// Analog input</span><br/>  <span class="green2">int</span> ledLevel = <span class="orange1">map</span>(sensorReading, 0, 1023, 0, ledCount);<br/>  <span class="green3">for</span> (<span class="green2">int</span> thisLed = 0; thisLed &lt; ledCount; thisLed++) {<br/>    <span class="green3">if</span> (thisLed &lt; ledLevel) { <span class="ash">// Turn on LEDs in sequence</span><br/>      <span class="orange1">digitalWrite</span>(ledPins[thisLed], <span class="green2">HIGH</span>);<br/>    }<br/>    <span class="green3">else</span> { <span class="ash">// Turn off LEDs in sequence</span><br/>      <span class="orange1">digitalWrite</span>(ledPins[thisLed], <span class="green2">LOW</span>);<br/>    }<br/>  }<br/>}</pre>&#13;


<h2 class="h2a" id="ch04"><span epub:type="pagebreak" id="page_39"/>PROJECT 4: DISCO STROBE LIGHT</h2>&#13;
<p class="h2sub"><strong><span class="red">IN THIS PROJECT, YOU’LL APPLY THE SKILLS YOU LEARNED IN <a href="ch03.xhtml#ch03"><span class="red">PROJECT 3</span></a> TO MAKE A STROBE LIGHT WITH ADJUSTABLE SPEED SETTINGS.</span></strong></p>&#13;
<div class="image2"><img alt="image" src="../images/f0039-01.jpg"/></div>&#13;
<div class="image2"><span epub:type="pagebreak" id="page_40"/><img alt="image" src="../images/f0040-01.jpg"/></div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="red"><strong>PARTS REQUIRED</strong></span></p>&#13;
<p class="bull">• Arduino board</p>&#13;
<p class="bull">• Breadboard</p>&#13;
<p class="bull">• Jumper wires</p>&#13;
<p class="bull">• 2 blue LEDs</p>&#13;
<p class="bull">• 2 red LEDs</p>&#13;
<p class="bull">• 50k-ohm potentiometer</p>&#13;
<p class="bull">• 4 220-ohm resistors</p>&#13;
</div>&#13;
<h3 class="h3" id="ch04lev1sec01"><span epub:type="pagebreak" id="page_41"/><span class="red"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">Turning the potentiometer up or down changes the speed of the flashing lights, creating a strobe effect. You can use red and blue LEDs for a flashing police light effect (see <a href="ch04.xhtml#ch4fig1">Figure 4-1</a>). Connect the LEDs of the same color to the same Arduino pin so they’ll always light together. If you build a casing to house your LEDs, you’ll have your own mobile strobe unit. You can add up to 10 LEDs; just update the sketch to include your output pins and the new number of LEDs.</p>&#13;
<p class="figcaption"><a id="ch4fig1"/><strong>FIGURE 4-1:</strong><br/>Red and blue LEDs mimic the lights of a police car.</p>&#13;
<div class="image"><img alt="image" src="../images/f04-01.jpg"/></div>&#13;
<h3 class="h3" id="ch04lev1sec02"><span class="red"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindenta">Place your LEDs into the breadboard with the short, negative legs in the GND rail, and then connect this rail to Arduino GND.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>Remember to add power to the breadboard.</em></p>&#13;
</div></li>&#13;
<li><p class="noindenta">Insert the resistors into the board, connecting them to the longer, positive legs of the LEDs. Use jumper wires to connect the two red LEDs together and the two blue LEDs together via the resistors, as shown in <a href="ch04.xhtml#ch4fig2">Figure 4-2</a>; this allows the LEDs of the same color to be controlled by a single pin.</p>&#13;
<p class="figcaption"><a id="ch4fig2"/><strong>FIGURE 4-2:</strong><br/>Connecting LEDs with jumper wires</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_42"/><img alt="image" src="../images/f04-02.jpg"/></div></li>&#13;
<li><p class="noindenta">Connect the red LEDs to Arduino pin 12 and the blue LEDs to Arduino pin 11.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a" style="vertical-align: middle;"><p class="tablec"><strong>LEDS</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a" style="vertical-align: middle;"><p class="tablec"><span class="red">Negative legs</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="red">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a" style="vertical-align: middle;"><p class="tablec"><span class="red">Positive leg (red)</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="red">Pin 12</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a" style="vertical-align: middle;"><p class="tablec"><span class="red">Positive leg (blue)</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="red">Pin 11</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Place the potentiometer in the breadboard and connect the center pin to Arduino A0, the left pin to GND, and the right pin to +5V.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a" style="vertical-align: middle;"><p class="tablec"><strong>POTENTIOMETER</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a" style="vertical-align: middle;"><p class="tablec"><span class="red">Left pin</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="red">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a" style="vertical-align: middle;"><p class="tablec"><span class="red">Center pin</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="red">A0</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a" style="vertical-align: middle;"><p class="tablec"><span class="red">Right pin</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="red">+5V</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Confirm that your setup matches that of <a href="ch04.xhtml#ch4fig3">Figure 4-3</a>, and then upload the code in “<a href="ch04.xhtml#ch04lev1sec03">The Sketch</a>” on <a href="ch04.xhtml#page_43">page 43</a>.</p>&#13;
<p class="figcaption"><a id="ch4fig3"/><strong>FIGURE 4-3:</strong><br/>Circuit diagram for the disco strobe light</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_43"/><img alt="image" src="../images/f04-03.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch04lev1sec03"><span class="red"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">The sketch works by setting the analog signal from the potentiometer to the Arduino as an input and the pins connected to the LEDs as outputs. The Arduino reads the analog input from the potentiometer and uses this value as the <em>delay value</em>—the amount of time that passes before the LEDs change state (either on or off). This means that the LEDs are on and off for the duration of the potentiometer value, so changing this value alters the speed of the flashing. The sketch cycles through the LEDs to produce a strobe effect.</p>&#13;
<pre><span epub:type="pagebreak" id="page_44"/><span class="green2">const int</span> analogInPin = A0; <span class="ash">// Analog input pin connected to the</span><br/>                            <span class="ash">// potentiometer</span><br/><span class="green2">int</span> sensorValue = 0;        <span class="ash">// Value read from the potentiometer</span><br/><span class="green2">int</span> timer = 0;              <span class="ash">// Delay value</span><br/><br/><span class="ash">// Set digital pins 12 and 11 as outputs</span><br/><span class="green2">void</span> <span class="green3">setup</span>() {<br/>  <span class="orange1">pinMode</span>(12, <span class="green2">OUTPUT</span>);<br/>  <span class="orange1">pinMode</span>(11, <span class="green2">OUTPUT</span>);<br/>}<br/><br/><span class="ash">// Start a loop to turn LEDs on and off with a delay in between</span><br/><span class="green2">void</span> <span class="green3">loop</span>() {<br/>  sensorValue = <span class="orange1">analogRead</span>(analogInPin); <span class="ash">// Read value from the</span><br/>                                         <span class="ash">// potentiometer</span><br/>  timer = <span class="orange1">map</span>(sensorValue, 0, 1023, 10, 500); <span class="ash">// Delay 10 to 500 ms</span><br/>  <span class="orange1">digitalWrite</span>(12, <span class="green2">HIGH</span>); <span class="ash">// LED turns on</span><br/>  <span class="orange1">delay</span>(timer);           <span class="ash">// Delay depending on potentiometer value</span><br/>  <span class="orange1">digitalWrite</span>(12, <span class="green2">LOW</span>);  <span class="ash">// LED turns off</span><br/>  <span class="orange1">delay</span>(timer);<br/>  <span class="orange1">digitalWrite</span>(12, <span class="green2">HIGH</span>);<br/>  <span class="orange1">delay</span>(timer);<br/>  <span class="orange1">digitalWrite</span>(12, <span class="green2">LOW</span>);<br/>  <span class="orange1">digitalWrite</span>(11, <span class="green2">HIGH</span>);<br/>  <span class="orange1">delay</span>(timer);<br/>  <span class="orange1">digitalWrite</span>(11, <span class="green2">LOW</span>);<br/>  <span class="orange1">delay</span>(timer);<br/>  <span class="orange1">digitalWrite</span>(11, <span class="green2">HIGH</span>);<br/>  <span class="orange1">delay</span>(timer);<br/>  <span class="orange1">digitalWrite</span>(11, <span class="green2">LOW</span>);<br/>}</pre>&#13;


<h2 class="h2a" id="ch05"><span epub:type="pagebreak" id="page_45"/>PROJECT 5: PLANT MONITOR</h2>&#13;
<p class="h2sub"><strong><span class="red">IN THIS PROJECT I’LL INTRODUCE A NEW TYPE OF ANALOG SENSOR THAT DETECTS MOISTURE LEVELS. YOU’LL SET UP A LIGHT AND SOUND ALARM SYSTEM TO TELL YOU WHEN YOUR PLANT NEEDS WATERING.</span></strong></p>&#13;
<div class="image2"><img alt="image" src="../images/f0045-01.jpg"/></div>&#13;
<div class="image2"><span epub:type="pagebreak" id="page_46"/><img alt="image" src="../images/f0046-01.jpg"/></div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="red"><strong>PARTS REQUIRED</strong></span></p>&#13;
<p class="bull">• Arduino board</p>&#13;
<p class="bull">• Jumper wires</p>&#13;
<p class="bull">• LED</p>&#13;
<p class="bull">• HL-69 hygrometer soil moisture sensor</p>&#13;
<p class="bull">• Piezo buzzer</p>&#13;
</div>&#13;
<h3 class="h3" id="ch05lev1sec01"><span epub:type="pagebreak" id="page_47"/><span class="red"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">You’ll use an HL-69 moisture sensor, readily available online for a few dollars or from some of the retailers listed in <a href="app01.xhtml#app01">Appendix A</a>. The prongs of the sensor detect the moisture level in the surrounding soil by passing current through the soil and measuring the resistance. Damp soil conducts electricity easily, so it provides lower resistance, while dry soil conducts poorly and has a higher resistance.</p>&#13;
<p class="indent">The sensor consists of two parts, as shown in <a href="ch05.xhtml#ch5fig1">Figure 5-1</a>: the actual prong sensor (a) and the controller (b). The two pins on the sensor need to connect to the two separate pins on the controller (connecting wires are usually supplied). The other side of the controller has four pins, three of which connect to the Arduino.</p>&#13;
<p class="figcaption"><a id="ch5fig1"/><strong>FIGURE 5-1:</strong><br/>The HL-69 moisture sensor prong (a) and controller (b)</p>&#13;
<div class="image"><img alt="image" src="../images/f05-01.jpg"/></div>&#13;
<p class="indent">The four pins are, from left to right, AO (analog out), DO (digital out), GND, and VCC (see <a href="ch05.xhtml#ch5fig2">Figure 5-2</a>). You can read the values from the controller through the IDE when it’s connected to your computer. <span epub:type="pagebreak" id="page_48"/>This project doesn’t use a breadboard, so the connections are all made directly to the Arduino.</p>&#13;
<p class="figcaption"><a id="ch5fig2"/><strong>FIGURE 5-2:</strong><br/>The pins are labeled on the underside of the module</p>&#13;
<div class="image"><img alt="image" src="../images/f05-02.jpg"/></div>&#13;
<p class="indent">Lower readings indicate that more moisture is being detected, and higher readings indicate dryness. If your reading is above 900, your plant is seriously thirsty. If your plant gets too thirsty, the LED will light and the piezo buzzer will sound. <em>Piezos</em> are inexpensive buzzers and are explained more in <a href="ch07.xhtml#ch07">Project 7</a>.</p>&#13;
<h3 class="h3" id="ch05lev1sec02"><span class="red"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindenta">Connect the sensor’s two pins to the + and – pins on the controller using the provided connecting wires, as shown in <a href="ch05.xhtml#ch5fig3">Figure 5-3</a>.</p>&#13;
<p class="figcaption"><a id="ch5fig3"/><strong>FIGURE 5-3:</strong><br/>Connecting the sensor to the controller</p>&#13;
<div class="image"><img alt="image" src="../images/f05-03.jpg"/></div></li>&#13;
<li><p class="noindenta"><span epub:type="pagebreak" id="page_49"/>Connect the three prongs from the controller to +5V, GND, and Arduino A0 directly on the Arduino, as shown in the following table. The DO pin is not used.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a" style="vertical-align: middle;"><p class="tablec"><strong>SENSOR CONTROLLER</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a" style="vertical-align: middle;"><p class="tablec"><span class="red">VCC</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="red">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a" style="vertical-align: middle;"><p class="tablec"><span class="red">GND</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="red">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a" style="vertical-align: middle;"><p class="tablec"><span class="red">A0</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="red">A0</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a" style="vertical-align: middle;"><p class="tablec"><span class="red">DO</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="red">Not used</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Connect an LED directly to the Arduino with the shorter, negative leg in GND and the longer, positive leg in Arduino pin 13, as shown in <a href="ch05.xhtml#ch5fig4">Figure 5-4</a>.</p>&#13;
<p class="figcaption"><a id="ch5fig4"/><strong>FIGURE 5-4:</strong><br/>Connecting the LED to the Arduino</p>&#13;
<div class="image"><img alt="image" src="../images/f05-04.jpg"/></div>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a" style="vertical-align: middle;"><p class="tablec"><strong>LED</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a" style="vertical-align: middle;"><p class="tablec"><span class="red">Positive leg</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="red">Pin 13</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a" style="vertical-align: middle;"><p class="tablec"><span class="red">Negative leg</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="red">GND</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Connect the piezo buzzer’s black wire to GND and its red wire to Arduino pin 11.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a" style="vertical-align: middle;"><p class="tablec"><strong>PIEZO</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a" style="vertical-align: middle;"><p class="tablec"><span class="red">Red wire</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="red">Pin 11</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a" style="vertical-align: middle;"><p class="tablec"><span class="red">Black wire</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="red">GND</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Check that your setup matches that of <a href="ch05.xhtml#ch5fig5">Figure 5-5</a>, and then upload the code in “<a href="ch05.xhtml#ch05lev1sec03">The Sketch</a>” on <a href="ch05.xhtml#page_51">page 51</a>.</p>&#13;
<p class="figcaption"><a id="ch5fig5"/><strong>FIGURE 5-5:</strong><br/>Circuit diagram for the plant monitor</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_50"/><img alt="image" src="../images/f05-05.jpg"/></div></li>&#13;
<li><p class="noindenta">Connect the Arduino to your computer using the USB cable. Open the Serial Monitor in your IDE to see the values from the sensor—this will also help you to calibrate your plant monitor. The IDE will display the value of the sensor’s reading. My value was 1000 with the sensor dry and not inserted in the soil, so I know this is the highest, and driest, value. To calibrate this value, turn the potentiometer on the controller clockwise to increase the resistance and counterclockwise to decrease it (see <a href="ch05.xhtml#ch5fig5">Figure 5-5</a>).</p>&#13;
<p class="indent">When the sensor is inserted into moist soil, the value will drop to about <code>400</code>. As the soil dries out, the sensor value rises; when it reaches <code>900</code>, the LED will light and the buzzer will sound.</p>&#13;
<p class="figcaption"><a id="ch5fig6"/><strong>FIGURE 5-6:</strong><br/>Turn the potentiometer to calibrate your plant monitor.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_51"/><img alt="image" src="../images/f05-06.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch05lev1sec03"><span class="red"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">The sketch first defines Arduino pin A0 so that it reads the moisture sensor value. It then defines Arduino pin 11 as output for the buzzer, and pin 13 as output for the LED. Use the <code>Serial.Println()</code> function to send the reading from the sensor to the IDE, in order to see the value on the screen.</p>&#13;
<p class="indent">Change the value in the line</p>&#13;
<pre>if(analogRead(0) &gt; 900){</pre>&#13;
<p class="noindent">depending on the reading from the sensor when it is dry (here it’s 900). When the soil is moist, this value will be below 900, so the LED and buzzer will remain off. When the value rises above 900, it means the soil is drying out, and the buzzer and LED will alert you to water your plant.</p>&#13;
<pre><span class="green2">const int</span> moistureAO = 0;<br/><span class="green2">int</span> AO = 0;       <span class="ash">// Pin connected to A0 on the controller</span><br/><span class="green2">int</span> tmp = 0;      <span class="ash">// Value of the analog pin</span><br/><span class="green2">int</span> buzzPin = 11; <span class="ash">// Pin connected to the piezo buzzer</span><br/><span class="green2">int</span> LED = 13;     <span class="ash">// Pin connected to the LED</span><br/><br/><span class="green2">void</span> <span class="green3">setup</span> () {<br/>  <span class="orange1">Serial</span>.<span class="orange1">begin</span>(9600); <span class="ash">// Send Arduino reading to IDE</span><br/>  <span class="orange1">Serial</span>.<span class="orange1">println</span>(<span class="green2">"Soil moisture sensor"</span>);<br/>  <span class="orange1">pinMode</span>(moistureAO, <span class="green2">INPUT</span>);<br/>  <span class="orange1">pinMode</span>(buzzPin, <span class="green2">OUTPUT</span>); <span class="ash">// Set pin as output</span><br/>  <span class="orange1">pinMode</span>(LED, <span class="green2">OUTPUT</span>);     <span class="ash">// Set pin as output</span><br/>}<br/><br/><span epub:type="pagebreak" id="page_52"/><span class="green2">void</span> <span class="green3">loop</span> () {<br/>  tmp = <span class="orange1">analogRead</span>( moistureAO );<br/>  <span class="green3">if</span> ( tmp != AO ) {<br/>    AO = tmp;<br/>    <span class="orange1">Serial</span>.<span class="orange1">print</span>(<span class="green2">"A = "</span>); <span class="ash">// Show the resistance value of the sensor</span><br/>                          <span class="ash">// in the IDE</span><br/>    <span class="orange1">Serial</span>.<span class="orange1">println</span>(AO);<br/>  }<br/>  <span class="orange1">delay</span> (1000);<br/>  <span class="green3">if</span> (<span class="orange1">analogRead</span>(0) &gt; 900) { <span class="ash">// If the reading is higher than 900,</span><br/>    <span class="orange1">digitalWrite</span>(buzzPin, <span class="green2">HIGH</span>); <span class="ash">// the buzzer will sound</span><br/>    <span class="orange1">digitalWrite</span>(LED, <span class="green2">HIGH</span>);     <span class="ash">// and the LED will light</span><br/>    <span class="orange1">delay</span>(1000); <span class="ash">// Wait for 1 second</span><br/>    <span class="orange1">digitalWrite</span>(buzzPin, <span class="green2">LOW</span>);<br/>    <span class="orange1">digitalWrite</span>(LED, <span class="green2">HIGH</span>);<br/>  }<br/>  <span class="green3">else</span> {<br/>    <span class="orange1">digitalWrite</span>(buzzPin, <span class="green2">LOW</span>); <span class="ash">// If the reading is below 900,</span><br/>                                <span class="ash">// the buzzer and LED stay off</span><br/>    <span class="orange1">digitalWrite</span>(LED, <span class="green2">LOW</span>);<br/>  }<br/>}</pre>&#13;


<h2 class="h2a" id="ch06"><span epub:type="pagebreak" id="page_53"/>PROJECT 6: GHOST DETECTOR</h2>&#13;
<p class="h2sub"><strong><span class="red">WHO WOULDN’T WANT TO MAKE A GHOST DETECTOR? THIS IS A REALLY SIMPLE PROJECT THAT DOESN’T TAKE LONG TO PUT TOGETHER, SO YOU CAN START DETECTING GHOSTS RIGHT AWAY.</span></strong></p>&#13;
<div class="image2"><img alt="image" src="../images/f0053-01.jpg"/></div>&#13;
<div class="image2"><span epub:type="pagebreak" id="page_54"/><img alt="image" src="../images/f0054-01.jpg"/></div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="red"><strong>PARTS REQUIRED</strong></span></p>&#13;
<p class="bull">• Arduino board</p>&#13;
<p class="bull">• Breadboard</p>&#13;
<p class="bull">• Jumper wires</p>&#13;
<p class="bull">• 3 red LEDs</p>&#13;
<p class="bull">• 1 yellow LED</p>&#13;
<p class="bull">• 6 green LEDs</p>&#13;
<p class="bull">• 10 220-ohm resistors</p>&#13;
<p class="bull">• 20-centimeter length of single-core wire</p>&#13;
<p class="bull">• 1M-ohm resistor</p>&#13;
</div>&#13;
<h3 class="h3" id="ch06lev1sec01"><span epub:type="pagebreak" id="page_55"/><span class="red"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">Okay, so I might be stretching things a bit by calling this project a ghost detector. This project actually detects <em>electromagnetic fields</em>, but many people believe this is how to tell if there are ghosts or spirits around.</p>&#13;
<p class="indent">In this project, you’ll set up a ghost-detecting antenna and LED bar graph system to tell whether there is a high level of electromagnetic activity in the vicinity. A length of bare wire acts as an antenna to pick up an electromagnetic field within a radius of two meters. Depending on the strength of the signal, the LEDs will light in sequence: the stronger the signal, the more LEDs will light. Power up the Arduino, and point your detector into a room to pick up any unusual presences. Be aware that electrical appliances such as televisions will cause the detector to dance around because of the signal they emit.</p>&#13;
<h3 class="h3" id="ch06lev1sec02"><span class="red"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindenta">Place the LEDs into the breadboard with the legs on either side of the center divide (see “<a href="ch00.xhtml#ch00lev2sec03">Breadboards</a>” on <a href="ch00.xhtml#page_4">page 4</a> for more on the layout of the breadboard), as shown in <a href="ch06.xhtml#ch6fig1">Figure 6-1</a>. I started with a yellow LED, then used six green and three red LEDs to create a scale from left to right. You can use any color LEDs and position them in the sequence you prefer.</p>&#13;
<p class="figcaption"><a id="ch6fig1"/><strong>FIGURE 6-1:</strong><br/>Placing the LEDs</p>&#13;
<div class="image"><img alt="image" src="../images/f06-01.jpg"/></div>&#13;
<div class="sidebar">&#13;
<p class="sidebart"><span epub:type="pagebreak" id="page_56"/><span class="red"><strong>ELECTROMAGNETIC FIELDS</strong></span></p>&#13;
<p class="noindent"><em>Electric fields</em> are created by differences in voltage: the higher the voltage, the stronger the resultant field. <em>Magnetic fields</em> are created when electric current flows: the greater the current, the stronger the magnetic field. An <em>electromagnetic field (EMF)</em> can be thought of as a combination of the two.</p>&#13;
<div class="image2"><img alt="image" src="../images/f0056-01.jpg"/></div>&#13;
<p class="indent">Electromagnetic fields are present everywhere in the environment but are invisible to the human eye. Electric fields are produced by the local buildup of electric charges in the atmosphere and associated with thunderstorms. The earth constantly emits a magnetic field. It is used by birds and fish for navigation and causes a compass needle to orient to the north.</p>&#13;
</div></li>&#13;
<li><p class="noindenta">Connect one leg of a 220-ohm resistor to each negative LED leg, and insert the other resistor leg in the GND rail of the breadboard (see <a href="ch06.xhtml#ch6fig2">Figure 6-2</a>). Connect each positive LED leg to digital pins 2 through 11 in turn.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a" style="vertical-align: middle;"><p class="tablec"><strong>LEDS</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a" style="vertical-align: middle;"><p class="tablec"><span class="red">Positive legs</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="red">Pins 2–11</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a" style="vertical-align: middle;"><p class="tablec"><span class="red">Negative legs</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="red">GND via 220-ohm resistors</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="figcaption"><a id="ch6fig2"/><strong>FIGURE 6-2:</strong><br/>Connecting the LEDs to the breadboard</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_57"/><img alt="image" src="../images/f06-02.jpg"/></div></li>&#13;
<li><p class="noindenta">Take the 20-centimeter length of single-core wire and use a wire stripper to strip about 1 centimeter of the insulation from one end. Attach this end to Arduino pin A5. Strip about 7 centimeters from the other end—this open, bare wire end is your antenna and will pick up the electromagnetic signal (see <a href="ch06.xhtml#ch6fig3">Figure 6-3</a>).</p>&#13;
<p class="figcaption"><a id="ch6fig3"/><strong>FIGURE 6-3:</strong><br/>Stripping wire to create an antenna</p>&#13;
<div class="image"><img alt="image" src="../images/f06-03.jpg"/></div></li>&#13;
<li><p class="noindenta"><span epub:type="pagebreak" id="page_58"/>Connect one leg of the 1M-ohm resistor directly to GND on the Arduino and the other leg to Arduino pin A5; this will increase the sensitivity of your device.</p></li>&#13;
<li><p class="noindenta">Check that your setup matches that of <a href="ch06.xhtml#ch6fig4">Figure 6-4</a>, and then upload the code in “<a href="ch06.xhtml#ch06lev1sec03">The Sketch</a>” on <a href="ch06.xhtml#page_59">page 59</a>.</p>&#13;
<p class="figcaption"><a id="ch6fig4"/><strong>FIGURE 6-4:</strong><br/>Circuit diagram for the ghost detector</p>&#13;
<div class="image"><img alt="image" src="../images/f06-04.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch06lev1sec03"><span epub:type="pagebreak" id="page_59"/><span class="red"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">The bare wire picks up the signal from electromagnetic fields in the atmosphere and sends a value between 0 and 1023 to the Arduino. The sketch evaluates the reading from the analog pin to determine how many LEDs are switched on or off in sequence to indicate the strength of the electromagnetic signal. For example, 1023 would be the highest value, so all LEDs would be lit; a reading of 550 would light five LEDs. The sketch loops to continuously read the analog input, and the LED lights constantly move to show the reading. If you find that the EMF readings set off your LED sequence to the maximum level every time, reduce the <code>senseLimit</code> value to compensate. The sketch takes an average of 25 number readings each time it loops through, and uses the average from those readings to mitigate big fluctuations that may cause the LEDs to light up too quickly.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>Once you’ve completed the ghost detector, try adding some sounds that beep at increasing speeds or volumes depending on the reading. Build a casing for the project to have your own handheld sensor to take on ghost-hunting endeavors. You can also experiment by trying various types and thicknesses of wire, and by taking away the resistor for different levels of sensitivity.</em></p>&#13;
</div>&#13;
<pre><span class="ash">// Code by James Newbould used with kind permission</span><br/>#define NUMREADINGS 25 <span class="ash">// Raise number to increase data smoothing</span><br/><span class="green2">int</span> senseLimit = 1023; <span class="ash">// Raise number to decrease sensitivity of</span><br/>                       <span class="ash">// the antenna (up to 1023 max)</span><br/><span class="green2">int</span> probePin = 5; <span class="ash">// Set analog pin 5 as the antenna pin</span><br/><span class="green2">int</span> val = 0;      <span class="ash">// Reading from probePin</span><br/><br/><span class="ash">// Pin connections to LED bar graph with resistors in series</span><br/><span class="green2">int</span> LED1 = 11;<br/><span class="green2">int</span> LED2 = 10;<br/><span class="green2">int</span> LED3 = 9;<br/><span class="green2">int</span> LED4 = 8;<br/><span class="green2">int</span> LED5 = 7;<br/><span class="green2">int</span> LED6 = 6;<br/><span class="green2">int</span> LED7 = 5;<br/><span class="green2">int</span> LED8 = 4;<br/><span class="green2">int</span> LED9 = 3;<br/><span class="green2">int</span> LED10 = 2;<br/><span class="green2">int</span> readings[NUMREADINGS]; <span class="ash">// Readings from the analog input</span><br/><span class="green2">int</span> index = 0;             <span class="ash">// Index of the current reading</span><br/><span class="green2">int</span> total = 0;             <span class="ash">// Running total</span><br/><span class="green2">int</span> average = 0;           <span class="ash">// Final average of the probe reading</span><br/><br/><span class="green2">void</span> <span class="green3">setup</span>() {<br/>  <span class="orange1">pinMode</span>(2, <span class="green2">OUTPUT</span>); <span class="ash">// Set LED bar graph pins as outputs</span><br/>  <span class="orange1">pinMode</span>(3, <span class="green2">OUTPUT</span>);<br/>  <span class="orange1">pinMode</span>(4, <span class="green2">OUTPUT</span>);<br/>  <span class="orange1">pinMode</span>(5, <span class="green2">OUTPUT</span>);<br/>  <span class="orange1">pinMode</span>(6, <span class="green2">OUTPUT</span>);<br/>  <span class="orange1">pinMode</span>(7, <span class="green2">OUTPUT</span>);<br/>  <span class="orange1">pinMode</span>(8, <span class="green2">OUTPUT</span>);<br/>  <span class="orange1">pinMode</span>(9, <span class="green2">OUTPUT</span>);<br/>  <span class="orange1">pinMode</span>(10, <span class="green2">OUTPUT</span>);<br/>  <span class="orange1">pinMode</span>(11, <span class="green2">OUTPUT</span>);<br/><span epub:type="pagebreak" id="page_60"/><br/>  <span class="orange1">Serial</span>.<span class="orange1">pinMode</span>(9600); <span class="ash">// Initiate serial connection with IDE for</span><br/>                        <span class="ash">// debugging and so on</span><br/>  <span class="green3">for</span> (<span class="green2">int</span> i = 0; i &lt; NUMREADINGS; i++)<br/>    readings[i] = 0; <span class="ash">// Initialize all readings to 0</span><br/>}<br/><br/><span class="green2">void</span> <span class="green3">loop</span>() {<br/>  val = <span class="orange1">analogRead</span>(probePin); <span class="ash">// Take a reading from probe</span><br/>  <span class="green3">if</span> (val &gt;= 1) {             <span class="ash">// If the reading isn't zero, proceed</span><br/>    val = <span class="orange1">constrain</span>(val, 1, senseLimit); <span class="ash">// If the reading is</span><br/>                                         <span class="ash">// higher than the current</span><br/>                                         <span class="ash">// senseLimit value, update</span><br/>                                         <span class="ash">// senseLimit value with</span><br/>                                         <span class="ash">// higher reading</span><br/>    val = <span class="orange1">map</span>(val, 1, senseLimit, 1, 1023); <span class="ash">// Remap the constrained</span><br/>                                            <span class="ash">// value within a 1 to</span><br/>                                            <span class="ash">// 1023 range</span><br/>    total -= readings[index]; <span class="ash">// Subtract the last reading</span><br/>    readings[index] = val;    <span class="ash">// Read from the sensor</span><br/>    total += readings[index]; <span class="ash">// Add the reading to the total</span><br/>    index = (index + 1);      <span class="ash">// Advance to the next index</span><br/>    <span class="green3">if</span> (index &gt;= NUMREADINGS) <span class="ash">// If we're at the end of the array</span><br/>      index = 0;              <span class="ash">// loop around to the beginning</span><br/>    average = total / NUMREADINGS; <span class="ash">// Calculate the average reading</span><br/>    <span class="green3">if</span> (average &gt; 50) { <span class="ash">// If the average reading is higher than 50</span><br/>      <span class="orange1">digitalWrite</span>(LED1, <span class="green2">HIGH</span>); <span class="ash">// turn on the first LED</span><br/>    }<br/>    <span class="green3">else</span> {                        <span class="ash">// If it's not</span><br/>      <span class="orange1">digitalWrite</span>(LED1, <span class="green2">LOW</span>);    <span class="ash">// turn off that LED</span><br/>    }<br/>    <span class="green3">if</span> (average &gt; 150) {          <span class="ash">// And so on</span><br/>      <span class="orange1">digitalWrite</span>(LED2, <span class="green2">HIGH</span>);<br/>    }<br/>    <span class="green3">else</span> {<br/>      <span class="orange1">digitalWrite</span>(LED2, <span class="green2">LOW</span>);<br/>    }<br/>    if (average &gt; 250) {<br/>      <span class="orange1">digitalWrite</span>(LED3, <span class="green2">HIGH</span>);<br/>    }<br/>    <span class="green3">else</span> {<br/>      <span class="orange1">digitalWrite</span>(LED3, <span class="green2">LOW</span>);<br/>    }<br/>    <span class="green3">if</span> (average &gt; 350) {<br/>      <span class="orange1">digitalWrite</span>(LED4, <span class="green2">HIGH</span>);<br/>    }<br/>    <span class="green3">else</span> {<br/>      <span class="orange1">digitalWrite</span>(LED4, <span class="green2">LOW</span>);<br/>    }<br/>    <span class="green3">if</span> (average &gt; 450) {<br/>      <span class="orange1">digitalWrite</span>(LED5, <span class="green2">HIGH</span>);<br/>    }<br/>    <span class="green3">else</span> {<br/>      <span class="orange1">digitalWrite</span>(LED5, <span class="green2">LOW</span>);<br/>    }<br/>    <span epub:type="pagebreak" id="page_61"/><span class="green3">if</span> (average &gt; 550) {<br/>      <span class="orange1">digitalWrite</span>(LED6, <span class="green2">HIGH</span>);<br/>    }<br/>    <span class="green3">else</span> {<br/>      <span class="orange1">digitalWrite</span>(LED6, <span class="green2">LOW</span>);<br/>    }<br/>    <span class="green3">if</span> (average &gt; 650) {<br/>      <span class="orange1">digitalWrite</span>(LED7, <span class="green2">HIGH</span>);<br/>    }<br/>    <span class="green3">else</span> {<br/>      <span class="orange1">digitalWrite</span>(LED7, <span class="green2">LOW</span>);<br/>    }<br/>    <span class="green3">if</span> (average &gt; 750) {<br/>      <span class="orange1">digitalWrite</span>(LED8, <span class="green2">HIGH</span>);<br/>    }<br/>    <span class="green3">else</span> {<br/>      <span class="orange1">digitalWrite</span>(LED8, <span class="green2">LOW</span>);<br/>    }<br/>    <span class="green3">if</span> (average &gt; 850) {<br/>      <span class="orange1">digitalWrite</span>(LED9, <span class="green2">HIGH</span>);<br/>    }<br/>    <span class="green3">else</span> {<br/>      <span class="orange1">digitalWrite</span>(LED9, <span class="green2">LOW</span>);<br/>    }<br/>    <span class="green3">if</span> (average &gt; 950) {<br/>      <span class="orange1">digitalWrite</span>(LED10, <span class="green2">HIGH</span>);<br/>    }<br/>    <span class="green3">else</span> {<br/>      <span class="orange1">digitalWrite</span>(LED10, <span class="green2">LOW</span>);<br/>    }<br/>    <span class="orange1">Serial</span>.<span class="green3">println</span>(val);   <span class="ash">// Use output to aid in calibrating</span><br/>  }<br/>}<span epub:type="pagebreak" id="page_62"/></pre>&#13;
</body></html>