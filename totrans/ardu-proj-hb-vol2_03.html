<html><head></head><body>
<h1 class="h1-part" id="part02"><span epub:type="pagebreak" id="page_67"/><strong><span class="orange">Sound</span></strong></h1>&#13;


<h2 class="h2s" id="ch08"><span epub:type="pagebreak" id="page_68"/><strong>8<br/>Arduino Piano</strong></h2>&#13;
<p class="intro"><span class="orange">In this project we’ll use some momentary pushbuttons and a piezo sounder to create a simple piano.</span></p>&#13;
<div class="image"><img alt="Image" src="../images/p0068-01.jpg"/></div>&#13;
<div class="image"><span epub:type="pagebreak" id="page_69"/><img alt="Image" src="../images/p0069-01.jpg"/></div>&#13;
<p class="capo"><strong>PARTS REQUIRED</strong></p>&#13;
<p class="cap1"><strong>Arduino board</strong></p>&#13;
<p class="cap1"><strong>Breadboard</strong></p>&#13;
<p class="cap1"><strong>Jumper wires</strong></p>&#13;
<p class="cap1"><strong>Piezo sounder</strong></p>&#13;
<p class="cap1"><strong>8 momentary tactile pushbuttons</strong></p>&#13;
<p class="cap1"><strong>8 1k-ohm resistors</strong></p>&#13;
<h3 class="h3" id="ch00lev1sec31"><span epub:type="pagebreak" id="page_70"/><span class="orange"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">Each pushbutton in our project (see <a href="ch08.xhtml#ch8fig1">Figure 8-1</a>) is connected to an Arduino pin, and when the pushbutton is pressed, the piezo sounder will emit one of eight notes.</p>&#13;
<p class="figcap"><a id="ch8fig1"/><strong>FIGURE 8-1:</strong> A momentary pushbutton and its circuit</p>&#13;
<div class="image"><img alt="Image" src="../images/f8-01.jpg"/></div>&#13;
<p class="indent">When pressed, a pushbutton completes a circuit, turning it on. As soon as the button is released, the connection will spring back and break that circuit, turning it off. The pushbutton switch is also known as a <em>momentary</em> or <em>normally open switch</em>, and is used in, for example, computer keyboards. This is in contrast to a <em>toggle switch</em>, which stays either on or off until you toggle it to the other position, like a light switch.</p>&#13;
<p class="indent">This type of pushbutton has four pins, but you generally use only two at a time for connection. We’re using the top pins in this project so it’s easier to reach the button and play a tune, although the two unused pins at the bottom would do the same job. As <a href="ch08.xhtml#ch8fig2">Figure 8-2</a> shows, the pins work in a circuit. Pins A and C are always connected, as are pins B and D. When the button is pressed, the circuit is complete.</p>&#13;
<p class="figcap"><span epub:type="pagebreak" id="page_71"/><a id="ch8fig2"/><strong>FIGURE 8-2:</strong> A pushbutton’s incomplete circuit</p>&#13;
<div class="image"><img alt="Image" src="../images/f8-02.jpg"/></div>&#13;
<p class="indent">The Arduino piano uses a piezo sounder, shown in <a href="ch08.xhtml#ch8fig3">Figure 8-3</a>, to create frequencies that resemble recognizable notes. Piezo sounders, or just piezos for short, are inexpensive buzzers often used in small toys. A piezo element without its plastic housing looks like a gold metallic disc with connected positive (typically red) and negative (typically black) wires. A piezo is capable only of making a clicking sound, which we create by applying voltage.</p>&#13;
<p class="figcap"><a id="ch8fig3"/><strong>FIGURE 8-3:</strong> A piezo sounder</p>&#13;
<div class="image"><img alt="Image" src="../images/f8-03.jpg"/></div>&#13;
<p class="indent">We can make recognizable notes by getting the piezo to click hundreds of times a second at a particular frequency, so first we need to know the frequency of the different tones we want. <a href="ch08.xhtml#ch8tab1">Table 8-1</a> shows the notes and their corresponding frequencies. <em>Period</em> is the duration of the cycle, in microseconds, at which the frequency is created. For example, to get a C note (261 Hz), we need the piezo to cycle at a period of 3,830 microseconds. We halve the period to get the <span class="literal">timeHigh</span> value, which is used in the code to create the note. (The tone is caused by the piezo being turned on and off very quickly, so the time that the piezo is on, or <span class="literal">HIGH</span>, is half the period.)</p>&#13;
<p class="tabcap"><span epub:type="pagebreak" id="page_72"/><a id="ch8tab1"/><strong>TABLE 8-1:</strong> The Musical Notes and Frequencies Used in the Code</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_tho" style="vertical-align: top;"><p class="tablec"><strong>NOTE</strong></p></td>&#13;
<td class="table_thr" style="vertical-align: top;"><p class="tablec"><strong>FREQUENCY</strong></p></td>&#13;
<td class="table_tho" style="vertical-align: top;"><p class="tablec"><strong>PERIOD</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="tablec"><strong>TIMEHIGH</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">c</span></span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="orange">261 Hz</span></p></td>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange">3,830</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">1915</span></span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">d</span></span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="orange">294 Hz</span></p></td>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange">3,400</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">1700</span></span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">e</span></span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="orange">329 Hz</span></p></td>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange">3,038</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">1519</span></span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">f</span></span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="orange">349 Hz</span></p></td>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange">2,864</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">1432</span></span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">g</span></span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="orange">392 Hz</span></p></td>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange">2,550</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">1275</span></span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">a</span></span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="orange">440 Hz</span></p></td>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange">2,272</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">1136</span></span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">b</span></span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="orange">493 Hz</span></p></td>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange">2,028</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">1014</span></span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1oa" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">C</span></span></p></td>&#13;
<td class="table_3" style="vertical-align: top;"><p class="tablec"><span class="orange">523 Hz</span></p></td>&#13;
<td class="table_1oa" style="vertical-align: top;"><p class="tablec"><span class="orange">1,912</span></p></td>&#13;
<td class="table" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">956</span></span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<h3 class="h3" id="ch00lev1sec32"><span class="orange"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindents">Insert the momentary pushbuttons into the breadboard with the pins straddling the center break of the breadboard.</p></li>&#13;
<li><p class="noindents">Looking at the breadboard face on, number the pushbuttons 1–8 from left to right. Connect the top-left pin (A) of pushbutton 1 to Arduino pin 2 using a jumper wire. Connect the top-left pins of the other pushbuttons to the Arduino as shown here.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_tho" style="vertical-align: top;"><p class="tablec"><strong>PUSHBUTTON</strong></p></td>&#13;
<td class="table_thr" style="vertical-align: top;"><p class="tablec"><strong>NOTE</strong></p></td>&#13;
<td class="table_thoa" style="vertical-align: top;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange">1</span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="literal"><span class="orange">c</span></span></p></td>&#13;
<td class="table_1ob" style="vertical-align: top;"><p class="tablec"><span class="orange">2</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange">2</span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">d</span></span></p></td>&#13;
<td class="table_1ob" style="vertical-align: top;"><p class="tablec"><span class="orange">3</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange">3</span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">e</span></span></p></td>&#13;
<td class="table_1ob" style="vertical-align: top;"><p class="tablec"><span class="orange">4</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange">4</span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">f</span></span></p></td>&#13;
<td class="table_1ob" style="vertical-align: top;"><p class="tablec"><span class="orange">5</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange">5</span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">g</span></span></p></td>&#13;
<td class="table_1ob" style="vertical-align: top;"><p class="tablec"><span class="orange">6</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange">6</span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">a</span></span></p></td>&#13;
<td class="table_1ob" style="vertical-align: top;"><p class="tablec"><span class="orange">7</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange">7</span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">b</span></span></p></td>&#13;
<td class="table_1ob" style="vertical-align: top;"><p class="tablec"><span class="orange">8</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1oa" style="vertical-align: top;"><p class="tablec"><span class="orange">8</span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="orange"><span class="literal">C</span></span></p></td>&#13;
<td class="table_1oa" style="vertical-align: top;"><p class="tablec"><span class="orange">9</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindents">Insert a 1k-ohm resistor into the breadboard in line with the first pushbutton’s top-left pin, as shown in <a href="ch08.xhtml#ch8fig4">Figure 8-4</a>, and connect the other side of the resistor to the GND rail of the breadboard. Repeat this for the other pushbuttons. The resistor pulls the switch to GND when the button is not pressed to tell the Arduino that it’s not in a positive state; when the button is pressed, the positive power sounds the corresponding note.</p>&#13;
<p class="figcap"><span epub:type="pagebreak" id="page_73"/><a id="ch8fig4"/><strong>FIGURE 8-4:</strong> A 1k-ohm resistor connects the pushbutton pin to GND.</p>&#13;
<div class="image"><img alt="Image" src="../images/f8-04.jpg"/></div></li>&#13;
<li><p class="noindents">Connect the top-right pin (B) of each of the pushbuttons to the positive breadboard power rail using jumper wire.</p></li>&#13;
<li><p class="noindents">Connect the piezo’s red wire to Arduino pin 13 and its black wire to the GND rail of the breadboard, then connect the power rails to GND and +5V on the Arduino.</p></li>&#13;
<li><p class="noindents">Make sure that your setup matches the circuit diagram in <a href="ch08.xhtml#ch8fig5">Figure 8-5</a>, and then upload the code in “<a href="ch08.xhtml#ch00lev1sec33">The Sketch</a>” on <a href="ch08.xhtml#page_74">page 74</a>.</p>&#13;
<p class="figcap"><a id="ch8fig5"/><strong>FIGURE 8-5:</strong> The circuit diagram for the Arduino piano</p>&#13;
<div class="image"><img alt="Image" src="../images/f8-05.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch00lev1sec33"><span epub:type="pagebreak" id="page_74"/><span class="orange"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">The sketch first defines the pin that the piezo sounder is connected to and the pins for the pushbuttons. A value is defined for each pushbutton, and a tone is assigned to correspond with that value. The pushbuttons are set as inputs and the piezo sounder as an output. The loop cycle checks each button, playing the corresponding tone for as long as the button is held down. Only one note can be played at a time because each note requires the loop to begin again, so when the button is released, the piezo sounder stops playing the tone and the loop starts over.</p>&#13;
<p class="programs1"><span class="green1">int</span> speakerPin = 13; <span class="ash">// Piezo defined as pin 13</span><br/><span class="green1">int</span> key_c = 2; <span class="ash">// Define Arduino pins for the keys</span><br/><span class="green1">int</span> key_d = 3;<br/><span class="green1">int</span> key_e = 4;<br/><span class="green1">int</span> key_f = 5;<br/><span class="green1">int</span> key_g = 6;<br/><span class="green1">int</span> key_a = 7;<br/><span class="green1">int</span> key_b = 8;<br/><span class="green1">int</span> key_C = 9;<br/><br/><span class="ash">// Value for each key press</span><br/><span class="green1">int</span> keypress_c = 0; <span class="green1">int</span> keypress_d = 0; <span class="green1">int</span> keypress_e = 0;<br/><span class="green1">int</span> keypress_f = 0; <span class="green1">int</span> keypress_g = 0; <span class="green1">int</span> keypress_a = 0;<br/><span class="green1">int</span> keypress_b = 0; <span class="green1">int</span> keypress_C = 0;<br/><br/><span class="ash">// Define the frequency of each note</span><br/><span class="green1">int</span> tones[] = { 1915, 1700, 1519, 1432, 1275, 1136, 1014, 956 };<br/><span class="ash">//               'c',  'd',  'e',  'f',  'g',  'a',  'b', 'C'</span><br/><span class="green1">int</span> keytone = 0; <span class="ash">// Give a value for keytone</span><br/><br/><span class="green1">void</span> <span class="green2">setup</span>() {<br/>  <span class="orange">pinMode</span>(key_c, INPUT); <span class="ash">// Set up key pins as inputs</span><br/>  <span class="orange">pinMode</span>(key_d, INPUT);<br/>  <span class="orange">pinMode</span>(key_e, INPUT);<br/>  <span class="orange">pinMode</span>(key_f, INPUT);<br/>  <span class="orange">pinMode</span>(key_g, INPUT);<br/>  <span class="orange">pinMode</span>(key_a, INPUT);<br/>  <span class="orange">pinMode</span>(key_b, INPUT);<br/>  <span class="orange">pinMode</span>(key_C, INPUT);<br/>  <span class="orange">pinMode</span>(speakerPin, OUTPUT); <span class="ash">// Set up piezo pin as an output</span><br/>}<br/><br/><span class="ash">// Start a loop to read the press of each key</span><br/><span class="green1">void</span> <span class="green2">loop</span>() {<br/>  keypress_c = <span class="orange">digitalRead</span>(key_c); keypress_d = <span class="orange">digitalRead</span>(key_d);<br/>  keypress_e = <span class="orange">digitalRead</span>(key_e); keypress_f = <span class="orange">digitalRead</span>(key_f);<br/>  keypress_g = <span class="orange">digitalRead</span>(key_g); keypress_a = <span class="orange">digitalRead</span>(key_a);<br/>  keypress_b = <span class="orange">digitalRead</span>(key_b); keypress_C = <span class="orange">digitalRead</span>(key_C);<br/><span epub:type="pagebreak" id="page_75"/><br/>  <span class="ash">// And if the key press is HIGH, play the corresponding tone</span><br/>  <span class="green2">if</span> ((keypress_c == <span class="green1">HIGH</span>) || (keypress_e == <span class="green1">HIGH</span>) ||<br/>      (keypress_g == <span class="green1">HIGH</span>) || (keypress_d == <span class="green1">HIGH</span>) ||<br/>      (keypress_f == <span class="green1">HIGH</span>) || (keypress_a == <span class="green1">HIGH</span>) ||<br/>      (keypress_b == <span class="green1">HIGH</span>) || (keypress_C == <span class="green1">HIGH</span>))<br/>  {<br/>    <span class="green2">if</span> (keypress_c == <span class="green1">HIGH</span>) {<br/>      keytone = tones[0];<br/>    }<br/>    <span class="green2">if</span> (keypress_d == <span class="green1">HIGH)</span> {<br/>      keytone = tones[1];<br/>    }<br/>    <span class="green2">if</span> (keypress_e == <span class="green1">HIGH)</span> {<br/>      keytone = tones[2];<br/>    }<br/>    <span class="green2">if</span> (keypress_f == <span class="green1">HIGH)</span> {<br/>      keytone = tones[3];<br/>    }<br/>    <span class="green2">if</span> (keypress_g == <span class="green1">HIGH</span>) {<br/>      keytone = tones[4];<br/>    }<br/>    <span class="green2">if</span> (keypress_a == <span class="green1">HIGH)</span> {<br/>      keytone = tones[5];<br/>    }<br/>    <span class="green2">if</span> (keypress_b == <span class="green1">HIGH)</span> {<br/>      keytone = tones[6];<br/>    }<br/>    <span class="green2">if</span> (keypress_C == <span class="green1">HIGH</span>) {<br/>      keytone = tones[7];<br/>    }<br/>    <span class="orange">digitalWrite</span>(speakerPin, <span class="green1">HIGH</span>); <span class="ash">// Turn on piezo to play tone</span><br/>    <span class="orange">delayMicroseconds</span>(keytone);<br/>    <span class="orange">digitalWrite</span>(speakerPin, <span class="green1">LOW</span>);  <span class="ash">// Turn off after a short delay</span><br/>    <span class="orange">delayMicroseconds</span>(keytone);<br/>  }<br/>  <span class="green2">else</span> { <span class="ash">// If no key is pressed, piezo remains silent</span><br/>    <span class="orange">digitalWrite</span>(speakerPin, <span class="green1">LOW</span>);<br/>  }<br/>}</p>&#13;
<h3 class="h3" id="ch00lev1sec34"><span class="orange"><strong>TROUBLESHOOTING</strong></span></h3>&#13;
<p class="ques"><strong>Q.</strong> <em>The code compiles, but some or all of the buttons do not produce a tone.</em></p>&#13;
<p class="bull">• If the piezo sounder makes no noise at all, check that the piezo’s red wire is connected to pin 13 and its black wire to GND on the breadboard. Make sure you have connected GND on the Arduino to the correct breadboard power rail and that the Arduino has power connected.</p>&#13;
<p class="bull"><span epub:type="pagebreak" id="page_76"/>• If only some buttons make a sound, recheck the wiring for the pushbuttons that are silent. It’s easy to misalign the jumper wires in the breadboard so they don’t actually line up in the row with the pushbutton pins.</p>&#13;
<p class="bull">• If you still have an issue, try swapping the offending pushbutton for one you know works; if this resolves your problem, then your original pushbutton may have been faulty.</p>&#13;


<h2 class="h2s" id="ch09"><span epub:type="pagebreak" id="page_77"/><strong>9<br/>Audio LED Visualizer</strong></h2>&#13;
<p class="intro"><span class="orange">In this project we’ll use a sound sensor that will light a series of LEDs depending on the beat and volume of the sound it detects.</span></p>&#13;
<div class="image"><img alt="Image" src="../images/p0077-01.jpg"/></div>&#13;
<div class="image"><span epub:type="pagebreak" id="page_78"/><img alt="Image" src="../images/p0078-01.jpg"/></div>&#13;
<p class="capo"><strong>PARTS REQUIRED</strong></p>&#13;
<p class="cap1"><strong>Arduino board</strong></p>&#13;
<p class="cap1"><strong>Breadboard</strong></p>&#13;
<p class="cap1"><strong>Solid-core wires with ends stripped</strong></p>&#13;
<p class="cap1"><strong>Jumper wires</strong></p>&#13;
<p class="cap1"><strong>2 red LEDs</strong></p>&#13;
<p class="cap1"><strong>2 yellow LEDs</strong></p>&#13;
<p class="cap1"><strong>5 green LEDs</strong></p>&#13;
<p class="cap1"><strong>9 220-ohm resistors</strong></p>&#13;
<p class="cap1"><strong>3.5 mm female headphone jack</strong></p>&#13;
<h3 class="h3" id="ch00lev1sec35"><span epub:type="pagebreak" id="page_79"/><span class="orange"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">In Project 2 we created an LED night-light that was controlled by a light sensor. This project is similar, but the LEDs will be controlled by sound. We’ll connect a headphone jack to the Arduino, hook the jack up to an MP3 player, and watch the lights “dance” to the music. The signal from the MP3 player is picked up by the headphone jack and received as pulses by the Arduino A0 pin. The pattern of the pulses depends on the beat and volume of the music. The Arduino then sends power to the LEDs in direct response to the pattern of the music. As an alternative to using the MP3 player, you could add a microphone and have your own voice visualized in colored lights.</p>&#13;
<h3 class="h3" id="ch00lev1sec36"><span class="orange"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindents">Place the LEDs into the breadboard with the short, negative legs in the GND rail. Connect the GND rail on the breadboard to Arduino GND.</p></li>&#13;
<li><p class="noindents">Insert a 220-ohm resistor for each LED, making sure the resistors straddle the center break, and connect one leg to each positive LED leg (see <a href="ch09.xhtml#ch9fig1">Figure 9-1</a>). Connect the other leg of each resistor to Arduino digital pins 2 through 10 with jumper wires, as shown in the following table.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_tho" style="vertical-align: top;"><p class="tablec"><strong>LED</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange">Positive leg</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="orange">Digital pins 2–10 (via resistor)</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange">Negative leg</span></p></td>&#13;
<td class="table" style="vertical-align: top;"><p class="tablec"><span class="orange">GND</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="figcap"><a id="ch9fig1"/><strong>FIGURE 9-1:</strong> A resistor is required between the LEDs and power.</p>&#13;
<div class="image"><img alt="Image" src="../images/f9-01.jpg"/></div>&#13;
<div class="noter">&#13;
<p class="notet"><span epub:type="pagebreak" id="page_80"/><strong>NOTE</strong></p>&#13;
<p class="notep"><em>This headphone jack was reclaimed from a radio bought in a dollar store, but if you can find one to purchase, that will work too.</em> <em>On the headphone jack, the pins are GND, right channel, and left channel.</em></p>&#13;
</div></li>&#13;
<li><p class="noindents">Connect the ground pin of the headphone jack directly to GND, and the left channel of the jack to Arduino pin A0, as outlined in the following table. You could use jumper wire for this, but I’ve used solid-core wire and stripped the ends for connections. Stranded wire is too thin and won’t connect easily to the Arduino pins. (See <a href="ch09.xhtml#ch9fig2">Figure 9-2</a> for the positions of the jack pins.)</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_tho" style="vertical-align: top;"><p class="tablec"><strong>HEADPHONE JACK</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange">Ground</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="orange">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1o" style="vertical-align: top;"><p class="tablec"><span class="orange">Left channel</span></p></td>&#13;
<td class="table" style="vertical-align: top;"><p class="tablec"><span class="orange">A0</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="figcap"><a id="ch9fig2"/><strong>FIGURE 9-2:</strong> 3.5 mm headphone jack with MP3 player jack plugged in</p>&#13;
<div class="image"><img alt="Image" src="../images/f9-02.jpg"/></div></li>&#13;
<li><p class="noindents">Check your setup against the circuit diagram in <a href="ch09.xhtml#ch9fig3">Figure 9-3</a>, and then upload the code in “<a href="ch09.xhtml#ch00lev1sec37">The Sketch</a>” on <a href="ch09.xhtml#page_81">page 81</a>.</p>&#13;
<p class="figcap"><a id="ch9fig3"/><strong>FIGURE 9-3:</strong> The circuit diagram for the audio LED visualizer</p>&#13;
<div class="image"><img alt="Image" src="../images/f9-03.jpg"/></div></li>&#13;
</ol>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_81"/>Plug your MP3 player into the headphone jack for audio input. The LEDs will dance to the beat and volume of your music!</p>&#13;
<h3 class="h3" id="ch00lev1sec37"><span class="orange"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">The sketch first sets the Arduino pins connected to the LEDs, pins 2–10, as outputs. The input in this sketch is the signal from the MP3 player, received through the headphone jack, which is read by analog pin A0. The music sent by the player is picked up as a series of pulses by A0, and the volume and beat of the music determine how the LEDs light up. The louder the music, the more LEDs will light; and the faster the music’s beat, the faster the LEDs will flash.</p>&#13;
<p class="programs1"><span class="ash">// Used with kind permission from James Newbould</span><br/><span class="green1">int</span> led[9] = {2, 3, 4, 5, 6, 7, 8, 9, 10}; <span class="ash">// Pins connected to LEDs</span><br/><span class="green1">int</span> leftChannel = A0; <span class="ash">// Pin connected to headphone jack</span><br/><span class="green1">int</span> left, i; <span class="ash">// Create a variable for left and i</span><br/><span class="green1">void</span> <span class="green2">setup</span>() {<br/>  <span class="green2">for</span> (i = 0; i &lt; 9; i++)<br/>    <span class="orange">pinMode</span>(led[i], <span class="green1">OUTPUT</span>); <span class="ash">// Set LEDs as output</span><br/>}<br/><span class="green1">void</span> <span class="green2">loop</span>() { <span class="ash">// Light LEDs from left to right and back again</span><br/>              <span class="ash">// depending on the value from A0</span><br/>  left = <span class="orange">analogRead</span>(leftChannel);  <span class="ash">// Read left value</span><br/>  left = left / 10;  <span class="ash">// Set level of sensitivity between 1 and 50</span><br/>  <span class="green2">if</span> (left == 0) {<br/>    <span class="green2">for</span> (i = 0; i &lt; 9; i++) { <span class="ash">// If value is low, turn off LED</span><br/>      <span class="orange">digitalWrite</span>(led[i], <span class="green1">LOW</span>);<br/>    }<br/>  }<br/>  <span class="green2">else</span> { <span class="ash">// Or else turn on LEDs in sequence</span><br/>    <span class="green2">for</span> (i = 0; i &lt; left; i++) {<br/>      <span class="orange">digitalWrite</span>(led[i], <span class="green1">HIGH</span>);<br/>    }<br/>    <span class="green2">for</span> (i = i; i &lt; 9; i++) {<br/>      <span class="orange">digitalWrite</span>(led[i], <span class="green1">LOW</span>);<br/>    }<br/>  }<br/>}</p>&#13;
<h3 class="h3" id="ch00lev1sec38"><span epub:type="pagebreak" id="page_82"/><span class="orange"><strong>TROUBLESHOOTING</strong></span></h3>&#13;
<p class="ques"><strong>Q.</strong> <em>The code compiles, but some or all of the LEDs do not light up as expected.</em></p>&#13;
<p class="bull">• If none of the LEDs light, make sure you’ve connected the GND wire from the Arduino to the correct breadboard power rail and that the Arduino has power connected.</p>&#13;
<p class="bull">• If only some LEDs light, check that the LEDs are inserted the correct way, with the longer leg connected to the positive power and the short leg to GND. LEDs have polarity, so they must be connected correctly. Check that each resistor is inserted fully and lines up in the same row as the corresponding LED leg.</p>&#13;
<p class="bull">• Make sure the LEDs are connected to the Arduino pins defined in the sketch and match the circuit diagram in <a href="ch09.xhtml#ch9fig3">Figure 9-3</a>; the first part of the sketch defines pins 2–10 as outputs, so these should be used.</p>&#13;
<p class="bull">• If an LED still fails to light, it may be burned out or faulty. An easy way to check is to swap the LED with another in the sequence and see if that solves the issue. If you find that the LED works in another position, it means the resistor is either faulty or not inserted fully. Depending on the outcome, replace the LED or resistor with a functioning component.</p>&#13;
</body></html>