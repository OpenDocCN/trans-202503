<html><head></head><body>
  <div class="chapter" title="Chapter&#xA0;4.&#xA0;Staying in the Loop">&#13;
    <div class="titlepage">&#13;
      <h1 class="title" id="heading_id_2"><a id="staying_in_the_loop"/>Chapter 4. Staying in the Loop</h1>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="Ruby on Monorails">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_3"><a id="ruby_on_monorails"/>Ruby on Monorails</h1>&#13;
      </div>&#13;
&#13;
      <p><a class="indexterm" id="iddle1830"/>“Well,” said the King, “all this adventuring’s gotten me as hungry as a lumberjack. And I haven’t eaten anything since my breakfast of parched oats!”</p>&#13;
&#13;
      <p>“It’s about lunchtime,” said Ruben. “What’s there to eat?”</p>&#13;
&#13;
      <p>“Nothing here,” said the King gloomily. “I’m afraid I pretty much wrecked the Royal Kitchen and Royal Pantry when I turned the palace upside-down looking for my string, and I don’t think the cooks have quite gotten everything back in order yet.”</p>&#13;
&#13;
      <p>“We can go out!” said Scarlet. “I’m sure there are good places to eat in the kingdom outside the palace walls.”</p>&#13;
&#13;
      <p>The King nodded vigorously. “Of course!” he said. “We’ll take the Loop to the Hashery. It’s my favorite restaurant!”</p>&#13;
&#13;
      <p>“What’s the Loop?” asked Scarlet.</p>&#13;
&#13;
      <p>“I’m glad you asked,” said the King, who was busy pulling on his finest traveling cloak and overbritches. “The Loop is the monorail—a sort of train—that runs throughout the kingdom, taking my subjects anywhere they’d like to go. It’s only a few stops to the Hashery from here!”</p>&#13;
&#13;
      <p>“Couldn’t we take a royal carriage or something?” asked Ruben.</p>&#13;
&#13;
      <p>“Where’s the fun in that?” replied the King. “Now hurry up—the next Loop train should be arriving outside the palace in just a few minutes.”</p>&#13;
&#13;
      <p>The King, Scarlet, and Ruben left the King’s study and traveled through corridor after corridor of the palace, stepping over and around cooks, maids, butlers, handymen, and a host of other palace employees who were busy righting all the things the King had flipped upside-down in his mad search for his string. Finally, they arrived at the great wooden gate of the palace, and a pair of very strong-looking attendants saluted smartly and pulled the doors open for the trio.</p>&#13;
&#13;
      <p>“Where’s the Loop stop?” Ruben asked, blinking in the sudden sunshine.</p>&#13;
&#13;
      <p>“Just over there,” said the King, and pointed to a large metal platform at the top of a small hill near the palace entrance. “See that rail? The Loop train runs on that. It’ll come up to the platform in a few minutes, then head out toward the east side of the kingdom.”</p>&#13;
&#13;
      <p>“It’s so high up!” said Scarlet. “Is it safe?”</p>&#13;
&#13;
      <p>“Absolutely!” said the King. “You’ll see.”</p>&#13;
&#13;
      <p>After a few minutes of walking, the King, Scarlet, and Ruben arrived at the platform. Just as Ruben was about to ask how long the train would take to get there, a bright red metal train car whizzed up to the platform, and the door opened with a gentle <span class="emphasis"><em>whoosh</em></span>. “Aha! Here we are,” said the King. “All aboard!”</p>&#13;
&#13;
      <p>The doors closed quickly behind them, and with barely a sound, the Loop train sped away from the palace station. Ruben looked around. “There’s no one here!” he said. “A car to ourselves!” He spread out on a plastic bench along one side of the train car.</p>&#13;
&#13;
      <p>“No one <span class="emphasis"><em>at all</em></span>,” said Scarlet. “Not even a conductor. How’s that possible?”</p>&#13;
&#13;
      <p>“No need for a conductor!” said the King. “The Loop is fully automatic. It runs entirely on Ruby!”</p>&#13;
&#13;
      <p>“Rails running on Ruby?” said Ruben. “Awesome!”</p>&#13;
&#13;
      <p>“I’m not so sure,” said Scarlet. “We saw how well the Flowmatic Something-or-Other worked without someone keeping an eye on it.”</p>&#13;
&#13;
      <p>“Oh, I don’t think there’s anything to worry about,” said the King. “The Loop has run for years without any sort of problem.”</p>&#13;
&#13;
      <p>Ruben pressed his nose to the glass. “We’ll be there in no time!” he said. “It looks like the Loop is heading nonstop to the Hashery.”</p>&#13;
&#13;
      <p>“What do you mean?” said the King.</p>&#13;
&#13;
      <p>“We’ve passed two other platforms without stopping—this is great! Well, maybe not so great for the people on those other platforms, but, you know, more Hashery for us.”</p>&#13;
&#13;
      <p>The King’s eyes went wide. “The Loop should stop at every station if there are people waiting!” he said. “Something must be wrong if we’re skipping any.”</p>&#13;
&#13;
      <p>“Nothing to worry about, huh?” said Scarlet. “We’re stuck on an out-of-control train!”</p>&#13;
&#13;
      <p>“Awesome!” said Ruben.</p>&#13;
&#13;
      <div class="informalfigure">&#13;
        <a id="med_id00019a"/>&#13;
&#13;
        <div class="mediaobject"><a id="med_id00019"/><img alt="image with no caption" src="../Images/httpatomoreillycomsourcenostarchimages2159993.png.jpg"/></div>&#13;
      </div>&#13;
&#13;
      <p><a class="indexterm" id="iddle1404"/><a class="indexterm" id="iddle1501"/><a class="indexterm" id="iddle1504"/><a class="indexterm" id="iddle1963"/>“Now, now,” said the King. “If this morning’s been any indication, I’m sure there’s a Computing Contraption around here somewhere that we can pry into to get an idea of what’s going on.” All three quickly scanned the train, looking for hidden compartments or mysterious devices. It wasn’t long before Ruben spotted a square of metallic mesh with a small red button beside it. When he pressed the button, the mesh grid slid up with a slight squeak, revealing the cheerful glow of an IRB <code class="literal">&gt;&gt;</code> prompt.</p>&#13;
&#13;
      <p>“Found it!” said Ruben, waving Scarlet and the King over.</p>&#13;
&#13;
      <p>“Great!” said Scarlet. “Let’s see if we can figure out a way to stop this thing.”</p>&#13;
&#13;
      <p>“Make it quick!” said the King. “We don’t want to miss our stop. The Hashery serves breakfast all day, but if you get there late, sometimes they run out of the best dishes. Like hash!”</p>&#13;
&#13;
      <p>Scarlet was busy inspecting the Ruby code on the Computing Contraption’s screen. “Oh no!” she said. “It looks like we’re caught in an <span class="emphasis"><em>infinite loop</em></span>!”</p>&#13;
&#13;
      <p>“Sweet breakfast gravy!” cried the King. “What’s that?”</p>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="while Loops">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_4"><a id="while_loops"/>while Loops</h1>&#13;
      </div>&#13;
&#13;
      <p>“An infinite loop is a Ruby instruction that never ends,” said Ruben. “In Ruby, a <span class="emphasis"><em>loop</em></span> is a bit of code that runs repeatedly, doing whatever its instructions tell it to until it’s supposed to stop. But if you give it a stopping condition that never happens, the code runs forever!”</p>&#13;
&#13;
      <p>“Take a look,” said Scarlet. “It looks like the code that drives the train will never stop running!” When the King squinted at the screen, this is what he saw.</p>&#13;
&#13;
      <div class="note" title="Note">&#13;
        <h3 class="title" id="heading_id_5"><a id="ch04note01"/>Note</h3>&#13;
&#13;
        <p><span class="emphasis"><em>Just read these next few examples—don’t try them out in IRB. These little bits of code (shown in gray) would only work as part of a longer program.</em></span></p>&#13;
      </div><a id="pro_id00064"/>&#13;
      <pre class="programlisting">&#13;
<span class="ash">while true</span>&#13;
  <span class="ash">drive_train_forward</span>&#13;
<span class="ash">end</span>&#13;
</pre>&#13;
&#13;
      <p>“I think I’ve heard of this,” said the King. “This loop is a <span class="emphasis"><em>while loop</em></span>, a bit of code that repeats <span class="emphasis"><em>while</em></span> some condition is true. But since this loop starts with <code class="literal">while true</code>, and <code class="literal">true</code> is always <code class="literal">true</code>, the loop will call the <code class="literal">drive_train_forward</code> method forever!”</p>&#13;
&#13;
      <p>“Exactly,” said Scarlet. “We need a way to tell the loop to stop.”</p>&#13;
&#13;
      <p>“What about this?” Ruben said, pointing to a yellowed piece of paper tucked next to the Computing Contraption’s screen. The King bent forward to read it. “‘A Very Brief Guide to the Loop and Its Machinations,’” he quoted. “This looks promising!”</p>&#13;
&#13;
      <div class="informalfigure">&#13;
        <a id="med_id00020a"/>&#13;
&#13;
        <div class="mediaobject"><a id="med_id00020"/><img alt="image with no caption" src="../Images/httpatomoreillycomsourcenostarchimages2159995.png.jpg"/></div>&#13;
      </div>&#13;
&#13;
      <p>“It says here that there’s not only a <code class="literal">drive_train_forward</code> method but also a <code class="literal">stop_train</code> method, which should stop the train for us,” Ruben said. “Try using that!”</p>&#13;
&#13;
      <p>“Sure thing!” said Scarlet. She quickly changed the code in the Computing Contraption to:</p><a id="pro_id00065"/>&#13;
      <pre class="programlisting">&#13;
<span class="ash">while true</span>&#13;
  <span class="ash">stop_train</span>&#13;
<span class="ash">end</span>&#13;
</pre>&#13;
&#13;
      <p>As soon as she pressed <span class="smaller">ENTER</span>, the train made a deep, sad <span class="emphasis"><em>boooooop</em></span> that faded away in just under a second, and as the sound trailed off, the train began to slow. Before they knew it, their train car was standing perfectly still on the monorail track.</p>&#13;
&#13;
      <p>“Nice work!” said Ruben.</p>&#13;
&#13;
      <p>“Well, you did stop the train,” said the King. “But take a look out that window.” Ruben and Scarlet ran to where the King pointed and looked out the window at the front of the car. Their hearts sank. “We’re stuck between platforms!” said Scarlet. “I can’t even see the next one on the track ahead.”</p>&#13;
&#13;
      <p>“Let’s take a look at the Very Brief Guide again,” Ruben said. “If whoever designed the Loop program built in a <code class="literal">drive_train_forward</code> and a <code class="literal">stop_train</code> method, maybe she also built in a way of figuring out whether the train is at a platform.”</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1275"/><a class="indexterm" id="iddle1966"/>Scarlet and Ruben returned to the Computing Contraption and looked over the Very Brief Guide to the Loop and Its Machinations. Meanwhile, the King wondered aloud: “If the loop was an infinite loop, why did the train stop for us at all? Shouldn’t it have whizzed by like it did at the other stations?”</p>&#13;
&#13;
      <p>“I don’t know,” said Ruben. “But remember how Haldo said there might have been another program in the kingdom that caused the Mysterious Pipe to overflow? Maybe there was some code running somewhere that told the Loop train to stop for us.”</p>&#13;
&#13;
      <p>“Maybe,” said the King, “but what code, and why? And who wrote it? This is getting stranger and stranger by the minute.”</p>&#13;
&#13;
      <p>“I think I’ve found something we can use,” said Scarlet. “It says here that the Loop program also has an <code class="literal">at_stop?</code> method. If we call that the right way, we should be able to move forward when we’re between stops, then stop when we get to a platform!”</p>&#13;
&#13;
      <p>“Great!” said Ruben. “And I think I know just how to do it.” He stepped up to the Computing Contraption and began to type.</p>&#13;
&#13;
      <p>“Don’t forget an <code class="literal">end</code> for your <code class="literal">while</code> loop,” Scarlet said. “Just like for <code class="literal">if</code>/<code class="literal">elsif</code>/<code class="literal">else</code>, loops need an <code class="literal">end</code>.”</p>&#13;
&#13;
      <p>“I know, I know,” said Ruben. “There, I think this’ll do it.”</p><a id="pro_id00066"/>&#13;
      <pre class="programlisting">&#13;
<span class="ash">while true</span>&#13;
  <span class="ash">if at_stop?</span>&#13;
    <span class="ash">stop_train</span>&#13;
    <span class="ash">break</span>&#13;
  <span class="ash">else</span>&#13;
    <span class="ash">drive_train_forward</span>&#13;
    <span class="ash">break</span>&#13;
  <span class="ash">end</span>&#13;
<span class="ash">end</span>&#13;
</pre>&#13;
&#13;
      <p>“Hold on just a moment,” said the King. “What’s that <code class="literal">break</code> bit do?”</p>&#13;
&#13;
      <p>“That tells the <code class="literal">while</code> loop to immediately stop,” said Ruben. “Otherwise, we’ll just <code class="literal">stop_train</code> or <code class="literal">drive_train_forward</code> forever!”</p>&#13;
&#13;
      <p>“It seems we need a way to fix that,” grumbled the King.</p>&#13;
&#13;
      <p>“I think this new code will do the trick,” Ruben said. He pressed <span class="smaller">ENTER</span>, and the train whirred to life. In less than a minute, the train pulled into the next platform and eased to a halt.</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1909"/>“We did it!” said the King. “And we’re at East Bumpspark station! The Hashery is just two more stops from here, at the New Mixico platform.”</p>&#13;
&#13;
      <div class="informalfigure">&#13;
        <a id="med_id00021a"/>&#13;
&#13;
        <div class="mediaobject"><a id="med_id00021"/><img alt="image with no caption" src="../Images/httpatomoreillycomsourcenostarchimages2159997.png.jpg"/></div>&#13;
      </div>&#13;
&#13;
      <p>“Great! We’ll be there in no time,” said Ruben. But the train just sat there at the East Bumpspark station, doors open, without a soul on the platform. The King, Scarlet, and Ruben stood around awkwardly for a minute or two before the King cleared his throat to break the silence.</p>&#13;
&#13;
      <p>“Well,” he said. “It looks like we figured out how to stop the train at a platform, but it’s not restarting for some reason. Shall we take a second look at the code?”</p>&#13;
&#13;
      <p>“Way ahead of you,” Scarlet said. “And I think I know what the trouble is—in our <code class="literal">while</code> loop, we give the Loop program an instruction to stop if it’s at a station and to proceed if it isn’t. Well, we’re at a station, and the Loop is doing <span class="emphasis"><em>exactly</em></span> what we’re telling it to do—it’s stopped! We never wrote anything in our loop to tell the train to start again after stopping.”</p>&#13;
&#13;
      <p>“You’re right!” said Ruben. “We need to rewrite the program. Maybe something like this?” And he typed:</p><a id="pro_id00067"/>&#13;
      <pre class="programlisting">&#13;
<span class="ash">while !at_stop?</span>&#13;
  <span class="ash">drive_train_forward</span>&#13;
<span class="ash">end</span>&#13;
</pre>&#13;
&#13;
      <p>“That <code class="literal">!at_stop?</code> looks a bit ugly to me,” Scarlet said. “And Ruby is all about writing beautiful code. Maybe something like this?” She took her turn at the Computing Contraption:</p><a id="pro_id00068"/>&#13;
      <pre class="programlisting">&#13;
<span class="ash">until at_stop?</span>&#13;
  <span class="ash">drive_train_forward</span>&#13;
<span class="ash">end</span>&#13;
</pre>&#13;
&#13;
      <p>“Just like <code class="literal">if</code> has an <code class="literal">unless</code>, <code class="literal">while</code> has an <code class="literal">until</code>,” Scarlet said. “This says that <span class="emphasis"><em>until</em></span> we reach a stop, we should keep driving the train forward.”</p>&#13;
&#13;
      <p>“That does look much nicer,” said the King, “but we still have a problem: we’re currently at a stop, so the program won’t move <a class="indexterm" id="iddle1059"/><a class="indexterm" id="iddle1085"/><a class="indexterm" id="iddle1456"/><a class="indexterm" id="iddle1486"/><a class="indexterm" id="iddle1813"/>us forward! And even if it does, we’ll just move forward to the next station and stop, with nothing in the program telling the train to start again.”</p>&#13;
&#13;
      <p>“You’re exactly right,” said Scarlet. “We need some way of telling Ruby to move from stop to stop until there are no more stops on the line. Ruben, do you see anything on the list that would tell the train to keep going from one station to the next?”</p>&#13;
&#13;
      <p>“Well,” said Ruben, “It says here that Ruby’s <code class="literal">next</code> method can be used in the Loop program to move from one station to another, but I’m not totally sure how we could do that. There’s an example in the Very Brief Guide to the Loop and Its Machinations, but it has all these weird-looking square brackets in it. Have you ever seen those before?”</p>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="Arrays">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_6"><a id="arrays"/>Arrays</h1>&#13;
      </div>&#13;
&#13;
      <p>While Scarlet explains those funky-looking brackets to Ruben, I’ll take a minute to explain them to you. (Scarlet could have explained just as well, but I was getting a little antsy.)</p>&#13;
&#13;
      <p>What Ruben’s describing looks like this:</p><a id="pro_id00069"/>&#13;
      <pre class="programlisting">&#13;
<span class="ash">["East Bumpspark", "Endertromb Avenue", "New Mixico", "Mal Abochny"]</span>&#13;
</pre>&#13;
&#13;
      <p>A bunch of Ruby objects between square brackets (<code class="literal">[]</code>) and separated by commas (<code class="literal">,</code>) is called an <span class="emphasis"><em>array</em></span>. Arrays are basically just lists! For example, you could make a Ruby grocery list with an array, like so:</p><a id="pro_id00070"/>&#13;
      <pre class="programlisting">&#13;
<span class="ash">grocery_list = ["cheese", "bread", "grapes", "a festive hat for all</span>&#13;
<span class="ash">occasions"]</span>&#13;
</pre>&#13;
&#13;
      <p>You can put anything in a Ruby array: strings, numbers, Booleans, or even other lists! This is a handy way to set a single variable equal to a whole bunch of values. We’ll talk more about arrays in the next chapter, but the important thing to know for now is that arrays can be used with really handy methods (called <span class="emphasis"><em>iterators</em></span>, but don’t worry about memorizing that word right away) that let you <span class="emphasis"><em>iterate through</em></span>—that is, go over—each <a class="indexterm" id="iddle1094"/><a class="indexterm" id="iddle1260"/><a class="indexterm" id="iddle1347"/><a class="indexterm" id="iddle1349"/><a class="indexterm" id="iddle1499"/><a class="indexterm" id="iddle1560"/><a class="indexterm" id="iddle1595"/><a class="indexterm" id="iddle1940"/>element in the array. Examples are the best way to learn, so try this code in IRB now to see the results:</p><a id="pro_id00071"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">grocery_list = ["cheese", "bread", "grapes", "a festive hat for</span></strong></span>&#13;
<span class="strong"><strong><span class="red">all occasions"]</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">for item in grocery_list</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">next if item.length.odd?</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts item</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
</pre>&#13;
&#13;
      <p>This will print out:</p><a id="pro_id00072"/>&#13;
      <pre class="programlisting">&#13;
cheese&#13;
grapes&#13;
=&gt; ["cheese", "bread", "grapes", "a festive hat for all occasions"]&#13;
</pre>&#13;
&#13;
      <p>You see the whole array at the end because even though <code class="literal">for</code> will print only what you asked, it gives you back the whole array in case you did something to change it. (We didn’t.)</p>&#13;
&#13;
      <div class="informalfigure">&#13;
        <a id="med_id00022a"/>&#13;
&#13;
        <div class="mediaobject"><a id="med_id00022"/><img alt="image with no caption" src="../Images/httpatomoreillycomsourcenostarchimages2159999.png.jpg"/></div>&#13;
      </div>&#13;
&#13;
      <p>The <code class="literal">next</code> method is built into Ruby and does exactly what it sounds like: it moves on to the next item in the array immediately, without calling any other code. In this example, since the string <code class="literal">"bread"</code> has a length of 5 and <code class="literal">"a festive hat for all occasions"</code> has a length of 31 (both odd numbers), <code class="literal">next</code> gets called, and these items in the list don’t get printed out (remember, <code class="literal">next</code> goes immediately to the next item in the list, skipping any other code before its <code class="literal">end</code>). Since <code class="literal">"cheese"</code> and <code class="literal">"grapes"</code> each have lengths of 6—an even number—and since <code class="literal">next</code> is only called if the number of letters is odd, the <code class="literal">puts</code> statement gets called, and the item names are printed out.</p>&#13;
&#13;
      <p>As for that brand-new <code class="literal">for</code>/<code class="literal">in</code> bit you just saw, I’ll leave it to Scarlet and Ruben to explain that. It sounds like Ruben’s got the hang of arrays and iterators, so let’s check out the example he’s working on in the Loop program.</p>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="Putting Arrays and Loops into Action">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_7"><a id="putting_arrays_and_loops_into_action"/>Putting Arrays and Loops into Action</h1>&#13;
      </div>&#13;
&#13;
      <p><a class="indexterm" id="iddle1871"/>“I think I understand,” Ruben said. “So arrays are just lists of things—strings, numbers, anything we like—and we can set them to a single variable name if we want. Not only that, but we can use loops and iterators to go over the entire array so we can do something for each item, or <span class="emphasis"><em>element</em></span>, in the array if we want.”</p>&#13;
&#13;
      <p>“Exactly,” said Scarlet. “Can I have a look at what you’re typing in IRB?” Ruben nodded and turned the Computing Contraption’s display toward Scarlet. This is what she saw:</p><a id="pro_id00073"/>&#13;
      <pre class="programlisting">&#13;
<span class="ash">stops = ["East Bumpspark", "Endertromb Avenue", "New Mixico", "Mal</span>&#13;
<span class="ash">Abochny"]</span>&#13;
<span class="ash">for stop in stops</span>&#13;
  <span class="ash">next if stop.empty?</span>&#13;
<span class="ash">end</span>&#13;
</pre>&#13;
&#13;
      <p>“Good!” said Scarlet. “But what’s going on with that <code class="literal">for</code>/<code class="literal">in</code> part? Is that a kind of loop, like <code class="literal">while</code>?”</p>&#13;
&#13;
      <p>“Sort of,” said Ruben. “Basically it’s telling Ruby, ‘Hey! <span class="emphasis"><em>For</em></span> each thing <span class="emphasis"><em>in</em></span> this array, carry out the instructions before the <code class="literal">end</code>. So, in this case, for each stop in the <code class="literal">stops</code> list, go to the next one if the stop has no people waiting there.”</p>&#13;
&#13;
      <p>“Okay,” said Scarlet. “One more question—I saw you define the <code class="literal">stops</code> variable and set it to an array, but I didn’t see you assign the <code class="literal">stop</code> variable anywhere. Why’s that?”</p>&#13;
&#13;
      <p>“That’s just a cool shortcut Ruby lets you take. See, as you go through the array, Ruby moves from each item to the next, and it makes it a lot easier if you can give each item a temporary name while you’re working on it. Since this ‘temporary’ variable only matters inside the <code class="literal">for</code> loop, you don’t have to declare it—you just say something like <code class="literal">for stop in stops</code>, and Ruby knows that <code class="literal">stop</code> will take on the value of each item in the <code class="literal">stops</code> array in turn. In fact, you can give that variable any name you want, like <code class="literal">item</code> or <code class="literal">thingy</code> or <code class="literal">elf_with_a_pet_ham</code>, but <code class="literal">stop</code> makes the most sense, I think.”</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1019"/><a class="indexterm" id="iddle1062"/><a class="indexterm" id="iddle1127"/><a class="indexterm" id="iddle1222"/><a class="indexterm" id="iddle1240"/><a class="indexterm" id="iddle1255"/><a class="indexterm" id="iddle1945"/>“I think so, too,” said Scarlet. “But something about that <code class="literal">for</code> loop looks weird to me. I’ve read a lot of Ruby code by now, and I don’t see many <code class="literal">for</code> loops floating around. I do see a lot of these, though!” And she started typing into the Computing Contraption:</p><a id="pro_id00074"/>&#13;
      <pre class="programlisting">&#13;
<span class="ash">stops = ["East Bumpspark", "Endertromb Avenue", "New Mixico",</span>&#13;
<span class="ash">"Mal Abochny"]</span>&#13;
<span class="ash">stops.each do |stop|</span>&#13;
  <span class="ash">next if stop.empty?</span>&#13;
<span class="ash">end</span>&#13;
</pre>&#13;
&#13;
      <p>“Whoa!” said Ruben. “What’s that? Does it do the same thing as my <code class="literal">for</code> loop?”</p>&#13;
&#13;
      <p>“Yup!” said Scarlet. “And it’s only a tiny bit different, but much nicer looking. Instead of the <code class="literal">for</code>/<code class="literal">in</code> part, we can just call the <code class="literal">each</code> method directly on the <code class="literal">stops</code> variable. Then we have exactly the same code as before, only it’s between <code class="literal">do</code> and <code class="literal">end</code> instead of <code class="literal">for</code>/<code class="literal">in</code> and <code class="literal">end</code>. The <code class="literal">do</code>/<code class="literal">end</code> bit actually comes up a lot in Ruby, and it’s called a <span class="emphasis"><em>block</em></span>.”</p>&#13;
&#13;
      <p>“Okay,” said Ruben, “that makes sense. But what about the <code class="literal">stop</code> between the two vertical lines? Is that like the ‘temporary’ <code class="literal">stop</code> variable from my <code class="literal">for</code> loop?”</p>&#13;
&#13;
      <p>“Exactly,” Scarlet said. “You can think of those vertical lines as being like the sides of a little window that we move along the array: as we put the box over each element in the array, <code class="literal">stop</code> is temporarily set to the value of that element.”</p>&#13;
&#13;
      <p>“In fact,” she continued, “You can even write it a bit shorter. Ruby lets you use curly brackets instead of <code class="literal">do</code>/<code class="literal">end</code>, and since we have only one line of code in our block, it looks even more elegant with the brackets.” She typed into IRB:</p><a id="pro_id00075"/>&#13;
      <pre class="programlisting">&#13;
<span class="ash">stops = ["East Bumpspark", "Endertromb Avenue", "New Mixico",</span>&#13;
<span class="ash">"Mal Abochny"]</span>&#13;
<span class="ash">stops.each { |stop| next if stop.empty? }</span>&#13;
</pre>&#13;
&#13;
      <p>“This is all very fascinating,” said the King, “but will the code <span class="emphasis"><em>work</em></span>? Will we be able to get to New Mixico station before we all starve to death, or—heaven forbid!—the Hashery runs out of hash?”</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1506"/>“I think we’re all set!” said Ruben. “And I have a feeling we’ll talk a lot more about arrays and blocks after we’ve had a good meal. Ready, Scarlet?” Scarlet nodded, and on the count of three, they pushed <span class="smaller">ENTER</span> together. The Loop train car vibrated to life, the doors <span class="emphasis"><em>whooshed</em></span> shut, and the car moved on to the Endertromb Avenue station. The three held their breath as the car doors opened, the car idled . . . and the doors slid shut again! The King began to clap as the car moved on to New Mixico station, and he didn’t stop clapping until they left the train, walked down the stairs leading from the platform to the street, and made their way toward the cherry-red doors of the Hashery.</p>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="Your Project, Should You Choose to Accept It">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_8"><a id="your_projectcomma_should_you_choose_to_a"/>Your Project, Should You Choose to Accept It</h1>&#13;
      </div>&#13;
&#13;
      <p>After a careful review of the Loop by the Loop Authority Council for the King, the members of the Council have determined that the Loop <span class="emphasis"><em>does</em></span>, in fact, need a conductor (if only to look after the program and ensure it doesn’t end up in any more infinite loops). Surprisingly, no one volunteered for the position, so I went ahead and volunteered you! That’s just the sort of guy I am.</p>&#13;
&#13;
      <p>Conducting trains is big business, but I think it’s safe to start small. We’ll just work on a program to report whether the Loop stops at a requested station, and if it does, list all the stops before the requested stop so passengers will know how many stations to expect before theirs. Let’s begin by making a new file called <span class="bolditalic red">loop_the_loop.rb</span>. (As always, peek back at <a class="xref" href="../Text/ch01.html" title="Chapter 1. What This Book’s About">Chapter 1</a> if you don’t remember how to do this, or ask your local adult for help.) Then open your file and type the following code.</p>&#13;
&#13;
      <p><span class="bolditalic red">loop_the_loop.rb</span></p><a id="pro_id00076"/>&#13;
      <pre class="programlisting">&#13;
➊ we_wanna_ride = true&#13;
  stops = ["East Bumpspark", "Endertromb Avenue", "New Mixico",&#13;
  "Mal Abochny"]&#13;
&#13;
➋ while we_wanna_ride&#13;
    print "Where ya headin', friend?: "&#13;
➌   destination = gets.chomp&#13;
&#13;
➍   if stops.include? destination&#13;
    puts "I know how to get to #{destination}! Here's the station list:"&#13;
➎     stops.each do |stop|&#13;
        puts stop&#13;
        break if stop == destination&#13;
      end&#13;
    else&#13;
      puts "Sorry, we don't stop at that station. Maybe another time!"&#13;
      we_wanna_ride = false&#13;
    end&#13;
  end&#13;
</pre>&#13;
&#13;
      <p><a class="indexterm" id="iddle1142"/><a class="indexterm" id="iddle1252"/><a class="indexterm" id="iddle1399"/><a class="indexterm" id="iddle1505"/><a class="indexterm" id="iddle1670"/><a class="indexterm" id="iddle1964"/>There are a few new bits here, but nothing you can’t handle!</p>&#13;
&#13;
      <p>First, we set a couple of variables: <code class="literal">we_wanna_ride</code> is <code class="literal">true</code>, and <code class="literal">stops</code> is set to an array of strings ➊. Next, we create a <code class="literal">while</code> loop with <code class="literal">we_wanna_ride</code> (which starts as <code class="literal">true</code>) as the condition ➋. Inside the loop, we use <code class="literal">print</code> to print some text on the screen and <code class="literal">gets.chomp</code> to get the user’s answer ➌.</p>&#13;
&#13;
      <p>The <code class="literal">include?</code> method ➍ is new! It simply returns <code class="literal">true</code> if the array has an element that matches <code class="literal">destination</code> and <code class="literal">false</code> otherwise. (This is really handy for quickly checking whether an object you want is in a given array.)</p>&#13;
&#13;
      <p>The next part at ➎ is a little trickier:</p><a id="pro_id00077"/>&#13;
      <pre class="programlisting">&#13;
stops.each do |stop|&#13;
  puts stop&#13;
  break if stop == destination&#13;
end&#13;
</pre>&#13;
&#13;
      <p>You’ve already seen the <code class="literal">stops.each do |stop| ... end</code> part, and the <code class="literal">break if stop == destination</code> part does exactly what you’d guess: it <span class="emphasis"><em>breaks</em></span> out of the loop as soon as the Loop reaches a stop that equals the destination the passenger wants. It prints out each element before it makes this check, though, so it will always print out at least one stop if that stop is in the array.</p>&#13;
&#13;
      <p>You can test out your conductor program by typing <span class="strong"><strong><span class="red"><code class="literal">ruby loop_the_loop.rb</code></span></strong></span> at the command line and pressing <span class="smaller">ENTER</span>. You should see something like this (of course, you’ll probably pick different stops than I did):</p><a id="pro_id00078"/>&#13;
      <pre class="programlisting">&#13;
Where ya headin', friend?: Mal Abochny&#13;
I know how to get to Mal Abochny! Here's the station list:&#13;
East Bumpspark&#13;
Endertromb Avenue&#13;
New Mixico&#13;
Mal Abochny&#13;
Where ya headin', friend?: New Mixico&#13;
I know how to get to New Mixico! Here's the station list:&#13;
East Bumpspark&#13;
Endertromb Avenue&#13;
New Mixico&#13;
Where ya headin', friend?: Detroit&#13;
Sorry, we don't stop at that station. Maybe another time!&#13;
</pre>&#13;
&#13;
      <p>You can keep rerunning it with different input to see how the output changes each time!</p>&#13;
&#13;
      <p>If you want to make your program even more elaborate, here are some other things to think about:</p>&#13;
&#13;
      <div class="itemizedlist">&#13;
        <ul class="itemizedlist">&#13;
          <li class="listitem">&#13;
            <p>Right now, the program will keep prompting the user for input as long as the user keeps asking for train stops that are in the <code class="literal">stops</code> array. How might you update the program to run only once, even if it recognizes a stop?</p>&#13;
          </li>&#13;
&#13;
          <li class="listitem">&#13;
            <p>How could you handle accepting lowercase letters for destinations? (Hint: This will be a lot like one of the extra steps you might have taken for your last project.)</p>&#13;
          </li>&#13;
&#13;
          <li class="listitem">&#13;
            <p>What if a passenger is going the other way on the train (for instance, from Mal Abochny to East Bumpspark)? How could you update your program to work in both directions? Even trickier, what if the train route is a big circle (meaning if a passenger goes from East Bumpspark to Mal Abochny, the next stop after Mal Abochny should be East Bumpspark again)? How could you update your program to print out the right list of train stops if a passenger wants to go all the way around the circle?</p>&#13;
          </li>&#13;
        </ul>&#13;
      </div>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="You Know This!">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_9"><a id="you_know_thisexclamation_mark-id00003"/>You Know This!</h1>&#13;
      </div>&#13;
&#13;
      <p><a class="indexterm" id="iddle1086"/><a class="indexterm" id="iddle1256"/><a class="indexterm" id="iddle1348"/><a class="indexterm" id="iddle1405"/><a class="indexterm" id="iddle1461"/><a class="indexterm" id="iddle1500"/><a class="indexterm" id="iddle1502"/><a class="indexterm" id="iddle1503"/><a class="indexterm" id="iddle1596"/><a class="indexterm" id="iddle1965"/>I threw a lot at you in this chapter, but if you’re conducting trains after reading it, I’m pretty sure you know your stuff. Let’s review what we looked at.</p>&#13;
&#13;
      <p>We covered <span class="emphasis"><em>while loops</em></span>, which are loops that contain some code between <code class="literal">while</code> and <code class="literal">end</code> and will continue to run that code as long as the <code class="literal">while</code> condition is <code class="literal">true</code>. (Beware—if there’s no way for the condition to become <code class="literal">false</code>, the loop will go on forever and create an <span class="emphasis"><em>infinite loop</em></span>!)</p>&#13;
&#13;
      <p>We saw that, just like <code class="literal">if</code> has an <code class="literal">unless</code>, <code class="literal">while</code> has an <code class="literal">until</code>. If you can write:</p><a id="pro_id00079"/>&#13;
      <pre class="programlisting">&#13;
while something_is_the_case&#13;
  # Do something!&#13;
end&#13;
</pre>&#13;
&#13;
      <p>then you can also write:</p><a id="pro_id00080"/>&#13;
      <pre class="programlisting">&#13;
until !something_is_the_case&#13;
  # Do something!&#13;
end&#13;
</pre>&#13;
&#13;
      <p>We also saw that when using a loop or an <span class="emphasis"><em>iterator</em></span> (which is just Ruby code that loops over items in a list), we could call the <code class="literal">next</code> method to skip certain elements based on an <code class="literal">if</code>/<code class="literal">elsif</code>/<code class="literal">else</code> or <code class="literal">unless</code> statement.</p>&#13;
&#13;
      <p>We talked a little bit about arrays, which are basically just Ruby lists, and how we can put anything we want inside them. An array looks like this:</p><a id="pro_id00081"/>&#13;
      <pre class="programlisting">&#13;
my_hobbies = ["Ruby", "eating things", "cat videos"]&#13;
</pre>&#13;
&#13;
      <p>We learned that we could use a <span class="emphasis"><em>for loop</em></span> or the <code class="literal">each</code> method to <span class="emphasis"><em>iterate</em></span>, or go over, an array, and while they work exactly the same, the <code class="literal">each</code> method is more common in Ruby.</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1020"/><a class="indexterm" id="iddle1128"/><a class="indexterm" id="iddle1223"/><a class="indexterm" id="iddle1241"/>A <code class="literal">for</code> loop looks like this:</p><a id="pro_id00082"/>&#13;
      <pre class="programlisting">&#13;
# Assuming we have an array called todo_list&#13;
for task in todo_list&#13;
  puts task&#13;
end&#13;
</pre>&#13;
&#13;
      <p>And iterating with <code class="literal">each</code> looks like this:</p><a id="pro_id00083"/>&#13;
      <pre class="programlisting">&#13;
# Using do/end&#13;
todo_list.each do |task|&#13;
  puts task&#13;
end&#13;
&#13;
# Or, using curly brackets&#13;
todo_list.each { |task| puts task }&#13;
</pre>&#13;
&#13;
      <p>Finally, we learned a bit about <span class="emphasis"><em>blocks</em></span>. Ruby blocks are just regular Ruby code sandwiched between either <code class="literal">do</code>/<code class="literal">end</code> or curly brackets (<code class="literal">{}</code>). Some methods, like <code class="literal">each</code>, take blocks, and we’ll learn way more about those after a hearty helping of Ruby know-how at the Hashery.</p>&#13;
    </div>&#13;
  </div>&#13;
</body></html>