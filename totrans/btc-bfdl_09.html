<html><head></head><body>
  <h2 class="h2" id="ch09"><a id="page_185"/><strong>9</strong></h2>

  <p class="h2c"><strong>UNDERSTANDING THE DIFFERENT TYPES OF BITCOIN WALLETS</strong></p>

  <p class="noindent">In <a href="../Text/ch02.html#ch02">Chapter 2</a> we recommended using the Bitcoin wallet program Electrum, which is free and open source, runs on most devices, and is ideal for beginners. However, <em>hundreds</em> of other Bitcoin wallet programs are available, ranging from simple to sophisticated, and new ones are being released constantly as developers compete to add new features and slicker interfaces. But beneath the slicker interfaces and occasionally gimmicky features, some fundamental differences between Bitcoin wallet programs exist. The goal of this chapter is to help you understand those differences so you can make an informed choice about the most useful Bitcoin wallet for your needs.</p>

  <p class="indent">In this chapter, we’ll occasionally use the terms <em>Bitcoin wallet</em> or just <em>wallet</em> to mean <em>Bitcoin wallet program</em>, despite the fact that a <em>Bitcoin wallet</em> normally refers to just a list of addresses and private keys.</p>

  <h3 class="h3" id="ch00leve1sec122"><a id="page_186"/><strong>Wallet Software Design Fundamentals</strong></h3>

  <p class="noindent">At a minimum, a Bitcoin wallet program needs to let a user send and receive bitcoins, as well as keep track of how many bitcoins are available to spend. In other words, a Bitcoin wallet program must be able to (1) create and broadcast transactions to the Bitcoin network, (2) generate new Bitcoin addresses, and (3) scan the blockchain to detect whether you’ve received any bitcoins at those addresses. The major differences between different wallet designs primarily involve these three functions and how they are implemented. The design choices that support these differences are as follows:</p>

  <p class="ordert">1. Offline vs. online transaction signing</p>

  <p class="order">2. Random vs. deterministic key generation (versus single key generation)</p>

  <p class="orderb">3. Full vs. simplified payment verification</p>

  <p class="indent">These design choices have significant consequences for the computational resources required, the security of the stored bitcoins, and even the nature and effectiveness of backups. There are no right choices. Some users are better off using a wallet that requires only a single device and the least amount of computational power, whereas a large enterprise might prefer software that emphasizes security. In the following sections, we explain each design choice in detail so you can make an informed choice.</p>

  <h4 class="h4" id="ch00leve1sec123"><strong><em>Offline vs. Online Transaction Signing</em></strong></h4>

  <p class="noindent">Bitcoin wallet programs need private keys in order to sign transactions before they can be broadcast to the Bitcoin network. In the simplest design, these private keys are found in the user’s Bitcoin wallet, which is stored locally on the user’s device in a <em>wallet.dat</em> file. This is the way the first Bitcoin wallet program, Bitcoin-Qt, worked. However, this design is vulnerable to attackers, who could attempt to remotely access the device over the Internet, copy the wallet file, and try to extract the private keys. A more secure design involves splitting the Bitcoin wallet and the software that manages it into two components: one with the private keys and the other without. The component <em>with</em> the private keys is usually stored in a highly secure location and is used for transaction signing. The component <em>without</em> the private keys can be stored anywhere, possibly in many locations at once, and is called a <em>watch-only wallet</em>.</p>

  <p class="indent">As the name implies, you cannot directly spend money stored in a watch-only wallet. Instead, if you want to make a purchase, you would need to take an extra step to sign your transactions with the private keys. This second step is usually done via a second computer that isn’t connected to the Internet (to prevent hacking attacks) and is used solely to store private keys and sign transactions with them as needed. This security technique, called <em>offline transaction signing</em>, was discussed to some extent in <a href="../Text/ch03.html#ch03">Chapter 3</a> as a strategy for securely storing large amounts of bitcoins, but it offers other benefits as well.</p>

  <p class="indent"><a id="page_187"/>Watch-only wallets are particularly useful for point-of-sale terminals (i.e., cash registers) where the cashier needs to receive bitcoins from a customer but never needs to (and may not be authorized to) spend them. Importantly, because watch-only wallets do not store any private keys, if a point-of-sale terminal was stolen, the bitcoins it contained would remain secure. In addition, watch-only wallets can be safely installed on mobile phones or run from low-security web servers (requiring only a simple username and login for access) to allow users to monitor their funds without the risk of the wrong person gaining access to them.</p>

  <p class="indent">Many Bitcoin wallet programs can be run in one of two modes: a <em>full mode</em> (where a single wallet program and computer are used for all steps) or a watch-only mode. If a wallet program advertises a <em>watch-only mode</em>, it typically implies that the same software can also be used for offline transaction signing. <em>Hybrid wallets</em> are also available in which some of the Bitcoin addresses are watch-only, whereas other addresses have their private keys stored on the online device. As a result, the same device can be used for spending from a low-security checking account and for monitoring a more secure savings account.</p>

  <p class="indent">Depending on how new Bitcoin addresses are generated, watch-only wallets may or may not have to be synchronized with their offline component. Typically, a new Bitcoin address must be generated on the offline computer and then imported into the watch-only wallet (without importing the corresponding private key). However, with deterministic key generation (described in the next section), watch-only wallets can generate new Bitcoin addresses on their own without knowing the private keys that correspond to them.</p>

  <p class="note"><strong>NOTE</strong><br/>
  <em>Deterministic key generation is very useful for point-of-sale terminals, because they won’t run out of deposit addresses in situations that involve numerous customers.</em></p>

  <h4 class="h4" id="ch00leve1sec124"><strong><em>Random Key Generation vs. Deterministic Key Generation (vs. Single Key Generation)</em></strong></h4>

  <p class="noindent">All Bitcoin wallet programs provide new users with at least one randomly generated Bitcoin address and private key. How and whether additional addresses are generated is a design choice that can incite very strong opinions among Bitcoin developers. The original Bitcoin wallet program assumed that users would never reuse an address after spending bitcoins from it. Every time a user wanted to spend bitcoins, a certain amount would go to the intended recipient, but the rest would be moved to a new, randomly generated Bitcoin address called the <em>change address</em>. This approach helps protect the privacy of the user, because it is more difficult for an external observer to track an individual’s bitcoins if the person continually changes addresses. It’s not possible to distinguish the transfer of bitcoins to a change address from the transfer of bitcoins from one person to another. Not everyone likes this behavior, though; some think it’s easier to have just <a id="page_188"/>one Bitcoin address (like having one email address) and aren’t as concerned about privacy. So some Bitcoin wallet programs provide only a single address that is continuously reused. These <em>single key generation</em> wallet programs allow you to generate additional addresses manually, but the default behavior is to reuse existing addresses.</p>

  <p class="indent">Among the Bitcoin wallet programs that constantly generate new addresses, differences in implementation exist. Recall that a private key is a 256-bit integer that is usually generated by some random process. From the private key, Bitcoin wallet programs can calculate the associated public key (which is a point on an elliptic curve; see <a href="../Text/ch07.html#ch07">Chapter 7</a> for the cryptographic details), which in turn can be converted into a Bitcoin address by applying the RIPEMD160 and SHA256 hash functions. To generate a collection of private key/Bitcoin address pairs, many programs use correspondingly as many random numbers. This is known as <em>random key generation</em>. Every time a user needs a new Bitcoin address, a new random number is used as the private key. The drawback to this approach is that backups need to be updated regularly—essentially, every time a new address is created. This is particularly important to keep in mind in the context of change addresses. If you send some of your bitcoins to a friend and the remainder of your balance is sent to a newly generated change address, potentially the majority of your funds are no longer backed up! Some unfortunate incidents have occurred in Bitcoin’s history in which users of random key generation–based wallets deleted or lost their wallets shortly after their funds were sent to a new change address but before they updated their backup.</p>

  <p class="indent">An alternative approach is <em>deterministic key generation</em>. With this approach, only the first private key is a randomly chosen 256-bit integer, which is known as the <em>master private key</em>, and it has a corresponding <em>master public key</em>. Whenever the user needs a new Bitcoin address, a new private key is chosen that is related to the master private key by a simple mathematical relationship (no randomness is involved). In the simplest implementation, the master private key is simply incremented by 1 to generate a new key (e.g., if the master private key is the number 47, subsequent private keys would be 48, 49, 50, etc.). The advantage of this approach is that a single backup, created when a user first creates a new Bitcoin wallet, is sufficient and never needs to be updated.<sup><a id="footnote_64"/><a href="../Text/footnote.html#footnote64">1</a></sup> In fact, this is how Electrum works. Recall that in <a href="../Text/ch02.html#ch02">Chapter 2</a>, Electrum prompted you to write down a 12-word mnemonic for backup purposes. That mnemonic was, in fact, a master private key.<sup><a id="footnote_65"/><a href="../Text/footnote.html#footnote65">2</a></sup> All of the Bitcoin addresses in your Electrum wallet can be derived from this master private key.</p>

  <h5 class="h5" id="ch00leve1sec125"><a id="page_189"/><strong>Combining Deterministic Key Generation with Watch-Only Wallets</strong></h5>

  <p class="noindent">Imagine the following scenario:</p>

  <p class="bullt">• Lisa owns a restaurant that accepts Bitcoin.</p>

  <p class="bull">• All the waiters in the restaurant have Bitcoin wallets on their phones to accept payments.</p>

  <p class="bullb">• Lisa wants to be the only person who can spend the money sent to these wallets.</p>

  <p class="indent">Clearly, it would be very convenient if Lisa could set up this system, but it seems like it would be a technical challenge: Every waiter would need the ability to create tons of new Bitcoin addresses on demand in their wallets, yet Lisa still needs to be the only person with access to the private keys that power each wallet.</p>

  <p class="indent">However, when you combine deterministic key generation with a watch-only wallet, this type of system is actually straightforward: Surprisingly, it is possible for a watch-only wallet (running on every waiter’s phone) to create many new public keys arbitrarily without having any knowledge about the private keys associated with them!</p>

  <p class="indent">This is all Lisa has to do:</p>

  <p class="ordert">1. Create public and private keys on her computer using deterministic key generation.</p>

  <p class="order">2. Give a public key to each waiter along with a program that supports a watch-only feature as well as deterministic keys.</p>

  <p class="order">3. Waiters can then accept as many payments with their wallets as they like.</p>

  <p class="orderb">4. Only Lisa can spend the money in these wallets using her computer’s wallet. Her computer is the only computer able to generate the corresponding private keys for all Bitcoin transactions in the restaurant.</p>

  <p class="indent">Whether you run a restaurant, a bank, or any other business, having a payment mechanism whereby your employees can arbitrarily accept payments from customers but only you, the owner of the business, can <em>unlock</em> the money is a powerful feature.</p>

  <h5 class="h5" id="ch00leve1sec126"><strong>The Math Behind Deterministic Key Generation with Watch-Only Wallets</strong></h5>

  <p class="noindent">So how is it mathematically possible to generate new keys using only public key information? To explain, we’ll refer to the cryptography on how private keys and public keys are mathematically related. In <a href="../Text/ch07.html#ch07">Chapter 7</a>, we explained that given a secret private key, <em>d</em> (let’s call this a master private key), the corresponding (master) public key, <em>Q</em>, is determined by the point multiplication operation:</p>

  <p class="center"><em>d</em>G = Q</p>

  <p class="indent"><a id="page_190"/>Recall that both G and Q are points on the elliptic curve, but that G is publicly known to everyone and is a hard-coded constant in the Bitcoin protocol (whereas Q is unique to you). The master Bitcoin address is then derived from Q using several hash functions and other formatting.</p>

  <p class="indent">The <em>obvious</em> way to deterministically generate a <em>new</em> Bitcoin address is to first choose a new private key, <em>d</em><sub>new</sub><em>= d</em> + 1, and then calculate the corresponding new public key, Q<sub>new</sub>:</p>

  <p class="center"><em>d</em><sub>new</sub>G = Q<sub>new</sub></p>

  <p class="indent">However, this method of generating a new public key requires you to know the master private key. So what if you don’t know the master private key? Could you generate a new Bitcoin address with only the knowledge of a master <em>public</em> key? Yes!</p>

  <p class="indent">We can rewrite the equation for Q<sub>new</sub> as follows:</p>

  <p class="center"><em>d</em><sub>new</sub>G = (<em>d</em> + 1)G = <em>d</em>G + G = Q<sub>new</sub></p>

  <p class="indent">Observe that the term <em>d</em>G can be rewritten as the master public key, Q:</p>

  <p class="center">Q + G = Q<sub>new</sub></p>

  <p class="indent">As a result, we can calculate new public keys using only the knowledge of the master public key and the public constant G. Additional public keys can be generated by adding any number of G points:</p>

  <table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr>
      <td class="table" valign="top">
        <p class="tablea1">Q + 2G = Q<sub>two</sub></p>
      </td>
    </tr>

    <tr>
      <td class="table" valign="top">
        <p class="tablea1">Q + 3G = Q<sub>three</sub></p>
      </td>
    </tr>

    <tr>
      <td class="table" valign="top">
        <p class="tablea2">...</p>
      </td>
    </tr>
  </table>

  <p class="indent">Of course, a danger of the deterministic key generation approach is that if your master private key falls into the wrong hands, all of the derived Bitcoin addresses would be compromised. Also, from a privacy standpoint, if someone sees your master public key (which becomes public information once you send bitcoins to the corresponding address), that person can derive your subsequent public keys in an attempt to track your spending.</p>

  <p class="indent">Although we won’t delve into the mathematical details, deterministic key generation allows for another, even more advanced Bitcoin wallet feature, <em>hierarchical deterministic wallets</em>, that may appeal particularly to large organizations. The master private key can be branched into sub-master keys, which can be further branched into sub-submaster keys and so on. Each has a property that allows any key at one level to access the bitcoins held at every level below it. For example, a bank manager may hold a level-two private key (the level-one key is held by the CEO), and his staff may each hold level-three keys. Everyone shares the same hierarchical wallet, but the manager has access to his own funds and those of his staff, and the staff can access only their own accounts. Hierarchical deterministic wallets might also be useful for families in which the parents want to give their children bitcoins but maintain access as well.</p>

  <h4 class="h4" id="ch00leve1sec127"><a id="page_191"/><strong><em>Full vs. Simplified Payment Verification</em></strong></h4>

  <p class="noindent">Bitcoin’s central feature is that you don’t have to trust an individual, third-party, or central institution. However, Bitcoin wallet programs must be able to verify that the transactions they receive are valid. In this context, it is important to distinguish between the blockchain (the immutable public document that correctly lists every valid Bitcoin transaction) and someone’s copy of the blockchain, which is what you have access to. The former is an abstract concept, whereas the latter is the practical reality. When you connect your wallet program to the Bitcoin network, it connects to several nodes that will send your program transaction data, but you cannot assume that data is valid. If you ask a stranger on the Internet to pay you 2 BTC for an expensive watch you are selling, and a node you are connected to indicates you have received 2 BTC shortly thereafter, is it safe to mail the watch? A valid transaction needs to (1) have the correct digital signature and (2) use bitcoins that originated in a mining block reward and have not yet been spent. All Bitcoin wallet programs can verify the first need with complete certainty, but the second concern is addressed with varying degrees of certainty depending on the design of the program.</p>

  <p class="indent">Bitcoin wallet programs can verify transactions either by keeping their own complete copy of the blockchain, which is referred to as <em>full payment verification</em>, or by using an abridged version, which is called <em>simplified payment verification (SPV)</em>.</p>

  <p class="indent">Full payment verification wallets, also called <em>thick</em> or <em>heavyweight</em> wallets, require a complete copy of the blockchain. They can verify that bitcoins used in a transaction originated from a mined block by scanning backward, transaction by transaction, in the blockchain until their origin is found (and the wallets can check whether those bitcoins were ever double spent). These wallet programs are often active participants in the Bitcoin network in that they not only handle the user’s transactions but they also verify and relay other people’s transactions (in these cases, computers running such programs are called <em>full nodes</em>). All Bitcoin miners are also full nodes (i.e., they need a complete copy of the blockchain to mine).</p>

  <p class="indent">One problem with full payment verification wallets is that they are very resource-intensive and take a long time to initialize. The blockchain, in its 5th year, was greater than 15GB in size and comprised 35 million transactions (by its 10th birthday, it may likely be 100 times larger). A fresh installation of a full payment verification Bitcoin wallet program can take several days (depending on bandwidth) to download the entire blockchain. Obtaining the blockchain requires connecting to other full nodes and checking to determine whose blockchain has the greatest proof-of-work total (by definition, this is assumed to be the consensus blockchain). For laptops and other home devices, running a full payment verification wallet may be merely inconvenient, but for some mobile phones, it is simply impossible. Fortunately, there is a way to make only a slight compromise in trust but in return achieve more computationally efficient transaction verification.</p>

  <p class="indent"><a id="page_192"/>SPV wallets, also called <em>thin</em> or <em>lightweight</em> wallets, cannot check whether transactions are valid; rather, they can check whether full nodes, specifically miners, have validated them. The goal of a thin wallet is to check that a transaction has been verified by miners and included in some block in the blockchain. It’s similar to having an accountant balance your checkbook instead doing it yourself. This method works reliably as long as miners, who are adding blocks to the blockchain, act honestly and allow only valid transactions to be included (which is a safe assumption as long as no individual miner is in control of more than 51 percent of the hashing power of the network). But without a copy of the blockchain, how does a thin wallet know whether or not a received transaction was included in a block? The transaction can <em>claim</em> it was included in block #24371 on the blockchain, for example, but how would you know whether the claim was true or false? One strategy would be for your wallet program to connect to several full nodes and ask to download block #24371 along with all of its other transactions. Then your wallet can comb through the transactions in that block and identify whether the transaction under investigation is present. However, if your SPV wallet program has to check several hundred transactions a day and each time you need to download an entire block (with all of its transactions), from an efficiency standpoint, this strategy is hardly better than just downloading the entire blockchain.</p>

  <p class="indent">The ingenuity of SPV rests on its ability to verify, through the magic of hash functions, that a transaction was included in a block without looking at any of the block’s transactions. To do so, SPV wallets need to download the headers of every block in the blockchain. Recall from <a href="../Text/ch08.html#ch08">Chapter 8</a> that each block in the blockchain contains two parts, a long list of transactions and a short summary of the block’s contents (the header). Importantly, the header contains a hash of all the transactions within that block, structured in such a way that any Bitcoin wallet program can easily check whether a transaction belongs to a particular block by considering its hash value. This hash structure is called a <em>Merkle tree</em>.<sup><a id="footnote_66"/><a href="../Text/footnote.html#footnote66">3</a></sup> Using this Merkle tree design, thin wallets can safely confirm that transactions they receive have been included in the blockchain without downloading the full blockchain. Downloading just the block headers requires only a fraction of the memory that’s needed for the entire blockchain; therefore, SPV wallets can easily run on your smartphone and other inexpensive mobile devices.</p>

  <p class="indent">A Bitcoin wallet app that uses SPV can also offer many but not all of the same security guarantees as a full wallet.</p>

  <p class="indent">Being able to run a resource-hungry Bitcoin wallet on a smartphone is an impressive feat of engineering. SPV wallets use advanced computer science technology but make a few compromises in flexibility. <a href="../Text/ch09.html#ch09table1">Table 9-1</a> summarizes how we’d rate SPV wallets and compare them to full wallets using a variety of factors.</p>

  <p class="tablet"><a id="page_193"/><strong><a id="ch09table1"/>Table 9-1:</strong> Rating SPV Wallets vs. Full Wallets</p>

  <table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr>
      <td class="table1" valign="top">
        <p class="table"><strong>Factor</strong></p>
      </td>

      <td class="table1" valign="top">
        <p class="table"><strong>Simplified payment verification wallets</strong></p>
      </td>

      <td class="table1" valign="top">
        <p class="table"><strong>Full payment verification wallets</strong></p>
      </td>
    </tr>

    <tr>
      <td class="table" valign="top">
        <p class="table">Speediness of initial installation and network synchronization</p>
      </td>

      <td class="table" valign="top">
        <p class="table"><img alt="image" src="../Images/f0193-01.jpg"/></p>
      </td>

      <td class="table" valign="top">
        <p class="table"><img alt="image" src="../Images/f0193-02.jpg"/></p>
      </td>
    </tr>

    <tr>
      <td class="table" valign="top">
        <p class="table">Speed of new payments (zero confirmation transaction)</p>
      </td>

      <td class="table" valign="top">
        <p class="table"><img alt="image" src="../Images/f0193-03.jpg"/></p>
      </td>

      <td class="table" valign="top">
        <p class="table"><img alt="image" src="../Images/f0193-04.jpg"/></p>
      </td>
    </tr>

    <tr>
      <td class="table" valign="top">
        <p class="table">Security for new payments</p>
      </td>

      <td class="table" valign="top">
        <p class="table"><img alt="image" src="../Images/f0193-05.jpg"/></p>
      </td>

      <td class="table" valign="top">
        <p class="table"><img alt="image" src="../Images/f0193-06.jpg"/></p>
      </td>
    </tr>

    <tr>
      <td class="table" valign="top">
        <p class="table">Security for confirmed payments</p>
      </td>

      <td class="table" valign="top">
        <p class="table"><img alt="image" src="../Images/f0193-07.jpg"/></p>
      </td>

      <td class="table" valign="top">
        <p class="table"><img alt="image" src="../Images/f0193-08.jpg"/></p>
      </td>
    </tr>

    <tr>
      <td class="table" valign="top">
        <p class="table">Overall security</p>
      </td>

      <td class="table" valign="top">
        <p class="table"><img alt="image" src="../Images/f0193-09.jpg"/></p>
      </td>

      <td class="table" valign="top">
        <p class="table"><img alt="image" src="../Images/f0193-10.jpg"/></p>
      </td>
    </tr>

    <tr>
      <td class="table" valign="top">
        <p class="table">Efficiency of storage use</p>
      </td>

      <td class="table" valign="top">
        <p class="table"><img alt="image" src="../Images/f0193-11.jpg"/></p>
      </td>

      <td class="table" valign="top">
        <p class="table"><img alt="image" src="../Images/f0193-12.jpg"/></p>
      </td>
    </tr>

    <tr>
      <td class="table" valign="top">
        <p class="table">Ability to inspect arbitrary Bitcoin addresses</p>
      </td>

      <td class="table" valign="top">
        <p class="table"><img alt="image" src="../Images/f0193-13.jpg"/></p>
      </td>

      <td class="table" valign="top">
        <p class="table"><img alt="image" src="../Images/f0193-14.jpg"/></p>
      </td>
    </tr>

    <tr>
      <td class="table" valign="top">
        <p class="table">Ability to import private keys</p>
      </td>

      <td class="table" valign="top">
        <p class="table"><img alt="image" src="../Images/f0193-15.jpg"/></p>
      </td>

      <td class="table" valign="top">
        <p class="table"><img alt="image" src="../Images/f0193-16.jpg"/></p>
      </td>
    </tr>

    <tr>
      <td class="tableb" valign="top">
        <p class="table">Effect on overall health of Bitcoin network</p>
      </td>

      <td class="tableb" valign="top">
        <p class="table"><img alt="image" src="../Images/f0193-17.jpg"/></p>
      </td>

      <td class="tableb" valign="top">
        <p class="table"><img alt="image" src="../Images/f0193-18.jpg"/></p>
      </td>
    </tr>
  </table>

  <p class="indent">Let’s examine each feature in this table in more depth:</p>

  <p class="noindentt"><strong>Speediness of initial installation and network synchronization</strong></p>

  <p class="indenta">After initial installation, SPV wallets and full wallets need to download blockchain data from other nodes on the Bitcoin network. However, an SPV wallet only has to download block headers and some data specific to Bitcoin addresses it’s responsible for maintaining. Hence, an SPV wallet can synchronize and be ready for use in less than an hour, whereas full wallets might take many hours to initialize.</p>

  <p class="noindentt"><strong>Speed of new payments</strong></p>

  <p class="indenta">For SPV wallets and full wallets, new (but still unconfirmed) transactions made on the network are quickly broadcast to all peers. If someone sends money to an address managed by your wallet, you’ll be notified within a few seconds, no matter your wallet type.</p>

  <p class="noindentt"><strong>Security for new payments</strong></p>

  <p class="indenta">A full wallet that can access a complete blockchain can quickly validate new transactions, ensuring that it is sending money from a valid and adequately funded source address. An SPV wallet cannot do this and instead relies on its network peers to ensure its transactions are legit. In theory, if someone sends you a payment and is in cahoots with one of the (supposedly) random peers your SPV wallet interacts with, this sender could send you fraudulent payments. A full wallet is immune from this type of attack.</p>

  <p class="noindentt"><a id="page_194"/><strong>Security of confirmed payments</strong></p>

  <p class="indenta">Even if a transaction is 100 percent valid, just because a transaction is broadcast doesn’t mean it will make it into the blockchain, especially if the spender creates an additional transaction that attempts to doublespend the money to another address. For this reason, it’s best to wait for three to six block confirmations on larger purchases. SPV and full wallets can validate transactions by tracking these confirmations. While a full wallet can directly prove that a transaction that has been mined into a new block is truly valid (i.e., sent from a fully funded address), an SPV wallet cannot. Therefore, if a miner includes a bad transaction in a new block, an SPV wallet could still be fooled. But it is very unlikely a miner would ever do this: Mining blocks is extremely costly, and by design a block with bad transactions would be immediately abandoned by any other full nodes on the network that take the time to perform validation on the block. As a result, a miner would never receive a reward for mining a block containing bad transactions. Hence, a confirmed payment sent to an SPV wallet is quite secure, although the security of a full wallet is still the gold standard.</p>

  <p class="noindentt"><strong>Overall security</strong></p>

  <p class="indenta">All in all, a properly programmed SPV Bitcoin wallet can offer security for your bitcoins and bitcoin payments that is quite good, though it can never match the security guarantees of a full wallet. If you’re running an SPV wallet on your smartphone and receive a payment, you can rest assured that once this payment has been confirmed by a few blocks, the balance and other information reported in the SPV wallet can be trusted to be accurate.</p>

  <p class="noindentt"><strong>Efficiency of storage use</strong></p>

  <p class="indenta">As discussed earlier, storing the blockchain of a full wallet consumes many gigabytes of disk space. However, an SPV wallet requires less than a gigabyte of storage and can run efficiently on a modern smartphone.</p>

  <p class="noindentt"><strong>Ability to inspect arbitrary Bitcoin addresses</strong></p>

  <p class="indenta">Because a full blockchain contains the balances of all Bitcoin addresses in existence, a full wallet lets you easily check balances and other details of any address, even those you don’t own (if the full wallet programmers choose to include this ability in their app). An SPV wallet is completely ignorant of all Bitcoin addresses other than those it is directly responsible for and is unable to provide such information.</p>

  <p class="noindentt"><strong>Ability to import private keys</strong></p>

  <p class="indenta">If you want to import an existing Bitcoin address (and associated private key) into a full wallet, the full wallet is able to incorporate the address and the funds linked to it within seconds. An SPV wallet has no easy way to import such a key, because it has no information about any <a id="page_195"/>historical transactions involving this address. Therefore, if you import a private key into an SPV wallet (given there is an option to do this), you can expect to wait several minutes as the wallet queries its peers for historical data involving the new address.</p>

  <p class="noindentt"><strong>Effect on overall health of Bitcoin network</strong></p>

  <p class="indenta">For the Bitcoin network to remain healthy, all the participating nodes need to cooperate in validating new transactions and blocks. As discussed previously, SPV wallets are limited in terms of validation capability. Also, SPV wallets usually don’t accept incoming TCP connections and may not participate in broadcasting third-party transactions/blocks to peers. For this reason, having a large percentage of SPV nodes on the Bitcoin network could potentially have repercussions on the overall health of the network. At this time, there is little evidence of any negative effects. But as the blockchain grows year after year, the percentage of nodes that can’t perform full validation may increase, and problems may arise. Nonetheless, improving storage capacity and faster network speeds will likely continue to allow people to cope with the growing blockchain, and definite benefits will be gained by running a full node. Hopefully, this will give many people incentives to run full nodes in the years to come to sustain the health of the network indefinitely.</p>

  <p class="indent">In short, SPV wallets have some limitations, but as long as you understand these limitations, these wallets are suitable for storing your money. However, if you are storing large amounts of Bitcoin, it may be wiser to use a full wallet, given the additional security guarantees. But for storing some spending cash on your smartphone, SPV wallets are an ideal solution.</p>

  <h3 class="h3" id="ch00leve1sec128"><strong>Other Common (and Not So Common) Bitcoin Wallet Features</strong></h3>

  <p class="noindent">In addition to features dictated by the underlying design of different wallet architectures, some Bitcoin wallets have a variety of other basic and advanced features. Some basic features you should expect to see include password protection, the ability to make backups of your private keys, QR code scanning and generation, and the ability to generate and import paper wallets.<sup><a id="footnote_67"/><a href="../Text/footnote.html#footnote67">4</a></sup> A somewhat advanced feature that is common to many Bitcoin wallets is the ability to sign messages with your private key. Recall that <a href="../Text/ch07.html#ch07">Chapter 7</a> discussed how digital signatures are used to sign Bitcoin transactions with your private key. The same digital signatures can be used to sign arbitrary messages, and many Bitcoin wallets make this an easy-to-use feature because it is useful when you need to prove you are the owner of a particular Bitcoin address (for example, if you are trying to get preapproved for a loan from a bank and it wants you to prove you have bitcoins as collateral).<sup><a id="footnote_68"/><a href="../Text/footnote.html#footnote68">5</a></sup></p>

  <p class="indent"><a id="page_196"/>Other advanced features you might see in some Bitcoin wallet programs include multi-signature transactions, in which multiple private keys are required to spend bitcoins from one Bitcoin address, and a feature called <em>coin control</em>, which provides fine-grained control over which bitcoins you use for making any specific purchase (see “An Advanced Bitcoin Wallet Feature: Coin Control” below). The number of advanced features available is too extensive to list here (and the number of features keeps increasing), but now you understand why so many Bitcoin wallet programs exist!</p>

  <div class="sidebar">
    <p class="sidebart"><strong>AN ADVANCED BITCOIN WALLET FEATURE: COIN CONTROL</strong></p>

    <p class="noindent">Imagine you have three nickels in your pocket, and you walk into the Very-Cheap-Candy-Store to buy a chocolate that costs a nickel. Your nickels are <em>fungible</em>, meaning that each of your three nickels is equally valuable and useful as payment for the chocolate. Well, at least you think they are. But perhaps you didn’t notice that each nickel has a different image engraved on the reverse side, and one of them is a 1913 Liberty Head V nickel (of which only five exist in the world and are valued at about $4 million each). When you pay for your chocolate, you use the nickel with the rare image, and the store owner recognizes it! To your alarm, he calls the police because the nickel you gave him once belonged to his friend (Warren Buffet? Richard Branson?) and it was stolen. After several hours of interrogation, you convince the police that you had no idea you were carrying a stolen nickel and explain that you’ve learned a valuable lesson about choosing your coins carefully before paying with them. This short tale is the basis for the coin control feature offered by some Bitcoin wallets.</p>

    <p class="indent">If you have received bitcoins from multiple sources to the same Bitcoin address, then the bitcoins from each transaction can be distinguished from each other (each group of bitcoins is called an <em>unspent output</em>). With a Bitcoin wallet that supports coin control, when you send a payment from your wallet, you can choose to spend only the bitcoins you received from your employer, rather than the ones your friend gave you, even if the bitcoins are all sitting at the same address.</p>

    <p class="indent">In most cases, it doesn’t matter which coins you use to pay for something. However, in some situations you are legally obligated to choose a specific funding source for an expense. For instance, in most places in the United States, a landlord is required to place a tenant’s security deposit in a separate bank account to ensure the money is not mishandled and can be spent only in appropriate ways. Someone may have similar obligations when managing Bitcoin funds for other people.</p>

    <p class="indent">Additionally, because all Bitcoin blockchain information is public, if you receive and send payments from the same pool of Bitcoin addresses that comprise a wallet, your income source and purchases can theoretically be associated surreptitiously. Through the use of coin control, you can choose payment addresses that prevent this association, giving you more privacy.</p>
  </div>

  <h3 class="h3" id="ch00leve1sec129"><a id="page_197"/><strong>Future Wallets</strong></h3>

  <p class="noindent">Future Bitcoin wallet programs may offer such features as automatic bill payments, cash flow statements, tax reporting, and tighter integration with traditional financial accounting software. Also, continued technical innovation could enable wallets to execute more complicated transactions, such as escrow transactions, or sending bitcoins to accounts that can’t be spent until some external criterion is met (such as the year being greater than 2020). No doubt we will see many of these exciting features in Bitcoin wallets in the next few years.</p>

  <h3 class="h3" id="ch00leve1sec130"><strong>Which Wallet Is Right for You?</strong></h3>

  <p class="noindent">Considering the preceding discussions, which Bitcoin wallet should you use? Well, keep in mind that you can use more than one. In fact, if two different Bitcoin wallets use <em>the same private key</em>, they can both spend the <em>same bitcoins</em>. You can have a lightweight, no-blockchain wallet on your mobile phone and a more sophisticated Bitcoin wallet on your home server, both managing one pool of bitcoins.</p>

  <p class="indent">However, in practice many users keep distinct pools of Bitcoin in separate Bitcoin wallets (i.e., each wallet has its own set of private keys), because it’s easy to move bitcoins between them.</p>

  <p class="indent">A common setup that works well for personal use is to store a small number of bitcoins in a lightweight Bitcoin wallet on your phone or laptop, which travels with you, and store your savings in a separate Bitcoin wallet that is more secure (with such features as cold storage and offline transaction signing). In short, keep a few bitcoins in your hot wallet and save the rest in your cold wallet, which is similar to carrying a wallet with spending cash in your pocket and keeping your life savings in a bank account (except Bitcoin lets <em>you</em> be <em>your own</em> secure bank).</p>

  <h3 class="h3" id="ch00leve1sec131"><strong>Additional Wallet Considerations</strong></h3>

  <p class="noindent">So far we’ve discussed Bitcoin wallets in terms of their functionality, features, and underlying design, but other considerations should be taken into account as well: Is the Bitcoin wallet open source? Has it received a security audit? Does it have a large user base? Because Bitcoin wallets manage money, it’s imperative that you be more careful when choosing a wallet than when choosing other apps, such as games or office software. Be sure to research the Bitcoin wallet program you plan to use before storing significant amounts of money in it. Check with friends or colleagues to see whether they have had good experiences with the program.</p>

  <p class="indent"><a id="page_198"/>Additionally, consider merchant integration. If you want to use bitcoins for transactions at certain stores or restaurants, check whether your Bitcoin wallet software is compatible with their point-of-sale systems. Any wallet app or program with a substantial user base will probably work well, but if you want to be the guinea pig for the latest and greatest Bitcoin wallet, expect to run into a few hiccups when you’re trying to make a purchase.</p>

  <p class="indent">Fortunately, it’s easy to try many different wallets and fund them with a few cents of bitcoins to determine how they work and what features they offer. We suggest you experiment with several before you decide on your favorite.</p>
</body></html>