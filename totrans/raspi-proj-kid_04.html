<html><head></head><body>
<h2 class="h2" id="ch04"><span epub:type="pagebreak" id="page_61"/>4<br/>THE PI CAMERA: SELFIE SNAPPER</h2>&#13;
<p class="noindent"><span class="big1">PHOTOGRAPHS HAVE BECOME A STAPLE OF OUR DAILY LIVES, THANKS TO THE WIDESPREAD INTRODUCTION OF CAMERAS INTO EVERYDAY MOBILE PHONES. IN 2016, THE NUMBER OF PHOTOS TAKEN EXCEEDED THE TOTAL NUMBER EVER TAKEN SINCE THE INVENTION OF THE CAMERA. <span epub:type="pagebreak" id="page_62"/>IN THIS CHAPTER, YOU’LL LEARN HOW TO TAKE PHOTOS WITH THE RASPBERRY PI CAMERA MODULE MADE EXCLUSIVELY FOR THE RASPBERRY PI HARDWARE.</span></p>&#13;
<p class="indent">You’ll set up and configure the Pi Camera to take photos. Next, you’ll move on to some of the more advanced features, such as adding filters, customizing photo quality, and adding a trigger button. Then you’ll learn how to use the Pi Camera to record video. As a final project, you’ll create a time-lapse video that you can use to capture a sunrise or sunset, a plant growing, a candle burning, or whatever you fancy.</p>&#13;
<h3 class="h3" id="ch04lev1sec1">WHAT YOU’LL NEED</h3>&#13;
<p class="noindent">Here are the items you’ll need for this simple introduction to the Pi Camera:</p>&#13;
<ul>&#13;
<li class="noindent">Raspberry Pi</li>&#13;
<li class="noindent">Pi Camera</li>&#13;
<li class="noindent">Pi Camera ribbon</li>&#13;
<li class="noindent">2 male-to-female jumper wires</li>&#13;
<li class="noindent">A push button (optional)</li>&#13;
<li class="noindent">Alligator clips or soldering iron and solder (to attach wires to the buttons)</li>&#13;
</ul>&#13;
<h3 class="h3" id="ch04lev1sec2">VERSIONS AND SPECIFICATIONS</h3>&#13;
<p class="noindent">A few models of the Pi Camera are available, including one designed specifically for night vision. All versions of the Raspberry Pi support the Pi Camera hardware as well as the camera ribbon used to connect your Pi to the camera. The ribbon is available in a variety of lengths so you can position the camera exactly where you need it to get the photos or video you want. This table contains the Pi Camera specifications.</p>&#13;
<table class="table1">&#13;
<colgroup>&#13;
<col style="width:33%"/>&#13;
<col style="width:33%"/>&#13;
<col style="width:34%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<td class="table-h" style="vertical-align: top;"><p class="tab_th"><strong>VERSION</strong></p></td>&#13;
<td class="table-h1" style="vertical-align: top;"><p class="tab_th"><strong>IMAGE RESOLUTION</strong></p></td>&#13;
<td class="table-h" style="vertical-align: top;"><p class="tab_th"><strong>SENSOR RESOLUTION</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table-b1" style="vertical-align: top;"><p class="tabc"><span class="purple">Camera Module v1</span></p></td>&#13;
<td class="table-b1a" style="vertical-align: top;"><p class="tabc"><span class="purple">5 megapixels</span></p></td>&#13;
<td class="table-b1" style="vertical-align: top;"><p class="tabc"><span class="purple">2592 × 1944 pixels</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table-b1" style="vertical-align: top;"><p class="tabc"><span class="purple">Camera Module v2</span></p></td>&#13;
<td class="table-b1a" style="vertical-align: top;"><p class="tabc"><span class="purple">8 megapixels</span></p></td>&#13;
<td class="table-b1" style="vertical-align: top;"><p class="tabc"><span class="purple">3280 × 2464 pixels</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table-b1" style="vertical-align: top;"><p class="tabc"><span class="purple">Pi NoIR Camera Module v2</span></p></td>&#13;
<td class="table-b1a" colspan="2" style="vertical-align: top;"><p class="tabc"><span class="purple">Used for nighttime photography</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">The official Pi Zero case comes with a smaller ribbon and a camera housing built into the top of the case’s lid, providing you with a neat, small, and portable camera.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_63"/>For this project, you’ll need either the regular Camera Module v1 or v2.</p>&#13;
<h3 class="h3" id="ch04lev1sec3">PHOTOGRAPHY WITH THE PI CAMERA</h3>&#13;
<p class="noindent">You’ll first put the camera together, and then you’ll learn to take and store photos. Next, I’ll show you how to customize your photography by altering the resolution, resizing images, using filters, and adding text. Then you’ll make the camera more user-friendly by adding a button to take the shot.</p>&#13;
<h4 class="h4" id="ch04lev2sec1">Setting Up the Hardware and Software</h4>&#13;
<p class="noindent">Let’s begin by attaching and enabling the Pi Camera hardware and then writing a small test program to check that it works correctly. Before you begin, <em>ensure that no power is connected to your Pi</em> and that your Pi is unplugged. Then follow these steps:</p>&#13;
<ol>&#13;
<li class="noindent"><strong>Attach the camera:</strong> Connect the ribbon cable to the Pi Camera (<a href="ch04.xhtml#ch04fig01">Figure 4-1</a>). Depending on where you purchased your Pi Camera, this might already be done for you. If not, gently pull the small plastic clasp on the back of the camera downward and slide the ribbon in with the blue strip facing you. Gently push the clasp up, securing the ribbon.&#13;
<p class="indent">Find the Pi Camera socket on the Pi, which is located between the HDMI socket and the audio jack. Notice that it also has a clasp similar to the clasp on the Pi Camera. Gently pull up this clasp to open it. Take the other end of the ribbon and place it into the socket, with the blue strip facing toward the audio jack and away from the HDMI socket. Gently push the clasp back down to secure the ribbon in place. Be very gentle when you’re handling the camera ribbon.</p></li>&#13;
</ol>&#13;
<div class="image"><img alt="Image" src="../images/04fig01.jpg"/></div>&#13;
<p class="figcap" id="ch04fig01"><strong>FIGURE 4-1</strong> Attaching the Pi Camera to the Raspberry Pi</p>&#13;
<ol start="2">&#13;
<li class="noindent"><span epub:type="pagebreak" id="page_64"/><strong>Install the Pi Camera software:</strong> Boot up your Pi, open the terminal window, and enter the following command:&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span> <span class="codestrong1">sudo apt update</span></pre>&#13;
<p class="indent">Once that command has run, enter this command:</p>&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span> <span class="codestrong1">sudo apt install python</span><span class="codestrong1">3-</span><span class="codestrong1">picamera</span></pre>&#13;
<p class="indent">The Pi Camera software comes preinstalled with the operating system image and includes a Python package that interfaces with the camera. In the future, you might need to reinstall or update the package when newer versions are released, which you can do using the following commands:</p>&#13;
<pre>sudo apt update&#13;
sudo apt upgrade</pre></li>&#13;
<li class="noindent"><strong>Enable the Pi Camera:</strong> By default, the camera is set to <em>off</em>. You can’t use it until you configure it to turn on. To do this, return to the terminal window and enter the following command to open the Configuration tool (<a href="ch04.xhtml#ch04fig02">Figure 4-2</a>):&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span> <span class="codestrong1">sudo raspi-config</span></pre>&#13;
<div class="image"><img alt="Image" src="../images/04fig02.jpg"/></div>&#13;
<p class="figcap" id="ch04fig02"><strong>FIGURE 4-2</strong> Enabling the Pi Camera</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_65"/>In the Configuration tool, select <strong>Interfacing Options</strong>. Then select the option to enable the connection to the Pi Camera (<a href="ch04.xhtml#ch04fig03">Figure 4-3</a>). Use the arrow keys to select <strong>Exit</strong> and press <span class="small">ENTER</span>. You’ll be prompted to restart the Raspberry Pi before the Pi Camera is enabled. Select <strong>Yes</strong> to restart. Now you can test that the camera is connected and working correctly.</p></li>&#13;
</ol>&#13;
<div class="image"><img alt="Image" src="../images/04fig03.jpg"/></div>&#13;
<p class="figcap" id="ch04fig03"><strong>FIGURE 4-3</strong> Selecting the Pi Camera option</p>&#13;
<h5 class="h5">Testing the Pi Camera</h5>&#13;
<p class="noindent">To test the camera, you’ll run the preview feature. Open a new Python file and enter the program in <a href="ch04.xhtml#ch04ex01">Listing 4-1</a>. This simple code triggers the camera to display on your monitor for 10 seconds whatever the camera captures. By using this code, you’ll test that the camera is working correctly.</p>&#13;
<pre><span class="ent">❶</span> <span class="codeorg">from</span> picamera <span class="codeorg">import</span> PiCamera&#13;
<span class="ent">❷</span> <span class="codeorg">from</span> time <span class="codeorg">import</span> sleep&#13;
<span class="ent">❸</span> camera = PiCamera()&#13;
<span class="ent">❹</span> camera.start_preview()&#13;
<span class="ent">❺</span> sleep(10)&#13;
<span class="ent">❻</span> camera.stop_preview()</pre>&#13;
<p class="caption" id="ch04ex01"><strong>LISTING 4-1</strong> Testing the camera</p>&#13;
<p class="indent">First, you import the <span class="literal">PiCamera</span> class from the <span class="literal">picamera</span> library <span class="ent">❶</span>. This provides code that lets you control the camera. Next, you import the <span class="literal">sleep</span><span class="literal">(</span><span class="literal">)</span> function <span class="ent">❷</span> so you can add the 10-second delay to make the image display on your screen for 10 seconds.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_66"/>Then you create a variable called <span class="literal">camera</span> to store the <span class="literal">PiCamera</span><span class="literal">(</span><span class="literal">)</span> instruction <span class="ent">❸</span>. This lets you call the Pi Camera and control it without having to write out <span class="literal">PiCamera</span><span class="literal">(</span><span class="literal">)</span> each time. <em>Variables</em> are placeholders representing a location in the Raspberry Pi’s memory that stores content. For example, if you make a <span class="literal">name</span> variable such as <span class="literal">name = "Dan</span> <span class="literal">Aldred</span><span class="literal">"</span>, whenever you use <span class="literal">name</span> in your code, Python will use the content of <span class="literal">name</span> and insert <span class="literal">Dan</span> <span class="literal">Aldred</span> into the program instead of <span class="literal">name</span>.</p>&#13;
<p class="indent">Next, you trigger the preview by telling the camera to start <span class="ent">❹</span> and add the 10-second delay <span class="ent">❺</span>. The last step stops the preview <span class="ent">❻</span>, turning off the camera.</p>&#13;
<p class="indent">To run the program, press <strong>F5</strong> on your keyboard; you’ll be asked to save the file. Name and save your program; then it will execute.</p>&#13;
<p class="indent">If you can see the preview on your screen, your hardware and software are working. If you don’t see the preview, the camera doesn’t work: check that the cable is attached to the camera correctly and connected to your Raspberry Pi. Then check that the camera is enabled in the Configuration tool.</p>&#13;
<p class="indent">The program will stop after 10 seconds. But if you want to end the program sooner, close the Python window by clicking the <strong>X</strong> at the top right of the window.</p>&#13;
<h5 class="h5">Taking a Selfie</h5>&#13;
<p class="noindent">Once your camera is working, you can create a program to take your first picture, a selfie (<a href="ch04.xhtml#ch04fig04">Figure 4-4</a>).</p>&#13;
<div class="image"><img alt="Image" src="../images/04fig04.jpg"/></div>&#13;
<p class="figcap" id="ch04fig04"><strong>FIGURE 4-4</strong> Take that selfie!</p>&#13;
<p class="indent">Open a new text editor window, save the file as <em>selfie.py</em>, and then enter the program in <a href="ch04.xhtml#ch04ex02">Listing 4-2</a>. This program starts a preview for 5 seconds, allowing you time to get in front of the camera, fix your <span epub:type="pagebreak" id="page_67"/>hair, and practice your pose before the camera automatically takes the picture.</p>&#13;
<pre>   <span class="codeorg">from</span> picamera <span class="codeorg">import</span> PiCamera&#13;
   <span class="codeorg">from</span> time <span class="codeorg">import</span> sleep&#13;
   camera = PiCamera()&#13;
   camera.start_preview()&#13;
   sleep(5)&#13;
<span class="ent">❶</span> camera.capture(<span class="codegreen1">'/home/pi/Desktop/selfie.jpg'</span>)&#13;
   camera.stop_preview()</pre>&#13;
<p class="caption" id="ch04ex02"><strong>LISTING 4-2</strong> Taking a selfie</p>&#13;
<p class="indent">Again, you import the <span class="literal">P</span><span class="literal">i</span><span class="literal">C</span><span class="literal">amera</span> class and <span class="literal">sleep</span><span class="literal">(</span><span class="literal">)</span> function, and then you use the <span class="literal">camera</span> variable to store the <span class="literal">PiCamera</span><span class="literal">()</span> command. Then you start a preview and add a 5-second delay (or longer if you like). You trigger the camera to capture the image <span class="ent">❶</span> and save it to the desktop so it’s easy to locate. The file is saved and named <em>selfie.jpg</em>.</p>&#13;
<p class="indent">The preview stops, and the program ends. Save and run the program, snap a selfie, and then return to your desktop and open the image to check out your photo.</p>&#13;
<h5 class="h5">Changing the File Location Where the Image Is Saved</h5>&#13;
<p class="noindent">If you take several selfies at once, they’ll soon clutter your desktop space. To keep your selfies organized, it’s best to create a new folder to neatly store and save all your images.</p>&#13;
<p class="indent">To create a new folder, open the terminal and enter this command:</p>&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span> <span class="codestrong1">mkdir my_photos</span></pre>&#13;
<p class="indent">The command <span class="literal">mkdir</span>, which is short for <em>make a directory</em>, creates a new folder in your home directory called <em>my_photos</em>. Now go back to your <em>selfie.py</em> file and edit the line <span class="literal">camera.capture('/home/pi/</span><span class="codeitalic">Desktop</span><span class="literal">/selfie.jpg')</span> <span class="ent">❶</span>, replacing the word <em>Desktop</em> with the name of your new folder. Unless you’ve used a different folder name, the new line should read as follows: <span class="literal">camera.capture</span><span class="literal">(</span><span class="literal">'/home/pi/</span><span class="literal">my_photos</span><span class="literal">/selfie.jpg')</span>.</p>&#13;
<h5 class="h5">Saving Each Image as a New File</h5>&#13;
<p class="noindent">Notice that each time you take a new photo and save the image, the program overwrites the previous image file. This isn’t a very useful feature if you want to keep all your photos. This happens because your program saves each image by using the same filename. You can solve this problem by adding a date stamp to the image filename.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_68"/><em>Date stamps</em> contain the date and time information indicating when the image was taken. The information is retrieved from the Raspberry Pi’s clock and, because time always moves forward, each filename is always unique. Alter the <em>selfie.py</em> file to match the program in <a href="ch04.xhtml#ch04ex03">Listing 4-3</a>.</p>&#13;
<pre>  <span class="codeorg">from</span> picamera <span class="codeorg">import</span> PiCamera&#13;
  <span class="codeorg">from</span> time <span class="codeorg">import</span> sleep&#13;
<span class="ent">❶</span> <span class="codeorg">import</span> datetime&#13;
  camera = PiCamera()&#13;
  <span class="codeorg">while True</span>:&#13;
   <span class="ent">❷</span> current_time = datetime.datetime.now()&#13;
      camera.start_preview()&#13;
      sleep(1)&#13;
   <span class="ent">❸</span> camera.capture(<span class="codegreen1">'/home/pi/my_photos/'</span>+ <span class="codepurple">str</span>(current_time) +&#13;
     <span class="codegreen1">'photo.jpg'</span>)&#13;
     camera.stop_preview()&#13;
     sleep(10)</pre>&#13;
<p class="caption" id="ch04ex03"><strong>LISTING 4-3</strong> Saving all the images</p>&#13;
<p class="indent">Most of this code is similar to the previous selfie program in <a href="ch04.xhtml#ch04ex02">Listing 4-2</a>. The code you need to change is at <span class="ent">❶</span>, <span class="ent">❷</span>, and <span class="ent">❸</span>.</p>&#13;
<p class="indent">You import the <span class="literal">datetime</span> module <span class="ent">❶</span> to pull the current date and time from the clock. You create a loop that makes the Pi Camera take a photo every 10 seconds. This will give you enough time to check the preview and then pose for your next photo. Then you create a variable called <span class="literal">current_time</span> <span class="ent">❷</span> and use <span class="literal">datetime.datetime.now</span><span class="literal">(</span><span class="literal">)</span> to grab the current date and time and store the result in the variable.</p>&#13;
<p class="indent">The final part of the code applies the date stamp value as the image’s filename <span class="ent">❸</span>. You use the <span class="literal">camera.capture</span> code from <a href="ch04.xhtml#ch04ex02">Listing 4-2</a> followed by the file location to store the image. But this time, you add the value stored in the <span class="literal">current_time</span> variable. Because the date stamp is numerical, you need to convert it to a string before using it as a filename. This code will now save all image names with a unique date stamp!</p>&#13;
<h4 class="h4" id="ch04lev2sec2">Customizing Your Images</h4>&#13;
<p class="noindent">Now that you’ve set up the Pi Camera’s hardware and software, you’re ready to learn about customizing your images. Let’s start by reviewing some image terminology.</p>&#13;
<p class="indent">Images are made up of picture elements more commonly referred to as <em>pixels</em>. These tiny dots are turned on or off in a pattern that creates the overall image. The <em>image quality</em> is determined by the number of pixels the image contains compared to its size: consider the difference between 1000 pixels on a small 1 × 1–inch square and <span epub:type="pagebreak" id="page_69"/>1000 pixels on a large sheet of ledger paper. The quality of the image on the ledger sheet would be lower, even though the pixel number is the same.</p>&#13;
<p class="indent">An image’s size and number of pixels is referred to as its <em>resolution</em>. For example, an image with a resolution of 100 × 100 contains 100 rows, each containing 100 pixels, for a total of 10,000 pixels. A standard, true HD TV resolution is 1080 × 1080, meaning the screen contains 1,166,400 pixels. If you were watching a program that contained only a million pixels on this set, the picture would be 166,400 pixels short of the full potential of the TV screen, and the image quality would decrease. But if you were watching the same program on a tablet device, you wouldn’t notice a decrease in image quality because the tablet is smaller and the pixels would be less spread out.</p>&#13;
<p class="indent">Next, you’ll learn how to control the quality of your pictures by changing the resolution. Later in this section, you’ll further customize your images by resizing, using filters, and adding text.</p>&#13;
<h5 class="h5">Changing the Resolution</h5>&#13;
<p class="noindent">You can alter the resolution of the Pi Camera by using the code <span class="literal">camera.resolution = (500 x 500)</span>, which sets the image to a height and width of 500 pixels. This is useful because the Pi Camera v2 has a resolution of 3280 × 2464 pixels, meaning that every image you take contains 8,081,920 pixels. The adjusted image of 500 × 500 will now contain only 250,000 pixels, so the file will be smaller and consume less storage space.</p>&#13;
<p class="indent">Remember that different resolutions are more suitable for different screen sizes. Adjusting the resolution ensures that you save storage space on your Raspberry Pi. You might not always need an image that contains 8,081,920 pixels!</p>&#13;
<p class="indent">Open your <em>selfie.py</em> file and edit it to look like the program in <a href="ch04.xhtml#ch04ex04">Listing 4-4</a> to try out different camera resolutions and find one suitable for your screen.</p>&#13;
<pre>   <span class="codeorg">from</span> picamera <span class="codeorg">import</span> PiCamera&#13;
   <span class="codeorg">from</span> time <span class="codeorg">import</span> sleep&#13;
   <span class="codeorg">import</span> datetime&#13;
   camera = PiCamera()&#13;
   current_time = datetime.datetime.now()&#13;
<span class="ent">❶</span> camera.resolution = (1024, 768)&#13;
   camera.start_preview()&#13;
   sleep(2)&#13;
   camera.capture(<span class="codegreen1">'/home/pi/my_photos'</span>+ <span class="codepurple">str</span>(current_time) + <span class="codegreen1">'photo.jpg'</span>)&#13;
   camera.stop_preview()</pre>&#13;
<p class="caption" id="ch04ex04"><strong>LISTING 4-4</strong> Changing the resolution of the image</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_70"/>The program sets the camera resolution to 1024 × 768 <span class="ent">❶</span>, takes a single photo, and then names and saves the file as the current date and time when the photo was taken. This size is the standard resolution setting for a 17-inch screen; each image will contain only 786,432 pixels, compared to the maximum resolution of 8,081,920 pixels. This image has approximately nine times fewer pixels than the full capability of the Pi Camera v2. Try different resolution settings by adjusting the values on line <span class="ent">❶</span>.</p>&#13;
<h5 class="h5">Resizing an Image</h5>&#13;
<p class="noindent">Resizing an image is optional, but it’s a good skill to learn. If you size the image inappropriately for the number of pixels it contains, the pixels will start to crowd each other out and overlap, distorting the image. A lower resolution is useful for small screens, and a higher resolution is suitable for large screens. 4K screens require 8,294,400 pixels to fill the screen and look clear. If you had half these pixels, the pixels would space out and lower the image quality. In order to keep a similar image quality, you would need to reduce the size of the image and display it on a smaller screen.</p>&#13;
<p class="indent">One workaround is to resize the image after you take the photograph. Adjusting resolution and resizing images are particularly useful skills for projects for which you’re capturing images over a long period of time, like the nature box project in <a href="ch11.xhtml#ch11">Chapter 11</a>.</p>&#13;
<p class="indent">Open your program from <a href="ch04.xhtml#ch04ex04">Listing 4-4</a> and alter it to look like <a href="ch04.xhtml#ch04ex05">Listing 4-5</a>. This program resizes the image to be more appropriate for the resolution.</p>&#13;
<pre>  <span class="codeorg">from</span> picamera <span class="codeorg">import</span> PiCamera&#13;
  <span class="codeorg">from</span> time import sleep&#13;
  import datetime&#13;
  camera = PiCamera()&#13;
  current_time = datetime.datetime.now()&#13;
<span class="ent">❶</span> <span class="codered"># camera.resolution = (1024, 768)</span>&#13;
  camera.start_preview()&#13;
  sleep(2)&#13;
  camera.capture(<span class="codegreen1">'/home/pi/my_photos/'</span> + <span class="codepurple">str</span>(current_time) + <span class="codegreen1">'.jpg'</span>,&#13;
  resize=(600, 600))&#13;
  camera.stop_preview()</pre>&#13;
<p class="caption" id="ch04ex05"><strong>LISTING 4-5</strong> Changing the size of the image</p>&#13;
<p class="indent">You make the line <span class="literal">camera.resolution</span> at <span class="ent">❶</span> into a comment, which stops the line of coding from running. After you capture the image, you add the code to resize the image: <span class="literal">resize=(600, 600)</span>.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_71"/>Try altering the values within the parentheses to suit your screen size. Generally, the smaller the screen is, the lower the resize values are; the larger the screen is, the larger the values are. Experiment with the values to find a balance between the quality of the image and the amount of storage (memory) required to save each image. Remember that the higher the image quality is, the more space is required to store it; the lower the quality is, the less space is required to store it.</p>&#13;
<h5 class="h5">Using Filters</h5>&#13;
<p class="noindent"><em>Filters</em> instantly change a picture’s style. Most likely, you’ve used filters like the classic sepia, beauty shot, and retro filters on camera apps. The Pi Camera also boasts a range of easy-to-use filters (<a href="ch04.xhtml#ch04fig05">Figure 4-5</a>). To apply a filter, you use the code <span class="literal">camera.image_effect</span> and then add the name of the filter.</p>&#13;
<div class="image"><img alt="Image" src="../images/04fig05.jpg"/></div>&#13;
<p class="figcap" id="ch04fig05"><strong>FIGURE 4-5</strong> Applying filters: emboss, watercolor, and negative</p>&#13;
<p class="indent">Let’s start with the <em>emboss</em> filter, which makes the image appear raised, similar to the design you find on coins. Open your program code from <a href="ch04.xhtml#ch04ex05">Listing 4-5</a>, and add the line at <span class="ent">❶</span> in <a href="ch04.xhtml#ch04ex06">Listing 4-6</a>.</p>&#13;
<pre>   <span class="codeorg">from</span> picamera <span class="codeorg">import</span> PiCamera&#13;
   <span class="codeorg">from</span> time <span class="codeorg">import</span> sleep&#13;
   <span class="codeorg">import</span> datetime&#13;
   camera = PiCamera()&#13;
   current_time = datetime.datetime.now()&#13;
   camera.resolution = (1024, 768)&#13;
   camera.start_preview()&#13;
<span class="ent">❶</span> camera.image_effect = <span class="codegreen1">'emboss'</span>&#13;
   sleep(2)&#13;
<span class="ent">❷</span> camera.capture(<span class="codegreen1">'/home/pi/my_photos/'</span> + <span class="codepurple">str</span>(current_time) + <span class="codegreen1">'.jpg'</span>,&#13;
   resize=(600, 600))&#13;
   camera.stop_preview()</pre>&#13;
<p class="caption" id="ch04ex06"><strong>LISTING 4-6</strong> Adding a filter</p>&#13;
<p class="indent">This program saves each file as <em>photo.jpg</em>, so each time you run it, the previous image file will be overwritten with the new one. If you want to keep each copy of your filtered image, change the filename that you use to save the image at <span class="ent">❷</span>.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_72"/>You also could use other filters. Try each of the following filters by replacing <span class="literal">'</span><span class="literal">emboss</span><span class="literal">'</span> at <span class="ent">❶</span> with a keyword listed here:</p>&#13;
<ul>&#13;
<li class="noindent"><span class="literal">'</span><span class="literal">watercolor'</span></li>&#13;
<li class="noindent"><span class="literal">'</span><span class="literal">cartoon'</span></li>&#13;
<li class="noindent"><span class="literal">'</span><span class="literal">negative'</span></li>&#13;
<li class="noindent"><span class="literal">'</span><span class="literal">sketch'</span></li>&#13;
<li class="noindent"><span class="literal">'</span><span class="literal">denoise</span><span class="literal">'</span></li>&#13;
<li class="noindent"><span class="literal">'</span><span class="literal">oilpaint</span><span class="literal">'</span></li>&#13;
<li class="noindent"><span class="literal">'</span><span class="literal">hatch'</span></li>&#13;
<li class="noindent"><span class="literal">'</span><span class="literal">pastel'</span></li>&#13;
<li class="noindent"><span class="literal">'</span><span class="literal">film'</span></li>&#13;
<li class="noindent"><span class="literal">'</span><span class="literal">blur'</span></li>&#13;
<li class="noindent"><span class="literal">'</span><span class="literal">colorswap</span><span class="literal">'</span></li>&#13;
<li class="noindent"><span class="literal">'</span><span class="literal">washedout</span><span class="literal">'</span></li>&#13;
<li class="noindent"><span class="literal">'</span><span class="literal">posterise</span><span class="literal">'</span></li>&#13;
</ul>&#13;
<h5 class="h5">Adding Text to an Image</h5>&#13;
<p class="noindent">Let’s look at how to overlay text on your images to add a message, a title, or just a reminder. You can also combine this feature with the date stamp so the date and time the photo was taken are included in the final image.</p>&#13;
<p class="indent">Return to your code from <a href="ch04.xhtml#ch04ex05">Listing 4-5</a> and add the line in bold in <a href="ch04.xhtml#ch04ex07">Listing 4-7</a>.</p>&#13;
<pre>   <span class="codeorg">from</span> picamera <span class="codeorg">import</span> PiCamera&#13;
   <span class="codeorg">from</span> time <span class="codeorg">import</span> sleep&#13;
   <span class="codeorg">import</span> datetime&#13;
   camera = PiCamera()&#13;
   current_time = datetime.datetime.now()&#13;
   camera.resolution = (1024, 768)&#13;
   camera.start_preview()&#13;
<span class="ent">❶</span> camera.annotate_text = <span class="codegreen1">'</span><span class="codegreen2">THIS IS A TEXT OVERLAY!</span><span class="codegreen1">'</span>&#13;
   sleep(2)&#13;
   camera.capture(<span class="codegreen1">'/home/pi/my_photos/'</span> + <span class="codepurple">str</span>(current_time) + <span class="codegreen1">'.jpg'</span>,&#13;
   resize=(600, 600))&#13;
   camera.stop_preview()</pre>&#13;
<p class="caption" id="ch04ex07"><strong>LISTING 4-7</strong> Adding a text overlay</p>&#13;
<p class="indent">The line of code to add text is <span class="literal">camera.annotate_text</span>; you just need to replace <span class="codeitalic">THIS IS A TEXT OVERLAY</span> at <span class="ent">❶</span> with your own message, and then save and run the program (<a href="ch04.xhtml#ch04fig06">Figure 4-6</a>).</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_73"/><img alt="Image" src="../images/04fig06.jpg"/></div>&#13;
<p class="figcap" id="ch04fig06"><strong>FIGURE 4-6</strong> Adding a text overlay to an image</p>&#13;
<h4 class="h4" id="ch04lev2sec3">Triggering the Camera with a Button</h4>&#13;
<p class="noindent">You’ve written a program to take photos, but you need to run the program each time you want to take a photo. If you want to take 100 photos, you’ll need to run the program 100 times. Let’s make the camera more camera-like by hooking up a simple button that, when pressed, triggers the camera to take a photo.</p>&#13;
<h5 class="h5">Wiring the Button</h5>&#13;
<p class="noindent">You’ll use a push button and the two jumper wires to connect it. You can wire the button in various ways depending on what type of button you have:</p>&#13;
<ul>&#13;
<li class="noindent">Use wires with alligator clips and attach the clips to the button’s legs.</li>&#13;
<li class="noindent">Tape the wire and legs together, making sure they’re touching.</li>&#13;
<li class="noindent">Slide wires onto the legs of the button.</li>&#13;
<li class="noindent">Solder the wires to the legs of the button.</li>&#13;
</ul>&#13;
<p class="indent">Soldering is a more permanent but trickier option. This technique requires you to superheat <em>solder</em> (typically, a metal alloy made of lead and tin) until it turns to liquid. You then use the liquid to join the wire <span epub:type="pagebreak" id="page_74"/>and the arm. When you remove the heat, the solder hardens again, fusing the wires together. You need special equipment to solder, including a soldering iron and a safe surface to solder on. If you’ve never soldered before, check out the Raspberry Pi Foundation’s excellent guide at <em><a href="https://projects.raspberrypi.org/en/projects/getting-started-with-soldering">https://projects.raspberrypi.org/en/projects/getting-started-with-soldering</a></em>/.</p>&#13;
<p class="indent">If you choose the soldering method, carefully solder each male end of the jumper wire onto one of the arms. Once the solder has cooled down and set, attach the female end of one of the wires to GPIO pin 2. Attach the female end of the other wire to one of the ground pins (<a href="ch04.xhtml#ch04fig07">Figure 4-7</a>). It doesn’t matter which wire attaches to pin 2.</p>&#13;
<div class="image"><img alt="Image" src="../images/04fig07.jpg"/></div>&#13;
<p class="figcap" id="ch04fig07"><strong>FIGURE 4-7</strong> Wiring the button</p>&#13;
<div class="note">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>If you don’t have a button, you can still create a trigger by attaching one end of the wires to the required GPIO pins and then touching the other end of the two wires together. This makes a circuit that acts like a button press and triggers the Pi Camera to take a photo.</em></p>&#13;
</div>&#13;
<h5 class="h5">Coding the Button</h5>&#13;
<p class="noindent">To code the button, return to your Python editor and create a new file. Then enter the program in <a href="ch04.xhtml#ch04ex08">Listing 4-8</a> and save this file as <em>selfie_snapper.py</em>. This program uses <span class="literal">gpiozero</span> to set up the button and trigger the Pi Camera to take a photo each time the button is pressed (or the wires touch each other). This is a library of code that makes it easy to interact with your Raspberry Pi hardware and the GPIO pins. You can read more about it here: <em><a href="https://gpiozero.readthedocs.io/en/stable/index.html">https://gpiozero.readthedocs.io/en/stable/index.html</a></em>.</p>&#13;
<pre><span epub:type="pagebreak" id="page_75"/><span class="ent">❶</span> <span class="codeorg">from</span> gpiozero <span class="codeorg">import</span> Button&#13;
   <span class="codeorg">from</span> picamera <span class="codeorg">import</span> PiCamera&#13;
   <span class="codeorg">import</span> datetime&#13;
<span class="ent">❷</span> <span class="codeorg">from</span> signal <span class="codeorg">import</span> pause&#13;
<span class="ent">❸</span> button = Button(2)&#13;
   camera = PiCamera()&#13;
<span class="ent">❹</span> <span class="codeorg">def</span> <span class="codeblue">capture</span>():&#13;
       current_time = datetime.datetime.now()&#13;
       camera.capture(<span class="codegreen1">"/home/pi/my_photos/%s.jpg"</span> % current_time)&#13;
       <span class="codepurple">print</span> (<span class="codegreen1">"Picture taken"</span>)&#13;
<span class="ent">❺</span> button.when_pressed = capture&#13;
<span class="ent">❻</span> pause()</pre>&#13;
<p class="caption" id="ch04ex08"><strong>LISTING 4-8</strong> Coding the trigger</p>&#13;
<p class="indent">You import the <span class="literal">Button</span> class from the <span class="literal">gpiozero</span> library <span class="ent">❶</span>, which provides commands to control the button. You then import the usual <span class="literal">P</span><span class="literal">i</span><span class="literal">C</span><span class="literal">amera</span> class and <span class="literal">datetime</span> module that you use to take photos and create unique filenames. The code at <span class="ent">❷</span> is used to keep the program looping and checking for the button being pressed.</p>&#13;
<p class="indent">Next, you tell the program which GPIO pin the button is connected to <span class="ent">❸</span>, which is GPIO pin 2.</p>&#13;
<p class="indent">Then you start the main part of the program, which begins with the <span class="literal">capture</span><span class="literal">(</span><span class="literal">)</span> function. Here, you’re making your own function! You create a new custom function when a function that does what you want isn’t available. The <span class="literal">capture</span><span class="literal">(</span><span class="literal">)</span> function will capture, name, and save the image <span class="ent">❹</span>.</p>&#13;
<p class="indent">To create a function, you use the <span class="literal">def</span> command, which means <em>define</em>, and then name the function. In this case, you call the function <span class="literal">capture</span>. You then need to add parentheses and a colon. <em>Don’t forget the colon</em>; it tells Python that the next few indented lines are part of the function, and the function won’t work without it.</p>&#13;
<p class="indent">On the next few lines, you list the function’s instructions. You need to indent these instructions by four spaces so Python knows they belong to the function. In this example, the instructions take a current date and time reading, save this data, capture the image, and save it to your folder. Because this reading returns the date and time, you can take photos the next day without overwriting the previous day’s photos. The filename will be combined with the date–time data to make sure it’s unique each time you take an image.</p>&#13;
<p class="indent">But you must convert the data to a string to use it with the filename, because date data has a value and can’t be combined with the <em>.jpg</em> extension. To do this, you use the code <span class="literal">/%s.jpg" %</span> <span class="literal">current_time</span>. The <span class="literal">%</span> symbol holds the <span class="literal">current_time</span> value, and the <span class="literal">s</span> converts the data to a string.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_76"/>The final part of the function prints a short message to let you know when a photo has been taken. Because that’s the last instruction in the <span class="literal">capture(</span><span class="literal">)</span> function, you don’t indent the following line so Python knows it isn’t part of <span class="literal">capture()</span>.</p>&#13;
<p class="indent">You’ve built the function, but to take a photo, you need to <em>call</em> the function in your code. You use the simple code <span class="literal">button.when_pressed = capture</span> <span class="ent">❺</span> from the <span class="literal">gpiozero</span> library to assign the function to the button so the button takes the photo.</p>&#13;
<p class="indent">Finally, you use the <span class="literal">pause(</span><span class="literal">)</span> command to ensure that the program runs again <span class="ent">❻</span>, and you can take another picture.</p>&#13;
<p class="indent">Save your program and press <strong>F5</strong> to run it. Now, each time you press the button, it will take a new photo and save the image with a unique filename. Well done! You’ve built your own camera.</p>&#13;
<h3 class="h3" id="ch04lev1sec4">VIDEOS WITH THE PI CAMERA</h3>&#13;
<p class="noindent">The code for taking videos using the Pi Camera is similar to the code for taking photos, and you can apply the same filters and settings that you learned previously.</p>&#13;
<h4 class="h4" id="ch04lev2sec4">Making a Video</h4>&#13;
<p class="noindent">To create a video, open a new Python file, name it <em>video.py</em>, and save it to your <em>my_photos</em> folder. Enter the program in <a href="ch04.xhtml#ch04ex09">Listing 4-9</a> to record a short clip.</p>&#13;
<pre><span class="ent">❶</span> <span class="codeorg">import</span> picamera&#13;
<span class="ent">❷</span> camera = picamera.PiCamera()&#13;
<span class="ent">❸</span> camera.resolution = (640, 480)&#13;
<span class="ent">❹</span> camera.start_recording(<span class="codegreen1">"</span><span class="codegreen1">/ho</span><span class="codegreen1">me/pi/my_photos/video_test.h264"</span>)&#13;
<span class="ent">❺</span> camera.wait_recording(10)&#13;
<span class="ent">❻</span> camera.stop_recording()</pre>&#13;
<p class="caption" id="ch04ex09"><strong>LISTING 4-9</strong> The video-recording code</p>&#13;
<p class="indent">You import all of the modules of the <span class="literal">picamera</span> library <span class="ent">❶</span> and assign the Pi Camera to the <span class="literal">camera</span> variable <span class="ent">❷</span>.</p>&#13;
<p class="indent">Optionally, you can then set the resolution of the video <span class="ent">❸</span>. Remember that a high resolution increases the overall quality of the video but also creates a larger file that demands more storage space.</p>&#13;
<p class="indent">Then you add the code to start the video recording <span class="ent">❹</span> and provide the folder location you want to save the video file to. You need to include a filename (in this case <em>video_test</em>) and the file format for saving the video; the format I’ve used here is <span class="literal">.h264</span>, which is a good format for high-definition video.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_77"/>Next, you add the length of time you want the video to record <span class="ent">❺</span>. Recording time is measured in seconds, so to record for 1 minute, you change 10 to 60; to record for 5 minutes, change the value to 300 seconds.</p>&#13;
<p class="indent">At <span class="ent">❻</span>, you stop the video recording, which stops the camera and saves the video file.</p>&#13;
<p class="indent">Run the program and take some video! Start with a short time to test the program, and then adjust the number of seconds on line <span class="ent">❺</span> to change the recording length. Press <strong>F5</strong> to save your recorded video.</p>&#13;
<h4 class="h4" id="ch04lev2sec5">Playing the Video</h4>&#13;
<p class="noindent">Once you have a recording, navigate to the folder where you saved your video by opening the terminal and entering the following command:</p>&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span>  <span class="codestrong1">cd my_photo</span></pre>&#13;
<p class="indent">Press <span class="small">ENTER</span> to go to the folder. Once you’re inside the media folder, you can see all the files in that folder by entering this command:</p>&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span>  <span class="codestrong1">ls</span></pre>&#13;
<p class="indent">You should see your <em>video_test</em> file. To play the video, enter the following command:</p>&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span>  <span class="codestrong1">omxplayer video_test.h264</span></pre>&#13;
<p class="indent">This command opens the OMXPlayer and displays your video. The OMXPlayer uses the hardware of the Raspberry Pi to play back many popular audio and video file formats. Remember that size and quality will depend on the resolution that you set and recorded at.</p>&#13;
<h4 class="h4" id="ch04lev2sec6">Playing the Video on a Computer or Other Device</h4>&#13;
<p class="noindent">You might want to share your video masterpiece with your friends and family or even upload it to a social media account. But in its current format, the video file won’t play on other devices (which won’t have OMXPlayer installed) unless they have a specific video <em>codec</em>, a program that reads a wide range of video file formats. So, you’ll convert the video file into the more common <em>.mp4</em> format, which will <span epub:type="pagebreak" id="page_78"/>play on most tablets, phones, and smart TVs. Return to the terminal window and enter this command to install the converter:</p>&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span>  <span class="codestrong1">sudo apt install ffmpeg</span></pre>&#13;
<p class="indent">Then enter this command to convert the video file to the <em>.mp4</em> format:</p>&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span>  <span class="codestrong1">ffmpeg -i video_test.h264 -codec copy video_test.mp4</span></pre>&#13;
<p class="indent">Once the conversion has completed, copy the file onto a memory stick, and you’re ready to play, edit, and share your video!</p>&#13;
<div class="note">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>VLC media player is a free video player that works across most devices and operating systems. On your Raspberry Pi, you can find VLC media player under Start</em> ▶ <em>Sound and Video. If you’re viewing your video on another device, you can download and access VLC media player from</em> <a href="https://www.videolan.org/">https://www.videolan.org/</a> and play the video without having to convert it.</p>&#13;
</div>&#13;
<h4 class="h4" id="ch04lev2sec7">Creating a Time-Lapse Video</h4>&#13;
<p class="noindent">A <em>time-lapse video</em> is crafted from several hundred individual photos that, when combined, create a kind of animation effect. For example, you could take a time-lapse video of a candle burning over several hours by taking a photo every few minutes, and the video would show the burning process in just a few seconds.</p>&#13;
<p class="indent">The more photos you take, the smoother the video will appear. But if you take too many images, you’ll lose the overall impact of the video.</p>&#13;
<p class="indent">This project has two main phases: taking the photos and piecing together the time-lapse video. Let’s work through the steps to set up the project.</p>&#13;
<p class="indent">When you run the time-lapse program, it will potentially capture several hundred photos. So, before you write the program, you need to create a new folder for storing the images, to make sure they’re in one place and don’t get mixed up with other images from previous shoots. Return to the terminal and enter this command to return to the <em>home</em> folder:</p>&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span> <span class="codestrong1">cd</span></pre>&#13;
<p class="indent">Then create a folder called <em>my_timelapse</em> by using this command:</p>&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span> <span class="codestrong1">mkdir my_timelapse</span></pre>&#13;
<p class="indent">If you rename this folder, remember to change the file location and replace it with your folder name.</p>&#13;
<h5 class="h5"><span epub:type="pagebreak" id="page_79"/>Coding the Time-Lapse Video Taker</h5>&#13;
<p class="noindent">The <span class="literal">picamera</span> library provides all the code you need to easily capture a time-lapse video. When you execute the program, it will run continuously until you stop it. You’ll tell the program how often to take a photo, and it will keep taking pictures. Open a new Python file, save it as <em>time_lapse.py</em>, and add the program in <a href="ch04.xhtml#ch04ex10">Listing 4-10</a>.</p>&#13;
<pre>   <span class="codeorg">from</span> time <span class="codeorg">import</span> sleep&#13;
   <span class="codeorg">from</span> picamera <span class="codeorg">import</span> PiCamera&#13;
   camera = PiCamera()&#13;
<span class="ent">❶</span> sleep(2)&#13;
<span class="ent">❷</span> <span class="codeorg">for</span> filename <span class="codeorg">in</span> camera.capture_continuous(<span class="codegreen1">"home/pi/my_timelapse/</span>&#13;
   <span class="codegreen1">img{counter:04d}.jpg"</span>):&#13;
<span class="ent">❸</span>     <span class="codepurple">print</span> (<span class="codegreen1">"</span><span class="codegreen1">Captured %s</span><span class="codegreen1">"</span> % filename)&#13;
<span class="ent">❹</span>     sleep(10) <span class="codered"># wait 5 minutes</span></pre>&#13;
<p class="caption" id="ch04ex10"><strong>LISTING 4-10</strong> The time-lapse code</p>&#13;
<p class="indent">By now, you should be familiar with the first three lines of the code, which import the code you need to use and save the <span class="literal">PiCamera</span><span class="literal">(</span><span class="literal">)</span> command.</p>&#13;
<p class="indent">Then, you add a small delay <span class="ent">❶</span> to allow the camera to prepare before it starts taking pictures.</p>&#13;
<p class="indent">Next, you use a <span class="literal">for</span> <em>loop</em> <span class="ent">❷</span> to take a picture, rename it, print a message, and then wait 10 seconds. This loop spares you from having to write the same code over and over; without it, you’d have to add the same lines of code 1000 times to capture 1000 images. Recall that a loop doesn’t stop until either you stop the program or the program meets a specific condition or point.</p>&#13;
<p class="indent">After the loop, you use the standard <span class="literal">camera.capture</span><span class="literal">(</span><span class="literal">)</span> code to take photos <span class="ent">❷</span>. But this time you also add <span class="literal">_continuous</span>, which ensures that the camera keeps taking photos forever or until you stop the program.</p>&#13;
<p class="indent">The next part of that line, <span class="literal">/home/pi/my_timelapse/</span>, tells the Pi where to store the photos. Then it gives instructions on how to name the files so they’re not overwritten. Let’s break down how this code works.</p>&#13;
<p class="indent">First, you add the filename, which is <em>img</em>. Then you use the <span class="literal">counter(</span><span class="literal">)</span> function to count from 0 upward. Each time a photo is taken, the counter value is added to the filename <em>img</em>. The counter is set to a maximum number of digits; in this program, it’s set to <span class="literal">04d</span>, which means a maximum of four digits.</p>&#13;
<p class="indent">When the program executes, the first photo taken is saved as <em>img0000</em>, the next photo is saved as <em>img0001</em>, then <em>img0002</em>, and so on. Because you can use up to four digits, you can take <span epub:type="pagebreak" id="page_80"/>9999 images before they start overwriting each other. This number should be plenty! Depending on what you’re capturing, you might want to take fewer (or more) images. If so, all you have to do is adjust the <span class="literal">04d</span> value to <span class="literal">03d</span> for three digits, <span class="literal">02d</span> for two digits, and so on.</p>&#13;
<p class="indent">Once the program has saved the image file, it prints the filename <span class="ent">❸</span> to your screen so you can check that the program is saving the files correctly. You can also see at a glance how many pictures the program has taken.</p>&#13;
<p class="indent">The final line of the program sets the time delay between each photo taken. A delay of 10 seconds <span class="ent">❹</span> allows you to test that the program is working correctly before deploying a longer time lapse. The camera will take a photo every 10 seconds until you terminate the program. In your real time-lapse video, you’ll want to use a longer delay time.</p>&#13;
<p class="indent">Let’s run a test version of the program and create a time-lapse video. Save the program and press <strong>F5</strong> to run it. After about a minute or so, stop the program: remember, this is just to test it and create a time-lapse sequence (<a href="ch04.xhtml#ch04fig08">Figure 4-8</a>).</p>&#13;
<div class="image"><img alt="Image" src="../images/04fig08.jpg"/></div>&#13;
<p class="figcap" id="ch04fig08"><strong>FIGURE 4-8</strong> Running the program and collecting the images</p>&#13;
<h5 class="h5">Figuring Out the Delay Time</h5>&#13;
<p class="noindent">The time delay you set should depend on what you’re filming. For example, consider that a candle takes three hours to burn. You could take a photo every minute by setting a delay of 60 seconds, which <span epub:type="pagebreak" id="page_81"/>would result in 180 images. You could even set the delay to 30 seconds and take 360 images. Both settings would produce a good time-lapse video, depending on how long and how smooth you want it to be.</p>&#13;
<p class="indent">Now, let’s consider filming a flower growing. This might take five days or more. Using the same settings would result in 14,400 images, which, at a rate of 30 frames per second, would produce an 8-minute video clip. This is too long. Setting a delay of 1200 seconds would be more suitable and would take a photo every 20 minutes. Your video would total 360 images and last for 12 seconds.</p>&#13;
<p class="indent">Whenever you set up your camera to take time-lapse images, make sure you consider the number of images and choose a suitable delay.</p>&#13;
<h5 class="h5">Putting Together the Video</h5>&#13;
<p class="noindent">To make the time-lapse video, you need to stitch the photos together so they create the illusion of time passing. You’ll use the Libav software, which will convert, manipulate, and stream a wide range of multimedia formats for you. Here are the steps:</p>&#13;
<ol>&#13;
<li class="noindent"><strong>Install Libav:</strong> Open the terminal and enter the following command to download all the Libav tools you’ll need:&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span> <span class="codestrong1">sudo apt -y install libav-tools</span></pre></li>&#13;
<li class="noindent"><strong>Navigate to the time-lapse folder:</strong> Once the program has been installed, navigate to the <em>my_timelapse</em> folder that holds all your images by entering this command:&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span> <span class="codestrong1">cd my_timlapse</span></pre></li>&#13;
<li class="noindent"><strong>Create the time lapse:</strong> Enter this code in the terminal to run the Libav software and create the video (be sure to enter this line exactly as it appears):&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span> <span class="codestrong1">avconv -r 10 -i img%04d.jpg -r 10 -vcodec libx264 -crf 20 -g 15 timelapse.mp4</span></pre>&#13;
<p class="indent">The process locates each <em>.h264</em> image in the designated folder and then uses a codec to join it with the previous <em>.h264</em> file. Libav then converts the completed file to <em>.mp4</em> format and saves it as a file named <em>timelapse.mp4</em>. The conversion might take a while if you have hundreds of images. This is another <span epub:type="pagebreak" id="page_82"/>reason for testing the setup before you deploy it on a five-day shoot!</p></li>&#13;
<li class="noindent"><strong>Play the time lapse:</strong> Now that your time-lapse test video is in <em>.mp4</em> format, you can copy it onto a memory stick or transfer it onto a laptop or other device and play it like any video file! Notice the speed at which the images are shown and how smooth it seems. You can use this test to decide how long you want the delay to be in the future.</li>&#13;
</ol>&#13;
<h5 class="h5">Making Your Own Time-Lapse Movie</h5>&#13;
<p class="noindent">Now you’re ready to set up your time-lapse camera. Calculate the number of images you need to take as well as the time period—whether it’s an hour, a day, or a week. Set the Pi Camera into position, and then start running the program. In my experience, it’s also worth leaving a note to let others know what your Pi is doing so they’re not tempted to turn it off. After the required time period, stop the program, move to the image folder, stitch the images together, and enjoy your video. Don’t forget to share your time-lapse creations so others can admire them.</p>&#13;
<h3 class="h3" id="ch04lev1sec5">WRAPPING UP</h3>&#13;
<p class="noindent">This chapter covered some of the basics of using the Pi Camera, such as adding filters, changing settings, and taking photos, videos, and a time-lapse video. You can use the Pi Camera for many projects. How about making a stop-motion animation or setting up the camera to keep an eye on your pet and see what it gets up to while you are out? In <a href="ch11.xhtml#ch11">Chapter 11</a>, you’ll combine the Pi Camera with a motion sensor to remotely capture images of wildlife and upload them to Dropbox.</p>&#13;
</body></html>