<html><head></head><body>
<div id="book-content">
<div id="sbo-rt-content"><h2 class="h2" id="ch09"><span epub:type="pagebreak" id="page_235"/><strong><span class="big">9</span><br/>BANKING TROJANS</strong></h2>&#13;
<div class="image1"><img src="../images/common.jpg" alt="Image" width="189" height="189"/></div>&#13;
<p class="noindentsa">Attackers use Android banking trojans (ABTs) to steal money from unsuspecting victims by draining their bank accounts or capturing credit card information, then using it to make fraudulent purchases. For example, some ABTs harvest a user’s credentials by placing a fake window over the user’s banking app. When the user enters their credentials into the malicious window, it captures the data, logs into the user’s account, and transfers funds to the attacker.</p>&#13;
<p class="indent">Other ABTs monitor for users visiting bank websites. When they try to access the legitimate website, the malware redirects them to a fake one that looks identical. Once the hapless user enters their credentials, the attacker can use these to redirect funds from the victim’s account to theirs. This is often done via transfers through a large number of intermediate accounts, to reduce the likelihood of detection.</p>&#13;
<p class="indent">In this chapter, you’ll learn about some well-known ABT families and see which features machine learning algorithms use to separate ABTs from goodware, as well as from other categories of Android malware.</p>&#13;
<h3 class="h3" id="ch09lev1"><strong>Banking Trojan Families</strong></h3>&#13;
<p class="noindent"><span epub:type="pagebreak" id="page_236"/>This section introduces you to some important ABT families. Note that the source code for several of these applications has been leaked, causing many variants to appear. The slight differences between samples make placing individual APKs into families more difficult than for other malware categories.</p>&#13;
<p class="indent">BankBot, a common malware family with many variants dating back to at least 2014, was distributed via multiple types of apps, including games and apps that provided estimates of exchange rates for converting crypto-currencies to hard currencies. Though the apps did provide the advertised service, they also included BankBot code. This code scanned the infected device, looking for installed banking apps for which it had overlay screens. When the victim launched the banking app, BankBot placed a user input screen over the real app to harvest banking credentials. It also captured incoming text messages and responded to messages requesting two-factor authentication.</p>&#13;
<p class="indent">Cerberus was first discovered in 2019 by ThreatFabric and described in the blog post “Cerberus - A New Banking Trojan from the Underworld.” It primarily targeted customers in Italy, Russia, Spain, and other countries in the European Union. Like BankBot, Cerberus disguised itself as a legitimate app for currency conversions or similar purposes and used overlay screens to capture banking credentials and SMS permissions to intercept two-factor authentication messages sent by the bank. Recently, developers released Cerberus’s source code on various hacker forums, leading to a proliferation of variants as different groups sought to monetize it.</p>&#13;
<p class="indent">The FakeSpy ABT family compromises the phones of its victim by sending them text messages about packages that weren’t delivered. Such phishing messages are called <em>smishing</em>, as the phishing lures are delivered via SMS. The victims click a link included in the message, which asks them to download an app that looks legitimate but in fact includes the FakeSpy malware. Once the victim’s device has been compromised, the malware steals personal information such as their contact list and information about their bank and cryptocurrency accounts. FakeSpy was first described by Trend Micro in a 2018 blog post, “FakeSpy Targets Japanese and Korean-Speaking Users.”</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_237"/>The Marcher family, also known as Marchcaban, has been around since at least 2013, when F-Secure discovered apps targeting the Spanish bank Banca March. Some versions operate by telling the victim that their Flash player needs updating. Clicking the link they provide to perform the update downloads the trojan app. Marcher also tries to block a number of mobile malware detection products that may be installed on the user’s device. Like many of the other ABTs, Marcher uses screen overlays to steal user credentials and intercepts incoming two-factor authentication requests over SMS to gain access to the user’s account. We’ll use Marcher as an example throughout this chapter to illustrate many common ABT behaviors.</p>&#13;
<p class="indent">Medusa is a recent malware family that compromises victims’ devices by sending smishing messages encouraging them to install a variety of legitimate-sounding apps containing the malware. Medusa is capable of keylogging and intercepting messages, as well as audio and video. Like most banking trojans, one of its capabilities is reading and responding to two-factor authentication messages from legitimate banking apps. ThreatFabric first described it in the 2021 blog post “The Rage of Android Banking Trojans.”</p>&#13;
<p class="indent">Zitmo is an interesting ABT, as it was found on mobile operating systems like Symbian, BlackBerry, and Windows Mobile as early as 2011 before coming to Android. A mobile version of the well-known Zeus malware for Windows, Zitmo (short for <em>Zeus in the Mobile</em>) operates in conjunction with a computer already infected by Zeus. Zeus sends an SMS to the user’s phone asking them to download an app, infecting the device. Then, when the attacker tries to steal money from the user’s bank account or make cash transactions, Zitmo forwards the mobile transaction authentication number (mTAN) code sent by the bank to the attacker’s phone, which can then use the code to authenticate transactions.</p>&#13;
<p class="indent">One additional ABT worth mentioning is Xbot, which was identified in 2015 when it started spreading through apps downloaded from malicious URLs. Once installed and run, Xbot followed the playbook of other ABTs by using window overlays and reading two-factor authentication text messages from banks. In addition, it could encrypt data on the device and make ransom demands to the user.</p>&#13;
<p class="indent">You might want to investigate other well-known ABT families on your own, including Asacub, FakeToken, and Svpeng, all of which have wreaked considerable havoc over the years.</p>&#13;
<h3 class="h3" id="ch09lev2"><strong>Banking Trojans vs. Goodware</strong></h3>&#13;
<p class="noindent"><span epub:type="pagebreak" id="page_238"/><a href="ch09.xhtml#ch9fig1">Figure 9-1</a> shows the top 20 features for separating ABTs from goodware using the Extra-Trees classifier discussed in <a href="ch07.xhtml">Chapter 7</a>.</p>&#13;
<p class="indent">Nine of these features are permission-related, and nine are advanced features related to suspicion scores, suspicion ranks, and feature clustering. Just two involve specific types of API calls.</p>&#13;
<h4 class="h4" id="ch09lev1sec1"><strong><em>SMS Permission Features</em></strong></h4>&#13;
<p class="noindent">You should immediately see that the SMS-related permissions <span class="literal">SEND_SMS</span>, <span class="literal">RECEIVE_SMS</span>, <span class="literal">WRITE_SMS</span>, and <span class="literal">READ_SMS</span> play a huge role in separating ABTs from goodware. <a href="ch09.xhtml#ch9tab1">Table 9-1</a> shows that virtually every malware family we discussed earlier in this chapter requests all of these permissions, with two exceptions: BankBot doesn’t request <span class="literal">READ_SMS</span> and Xbot doesn’t request <span class="literal">WRITE_SMS</span>.</p>&#13;
<p class="tabcap" id="ch9tab1"><strong>Table 9-1:</strong> SMS-Related Permissions Requested by Major ABT Families</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:20%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:20%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Malware</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><span class="literal"><strong>SEND_SMS</strong></span></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><span class="literal"><strong>WRITE_SMS</strong></span></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><span class="literal"><strong>RECEIVE_SMS</strong></span></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><span class="literal"><strong>READ_SMS</strong></span></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">BankBot</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Cerberus</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">FakeSpy</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Marcher</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Medusa</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Xbot</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Zitmo</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">The classifier’s output shows that the percentage of ABTs that request these permissions is very high: 70 to 85 percent, compared to less than 5 percent of goodware. The reason for this is simple: most banking apps implement two-factor authentication via a code sent to the user’s phone, so ABTs need to intercept these messages to pass the authentication before attempting any fraudulent action.</p>&#13;
<div class="image"><img id="ch9fig1" src="../images/ch09fig01.jpg" alt="Image" width="1851" height="932"/></div>&#13;
<p class="figcap"><em>Figure 9-1: Top 20 features that best distinguish ABTs from goodware</em></p>&#13;
<h4 class="h4" id="ch09lev1sec2"><strong><em>Other Permission Features</em></strong></h4>&#13;
<p class="noindent"><span epub:type="pagebreak" id="page_239"/><span epub:type="pagebreak" id="page_240"/>ABTs also request many non-SMS permissions. As an example, <a href="ch09.xhtml#ch9lis1">Listing 9-1</a> shows the list of permissions requested by the BankBot malware <em>com.interactive.crutch</em> (v1, 9b14).</p>&#13;
<pre>&lt;?xml version="1.0" encoding="utf-8"?&gt;&#13;
&lt;manifest  &#13;
    android:versionCode="1" android:versionName="6.127.465" &#13;
    android:installLocation="auto" android:compileSdkVersion="28" &#13;
    android:compileSdkVersionCodename="9" package="com.interactive.crutch" &#13;
    platformBuildVersionCode="1" platformBuildVersionName="6.127.465"&gt;&#13;
  &lt;uses-sdk android:minSdkVersion="19" android:targetSdkVersion="25"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.READ_CONTACTS"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.READ_PHONE_STATE"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.WRITE_SMS"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.RECEIVE_SMS"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.SEND_SMS"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.CALL_PHONE"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.INTERNET"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.DISABLE_KEYGUARD"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.WAKE_LOCK"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.VIBRATE"/&gt;</pre>&#13;
<p class="list" id="ch9lis1"><em>Listing 9-1: All permissions requested by BankBot</em></p>&#13;
<p class="indent">You can see that BankBot acquires permissions such as <span class="literal">VIBRATE</span> and <span class="literal">DISABLE_KEYGUARD</span>. The app uses <span class="literal">VIBRATE</span> to draw the user’s attention to a fake error message, enticing them to grant the app accessibility permissions. This step enables advanced malware features that are typically off-limits to regular applications. The <span class="literal">DISABLE_KEYGUARD</span> permission is used to remove the phone’s lock screen to, for example, force a user interface event that the malware wants to process.</p>&#13;
<p class="indent">Over 90 percent of ABTs request <span class="literal">READ_PHONE_STATE</span>, a permission also common in rooting malware, compared to around 30 percent of goodware. ABTs can use this permission to capture private data about the victim’s phone, such as its IMEI number. As mentioned in <a href="ch07.xhtml">Chapter 7</a>, this type of information is critical for mobile payment apps that need to verify the identify of the device sending a payment request. With the exception of Cerberus, all ABT families discussed earlier in this chapter request this permission.</p>&#13;
<p class="indent">Another permission popular with rooting malware that is commonly requested by ABTs is <span class="literal">SYSTEM_ALERT_WINDOW</span>: over 60 percent of ABTs request <span epub:type="pagebreak" id="page_241"/>this, compared to about 10 percent of goodware. Giving an app this permission lets it display pop-up alert windows. This functionality has clear value for an ABT; it enables it to show bogus banking app screens on top of real banking apps. Of the seven ABTs discussed earlier in this chapter, FakeSpy, Medusa, Xbot and Zitmo request this permission, while BankBot, Cerberus, and Marcher do not.</p>&#13;
<p class="indent">The <span class="literal">GET_TASKS</span> permission lets an app identify the running processes on a device. As you can see from the classifier’s output, ABTs are far more likely to request this permission than goodware; almost 80 percent of ABTs request it, versus around 15 percent of goodware. Our experience shows that many banking trojans request the <span class="literal">GET_TASKS</span> permission to watch for the launching of legitimate banking apps, so they can swoop in and overlay their phishing windows. Android has severely restricted this feature for precisely that reason. Of the seven ABT families mentioned earlier in this chapter, FakeSpy, Marcher, Medusa, and Xbot request this permission.</p>&#13;
<p class="indent">A permission that ABTs frequently request but rooting malware doesn’t is the <span class="literal">CHANGE_NETWORK_STATE</span> permission, which enables an app to connect to a Wi-Fi network. Over 40 percent of ABTs request this permission, compared to less than 5 percent of goodware. Of the ABT families mentioned we introduced earlier, Marcher, Medusa, Xbot, and Zitmo request this permission. Interestingly, we haven’t witnessed other ABTs using this permission to perform malicious tasks.</p>&#13;
<p class="indent">The <span class="literal">RECEIVE_BOOT_COMPLETED</span> permission is another one that we discussed in the context of rooting malware. It enables the app to see that the device has completed its boot process. An ABT may wish to receive this notification so it can start up as soon as the device is running to continue monitoring SMS traffic or wait for the user to launch a banking app. All seven of the ABT families mentioned earlier in this chapter request this permission.</p>&#13;
<p class="indent">Almost all of the other features useful for separating ABTs from goodware are related to advanced features, including suspicion rank and clustering-based features of the kind introduced in <a href="ch06.xhtml">Chapter 6</a>, which capture the potential maliciousness of an app based on the TSG.</p>&#13;
<h4 class="h4" id="ch09lev1sec3"><strong><em>Prediction Efficacy</em></strong></h4>&#13;
<p class="noindent">How effective are classifiers at predicting whether an app is an ABT rather than goodware or some other form of malware? The results in <a href="ch09.xhtml#ch9tab2">Table 9-2</a> show our ability to make such predictions when comparing apps to goodware. The rows in this table show the types of features used: basic API, static, and dynamic features; advanced TSG-based, landmark-based, feature clustering–based, and correlational graph–based features; and combinations of these types.</p>&#13;
<p class="tabcap" id="ch9tab2"><span epub:type="pagebreak" id="page_242"/><strong>Table 9-2:</strong> Metrics for Evaluating ABTs vs. Goodware</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:20%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Feature set</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Best classifier</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>AUC</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Precision</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Recall</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>F1</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>FPR</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>FNR</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">API package</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">XGBoost</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9862</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9483</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9161</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9319</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.0517</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.0293</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Static (S)</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">XGBoost</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9792</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9780</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9208</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9485</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.0220</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.0275</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Dynamic (D)</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">MLP</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9215</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9242</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.6550</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.7667</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.0758</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.1107</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">S + D</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">XGBoost</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9810</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9819</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9208</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9504</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.0181</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.0274</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">API + S + D</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">XGBoost</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.9975</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.9837</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.9642</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.9738</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.0163</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.0126</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">TSG</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">XGBoost</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9872</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9463</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9142</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9300</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.0537</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.0300</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">LM</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">KNN</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.5864</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.2826</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9859</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.4393</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.7174</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.0419</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">FC</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">RF</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9820</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9215</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8633</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8915</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.0785</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.0473</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">CG</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">KNN</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.5101</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.2617</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">1.0000</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.4148</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.7383</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.0000</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">API + S + D + TSG</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">XGBoost</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9975</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9827</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9661</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9743</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.0173</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.0119</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">API + S + D + LM</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">XGBoost</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9974</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9837</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9651</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9743</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.0163</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.0123</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">API + S + D + FC</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">XGBoost</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9975</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9827</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9642</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9734</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.0173</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.0126</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">API + S + D + CG</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">XGBoost</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.9974</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.9827</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.9642</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.9734</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.0173</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.0126</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">All features</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">XGBoost</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9973</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9809</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9670</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9739</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.0191</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.0116</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Best late fusion</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">XGBoost</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9982</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9905</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9736</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent"><strong>0.9819</strong></p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.0095</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.0093</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">Machine learning algorithms are able to separate ABTs from goodware at high rates, with the best late fusion result producing an F1 score of 0.9819, a precision of 0.9905, and a recall of 0.9736. These are great numbers, suggesting that most apps classified as ABTs are indeed ABTs, and that the classifiers have discovered most ABTs in the set of apps.</p>&#13;
<h3 class="h3" id="ch09lev3"><strong>Banking Trojans vs. Other Malware</strong></h3>&#13;
<p class="noindent"><a href="ch09.xhtml#ch9fig2">Figure 9-2</a> shows the 20 most important features for distinguishing ABTs from other forms of malware.</p>&#13;
<p class="indent">In this case, 14 of the 20 features involve permissions. Thirteen of these features represent permissions sought by the app and one feature indicates the number of dangerous permissions sought. The remaining six features are advanced features.</p>&#13;
<h4 class="h4" id="ch09lev1sec4"><strong><em>Permission-Related Features</em></strong></h4>&#13;
<p class="noindent">As in the case of separating ABTs from goodware, SMS-related permissions are the most important. We see that the percentage of ABTs requesting the <span class="literal">RECEIVE_SMS</span> permission is more than double that of other forms of malware. The same is true for <span class="literal">WRITE_SMS</span> and <span class="literal">READ_SMS</span>, probably due to the fact that other forms of malware, such as ransomware, may not need to watch for and respond to two-factor authentication messages sent by banks.</p>&#13;
<div class="image"><img id="ch9fig2" src="../images/ch09fig02.jpg" alt="Image" width="1879" height="931"/></div>&#13;
<p class="figcap"><em>Figure 9-2: Top 20 features that best distinguish ABTs from other malware</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_243"/><span epub:type="pagebreak" id="page_244"/><a href="ch09.xhtml#ch9tab3">Table 9-3</a> shows four non-SMS-related permissions requested more frequently by ABTs than by other forms of malware and indicates which of the ABTs discussed earlier in this chapter use them.</p>&#13;
<p class="tabcap" id="ch9tab3"><strong>Table 9-3:</strong> Non-SMS-Related Permissions Requested by Major ABT Families</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:20%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Permission</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>BankBot</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Cerberus</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>FakeSpy</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Marcher</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Medusa</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Xbot</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Zitmo</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent"><span class="literal">CALL_PHONE</span></p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab"><span class="literal">WAKE_LOCK</span></p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Yes</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent"><span class="literal">WRITE_CONTACTS</span></p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">No</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Yes</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab"><span class="literal">READ_CALL_LOGS</span></p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">No</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">One key permission, <span class="literal">CALL_PHONE</span>, enables attackers to make calls from the phone without the user even noticing. They could perhaps use this permission to confirm a bank transaction. With the exception of FakeSpy, all malware families introduced in this chapter request this permission. Xbot uses it to set up call forwarding on the infected device, likely to redirect incoming calls from the user’s bank to the scammers. Samples of the Medusa family use this permission to call random phone numbers as instructed by the malware’s command-and-control server.</p>&#13;
<p class="indent">Another permission that distinguishes ABTs from other malware is <span class="literal">WAKE_LOCK</span>, which ensures that the phone stays on. The use of this permission among ABTs is widespread and often employed to force the device to stay awake during critical moments while the malware tries to steal data or money. For example, BankBot keeps the device alive while disabling the lock screen and forcing user interface interactions. The Marcher family is less subtle; it forces the device to stay awake at all times. With the exception of Cerberus, all of the malware families covered in this chapter request this permission. Although other forms of malware, like spyware and SMS fraud apps, could leverage it, we don’t see it requested as frequently by other malware categories.</p>&#13;
<p class="indent">The <span class="literal">WRITE_CONTACTS</span> permission, which allows an app to write to the contact list, is another one that distinguishes ABTs from other malware. It could be abused in many ways; for instance, it could write a new phone number for your bank and then call you from that number, making it seem as though the hacker’s number is the bank’s. Of the seven malware families we have discussed, only Zitmo requests this permission. We haven’t seen it abused in practice.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_245"/>A final permission that distinguishes ABTs from other malware is <span class="literal">READ_CALL_LOG</span>. This permission enables an app to see who has called a phone, the days of the week and times of the day at which those calls were placed, and more. This privilege could, in principle, enable fraudsters to impersonate someone who has called the victim before. For instance, they could send spoofing texts referencing a real conversation the victim had to trick the user into giving them money or information. Though none of the malware families discussed earlier in this chapter request this permission, our classifiers have found it to be associated with ABTs.</p>&#13;
<h4 class="h4" id="ch09lev1sec5"><strong><em>Prediction Efficacy</em></strong></h4>&#13;
<p class="noindent"><a href="ch09.xhtml#ch9tab4">Table 9-4</a> shows the ability of machine learning algorithms to separate ABTs from other malware.</p>&#13;
<p class="tabcap" id="ch9tab4"><strong>Table 9-4:</strong> Metrics for Evaluating ABTs vs. Other Malware</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:20%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Feature set</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Best classifier</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>AUC</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Precision</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>Recall</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>F1</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>FPR</strong></p></th>&#13;
<th class="table-h" style="vertical-align: top"><p class="noindent-tab"><strong>FNR</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">API package</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">GBDT</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9099</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8476</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8388</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8432</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.1524</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.1603</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">Static (S)</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">XGBoost</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9156</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8513</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8401</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8456</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1487</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1592</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Dynamic (D)</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">MLP</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8394</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8100</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.6378</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.7137</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.1900</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.3008</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">S + D</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">XGBoost</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9138</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8560</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8391</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8475</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1440</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1591</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">API + S + D</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">XGBoost</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.9447</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.8794</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.8794</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.8794</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.1206</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.1214</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">TSG</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">GBDT</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9117</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8476</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8492</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8484</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1524</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1518</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">LM</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">XGBoost</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.5451</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.5266</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8878</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.6611</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.4734</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.3650</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">FC</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">XGBoost</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8409</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.7588</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.7681</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.7635</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.2412</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.2363</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">CG</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">SVM</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.5045</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.5028</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">1.0000</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.6692</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.4972</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.0000</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">API + S + D + TSG</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">XGBoost</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9463</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8807</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8765</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8786</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1193</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1237</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">API + S + D + LM</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">XGBoost</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9444</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8815</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8831</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.8823</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.1185</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.1179</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">API + S + D + FC</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">XGBoost</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9451</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8803</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8803</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8803</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1197</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1205</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">API + S + D + CG</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">XGBoost</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.9439</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.8789</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.8756</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.8772</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.1211</p></td>&#13;
<td style="vertical-align: top" class="gray tab"><p class="noindent">0.1248</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top"><p class="noindent-tab">All features</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">XGBoost</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.9476</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8827</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8794</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.8810</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1173</p></td>&#13;
<td style="vertical-align: top"><p class="noindent-tab">0.1210</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">Best late fusion</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">XGBoost</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9796</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9447</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.9576</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent"><strong>0.9507</strong></p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.0553</p></td>&#13;
<td style="vertical-align: top" class="gray"><p class="noindent">0.0424</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">The best late fusion result in this case produces an F1 score of 0.9507, with a precision of 0.9447 and a recall of 0.9576. While these are excellent numbers, they’re slightly lower than those for separating ABTs from goodware. This is to be expected: ABTs often have characteristics in common with other malware categories, making them harder to separate out. For example, some ABTs, like FakeSpy, steal contact lists, a behavior also observed in spyware apps. Others, like Xbot, have both ABT behavior and ransomware capabilities.</p>&#13;
<h3 class="h3" id="ch09lev4"><strong>Marcher: A Case Study</strong></h3>&#13;
<p class="noindent"><span epub:type="pagebreak" id="page_246"/>We introduced Marcher earlier in this chapter. By examining the code in this app, <em>com.fasstr</em> (v1, c219), we can see several of the ABT characteristics we’ve discussed so far. <a href="ch09.xhtml#ch9lis2">Listing 9-2</a> shows the permissions sought by the app. Notice that it uses all the ABT permissions we’ve mentioned.</p>&#13;
<pre>&lt;?xml version="1.0" encoding="utf-8"?&gt;&#13;
&lt;manifest  &#13;
    android:versionCode="1"  android:versionName="1.0" package="com.fasstr" &#13;
    platformBuildVersionCode="22" platformBuildVersionName="5.1.1-1819727"&gt;&#13;
  &lt;uses-sdk android:minSdkVersion="9" android:targetSdkVersion="18"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.WAKE_LOCK"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.RECEIVE_SMS"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.SEND_SMS"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.READ_SMS"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.WRITE_SMS"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.CALL_PHONE"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.READ_PHONE_STATE"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.ACCESS_NETWORK_STATE"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.INTERNET"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.READ_CONTACTS"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.GET_TASKS"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.WRITE_SETTINGS"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.VIBRATE"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.USES_POLICY_FORCE_LOCK"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.ACCESS_WIFI_STATE"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.CHANGE_WIFI_STATE"/&gt;&#13;
  &lt;uses-permission android:name="android.permission.CHANGE_NETWORK_STATE"/&gt;</pre>&#13;
<p class="list" id="ch9lis2"><em>Listing 9-2: All permissions requested by Marcher</em></p>&#13;
<p class="indent">Besides the very important SMS-related permissions used for intercepting and responding to two-factor authentication messages, Marcher has other interesting capabilities. It gains persistence on the device with the help of the <span class="literal">RECEIVE_BOOT_COMPLETED</span> permission, which allows it to restart after every phone boot. It can dial arbitrary numbers downloaded from its command-and-control server with the <span class="literal">CALL_PHONE</span> permission, and it uses the <span class="literal">VIBRATE</span> permission to draw the user’s attention to certain dialogs.</p>&#13;
<p class="indent"><a href="ch09.xhtml#ch9lis3">Listing 9-3</a> shows Marcher looking for the presence of the Bankwest mobile banking app <em>au.com.bankwest.mobile</em>, one of several banking apps that Marcher searches for in order to overlay screens.</p>&#13;
<pre>public void a(String str) {&#13;
  char c2 = 65535;&#13;
  switch (str.hashCode()) {&#13;
    case 849595102:&#13;
      if (str.equals("au.com.bankwest.mobile")) {&#13;
        c2 = 0;&#13;
        break;&#13;
      }&#13;
      break;&#13;
  }&#13;
  switch (c2) {&#13;
    case 0:&#13;
      b("au.com.bankwest.mobile");&#13;
      a((int) R.drawable.ic_stat_content_mail);&#13;
      b((int) R.drawable.ic_stat_content_mail);&#13;
      return;&#13;
    default:&#13;
      b(str);&#13;
      a((int) R.drawable.ic_stat_content_mail);&#13;
      b((int) R.drawable.ic_stat_content_mail);&#13;
      return;&#13;
  }&#13;
}</pre>&#13;
<p class="list" id="ch9lis3"><em>Listing 9-3: A code snippet showing Marcher looking for a banking app</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_247"/>The specific banking apps to look for are passed down from the command-and-control server. The only reason <em>au.com.bankwest.mobile</em> appears in the source code is that the malware seems to require some special handling for this app compared to all other banking apps.</p>&#13;
<p class="indent"><a href="ch09.xhtml#ch9lis4">Listing 9-4</a> shows the Marcher ABT receiving and processing incoming SMS messages.</p>&#13;
<pre>public class e extends BroadcastReceiver {&#13;
  protected static final String a = com.fasstr.e.e.a(MessageReceiver.class);&#13;
  protected c b;&#13;
&#13;
  private void a(Context context, Intent intent) {&#13;
    if (this.b.b()) {&#13;
      Object[] objArr = (Object[]) intent.getExtras().get("pdus");&#13;
      SmsMessage[] smsMessageArr = new SmsMessage[objArr.length];&#13;
      for (int i = 0; i &lt; objArr.length; i++) {&#13;
        try {&#13;
          smsMessageArr[i] = (SmsMessage) SmsMessage.class.getMethod(&#13;
            "cre_ateF_romP_du".replace("_", ""),&#13;
            new Class[]{byte[].class}).invoke(&#13;
              (Object) null, &#13;
              new Object[]{(byte[]) objArr[i]});&#13;
          Log.d(a, "MSG GOT:" + smsMessageArr[i].getMessageBody());&#13;
        } catch (Exception e) {&#13;
          Log.d(a, "Handler method fail");&#13;
          e.printStackTrace();&#13;
        }&#13;
      }&#13;
      if (this.b.c()) {&#13;
        if (System.currentTimeMillis() - this.b.d() &gt; this.b.e()) {&#13;
          this.b.b(false);&#13;
          this.b.a((String) null);&#13;
        }&#13;
      }&#13;
      new f(context).a(context, smsMessageArr).a(this, context, smsMessageArr);&#13;
    }&#13;
  }&#13;
&#13;
  public void onReceive(Context context, Intent intent) {&#13;
    a(context, intent);&#13;
    abortBroadcast();&#13;
  }&#13;
}</pre>&#13;
<p class="list" id="ch9lis4"><em>Listing 9-4: A code snippet showing Marcher creating an SMS message to send</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_248"/>To access the incoming SMS messages, the malware uses the same APIs that goodware would. It registers a broadcast receiver that is called by the operating system every time an SMS arrives on the system. Then, the malware accesses the SMS text with the help of the <span class="literal">SmsMessage.createFromPdu</span> method. The only difficulty is that the malware code is somewhat obfuscated. Instead of calling <span class="literal">SmsMessage.createFromPdu</span> directly, the malware uses reflection through <span class="literal">SmsMessage.class.getMethod</span> and minimal string obfuscation, by writing <span class="literal">cre_ateF_romP_du</span> instead of <span class="literal">createFromPdu</span>.</p>&#13;
<p class="indent">In <a href="ch09.xhtml#ch9lis5">Listing 9-5</a>, Marcher tries to become the administrator of the compromised device so that it can alter settings related to device administration at will.</p>&#13;
<pre>public class AdminActivity extends Activity {&#13;
  private DevicePolicyManager a;&#13;
  private ComponentName b;&#13;
&#13;
  private void a() {&#13;
    f.a("AdminActivity: get Device Admin");&#13;
    try {&#13;
      this.a = (DevicePolicyManager) getSystemService("device_policy");&#13;
      this.b = new ComponentName(this, AdminRightsReceiver.class);&#13;
      if (!this.a.isAdminActive(this.b)) {&#13;
        Log.d("TAG", "try to become admin");&#13;
        Intent intent = new Intent("android.app.action.ADD_DEVICE_ADMIN");&#13;
        intent.putExtra("android.app.extra.DEVICE_ADMIN", this.b);&#13;
        intent.putExtra("android.app.extra.ADD_EXPLANATION", &#13;
          "Click on Activate button to secure your application.");&#13;
        startActivityForResult(intent, 100);&#13;
        return;&#13;
      }&#13;
      Log.d("TAG", "already admin");&#13;
    } catch (Exception e) {&#13;
      e.printStackTrace();&#13;
    }&#13;
  }&#13;
}</pre>&#13;
<p class="list" id="ch9lis5"><em>Listing 9-5: A code snippet showing Marcher trying to become the device admin</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_249"/>Again, the malware uses exactly the same APIs that goodware would use for this purpose. It launches an activity of type <span class="literal">ADD_DEVICE_ADMIN</span>, which opens the system dialog for granting the app the desired permissions. If the user follows through with the instructions in this dialog, the malware will be granted device administrator permissions. Its command-and-control server will then have the ability to send it commands, and it will even be able to set or reset device passwords and lock users out of their own devices.</p>&#13;
<h3 class="h3" id="ch09lev5"><strong>Up Next</strong></h3>&#13;
<p class="noindent">Machine learning methods perform very well at detecting ABTs. In this chapter, we’ve observed that virtually all ABTs extensively use the SMS-related permissions. Other requested permissions frequently found in ABTs, such as <span class="literal">RECEIVE_BOOT_COMPLETE</span>, should also make an app highly suspect. In addition to permissions, advanced features based on suspicion scores, suspicion ranks, and feature clustering are very important in distinguishing between ABTs and goodware. These findings suggest that advanced features may be harder for an adversary to reverse engineer.</p>&#13;
<p class="indent">Our next chapter will focus on ransomware apps. We’ll introduce the risks this malware category poses to Android users, as well as the techniques it relies on to manipulate data access and control on Android devices.<span epub:type="pagebreak" id="page_250"/></p>&#13;
</div>
</div>
<div style="float: none; margin: 10px 0px 10px 0px; text-align: center;"><p><a href="https://oceanofpdf.com"><i>OceanofPDF.com</i></a></p></div></body></html>