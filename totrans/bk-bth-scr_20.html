<html><head></head><body>
<div id="sbo-rt-content" class="calibre1"><section aria-labelledby="ch18" epub:type="chapter" role="doc-chapter">
<hgroup>
<h2 class="title" id="ch18">
<span class="cn"><span aria-label=" Page 195. " epub:type="pagebreak" id="pg_195" role="doc-pagebreak" class="calibre2"/><span class="sans_dogma_ot_bold_b_">18</span></span>
<span class="ct1"><span class="sans_dogma_ot_bold_b_">DIRECTORIES, RECURSION, AND ITERATIVE LOOPS</span></span>
</h2>
</hgroup>
<figure class="opener"><img alt="" class="opener1" height="407" src="../images/chapter.jpg" width="408"/>
</figure>
<p class="chapterintro">Many Batch commands have options, but most offer a slightly different flavor or tweak on the command. The options of the <span class="sans_thesansmonocd_w5regular_1">for</span> command are a completely different story. The four available options impact the <span class="sans_thesansmonocd_w5regular_1">for</span> command in four distinct ways. In this chapter, I’ll detail three of them, and the fourth will follow in the next, requiring its very own chapter.</p>
<p class="tx">One option changes the focus of the command from files to directories, and another uses recursion to traverse subdirectories looking for files. You’ll also learn how those two options used together can traverse a directory tree looking for subdirectories.</p>
<p class="tx">The last option in this chapter morphs the <span class="sans_thesansmonocd_w5regular_">for</span> command into something unlike anything that I’ve yet discussed. Its functionality has little in common with the optionless <span class="sans_thesansmonocd_w5regular_">for</span> command or the command with its other <span aria-label=" Page 196. " epub:type="pagebreak" id="pg_196" role="doc-pagebreak"/>options. It creates an iterative loop, executing logic as it increments or decrements an index or counter by a fixed amount from one number to another. This tool is nothing less than an absolute necessity for any coder.</p>
<section aria-labelledby="sec1" epub:type="division">
<h3 class="h" id="sec1"><span id="h1-125"/><span class="sans_futura_std_bold_b_">The Directory Option</span></h3>
<p class="tni">Not all of the option letters are descriptive of their function, but the <span class="sans_thesansmonocd_w5regular_">/D</span> option stands for <i class="calibre6">directory</i>. While the optionless <span class="sans_thesansmonocd_w5regular_">for</span> command enumerates through a list of filenames, the <span class="sans_thesansmonocd_w5regular_">/D</span> option allows the command to enumerate through a list of directories or folders. The general syntax shows that other than the insertion of the option, it’s unchanged from its optionless cousin:</p>
<pre class="pre"><code class="calibre11">for /D %%<var class="calibre12">variable </var>in (<var class="calibre12">input</var>) do <var class="calibre12">command</var></code></pre>
<p class="tx">Before using the option, here is an example reminiscent of the prior chapter, an optionless <span class="sans_thesansmonocd_w5regular_">for</span> command sporting a sole wildcard character for the filename after a path:</p>
<pre class="pre"><code class="calibre11">for %%f in (C:\Budget\*) do (
   &gt; con echo Filename is %%f
)
</code></pre>
<p class="tni">The resulting output includes the path and filename of every file in the folder written to the console.</p>
<p class="tx">In the following example, I’m making two tweaks to the optionless <span class="sans_thesansmonocd_w5regular_">for</span> loop: one important and one cosmetic. The important addition is the insertion of the <span class="sans_thesansmonocd_w5regular_">/D</span> option before the <span class="sans_thesansmonocd_w5regular_">for</span> variable. Notice that the rest of the <span class="sans_thesansmonocd_w5regular_">for</span> command itself is completely unchanged. The cosmetic tweak is that I’m replacing the word <span class="sans_thesansmonocd_w5regular_">File</span> with <span class="sans_thesansmonocd_w5regular_">Directory</span> in the <span class="sans_thesansmonocd_w5regular_">echo</span> command:</p>
<pre class="pre"><code class="calibre11">for /D %%f in (C:\Budget\*) do (
   &gt; con echo Directory Name is %%f
)
</code></pre>
<p class="tni">Another possible change to this code could include the replacement of <span class="sans_thesansmonocd_w5regular_">%%f</span> with <span class="sans_thesansmonocd_w5regular_">%%d</span> for <i class="calibre6">directory</i> (but I’m trying not to complicate this example).</p>
<p class="tx">The files in this folder that were displayed without the <span class="sans_thesansmonocd_w5regular_">/D</span> option are no longer part of the output. Now the interpreter writes every directory immediately under <i class="calibre6">C:\Budget\</i> to the console, perhaps:</p>
<pre class="pre"><code class="calibre11">Directory Name is C:\Budget\BankStatements
Directory Name is C:\Budget\CreditCardStatements
</code></pre>
<p class="tni">This output assumes that these are the only two subdirectories, but any subdirectories of those subdirectories aren’t listed in the output.</p>
</section>
<section aria-labelledby="sec2" epub:type="division">
<h3 class="h" id="sec2"><span id="h1-126"/><span aria-label=" Page 197. " epub:type="pagebreak" id="pg_197" role="doc-pagebreak"/><span class="sans_futura_std_bold_b_">The Recursion Option</span></h3>
<p class="tni">Another useful option is <span class="sans_thesansmonocd_w5regular_">/R</span>, which conveniently stands for <i class="calibre6">recursion</i>. This option empowers the <span class="sans_thesansmonocd_w5regular_">for</span> command to search recursively through a directory and all its subdirectories (and their subdirectories, and so on) for files fitting a mask. Compared to the syntax of the optionless command, its generic syntax differs by more than the option itself:</p>
<pre class="pre"><code class="calibre11">for /R [[<var class="calibre12">drive</var>:]<var class="calibre12">path</var>] %%<var class="calibre12">variable</var> in (<var class="calibre12">input</var>) do <var class="calibre12">command</var></code></pre>
<p class="tx">The most significant difference is that the path to be searched now comes before the <span class="sans_thesansmonocd_w5regular_">for</span> variable. The interpreter is unfazed if you omit the trailing slash, but it’s good form to include it to make clear that it’s a path. The path can be as little as a drive letter followed by a colon, and you’ll need encasing double quotes for any embedded spaces. Inside the parentheses, the <span class="sans_thesansmonocd_w5regular_">input</span> will be one or more space- or comma-delimited masks of filenames without paths. For example, the following searches the <i class="calibre6">C:\Budget\</i> directory and all of its subdirectories for Word documents, writing all that are found to the console:</p>
<pre class="pre"><code class="calibre11">for /R C:\Budget\ %%w in (*.docx) do (
   &gt; con echo Word Document Name is %%w
)
</code></pre>
<p class="tx">The following <span class="sans_thesansmonocd_w5regular_">for</span> command finds those misplaced photos from your trip to Italy, or at least any file with a <i class="calibre6">.jpg</i> or <i class="calibre6">.bmp</i> extension, and a filename starting with <i class="calibre6">Italy</i>. Because of the <span class="sans_thesansmonocd_w5regular_">/R</span> option, the command looks not just in the root <i class="calibre6">C:\</i> folder but everywhere on your <i class="calibre6">C:\</i> drive as well:</p>
<pre class="pre"><code class="calibre11">for /R C:\ %%p in (Italy*.jpg, Italy*.bmp) do (
   &gt; con echo Photo from the Italy Trip is %%p
)
</code></pre>
<p class="tni">(Multiple file masks work in all <span class="sans_thesansmonocd_w5regular_">for</span> commands, regardless of the options or lack of options.)</p>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">for /R</span> command has a couple other variants. The hard brackets surrounding the drive and path in the general syntax mean that they are optional, and if omitted, the current directory is assumed. Hence, the previous command is functionally equivalent to the following since <i class="calibre6">C:\</i> is the current directory:</p>
<pre class="pre"><code class="calibre11">cd C:\
for /R %%p in (Italy*.jpg, Italy*.bmp) do (
   &gt; con echo Photo from the Italy Trip is %%p
)
</code></pre>
<p class="tni">In both examples, <span class="sans_thesansmonocd_w5regular_">%%p</span> resolves to the fully qualified path and filename for each found photo.</p>
<p class="tx">In an odd and subtle batveat, all inputs to a <span class="sans_thesansmonocd_w5regular_">for /R</span> command must contain at least one wildcard character. If you use an explicit filename (or any <span aria-label=" Page 198. " epub:type="pagebreak" id="pg_198" role="doc-pagebreak"/>text without an asterisk or question mark) as input in the prior command, it returns <i class="calibre6">C:\</i> and all of its subdirectories followed by your filename, even if the file doesn’t exist in the directories. To find an explicit filename, you must add a wildcard character somewhere in the filename input. I recommend a trailing asterisk because it usually runs the least risk of accidentally capturing additional files.</p>
<blockquote class="calibre8">
<p class="warning"><span class="sans_dogma_ot_bold_b_1">NOTE</span></p>
</blockquote>
<p class="warning-txt"><i class="calibre6">For better or worse, the interpreter handles the recursion itself, or the stepping into each subfolder, hiding it from you. In <a href="chapter23.xhtml" class="calibre3">Chapter 23</a>, I’ll return to recursion and explain how to define the actual recursive call, opening up many possibilities.</i></p>
</section>
<section aria-labelledby="sec3" epub:type="division">
<h3 class="h" id="sec3"><span id="h1-127"/><span class="sans_futura_std_bold_b_">Directory Recursion</span></h3>
<p class="tni">If the <span class="sans_thesansmonocd_w5regular_">/D</span> option allows for directory searches and the <span class="sans_thesansmonocd_w5regular_">/R</span> option allows for recursive file searches, you might expect that they can be used together for recursive directory searches, and you would be correct. The format follows the general syntax of the <span class="sans_thesansmonocd_w5regular_">/R</span> form of the command with <span class="sans_thesansmonocd_w5regular_">/D</span> coming before <span class="sans_thesansmonocd_w5regular_">/R</span> and with nothing but an asterisk for the <span class="sans_thesansmonocd_w5regular_">input</span> in the parentheses:</p>
<pre class="pre"><code class="calibre11">for /D /R C:\Budget\ %%d in (*) do (
   &gt; con echo Directory is %%d
)
</code></pre>
<p class="tx">Running this code displays all subdirectories of <i class="calibre6">C:\Budget\</i> and all of their subdirectories, and so on. For instance, assuming that two particular subdirectories and one sub-subdirectory exist, this is the output:</p>
<pre class="pre"><code class="calibre11">Directory is C:\Budget\SubDir
Directory is C:\Budget\Taxes
Directory is C:\Budget\SubDir\SubSubDir
</code></pre>
<p class="tx">In a curious oddity, the <span class="sans_thesansmonocd_w5regular_">for /R</span> command alone can perform this same functionality without the <span class="sans_thesansmonocd_w5regular_">/D</span> option, or at least something really similar. To demonstrate, I’ve taken the previous <span class="sans_thesansmonocd_w5regular_">for</span> command and made two small tweaks. I’ve removed the <span class="sans_thesansmonocd_w5regular_">/D</span> option and changed the <span class="sans_thesansmonocd_w5regular_">input</span> from an asterisk to a dot:</p>
<pre class="pre"><code class="calibre11">for /R C:\Budget\ %%d in (.) do (
   &gt; con echo Directory is %%d
)
</code></pre>
<p class="tx">It’s far from intuitive, but the dot inside the parentheses instructs the <span class="sans_thesansmonocd_w5regular_">for /R</span> command to enumerate directories instead of files. (Directory and dot both start with D, if that helps.) This also produces a list of subdirectories, but notice three peculiar differences:</p>
<pre class="pre"><code class="calibre11">Directory is C:\Budget\.
Directory is C:\Budget\SubDir\.
<span aria-label=" Page 199. " epub:type="pagebreak" id="pg_199" role="doc-pagebreak"/>Directory is C:\Budget\SubDir\SubSubDir\.
Directory is C:\Budget\Taxes\.
</code></pre>
<p class="tx">When you use the <span class="sans_thesansmonocd_w5regular_">/R</span> option with the dot as input, the first difference is that the interpreter now enumerates the root directory, in this instance <i class="calibre6">C:\Budget\</i>, as well as the subdirectories. Second, it returns each directory with a trailing backslash followed by a dot, and third, it sorts the output differently, processing subdirectories of a directory before processing its sibling directories. Notice that when using the <span class="sans_thesansmonocd_w5regular_">/D</span> and <span class="sans_thesansmonocd_w5regular_">/R</span> options in tandem with an asterisk, the interpreter processed <i class="calibre6">C:\Budget\Taxes\</i> before <i class="calibre6">C:\Budget\SubDir\SubSubDir\</i>, just the opposite of the results with the <span class="sans_thesansmonocd_w5regular_">/R</span> option with the dot.</p>
<p class="warning"><span class="sans_dogma_ot_bold_b_1">WARNING</span></p>
<p class="warning-txt"><i class="calibre6">Everything I’ve detailed about the dot as input to the</i> <span class="sans_thesansmonocd_w5regular_">for</span> <span class="sans_thesansmonocd_w5regular_italic_i_">/R</span> <i class="calibre6">command is exactly what the help would have you believe, but it isn’t entirely true. The dot at the end of each line of output is just a reproduction of the input. This is another manifestation of the batveat mentioned in the prior section. Any input without a wildcard character tells the command to step through all subdirectories, appending each with that input. The dot nicely terminates each directory in the prior example, but if you instead use a tilde as the input, the resulting directories in the output all end with a tilde, not a dot.</i></p>
<p class="tx">The differences in the output are subtle and, depending on your application, inconsequential, but they’re differences, nonetheless.</p>
</section>
<section aria-labelledby="sec4" epub:type="division">
<h3 class="h" id="sec4"><span id="h1-128"/><span class="sans_futura_std_bold_b_">The Iterative Loop Option</span></h3>
<p class="tni">The <span class="sans_thesansmonocd_w5regular_">/L</span> option turns the <span class="sans_thesansmonocd_w5regular_">for</span> command into an iterative loop, an essential item in any coder’s toolkit and possibly the most used variant of the command. The loops I’ve discussed up to this point have enumerated through a list of files, directories, or text of some sort. However, this option turns the <span class="sans_thesansmonocd_w5regular_">for</span> command into a loop that increments or decrements by some numerical value or step from one number to another with a fixed ending value. Most coding languages implement iterative loops in some fashion. In fact, many also have a command called <span class="sans_thesansmonocd_w5regular_">for</span> specifically for this purpose. Batch is unique in that the <span class="sans_thesansmonocd_w5regular_">for</span> command does so much else.</p>
<p class="tx">The general syntax to turn the command into an iterative loop is:</p>
<pre class="pre"><code class="calibre11">for /L %%<var class="calibre12">variable</var> in (<var class="calibre12">start</var>, <var class="calibre12">step</var>, <var class="calibre12">end</var>) do <var class="calibre12">command</var></code></pre>
<p class="tx">Other than the addition of the <span class="sans_thesansmonocd_w5regular_">/L</span> option, the only other difference between this and the optionless <span class="sans_thesansmonocd_w5regular_">for</span> command is the data inside of the parentheses, where three comma-delimited numbers now make up the input. The first is the <span class="sans_thesansmonocd_w5regular_italic_i_">start</span>, or beginning index; the second is the <span class="sans_thesansmonocd_w5regular_italic_i_">step</span>, or the amount by which that index increments for each iteration of the loop; and the last is the <span class="sans_thesansmonocd_w5regular_italic_i_">end</span>, or last possible value the index can take.</p>
<p class="tx"><span aria-label=" Page 200. " epub:type="pagebreak" id="pg_200" role="doc-pagebreak"/>To demonstrate, this <span class="sans_thesansmonocd_w5regular_">for /L</span> loop starts with the value <span class="sans_thesansmonocd_w5regular_">1</span>, each iteration steps by <span class="sans_thesansmonocd_w5regular_">2</span>, and it ends at <span class="sans_thesansmonocd_w5regular_">3</span>:</p>
<pre class="pre"><code class="calibre11">for /L %%i in (1, 2, 3) do  &gt; con echo Index is %%i</code></pre>
<p class="tx">This command sets the <span class="sans_thesansmonocd_w5regular_">for</span> variable, <span class="sans_thesansmonocd_w5regular_">%%i</span>, to <span class="sans_thesansmonocd_w5regular_">1</span> during the first iteration of the loop; then it increments or steps by <span class="sans_thesansmonocd_w5regular_">2</span> so that <span class="sans_thesansmonocd_w5regular_">%%i</span> resolves to <span class="sans_thesansmonocd_w5regular_">3</span> the second time through. That matches the ending value, so the loop doesn’t execute again. Here’s the output to the console:</p>
<pre class="pre"><code class="calibre11">Index is 1
Index is 3
</code></pre>
<p class="tx">The following <span class="sans_thesansmonocd_w5regular_">for</span> command starts with the variable set to <span class="sans_thesansmonocd_w5regular_">10</span> and then increments by <span class="sans_thesansmonocd_w5regular_">1</span> up to <span class="sans_thesansmonocd_w5regular_">12</span>:</p>
<pre class="pre"><code class="calibre11">for /L %%i in (10, 1, 12) do  &gt; con echo Index is %%i</code></pre>
<p class="tni">This iterates through the indices of <span class="sans_thesansmonocd_w5regular_">10</span>, <span class="sans_thesansmonocd_w5regular_">11</span>, and <span class="sans_thesansmonocd_w5regular_">12</span>.</p>
<p class="tx">To decrement the index, assign a negative value to the step:</p>
<pre class="pre"><code class="calibre11">for /L %%i in (2, -1, 0) do  &gt; con echo Index is %%i</code></pre>
<p class="tni">This results in the index descending from <span class="sans_thesansmonocd_w5regular_">2</span> to <span class="sans_thesansmonocd_w5regular_">0</span>:</p>
<pre class="pre"><code class="calibre11">Index is 2
Index is 1
Index is 0
</code></pre>
<p class="tx">All three of the numerical inputs can be negative:</p>
<pre class="pre"><code class="calibre11">for /L %%i in (-1, -3, -7) do  &gt; con echo Index is %%i</code></pre>
<p class="tni">This <span class="sans_thesansmonocd_w5regular_">for</span> loop executes for these three indices:</p>
<pre class="pre"><code class="calibre11">Index is -1
Index is -4
Index is -7
</code></pre>
<p class="tx">Given the following start and step values, it’s clear that the <span class="sans_thesansmonocd_w5regular_">for</span> command generates an increasing sequence of positive multiples of <span class="sans_thesansmonocd_w5regular_">10</span>, starting with <span class="sans_thesansmonocd_w5regular_">10</span>:</p>
<pre class="pre"><code class="calibre11">for /L %%i in (10,10,35) do  &gt; con echo Index is %%i</code></pre>
<p class="tx">What’s less clear is exactly where the sequence ends. The <span class="sans_thesansmonocd_w5regular_">end</span> value of <span class="sans_thesansmonocd_w5regular_">35</span> isn’t a multiple of <span class="sans_thesansmonocd_w5regular_">10</span>, so it isn’t in the sequence, but once the index is greater than <span class="sans_thesansmonocd_w5regular_">35</span>, the loop ends, so <span class="sans_thesansmonocd_w5regular_">30</span> is the last number in the sequence. The command would’ve been functionally equivalent if the end value had been <span aria-label=" Page 201. " epub:type="pagebreak" id="pg_201" role="doc-pagebreak"/><span class="sans_thesansmonocd_w5regular_">30</span>, <span class="sans_thesansmonocd_w5regular_">39</span>, or any integer in between, but for clarity, <span class="sans_thesansmonocd_w5regular_">30</span> would’ve been the best option. Also, notice that I omitted the spaces after the commas in the <span class="sans_thesansmonocd_w5regular_">input</span>. I usually include the spaces for readability, but this example demonstrates that they aren’t needed (and easily forgotten).</p>
<section aria-labelledby="sec5" epub:type="division">
<h4 class="h1" id="sec5"><span id="h2-50"/><span class="sans_futura_std_heavy_oblique_bi_">Power Function Routine</span></h4>
<p class="tni">Unfortunately, Batch doesn’t support the power function. In <span class="xref"><a href="chapter6.xhtml" class="calibre3">Chapter 6</a></span>, I mentioned that we could write a short routine for the task, and here is the promised routine, which uses an iterative loop. It accepts three parameters: the base of the exponential, the exponent, and the name of the return variable containing the result:</p>
<pre class="pre"><code class="calibre11">:Pow
 set %3=1 
 for /L %%i in (1, 1, %2) do  set /A %3 *= %1
 goto :eof
</code></pre>
<p class="tni">(If the return parameter has you bamboozled, return to <span class="xref"><a href="chapter11.xhtml" class="calibre3">Chapter 11</a></span>.)</p>
<p class="tx">I’m initializing the return parameter to <span class="sans_thesansmonocd_w5regular_">1</span>. Then the loop starts at <span class="sans_thesansmonocd_w5regular_">1</span>, increments by <span class="sans_thesansmonocd_w5regular_">1</span>, and increases up to the value of the exponent or the second parameter. Hence, the loop executes <i class="calibre6">n</i> times if the exponent is <i class="calibre6">n</i>. The command inside the loop multiplies the return parameter by the base of the exponential or the first parameter. Hence, if the base is <i class="calibre6">b</i>, this <span class="sans_thesansmonocd_w5regular_">for</span> loop multiples together <i class="calibre6">n</i> copies of <i class="calibre6">b</i>. When the loop is done, the return parameter contains <i class="calibre6">b</i><i class="calibre6"><sup class="calibre14">n</sup></i>, and the routine ends.</p>
<p class="tx">To find <span class="sans_thesansmonocd_w5regular_">5</span><span class="sans_thesansmonocd_w5regular_sup_">3</span>, call the routine passing these three arguments:</p>
<pre class="pre"><code class="calibre11">call :Pow 5 3 pow
&gt; con echo Five cubed = %pow%
</code></pre>
<p class="tni">The code multiplies <span class="sans_thesansmonocd_w5regular_">3</span> copies of <span class="sans_thesansmonocd_w5regular_">5</span> and writes <span class="sans_thesansmonocd_w5regular_">Five cubed = 125</span> to the console.</p>
</section>
<section aria-labelledby="sec6" epub:type="division">
<h4 class="h1" id="sec6"><span id="h2-51"/><span class="sans_futura_std_heavy_oblique_bi_">A Case Study</span></h4>
<p class="tni">As a seven-year-old mathematical prodigy in the late 18th century, the great mathematician Carl Friedrich Gauss received, along with the rest of his class, some busywork from the teacher. The students were to add up all of the numbers from 1 to 100. Moments later, the teacher looked up and saw all of the children busily adding with their chalk and slate, except for one. He approached the young Gauss, preparing a stern reprimand, only to notice the correct answer of 5,050 written on the boy’s piece of slate.</p>
<p class="tx">Gauss had realized that there were 50 pairs of numbers adding up to 101 (100 + 1, 99 + 2, ..., 51 + 50). He quickly multiplied 50 by 101, wrote down the answer, and sat back waiting for his peers to finish, probably wondering what was taking them so long.</p>
<p class="tx">There are other variations of this story, and it may be apocryphal, but if any of those other students had had access to a Windows computer, they <span aria-label=" Page 202. " epub:type="pagebreak" id="pg_202" role="doc-pagebreak"/>may have been able to complete the task even before the young genius—that is, if they could have quickly typed the following:</p>
<pre class="pre"><code class="calibre11">set sum=0
for /L %%i in (1, 1, 100) do (
   set /A sum += %%i
)
&gt; con echo The sum is %sum%.
</code></pre>
<p class="tx">This loop iterates the <span class="sans_thesansmonocd_w5regular_">%%i</span> index from <span class="sans_thesansmonocd_w5regular_">1</span> to <span class="sans_thesansmonocd_w5regular_">100</span>, where the <span class="sans_thesansmonocd_w5regular_">set /A</span> command tallies up all of the indices. Before the loop, the <span class="sans_thesansmonocd_w5regular_">set</span> command explicitly initializes <span class="sans_thesansmonocd_w5regular_">sum</span> to <span class="sans_thesansmonocd_w5regular_">0</span>, thus guaranteeing that the final result is the desired value. Gauss’s tech-savvy classmates could’ve then rewritten the output <span class="sans_thesansmonocd_w5regular_">The sum is 5050.</span> on their pieces of slate in a time comparable to Gauss himself.</p>
<aside aria-label="box-4" class="box">
<p class="boxtitle" id="box-4"><span class="sans_futura_std_bold_b_">AN ARITHMETIC DIGRESSION FOR MY FELLOW MATH GEEKS</span></p>
<p class="boxbodyfirst"><span class="sans_futura_std_book_">As a further mathematical digression, what would have transpired if Gauss had had Batch like his theoretical classmate? He realized that to add the numbers 1 through</span> <span class="futura_std_book_oblique_i_">n</span><span class="sans_futura_std_book_">, he needed to multiply one-half of</span> <span class="futura_std_book_oblique_i_">n</span> <span class="sans_futura_std_book_">by one more than</span> <span class="futura_std_book_oblique_i_">n</span><span class="sans_futura_std_book_">. I’m sure that he would have looked for a more generic and efficient solution. With this in mind, would he have used the following code instead of the</span> <span class="sans_thesansmonocd_w5regular_">for</span> <span class="sans_futura_std_book_">loop?</span></p>
<pre class="pre"><code class="calibre11"><span class="sans_thesansmonocd_w5regular_">set n=100</span>
<span class="sans_thesansmonocd_w5regular_">set /A sum = (n / 2) * (n + 1)</span>
</code></pre>
<p class="boxbody"><span class="sans_futura_std_book_">Probably not; this arithmetic and code looks straightforward, and this particular example would’ve worked great—for this particular value of</span> <span class="futura_std_book_oblique_i_">n</span><span class="sans_futura_std_book_">. But in general, for any positive value of</span> <span class="futura_std_book_oblique_i_">n</span><span class="sans_futura_std_book_">, this logic would’ve worked only half of the time.</span></p>
<p class="boxbody"><span class="sans_futura_std_book_">The beauty of Gauss’ elegant solution is that it works for all positive integers, including odd and even numbers alike. The sum of the numbers 1 through 9 is equal to the product of 4.5 and 10, or 45. Gauss surely would’ve noticed that the arithmetic in the previous code would’ve failed for odd numbers because Batch doesn’t intrinsically support floating-point arithmetic. The interpreter considers 9/2 to be 4, not 4.5. This truncation of the decimal part essentially rounds down the intermediate arithmetic, resulting in an incorrect result.</span></p>
<p class="boxbody"><span class="sans_futura_std_book_">Even at such a young age, I’m sure that Gauss was too smart and driven to leave this solution unfinished. (This has absolutely nothing to do with my own compulsion to not leave a solution half-solved.) It isn’t elegant, but adding</span> <span class="sans_thesansmonocd_w5regular_">(n %% 2) * (n + 1) / 2</span> <span class="sans_futura_std_book_">to the prior expression adds back exactly what was lost by the truncation:</span></p>
<pre class="pre"><code class="calibre11"><span class="sans_thesansmonocd_w5regular_">set /A sum = (n / 2) * (n + 1) + (n %% 2) * (n + 1) / 2</span>
</code></pre>
<p class="boxbody"><span aria-label=" Page 203. " epub:type="pagebreak" id="pg_203" role="doc-pagebreak"/><span class="sans_futura_std_book_">The result of the modulo is</span> <span class="sans_thesansmonocd_w5regular_">1</span> <span class="sans_futura_std_book_">for odd numbers, thus adding back half of</span> <span class="futura_std_book_oblique_i_">n</span> <span class="sans_futura_std_book_">+ 1. For even numbers, the modulo is</span> <span class="sans_thesansmonocd_w5regular_">0</span><span class="sans_futura_std_book_">, thus not contributing erroneously to the already correct result. This solution works for all positive integers—and all eras.</span></p>
</aside>
</section>
</section>
<section aria-labelledby="sec7" epub:type="division">
<h3 class="h" id="sec7"><span id="h1-129"/><span class="sans_futura_std_bold_b_">Summary</span></h3>
<p class="tni">In this chapter, you learned about three options of the <span class="sans_thesansmonocd_w5regular_">for</span> command. The <span class="sans_thesansmonocd_w5regular_">/D</span> option allows the command to enumerate through directories instead of files, and the <span class="sans_thesansmonocd_w5regular_">/R</span> option uses recursion to traverse subdirectories. I even demonstrated two methods of recursively enumerating directories.</p>
<p class="tx">You also learned how to create an iterative loop with the <span class="sans_thesansmonocd_w5regular_">/L</span> option and all of its facets. I used the <span class="sans_thesansmonocd_w5regular_">for</span> command with this option to create a routine for raising one number to another, and I even got in a quick mathematical history lesson and a little Batch arithmetic.</p>
<p class="tx">That leaves one option left, and you’ll learn all about it in the next chapter. It allows for the reading of files and much more.</p>
</section>
</section>
</div></body></html>