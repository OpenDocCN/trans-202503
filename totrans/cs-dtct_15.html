<html><head></head><body>
<h2 class="h2" id="ch16"><span epub:type="pagebreak" id="page_127"/>—16—<br/>Inverted Indexes: The Search Narrows</h2>&#13;
<p class="noindent">The gentle tinkle of a bell announced Frank’s arrival at Cloaks and More in the center of the capital the next morning. Nearly every square inch of the small shop was packed tight with racks of cloaks. Frank forced his way through a narrow gap between racks toward the counter in the back.</p>&#13;
<p class="indent">A small balding man peered up through thick glasses. “Welcome to Cloaks and More. I am Gilbert Cloaksworth. How can I help you today?”</p>&#13;
<p class="indent">He looked Frank up and down. His eyes flicked repeatedly to Frank’s well-worn trench cloak, and when he noticed a patch near the shoulder, the shop owner shuddered.</p>&#13;
<p class="indent">“I see you are in the market for a new cloak,” he ventured with the fake cheeriness perfected by snobby shopkeepers the world over. “You have come to the right place. We’ve just received a wonderful shipment of forest green traveling cloaks.”</p>&#13;
<p class="indent">“I’m looking for information,” said Frank. He pulled out the threads from the ArrayCart and held them out to the man. “I need to know what cloak these came from.”</p>&#13;
<p class="indent">Mr. Cloaksworth didn’t move. “Not a new cloak?”</p>&#13;
<p class="indent">“Just information.”</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_128"/><img src="../images/f0128-01.jpg" alt="image"/></div>&#13;
<p class="indent">“A pity,” said Cloaksworth coldly. “But I guess you still came to the right place. I am the city’s foremost expert in cloaks.” The shop owner took the threads and peered at them for a moment. Then he pulled a large magnifying glass from under the counter and examined them at length.</p>&#13;
<p class="indent">“Black and orange with a cross-weave stitch,” Cloaksworth muttered. “Reasonable quality. Not up to my standards, of course, but reasonable.”</p>&#13;
<p class="indent">“Can you tell me anything else?” prompted Frank. “Something useful perhaps?”</p>&#13;
<p class="indent">The shop owner scowled, but continued studying the threads. “A trace of charring,” he said finally.</p>&#13;
<p class="indent">“It was in a fire?” Frank asked.</p>&#13;
<p class="indent">“No. It’s too patterned for that. I’ve only seen this type of charring a few times in my life. Always on wizards’ cloaks. This cloak had a spell placed on it.”</p>&#13;
<p class="indent">“Do you know what type?” asked Frank.</p>&#13;
<p class="indent">Cloaksworth shook his head. “You should ask a wizard. I am the region’s foremost expert in cloaks, not spells.”</p>&#13;
<p class="indent">“How about the coloring?” asked Frank. “I haven’t seen many cloaks with those colors. Can you tell me anything about where it might be from?”</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_129"/>Cloaksworth smiled. “Of course I can. I am the kingdom’s foremost expert in cloaks.”</p>&#13;
<p class="indent">He turned and pulled a gigantic book from a shelf and dropped it on the counter with a loud thud. He flipped to the back.</p>&#13;
<p class="indent">“What are you doing?” asked Frank.</p>&#13;
<p class="indent">“Looking up these colors in <em>The Registry of Cloaks and Heraldry, Volume 5</em>,” responded the shop owner. “You wanted to know where they came from, didn’t you?”</p>&#13;
<p class="indent">“But why are you reading the back of the book?” said Frank. “Shouldn’t you be starting at the table of contents?”</p>&#13;
<p class="indent">Cloaksworth finally gave a genuine smile. “There have been wonderful advances in heraldry tracking the past few years!” he exclaimed. “Traditionally, we did exactly what you suggested: scanned the table of contents for the subject of interest and then flipped to the correct page—using binary search, of course.</p>&#13;
<p class="indent">“And it is true that the table of contents provides an index into books’ subjects. But the table of contents is organized all wrong for this type of search. It lists topics by the order in which they occur. That’s a fine ordering if you want to know what comes next, but not if you are looking for a very particular subject. The kingdom now has over 10,000 cloak patterns! It can take a long time just to search the table of contents.</p>&#13;
<p class="indent">“So Amanda Cloakington, the author <em>The Registry of Cloaks and Heraldry</em> and a personal hero of mine, developed the inverted index. She tracked important terms, such as cloak colors, and indexed them in back of the book—almost like a second table of contents.”</p>&#13;
<div class="image"><img src="../images/f0129-01.jpg" alt="image"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_130"/>“How does that help?” asked Frank. “She’s just repeating the information that’s in the table of contents.”</p>&#13;
<p class="indent">“Yes. She repeated information, but she used a different order. She organized the index at the back in order of the terms. Then for each term, she listed the pages where it occurred.”</p>&#13;
<p class="indent">Frank stared at him, waiting. But the owner seemed to have finished. “So?” Frank prompted.</p>&#13;
<p class="indent">“You only need to look up the term you want, and the index directs you to the corresponding pages!” he exclaimed. “No more muddling through the table of contents. Your search becomes a lookup.”</p>&#13;
<p class="indent">“But you still need to search the index to find the correct term, right?” asked Frank.</p>&#13;
<p class="indent">“Well, yes. But since the index is sorted alphabetically by the terms, you can just use binary search.”</p>&#13;
<p class="indent">“What if the item appears on a lot of pages?”</p>&#13;
<p class="indent">“You need to check them all,” Cloaksworth conceded.</p>&#13;
<p class="indent">“What if you are looking for a few terms?” asked Frank. “Like three colors of thread?”</p>&#13;
<p class="indent">“Ah! Now that’s where it gets interesting,” said Cloaksworth. “You just need to check the pages they have in common. You can find those by <em>intersecting</em> the sets of page numbers. That means going through the lists and finding the elements that occur in <em>every</em> list. If you have enough terms, you can usually narrow down the pages they’re on to just one or two.</p>&#13;
<p class="indent">“The other day I had to look up a navy blue and royal blue cloak with wooden buttons. I can tell you that there aren’t many of those in the world. In fact, just one group uses that combination—the Association of Amateur Weather Forecasters. Until last year, they had been using navy blue and dark turquoise, but they were forced to change. The Association of Semiprofessional Weather Forecasters claimed, rightfully, that the colors were too similar to their own navy blue and light turquoise.”</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_131"/><img src="../images/f0131-01.jpg" alt="image"/></div>&#13;
<p class="indent">Frank thought about it for a moment and nodded. “Interesting idea,” he allowed. He could immediately see how such inverted indexes could be applied to other information sources. Police records were always sorted by date. Using this new technique, you could also index them by the type of crime or the location. These indexes could make research orders of magnitude more efficient.</p>&#13;
<p class="indent">“I wonder if it’ll catch on for other books,” Frank mused.</p>&#13;
<p class="indent">“Unlikely,” the shop owner scoffed. “Few topics in this world are complicated enough to require an index. Not every topic is as rich as cloakology.”</p>&#13;
<p class="indent">As he spoke, the shop owner searched through the index and proceeded to flip rapidly through the book. “Police cloak,” he said at last. “The departments of Bool and Functionia use those colors. So do a few of the capital police force’s departments. Accounting, Payroll, Records, and Advisory Signage, I believe. All different designs, of course. I expect the cloak is a new issue, given the state of the threads. Police officers have a tendency to wear out cloaks quickly, especially in the Department of Advisory Signage.”</p>&#13;
<p class="indent">“A new police cloak?” Frank confirmed.</p>&#13;
<p class="indent">“Most likely,” said Cloaksworth. “I doubt it is a custom design. Those colors were popular 20 years ago, but fell out of favor with the rise of pastels. It’s a shame, really—there were some beautiful cloaks back in those days. I once made a riding cloak with double fastenings and—”</p>&#13;
<p class="indent">Frank interrupted him, “Anything else you can tell me about the threads?”</p>&#13;
<p class="indent">The shop owner looked at him. “Aside from the fact that they are probably from a new police cloak from one of four departments and it was enchanted with a magic spell?”</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_132"/>Frank waited.</p>&#13;
<p class="indent">“Uh . . . no,” said Cloaksworth finally. “That’s everything.”</p>&#13;
<p class="indent">Frank nodded. “Thanks,” he said. He picked up the threads and turned to leave. He heard a soft gasp as he opened the door and knew the shop owner had seen the ragged edge at the bottom of his trench cloak.</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart"><strong>POLICE ALGORITHMS 101: INVERTED INDEXES</strong></p>&#13;
<p class="sbsub"><em><strong>Excerpt from Professor Drecker’s Lecture</strong></em></p>&#13;
<p class="noindent">An inverted index is a computational data structure similar to the index of a book. It provides a mapping from target values to the location in the data where those values occur. Inverted indexes are especially useful when a given value occurs, or might occur, repeatedly throughout the data.</p>&#13;
<p class="indent">Consider an example from our lecture on binary search—checking an accounting ledger for transactions with a particular merchant. The ledgers are sorted by increasing transaction number, indicating the order in which the transactions were recorded.</p>&#13;
<div class="image"><img src="../images/f0132-01.jpg" alt="image"/></div>&#13;
<p class="indent">While this ordering allows us to efficiently find information for a given transaction ID, it doesn’t help us trace transactions to a particular merchant. One option would be <span epub:type="pagebreak" id="page_133"/>to re-sort the entries by merchant name. However, this requires us to make a copy of the entire ledger, which can be costly.</p>&#13;
<p class="indent">Instead, we can build an additional data structure: an inverted index, keyed by merchant name. For each merchant, we then store just a list of all the relevant transaction IDs. Since we already know how to efficiently look up any transaction given its ID, we can now get from merchant name to transaction information via an additional lookup in our index.</p>&#13;
<div class="image"><img src="../images/f0133-01.jpg" alt="image"/></div>&#13;
<p class="indent">Inverted indexes are a great example of a common tradeoff between running time and memory usage. An algorithm can trade an increase in memory usage, in the form of an additional index, for significantly more efficient searches along a new dimension.<span epub:type="pagebreak" id="page_134"/></p>&#13;
</div>&#13;
</body></html>