<html><head></head><body>
<h2 class="h2" id="ch07"><a id="page_119"/><strong>7</strong></h2>
<p class="h2a"><strong>ENVIRONMENTAL MONITORING</strong></p>
<div class="image1"><img src="graphics/f0001-01.jpg" alt="image"/></div>
<p class="noindent">Zombies are pretty frightening, but they’re not the only threat in a postapocalyptic world. More mundane risks like fire are especially serious if you can’t safely leave your compound (see <a href="ch07.html#ch07fig1">Figure 7-1</a>). In this chapter, I’ll show you how to build a fire alarm and a temperature alarm that alert you to environmental hazards—without alerting the zombies.</p>
<div class="image"><a id="page_120"/><img src="graphics/f07-01.jpg" alt="image"/></div>
<p class="figuret"><a id="ch07fig1">Figure 7-1:</a> No smoking!</p>
<h3 class="h3" id="ch00lev1sec121"><strong>PROJECT 11: QUIET FIRE ALARM</strong></h3>
<p class="noindent">Normally, you want a fire alarm to be as close to you as possible and as noisy as possible. But there’s one problem with loud alarms: zombies can hear. The last thing you want when escaping a burning building is to attract unwanted attention from passing zombies!</p>
<p class="indent">This project modifies a regular battery-operated smoke detector so that it registers an alarm on the Arduino display and sounds a much quieter buzzer, using the basic setup from “<a href="ch03.html#ch00lev1sec63">Project 4: Battery Monitor</a>” on <a href="ch03.html#page_53">page 53</a>. <a href="ch07.html#ch07fig2">Figure 7-2</a> shows the smoke detector connected directly to the screwshield.</p>
<div class="image"><a id="page_121"/><img src="graphics/f07-02.jpg" alt="image"/></div>
<p class="figuret"><a id="ch07fig2">Figure 7-2:</a> Testing the finished fire alarm. In your base, the detector will be connected to the Arduino by a long lead.</p>
<h4 class="h4" id="ch00lev1sec122"><strong>WHAT YOU WILL NEED</strong></h4>
<p class="noindent">To make this project, you’ll need the Arduino and screwshield that you used in “<a href="ch03.html#ch00lev1sec63">Project 4: Battery Monitor</a>” on <a href="ch03.html#page_53">page 53</a> as well as the following parts:</p>
<table border="0" cellpadding="0" cellspacing="0" class="topbot" width="100%">
<thead>
<tr>
<th valign="top" class="table_th"><p class="table1"><strong>ITEMS</strong></p></th>
<th valign="top" class="table_th"><p class="table1"><strong>NOTES</strong></p></th>
<th valign="top" class="table_th"><p class="table1"><strong>SOURCE</strong></p></th>
</tr>
</thead>
<tbody>
<tr>
<td valign="top" class="table"><p class="table-b"><img src="graphics/square.jpg" alt="image"/> Smoke detector</p></td>
<td valign="top" class="table"><p class="table">Battery operated</p></td>
<td valign="top" class="table"><p class="table">Hardware store, Supermarket</p></td>
</tr>
<tr>
<td valign="top" class="table"><p class="table-b"><img src="graphics/square.jpg" alt="image"/> Cable</p></td>
<td valign="top" class="table"><p class="table">Double core and long enough to reach from the smoke detector to the Arduino</p></td>
<td valign="top" class="table"><p class="table">Scavenged speaker or bell cable is good for this.</p></td>
</tr>
<tr>
<td valign="top" class="table"><p class="table-b"><img src="graphics/square.jpg" alt="image"/> D1</p></td>
<td valign="top" class="table"><p class="table">1N4001 diode</p></td>
<td valign="top" class="table"><p class="table">Adafruit (755)</p></td>
</tr>
<tr>
<td valign="top" class="table"><p class="table-b"><img src="graphics/square.jpg" alt="image"/> R1</p></td>
<td valign="top" class="table"><p class="table">1 kΩ resistor</p></td>
<td valign="top" class="table"><p class="table">Mouser (293-1k-RC)</p></td>
</tr>
<tr>
<td valign="top" class="table"><p class="table-b"><img src="graphics/square.jpg" alt="image"/> LED1</p></td>
<td valign="top" class="table"><p class="table">Blue or white LED</p></td>
<td valign="top" class="table"><p class="table">Adafruit (301)</p></td>
</tr>
<tr>
<td valign="top" class="table"><p class="table-b"><img src="graphics/square.jpg" alt="image"/> C1</p></td>
<td valign="top" class="table"><p class="table">100 µF capacitor</p></td>
<td valign="top" class="table"><p class="table">Adafruit (753)</p></td>
</tr>
<tr>
<td valign="top" class="table"><p class="table-b"><img src="graphics/square.jpg" alt="image"/> Solid-core wire</p></td>
<td valign="top" class="table"><p class="table">2 inches (5 cm) long</p></td>
<td valign="top" class="table"><p class="table">Abandoned electronics, Adafruit (1311)</p></td>
</tr>
</tbody>
</table>
<p class="indent">Be sure to use the LED colors I recommend, as I don’t suggest blue or white LEDs just because they look cool. For this project’s circuit to work, the LED needs to have a forward voltage of more than about 2V. Red and green LEDs often have a forward voltage of about 1.7V, but blue and white LEDs have a much higher forward voltage of around 3V, which is perfect.</p>
<h4 class="h4" id="ch00lev1sec123"><a id="page_122"/><strong>CONSTRUCTION</strong></h4>
<p class="noindent">To adapt the smoke detector to communicate silently with the Arduino, you’ll disconnect the detector’s buzzer from its circuit board and then change the signal that would go to the buzzer into a signal the Arduino can use. You’ll condition the buzzer signal by sending it through the circuit (<a href="ch07.html#ch07fig3">Figure 7-3</a>).</p>
<div class="image"><img src="graphics/f07-03.jpg" alt="image"/></div>
<p class="figuret"><a id="ch07fig3">Figure 7-3:</a> Schematic for the fire alarm</p>
<p class="indent">A typical smoke alarm is really loud because its buzzer is driven with the highest possible voltage the circuit can wring out of a little 9V battery. This means that for most alarms, the signal on the buzzer looks something like the chart on the left of <a href="ch07.html#ch07fig4">Figure 7-4</a>.</p>
<div class="image"><img src="graphics/f07-04.jpg" alt="image"/></div>
<p class="figuret"><a id="ch07fig4">Figure 7-4:</a> Taming the buzzer signal for Arduino is much easier than taming a zombie!</p>
<p class="indent"><a id="page_123"/>The buzzer is driven by an alternating current (AC) square wave, with a voltage that swings from +9V to –9V at roughly 600 times per second. This causes a piezo element to alternately expand and contract, generating the buzzing sound. But this voltage swing is too wild for the Arduino, which can be damaged by inputs greater than 5V or less than 0V.</p>
<p class="indent">The circuit to convert the buzzer signal begins with the diode D1, which completely prevents the negative voltages from reaching the rest of the circuit (diodes only allow current to flow in one direction). The resistor limits the current flowing to the LED, which limits the voltage across the LED to about 3V. The capacitor gets rid of any voltage spikes and smoothes out the signal to something like the chart on the right in <a href="ch07.html#ch07fig4">Figure 7-4</a>.</p>
<h5 class="h5" id="ch00lev1sec124"><strong>STEP 1: DISCONNECT THE BUZZER</strong></h5>
<p class="noindent">First, disassemble the smoke detector. When you remove the lid, you should see a PCB and some wires (<a href="ch07.html#ch07fig5">Figure 7-5</a>).</p>
<div class="image"><img src="graphics/f07-05.jpg" alt="image"/></div>
<p class="figuret"><a id="ch07fig5">Figure 7-5:</a> Inside the smoke detector</p>
<p class="indent">In this smoke detector, the three leads going from the circuit board to the lid are the buzzer leads. Chop off the leads to the buzzer now, but don’t cut too close to the buzzer itself. Resources are scarce during an apocalypse, and you might want to repurpose that buzzer later.</p>
<div class="sidebar">
<p class="sidebart"><a id="page_124"/><strong>DANGER: RADIATION!</strong></p>
<p class="noindent">As you start this project, keep two warnings in mind. First, if you take apart your smoke detector before the zombie outbreak, do not use it as a smoke detector again. Smoke detectors save thousands of lives a year, so don’t rely on one you’ve messed with; just buy a new one.</p>
<p class="indent">Second, although removing the smoke detector’s plastic case is safe, if your smoke detector has a round metal box inside (see <a href="ch07.html#ch07fig5">Figure 7-5</a>), do <span class="underline">not</span> open that box, as it contains a radiation source that ionizes air in a small chamber. Smoke particles will absorb the ions, and the resulting reduction in current through the ionized air triggers the alarm. This type of smoke detector is gradually being replaced by designs that detect smoke optically instead, so hopefully, yours won’t have that box at all.</p>
</div>
<div class="note">
<p class="notet"><span class="font1"><strong>NOTE</strong></span></p>
<p class="noindent">You can use the buzzer from your smoke detector to build “<a href="ch09.html#ch00lev1sec167">Project 16: Arduino Movement and Sound Distractor</a>” on <a href="ch09.html#page_169">page 169</a>. If you’ve ever been close to one of these smoke alarms when they sound, you’ll know just how distracting they are!</p>
</div>
<p class="indent">Your buzzer may have two leads or three leads. If it has three, follow Step 2 to determine which lead is which. If it has just two, these are the leads that you will connect to, and you can skip Step 2.</p>
<h5 class="h5" id="ch00lev1sec125"><strong>STEP 2: IDENTIFY THE LEADS</strong></h5>
<p class="noindent">If your buzzer has three connections, then your smoke alarm uses a type of piezo buzzer called a <em>self-drive piezo</em>. The third connection is called the <em>feedback</em> connection and is used to make the piezo sound as loud as possible.</p>
<p class="indent">For this project, you just want the two drive connections on the smoke detector. Sometimes the wires are color coded; if so, the drive connections will probably be red and black, and the feedback connection might be white (see <a href="ch07.html#ch07fig6">Figure 7-6</a>) or some other color. But if you have a multimeter, then you can just check which wires are the drive wires and avoid guesswork. <a href="ch07.html#ch07fig6">Figure 7-6</a> shows this process in action.</p>
<div class="image"><a id="page_125"/><img src="graphics/f07-06.jpg" alt="image"/></div>
<p class="figuret"><a id="ch07fig6">Figure 7-6:</a> Identifying the smoke alarm buzzer wires</p>
<p class="indent">Strip the ends of all three wires and set your multimeter to its 200V AC range if it’s available on your meter, or at least the 10V AC range. (Yes, I mean AC, not the usual DC.) Connect the multimeter leads to any two of the three wires and measure the voltage as you hold down the contacts of the smoke alarm’s “test” switch. If the meter indicates about 9V, or anything above 4V or 5V, then these are the wires you are looking for; otherwise, try different pairs until you find the correct wires. Note that the project relies on the battery or batteries still being present in the smoke alarm.</p>
<h5 class="h5" id="ch00lev1sec126"><strong>STEP 3: SOLDER COMPONENTS TO THE SCREWSHIELD</strong></h5>
<p class="noindent">This circuit has too many components to attach all of them to the screw terminals, so use the prototyping area on the screwshield to solder the components into place. <a href="ch07.html#ch07fig7">Figure 7-7</a> shows the wiring diagram for the screwshield; the letters marked will be used later to describe just how to solder this together.</p>
<div class="note">
<p class="notet"><span class="font1"><strong>NOTE</strong></span></p>
<p class="noindent">For the sake of clarity, <a href="ch07.html#ch07fig7">Figure 7-7</a> doesn’t include components from earlier Arduino-based projects that might be hanging off the screwshield.</p>
</div>
<div class="image"><a id="page_126"/><img src="graphics/f07-07.jpg" alt="image"/></div>
<p class="figuret"><a id="ch07fig7">Figure 7-7:</a> Wiring diagram for the screwshield</p>
<p class="indent">Holding your screwshield so that it looks like <a href="ch07.html#ch07fig7">Figure 7-7</a>, push the component legs through from the top of the board. Note that the diode (labeled D1) and LED are <em>polarized</em>, meaning they only work when oriented a certain way. Point the diode’s stripe toward the top of the board. Then place the LED’s longer lead (the positive lead) toward the bottom of the board (<a href="ch07.html#ch07fig7">Figure 7-7</a>).</p>
<p class="indent">When you’ve pushed all the component leads through, flip the board over and solder the leads where they emerge from the hole. (If you are new to soldering, take a look at <a href="app02.html#app02">Appendix B</a>, especially “<a href="app02.html#ch00lev1sec229">Soldering a PCB</a>” on <a href="app02.html#page_234">page 234</a>.) It may help to bend the leads slightly so that the components don’t fall out when the board is upside down. When all the components are soldered, the underside of the board should look like <a href="ch07.html#ch07fig8">Figure 7-8</a>.</p>
<div class="image"><a id="page_127"/><img src="graphics/f07-08.jpg" alt="image"/></div>
<p class="figuret"><a id="ch07fig8">Figure 7-8:</a> Fixing the components in place</p>
<p class="indentb">Now that the components are fixed, bend the leads and arrange them to make the connections, using <a href="ch07.html#ch07fig9">Figure 7-9</a> and the steps below as a guide. (The connections described below are indicated in <a href="ch07.html#ch07fig7">Figures 7-7</a>, <a href="ch07.html#ch07fig9">7-9</a>, and <a href="ch07.html#ch07fig10">7-10</a> with letters.)</p>
<p class="order">1. Bend the top (negative) lead of the LED over so that it lies next to the top lead of C1 and the GND power line on the screwshield (A). Solder the LED lead where it crosses C1 and then where it meets the GND line. Cut off the excess LED lead and the remainder of the top lead of C2.</p>
<p class="order">2. Bend the other LED lead over to run next to the top lead of R1 and the bottom lead of C1 (B). Solder the bottom LED lead at the junctions where it crosses R1 and C1 and cut off the remainders of both the C1 lead and the R1 lead you just soldered to. If there is any remaining LED lead after connecting to R1 and C1, cut that off too.</p>
<p class="order">3. Cut a length of solid-core wire that is long enough to reach all the way from the end of the positive LED that you soldered in Step 2 as far as D3 on the top Arduino connector (C). Strip the ends of the wire (see “<a href="app02.html#ch00lev1sec225">Stripping Wires</a>” on <a href="app02.html#page_227">page 227</a>). Flip over to the top side of the board and push one stripped end of the wire into a hole next to where the positive LED lead connects to C1 and solder the wire to that junction. Solder the other end of the wire to the solder pad next to Arduino pin 3. Push the stripped end through the hole from the top and solder on the underside.</p>
<div class="image"><a id="page_128"/><img src="graphics/f07-09.jpg" alt="image"/></div>
<p class="figuret"><a id="ch07fig9">Figure 7-9:</a> The underside of the screwshield, after soldering. The dashed lines indicate wires running on the top of the shield.</p>
<p class="order">4. Bend the bottom lead of R1 over so that it crosses the top lead of D1 (D). Solder these leads together and cut off the excess wire.</p>
<p class="order">5. Use another short length of solid-core wire (or if they are long enough, one of the leads you trimmed off R1) to connect the solder pad labeled X to the bottom GND power line on the screwshield (E).</p>
<p class="indentt">When this is done, the underside of the board should look like <a href="ch07.html#ch07fig9">Figure 7-9</a>. The dotted lines represent the wires on the other side of the board.</p>
<p class="indent">Next, flip the board over and add a wire to link pin D3 (just marked 3 on the screwshield) of the Arduino to the junction of the capacitor, diode, and resistor. Solder that wire in place. When this is done, the top of the screwshield should look like <a href="ch07.html#ch07fig10">Figure 7-10</a>.</p>
<p class="indent">Now that the board is complete, reassemble the electronics by fitting the display shield back on top of the screw shield and the screw shield onto the Arduino.</p>
<div class="image"><a id="page_129"/><img src="graphics/f07-10.jpg" alt="image"/></div>
<p class="figuret"><a id="ch07fig10">Figure 7-10:</a> The finished screwshield</p>
<h5 class="h5" id="ch00lev1sec127"><strong>STEP 4: CONNECT THE SMOKE DETECTOR TO THE ARDUINO</strong></h5>
<p class="noindent">Finally, strip the buzzer wires if you haven’t done so already, and solder longer leads to them. To make the soldered connections stronger, you could use heatshrink as described in “<a href="app02.html#ch00lev1sec230">Using Heatshrink</a>” on <a href="app02.html#page_235">page 235</a>. Connect the smoke detector to pins W and X on the screwshield. The wire connecting the smoke detector to the Arduino can be any double-core cable, such as bell wire, but if you plan to use this alarm in your base, just use wires long enough to reach the mounting position. I found that the project worked just fine with 30 feet (10 m) of telephone extension cable.</p>
<h4 class="h4" id="ch00lev1sec128"><strong>SOFTWARE</strong></h4>
<p class="noindent">If you want to make this project without any of the other Arduino-based projects in this book, then load the sketch <em>Project_11_Smoke_Alarm</em> from this book’s source files onto the Arduino now. If on the other hand, you’ve built one or more of this book’s earlier Arduino projects, then use the sketch <em>All_Sensors</em> and change the constants at the top to select the projects that you’ve made. See the comments section in that sketch for instructions on the correct changes to make.</p>
<div class="note">
<p class="notet"><a id="page_130"/><span class="font1"><strong>NOTE</strong></span></p>
<p class="noindent">You’ll find a link to the source code for this book at <a href="http://nostarch.com/zombies/">http://nostarch.com/zombies/</a>. See <a href="app03.html#app03">Appendix C</a> in this book for instructions on loading the programs.</p>
</div>
<p class="indent">This code builds on the code from Project 4, so for more information on how the program as a whole works, please refer to “<a href="ch11.html#ch00lev1sec215">Software</a>” on <a href="ch03.html#page_57">page 57</a>. Here I will just describe the code specific to the fire alarm.</p>
<p class="indent">First, we define a new constant for pin D3 on the Arduino:</p>
<p class="programs">const int smokePin = 3;</p>
<p class="indent">This pin will act as an input for the signal from the smoke detector. After adding the <span class="literal">smokePin</span> constant, we add a new line of code to the <span class="literal">setup</span> function to initialize this pin as an input:</p>
<p class="programs">pinMode(smokePin, INPUT);</p>
<p class="indent">Next, we add a call to a new function called <span class="literal">checkSmoke</span> to the <span class="literal">loop</span> function. The <span class="literal">checkSmoke</span> function is defined as follows:</p>
<p class="programs">void checkSmoke()<br/>{<br/>  if (digitalRead(smokePin))<br/>  {<br/>    alarm("FIRE!!");<br/>  }<br/>}</p>
<p class="indent">The <span class="literal">checkSmoke</span> function contains the rest of the code for checking for a signal from the smoke detector and displaying the message and/or turning on the buzzer. To change the display and control the buzzer, call the <span class="literal">alarm</span> function, which you first met in “<a href="ch04.html#ch00lev1sec81">Project 6: PIR Zombie Detector</a>” on <a href="ch04.html#page_72">page 72</a>:</p>
<p class="programs">void alarm(char message[])<br/>{<br/>  lcd.setCursor(0, 1);<br/>  lcd.print("           ");<br/>  delay(100);<br/>  lcd.setCursor(0, 1);<br/>  lcd.print(message);<br/>  if (!mute)<br/>  {<br/>    tone(buzzerPin, 1000);<br/>  }<br/>  delay(100);<br/>}</p>
<p class="indent"><a id="page_131"/>Unless you press a button to mute (a holdover from Project 4), this function prints your message (<span class="literal">"FIRE!!"</span>) to the LCD in lieu of that loud, zombie-attracting buzzer.</p>
<h4 class="h4" id="ch00lev1sec129"><strong>USING THE FIRE ALARM</strong></h4>
<p class="noindent">Testing the smoke detector is simple: just hold down the contacts of the test button with a screwdriver (see <a href="ch07.html#ch07fig6">Figure 7-6</a>). This will cause the buzzer to sound and a message to appear on the LCD screen.</p>
<p class="indent">When you know the alarm works, place the sensor somewhere close enough to a potential fire that you’ll receive enough advance warning to put out the flames, or at least flee in an orderly manner. Creating a quiet smoke alarm won’t be worth much if you exit in a noisy panic and attract all the zombies on the block!</p>
<h3 class="h3" id="ch00lev1sec130"><strong>PROJECT 12: TEMPERATURE ALARM</strong></h3>
<p class="noindent">Since your compound is zombie-proofed, you (hopefully) won’t have to change lodgings often, and over time, you’re sure to acquire some valuable climate-sensitive items. Depending on what you have cached away, you might want to make sure that a generator isn’t getting too hot or that your wine cellar isn’t too cold. To protect these assets that ensure your survival and are good to trade with other survivors, you need a temperature alarm that can notify you of extremes of heat or cold.</p>
<p class="indent">This is the final project that uses your now heavily laden Arduino, and <a href="ch07.html#ch07fig11">Figure 7-11</a> shows the LCD screen reporting a high temperature in Celsius.</p>
<div class="image"><img src="graphics/f07-11.jpg" alt="image"/></div>
<p class="figuret"><a id="ch07fig11">Figure 7-11:</a> A fully laden Arduino, complete with temperature sensor (circled), movement detector, smoke alarm, and battery monitor</p>
<p class="indent"><a id="page_132"/>A three-pin temperature sensor is on the left of <a href="ch07.html#ch07fig11">Figure 7-11</a>, over the remains of the smoke alarm from Project 11. That sensor will send the Arduino temperature data, which the Arduino will then display as human-readable text.</p>
<h4 class="h4" id="ch00lev1sec131"><strong>WHAT YOU WILL NEED</strong></h4>
<p class="noindentb">To make this project, you’ll need the Arduino and screwshield that you used in “<a href="ch03.html#ch00lev1sec63">Project 4: Battery Monitor</a>” on <a href="ch03.html#page_53">page 53</a> and the following parts:</p>
<table border="0" cellpadding="0" cellspacing="0" class="topbot" width="100%">
<thead>
<tr>
<th valign="top" class="table_th"><p class="table1"><strong>ITEMS</strong></p></th>
<th valign="top" class="table_th"><p class="table1"><strong>NOTES</strong></p></th>
<th valign="top" class="table_th"><p class="table1"><strong>SOURCE</strong></p></th>
</tr>
</thead>
<tbody>
<tr>
<td valign="top" class="table"><p class="table-b"><img src="graphics/square.jpg" alt="image"/> TMP36</p></td>
<td valign="top" class="table"><p class="table">Temperature sensor</p></td>
<td valign="top" class="table"><p class="table">Adafruit (165)</p></td>
</tr>
<tr>
<td valign="top" class="table"><p class="table-b"><img src="graphics/square.jpg" alt="image"/> Three-core wire</p></td>
<td valign="top" class="table"><p class="table">To connect the sensor chip to the Arduino screwshield</p></td>
<td valign="top" class="table"><p class="table">Scavenged telephone cable or other three-core wire.</p></td>
</tr>
<tr>
<td valign="top" class="table"><p class="table-b"><img src="graphics/square.jpg" alt="image"/> Heatshrink</p></td>
<td valign="top" class="table"><p class="table">3 lengths of about an inch (25 mm)</p></td>
<td valign="top" class="table"><p class="table">Auto parts store</p></td>
</tr>
</tbody>
</table>
<p class="indent">You could use electrical tape instead of heatshrink for this project, but I recommend heatshrink because it’s a lot tougher and not prone to unraveling.</p>
<h4 class="h4" id="ch00lev1sec132"><strong>CONSTRUCTION</strong></h4>
<p class="noindent"><a href="ch07.html#ch07fig12">Figure 7-12</a> shows the wiring diagram for the project. The LCD should be attached from an earlier project, so the only new part you’ll add is the TMP36 temperature sensor.</p>
<div class="image"><img src="graphics/f07-12.jpg" alt="image"/></div>
<p class="figuret"><a id="ch07fig12">Figure 7-12:</a> The wiring diagram for the temperature alarm</p>
<div class="sidebar">
<p class="sidebart"><a id="page_133"/><strong>TMP36 TEMPERATURE SENSOR</strong></p>
<p class="noindent">The TMP36 is a handy little temperature sensor chip. It has three pins, and in this project, they’re connected to 5V, GND, and A2 on the Arduino. <a href="ch07.html#ch07fig13">Figure 7-13</a> shows the pinout of this chip. These chips are only accurate to about 2 degrees Celsius. If you want greater accuracy, then you could consider changing this project’s design and software to use a digital temperature sensor like the DS18B20.</p>
<div class="image"><img src="graphics/f07-13.jpg" alt="image"/></div>
<p class="figuret"><a id="ch07fig13">Figure 7-13:</a> The TMP36 pinout</p>
<p class="indent">The positive supply voltage to pin V+ on the TMP36 can be anything between 2.7V and 5.5V. On its middle pin, the chip produces an analog output voltage proportional to the temperature. The temperature of the chip (in degrees Celsius) can be calculated from the voltage at the Out pin by this formula:</p>
<p class="center2">Temperature = 100 × volts - 50</p>
<p class="indent">So, if the voltage were 0.6V, the temperature would be 100 × 0.6 - 50 = 10 degrees Celsius. If you prefer your temperatures in degrees Fahrenheit, then just make one further calculation:</p>
<p class="center2"><sup>°</sup>F = <sup>°</sup>C × 9/5 + 32</p>
<p class="indent">The TMP36 can measure temperatures in the range -40 to +125 degrees Celsius, but the measured temperature is accurate only to within 2 degrees Celsius of the actual temperature.</p>
</div>
<h5 class="h5" id="ch00lev1sec133"><a id="page_134"/><strong>STEP 1: MAKE A LONGER LEAD FOR THE TMP36</strong></h5>
<p class="noindent">To extend the lead of the TMP36, you could just solder a three-core wire to it. However, to make it a bit more durable, you can use heatshrink tubing on top of the soldered connections. <a href="ch07.html#ch07fig14">Figure 7-14</a> shows the process.</p>
<div class="image"><img src="graphics/f07-14.jpg" alt="image"/></div>
<p class="figuret"><a id="ch07fig14">Figure 7-14:</a> Using heatshrink on the TMP36 lead</p>
<p class="indent">First, strip the wires of each lead and slip the cut lengths of heatshrink over the individual wires (<a href="ch07.html#ch07fig14">Figure 7-14</a>a). Next solder the wires to the leads of the TMP36 (<a href="ch07.html#ch07fig14">Figure 7-14</a>b). Slide the heatshrink up over the solder joint (<a href="ch07.html#ch07fig14">Figure 7-14</a>c) and finally apply a hair dryer or hot air gun to the heatshrink until it, well, shrinks (<a href="ch07.html#ch07fig14">Figure 7-14</a>d). If you have wide diameter heatshrink, then you could place this around the whole sensor and individual leads to make this build more durable.</p>
<div class="note">
<p class="notet"><span class="font1"><strong>NOTE</strong></span></p>
<p class="noindent">For more information on using heatshrink, see the “<a href="app02.html#ch00lev1sec230">Using Heatshrink</a>” on <a href="app02.html#page_235">page 235</a>.</p>
</div>
<h5 class="h5" id="ch00lev1sec134"><strong>STEP 2: ATTACH THE TEMPERATURE SENSOR LEAD TO THE SCREWSHIELD</strong></h5>
<p class="noindent">Attach the wires from the temperature sensor to the screwshield (<a href="ch07.html#ch07fig11">Figure 7-11</a>). You don’t have to use the GND connection shown; any of the GND terminals on the screwshield will do.</p>
<h4 class="h4" id="ch00lev1sec135"><a id="page_135"/><strong>SOFTWARE</strong></h4>
<p class="noindent">If you want to make this project on its own, without any of the earlier Arduino-based projects, then open the sketch <em>Project_12_Temperature</em> from this book’s source files and load it on to your Arduino now. If, on the other hand, you built one or more of the earlier Arduino projects, then use the sketch <em>All_Sensors</em> and change the constants at the top to select the projects that you have made. See the comments section in this sketch for instructions on this.</p>
<div class="note">
<p class="notet"><span class="font1"><strong>NOTE</strong></span></p>
<p class="noindent">All the source code for this book is available from <a href="http://www.nostarch.com/zombies/">http://www.nostarch.com/zombies/</a>. See “<a href="app03.html#ch00lev1sec241">Installing the Antizombie Sketches</a>” on <a href="app03.html#page_248">page 248</a> for instructions on installing the programs.</p>
</div>
<p class="indent">This code follows the same pattern as Project 4, so for more information on how the program as a whole works, please refer to “<a href="ch11.html#ch00lev1sec215">Software</a>” on <a href="ch03.html#page_57">page 57</a>. Here, I’ll just describe the code specific to this project.</p>
<p class="indent">First, a new constant is defined for the Arduino pin that will act as an analog input for the TMP36:</p>
<p class="programs">const int tempPin = A2;</p>
<p class="indent">Two more constants are defined to set the maximum and minimum temperatures allowed before an alarm is triggered. These are <span class="literal">floats</span> rather than <span class="literal">ints</span> because they represent decimal numbers rather than whole numbers.</p>
<p class="programs">// Project 12 constants<br/>// these can be in C or F<br/>const float maxTemp = 45.0;<br/>const float minTemp = -10.0;</p>
<p class="indent">As the comments above the constants state, these temperature values can be in either Celsius or Fahrenheit. The units that the temperature is measured in are decided by a new function you’ll define.</p>
<p class="indent">The main <span class="literal">loop</span> function now includes a call to <span class="literal">checkTemp</span>, too. This function is defined as follows:</p>
<p class="programs">void checkTemp()<br/>{<br/>  float t = readTemp();<br/>  if (t &gt; maxTemp)<br/>  {<br/>    alarm("HOT", t);<br/>  }<br/>  else if (t &lt; minTemp)<br/>  {<br/>    alarm("COLD", t);<br/><a id="page_136"/><br/>  }<br/>}</p>
<p class="indent">The <span class="literal">checkTemp</span> function first calls <span class="literal">readTemp</span> to measure the temperature and then compares that with the maximum and minimum temperatures. If the temperature is too high or too low, then the <span class="literal">alarm</span> function is called. Note that this version of the <span class="literal">alarm</span> function has an additional parameter that is used to display the temperature on the LCD screen.</p>
<p class="indent">The <span class="literal">readTemp</span> function is where the raw analog input reading from the TMP36 is converted into a temperature.</p>
<p class="programs">float readTemp()<br/>{<br/>  int raw = analogRead(tempPin);<br/>  float volts = raw / 205.0;<br/>  float tempC = 100.0 * volts - 50;<br/>  float tempF = tempC * 9.0 / 5.0 + 32.0;<br/>  // One of the following two lines must be uncommented<br/>  // Either return the temperature in C or F<br/>  return tempC;<br/>  // return tempF;<br/>}</p>
<p class="indent">The raw value returned by <span class="literal">analogRead</span> is a number between 0 and 1023, where 0 indicates 0V at the analog input pin and 1023 indicates 5V. This voltage is calculated by dividing the raw value by 205 (205 is roughly 1023/5).</p>
<p class="indent">The temperature in degrees Celsius is then calculated using the formula described in “TMP36 Temperature Sensor” on <a href="ch07.html#page_133">page 133</a>, as the voltage multiplied by 100 with 50 subtracted from the result. The temperature in degrees Fahrenheit is also calculated.</p>
<p class="indent">Finally, one of these two values has to be returned. In this version of <span class="literal">readTemp</span>, the line to return <span class="literal">tempF</span> is commented out, so the temperature in Celsius will be returned. If you want to flip this, then comment out the line <span class="literal">return tempC</span> and un-comment return <span class="literal">tempF</span> so that the last three lines of the function look like this:</p>
<p class="programs">  // return tempC;<br/>  return tempF;<br/>}</p>
<p class="indent">To test the sensor, try changing the value of the <span class="literal">maxTemp</span> constant to just above the room’s temperature, load the updated sketch onto the Arduino, and then squeeze the temperature sensor between your fingers to warm it up. Watch the LCD, and the readout should change.</p>
<h4 class="h4" id="ch00lev1sec136"><a id="page_137"/><strong>USING THE TEMPERATURE ALARM</strong></h4>
<p class="noindent">There’s a limit to how much distance you can put between your temperature sensor and your Arduino. You could make the lead you attach to the TMP36 as long as 20 feet (7 m), but the sensor will become less and less accurate as the lead gets longer due to electrical noise on the line and the resistance of the wire.</p>
<p class="indent">Leave the sensor near the item you want to stay at a certain temperature and watch the LCD. If that wine cellar just won’t stay cool enough, try setting up the sensor in different rooms in your base until you find one with the right climate. If there isn’t a good room for the wine, just put the sensor back on your generator, invite the other survivors in your area over for a drink, and have an antizombie strategy meeting.</p>
<p class="indent">Now that you have a bunch of sensors to warn you of dangers in your base, in the next chapter, you’ll combine the Arduino projects with a Raspberry Pi to make a control center.<a id="page_138"/></p>
</body></html>