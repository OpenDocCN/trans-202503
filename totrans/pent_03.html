<html><head></head><body><section class="chapter" epub:type="chapter" id="setting_up_your_virtual_lab" title="Chapter&#xA0;1.&#xA0;Setting Up Your Virtual Lab"><div class="titlepage"><div><div><h2 class="title">Chapter 1. Setting Up Your Virtual Lab</h2></div></div></div><p><a class="indexterm" id="iddle1542"/><a class="indexterm" id="iddle1627"/><a class="indexterm" id="iddle2370"/><a class="indexterm" id="iddle2371"/><a class="indexterm" id="iddle2387"/><a class="indexterm" id="iddle2392"/><a class="indexterm" id="iddle2470"/>As you work through this book, you’ll get hands-on experience using different tools and techniques for penetration testing by working in a virtual lab running in the VMware virtualization software. I’ll walk you through setting up your lab to run multiple operating systems inside your base operating system in order to simulate an entire network using just one physical machine. We’ll use our lab to attack target systems throughout this book.</p><div class="sect1" title="Installing VMware"><div class="titlepage"><div><div><h2 class="title" id="installing_vmware" style="clear: both">Installing VMware</h2></div></div></div><p>As the first step in setting up your virtual lab, download and install a desktop VMware product. VMware Player is available free for personal use for Microsoft Windows and Linux operating systems (<span class="emphasis"><em><a class="ulink" href="http://www.vmware.com/products/player/" target="_top">http://www.vmware.com/products/player/</a></em></span>). VMware also offers VMware Workstation (<span class="emphasis"><em><a class="ulink" href="http://www.vmware.com/products/workstation/" target="_top">http://www.vmware.com/products/workstation/</a></em></span>) for Windows and Linux, which includes <a class="indexterm" id="iddle1005"/><a class="indexterm" id="iddle1290"/><a class="indexterm" id="iddle1391"/><a class="indexterm" id="iddle1593"/><a class="indexterm" id="iddle1651"/><a class="indexterm" id="iddle2373"/><a class="indexterm" id="iddle2388"/><a class="indexterm" id="iddle2399"/>additional features such as the ability to take snapshots of the virtual machine that you can revert to in case you break something. VMware Workstation is available for free for 30 days, but after that, you will need to buy it or switch back to using VMware Player.</p><p>Mac users can run a trial version of VMware Fusion (<span class="emphasis"><em><a class="ulink" href="http://www.vmware.com/products/fusion/" target="_top">http://www.vmware.com/products/fusion/</a></em></span>) free for 30 days, and it costs only about $50 after that. As a Mac user, I’ll use VMware Fusion throughout the book, but setup instructions are also included for VMware Player.</p><p>Download the version of VMware that matches your operating system and architecture (32- or 64-bit). If you encounter any problems installing VMware, you’ll find plenty of support at the VMware website.</p></div><div class="sect1" title="Setting Up Kali Linux"><div class="titlepage"><div><div><h2 class="title" id="setting_up_kali_linux" style="clear: both">Setting Up Kali Linux</h2></div></div></div><p>Kali Linux is a Debian-based Linux distribution that comes with a wide variety of preinstalled security tools that we’ll use throughout this book. This book is written for Kali 1.0.6, the current version as of this writing. You’ll find a link to a torrent containing a copy of Kali 1.0.6 at this book’s website (<span class="emphasis"><em><a class="ulink" href="http://nostarch.com/pentesting/" target="_top">http://nostarch.com/pentesting/</a></em></span>). As time passes, newer versions of Kali will be released. If you would like, feel free to download the latest version of Kali Linux from <span class="emphasis"><em><a class="ulink" href="http://www.kali.org/" target="_top">http://www.kali.org/</a></em></span>. Keep in mind, though, that many of the tools we’ll use in this book are in active development, so if you use a newer version of Kali, some of the exercises may differ from the walkthroughs in this book. If you prefer everything to work as written, I recommend using the version of Kali 1.0.6 provided in the torrent (a file called <span class="emphasis"><em>kali-linux-1.0.6-vm-i486.7z</em></span>), which is a prebuilt VMware image compressed with 7-Zip.</p><div class="note" title="Note"><h3 class="title"><a id="ch01note01"/>Note</h3><p>You can find 7-Zip programs for Windows and Linux platforms at <span class="emphasis"><em><a class="ulink" href="http://www.7-zip.org/download.html" target="_top">http://www.7-zip.org/download.html</a></em></span>. For Mac users, I recommend Ez7z from <span class="emphasis"><em><a class="ulink" href="http://ez7z.en.softonic.com/mac/" target="_top">http://ez7z.en.softonic.com/mac/</a></em></span>.</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Once the 7-Zip archive is decompressed, in VMware go to <span class="strong"><strong>File</strong></span> ▸ <span class="strong"><strong>Open</strong></span> and direct it to the file <span class="emphasis"><em>Kali Linux 1.0.6 32 bit.vmx</em></span> in the decompressed <span class="emphasis"><em>Kali Linux 1.0.6 32 bit</em></span> folder.</p></li><li class="listitem"><p>Once the virtual machine opens, click the <span class="strong"><strong>Play</strong></span> button and, when prompted as shown in <a class="xref" href="ch01.xhtml#opening_the_kali_linux_virtual_machine" title="Figure 1-1. Opening the Kali Linux virtual machine">Figure 1-1</a>, choose <span class="strong"><strong>I copied it</strong></span>.</p></li><li class="listitem"><p>As Kali Linux boots up, you will be prompted as shown in <a class="xref" href="ch01.xhtml#booting_kali_linux" title="Figure 1-2. Booting Kali Linux">Figure 1-2</a>. Choose the top (default) highlighted option.</p><div class="figure"><a id="opening_the_kali_linux_virtual_machine"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00002"/><img alt="Opening the Kali Linux virtual machine" src="httpatomoreillycomsourcenostarchimages2030194.png.jpg"/></div></div><div class="figure-title">Figure 1-1. Opening the Kali Linux virtual machine</div></div><div class="figure"><a id="booting_kali_linux"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00003"/><img alt="Booting Kali Linux" src="httpatomoreillycomsourcenostarchimages2030196.png.jpg"/></div></div><div class="figure-title">Figure 1-2. Booting Kali Linux</div></div></li><li class="listitem"><p><a class="indexterm" id="iddle1117"/><a class="indexterm" id="iddle1586"/><a class="indexterm" id="iddle1590"/><a class="indexterm" id="iddle1641"/>Once Kali Linux boots, you will be presented with a login screen like the one shown in <a class="xref" href="ch01.xhtml#kali_login_screen" title="Figure 1-3. Kali login screen">Figure 1-3</a>.</p><div class="figure"><a id="kali_login_screen"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00004"/><img alt="Kali login screen" src="httpatomoreillycomsourcenostarchimages2030198.png.jpg"/></div></div><div class="figure-title">Figure 1-3. Kali login screen</div></div></li><li class="listitem"><p>Click <span class="strong"><strong>Other</strong></span> and enter the default credentials for Kali Linux, <span class="emphasis"><em>root:toor</em></span>, as shown in <a class="xref" href="ch01.xhtml#logging_into_kali" title="Figure 1-4. Logging into Kali">Figure 1-4</a>. Then click the <span class="strong"><strong>Log In</strong></span> button.</p><div class="figure"><a id="logging_into_kali"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00005"/><img alt="Logging into Kali" src="httpatomoreillycomsourcenostarchimages2030200.png.jpg"/></div></div><div class="figure-title">Figure 1-4. Logging into Kali</div></div></li><li class="listitem"><p><a class="indexterm" id="iddle1124"/><a class="indexterm" id="iddle1479"/><a class="indexterm" id="iddle1589"/><a class="indexterm" id="iddle1791"/><a class="indexterm" id="iddle1825"/><a class="indexterm" id="iddle2379"/>You will be presented with a screen like the one shown in <a class="xref" href="ch01.xhtml#kali_linux_gui" title="Figure 1-5. The Kali Linux GUI">Figure 1-5</a>.</p><div class="figure"><a id="kali_linux_gui"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00006"/><img alt="The Kali Linux GUI" src="httpatomoreillycomsourcenostarchimages2030202.png.jpg"/></div></div><div class="figure-title">Figure 1-5. The Kali Linux GUI</div></div></li></ol></div><div class="sect2" title="Configuring the Network for Your Virtual Machine"><div class="titlepage"><div><div><h3 class="title" id="configuring_the_network_for_your_virtual">Configuring the Network for Your Virtual Machine</h3></div></div></div><p>Because we’ll be using Kali Linux to attack our target systems over a network, we need to place all our virtual machines on the same virtual network (we will see an example of moving between networks in <a class="xref" href="ch13.xhtml" title="Chapter 13. Post Exploitation">Chapter 13</a>, which covers post exploitation). VMware offers three options for virtual network connections: bridged, NAT, and host only. You should choose the bridged option, but here’s a bit of information about each:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The <span class="emphasis"><em>bridged network</em></span> connects the virtual machine directly to the local network using the same connection as the host system. As far as the local network is concerned, our virtual machine is just another node on the network with its own IP address.</p></li><li class="listitem"><p><span class="emphasis"><em>NAT</em></span>, short for <span class="emphasis"><em>network address translation</em></span>, sets up a private network on the host machine. The private network translates outgoing traffic from the virtual machine to the local network. On the local network, traffic from the virtual machine will appear to come from the host machine’s IP address.</p></li><li class="listitem"><p>The <span class="emphasis"><em>host-only</em></span> network limits the virtual machine to a local private network on the host. The virtual machine will be able to communicate with other virtual machines in the host-only network as well as the host machine itself, but it will not be able to send or receive any traffic with the local network or the Internet.</p></li></ul></div><div class="note" title="Note"><h3 class="title"><a id="ch01note02"/>Note</h3><p><a class="indexterm" id="iddle1125"/><a class="indexterm" id="iddle2393"/><a class="indexterm" id="iddle2471"/>Because our target virtual machines will have multiple known security vulnerabilities, use caution when attaching them to your local network because anyone else on that network can also attack these machines. For this reason, I do not recommend working through this book on a public network where you do not trust the other users.</p></div><p>By default, the Kali Linux virtual machine network adapter is set to NAT. Here’s how to change that option on both Windows and Mac OS.</p><div class="sect3" title="VMware Player on Microsoft Windows"><div class="titlepage"><div><div><h4 class="title" id="vmware_player_on_microsoft_windows">VMware Player on Microsoft Windows</h4></div></div></div><p>To change the virtual network on VMware Player for Windows, start VMware Player and then click your Kali Linux virtual machine. Choose <span class="strong"><strong>Edit virtual machine settings</strong></span>, as shown in <a class="xref" href="ch01.xhtml#changing_the_vmware_network_adapter" title="Figure 1-6. Changing the VMware network adapter">Figure 1-6</a>. (If you’re still running Kali Linux in VMware Player, choose <span class="strong"><strong>Player</strong></span> ▸ <span class="strong"><strong>Manage</strong></span> ▸ <span class="strong"><strong>Virtual machine settings</strong></span>.)</p><div class="figure"><a id="changing_the_vmware_network_adapter"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00007"/><img alt="Changing the VMware network adapter" src="httpatomoreillycomsourcenostarchimages2030204.png.jpg"/></div></div><div class="figure-title">Figure 1-6. Changing the VMware network adapter</div></div><p>On the next screen, choose <span class="strong"><strong>Network Adapter</strong></span> in the Hardware tab and choose the <span class="strong"><strong>Bridged</strong></span> option in the <span class="strong"><strong>Network connection</strong></span> section, as shown in <a class="xref" href="ch01.xhtml#changing_the_network_adapter_settings" title="Figure 1-7. Changing the network adapter settings">Figure 1-7</a>.</p><div class="figure"><a id="changing_the_network_adapter_settings"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00008"/><img alt="Changing the network adapter settings" src="httpatomoreillycomsourcenostarchimages2030206.png.jpg"/></div></div><div class="figure-title">Figure 1-7. Changing the network adapter settings</div></div><p><a class="indexterm" id="iddle1823"/><a class="indexterm" id="iddle2378"/>Now click the <span class="strong"><strong>Configure Adapters</strong></span> button and check the network adapter that you’re using with your host operating system. As you can see in <a class="xref" href="ch01.xhtml#selecting_a_network_adapter" title="Figure 1-8. Selecting a network adapter">Figure 1-8</a>, I’ve selected only the Realtek wireless adapter. Once you’ve made your selection, press <span class="strong"><strong>OK</strong></span>.</p><div class="figure"><a id="selecting_a_network_adapter"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00009"/><img alt="Selecting a network adapter" src="httpatomoreillycomsourcenostarchimages2030208.png.jpg"/></div></div><div class="figure-title">Figure 1-8. Selecting a network adapter</div></div></div><div class="sect3" title="VMware Fusion on Mac OS"><div class="titlepage"><div><div><h4 class="title" id="vmware_fusion_on_mac_os">VMware Fusion on Mac OS</h4></div></div></div><p><a class="indexterm" id="iddle1126"/><a class="indexterm" id="iddle1192"/><a class="indexterm" id="iddle1497"/><a class="indexterm" id="iddle1560"/><a class="indexterm" id="iddle1652"/><a class="indexterm" id="iddle1820"/><a class="indexterm" id="iddle2270"/><a class="indexterm" id="iddle2380"/><a class="indexterm" id="iddle2389"/>To change the virtual network connection in VMware Fusion, go to <span class="strong"><strong>Virtual Machine</strong></span> ▸ <span class="strong"><strong>Network Adapter</strong></span> and change from NAT to Bridged, as shown in <a class="xref" href="ch01.xhtml#changing_the_network_adapter" title="Figure 1-9. Changing the network adapter">Figure 1-9</a>.</p><div class="figure"><a id="changing_the_network_adapter"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00010"/><img alt="Changing the network adapter" src="httpatomoreillycomsourcenostarchimages2030210.png.jpg"/></div></div><div class="figure-title">Figure 1-9. Changing the network adapter</div></div></div><div class="sect3" title="Connecting the Virtual Machine to the Network"><div class="titlepage"><div><div><h4 class="title" id="connecting_the_virtual_machine_to_the_ne">Connecting the Virtual Machine to the Network</h4></div></div></div><p>Kali Linux should automatically pull an IP address from the Bridged network once you make the switch. To verify your IP address, open a Linux terminal by clicking the terminal icon(a black rectangle with the symbols &gt;_) at the top left of the Kali screen (or choose <span class="strong"><strong>Applications</strong></span> ▸ <span class="strong"><strong>Accessories</strong></span> ▸ <span class="strong"><strong>Terminal</strong></span>). Then run the command <code class="literal">ifconfig</code> to see your network information, as shown in <a class="xref" href="ch01.xhtml#networking_information" title="Example 1-1. Networking information">Example 1-1</a>.</p><div class="example"><a id="networking_information"/><div class="example-title">Example 1-1. Networking information</div><div class="example-contents"><pre class="programlisting">root@kali:~# <span class="strong"><strong>ifconfig</strong></span>&#13;
eth0      Link encap:Ethernet  HWaddr 00:0c:29:df:7e:4d&#13;
          inet addr:<span class="strong"><strong>192.168.20.9</strong></span>  Bcast:192.168.20.255  Mask:255.255.255.0&#13;
          inet6 addr: fe80::20c:29ff:fedf:7e4d/64 Scope:Link&#13;
--<span class="emphasis"><em>snip</em></span>--</pre></div></div><div class="note" title="Note"><h3 class="title"><a id="ch01note03"/>Note</h3><p>The prompt <code class="literal">root@kali:~#</code> is the superuser (root) prompt. We will learn more about this and the other Linux commands we use for setup in <a class="xref" href="ch02.xhtml" title="Chapter 2. Using Kali Linux">Chapter 2</a>.</p></div><p><a class="indexterm" id="iddle1537"/><a class="indexterm" id="iddle1550"/><a class="indexterm" id="iddle1595"/><a class="indexterm" id="iddle1799"/><a class="indexterm" id="iddle1936"/><a class="indexterm" id="iddle2287"/><a class="indexterm" id="iddle2414"/>The IPv4 address for this virtual machine is 192.168.20.9, as highlighted in bold in <a class="xref" href="ch01.xhtml#networking_information" title="Example 1-1. Networking information">Example 1-1</a>. (The IP address for your machine will likely differ.)</p></div><div class="sect3" title="Testing Your Internet Access"><div class="titlepage"><div><div><h4 class="title" id="testing_your_internet_access">Testing Your Internet Access</h4></div></div></div><p>Now let’s make sure that Kali Linux can connect to the Internet. We’ll use the ping network utility to see if we can reach Google. Make sure your computer is connected to the Internet, open a Linux terminal, and enter the following.</p><a id="pro_id00001"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>ping www.google.com</strong></span></pre><p>If you see something like the following in response, you’re online. (We’ll learn more about the <code class="literal">ping</code> command in <a class="xref" href="ch03.xhtml" title="Chapter 3. Programming">Chapter 3</a>.)</p><a id="pro_id00002"/><pre class="programlisting">PING www.google.com (50.0.2.221) 56(84) bytes of data.&#13;
64 bytes from cache.google.com (50.0.2.221): icmp_req=1 ttl=60 time=28.7 ms&#13;
64 bytes from cache.google.com (50.0.2.221): icmp_req=2 ttl=60 time=28.1 ms&#13;
64 bytes from cache.google.com (50.0.2.221): icmp_req=3 ttl=60 time=27.4 ms&#13;
64 bytes from cache.google.com (50.0.2.221): icmp_req=4 ttl=60 time=29.4 ms&#13;
64 bytes from cache.google.com (50.0.2.221): icmp_req=5 ttl=60 time=28.7 ms&#13;
64 bytes from cache.google.com (50.0.2.221): icmp_req=6 ttl=60 time=28.0 ms&#13;
--<span class="emphasis"><em>snip</em></span>--</pre><p>If you do not receive a response, make sure that you have set your network adapter to Bridged, that Kali Linux has an IP address, and, of course, that your host system currently has Internet access.</p></div></div><div class="sect2" title="Installing Nessus"><div class="titlepage"><div><div><h3 class="title" id="installing_nessus">Installing Nessus</h3></div></div></div><p>Although Kali Linux has just about every tool we’ll need, we do need to install a few additional programs. First, we’ll install Tenable Security’s Nessus Home vulnerability scanner. This scanner is free for home use only (you’ll see a description of limitations on the Nessus website). Note that Nessus is very actively developed, so the current version as well as its GUI may have changed a bit since this book went to press.</p><p>Use the following steps to install Nessus Home from within Kali:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Open <span class="strong"><strong>Applications</strong></span> ▸ <span class="strong"><strong>Internet</strong></span> ▸ <span class="strong"><strong>Iceweasel Web Browser</strong></span> and enter <span class="emphasis"><em><a class="ulink" href="http://www.tenable.com/products/nessus-home/" target="_top">http://www.tenable.com/products/nessus-home/</a></em></span> in the address bar. Complete the Register for an Activation Code information and click <span class="strong"><strong>Register</strong></span>. (Use a real email address—you’ll need the activation code later.)</p></li><li class="listitem"><p>Once you reach the Downloads page, choose the latest version of Nessus for the Linux Debian 32-bit platform (<span class="emphasis"><em>Nessus-5.2.5-debian6_i386.deb</em></span> as of this writing) and download it to your root directory (the default download location).</p></li><li class="listitem"><p>Open a Linux terminal (click the terminal icon at the top of the Kali screen) to open a root prompt.</p></li><li class="listitem"><p><a class="indexterm" id="iddle1299"/><a class="indexterm" id="iddle1403"/><a class="indexterm" id="iddle1644"/><a class="indexterm" id="iddle1805"/>Enter <span class="strong"><strong><code class="literal">ls</code></strong></span> to see a list of the files in your root directory. You should see the Nessus file that you just downloaded.</p></li><li class="listitem"><p>Enter <span class="strong"><strong><code class="literal">dpkg -i</code></strong></span> followed by the name of the file you downloaded (you can type the first letter of the filename and press <span class="smaller">tab</span> to use tab completion) and press <span class="smaller">enter</span> to begin the install process. Installation may take a while as Nessus processes various plugins. Progress is shown by a line of hash symbols (<code class="literal">#</code>).</p><a id="pro_id00003"/><pre class="programlisting">Selecting previously unselected package nessus.&#13;
(Reading database ... 355024 files and directories currently installed.)&#13;
Unpacking nessus (from Nessus-5.2.5-debian6_amd64.deb) ...&#13;
Setting up nessus (5.2.5) ...&#13;
nessusd (Nessus) 5.2.5 [build N25109] for Linux&#13;
Copyright (C) 1998 - 2014 Tenable Network Security, Inc&#13;
&#13;
Processing the Nessus plugins...&#13;
[###########                                                ]</pre></li><li class="listitem"><p>Once you’re returned to the root prompt with no errors, Nessus should be installed, and you should see a message like this.</p><a id="pro_id00004"/><pre class="programlisting">All plugins loaded&#13;
Fetching the newest plugins from nessus.org...&#13;
Fetching the newest updates from nessus.org...&#13;
Done. The Nessus server will start processing these plugins within a minute&#13;
nessusd (Nessus) 5.2.5 [build N25109] for Linux&#13;
Copyright (C) 1998 - 2014 Tenable Network Security, Inc&#13;
&#13;
Processing the Nessus plugins...&#13;
[##################################################]&#13;
&#13;
All plugins loaded&#13;
&#13;
 - You can start nessusd by typing /etc/init.d/nessusd start&#13;
 - Then go to https://kali:8834/ to configure your scanner</pre></li><li class="listitem"><p>Now enter the following to start Nessus.</p><a id="pro_id00005"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>/etc/init.d/nessusd start</strong></span></pre></li><li class="listitem"><p>Open the URL <span class="emphasis"><em>https://kali:8834/</em></span> in the Iceweasel web browser. You should see a SSL certificate warning, similar to that in <a class="xref" href="ch01.xhtml#invalid_ssl_certificate_warning" title="Figure 1-10. Invalid SSL certificate warning">Figure 1-10</a>.</p><div class="note" title="Note"><h3 class="title"><a id="ch01note04"/>Note</h3><p>If you access Nessus from outside the Iceweasel browser in Kali, you will need to go to <span class="emphasis"><em>https://&lt;ipaddressofKali&gt;:8834</em></span> instead.</p></div><div class="figure"><a id="invalid_ssl_certificate_warning"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00011"/><img alt="Invalid SSL certificate warning" src="httpatomoreillycomsourcenostarchimages2030212.png.jpg"/></div></div><div class="figure-title">Figure 1-10. Invalid SSL certificate warning</div></div></li><li class="listitem"><p><a class="indexterm" id="iddle2224"/>Expand <span class="strong"><strong>I Understand the Risks</strong></span> and click <span class="strong"><strong>Add Exception</strong></span>. Then click <span class="strong"><strong>Confirm Security Exception</strong></span>, as shown in <a class="xref" href="ch01.xhtml#confirming_the_security_exception" title="Figure 1-11. Confirming the security exception">Figure 1-11</a>.</p><div class="figure"><a id="confirming_the_security_exception"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00012"/><img alt="Confirming the security exception" src="httpatomoreillycomsourcenostarchimages2030214.png.jpg"/></div></div><div class="figure-title">Figure 1-11. Confirming the security exception</div></div></li><li class="listitem"><p><a class="indexterm" id="iddle1533"/><a class="indexterm" id="iddle1727"/><a class="indexterm" id="iddle1800"/><a class="indexterm" id="iddle1899"/>Click <span class="strong"><strong>Get Started</strong></span> at the bottom left of the opening Nessus page and enter a username and password on the following page. I’ve chosen <span class="emphasis"><em>georgia:password</em></span> for my example. If you choose something else, remember it because we’ll use Nessus in <a class="xref" href="ch06.xhtml" title="Chapter 6. Finding Vulnerabilities">Chapter 6</a>. (Note that I use poor passwords throughout this book, as will many clients you encounter. In production, you should use much better passwords than <span class="emphasis"><em>password</em></span>.)</p></li><li class="listitem"><p>At the next page, enter the activation code you received via email from Tenable Security.</p></li><li class="listitem"><p>Once registered with Tenable Security, choose the option to download plugins (downloading will take some time). Once Nessus processes the plugins, it will initialize.</p></li></ol></div><p>When Nessus finishes downloading plugins and configuring the software, you should see the Nessus login screen, as shown in <a class="xref" href="ch01.xhtml#login_screen_of_the_nessus_web_interface" title="Figure 1-12. Login screen of the Nessus web interface">Figure 1-12</a>. You should be able to use the credentials for the account you created during setup to log in.</p><div class="figure"><a id="login_screen_of_the_nessus_web_interface"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00013"/><img alt="Login screen of the Nessus web interface" src="httpatomoreillycomsourcenostarchimages2030216.png.jpg"/></div></div><div class="figure-title">Figure 1-12. Login screen of the Nessus web interface</div></div><p>To close Nessus, just close its tab in the browser. We will come back to Nessus in <a class="xref" href="ch06.xhtml" title="Chapter 6. Finding Vulnerabilities">Chapter 6</a>.</p></div><div class="sect2" title="Installing Additional Software"><div class="titlepage"><div><div><h3 class="title" id="installing_additional_software">Installing Additional Software</h3></div></div></div><p>We’re not done yet. Follow these instructions to complete your Kali Linux install.</p><div class="sect3" title="The Ming C Compiler"><div class="titlepage"><div><div><h4 class="title" id="ming_c_compiler">The Ming C Compiler</h4></div></div></div><p>We need to install a cross compiler so we can compile C code to run on Microsoft Windows systems. The Ming compiler is included in the Kali Linux repositories but is not installed by default. Install it with this command.</p><a id="pro_id00006"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>apt-get install mingw32</strong></span></pre></div><div class="sect3" title="Hyperion"><div class="titlepage"><div><div><h4 class="title" id="hyperion">Hyperion</h4></div></div></div><p><a class="indexterm" id="iddle1490"/><a class="indexterm" id="iddle1528"/><a class="indexterm" id="iddle1541"/><a class="indexterm" id="iddle2361"/>We’ll use the Hyperion encryption program to bypass antivirus software. Hyperion is not currently included in the Kali repositories. Download Hyperion with <code class="literal">wget</code>, unzip it, and compile it with the Ming cross compiler you installed in the previous step, as shown in <a class="xref" href="ch01.xhtml#installing_hyperion" title="Example 1-2. Installing Hyperion">Example 1-2</a>.</p><div class="example"><a id="installing_hyperion"/><div class="example-title">Example 1-2. Installing Hyperion</div><div class="example-contents"><pre class="programlisting">root@kali:~# <span class="strong"><strong>wget http://nullsecurity.net/tools/binary/Hyperion-1.0.zip</strong></span>&#13;
root@kali:~# <span class="strong"><strong>unzip Hyperion-1.0.zip</strong></span>&#13;
Archive:  Hyperion-1.0.zip&#13;
   creating: Hyperion-1.0/&#13;
   creating: Hyperion-1.0/FasmAES-1.0/&#13;
root@kali:~# <span class="strong"><strong>i586-mingw32msvc-c++ Hyperion-1.0/Src/Crypter/*.cpp -o hyperion.exe</strong></span>&#13;
--<span class="emphasis"><em>snip</em></span>--</pre></div></div></div><div class="sect3" title="Veil-Evasion"><div class="titlepage"><div><div><h4 class="title" id="veil-evasion">Veil-Evasion</h4></div></div></div><p>Veil-Evasion is a tool that generates payload executables you can use to bypass common antivirus solutions. Install Veil-Evasion Kali (see <a class="xref" href="ch01.xhtml#installing_veil-evasion" title="Example 1-3. Installing Veil-Evasion">Example 1-3</a>) by first downloading it with the command <code class="literal">wget</code>. Next, unzip the downloaded file <span class="emphasis"><em>master.zip</em></span> and change to the <span class="emphasis"><em>Veil-master/setup</em></span> directory. Finally, enter <span class="strong"><strong><code class="literal">./setup.sh</code></strong></span> and follow the default prompts.</p><div class="example"><a id="installing_veil-evasion"/><div class="example-title">Example 1-3. Installing Veil-Evasion</div><div class="example-contents"><pre class="programlisting">root@kali:~# <span class="strong"><strong>wget https://github.com/ChrisTruncer/Veil/archive/master.zip</strong></span>&#13;
--2015-11-26 09:54:10--  https://github.com/ChrisTruncer/Veil/archive/master.zip&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
2015-11-26 09:54:14 (880 KB/s) - `master.zip' saved [665425]&#13;
&#13;
root@kali:~# <span class="strong"><strong>unzip master.zip</strong></span>&#13;
Archive:  master.zip&#13;
948984fa75899dc45a1939ffbf4fc0e2ede0c4c4&#13;
   creating: Veil-Evasion-master/&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
  inflating: Veil-Evasion-master/tools/pyherion.py&#13;
root@kali:~# <span class="strong"><strong>cd Veil-Evasion-master/setup</strong></span>&#13;
root@kali:~/Veil-Evasion-master/setup# <span class="strong"><strong>./setup.sh</strong></span>&#13;
=========================================================================&#13;
 [Web]: https://www.veil-evasion.com | [Twitter]: @veilevasion&#13;
=========================================================================&#13;
&#13;
 [*] Initializing Apt Dependencies Installation&#13;
--<span class="emphasis"><em>snip</em></span>—&#13;
Do you want to continue? [Y/n]? <span class="strong"><strong>Y</strong></span>&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
root@kali:~#</pre></div></div></div><div class="sect3" title="Ettercap"><div class="titlepage"><div><div><h4 class="title" id="ettercap">Ettercap</h4></div></div></div><p><a class="indexterm" id="iddle1039"/><a class="indexterm" id="iddle1327"/><a class="indexterm" id="iddle1346"/><a class="indexterm" id="iddle1522"/><a class="indexterm" id="iddle1526"/><a class="indexterm" id="iddle1662"/>Ettercap is a tool for performing man-in-the-middle attacks. Before running it for the first time, we need to make a couple of changes to its configuration file at /<span class="emphasis"><em>etc/ettercap/etter.conf</em></span>. Open its configuration file from a Kali root prompt in the nano editor.</p><a id="pro_id00007"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>nano /etc/ettercap/etter.conf</strong></span></pre><p>First change the <code class="literal">userid</code> and <code class="literal">groupid</code> values to <span class="strong"><strong><code class="literal">0</code></strong></span> so Ettercap can run with root privileges. Scroll down to where you see the following lines in the file. Replace whatever values you see following the equal signs (<code class="literal">=</code>) with a <code class="literal">0</code>.</p><a id="pro_id00008"/><pre class="programlisting">[privs]&#13;
ec_uid = <span class="strong"><strong>0</strong></span>                # nobody is the default&#13;
ec_gid = <span class="strong"><strong>0</strong></span>                # nobody is the default</pre><p>Now scroll down to the <code class="literal">Linux</code> section of the file and uncomment (remove the leading <code class="literal">#</code> characters) before the two lines shown at ❶ and ❷ in <a class="xref" href="ch01.xhtml#ettercap_configuration_file" title="Example 1-4. Ettercap configuration file">Example 1-4</a> to set Iptables firewall rules to redirect the traffic.</p><div class="example"><a id="ettercap_configuration_file"/><div class="example-title">Example 1-4. Ettercap configuration file</div><div class="example-contents"><pre class="programlisting">#---------------&#13;
#     Linux&#13;
#---------------&#13;
&#13;
# if you use ipchains:&#13;
   #redir_command_on = "ipchains -A input -i %iface -p tcp -s 0/0 -d 0/0 %port -j REDIRECT %rport"&#13;
   #redir_command_off = "ipchains -D input -i %iface -p tcp -s 0/0 -d 0/0 %port -j REDIRECT %rport"&#13;
&#13;
# if you use iptables:&#13;
   ❶ redir_command_on = "iptables -t nat -A PREROUTING -i %iface -p tcp --dport %port -j&#13;
     REDIRECT    --to-port %rport"&#13;
   ❷ redir_command_off = "iptables -t nat -D PREROUTING -i %iface -p tcp --dport %port -j&#13;
     REDIRECT    --to-port %rport"</pre></div></div><p>Save and exit the file by pressing <span class="smaller">ctrl</span>-X and then Y to save the changes.</p></div></div><div class="sect2" title="Setting Up Android Emulators"><div class="titlepage"><div><div><h3 class="title" id="setting_up_android_emulators">Setting Up Android Emulators</h3></div></div></div><p>Now we’ll set up three Android emulators on Kali to use for mobile testing in <a class="xref" href="ch20.xhtml" title="Chapter 20. Using the Smartphone Pentest Framework">Chapter 20</a>. First we’ll need to download the Android SDK.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Open the Iceweasel web browser from within Kali and visit <span class="emphasis"><em><a class="ulink" href="https://developer.android.com/sdk/index.html" target="_top">https://developer.android.com/sdk/index.html</a></em></span>.</p></li><li class="listitem"><p>Download the current version of the ADT bundle for 32-bit Linux and save it to your root directory.</p></li><li class="listitem"><p><a class="indexterm" id="iddle1043"/>Open a terminal, list the files there (<code class="literal">ls</code>), and extract the compressed archive that you just downloaded with unzip (the <span class="emphasis"><em>x</em></span>’s represent the name of your file, as versions may have changed since this was written).</p><a id="pro_id00009"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>unzip adt-bundle-Linux-x86-</strong></span><span class="emphasis"><em>xxxxxxxxxxx</em></span><span class="strong"><strong>.zip</strong></span></pre></li><li class="listitem"><p>Now use <code class="literal">cd</code> to go into the new directory (with the same name as the file without the <span class="emphasis"><em>.zip</em></span> extension).</p><a id="pro_id00010"/><pre class="programlisting"># <span class="strong"><strong>cd sdk/tools</strong></span>&#13;
# <span class="strong"><strong>./android</strong></span></pre></li><li class="listitem"><p>The Android SDK Manager should open, as shown in <a class="xref" href="ch01.xhtml#android_sdk_manager" title="Figure 1-13. The Android SDK Manager">Figure 1-13</a>.</p></li></ol></div><div class="figure"><a id="android_sdk_manager"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00014"/><img alt="The Android SDK Manager" src="httpatomoreillycomsourcenostarchimages2030218.png.jpg"/></div></div><div class="figure-title">Figure 1-13. The Android SDK Manager</div></div><p>We’ll download any updates to the Android SDK tools and Android SDK platform tools (checked by default), as well as Android 4.3 and a couple of older versions of Android with specific vulnerabilities, Android 2.2 and Android 2.1. Select the boxes to the left of each Android version. Then (leaving Updates/New and Installed checked) click <span class="strong"><strong>Install packages</strong></span>, as shown in <a class="xref" href="ch01.xhtml#installing_android_software" title="Figure 1-14. Installing Android software">Figure 1-14</a>. Accept the license agreement, and the Android SDK should download and install the chosen packages. Installation will likely take several minutes.</p><div class="figure"><a id="installing_android_software"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00015"/><img alt="Installing Android software" src="httpatomoreillycomsourcenostarchimages2030220.png.jpg"/></div></div><div class="figure-title">Figure 1-14. Installing Android software</div></div><p><a class="indexterm" id="iddle1046"/><a class="indexterm" id="iddle1047"/>Now it’s time to set up our Android virtual devices. Open the Android SDK Manager and choose <span class="strong"><strong>Tools</strong></span> ▸ <span class="strong"><strong>Manage AVDs</strong></span>. You should see the window shown in <a class="xref" href="ch01.xhtml#android_virtual_device_manager" title="Figure 1-15. Android Virtual Device Manager">Figure 1-15</a>.</p><div class="figure"><a id="android_virtual_device_manager"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00016"/><img alt="Android Virtual Device Manager" src="httpatomoreillycomsourcenostarchimages2030222.png.jpg"/></div></div><div class="figure-title">Figure 1-15. Android Virtual Device Manager</div></div><p>We’ll create three Android emulators based on Android 4.3, 2.2, and 2.1, as shown in <a class="xref" href="ch01.xhtml#creating_an_android_emulator" title="Figure 1-16. Creating an Android emulator">Figure 1-16</a>. Use the values shown in the figure for each emulator but set the value of Target to the Android version of the emulator you would like to build (the Google API versions of Android 4.3 [Google APIs version 18], 2.2 [Google APIs version 8], and 2.1 [Google APIs version 7]). Fill the AVD Name field with a descriptive value. Add a small SD Card value (100MB should be more than sufficient) so you can download files to your Android emulators. Set Device to <span class="strong"><strong>Nexus 4</strong></span> and Skin to <span class="strong"><strong>Skin with dynamic hardware controls</strong></span>. Leave the rest of the options at their defaults.</p><div class="figure"><a id="creating_an_android_emulator"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00017"/><img alt="Creating an Android emulator" src="httpatomoreillycomsourcenostarchimages2030224.png.jpg"/></div></div><div class="figure-title">Figure 1-16. Creating an Android emulator</div></div><p>Once you’ve built all three emulators, your AVD Manager should look like <a class="xref" href="ch01.xhtml#android_emulators_created_in_android_vir" title="Figure 1-17. Android emulators created in Android Virtual Device Manager">Figure 1-17</a> (device names may be different of course).</p><div class="figure"><a id="android_emulators_created_in_android_vir"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00018"/><img alt="Android emulators created in Android Virtual Device Manager" src="httpatomoreillycomsourcenostarchimages2030226.png.jpg"/></div></div><div class="figure-title">Figure 1-17. Android emulators created in Android Virtual Device Manager</div></div><p><a class="indexterm" id="iddle1040"/><a class="indexterm" id="iddle1328"/>To start an emulator, highlight it and click <span class="strong"><strong>Start</strong></span>. Then click <span class="strong"><strong>Launch</strong></span> in the pop-up, as shown in <a class="xref" href="ch01.xhtml#launching_an_android_emulator" title="Figure 1-18. Launching an Android emulator">Figure 1-18</a>.</p><div class="figure"><a id="launching_an_android_emulator"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00019"/><img alt="Launching an Android emulator" src="httpatomoreillycomsourcenostarchimages2030228.png.jpg"/></div></div><div class="figure-title">Figure 1-18. Launching an Android emulator</div></div><p>It may take a few minutes for the emulator to boot up for the first time, but once it does, you should have something that looks and feels much like a real Android device. The Android 4.3 emulator is shown in <a class="xref" href="ch01.xhtml#android_4dot3_emulator" title="Figure 1-19. Android 4.3 emulator">Figure 1-19</a>.</p><div class="figure"><a id="android_4dot3_emulator"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00020"/><img alt="Android 4.3 emulator" src="httpatomoreillycomsourcenostarchimages2030230.png.jpg"/></div></div><div class="figure-title">Figure 1-19. Android 4.3 emulator</div></div><div class="note" title="Note"><h3 class="title"><a id="ch01note05"/>Note</h3><p><a class="indexterm" id="iddle1294"/><a class="indexterm" id="iddle1540"/><a class="indexterm" id="iddle1592"/><a class="indexterm" id="iddle2177"/>To run the Android emulators in Kali, you will likely need to increase the performance of your virtual machine by increasing its RAM and CPU cores. I am able to run all three emulators with 3GB RAM and two CPU cores allocated to Kali. You can make these changes in the virtual machine settings in your VMware product. The amount of power you can give to Kali will, of course, depend on the resources available on your host machine. As an alternative, instead of running the Android emulators on Kali Linux, you can install Android and the emulators on your host system or even another system on the local network. The exercises in <a class="xref" href="ch20.xhtml" title="Chapter 20. Using the Smartphone Pentest Framework">Chapter 20</a> will work as long as the emulators can communicate with Kali.</p></div></div><div class="sect2" title="Smartphone Pentest Framework"><div class="titlepage"><div><div><h3 class="title" id="smartphone_pentest_framework">Smartphone Pentest Framework</h3></div></div></div><p>Next, download and install the Smartphone Pentest Framework (SPF), which we’ll use for mobile attacks. Use <code class="literal">git</code> to download the source code. Change to the downloaded <span class="emphasis"><em>Smartphone-Pentest-Framework</em></span> directory as shown here.</p><a id="pro_id00011"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>git clone -b SPFBook https://github.com/georgiaw/Smartphone-Pentest-Framework.git</strong></span>&#13;
root@kali:~# <span class="strong"><strong>cd Smartphone-Pentest-Framework</strong></span></pre><p>Now open the file <span class="emphasis"><em>kaliinstall</em></span> in the nano text editor. The first few lines are shown in <a class="xref" href="ch01.xhtml#installing_smartphone_pentest_framework" title="Example 1-5. Installing Smartphone Pentest Framework">Example 1-5</a>. Note the lines that refer to <span class="emphasis"><em>/root/adt-bundle-linux-x86-20131030/sdk/tools/android</em></span>. If the name of your ADT bundle folder is different (due to the release of a subsequent version), change this value to match the correct place where you installed the Android ADT in the previous section.</p><div class="example"><a id="installing_smartphone_pentest_framework"/><div class="example-title">Example 1-5. Installing Smartphone Pentest Framework</div><div class="example-contents"><pre class="programlisting">root@kali:~/Smartphone-Pentest-Framework# <span class="strong"><strong>nano kaliinstall</strong></span>&#13;
#!/bin/sh&#13;
## Install needed packages&#13;
echo -e "$(tput setaf 1)\nInstallin serialport, dbdpg, and  expect for perl\n"; echo "$(tput sgr0)"&#13;
echo -e "$(tput setaf 1)#########################################\n"; echo "$(tput sgr0)"&#13;
echo $cwd;&#13;
#apt-get -y install libexpect-perl libdbd-pg-perl libdevice-serialport-perl;&#13;
apt-get install ant&#13;
/root/adt-bundle-linux-x86-20131030/sdk/tools/android update sdk --no-ui --filter android-4 -a&#13;
/root/adt-bundle-linux-x86-20131030/sdk/tools/android update sdk --no-ui --filter addon-google_apis-google-4 -a&#13;
/root/adt-bundle-linux-x86-20131030/sdk/tools/android update sdk --no-ui --filter android-14 -a&#13;
/root/adt-bundle-linux-x86-20131030/sdk/tools/android update sdk --no-ui --filter addon-google_apis-google-14 -a&#13;
--<span class="emphasis"><em>snip</em></span>--</pre></div></div><p><a class="indexterm" id="iddle1597"/><a class="indexterm" id="iddle2279"/><a class="indexterm" id="iddle2322"/><a class="indexterm" id="iddle2374"/><a class="indexterm" id="iddle2382"/><a class="indexterm" id="iddle2483"/>Now run the <span class="emphasis"><em>kaliinstall</em></span> script, as shown here.</p><a id="pro_id00012"/><pre class="programlisting">root@kali:~/Smartphone-Pentest-Framework# <span class="strong"><strong>./kaliinstall</strong></span></pre><p>This will set up the SPF, which we’ll use in <a class="xref" href="ch20.xhtml" title="Chapter 20. Using the Smartphone Pentest Framework">Chapter 20</a>.</p><p>Finally, we need to make one more change to the configuration file for SPF. Change directories to <span class="emphasis"><em>Smartphone-Pentest-Framework/frameworkconsole</em></span> and open the file <span class="emphasis"><em>config</em></span> in nano. Look for the option <code class="literal">#LOCATION OF ANDROID</code> <code class="literal">SDK</code>. If your ADT bundle folder name has changed since the version current at the time of this writing, change it accordingly in the line that begins with <code class="literal">ANDROIDSDK=</code>.</p><a id="pro_id00013"/><pre class="programlisting">root@kali:~/Smartphone-Pentest-Framework# <span class="strong"><strong>cd frameworkconsole/</strong></span>&#13;
root@kali:~/Smartphone-Pentest-Framework/frameworkconsole# <span class="strong"><strong>nano config</strong></span>&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
#LOCATION OF ANDROID SDK&#13;
ANDROIDSDK = /root/adt-bundle-linux-x86-20131030/sdk&#13;
--<span class="emphasis"><em>snip</em></span>--</pre></div></div><div class="sect1" title="Target Virtual Machines"><div class="titlepage"><div><div><h2 class="title" id="target_virtual_machines" style="clear: both">Target Virtual Machines</h2></div></div></div><p>We’ll use three custom-built target machines to simulate vulnerabilities often found in client environments: Ubuntu 8.10, Windows XP SP3, and Windows 7 SP1.</p><p>You’ll find a link to a torrent containing the Ubuntu virtual machine at <span class="emphasis"><em><a class="ulink" href="http://www.nostarch.com/pentesting/" target="_top">http://www.nostarch.com/pentesting/</a></em></span>. The target system is compressed using the 7-Zip archive, and <span class="emphasis"><em>1stPentestBook?!</em></span> is the password for the archive. You can use 7-Zip programs to open the archives for all platforms. For the Windows and Linux packages, use <span class="emphasis"><em><a class="ulink" href="http://www.7-zip.org/download.html" target="_top">http://www.7-zip.org/download.html</a></em></span>; for Mac OS, use Ez7z at <span class="emphasis"><em><a class="ulink" href="http://ez7z.en.softonic.com/mac/" target="_top">http://ez7z.en.softonic.com/mac/</a></em></span>. The archive is ready for use as soon as it is unzipped.</p><p><a class="indexterm" id="iddle2129"/><a class="indexterm" id="iddle2377"/><a class="indexterm" id="iddle2395"/><a class="indexterm" id="iddle2485"/>To set up the Windows virtual machines, you’ll need to install and configure Windows XP SP3 and 32-bit Windows 7 SP1. Sources for the installation media include TechNet and MSDN (the Microsoft Developer Network), among others. (You should be able to use your Windows virtual machines on a trial basis for 30 days without a license key.)</p></div><div class="sect1" title="Creating the Windows XP Target"><div class="titlepage"><div><div><h2 class="title" id="creating_the_windows_xp_target" style="clear: both">Creating the Windows XP Target</h2></div></div></div><p>Your Windows XP target should be a base installation of Windows XP SP3 with no additional security updates. (Visit my website at <span class="emphasis"><em><a class="ulink" href="http://www.bulbsecurity.com/" target="_top">http://www.bulbsecurity.com/</a></em></span> for more information about finding a copy of Windows XP.) Once you have a copy of Windows XP SP3, here’s how to install it on Microsoft Windows or Mac OS.</p><div class="sect2" title="VMware Player on Microsoft Windows"><div class="titlepage"><div><div><h3 class="title" id="vmware_player_on_microsoft_windo-id00002">VMware Player on Microsoft Windows</h3></div></div></div><p>To install Windows XP on VMware Player for Windows:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Choose <span class="strong"><strong>Create A New Virtual Machine</strong></span> in VMware Player and point the New Virtual Machine Wizard to the Windows XP installation disk or ISO image. Depending on your source disk or image, you may be offered the option to use Easy Install (if you’re installing a version with a license key), or you may see a yellow triangle warning, “Could not detect which operating system is in this disc image. You will need to specify which operating system will be installed.” In the latter case, just press <span class="strong"><strong>Next</strong></span>.</p></li><li class="listitem"><p>In the Select a Guest Operating System dialog, select <span class="strong"><strong>Microsoft Windows</strong></span> in the Guest operating system section and your version of Windows XP in the drop-down box, as shown in <a class="xref" href="ch01.xhtml#selecting_your_version_of_windows_xp" title="Figure 1-20. Selecting your version of Windows XP">Figure 1-20</a>, and press <span class="strong"><strong>Next</strong></span>.</p><div class="figure"><a id="selecting_your_version_of_windows_xp"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00021"/><img alt="Selecting your version of Windows XP" src="httpatomoreillycomsourcenostarchimages2030232.png.jpg"/></div></div><div class="figure-title">Figure 1-20. Selecting your version of Windows XP</div></div></li><li class="listitem"><p><a class="indexterm" id="iddle2045"/><a class="indexterm" id="iddle2209"/>In the next dialog, enter <span class="strong"><strong><code class="literal">Bookxp XP SP3</code></strong></span> as the name of your virtual machine and press <span class="strong"><strong>Next</strong></span>.</p></li><li class="listitem"><p>In the Specify Disk Capacity dialog, accept the recommended hard disk size for your virtual machine of 40GB and check the box for <span class="strong"><strong>Store virtual disk as a single file</strong></span>, as shown in <a class="xref" href="ch01.xhtml#specifying_the_disk_capacity" title="Figure 1-21. Specifying the disk capacity">Figure 1-21</a>, and press <span class="strong"><strong>Next</strong></span>.</p><div class="figure"><a id="specifying_the_disk_capacity"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00022"/><img alt="Specifying the disk capacity" src="httpatomoreillycomsourcenostarchimages2030234.png.jpg"/></div></div><div class="figure-title">Figure 1-21. Specifying the disk capacity</div></div><div class="note" title="Note"><h3 class="title"><a id="ch01note06"/>Note</h3><p>The Virtual Machine will not take up the entire 40GB; it will only take up space on your hard drive as needed. This is just a maximum value.</p></div></li><li class="listitem"><p>In the Ready to Create Virtual Machine dialog, shown in <a class="xref" href="ch01.xhtml#customizing_your_hardware" title="Figure 1-22. Customizing your hardware">Figure 1-22</a>, click <span class="strong"><strong>Customize Hardware</strong></span>.</p><div class="figure"><a id="customizing_your_hardware"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00023"/><img alt="Customizing your hardware" src="httpatomoreillycomsourcenostarchimages2030236.png.jpg"/></div></div><div class="figure-title">Figure 1-22. Customizing your hardware</div></div></li><li class="listitem"><p><a class="indexterm" id="iddle1127"/><a class="indexterm" id="iddle1457"/><a class="indexterm" id="iddle1653"/><a class="indexterm" id="iddle1824"/><a class="indexterm" id="iddle2390"/>In the Hardware dialog, choose <span class="strong"><strong>Network Adapter</strong></span>, and in the Network Connection field that appears, select <span class="strong"><strong>Bridged: Connected directly to the physical network</strong></span>. Next, click <span class="strong"><strong>Configure Adapters</strong></span> and select the adapter you’re using to connect to the Internet, as shown in <a class="xref" href="ch01.xhtml#configuring_your_network_adapter_as_brid" title="Figure 1-23. Configuring your network adapter as bridged">Figure 1-23</a>. Then press <span class="strong"><strong>OK</strong></span>, <span class="strong"><strong>Close</strong></span>, and <span class="strong"><strong>Finish</strong></span>.</p></li></ol></div><div class="figure"><a id="configuring_your_network_adapter_as_brid"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00024"/><img alt="Configuring your network adapter as bridged" src="httpatomoreillycomsourcenostarchimages2030238.png.jpg"/></div></div><div class="figure-title">Figure 1-23. Configuring your network adapter as bridged</div></div><p>You should now be able to play your Windows XP virtual machine. Continue to the instructions for installing and activating Windows XP in <a class="xref" href="ch01.xhtml#installing_and_activating_windows" title="Installing and Activating Windows">Installing and Activating Windows</a>.</p></div><div class="sect2" title="VMware Fusion on Mac OS"><div class="titlepage"><div><div><h3 class="title" id="vmware_fusion_on_mac_os-id00003">VMware Fusion on Mac OS</h3></div></div></div><p>In VMware Fusion, go to <span class="strong"><strong>File</strong></span> ▸ <span class="strong"><strong>New</strong></span> ▸ <span class="strong"><strong>Import from disk or image</strong></span> and point it to the Windows XP installation disk or image, as shown in <a class="xref" href="ch01.xhtml#creating_a_new_virtual_machine" title="Figure 1-24. Creating a new virtual machine">Figure 1-24</a>.</p><p>Follow the prompts to create a fresh installation of Windows XP SP3.</p><div class="figure"><a id="creating_a_new_virtual_machine"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00025"/><img alt="Creating a new virtual machine" src="httpatomoreillycomsourcenostarchimages2030240.png.jpg"/></div></div><div class="figure-title">Figure 1-24. Creating a new virtual machine</div></div></div><div class="sect2" title="Installing and Activating Windows"><div class="titlepage"><div><div><h3 class="title" id="installing_and_activating_windows">Installing and Activating Windows</h3></div></div></div><p><a class="indexterm" id="iddle1615"/><a class="indexterm" id="iddle2486"/>As part of the installation process, you will be prompted for a Windows license key. If you have one, enter it here. If not, you should be able to use the virtual machine on a trial basis for 30 days. To continue without entering a license key, click <span class="strong"><strong>Next</strong></span> when prompted for the key. A pop-up will warn you that entering a license key is recommended and ask if you would like to enter one now, as shown in <a class="xref" href="ch01.xhtml#license_key_dialog" title="Figure 1-25. License key dialog">Figure 1-25</a>. Just click <span class="strong"><strong>No</strong></span>.</p><div class="figure"><a id="license_key_dialog"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00026"/><img alt="License key dialog" src="httpatomoreillycomsourcenostarchimages2030242.png.jpg"/></div></div><div class="figure-title">Figure 1-25. License key dialog</div></div><p><a class="indexterm" id="iddle1022"/><a class="indexterm" id="iddle1198"/><a class="indexterm" id="iddle2521"/>As shown in <a class="xref" href="ch01.xhtml#setting_the_computer_name_and_administra" title="Figure 1-26. Setting the computer name and Administrator password">Figure 1-26</a>, when prompted, set <span class="strong"><strong>Computer name</strong></span> to <span class="strong"><strong><code class="literal">Bookxp</code></strong></span>. Set <span class="strong"><strong>Administrator password</strong></span> to <span class="strong"><strong><code class="literal">password</code></strong></span>.</p><div class="figure"><a id="setting_the_computer_name_and_administra"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00027"/><img alt="Setting the computer name and Administrator password" src="httpatomoreillycomsourcenostarchimages2030244.png.jpg"/></div></div><div class="figure-title">Figure 1-26. Setting the computer name and Administrator password</div></div><p>You can leave the date/time and TCP/IP settings at their defaults when prompted. Likewise, leave the Windows XP target as part of the workgroup WORKGROUP instead of joining it to a domain, as shown in <a class="xref" href="ch01.xhtml#workgroup_settings" title="Figure 1-27. Workgroup settings">Figure 1-27</a>.</p><div class="figure"><a id="workgroup_settings"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00028"/><img alt="Workgroup settings" src="httpatomoreillycomsourcenostarchimages2030246.png.jpg"/></div></div><div class="figure-title">Figure 1-27. Workgroup settings</div></div><p><a class="indexterm" id="iddle1086"/><a class="indexterm" id="iddle2119"/><a class="indexterm" id="iddle2484"/>Tell Windows not to automatically install security updates, as shown in <a class="xref" href="ch01.xhtml#turning_off_automatic_security_updates" title="Figure 1-28. Turning off automatic security updates">Figure 1-28</a>. This step is important, because some of the exploits we will run rely on missing Windows patches.</p><div class="figure"><a id="turning_off_automatic_security_updates"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00029"/><img alt="Turning off automatic security updates" src="httpatomoreillycomsourcenostarchimages2030248.png.jpg"/></div></div><div class="figure-title">Figure 1-28. Turning off automatic security updates</div></div><p>You will then be prompted to activate Windows. If you entered a license key, go ahead and activate it. Otherwise you can choose <span class="strong"><strong>No, remind me every few days</strong></span>, as shown in <a class="xref" href="ch01.xhtml#activating_windows" title="Figure 1-29. Activating Windows">Figure 1-29</a>.</p><div class="figure"><a id="activating_windows"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00030"/><img alt="Activating Windows" src="httpatomoreillycomsourcenostarchimages2030250.png.jpg"/></div></div><div class="figure-title">Figure 1-29. Activating Windows</div></div><p><a class="indexterm" id="iddle2337"/><a class="indexterm" id="iddle2394"/><a class="indexterm" id="iddle2396"/>Now create user accounts <span class="emphasis"><em>georgia</em></span> and <span class="emphasis"><em>secret</em></span>, as shown in <a class="xref" href="ch01.xhtml#adding_users" title="Figure 1-30. Adding users">Figure 1-30</a>. We will create passwords for these users after setup is finished.</p><div class="figure"><a id="adding_users"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00031"/><img alt="Adding users" src="httpatomoreillycomsourcenostarchimages2030252.png.jpg"/></div></div><div class="figure-title">Figure 1-30. Adding users</div></div><p>When Windows starts up, log in as the user <span class="emphasis"><em>georgia</em></span> with no password.</p></div><div class="sect2" title="Installing VMware Tools"><div class="titlepage"><div><div><h3 class="title" id="installing_vmware_tools">Installing VMware Tools</h3></div></div></div><p>Now install VMware Tools, which will make it easier to use your virtual machine by, for example, letting you copy/paste and drag programs onto the virtual machine from the host system.</p><div class="sect3" title="VMware Player on Microsoft Windows"><div class="titlepage"><div><div><h4 class="title" id="vmware_player_on_microsoft_windo-id00004">VMware Player on Microsoft Windows</h4></div></div></div><p>In VMware Player, install VMware Tools from <span class="strong"><strong>Player</strong></span> ▸ <span class="strong"><strong>Manage</strong></span> ▸ <span class="strong"><strong>Install VMware Tools</strong></span>, as shown in <a class="xref" href="ch01.xhtml#installing_vmware_tools_in_vmware_player" title="Figure 1-31. Installing VMware Tools in VMware Player">Figure 1-31</a>. The VMware Tools installer should automatically run in Windows XP.</p><div class="figure"><a id="installing_vmware_tools_in_vmware_player"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00032"/><img alt="Installing VMware Tools in VMware Player" src="httpatomoreillycomsourcenostarchimages2030254.png.jpg"/></div></div><div class="figure-title">Figure 1-31. Installing VMware Tools in VMware Player</div></div></div><div class="sect3" title="VMware Fusion on Mac OS"><div class="titlepage"><div><div><h4 class="title" id="vmware_fusion_on_mac_os-id00005">VMware Fusion on Mac OS</h4></div></div></div><p><a class="indexterm" id="iddle1654"/><a class="indexterm" id="iddle2391"/>Install VMware Tools from <span class="strong"><strong>Virtual Machines</strong></span> ▸ <span class="strong"><strong>Install VMware Tools</strong></span>, as shown in <a class="xref" href="ch01.xhtml#installing_vmware_tools_in_vmware_fusion" title="Figure 1-32. Installing VMware Tools in VMware Fusion">Figure 1-32</a>. The VMware Tools installer should automatically run in Windows XP.</p><div class="figure"><a id="installing_vmware_tools_in_vmware_fusion"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00033"/><img alt="Installing VMware Tools in VMware Fusion" src="httpatomoreillycomsourcenostarchimages2030256.png.jpg"/></div></div><div class="figure-title">Figure 1-32. Installing VMware Tools in VMware Fusion</div></div></div></div><div class="sect2" title="Turning Off Windows Firewall"><div class="titlepage"><div><div><h3 class="title" id="turning_off_windows_firewall">Turning Off Windows Firewall</h3></div></div></div><p><a class="indexterm" id="iddle1904"/><a class="indexterm" id="iddle2465"/>Now open the Control Panel from the Windows Start menu. Click <span class="strong"><strong>Security Center</strong></span> ▸ <span class="strong"><strong>Windows Firewall</strong></span> to turn off the Windows Firewall, as shown in <a class="xref" href="ch01.xhtml#turning_off_the_windows_firewall" title="Figure 1-33. Turning off the Windows firewall">Figure 1-33</a>.</p><div class="figure"><a id="turning_off_the_windows_firewall"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00034"/><img alt="Turning off the Windows firewall" src="httpatomoreillycomsourcenostarchimages2030258.png.jpg"/></div></div><div class="figure-title">Figure 1-33. Turning off the Windows firewall</div></div></div><div class="sect2" title="Setting User Passwords"><div class="titlepage"><div><div><h3 class="title" id="setting_user_passwords">Setting User Passwords</h3></div></div></div><p>Again in the Control Panel, go to User Accounts. Click the user <span class="strong"><strong>georgia</strong></span> and then select <span class="strong"><strong>Create a password</strong></span>. Set <span class="emphasis"><em>georgia</em></span>’s password to <span class="strong"><strong><code class="literal">password</code></strong></span>, as shown in <a class="xref" href="ch01.xhtml#setting_a_user_password" title="Figure 1-34. Setting a user password">Figure 1-34</a>. Do the same thing for the user <span class="emphasis"><em>secret</em></span>, but set <span class="emphasis"><em>secret</em></span>’s password to <span class="strong"><strong><code class="literal">Password123</code></strong></span>.</p><div class="figure"><a id="setting_a_user_password"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00035"/><img alt="Setting a user password" src="httpatomoreillycomsourcenostarchimages2030260.png.jpg"/></div></div><div class="figure-title">Figure 1-34. Setting a user password</div></div></div><div class="sect2" title="Setting a Static IP Address"><div class="titlepage"><div><div><h3 class="title" id="setting_a_static_ip_address">Setting a Static IP Address</h3></div></div></div><p><a class="indexterm" id="iddle1255"/><a class="indexterm" id="iddle1559"/><a class="indexterm" id="iddle1562"/><a class="indexterm" id="iddle1937"/><a class="indexterm" id="iddle2246"/>Next, set a static IP address so your networking information won’t change as you work through the book. But first we need to figure out the address of our default gateway.</p><p>Ensure that your Windows XP system is set to use bridged networking in VMware. By default, your virtual machine will automatically pull an IP address using DHCP.</p><p>To find the default gateway, open a Windows command prompt by going to <span class="strong"><strong>Start</strong></span> ▸ <span class="strong"><strong>Run</strong></span>, entering <span class="strong"><strong><code class="literal">cmd</code></strong></span>, and clicking <span class="strong"><strong>OK</strong></span>. In the command prompt, enter <span class="strong"><strong><code class="literal">ipconfig</code></strong></span>. This will show you the networking information, including the default gateway.</p><a id="pro_id00014"/><pre class="programlisting">C:\Documents and Settings\georgia&gt;<span class="strong"><strong>ipconfig</strong></span>&#13;
&#13;
Windows IP Configuration&#13;
&#13;
&#13;
Ethernet adapter Local Area Connection:&#13;
&#13;
        Connection-specific DNS Suffix  . : XXXXXXXX&#13;
        IP Address. . . . . . . . . . . . : 192.168.20.10&#13;
        Subnet Mask . . . . . . . . . . . : 255.255.255.0&#13;
        Default Gateway . . . . . . . . . : 192.168.20.1&#13;
&#13;
C:\Documents and Settings\georgia&gt;</pre><p>In my case, the IP address is 192.168.20.10, the subnet mask is 255.255.255.0, and the default gateway is 192.168.20.1.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>In the Control Panel, go to <span class="strong"><strong>Network and Internet Connections</strong></span> and click <span class="strong"><strong>Network Connections</strong></span> at the bottom of the screen.</p></li><li class="listitem"><p>Right-click <span class="strong"><strong>Local Area Connection</strong></span> and then select <span class="strong"><strong>Properties</strong></span>.</p></li><li class="listitem"><p>Highlight <span class="strong"><strong>Internet Protocol (TCP/IP)</strong></span> and select <span class="strong"><strong>Properties</strong></span>. Now enter a static IP address and set the Subnet mask and Default gateway to match the data you found with the <code class="literal">ipconfig</code> command, as shown in <a class="xref" href="ch01.xhtml#setting_a_static_ip_address-id00006" title="Figure 1-35. Setting a static IP address">Figure 1-35</a>. Set the Preferred DNS server to your default gateway as well.</p></li></ol></div><p>Now it’s time to see if our virtual machines can communicate. Once you’re sure that the settings match, return to the Kali virtual machine (start it if you had shut it down) and enter <span class="strong"><strong><code class="literal">ping &lt;</code></strong></span><span class="bolditalic"><code class="literal">static</code></span> <span class="bolditalic"><code class="literal">ip address of your Windows XP virtual machine</code></span><span class="strong"><strong><code class="literal">&gt;</code></strong></span>, as shown here.</p><div class="note" title="Note"><h3 class="title"><a id="ch01note07"/>Note</h3><p>My IP address is 192.168.20.10. Throughout the book, you should replace this value with the IP address of your systems.</p></div><a id="pro_id00015"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>ping 192.168.</strong></span><span class="bolditalic">20.10</span>&#13;
&#13;
PING 192.168.20.10 (192.168.20.10) 56(84) bytes of data.&#13;
64 bytes from 192.168.20.10: icmp_req=1 ttl=128 time=3.06 ms&#13;
<span class="strong"><strong>^C</strong></span></pre><div class="figure"><a id="setting_a_static_ip_address-id00006"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00036"/><img alt="Setting a static IP address" src="httpatomoreillycomsourcenostarchimages2030262.png.jpg"/></div></div><div class="figure-title">Figure 1-35. Setting a static IP address</div></div><p><a class="indexterm" id="iddle1266"/><a class="indexterm" id="iddle1281"/><a class="indexterm" id="iddle1554"/><a class="indexterm" id="iddle1939"/><a class="indexterm" id="iddle2490"/>Enter <span class="smaller">ctrl</span>-C to stop the <code class="literal">ping</code> command. If you see output beginning with <code class="literal">64 bytes from &lt;</code><span class="emphasis"><em><code class="literal">ip address of XP</code></em></span><code class="literal">&gt;</code>, as shown previously, your virtual machines are able to communicate. Congratulations! You’ve set up a network of virtual machines.</p><p>If instead you see a message including the text <code class="literal">Destination Host</code> <code class="literal">Unreachable</code>, troubleshoot your networking: Make sure your virtual machines are on the same bridged virtual network, check that your default gateway is correct, and so on.</p></div><div class="sect2" title="Making XP Act Like It’s a Member of a Windows Domain"><div class="titlepage"><div><div><h3 class="title" id="making_xp_act_like_itapostrophes_a_membe">Making XP Act Like It’s a Member of a Windows Domain</h3></div></div></div><p>Finally, we need to modify a setting in Windows XP so that it will behave as if it were a member of a Windows domain, as many of your clients will be. I’m not having you set up an entire Windows domain here, but during post exploitation, a couple of exercises will simulate a domain environment. Return to your XP virtual machine and follow these steps.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Select <span class="strong"><strong>Start</strong></span> ▸ <span class="strong"><strong>Run</strong></span> and enter <span class="strong"><strong><code class="literal">secpol.msc</code></strong></span> to open the Local Security Settings panel.</p></li><li class="listitem"><p>Expand <span class="strong"><strong>Local Policies</strong></span> on the left and double-click <span class="strong"><strong>Security Options</strong></span> on the right.</p></li><li class="listitem"><p>In the Policy list in the pane on the right, double-click <span class="strong"><strong>Network access: Sharing and security model for local accounts</strong></span> and choose <span class="strong"><strong>Classic - local users authenticate as themselves</strong></span> from the drop-down list, as shown in <a class="xref" href="ch01.xhtml#changing_a_local_security_setting_to_mak" title="Figure 1-36. Changing a local security setting to make your target act like a member of a Windows domain">Figure 1-36</a>.</p><div class="figure"><a id="changing_a_local_security_setting_to_mak"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00037"/><img alt="Changing a local security setting to make your target act like a member of a Windows domain" src="httpatomoreillycomsourcenostarchimages2030264.png.jpg"/></div></div><div class="figure-title">Figure 1-36. Changing a local security setting to make your target act like a member of a Windows domain</div></div></li><li class="listitem"><p><a class="indexterm" id="iddle1543"/><a class="indexterm" id="iddle2195"/><a class="indexterm" id="iddle2372"/><a class="indexterm" id="iddle2416"/><a class="indexterm" id="iddle2550"/>Click <span class="strong"><strong>Apply</strong></span> and then <span class="strong"><strong>OK</strong></span>.</p></li><li class="listitem"><p>Close any open windows in your virtual machine.</p></li></ol></div></div><div class="sect2" title="Installing Vulnerable Software"><div class="titlepage"><div><div><h3 class="title" id="installing_vulnerable_software">Installing Vulnerable Software</h3></div></div></div><p>In this section we’ll install some vulnerable software on our Windows XP virtual machine. We’ll be attacking this software in later chapters. Open your Windows XP virtual machine and, while still logged in as user <span class="emphasis"><em>georgia</em></span>, follow the directions to install each of the packages listed here.</p><div class="sect3" title="Zervit 0.4"><div class="titlepage"><div><div><h4 class="title" id="zervit_0dot4">Zervit 0.4</h4></div></div></div><p>Download Zervit version 0.4 from <span class="emphasis"><em><a class="ulink" href="http://www.exploit-db.com/exploits/12582/" target="_top">http://www.exploit-db.com/exploits/12582/</a></em></span>. (Click the Vulnerable App option to download the files.) Unzip the downloaded archive and double-click the Zervit program to open and run it. Then enter port number <span class="strong"><strong><code class="literal">3232</code></strong></span> in the console when the software starts. Answer <span class="strong"><strong><code class="literal">Y</code></strong></span> to allowing directory listing, as shown in <a class="xref" href="ch01.xhtml#starting_zervit_0dot4" title="Figure 1-37. Starting Zervit 0.4">Figure 1-37</a>. Zervit will not automatically restart when you reboot Windows XP, so you will need to restart it if you reboot.</p><div class="figure"><a id="starting_zervit_0dot4"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00038"/><img alt="Starting Zervit 0.4" src="httpatomoreillycomsourcenostarchimages2030266.png"/></div></div><div class="figure-title">Figure 1-37. Starting Zervit 0.4</div></div></div><div class="sect3" title="SLMail 5.5"><div class="titlepage"><div><div><h4 class="title" id="slmail_5dot5">SLMail 5.5</h4></div></div></div><p><a class="indexterm" id="iddle1293"/><a class="indexterm" id="iddle1539"/><a class="indexterm" id="iddle2167"/>Download and run SLMail version 5.5 from <span class="emphasis"><em><a class="ulink" href="http://www.exploit-db.com/exploits/638/" target="_top">http://www.exploit-db.com/exploits/638/</a></em></span>, using the default options when prompted. Just click <span class="strong"><strong>Next</strong></span> for all of the options and don’t change anything. If you get a warning about a domain name, just ignore it and click <span class="strong"><strong>OK</strong></span>. We don’t really need to deliver any email here.</p><p>Once SLMail is installed, restart your virtual machine. Then open <span class="strong"><strong>Start</strong></span> ▸ <span class="strong"><strong>All Programs</strong></span> ▸ <span class="strong"><strong>SL Products</strong></span> ▸ <span class="strong"><strong>SLMail</strong></span> ▸ <span class="strong"><strong>SLMail Configuration</strong></span>. In the Users tab (default), right-click the <span class="strong"><strong>SLMail Configuration</strong></span> window and choose <span class="strong"><strong>New</strong></span> ▸ <span class="strong"><strong>User</strong></span>, as shown in <a class="xref" href="ch01.xhtml#adding_a_user_in_slmail" title="Figure 1-38. Adding a user in SLMail">Figure 1-38</a>.</p><div class="figure"><a id="adding_a_user_in_slmail"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00039"/><img alt="Adding a user in SLMail" src="httpatomoreillycomsourcenostarchimages2030268.png"/></div></div><div class="figure-title">Figure 1-38. Adding a user in SLMail</div></div><p><a class="indexterm" id="iddle1001"/><a class="indexterm" id="iddle1289"/><a class="indexterm" id="iddle1520"/>Click the newly created user icon, enter username <span class="strong"><strong>georgia</strong></span>, and fill in the information for the user, as shown in <a class="xref" href="ch01.xhtml#setting_the_user_information_in_slmail" title="Figure 1-39. Setting the user information in SLMail">Figure 1-39</a>. The mailbox name should be <span class="emphasis"><em>georgia</em></span> with password <span class="emphasis"><em>password</em></span>. Keep the defaults and press <span class="strong"><strong>OK</strong></span> once you’ve finished.</p><div class="figure"><a id="setting_the_user_information_in_slmail"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00040"/><img alt="Setting the user information in SLMail" src="httpatomoreillycomsourcenostarchimages2030270.png.jpg"/></div></div><div class="figure-title">Figure 1-39. Setting the user information in SLMail</div></div></div><div class="sect3" title="3Com TFTP 2.0.1"><div class="titlepage"><div><div><h4 class="title" id="threecom_tftp_2dot0dot1">3Com TFTP 2.0.1</h4></div></div></div><p>Next, download 3Com TFTP version 2.0.1 as a zipped file from <span class="emphasis"><em><a class="ulink" href="http://www.exploit-db.com/exploits/3388/" target="_top">http://www.exploit-db.com/exploits/3388/</a></em></span>. Extract the files and copy <span class="emphasis"><em>3CTftpSvcCtrl</em></span> and <span class="emphasis"><em>3CTftpSvc</em></span> to the directory <span class="emphasis"><em>C:\Windows</em></span>, as shown in <a class="xref" href="ch01.xhtml#copying_3com_tftp_to_cslashwindows" title="Figure 1-40. Copying 3Com TFTP to C:\Windows">Figure 1-40</a>.</p><div class="figure"><a id="copying_3com_tftp_to_cslashwindows"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00041"/><img alt="Copying 3Com TFTP to C:\Windows" src="httpatomoreillycomsourcenostarchimages2030272.png.jpg"/></div></div><div class="figure-title">Figure 1-40. Copying 3Com TFTP to C:\Windows</div></div><p><a class="indexterm" id="iddle1547"/><a class="indexterm" id="iddle2536"/><a class="indexterm" id="iddle2537"/>Then open <span class="emphasis"><em>3CTftpSvcCtrl</em></span> (the blue <span class="emphasis"><em>3</em></span> icon) and click <span class="strong"><strong>Install Service</strong></span>, as shown in <a class="xref" href="ch01.xhtml#installing_3com_tftp" title="Figure 1-41. Installing 3Com TFTP">Figure 1-41</a>.</p><div class="figure"><a id="installing_3com_tftp"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00042"/><img alt="Installing 3Com TFTP" src="httpatomoreillycomsourcenostarchimages2030274.png.jpg"/></div></div><div class="figure-title">Figure 1-41. Installing 3Com TFTP</div></div><p>Click <span class="strong"><strong>Start Service</strong></span> to start 3Com TFTP for the first time. From now on, it will automatically start when you boot up the computer. Press <span class="strong"><strong>Quit</strong></span> to exit.</p></div><div class="sect3" title="XAMPP 1.7.2"><div class="titlepage"><div><div><h4 class="title" id="xampp_1dot7dot2">XAMPP 1.7.2</h4></div></div></div><p>Now we’ll install an older version of the XAMPP software, version 1.7.2, from <span class="emphasis"><em><a class="ulink" href="http://www.oldapps.com/xampp.php?old_xampp=45/" target="_top">http://www.oldapps.com/xampp.php?old_xampp=45/</a></em></span>. (The older version of Internet Explorer on Windows XP seems to have some trouble opening this page. If you have trouble, download the software from your host system and copy it onto Windows XP’s desktop.)</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Run the installer and accept the default options as they’re presented to you. When installation is finished, choose option <span class="strong"><strong><code class="literal">1. start XAMPP Control Panel</code></strong></span>, as shown in <a class="xref" href="ch01.xhtml#starting_xampp_control_panel" title="Figure 1-42. Starting XAMPP Control Panel">Figure 1-42</a>.</p><div class="figure"><a id="starting_xampp_control_panel"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00043"/><img alt="Starting XAMPP Control Panel" src="httpatomoreillycomsourcenostarchimages2030276.png"/></div></div><div class="figure-title">Figure 1-42. Starting XAMPP Control Panel</div></div></li><li class="listitem"><p><a class="indexterm" id="iddle1063"/><a class="indexterm" id="iddle1405"/><a class="indexterm" id="iddle1523"/><a class="indexterm" id="iddle1527"/><a class="indexterm" id="iddle1536"/><a class="indexterm" id="iddle1788"/>In the XAMPP Control Panel, install the Apache, MySQL, and FileZilla services (select the <span class="strong"><strong>Svc</strong></span> checkbox to the left of the service name). Then click the <span class="strong"><strong>Start</strong></span> button for each service. Your screen should look like the one shown in <a class="xref" href="ch01.xhtml#installing_and_starting_xampp_services" title="Figure 1-43. Installing and starting XAMPP services">Figure 1-43</a>.</p><div class="figure"><a id="installing_and_starting_xampp_services"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00044"/><img alt="Installing and starting XAMPP services" src="httpatomoreillycomsourcenostarchimages2030278.png.jpg"/></div></div><div class="figure-title">Figure 1-43. Installing and starting XAMPP services</div></div></li><li class="listitem"><p>Click the <span class="strong"><strong>Admin</strong></span> button for FileZilla in the XAMPP Control Panel. The Admin panel is shown in <a class="xref" href="ch01.xhtml#filezilla_admin_panel" title="Figure 1-44. FileZilla Admin panel">Figure 1-44</a>.</p><div class="figure"><a id="filezilla_admin_panel"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00045"/><img alt="FileZilla Admin panel" src="httpatomoreillycomsourcenostarchimages2030280.png"/></div></div><div class="figure-title">Figure 1-44. FileZilla Admin panel</div></div></li><li class="listitem"><p>Go to <span class="strong"><strong>Edit</strong></span> ▸ <span class="strong"><strong>Users</strong></span> to open the Users dialog, shown in <a class="xref" href="ch01.xhtml#adding_an_ftp_user" title="Figure 1-45. Adding an FTP user">Figure 1-45</a>.</p></li><li class="listitem"><p>Click the <span class="strong"><strong>Add</strong></span> button on the right of the dialog box.</p></li><li class="listitem"><p>In the Add User Account dialog box, enter <span class="strong"><strong><code class="literal">georgia</code></strong></span> and press <span class="strong"><strong>OK</strong></span>.</p><div class="figure"><a id="adding_an_ftp_user"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00046"/><img alt="Adding an FTP user" src="httpatomoreillycomsourcenostarchimages2030282.png.jpg"/></div></div><div class="figure-title">Figure 1-45. Adding an FTP user</div></div></li><li class="listitem"><p><a class="indexterm" id="iddle1412"/><a class="indexterm" id="iddle1426"/>With <span class="emphasis"><em>georgia</em></span> highlighted, check the <span class="strong"><strong>Password</strong></span> box under Account Settings and enter <span class="strong"><strong><code class="literal">password</code></strong></span>.</p></li></ol></div><p>Click <span class="strong"><strong>OK</strong></span>. When prompted to share a folder, browse to the <span class="emphasis"><em>georgia’</em></span>s <span class="emphasis"><em>Documents</em></span> folder on Windows and select it to share it, as shown in <a class="xref" href="ch01.xhtml#sharing_a_folder_via_ftp" title="Figure 1-46. Sharing a folder via FTP">Figure 1-46</a>. Leave the defaults for all other checkboxes, as shown in the figure. Click <span class="strong"><strong>OK</strong></span> once you’ve finished and exit the various open windows.</p><div class="figure"><a id="sharing_a_folder_via_ftp"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00047"/><img alt="Sharing a folder via FTP" src="httpatomoreillycomsourcenostarchimages2030284.png.jpg"/></div></div><div class="figure-title">Figure 1-46. Sharing a folder via FTP</div></div></div><div class="sect3" title="Adobe Acrobat Reader"><div class="titlepage"><div><div><h4 class="title" id="adobe_acrobat_reader">Adobe Acrobat Reader</h4></div></div></div><p><a class="indexterm" id="iddle1024"/><a class="indexterm" id="iddle1251"/><a class="indexterm" id="iddle1296"/><a class="indexterm" id="iddle1298"/><a class="indexterm" id="iddle1502"/><a class="indexterm" id="iddle1521"/><a class="indexterm" id="iddle1525"/><a class="indexterm" id="iddle1530"/><a class="indexterm" id="iddle1538"/><a class="indexterm" id="iddle1544"/><a class="indexterm" id="iddle1546"/><a class="indexterm" id="iddle1754"/><a class="indexterm" id="iddle2024"/><a class="indexterm" id="iddle2420"/><a class="indexterm" id="iddle2498"/>Now we’ll install Adobe Acrobat Reader version 8.1.2 from <span class="emphasis"><em><a class="ulink" href="http://www.oldapps.com/adobe_reader.php?old_adobe=17/" target="_top">http://www.oldapps.com/adobe_reader.php?old_adobe=17/</a></em></span>. Follow the default prompts to install it. Click <span class="strong"><strong>Finish</strong></span> once you’re done. (Here again you may need to download the file to your host system and copy it to Windows XP’s desktop.)</p></div><div class="sect3" title="War-FTP"><div class="titlepage"><div><div><h4 class="title" id="war-ftp">War-FTP</h4></div></div></div><p>Next, download and install War-FTP version 1.65 from <span class="emphasis"><em><a class="ulink" href="http://www.exploit-db.com/exploits/3570/" target="_top">http://www.exploit-db.com/exploits/3570/</a></em></span>. Download the executable from <span class="emphasis"><em>exploit-db.com</em></span> to <span class="emphasis"><em>georgia</em></span>’s desktop and run the downloaded executable to install. You do not need to start the FTP service; we will turn it on when we discuss exploit development in <a class="xref" href="ch16.xhtml" title="Chapter 16. A Stack-Based Buffer Overflow in Linux">Chapter 16</a> through <a class="xref" href="ch19.xhtml" title="Chapter 19. Fuzzing, Porting Exploits, and Metasploit Modules">Chapter 19</a>.</p></div><div class="sect3" title="WinSCP"><div class="titlepage"><div><div><h4 class="title" id="winscp">WinSCP</h4></div></div></div><p>Download and install the latest version of WinSCP from <span class="emphasis"><em><a class="ulink" href="http://winscp.net/" target="_top">http://winscp.net/</a></em></span>. Choose the <span class="strong"><strong>Typical Installation</strong></span> option. You can uncheck the additional add-ons. Click <span class="strong"><strong>Finish</strong></span> once you’re done.</p></div></div><div class="sect2" title="Installing Immunity Debugger and Mona"><div class="titlepage"><div><div><h3 class="title" id="installing_immunity_debugger_and_mona">Installing Immunity Debugger and Mona</h3></div></div></div><p>Now we’ll finish up the Windows XP virtual machine by installing a debugger, a tool that helps detect errors in computer programs. We’ll be using the debugger in the exploit development chapters. Visit the Immunity Debugger registration page at <span class="emphasis"><em><a class="ulink" href="http://debugger.immunityinc.com/ID_register.py" target="_top">http://debugger.immunityinc.com/ID_register.py</a></em></span>. Complete the registration and then press the <span class="strong"><strong>Download</strong></span> button. Run the installer.</p><p>When asked if you want to install Python, click <span class="strong"><strong>Yes</strong></span>. Accept the license agreement and follow the default installation prompts. When you close the installer, the Python installation will automatically run. Use the default installation values.</p><p>Once Immunity Debugger and Python have been installed, download <span class="emphasis"><em>mona.py</em></span> from <span class="emphasis"><em><a class="ulink" href="http://redmine.corelan.be/projects/mona/repository/raw/mona.py/" target="_top">http://redmine.corelan.be/projects/mona/repository/raw/mona.py/</a></em></span>. Copy <span class="emphasis"><em>mona.py</em></span> to <span class="emphasis"><em>C:\Program Files\Immunity Inc\Immunity Debugger\PyCommands</em></span>, as shown in <a class="xref" href="ch01.xhtml#installing_mona" title="Figure 1-47. Installing Mona">Figure 1-47</a>.</p><p>Open Immunity Debugger, and at the command prompt at the bottom of the window, enter <span class="strong"><strong><code class="literal">!mona config -set workingfolder c:\logs\%p</code></strong></span>, as shown in <a class="xref" href="ch01.xhtml#setting_up_monaapostrophes_logs" title="Figure 1-48. Setting up Mona’s logs">Figure 1-48</a>. This command tells mona to log its output to <span class="emphasis"><em>C:\logs\&lt;program name&gt;</em></span>, where <span class="emphasis"><em>&lt;program name&gt;</em></span> is the program Immunity Debugger is currently debugging.</p><p>Now our Windows XP target is set up and ready to go.</p><div class="figure"><a id="installing_mona"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00048"/><img alt="Installing Mona" src="httpatomoreillycomsourcenostarchimages2030286.png.jpg"/></div></div><div class="figure-title">Figure 1-47. Installing Mona</div></div><div class="figure"><a id="setting_up_monaapostrophes_logs"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00049"/><img alt="Setting up Mona’s logs" src="httpatomoreillycomsourcenostarchimages2030288.png"/></div></div><div class="figure-title">Figure 1-48. Setting up Mona’s logs</div></div></div></div><div class="sect1" title="Setting Up the Ubuntu 8.10 Target"><div class="titlepage"><div><div><h2 class="title" id="setting_up_the_ubuntu_8dot10_target" style="clear: both">Setting Up the Ubuntu 8.10 Target</h2></div></div></div><p><a class="indexterm" id="iddle1534"/><a class="indexterm" id="iddle1750"/><a class="indexterm" id="iddle1128"/><a class="indexterm" id="iddle2323"/><a class="indexterm" id="iddle2338"/><a class="indexterm" id="iddle2375"/><a class="indexterm" id="iddle2376"/><a class="indexterm" id="iddle2397"/><a class="indexterm" id="iddle2472"/><a class="indexterm" id="iddle2475"/>Because Linux is open source, you can simply download the Linux virtual machine as part of the torrent for this book. Unzip the 7-Zip archive <span class="emphasis"><em>BookUbuntu.7zip</em></span> and use the password <span class="emphasis"><em>1stPentestBook?!</em></span> to open the archive. Open the <span class="emphasis"><em>.vmx</em></span> file in VMware. If you are prompted with a message that says the virtual machine appears to be in use, click <span class="strong"><strong>Take Ownership</strong></span> and, as with Kali, select <span class="strong"><strong>I copied it</strong></span>. The username and password for the virtual machine itself are <span class="emphasis"><em>georgia:password</em></span>.</p><p>Once you have the Ubuntu virtual machine loaded, make sure the network interface is set to Bridged in VMware and click the networking icon (two computers) at the top right of the screen to attach the virtual machine to the network. Do not install any updates if prompted. As with Windows XP, we will exploit out-of-date software on this system. Now this virtual machine is all set up. (I’ll show you how to set a static IP address in Linux in <a class="xref" href="ch02.xhtml" title="Chapter 2. Using Kali Linux">Chapter 2</a>.)</p></div><div class="sect1" title="Creating the Windows 7 Target"><div class="titlepage"><div><div><h2 class="title" id="creating_the_windows_7_target" style="clear: both">Creating the Windows 7 Target</h2></div></div></div><p>As with Windows XP, you’ll need to install a copy of Windows 7 SP1 in VMware by loading your image or DVD. A 30-day trial version of 32-bit Windows 7 Professional SP1 will work fine, but you’ll need to activate it after 30 days if you wish to continue using it. To find a legal version of Windows 7 SP1, try one of the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Visit <span class="emphasis"><em><a class="ulink" href="http://www.softpedia.com/get/System/OS-Enhancements/Windows-7.shtml" target="_top">http://www.softpedia.com/get/System/OS-Enhancements/Windows-7.shtml</a></em></span>.</p></li><li class="listitem"><p>Visit <span class="emphasis"><em><a class="ulink" href="http://technet.microsoft.com/en-us/evalcenter/dn407368" target="_top">http://technet.microsoft.com/en-us/evalcenter/dn407368</a></em></span>.</p></li></ul></div><div class="note" title="Note"><h3 class="title"><a id="ch01note08"/>Note</h3><p>Your school or workplace may have access to programs like DreamSpark or BizSpark that give you access to Windows operating systems. You can also check my website (<span class="emphasis"><em><a class="ulink" href="http://www.bulbsecurity.com/" target="_top">http://www.bulbsecurity.com/</a></em></span>) for more resources.</p></div><div class="sect2" title="Creating a User Account"><div class="titlepage"><div><div><h3 class="title" id="creating_a_user_account">Creating a User Account</h3></div></div></div><p>After installing Windows 7 Professional SP1, opt out of security updates and create user <span class="emphasis"><em>Georgia Weidman</em></span> as an administrator with a password of <span class="emphasis"><em>password</em></span>, as shown in <a class="xref" href="ch01.xhtml#setting_a_username" title="Figure 1-49. Setting a username">Figure 1-49</a> and <a class="xref" href="ch01.xhtml#setting_a_password_for_the_user_georgia" title="Figure 1-50. Setting a password for the user Georgia Weidman">Figure 1-50</a>.</p><p>Again opt out of automatic updates. When prompted, set the computer’s current location to a work network. Once the installation has finished, log in to the account <span class="emphasis"><em>Georgia Weidman</em></span>. Leave the Windows Firewall enabled. VMware will reboot Windows 7 a few times as it installs everything.</p><p>Now tell VMware to install VMware Tools, as you did in the Windows XP section. After instructing VMware to install VMware Tools in the virtual machine, if the installer does not automatically run, go to My Computer and run the VMware Tools installer from the virtual machine’s DVD drive, as shown in <a class="xref" href="ch01.xhtml#installing_vmware_tools-id00007" title="Figure 1-51. Installing VMware Tools">Figure 1-51</a>.</p><div class="figure"><a id="setting_a_username"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00050"/><img alt="Setting a username" src="httpatomoreillycomsourcenostarchimages2030290.png.jpg"/></div></div><div class="figure-title">Figure 1-49. Setting a username</div></div><div class="figure"><a id="setting_a_password_for_the_user_georgia"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00051"/><img alt="Setting a password for the user Georgia Weidman" src="httpatomoreillycomsourcenostarchimages2030292.png.jpg"/></div></div><div class="figure-title">Figure 1-50. Setting a password for the user Georgia Weidman</div></div><div class="figure"><a id="installing_vmware_tools-id00007"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00052"/><img alt="Installing VMware Tools" src="httpatomoreillycomsourcenostarchimages2030294.png.jpg"/></div></div><div class="figure-title">Figure 1-51. Installing VMware Tools</div></div></div><div class="sect2" title="Opting Out of Automatic Updates"><div class="titlepage"><div><div><h3 class="title" id="opting_out_of_automatic_updates">Opting Out of Automatic Updates</h3></div></div></div><p><a class="indexterm" id="iddle1903"/><a class="indexterm" id="iddle1085"/><a class="indexterm" id="iddle2398"/><a class="indexterm" id="iddle2478"/>Though our attacks on Windows 7 will largely rely on flaws in third-party software rather than missing Windows patches, let’s once again opt out of Windows updates for this virtual machine. To do this, go to <span class="strong"><strong>Start</strong></span> ▸ <span class="strong"><strong>Control Panel</strong></span> ▸ <span class="strong"><strong>System and Security</strong></span>. Then under Windows Update, click <span class="strong"><strong>Turn Automatic Updating On or Off</strong></span>. Set Important updates to <span class="strong"><strong>Never check for updates (not recommended)</strong></span> as shown in <a class="xref" href="ch01.xhtml#opting_out_of_automatic_updates-id00008" title="Figure 1-52. Opting out of automatic updates">Figure 1-52</a>. Click <span class="strong"><strong>OK</strong></span>.</p><div class="figure"><a id="opting_out_of_automatic_updates-id00008"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00053"/><img alt="Opting out of automatic updates" src="httpatomoreillycomsourcenostarchimages2030296.png.jpg"/></div></div><div class="figure-title">Figure 1-52. Opting out of automatic updates</div></div></div><div class="sect2" title="Setting a Static IP Address"><div class="titlepage"><div><div><h3 class="title" id="setting_a_static_ip_address-id00009">Setting a Static IP Address</h3></div></div></div><p><a class="indexterm" id="iddle2248"/><a class="indexterm" id="iddle2464"/>Set a static IP address by choosing <span class="strong"><strong>Start</strong></span> ▸ <span class="strong"><strong>Control Panel</strong></span> ▸ <span class="strong"><strong>Network and Internet</strong></span> ▸ <span class="strong"><strong>Network and Sharing Center</strong></span> ▸ <span class="strong"><strong>Change Adapter Settings</strong></span> ▸ <span class="strong"><strong>Local Area Network</strong></span>. Now right-click and choose <span class="strong"><strong>Properties</strong></span> ▸ <span class="strong"><strong>Internet Protocol Version 4 (TCP/IPv4)</strong></span> ▸ <span class="strong"><strong>Properties</strong></span>. Set these values as you did for Windows XP (discussed in <a class="xref" href="ch01.xhtml#setting_a_static_ip_address" title="Setting a Static IP Address">Setting a Static IP Address</a>), but use a different value for the Windows 7 IP address, as shown in <a class="xref" href="ch01.xhtml#setting_a_static_ip_address-id00010" title="Figure 1-53. Setting a static IP address">Figure 1-53</a>. If asked whether to configure this network as Home, Work, or Public, choose <span class="strong"><strong>Work</strong></span>. (Be sure that your virtual machine network setting is configured to use a bridged adapter.)</p><div class="figure"><a id="setting_a_static_ip_address-id00010"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00054"/><img alt="Setting a static IP address" src="httpatomoreillycomsourcenostarchimages2030298.png.jpg"/></div></div><div class="figure-title">Figure 1-53. Setting a static IP address</div></div><p>Because the Windows firewall is turned on, Windows 7 won’t respond to a ping from our Kali system. Therefore, we’ll ping our Kali system from Windows 7. Start your Kali Linux virtual machine, and from your Windows 7 virtual machine, click the <span class="strong"><strong>Start</strong></span> button. Then enter <span class="strong"><strong><code class="literal">cmd</code></strong></span> in the Run dialog to open a Windows command prompt. At the prompt, enter the following.</p><a id="pro_id00016"/><pre class="programlisting"><span class="strong"><strong>ping &lt;</strong></span><span class="bolditalic">IP Address of Kali</span><span class="strong"><strong>&gt;</strong></span></pre><p>If everything is working, you should see replies to the ping request as in <a class="xref" href="ch01.xhtml#setting_a_static_ip_address" title="Setting a Static IP Address">Setting a Static IP Address</a>.</p></div><div class="sect2" title="Adding a Second Network Interface"><div class="titlepage"><div><div><h3 class="title" id="adding_a_second_network_interface">Adding a Second Network Interface</h3></div></div></div><p><a class="indexterm" id="iddle1531"/><a class="indexterm" id="iddle1532"/><a class="indexterm" id="iddle1535"/><a class="indexterm" id="iddle1545"/><a class="indexterm" id="iddle1573"/><a class="indexterm" id="iddle1724"/><a class="indexterm" id="iddle1756"/><a class="indexterm" id="iddle1829"/><a class="indexterm" id="iddle2460"/><a class="indexterm" id="iddle2473"/><a class="indexterm" id="iddle2477"/>Now shut down your Windows 7 virtual machine. We’re going to add a second network interface to the Windows 7 virtual machine that will allow the Windows 7 system to be part of two networks. We’ll use this setup during post exploitation to simulate attacking additional systems on a second network.</p><p>In VMware Player on Microsoft Windows, choose <span class="strong"><strong>Player</strong></span> ▸ <span class="strong"><strong>Manage</strong></span> ▸ <span class="strong"><strong>Virtual Machine Settings</strong></span> ▸ <span class="strong"><strong>Add</strong></span>, select <span class="strong"><strong>Network Adapter</strong></span>, and press <span class="strong"><strong>Next</strong></span>. This adapter will be Network Adapter 2. In VMware Fusion on Mac OS, go to <span class="strong"><strong>Virtual Machine Settings</strong></span>, select <span class="strong"><strong>Add a Device</strong></span>, and select a network adapter. Set this new adapter to the Host Only network. Press <span class="strong"><strong>OK</strong></span>, and the virtual machine should restart. (We do not need to set a static IP address for Network Adapter 2.) When the virtual machine restarts, open Virtual Machine Settings again, and you should see the two network adapters listed. Both should be connected when your computer powers on.</p></div><div class="sect2" title="Installing Additional Software"><div class="titlepage"><div><div><h3 class="title" id="installing_additional_software-id00011">Installing Additional Software</h3></div></div></div><p>Now install the following software in your Windows 7 virtual machine, using default settings across the board:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Java 7 Update 6, an out-of-date version of Java, from <span class="emphasis"><em><a class="ulink" href="http://www.oldapps.com/java.php?old_java=8120/" target="_top">http://www.oldapps.com/java.php?old_java=8120/</a>.</em></span></p></li><li class="listitem"><p>Winamp version 5.55 from <span class="emphasis"><em><a class="ulink" href="http://www.oldapps.com/winamp.php?old_winamp=247/" target="_top">http://www.oldapps.com/winamp.php?old_winamp=247/</a>.</em></span> (Uncheck the changes to your search engine and so on.)</p></li><li class="listitem"><p>The latest version of Mozilla Firefox from <span class="emphasis"><em><a class="ulink" href="http://www.mozilla.org/" target="_top">http://www.mozilla.org/</a>.</em></span></p></li><li class="listitem"><p>Microsoft Security Essentials from <span class="emphasis"><em><a class="ulink" href="http://windows.microsoft.com/en-us/windows/security-essentials-download/" target="_top">http://windows.microsoft.com/en-us/windows/security-essentials-download/</a></em></span>. (Download the latest antivirus signatures, making sure to download the correct version for your 32-bit Windows install. Don’t turn on automatic sample submission or scan on install. Also, disable real-time protection for now. We will enable this feature when we study bypassing antivirus software in <a class="xref" href="ch12.xhtml" title="Chapter 12. Bypassing Antivirus Applications">Chapter 12</a>. This setting can be found on the Settings tab under Real-time Protection. Uncheck <span class="strong"><strong>Turn on real-time protection (recommended)</strong></span>, as shown in <a class="xref" href="ch01.xhtml#turning_off_real-time_protection" title="Figure 1-54. Turning off real-time protection">Figure 1-54</a>. Click <span class="strong"><strong>Save changes</strong></span>.)</p></li></ul></div><div class="figure"><a id="turning_off_real-time_protection"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00055"/><img alt="Turning off real-time protection" src="httpatomoreillycomsourcenostarchimages2030300.png.jpg"/></div></div><div class="figure-title">Figure 1-54. Turning off real-time protection</div></div><p><a class="indexterm" id="iddle1116"/><a class="indexterm" id="iddle2480"/>Finally, install the <span class="emphasis"><em>BookApp</em></span> custom web application found in the torrent for this book. (<span class="emphasis"><em>1stPentestBook?!</em></span> is the password for the archive.) Drag and drop the <span class="emphasis"><em>BookApp</em></span> folder on the Windows 7 virtual machine. Then follow the instructions in <span class="emphasis"><em>InstallApp.pdf</em></span> detailing how to install BookApp. Here is a high-level overview of the instructions.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Run <span class="emphasis"><em>Step1-install-iis.bat</em></span> as an administrator by right-clicking the <span class="emphasis"><em>.bat</em></span> file and choosing <span class="strong"><strong>Run as administrator</strong></span>. (Once install finishes, you can close any DOS windows that are still up.)</p></li><li class="listitem"><p>Navigate to the <span class="emphasis"><em>SQL</em></span> folder and run <span class="emphasis"><em>SQLEXPRWT_x86_ENU.EXE</em></span>. Detailed instructions with screenshots are included in the InstallApp PDF.</p></li><li class="listitem"><p>Install Service Pack 3 by running <span class="emphasis"><em>SQLServer2008SP3-KB2546951-x86-ENU.exe</em></span>. When warned that program has known compatibility issues, click <span class="strong"><strong>OK</strong></span> to run it and complete the install. Choose to accept any changes.</p></li><li class="listitem"><p>Using SQL Server Configuration Manager, enable <span class="strong"><strong>Named Pipes</strong></span>.</p></li><li class="listitem"><p>Navigate back to the main app folder and run <span class="emphasis"><em>Step2-Modify-FW.bat</em></span> as an administrator.</p></li><li class="listitem"><p>Install XML support for MS SQL with <span class="emphasis"><em>sqlxml_x86-v4.exe</em></span> from the SQL folder.</p></li><li class="listitem"><p>Run <span class="emphasis"><em>Step3-Install-App.bat</em></span> as an administrator from the main app folder.</p></li><li class="listitem"><p>Use MS SQL Management Studio to run <span class="emphasis"><em>db.sql</em></span> from the SQL folder, as described in detail in the InstallApp PDF.</p></li><li class="listitem"><p>Finally, change the user permissions on the <span class="emphasis"><em>AuthInfo.xml</em></span> file in the book app folder to give full permissions to IIS_USERS.</p></li></ol></div></div></div><div class="sect1" title="Summary"><div class="titlepage"><div><div><h2 class="title" id="summary-id00012" style="clear: both">Summary</h2></div></div></div><p>We set up our virtual environment, downloaded and customized Kali Linux for attacks, configured our virtual network, and configured our target operating systems—Windows XP, Windows 7, and Ubuntu.</p><p>In the next chapter, we will get used to working with the Linux command line, and we’ll be on our way to learning how to use the many pentesting tools and techniques in this book.</p></div></section></body></html>