<html><head></head><body>
<div id="book-content">
<div id="sbo-rt-content"><section>
<header>
<h1 class="chapter">
<span class="ChapterNumber"><span epub:type="pagebreak" title="237" id="Page_237"/><a class="XrefDestination" id="15"/><span class="XrefDestination" id="xref-503007c15-001"/>15</span><br/>
<span class="ChapterTitle"><a class="XrefDestination" id="CallingMySQLfromProgrammingLanguages"/><span class="XrefDestination" id="xref-503007c15-002"/>Calling MySQL from Programming Languages</span></h1>
</header>
<figure class="opener">
<img src="image_fi/book_art/chapterart.png" alt="" width="200" height="200"/>
</figure>
<p class="ChapterIntro">In this chapter, you’ll write computer programs that use MySQL, focusing on three open source programming languages: PHP, Python, and Java. You’ll write programs in each language to select from a table, insert a row into a table, and call a stored procedure.</p>
<p>Regardless of the programming language, you follow the same general steps to call MySQL. First, you establish a connection to the MySQL database using your MySQL database credentials, including the hostname of the MySQL server, the database, user ID, and password. Then, you use that connection to run your SQL statements against the database.</p>
<p>You embed SQL statements in your program and when the program is run, the SQL is executed against the database. If you need to send parameter values to a SQL statement, you use a <em>prepared statement</em>, a reusable SQL <span epub:type="pagebreak" title="238" id="Page_238"/>statement that uses placeholders to temporarily represent the parameters. Then you bind parameter values to the prepared statement, replacing the placeholders with actual values.</p>
<p>If you’re retrieving data from the database, you iterate through the results and perform some action, like displaying the results. When you’re done, you close the connection to MySQL.</p>
<p>Let’s look at some examples using PHP, Python, and Java.</p>
<h2 id="h1-503007c15-0001"><a class="XrefDestination" id="PHP"/><span class="XrefDestination" id="xref-503007c15-003"/>PHP</h2>
<p class="BodyFirst">PHP (a recursive acronym for PHP: Hypertext Preprocessor) is an open source programming language used mostly for web development. Millions of websites have been built with PHP.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">Note</span></h2>
<p>	Instructions for installing PHP are available at <a href="https://www.php.net/manual/en/install.php" class="LinkURL">https://www.php.net/manual/en/install.php</a>.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>PHP is commonly used with MySQL. Both are part of the <em>LAMP stack</em>, a popular software development architecture consisting of Linux, Apache, MySQL, and PHP. (The <em>P</em> can also refer to the Python programming language and, less frequently, to Perl.) Many sites use Linux as the operating system; Apache as the web server to receive requests and send back responses; MySQL as the relational database management system; and PHP as the programming language.</p>
<p>To use MySQL from within PHP, you need a PHP <em>extension</em>, which enables you to use functionality in your PHP program that isn’t included in the core language. Since not all PHP applications need to access MySQL, this functionality is provided as an extension you can load. There are two choices for extensions: <em>PHP Data Objects (PDO)</em> and <em>MySQLi</em>. You’ll specify which you want to load by listing them in your <em>php.ini</em> configuration file, like so:</p>
<pre><code>extension=pdo_mysql
extension=mysqli</code></pre>
<p>The PDO and MySQLi extensions provide different ways to create database connections and execute SQL statements from within your PHP programs. These are object-oriented extensions. (MySQLi is also available as a procedural extension; you’ll learn what this means in the section <span class="xref" itemid="xref_target_“ProceduralMySQLi”">“Procedural MySQLi”</span> later in the chapter.)<em> Object-oriented programming (OOP)</em> relies on objects that contain data and can execute code in the form of methods. A <em>method</em> is the equivalent of a function in procedural programming; it is a set of instructions you can call to take some action, like running a query or executing a stored procedure.</p>
<p>To use PHP’s object-oriented MySQL extensions, you’ll create a new <code>PDO</code> or <code>MySQLi</code> object in your PHP code and use the <code>-&gt;</code> symbol to call the object’s methods.</p>
<p>Let’s take a look at each of these extensions, starting with PDO.</p>
<h3 id="h2-503007c15-0001"><span epub:type="pagebreak" title="239" id="Page_239"/><a class="XrefDestination" id="PDO"/><span class="XrefDestination" id="xref-503007c15-004"/>PDO</h3>
<p class="BodyFirst">The PDO extension can be used with many relational database management systems, including MySQL, Oracle, Microsoft SQL Server, and PostgreSQL.</p>
<h4 id="h3-503007c15-0001"><a class="XrefDestination" id="SelectingfromaTable"/><span class="XrefDestination" id="xref-503007c15-005"/>Selecting from a Table</h4>
<p class="BodyFirst">In <a href="#listing15-1" id="listinganchor15-1">Listing 15-1</a>, you write a PHP program called <em>display_mountains_pdo.php</em> that uses PDO to select from a MySQL table called <code>mountain</code> in the <code>topography</code> database.</p>
<pre><code>&lt;?php

<span class="CodeAnnotationHang" aria-label="annotation1">❶</span> $conn = new PDO(
    'mysql:host=localhost;dbname=topography',
    'top_app',
    'pQ3fgR5u5'
);

<span class="CodeAnnotationHang" aria-label="annotation2">❷</span> $sql = 'select mountain_name, location, height from mountain';

<span class="CodeAnnotationHang" aria-label="annotation3">❸</span> $stmt = $conn-&gt;query($sql);

while ($row = $stmt-&gt;fetch(<span class="CodeAnnotation" aria-label="annotation4">❹</span> PDO::FETCH_ASSOC)) {
  <span class="CodeAnnotationCode" aria-label="annotation5">❺</span> echo(
        $row['mountain_name'] . ' | ' .
        $row['location'] . ' | ' .
        $row['height'] . '&lt;br /&gt;'
    );
}
$conn = <span class="CodeAnnotationCode" aria-label="annotation6">❻</span> null;
?&gt;</code></pre>
<p class="CodeListingCaption"><a id="listing15-1">Listing 15-1</a>: Using PDO to display data from the <code>mountain</code> table (<em>display_mountains_pdo.php</em>)</p>
<p>The program begins with the opening tag <code>&lt;?php</code> and ends with the closing tag <code>?&gt;</code>. The tags tell the web server to interpret the code between them as PHP.</p>
<p>To use MySQL from within PHP, you need to create a connection to your MySQL database by creating a new <code>PDO</code> object <span class="CodeAnnotation" aria-label="annotation1">❶</span> and passing in your database credentials. In this case, your hostname is <code>localhost</code>, your database name is <code>topography</code>, the database user ID is <code>top_app</code>, and the password for your MySQL database is <code>pQ3fgR5u5</code>.</p>
<p>You can also specify the port by adding it to the end of the line with your host and database name, like so:</p>
<pre><code>    'mysql:host=localhost;dbname=topography;port=3306',</code></pre>
<p>If you don’t provide a port, it defaults to <code>3306</code>, which is the port normally used to connect to a MySQL server. If your MySQL server instance was configured to run on another port, ask your database administrator to check the configuration files for the port number.</p>
<p><span epub:type="pagebreak" title="240" id="Page_240"/>You save the connection as a variable named <code>$conn</code>. PHP variables are preceded by a dollar sign. This variable now represents the connection between your PHP program and your MySQL database.</p>
<p>Next, you create a PHP variable called <code>$sql</code> that holds your SQL statement <span class="CodeAnnotation" aria-label="annotation2">❷</span>.</p>
<p>You call PDO’s <code>query()</code> method and send it the SQL statement you want to run. In object-oriented programming, the <code>-&gt;</code> symbol is often used to call an object’s instance methods, like <code>$conn-&gt;query()</code>. You save the statement and its results as an array variable called <code>$stmt</code> <span class="CodeAnnotation" aria-label="annotation3">❸</span>.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">Note</span></h2>
<p>	In contrast to the <code>-&gt;</code> symbol used to access an object’s <em>instance</em> methods and variables, the double-colon syntax (<code>::</code>) is used to access an object’s <em>static</em> members, like any constant variables. It is known as the <em>scope resolution</em> operator (also sometimes called <em>paamayim nekudotayim</em>, which is Hebrew for “double colon”).</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>An <em>array</em> is a type of variable you can use to store a group of values. It uses an <em>index</em> to identify one value in the group. You use PDO’s <code>fetch()</code> method to fetch each row from <code>$stmt</code> using a <em>mode</em>, which controls how the data gets returned to you. Here, the mode <code>PDO::FETCH_ASSOC</code> <span class="CodeAnnotation" aria-label="annotation4">❹</span> returns an array that is indexed by the database table’s column names, like <code>$row['mountain_name']</code>, <code>$row['location']</code>, and <code>$row['height']</code>. If you had used the mode <code>PDO::FETCH_NUM</code>, it would have returned an array that is indexed by the column number starting at zero, like <code>$row[0]</code>, <code>$row[1]</code>, and <code>$row[2]</code>. Other modes can be found in PHP’s online manual at <a href="https://php.net" class="LinkURL">https://php.net</a>.</p>
<p>Next, the <code>while</code> loop will loop through each row that was fetched. You use the <code>echo()</code> command <span class="CodeAnnotation" aria-label="annotation5">❺</span> to display each column separated by the pipe (<code>|</code>) character. The <code>&lt;br /&gt;</code> HTML tag at the end of your <code>echo()</code> statement will create a line break after each line in your browser.</p>
<p>Finally, you close the connection by setting it to <code>null</code> <span class="CodeAnnotation" aria-label="annotation6">❻</span>.</p>
<p>Navigate to <a href="http://localhost/display_mountains_pdo.php%20" class="LinkURL">http://localhost/display_mountains_pdo.php </a>to see the results of your PHP program, shown in <a href="#figure15-1" id="figureanchor15-1">Figure 15-1</a>.</p>
<figure>
<img src="image_fi/503007c15/f15001.png" class="keyline" alt="" width="597" height="170"/>
<figcaption><p><a id="figure15-1">Figure 15-1</a>: The results of <em>display_mountains_pdo.php</em></p></figcaption>
</figure>
<p>You’ve successfully accessed MySQL via PDO to select data from the <code>mountain</code> table and return each column separated by the pipe character.</p>
<h4 id="h3-503007c15-0002"><a class="XrefDestination" id="InsertingaRowintoaTable"/><span class="XrefDestination" id="xref-503007c15-006"/>Inserting a Row into a Table</h4>
<p class="BodyFirst">Now you’ll create a new PHP program called <em>add_mountain_pdo.php</em> that inserts a new row in the <code>mountain</code> table using PDO.</p>
<p><span epub:type="pagebreak" title="241" id="Page_241"/>In <a href="#listing15-2" id="listinganchor15-2">Listing 15-2</a>, you’ll use a prepared statement, which, as mentioned earlier, uses placeholders to represent values in a SQL statement. Then, you’ll replace those placeholders with actual values from PHP variables. Using prepared statements is a good security practice because it helps protect against SQL injection attacks, which are a common way for hackers to run malicious SQL code against your database.</p>
<pre><code>&lt;?php

<span class="CodeAnnotationHang" aria-label="annotation1">❶</span> $conn = new PDO(
    'mysql:host=localhost;dbname=topography',
    'top_app',
    'pQ3fgR5u5'
);

$new_mountain = 'K2';
$new_location = 'Asia';
$new_height = 28252;

$stmt = $conn-&gt;<span class="CodeAnnotation" aria-label="annotation2">❷</span>prepare(
    'insert into mountain (mountain_name, location, height)
     values (<span class="CodeAnnotation" aria-label="annotation3">❸</span>:mountain, :location, :height)'
);

<span class="CodeAnnotationHang" aria-label="annotation4">❹</span> $stmt-&gt;bindParam(':mountain', $new_mountain, PDO::PARAM_STR);
$stmt-&gt;bindParam(':location', $new_location, PDO::PARAM_STR);
$stmt-&gt;bindParam(':height',   $new_height,   PDO::PARAM_INT);

$stmt-&gt;<span class="CodeAnnotation" aria-label="annotation5">❺</span>execute();

$conn = null;
?&gt;</code></pre>
<p class="CodeListingCaption"><a id="listing15-2">Listing 15-2</a>: Using PDO to insert a row into the <code>mountain</code> table (<em>add_mountain_pdo.php</em>)</p>
<p>As in <a href="#listing15-1">Listing 15-1</a>, you first create a connection to your MySQL database <span class="CodeAnnotation" aria-label="annotation1">❶</span>. You have three PHP variables called <code>$new_mountain</code>, <code>$new_location</code>, and <code>$new_height</code> that hold the name, location, and height of the mountain, respectively, that you want to insert into your <code>mountain</code> table.</p>
<p>You use the connection’s <code>prepare()</code> method <span class="CodeAnnotation" aria-label="annotation2">❷</span> to create a prepared statement that uses named placeholders for your values. You write the <code>insert</code> SQL statement, but instead of including the actual values you want to insert, you use placeholders <span class="CodeAnnotation" aria-label="annotation3">❸</span>. Your named placeholders are <code>:mountain</code>, <code>:location</code>, and <code>:height</code>. Named placeholders are preceded by a colon.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">Note</span></h2>
<p>	PDO also allows you to use question marks instead of named placeholders, like so:</p>
<pre><code>$stmt = $conn-&gt;prepare(
    'insert into mountain (mountain_name, location, height)
     values (?, ?, ?)'
);</code></pre>
<p class="Continued">I recommend using named placeholders instead of question marks, however, because they make your code more readable.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p><span epub:type="pagebreak" title="242" id="Page_242"/>Next, you replace the placeholders with actual values using the <code>bindParam()</code> method <span class="CodeAnnotation" aria-label="annotation4">❹</span>, which links, or binds, a placeholder with a variable. You bind the first placeholder to the <code>$new_mountain</code> variable, which replaces <code>:mountain</code> with the value <code>K2</code>. You bind the second placeholder to the <code>$new_location</code> variable, replacing <code>:location</code> with the value <code>Asia</code>. You bind the third placeholder to the <code>$new_height</code> variable, replacing <code>:height</code> with the value <code>28252</code>.</p>
<p>Then, you specify the type of data the variables represent. The mountain and location are strings, so you use <code>PDO::PARAM_STR</code>. The height is an integer, so you use <code>PDO::PARAM_INT</code>.</p>
<p>When you call the statement’s <code>execute()</code> method <span class="CodeAnnotation" aria-label="annotation5">❺</span>, your statement is executed and your new row gets inserted into the <code>mountain</code> table.</p>
<h4 id="h3-503007c15-0003"><a class="XrefDestination" id="CallingaStoredProcedure"/><span class="XrefDestination" id="xref-503007c15-007"/>Calling a Stored Procedure</h4>
<p class="BodyFirst">Next, you’ll write a PHP program named <em>find_mountains_by_loc_pdo.php </em>that calls a MySQL stored procedure, <code>p_get_mountain_by_loc()</code>.</p>
<p>You’ll provide the stored procedure with a parameter for the location you want to search for; in this example, you’ll search for mountains in <code>Asia</code>. Your PHP program will call the stored procedure and return the number of mountains in the <code>mountain</code> table that are in Asia (see <a href="#listing15-3" id="listinganchor15-3">Listing 15-3</a>).</p>
<pre><code>&lt;?php

$conn = new PDO(
    'mysql:host=localhost;dbname=topography',
    'top_app',
    'pQ3fgR5u5'
);

$location = 'Asia';

$stmt = $conn-&gt;prepare('<span class="CodeAnnotation" aria-label="annotation1">❶</span>call p_get_mountain_by_loc(<span class="CodeAnnotation" aria-label="annotation2">❷</span>:location)');
$stmt-&gt;<span class="CodeAnnotation" aria-label="annotation3">❸</span>bindParam(':location', $location, PDO::PARAM_STR);

$stmt-&gt;<span class="CodeAnnotation" aria-label="annotation4">❹</span>execute();

<span class="CodeAnnotationHang" aria-label="annotation5">❺</span> while ($row = $stmt-&gt;fetch(PDO::FETCH_ASSOC)) {
    echo(
        $row['mountain_name'] . ' | ' .
        $row['height'] . '&lt;br /&gt;'
    );
}
$conn = null;
?&gt;</code></pre>
<p class="CodeListingCaption"><a id="listing15-3">Listing 15-3</a>: Using PDO to call a stored MySQL procedure (<em>find_mountains_by_loc_pdo.php</em>)</p>
<p>You use the <code>call</code> statement <span class="CodeAnnotation" aria-label="annotation1">❶</span> in your prepared statement to call the stored procedure. Then you create a named placeholder, <code>:location</code> <span class="CodeAnnotation" aria-label="annotation2">❷</span>, and use <code>bindParam</code> <span class="CodeAnnotation" aria-label="annotation3">❸</span> to replace <code>:location</code> with the value in the <code>$location</code> variable, which evaluates to <code>Asia</code>.</p>
<p><span epub:type="pagebreak" title="243" id="Page_243"/>Next, you execute the stored procedure <span class="CodeAnnotation" aria-label="annotation4">❹</span>. Then you use a <code>while</code> statement <span class="CodeAnnotation" aria-label="annotation5">❺</span> to select the rows returned from the stored procedure. You display them to the user using the <code>echo</code> command. Finally, you end the connection. The results are shown in <a href="#figure15-2" id="figureanchor15-2">Figure 15-2</a>.</p>
<figure>
<img src="image_fi/503007c15/f15002.png" class="keyline" alt="" width="597" height="125"/>
<figcaption><p><a id="figure15-2">Figure 15-2</a>: The results of <em>find_mountains_by_loc_pdo.php</em></p></figcaption>
</figure>
<p>You can add more functionality to these programs. For example, you might choose to allow the user to select the location they want to see, rather than hardcoding <code>Asia</code> in the PHP program. You could even check for errors connecting to the database or calling your stored procedure, and display detailed error messages to the user when there is a problem.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2><a class="XrefDestination" id="hardcodingcredentials"/><span class="XrefDestination" id="xref-503007c15-008"/>hardcoding credentials</h2>
<p class="BoxBodyFirst">Regardless of the programming language you use, you shouldn’t hardcode database credentials.</p>
<p>While it’s fine to use code that includes your host, database name, user ID, and password for demonstration purposes,</p>
<pre><code>$conn = new PDO(
    'mysql:host=localhost;dbname=topography',
    'top_app',
    'pQ3fgR5u5'
);</code></pre>
<p class="BoxBodyContinued">in a real application, you wouldn’t display such sensitive information in plaintext. Instead, the database connection information is often stored and loaded from a configuration file that has its file permissions set to control who can access the information.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h3 id="h2-503007c15-0002"><a class="XrefDestination" id="Object-OrientedMySQLi"/><span class="XrefDestination" id="xref-503007c15-009"/>Object-Oriented MySQLi</h3>
<p class="BodyFirst">The MySQL Improved (MySQLi) extension is the upgraded version of an old legacy PHP extension that was called MySQL. In this section, you’ll learn how to use the object-oriented version of MySQLi.</p>
<h4 id="h3-503007c15-0004"><a class="XrefDestination" id="SelectingfromaTable2"/><span class="XrefDestination" id="xref-503007c15-010"/>Selecting from a Table</h4>
<p class="BodyFirst">In <a href="#listing15-4" id="listinganchor15-4">Listing 15-4</a>, you write a PHP program using the object-oriented MySQLi to select from your <code>mountain</code> table.</p>
<pre><code><span epub:type="pagebreak" title="244" id="Page_244"/>&lt;?php

$conn = <span class="CodeAnnotationCode" aria-label="annotation1">❶</span> new mysqli(
          'localhost',
          'top_app',
          'pQ3fgR5u5',
          'topography'
);

$sql = 'select mountain_name, location, height from mountain';

$result = $conn-&gt;<span class="CodeAnnotation" aria-label="annotation2">❷</span>query($sql);

while ($row = <span class="CodeAnnotationCode" aria-label="annotation3">❸</span> $result-&gt;fetch_assoc()) {
  echo(
    $row['mountain_name'] . ' | ' .
    $row['location'] . ' | ' .
    $row['height'] . '&lt;br /&gt;'
  );
}
<span class="CodeAnnotationHang" aria-label="annotation4">❹</span> $conn-&gt;close();
?&gt;</code></pre>
<p class="CodeListingCaption"><a id="listing15-4">Listing 15-4</a>: Using object-oriented MySQLi to display data from the <code>mountain</code> table (<em>display_mountains_mysqli_oo.php</em>)</p>
<p>You establish a connection to MySQL by creating a <code>mysqli</code> object <span class="CodeAnnotation" aria-label="annotation1">❶</span> and passing in the host, user ID, password, and database. You run your query using the connection’s <code>query()</code> method <span class="CodeAnnotation" aria-label="annotation2">❷</span> and save the results to a PHP variable called <code>$result</code>.</p>
<p>You iterate through the resulting rows, calling the <code>$result</code> <code>fetch_assoc()</code> method <span class="CodeAnnotation" aria-label="annotation3">❸</span> so that you can reference the columns as indexes, like <code>$row['mountain_name']</code>. Then you print the values of those columns and close your connection with the <code>close()</code> method <span class="CodeAnnotation" aria-label="annotation4">❹</span>.</p>
<p>The result is displayed in <a href="#figure15-3" id="figureanchor15-3">Figure 15-3</a>.</p>
<figure>
<img src="image_fi/503007c15/f15003.png" class="keyline" alt="" width="597" height="184"/>
<figcaption><p><a id="figure15-3">Figure 15-3</a>: The results of <em>display_mountains_mysqli_oo.php</em></p></figcaption>
</figure>
<h4 id="h3-503007c15-0005"><a class="XrefDestination" id="InsertingaRowintoaTable2"/><span class="XrefDestination" id="xref-503007c15-011"/>Inserting a Row into a Table</h4>
<p class="BodyFirst">Now, you’ll create a PHP program to insert a row into the <code>mountain</code> table using object-oriented MySQLi (see <a href="#listing15-5" id="listinganchor15-5">Listing 15-5</a>).</p>
<pre><code><span epub:type="pagebreak" title="245" id="Page_245"/>&lt;?php

$conn = new mysqli(
          'localhost',
          'top_app',
          'pQ3fgR5u5',
          'topography'
);

$new_mountain = 'Makalu';
$new_location = 'Asia';
$new_height = 27766;

<span class="CodeAnnotationHang" aria-label="annotation1">❶</span> $stmt = $conn-&gt;prepare(
    'insert into mountain (mountain_name, location, height)
     values (<b>?, ?, ?</b>)'
);

<span class="CodeAnnotationHang" aria-label="annotation2">❷</span> $stmt-&gt;bind_param(<b>'ssi'</b>,$new_mountain,$new_location,$new_height);
$stmt-&gt;execute();
$conn-&gt;close();
?&gt;</code></pre>
<p class="CodeListingCaption"><a id="listing15-5">Listing 15-5</a>: Using object-oriented MySQLi to insert a row into the <code>mountain</code> table (<em>add_mountain_mysqli_oo.php</em>)</p>
<p>Once you’ve established your connection, you use a prepared statement with question marks as your placeholders <span class="CodeAnnotation" aria-label="annotation1">❶</span>. Then, you replace your question mark placeholders with values using the <code>bind_param()</code> method <span class="CodeAnnotation" aria-label="annotation2">❷</span>.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	While PDO allows you to use named placeholders, MySQLi requires you to use question marks as placeholders.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>With MySQLi, you can provide the data types of the bind variables as a string. The first parameter you send to <code>bind_param()</code> is the value <code>ssi</code>, which indicates that you want to replace the first and second placeholders with a string (<code>s</code>) value, and the third placeholder with an integer (<code>i</code>) value. You can also choose <code>d</code> if the bind variable has a data type of <code>double</code> (a double-precision floating-point number) or <code>b</code> if the bind variable has a data type of <code>blob</code> (a binary large object).</p>
<p>Finally, you execute the prepared statement with <code>execute()</code> and close your connection. When you run the program, it inserts a new mountain—<code>Makalu</code>—into your <code>mountain</code> table.</p>
<h4 id="h3-503007c15-0006"><a class="XrefDestination" id="CallingaStoredProcedure2"/><span class="XrefDestination" id="xref-503007c15-012"/>Calling a Stored Procedure</h4>
<p class="BodyFirst"><a href="#listing15-6" id="listinganchor15-6">Listing 15-6</a> shows a PHP program that uses object-oriented MySQLi to execute a stored procedure.</p>
<pre><code>&lt;?php

$conn = new mysqli(
          'localhost',
<span epub:type="pagebreak" title="246" id="Page_246"/>          'top_app',
          'pQ3fgR5u5',
          'topography'
);

$location = 'Asia';

$stmt = $conn-&gt;prepare('call p_get_mountain_by_loc(?)');
<span class="CodeAnnotationHang" aria-label="annotation1">❶</span> $stmt-&gt;bind_param(<b>'s'</b>, $location);
$stmt-&gt;execute();

$result = $stmt-&gt;get_result();

while ($row = $result-&gt;fetch_assoc()) {
  echo(
    $row['mountain_name'] . ' | ' .
    $row['height'] . '&lt;br /&gt;'
  );
}

$conn-&gt;close();
?&gt;</code></pre>
<p class="CodeListingCaption"><a id="listing15-6">Listing 15-6</a>: Using object-oriented MySQLi to call a stored MySQL procedure (<em>find_mountains_by_loc_mysqli_oo.php</em>)</p>
<p>You use a prepared statement that calls the <code>p_get_mountain_by_loc()</code> stored procedure. It has one question mark placeholder that represents the location of the mountains you want to search for. You bind the location, replacing the <code>?</code> with <code>Asia</code>. You send <code>s</code> as the first parameter to the <code>bind_param()</code> method to indicate that the location is a string <span class="CodeAnnotation" aria-label="annotation1">❶</span>.</p>
<p>Once you execute the statement and loop through your results, the name and height of the Asian mountains in your table are displayed.</p>
<p>The results are shown in <a href="#figure15-4" id="figureanchor15-4">Figure 15-4</a>.</p>
<figure>
<img src="image_fi/503007c15/f15004.png" class="keyline" alt="" width="597" height="148"/>
<figcaption><p><a id="figure15-4">Figure 15-4</a>: The results of <em>find_mountains_by_loc_mysqli_oo.php</em></p></figcaption>
</figure>
<h3 id="h2-503007c15-0003"><a class="XrefDestination" id="ProceduralMySQLi"/><span class="XrefDestination" id="xref-503007c15-013"/>Procedural MySQLi</h3>
<p class="BodyFirst">MySQLi is also available as a procedural extension. The procedural version of MySQLi looks similar to the object-oriented version, but instead of using <code>-&gt;</code> syntax to call methods, like <code>$conn-&gt;close()</code>, you’ll use functions that start with the text <code>mysqli_</code>, like <code>mysqli_connect()</code>, <code>mysqli_query()</code>, and <code>mysqli_close()</code>.</p>
<p><em>Procedural programming</em> treats data and procedures as two different entities. It uses a top-down approach where you write code giving instructions <span epub:type="pagebreak" title="247" id="Page_247"/>in order from beginning to end, and call procedures—or functions—that contain code to handle specific tasks.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2><a class="XrefDestination" id="ShouldIUseMySQLiorPDO?"/><span class="XrefDestination" id="xref-503007c15-014"/>Should I Use MySQLi or PDO?</h2>
<p class="BoxBodyFirst">When working with an existing PHP application, continue using the extension that’s already being used in the codebase. But which extension should you use if you’re creating a new system?</p>
<p>If you want to migrate your application from MySQL to another database system like Oracle, PostgreSQL, or Microsoft SQL Server, PDO is a good choice. MySQLi works only with MySQL, whereas PDO also works with other database systems, which makes migrating your application to another database system easier. If you support different PHP applications that use different database systems, you can learn to use PDO with MySQL and use the same approach for those other systems as well.</p>
<p>PDO also allows you to use named placeholders instead of question marks, making your code a bit clearer.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h4 id="h3-503007c15-0007"><a class="XrefDestination" id="SelectingfromaTable3"/><span class="XrefDestination" id="xref-503007c15-015"/>Selecting from a Table</h4>
<p class="BodyFirst">In <a href="#listing15-7" id="listinganchor15-7">Listing 15-7</a>, you write a PHP program to select from your <code>mountain</code> table using the procedural version of MySQLi.</p>
<pre><code>&lt;?php

$conn = mysqli_connect(
          'localhost',
          'top_app',
          'pQ3fgR5u5',
          'topography'
);

$sql = 'select mountain_name, location, height from mountain';

$result = mysqli_query($conn, $sql);

while ($row = mysqli_fetch_assoc($result)) {
  echo(
    $row['mountain_name'] . ' | ' .
    $row['location'] . ' | ' .
    $row['height'] . '&lt;br /&gt;'
  );
}
mysqli_close($conn);
?&gt;</code></pre>
<p class="CodeListingCaption"><a id="listing15-7">Listing 15-7</a>: Using procedural MySQLi to display data from the <code>mountain</code> table (<em>display_mountains_mysqli_procedural.php</em>)</p>
<p><span epub:type="pagebreak" title="248" id="Page_248"/>You use MySQLi’s <code>mysqli_connect()</code> function to connect to the database with your database credentials. You define a variable called <code>$sql</code> that holds your SQL statement. Next, you use MySQLi’s <code>mysqli_query()</code> function to run the query using your connection, and save the results to the <code>$result</code> variable.</p>
<p>Then, you fetch the results using the <code>mysql_fetch_assoc()</code> function so you can reference the resulting <code>$row</code> variables using indexes matching the database column names, like <code>$row['mountain_name']</code>.</p>
<p>You print the results using the <code>echo</code> command and add a pipe (<code>|</code>) delimiter between the values. The HTML <code>&lt;br /&gt;</code> tag will add a line break after each row in your browser.</p>
<p>Finally, you close the connection using the <code>mysqli_close()</code> function.</p>
<p>The results are displayed in <a href="#figure15-5" id="figureanchor15-5">Figure 15-5</a>.</p>
<figure>
<img src="image_fi/503007c15/f15005.png" class="keyline" alt="" width="597" height="187"/>
<figcaption><p><a id="figure15-5">Figure 15-5</a>: The results of <em>display_mountains_mysqli_procedural.php</em></p></figcaption>
</figure>
<h4 id="h3-503007c15-0008"><a class="XrefDestination" id="InsertingaRowintoaTable3"/><span class="XrefDestination" id="xref-503007c15-016"/>Inserting a Row into a Table</h4>
<p class="BodyFirst">Now, you’ll create a PHP program to insert a row into your <code>mountain</code> table using procedural MySQLi (<a href="#listing15-8" id="listinganchor15-8">Listing 15-8</a>).</p>
<pre><code>&lt;?php

$conn = mysqli_connect(
          'localhost',
          'top_app',
          'pQ3fgR5u5',
          'topography'
);

$new_mountain = 'Lhotse';
$new_location = 'Asia';
$new_height = 27940;

$stmt = mysqli_prepare(
    $conn,
    'insert into mountain (mountain_name, location, height)
     values (?, ?, ?)'
);

mysqli_stmt_bind_param(
    $stmt,
    'ssi',
    $new_mountain,
<span epub:type="pagebreak" title="249" id="Page_249"/>    $new_location,
    $new_height
);

mysqli_stmt_execute($stmt);
mysqli_close($conn);
?&gt;</code></pre>
<p class="CodeListingCaption"><a id="listing15-8">Listing 15-8</a>: Using procedural MySQLi to insert a row into the <code>mountain</code> table (<em>add_mountain_mysqli_procedural.php</em>)</p>
<p>The program inserts a new mountain called <code>Lhotse</code> into your <code>mountain</code> table. The program’s logic is similar to the programs you’ve seen before: you create a connection using your database credentials, use a prepared statement with <code>?</code> placeholders, bind values to replace the placeholders, execute the statement, and close the connection.</p>
<h4 id="h3-503007c15-0009"><a class="XrefDestination" id="CallingaStoredProcedure3"/><span class="XrefDestination" id="xref-503007c15-017"/>Calling a Stored Procedure</h4>
<p class="BodyFirst">The PHP code to execute a stored procedure using procedural MySQLi is shown in <a href="#listing15-9" id="listinganchor15-9">Listing 15-9</a>.</p>
<pre><code>&lt;?php

$conn = mysqli_connect(
          'localhost',
          'top_app',
          'pQ3fgR5u5',
          'topography'
);

$location = 'Asia';

$stmt = mysqli_prepare($conn, 'call p_get_mountain_by_loc(?)');
mysqli_stmt_bind_param($stmt, 's', $location);
mysqli_stmt_execute($stmt);
$result = mysqli_stmt_get_result($stmt);

while ($row = mysqli_fetch_assoc($result)) {
  echo(
    $row['mountain_name'] . ' | ' .
    $row['height'] . '&lt;br /&gt;'
  );
}
mysqli_close($conn);
?&gt;</code></pre>
<p class="CodeListingCaption"><a id="listing15-9">Listing 15-9</a>: Using procedural MySQLi to call a stored MySQL procedure (<em>find_mountains_by_loc_mysqli_procedural.php</em>)</p>
<p>You use a prepared statement to call the procedure and a question mark placeholder to represent the stored procedure’s parameter. You bind the <code>$location</code> PHP variable and specify <code>s</code> (string) as the data type. Then, you execute the statement and fetch and iterate through the resulting rows, <span epub:type="pagebreak" title="250" id="Page_250"/>printing the mountain name and height for each row in your <code>mountain</code> table that is in Asia. Finally, you close your connection.</p>
<p>The results are shown in <a href="#figure15-6" id="figureanchor15-6">Figure 15-6</a>.</p>
<figure>
<img src="image_fi/503007c15/f15006.png" class="keyline" alt="" width="597" height="142"/>
<figcaption><p><a id="figure15-6">Figure 15-6</a>: The results of <em>find_mountains_by_loc_mysqli_procedural.php</em></p></figcaption>
</figure>
<h2 id="h1-503007c15-0002"><a class="XrefDestination" id="Python"/><span class="XrefDestination" id="xref-503007c15-018"/>Python</h2>
<p class="BodyFirst">Python is an open source programming language with concise and readable syntax. It’s worthwhile to learn Python because it can be used for many different types of programming—from data science and math to video games, web development, and even artificial intelligence!</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">Note</span></h2>
<p>	Instructions for installing Python can be found at Python.org at <a href="https://wiki.python.org/moin/BeginnersGuide/Download/" class="LinkURL">https://wiki.python.org/moin/BeginnersGuide/Download/</a>.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>Python’s syntax is unique in that it places a lot of importance on indentation. Other languages use curly brackets to group a block of code, as in this PHP code:</p>
<pre><code>if ($temp &gt; 70) <b>{</b>
    echo "It's hot in here. Turning down the temperature.";
    $new_temp = $temp - 2;
    setTemp($new_temp);
<b>}</b></code></pre>
<p>Because your block of PHP code starts with <code>{</code> and ends with <code>}</code>, the indentation of the lines of code within the block doesn’t matter; it’s just for readability. The following code runs just as well in PHP:</p>
<pre><code>if ($temp &gt; 70) {
    echo "It's hot in here. Turning down the temperature.";
$new_temp = $temp - 2;
setTemp($new_temp);
}</code></pre>
<p>Python, on the other hand, doesn’t use curly brackets to identify blocks of code. It relies on indentation:</p>
<pre><code>if temp &gt; 70:
    print("It's hot in here. Turning down the temperature.");
    new_temp = temp - 2
    set_temp(new_temp)</code></pre>
<p><span epub:type="pagebreak" title="251" id="Page_251"/>If the temperature is over 70 degrees, this example will print <code>It's hot in here</code> and will turn down the temperature 2 degrees.</p>
<p>But if you change the indentation in Python, the program does something different:</p>
<pre><code>if temp &gt; 70:
    print("It's hot in here. Turning down the temperature.")
new_temp = temp - 2
set_temp(new_temp)</code></pre>
<p>The message <code>It's hot in here</code> will still print only when the temperature is more than 70, but now the temperature will be turned down 2 degrees regardless. That’s probably not what you intended.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">Note</span></h2>
<p>	To access MySQL from your Python code, you can use <em>MySQL Connector/Python</em>, a driver that allows Python to communicate with MySQL.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h3 id="h2-503007c15-0004"><a class="XrefDestination" id="SelectingfromaTable4"/><span class="XrefDestination" id="xref-503007c15-019"/>Selecting from a Table</h3>
<p class="BodyFirst">In <a href="#listing15-10" id="listinganchor15-10">Listing 15-10</a>, you write a Python program called <em>display_mountains.py</em> to select from the <code>mountain</code> table and display the results.</p>
<pre><code>import mysql.connector

<span class="CodeAnnotationHang" aria-label="annotation1">❶</span> conn = mysql.connector.connect(
    user='top_app',
    password='pQ3fgR5u5',
    host='localhost',
    database='topography')
	
<span class="CodeAnnotationHang" aria-label="annotation2">❷</span> cursor = conn.cursor()

cursor.execute('select mountain_name, location, height from mountain')

<span class="CodeAnnotationHang" aria-label="annotation3">❸</span> for (mountain, location, height) in cursor:
    print(mountain, location, height)

conn.close()</code></pre>
<p class="CodeListingCaption"><a id="listing15-10">Listing 15-10</a>: Using Python to display data from the <code>mountain</code> table (<em>display_mountains.py</em>)</p>
<p>In the first line of your code, you import MySQL Connector/Python with <code>mysql.connector</code>. Then you create a connection to your MySQL database <span class="CodeAnnotation" aria-label="annotation1">❶</span> by calling the <code>connect()</code> method with your database credentials. You save this connection as a Python variable called <code>conn</code>.</p>
<p>You use the connection to create a cursor that you save as a variable called <code>cursor</code> <span class="CodeAnnotation" aria-label="annotation2">❷</span>. Next, you use the <code>cursor</code> <code>execute()</code> method to run a SQL query that selects from the <code>mountain</code> table. A <code>for</code> loop is one type of loop that allows you to loop, or iterate, through values. Here, you use a <code>for</code> loop <span class="CodeAnnotation" aria-label="annotation3">❸</span> to iterate through the rows in the cursor, printing the mountain name, location, and height of each mountain as you go. The looping will continue until there are no more rows to loop through in <code>cursor</code>.</p>
<p><span epub:type="pagebreak" title="252" id="Page_252"/>Lastly, you close the connection with <code>conn.close()</code>.</p>
<p>You can navigate to your operating system’s command prompt and run the Python program to see the results:</p>
<pre><code>&gt; <b>python display_mountains.py</b>
Mount Everest Asia 29029
Aconcagua South America 22841
Denali North America 20310
Mount Kilimanjaro Africa 19341
K2 Asia 28252
Makalu Asia 27766
Lhotse Asia 27940</code></pre>
<p>Your Python program selected all the rows from your <code>mountain</code> table and displayed the data from the table.</p>
<p>While your database credentials are included in your Python program in this example, you’d typically put sensitive information in a Python file called <em>config.py</em> to separate them from the rest of your code.</p>
<h3 id="h2-503007c15-0005"><a class="XrefDestination" id="InsertingaRowintoaTable4"/><span class="XrefDestination" id="xref-503007c15-020"/>Inserting a Row into a Table</h3>
<p class="BodyFirst">Now, you’ll write a Python program called <em>add_mountain.py</em> to insert a row into the <code>mountain</code> table (<a href="#listing15-11" id="listinganchor15-11">Listing 15-11</a>).</p>
<pre><code>import mysql.connector

conn = mysql.connector.connect(
    user='top_app',
    password='pQ3fgR5u5',
    host='localhost',
    database='topography')
	
cursor = conn.cursor(prepared=True)
<span class="CodeAnnotationHang" aria-label="annotation1">❶</span> sql = "insert into mountain(mountain_name, location, height) values (?,?,?)"
<span class="CodeAnnotationHang" aria-label="annotation2">❷</span> val = ("Ojos Del Salado", "South America", 22615)
cursor.execute(sql, val)
<span class="CodeAnnotationHang" aria-label="annotation3">❸</span> conn.commit()
cursor.close()</code></pre>
<p class="CodeListingCaption"><a id="listing15-11">Listing 15-11</a>: Using Python to insert a row into the <code>mountain</code> table (<em>add_mountain.py</em>)</p>
<p>Using your connection, you create a <code>cursor</code> that allows you to use prepared statements.</p>
<p>You create a Python variable called <code>sql</code> that contains the <code>insert</code> statement <span class="CodeAnnotation" aria-label="annotation1">❶</span>. Python can use either <code>?</code> or <code>%s</code> for placeholders in prepared statements. (The letter <em>s</em> has nothing to do with the data type or values here; that is, the placeholder <code>%s</code> isn’t just for strings.)</p>
<p>You create a variable called <code>val</code> <span class="CodeAnnotation" aria-label="annotation2">❷</span> that contains the values you want to insert into the table. Then you call the <code>cursor</code> <code>execute()</code> method, passing in your <code>sql</code> and <code>val</code> variables. The <code>execute()</code> method binds the variables, replacing the <code>?</code> placeholders with the values, and executes the SQL statement.</p>
<p><span epub:type="pagebreak" title="253" id="Page_253"/>You need to commit the statement to the database by calling the <code>connection</code> <code>commit()</code> method <span class="CodeAnnotation" aria-label="annotation3">❸</span>. By default, MySQL Connector/Python doesn’t automatically commit, so if you forget to call <code>commit()</code>, the changes won’t be applied to your database.</p>
<h3 id="h2-503007c15-0006"><a class="XrefDestination" id="CallingaStoredProcedure4"/><span class="XrefDestination" id="xref-503007c15-021"/>Calling a Stored Procedure</h3>
<p class="BodyFirst"><a href="#listing15-12" id="listinganchor15-12">Listing 15-12</a> shows a Python program called <em>find_mountains_by_loc.py</em> that calls the <code>p_get_mountain_by_loc()</code> stored procedure and sends a parameter value of <code>Asia</code> to display only the mountains in the table that are in Asia.</p>
<pre><code>import mysql.connector

conn = mysql.connector.connect(
    user='top_app',
    password='pQ3fgR5u5',
    host='localhost',
    database='topography')

cursor = conn.cursor()

<span class="CodeAnnotationHang" aria-label="annotation1">❶</span> cursor.callproc('p_get_mountain_by_loc', ['Asia'])

<span class="CodeAnnotationHang" aria-label="annotation2">❷</span> for results in cursor.stored_results():
    for record in results:
        print(record[0], record[1])

conn.close()</code></pre>
<p class="CodeListingCaption"><a id="listing15-12">Listing 15-12</a>: Using Python to call a stored procedure (<em>find_mountains_by_loc.py</em>)</p>
<p>You call the <code>cursor</code> <code>callproc()</code> method to call your stored procedure, sending it a value of <code>Asia</code> <span class="CodeAnnotation" aria-label="annotation1">❶</span>. Then, you call the <code>cursor</code> <code>stored_results()</code> method to get the results of the stored procedure, and you iterate through those results using a <code>for</code> loop to get the record for each mountain <span class="CodeAnnotation" aria-label="annotation2">❷</span>.</p>
<p>Python uses zero-based indexes, so <code>record[0]</code> represents the first column that was returned from the stored procedure for the row—in this example, the mountain name. To print the second column, the mountain’s height, you use <code>record[1]</code>.</p>
<p>Run the Python program from the command line to see the results:</p>
<pre><code>&gt; <b>python find_mountains_by_loc.py</b>
Mount Everest 29029
K2 28252
Makalu 27766
Lhotse 27940</code></pre>
<h2 id="h1-503007c15-0003"><a class="XrefDestination" id="Java"/><span class="XrefDestination" id="xref-503007c15-022"/>Java</h2>
<p class="BodyFirst">Java is an open source, object-oriented programming language that is commonly used for everything from mobile app development to desktop applications to web apps.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<span epub:type="pagebreak" title="254" id="Page_254"/><h2><span class="NoteHead">Note</span></h2>
<p>	Instructions for installing Java are available on Java.com at <a href="https://www.java.com/en/download/help/download_options.html" class="LinkURL">https://www.java.com/en/download/help/download_options.html</a>.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>There are lots of build tools and integrated development environments (IDEs) for Java, but for these examples, you’ll work from the command line. Let’s go over the basics before we start looking at examples.</p>
<p>You’ll create a Java program that ends in the file extension <em>.java</em>. To run a Java program, you first compile it to a <em>.class</em> file using the <code>javac</code> command. This file is in bytecode format. <em>Bytecode</em> is a machine-level format that runs in the Java Virtual Machine (JVM). Once a program is compiled, you run it using the <code>java</code> command.</p>
<p>Here you create a Java program called <em>MountainList.java</em> and compile it to bytecode:</p>
<pre><code>javac MountainList.java</code></pre>
<p>That command creates a bytecode file called <em>MountainList.class</em>. To run it, you use this command:</p>
<pre><code>java MountainList</code></pre>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">Note</span></h2>
<p><em>	MySQL Connector/J</em> is a Java Database Connectivity (JDBC) driver, which lets you communicate between Java and MySQL. You can use MySQL Connector/J to connect to MySQL databases, run SQL statements, and process the results. You can also use it to run stored procedures from within Java.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h3 id="h2-503007c15-0007"><a class="XrefDestination" id="SelectingfromaTable5"/><span class="XrefDestination" id="xref-503007c15-023"/>Selecting from a Table</h3>
<p class="BodyFirst">As with the other programming languages, you’ll start by writing a Java program called <em>MountainList.java</em> that selects a list of mountains from your MySQL <code>mountain</code> table (<a href="#listing15-13" id="listinganchor15-13">Listing 15-13</a>).</p>
<pre><code>import java.sql.*; <span class="CodeAnnotationCode" aria-label="annotation1">❶</span>

public class MountainList {
public static void main(String args[]) { <span class="CodeAnnotationCode" aria-label="annotation2">❷</span> 
    String url = "jdbc:mysql://localhost/topography";
    String username = "top_app";
    String password = "pQ3fgR5u5";

    try { <span class="CodeAnnotationCode" aria-label="annotation3">❸</span>
      Class.forName("com.mysql.cj.jdbc.Driver"); <span class="CodeAnnotationCode" aria-label="annotation4">❹</span>
      Connection <span class="CodeAnnotationCode" aria-label="annotation5">❺</span> conn = DriverManager.getConnection(url, username, password);
      Statement stmt = conn.createStatement(); <span class="CodeAnnotationCode" aria-label="annotation6">❻</span>
      String sql = "select mountain_name, location, height from mountain";
      ResultSet rs = stmt.executeQuery(sql); <span class="CodeAnnotationCode" aria-label="annotation7">❼</span>
      while (rs.next()) {
        System.out.println(
          rs.getString("mountain_name") + " | " +
          rs.getString("location") + " | " +
          rs.getInt("height");
<span epub:type="pagebreak" title="255" id="Page_255"/>        );
      }
      conn.close();
    } catch (Exception ex) {
      System.out.println(ex);
    }
  }
}</code></pre>
<p class="CodeListingCaption"><a id="listing15-13">Listing 15-13</a>: Using Java to display data from the <code>mountain</code> table (<em>MountainList.java</em>)</p>
<p>First, you import the <code>java.sql</code> package <span class="CodeAnnotation" aria-label="annotation1">❶</span> to give you access to Java objects for using a MySQL database, like <code>Connection</code>, <code>Statement</code>, and <code>ResultSet</code>.</p>
<p>You create a Java class called <code>MountainList</code> that has a <code>main()</code> method, which is automatically executed when you run the program <span class="CodeAnnotation" aria-label="annotation2">❷</span>. In the <code>main()</code> method, you create a connection to your MySQL database by providing your database credentials. You save this connection as a Java variable called <code>conn</code> <span class="CodeAnnotation" aria-label="annotation5">❺</span>.</p>
<p>You load the Java class for MySQL Connector/J, <code>com.mysql.cj.jdbc.Driver</code>, using the <code>Class.forName</code> command <span class="CodeAnnotation" aria-label="annotation4">❹</span>.</p>
<p>Using the <code>Connection</code> <code>createStatement()</code> method, you create a <code>Statement</code> <span class="CodeAnnotation" aria-label="annotation6">❻</span> to execute SQL against the database. The <code>Statement</code> returns a <code>ResultSet</code> <span class="CodeAnnotation" aria-label="annotation7">❼</span>, which you loop through to display the name, location, and height of each mountain in the database table. You close the connection when you’re done.</p>
<p>Notice that many of these Java commands are wrapped in a <code>try</code> block <span class="CodeAnnotation" aria-label="annotation3">❸</span>. This way, if there are problems running these commands, Java will throw an <em>exception</em> (or error) that you can catch in your corresponding <code>catch</code> statement. In this case, when an exception is thrown, control is passed to the <code>catch</code> block and you display the exception to the user.</p>
<p>In Python and PHP, wrapping your code in a <code>try...catch</code> block is best practice, but optional. (The syntax in Python is <code>try/except</code>.) But in Java, you <em>must</em> use a <code>try...catch</code> block. If you try to compile the Java code without it, you’ll get an error saying that exceptions <code>must be caught or declared to be thrown</code>.</p>
<p>Compile and run your Java program from the command line, and see the results:</p>
<pre><code>&gt; <b>javac MountainList.java</b>
&gt; <b>java MountainList</b>
Mount Everest | Asia | 29029
Aconcagua | South America | 22841
Denali | North America | 20310
Mount Kilimanjaro | Africa | 19341
K2 | Asia | 28252
Makalu | Asia | 27766
Lhotse | Asia | 27940
Ojos Del Salado | South America | 22615</code></pre>
<h3 id="h2-503007c15-0008"><a class="XrefDestination" id="InsertingaRowintoaTable5"/><span class="XrefDestination" id="xref-503007c15-024"/>Inserting a Row into a Table</h3>
<p class="BodyFirst">In <a href="#listing15-14" id="listinganchor15-14">Listing 15-14</a>, you’ll write a Java program to insert a row into the <code>mountain</code> table.</p>
<pre><code><span epub:type="pagebreak" title="256" id="Page_256"/>import java.sql.*;

public class MountainNew {
  public static void main(String args[]) {
    String url = "jdbc:mysql://localhost/topography";
    String username = "top_app";
    String password = "pQ3fgR5u5";

    try {
      Class.forName("com.mysql.cj.jdbc.Driver");
      Connection conn = DriverManager.getConnection(url, username, password);
      String sql = "insert into mountain(mountain_name, location, height) " +
                    "values (?,?,?)";
    <span class="CodeAnnotationCode" aria-label="annotation1">❶</span> PreparedStatement stmt = conn.prepareStatement(sql);
      stmt.setString(1, "Kangchenjunga");
      stmt.setString(2, "Asia");
      stmt.setInt(3, 28169);
    <span class="CodeAnnotationCode" aria-label="annotation2">❷</span> stmt.executeUpdate();
      conn.close();
    } catch (Exception ex) {
      System.out.println(ex);
    }
  }
}</code></pre>
<p class="CodeListingCaption"><a id="listing15-14">Listing 15-14</a>: Using Java to insert a row into the <code>mountain</code> table (<em>MountainNew.java</em>)</p>
<p>Your SQL statement uses question marks as placeholders. You use a <code>PreparedStatement</code> this time <span class="CodeAnnotation" aria-label="annotation1">❶</span> instead of a <code>Statement</code> so that you can send parameter values. You bind the parameter values using the <code>setString()</code> and <code>setInt()</code> methods. Then you call the <code>executeUpdate()</code> method <span class="CodeAnnotation" aria-label="annotation2">❷</span>, which is used to insert, update, or delete rows in your MySQL table.</p>
<h3 id="h2-503007c15-0009"><a class="XrefDestination" id="CallingaStoredProcedure5"/><span class="XrefDestination" id="xref-503007c15-025"/>Calling a Stored Procedure</h3>
<p class="BodyFirst"><a href="#listing15-15" id="listinganchor15-15">Listing 15-15</a> shows a Java program to execute a MySQL stored procedure.</p>
<pre><code>import java.sql.*;

public class MountainAsia {
  public static void main(String args[]) {
    String url = "jdbc:mysql://localhost/topography";
    String username = "top_app";
    String password = "pQ3fgR5u5";

    try {
      Class.forName("com.mysql.cj.jdbc.Driver");
      Connection conn = DriverManager.getConnection(url, username, password);
      String sql = "call p_get_mountain_by_loc(?)";
    <span class="CodeAnnotationCode" aria-label="annotation1">❶</span> CallableStatement stmt = conn.prepareCall(sql);
      stmt.setString(1, "Asia");
      ResultSet rs = stmt.executeQuery();
<span epub:type="pagebreak" title="257" id="Page_257"/>      while (rs.next()) {
        System.out.println(
          rs.getString("mountain_name") + " | " +
          rs.getInt("height")
        );
      }
      conn.close();
    } catch (Exception ex) {
      System.out.println(ex);
    }
  }
}</code></pre>
<p class="CodeListingCaption"><a id="listing15-15">Listing 15-15</a>: Using Java to call a MySQL stored procedure (<em>MountainAsia.java</em>)</p>
<p>This time, you use a <code>CallableStatement</code> <span class="CodeAnnotation" aria-label="annotation1">❶</span> instead of <code>Statement</code> to call stored procedures. You set the first (and only) parameter to <code>Asia</code> and execute your query using <code>CallableStatement</code>’s <code>executeQuery()</code> method. Then you iterate through the results, displaying each mountain name and height.</p>
<p>The results are:</p>
<pre><code>Mount Everest | 29029
K2 | 28252
Makalu | 27766
Lhotse | 27940
Kangchenjunga | 28169</code></pre>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2><a class="XrefDestination" id="Object-RelationalMapping"/><span class="XrefDestination" id="xref-503007c15-026"/>Object-Relational Mapping</h2>
<p class="BoxBodyFirst"><em>Object-relational mapping (ORM)</em> tools take a different approach to using MySQL from within programming languages like the ones you’ve seen in this chapter. ORM allows you to interact with your database using your favorite object-oriented programming language instead of using SQL. ORM makes the data in the database available to you in the form of objects that you can manipulate in your code.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-503007c15-0004"><a class="XrefDestination" id="Summary"/><span class="XrefDestination" id="xref-503007c15-027"/>Summary</h2>
<p class="BodyFirst">In this chapter, you looked at calling MySQL from programming languages. You learned that SQL statements are often embedded and run from within programs. You saw that the same database table that can be accessed from MySQL Workbench can also be accessed using PHP, Python, Java, or any number of other tools or languages.</p>
<p>In the next chapter, you’ll work on your first project using MySQL: creating a functioning weather database. You’ll build scripts to accept a weather feed hourly and load it into your MySQL database.</p>
</section>
</div>
</div>
</body></html>