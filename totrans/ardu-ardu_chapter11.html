<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" lang="en" xml:lang="en">
<head>
<title>Arduino for Arduinians</title>
<meta content="text/html; charset=utf-8" http-equiv="default-style"/>
<link href="../styles/stylesheet.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:67118b6d-3178-4c1c-99a1-6e412fe74179" name="Adept.expected.resource"/>
</head>
<body epub:type="bodymatter">
<section aria-labelledby="ch11" epub:type="chapter" role="doc-chapter">
<header>
<h1 class="CHAPTER" id="ch11">
<span class="CN"><span aria-label=" Page 159. " epub:type="pagebreak" id="pg_159" role="doc-pagebreak"/><samp class="SANS_Futura_Std_Bold_Condensed_B_11">11</samp></span>
<span class="CT"><samp class="SANS_Dogma_OT_Bold_B_11">EMULATING USB MICE AND KEYBOARDS WITH THE LEONARDO</samp></span>
</h1>
</header>
<figure class="opener"><img alt="" class="opener" src="../images/opener-img.png"/>
</figure>
<p class="INTRO">This chapter shows you how to convert information gathered by the Arduino into keypresses or mouse movements and then send them to a computer to simulate typing on a USB keyboard or to simulate manipulating an external mouse. To do so, you’ll use the Arduino Leonardo development board, which has a few subtle differences from the usual Uno or compatible board.</p>
<p class="TX">Along with a micro-USB connector and a complete surface-mount design for all the main components, the Leonardo uses Microchip Technology’s ATmega32U4 microcontroller. This microcontroller has built-in USB communication, so the board doesn’t need a USB interface chip, which allows the Leonardo to appear as a mouse or keyboard to a connected computer. You might use this keyboard emulation technique to build your own game controller, shortcut keyboard, rapid data capture and entry systems, input devices for the differently abled, and more.</p>
<p class="TX"><span aria-label=" Page 160. " epub:type="pagebreak" id="pg_160" role="doc-pagebreak"/>In this chapter, you’ll learn to:</p>
<ul class="ul">
<li class="BL">Emulate keypresses and typing on USB keyboards, as well as USB mouse movement and button control</li>
<li class="BL">Build a USB data logger that writes directly to a spreadsheet</li>
<li class="BL">Use a keypad to make a keyboard of shortcuts</li>
</ul>
<section aria-labelledby="sec1" epub:type="division">
<h2 class="H1" id="sec1"><span id="h1-74"/><samp class="SANS_Futura_Std_Bold_B_11">USB Keyboards</samp></h2>
<p class="TNI">To emulate a keyboard with the Leonardo (shown in <a href="chapter11.xhtml#fig11-1">Figure 11-1</a>), you don’t need any extra hardware apart from a USB cable long enough to reach between your board and the host PC. If you’re ordering a longer cable, don’t forget that you need a USB-A-to-micro-USB cable.</p>
<figure class="IMG"><img alt="A PHOTO OF AN ARDUINO LEONARDO BOARD" class="img5" id="fig11-1" src="../images/fig11-1.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 11-1: An Arduino Leonardo development board</samp></p></figcaption>
</figure>
<p class="TX">You can activate keyboard emulation by including the Arduino Keyboard library, using the following two lines:</p>

<pre><code>#include "Keyboard.h" // Entered at start of sketch
Keyboard.begin();     // Entered in void setup()
</code></pre>

<p class="TX">To have the Leonardo send keypresses to the computer to mimic a user typing on a USB keyboard, use the following functions:</p>

<pre><code>Keyboard.print()
Keyboard.println()
</code></pre>

<p class="TX">These functions operate in a similar manner to <samp class="SANS_TheSansMonoCd_W5Regular_11">Serial.print()</samp> and <samp class="SANS_TheSansMonoCd_W5Regular_11">Serial.println()</samp>: the former sends the text to be “typed out” as keypresses, and the latter sends the same out and adds a return (or pressing <small>RETURN</small> or <small>ENTER</small>) to a new line. Using these two functions, you can send out any text that can generally be sent via your usual USB keyboard.</p>
<p class="TX">To stop emulating a USB keyboard, use the following function:</p>

<pre><code><span aria-label=" Page 161. " epub:type="pagebreak" id="pg_161" role="doc-pagebreak"/>Keyboard.end() // Ends emulation
</code></pre>

<p class="BodyContinued">This function is necessary only when you expect a user to continue using the PC via the normal keyboard while the Leonardo is still connected.</p>
<p class="TX">Let’s try this. First, connect your Arduino Leonardo to your computer. If this is the first time you’ve used the Leonardo, your PC may take a few moments to automatically install the required USB drivers. Next, open the Arduino IDE and change the board type to Arduino Leonardo using the drop-down menu shown in <a href="chapter11.xhtml#fig11-2">Figure 11-2</a> (note that your COM: port may be different from the one in the figure).</p>
<figure class="IMG"><img alt="A SCREENSHOT OF AN ARDUINO IDE WITH THE LEONARDO BOARD TYPE SELECTED" class="img5" id="fig11-2" src="../images/fig11-2.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 11-2: Selecting the Leonardo in the IDE</samp></p></figcaption>
</figure>
<p class="TX">Always ensure that the board type is set to Leonardo when working with sketches that use the Keyboard library; otherwise, they will not compile if you’re testing for errors.</p>
<p class="TX">If you have other software open on your PC, close it or ensure its windows are not active while you’re experimenting with keyboard and mouse emulation. Otherwise, the “keypresses” being sent by the Leonardo may interfere with the other software. For example, before uploading the following sketch on my own machine, the only software I had open was the Arduino IDE and Notepad.</p>
<p class="TX">Now enter and upload the sketch for <a href="#LiT-11-1">Listing 11-1</a>; then immediately switch over to a simple text editor such as Notepad.</p>
<span id="LiT-11-1"/>

<pre><code>#include "Keyboard.h"
void setup()
{
    delay(5000);
    Keyboard.begin();
}

void loop()
{
  <span aria-label="annotation1" class="CodeAnnotationHang1">❶</span> Keyboard.print("Hello, ");
  <span aria-label="annotation2" class="CodeAnnotationHang1">❷</span> Keyboard.println("world. ");
    delay(1000);
}
</code></pre>

<p class="CodeListingCaption"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Listing 11-1: USB keyboard emulation</samp></p>
<p class="TX">Once uploaded, the Leonardo should type “Hello, world.” every second or so, as shown in <a href="chapter11.xhtml#fig11-3">Figure 11-3</a>.<span aria-label=" Page 162. " epub:type="pagebreak" id="pg_162" role="doc-pagebreak"/></p>
<figure class="IMG"><img alt="A SCREENSHOT OF AN EXAMPLE OUTPUT FROM LISTING 11-1" class="img5" id="fig11-3" src="../images/fig11-3.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 11-3: Example output from <a href="#LiT-11-1">Listing 11-1</a></samp></p></figcaption>
</figure>
<p class="TX">First, the sketch includes the Keyboard library. The five-second delay gives the user some time to get the PC ready for input from the Arduino. The Keyboard library is then initialized. The sketch then sends some text without a new line <span aria-label="annotation1" class="CodeAnnotationCode">❶</span> and then some more text along with a new line <span aria-label="annotation2" class="CodeAnnotationCode">❷</span>.</p>
<p class="TX">When you’ve finished using the Leonardo for any USB keyboard or mouse emulation project, upload a simple sketch such as the IDE example <i>blink</i> so that your Leonardo won’t try to take over the controls the next time you connect it to a PC. If you’re having trouble taking control of the computer when uploading a new sketch, you can use the <small>CTRL</small>-U keyboard shortcut to upload a sketch.</p>
<section aria-labelledby="sec2" epub:type="division">
<h3 class="H2" id="sec2"><span id="h2-16"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Emulating Keyboard Modifiers and Special Keys</samp></h3>
<p class="TNI">In addition to creating keypresses for letters, numbers, and symbols, you can emulate buttons such as cursor keys, <small>TAB</small>, function keys, and so on, using a few more functions.</p>
<p class="TX">To send a single button press (that is, to press the button and then release it), use</p>

<pre><code>Keyboard.write(<var>x</var>)
</code></pre>

<p class="BodyContinued">where <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">x</samp> is the ASCII code for the letter, number, or symbol key to press, or the code for special modifier keys, listed in <a href="chapter11.xhtml#tab11-1">Table 11-1</a>.</p>
<figure class="table">
<p class="TableTitle" id="tab11-1"><span aria-label=" Page 163. " epub:type="pagebreak" id="pg_163" role="doc-pagebreak"/><span class="Heavy"><samp class="SANS_Futura_Std_Heavy_B_11">Table 11-1:</samp></span> <samp class="SANS_Futura_Std_Book_11">Modifier Keys and Their Codes</samp></p>
<table class="table1">
<thead>
<tr>
<th class="table TCH" scope="col"><p class="TCH"><samp class="SANS_Futura_Std_Heavy_B_11">Modifier key</samp></p></th>
<th class="table TCH" scope="col"><p class="TCH"><samp class="SANS_Futura_Std_Heavy_B_11">Code</samp></p></th>
<th class="table TCH" scope="col"><p class="TCH"><samp class="SANS_Futura_Std_Heavy_B_11">Modifier key</samp></p></th>
<th class="table TCH" scope="col"><p class="TCH"><samp class="SANS_Futura_Std_Heavy_B_11">Code</samp></p></th>
</tr>
</thead>
<tbody>
<tr>
<td class="table TBF"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_LEFT_CTRL</samp></p></td>
<td class="table TBF"><p class="TB"><samp class="SANS_Futura_Std_Book_11">128</samp></p></td>
<td class="table TBF"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F1</samp></p></td>
<td class="table TBF"><p class="TB"><samp class="SANS_Futura_Std_Book_11">194</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_LEFT_SHIFT</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">129</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F2</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">195</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_LEFT_ALT</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">130</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F3</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">196</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_LEFT_GUI</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">131</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F4</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">197</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_RIGHT_CTRL</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">132</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F5</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">198</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_RIGHT_SHIFT</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">133</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F6</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">199</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_RIGHT_ALT</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">134</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F7</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">200</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_RIGHT_GUI</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">135</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F8</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">201</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_UP_ARROW</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">218</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F9</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">202</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_DOWN_ARROW</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">217</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F10</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">203</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_LEFT_ARROW</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">216</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F11</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">204</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_RIGHT_ARROW</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">215</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F12</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">205</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_BACKSPACE</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">178</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F13</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">240</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_TAB</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">179</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F14</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">241</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_RETURN</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">176</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F15</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">242</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_ESC</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">177</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F16</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">243</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_INSERT</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">209</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F17</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">244</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_DELETE</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">212</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F18</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">245</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_PAGE_UP</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">211</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F19</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">246</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_PAGE_DOWN</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">214</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F20</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">247</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_HOME</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">210</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F21</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">248</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_END</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">213</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F22</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">249</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_CAPS_LOCK</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">193</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F23</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">250</samp></p></td>
</tr>
<tr>
<td class="table TBL"><p class="TB"/></td>
<td class="table TBL"><p class="TB"/></td>
<td class="table TBL"><p class="TB"><samp class="SANS_Futura_Std_Book_11">KEY_F24</samp></p></td>
<td class="table TBL"><p class="TB"><samp class="SANS_Futura_Std_Book_11">251</samp></p></td>
</tr>
</tbody>
</table>
</figure>
<p class="TX">In addition to the modifiers listed in the table, you can review the complete list of ASCII codes including those for letters, numbers, and symbols, at <a href="https://www.asciitable.com/"><i>https://<wbr/>www<wbr/>.asciitable<wbr/>.com<wbr/>/</i></a>.</p>
<p class="TX">To simplify things, you can define the required codes to matching descriptions for the keys you want to emulate. For example, <small>CAPS LOCK</small> is 193, so add the following at the start of the sketch:</p>

<pre><code>#define CAPS_LOCK 193
</code></pre>

<p class="TX">To press <small>CAPS LOCK</small> using the Leonardo, you’d use the following function:</p>

<pre><code>Keyboard.write(CAPS_LOCK);
</code></pre>

<p class="TX"><span aria-label=" Page 164. " epub:type="pagebreak" id="pg_164" role="doc-pagebreak"/>To test this, you can use the sketch in <a href="#LiT-11-2">Listing 11-2</a>, which presses <small>CAPS LOCK</small> every second.</p>
<span id="LiT-11-2"/>

<pre><code>#define CAPS_LOCK 193
#include "Keyboard.h"
void setup()
{
    Keyboard.begin();
}

void loop()
{
  <span aria-label="annotation1" class="CodeAnnotationHang1">❶</span> Keyboard.write(CAPS_LOCK);
    delay(1000);
}
</code></pre>

<p class="CodeListingCaption"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Listing 11-2: Blinking</samp> <samp class="SANS_Futura_Std_Book_Oblique_I_11">CAPS LOCK</samp> <samp class="SANS_Futura_Std_Book_Oblique_I_11">every second</samp></p>
<p class="TX">This sketch tells the host PC that <small>CAPS LOCK</small> has been pressed <span aria-label="annotation1" class="CodeAnnotationCode">❶</span>, which will be reflected on a USB keyboard connected to the PC. (If, at this point, you are considering making some mischief on a friend’s computer, do so at your own risk!)</p>
</section>
<section aria-labelledby="sec3" epub:type="division">
<h3 class="H2" id="sec3"><span id="h2-17"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Pressing and Releasing One or More Keys</samp></h3>
<p class="TNI">You can also emulate pressing down a button on the keyboard and then releasing it after a set period. To do this, use</p>

<pre><code>Keyboard.press(<var>x</var>)
</code></pre>

<p class="BodyContinued">to hold down the button whose modifier or ASCII code is <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">x</samp>. Then, to release that button, use the following:</p>

<pre><code>Keyboard.release(<var>x</var>)
</code></pre>

<p class="TX">You can test this using <a href="#LiT-11-3">Listing 11-3</a>.</p>
<span id="LiT-11-3"/>

<pre><code>#include "Keyboard.h"
void setup()
{
Keyboard.begin();
}

void loop()
{
  <span aria-label="annotation1" class="CodeAnnotationHang1">❶</span> Keyboard.press(122); // Hold down the "z" key
    delay(1000);
  <span aria-label="annotation2" class="CodeAnnotationHang1">❷</span> Keyboard.release(122);
    Keyboard.println(); // Press ENTER for new line
    Delay(5000);
}
</code></pre>

<p class="CodeListingCaption"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Listing 11-3: Testing press and release</samp></p>
<p class="TX"><span aria-label=" Page 165. " epub:type="pagebreak" id="pg_165" role="doc-pagebreak"/>This sketch demonstrates pressing and holding down the Z key <span aria-label="annotation1" class="CodeAnnotationCode">❶</span>, waiting a moment, and then letting go of the key <span aria-label="annotation2" class="CodeAnnotationCode">❷</span>. <a href="chapter11.xhtml#fig11-4">Figure 11-4</a> shows the results of the sketch. As you can see, the first two lines of text printed to the screen are shorter than the last two lines, since there is a slight difference in keyboard response time depending on the operating speed of the host PC.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF AN EXAMPLE OUTPUT FROM LISTING 11-3" class="img4" id="fig11-4" src="../images/fig11-4.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 11-4: Example output from <a href="#LiT-11-3">Listing 11-3</a></samp></p></figcaption>
</figure>
<p class="TX">Finally, you can program your Leonardo to press several keys at once and then release them one at a time or all at once using multiple <samp class="SANS_TheSansMonoCd_W5Regular_11">Keyboard.press()</samp> functions. This allows you to emulate useful multiple-keypress shortcuts used by your PC’s operating system.</p>
<p class="TX">For example, you can sign out of a Windows PC by pressing <small>CTRL</small>-<small>ALT</small>-<small>DELETE</small> and then <small>ALT</small>-S. The following functions will press the left <small>CTRL</small>, left <small>ALT</small>, and <small>DELETE</small> buttons simultaneously:</p>

<pre><code>Keyboard.press(128); // CTRL
Keyboard.press(130); // ALT
Keyboard.press(212); // DEL
</code></pre>

<p class="TX">You can then release them all by using this:</p>

<pre><code>Keyboard.releaseAll(); // Let go of all buttons
</code></pre>

<p class="TX">You can also let go of individual buttons and keep others pressed by using <samp class="SANS_TheSansMonoCd_W5Regular_11">Keyboard.release(</samp><samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">x</samp><samp class="SANS_TheSansMonoCd_W5Regular_11">)</samp>, where <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">x</samp> is the requisite modifier or ASCII code.</p>
<p class="TX">You’ll put all this to work in the next project by logging data from the Leonardo directly to a PC.</p>
<p class="HeadProject"><span id="h1-75"/><samp class="SANS_Futura_Std_Heavy_B_21">Project #32: Logging Data with USB Keyboard Emulation</samp></p>
<p class="TNI">One exceptionally useful benefit of keyboard emulation is the ability to log data from a Leonardo directly to a PC. For this project, you’ll log temperature and air pressure data from the BMP180 sensor used in <span class="Xref"><a href="chapter10.xhtml">Chapter 10</a></span> directly into a spreadsheet. If you can dedicate a PC for data logging—for example, in a laboratory or your office—this is a rapid, inexpensive method of data capture.</p>
<p class="TX"><span aria-label=" Page 166. " epub:type="pagebreak" id="pg_166" role="doc-pagebreak"/>You’ll need the following parts for this project:</p>
<ul class="ul">
<li class="BL">An Arduino Leonardo or compatible board and USB cable</li>
<li class="BL">A BMP180 temperature and air pressure sensor board</li>
<li class="BL">A solderless breadboard</li>
<li class="BL">Various jumper wires</li>
</ul>
<p class="TX">Assemble the circuit as shown in <a href="chapter11.xhtml#fig11-5">Figure 11-5</a>.</p>
<figure class="IMG"><img alt="THE SCHEMATIC FOR PROJECT #32" class="img4" id="fig11-5" src="../images/fig11-5.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 11-5: The schematic for Project #32</samp></p></figcaption>
</figure>
<p class="TX">To get started, open your preferred spreadsheet, such as Microsoft Excel or Google Sheets. Switch back to the Arduino IDE and upload the Project #32 sketch. Then quickly switch back to the spreadsheet software, click the top-left cell, and wait. Ten seconds after you’ve reset the Leonardo, the date, time, temperature, and air pressure in pascals should be “typed” into the cells, as shown in <a href="chapter11.xhtml#fig11-6">Figure 11-6</a>.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF EXAMPLE OUTPUT DATA FOR PROJECT #32 IN AN EXCEL SPREADSHEET" class="img5" id="fig11-6" src="../images/fig11-6.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 11-6: Example output data for Project #32 in an Excel spreadsheet</samp></p></figcaption>
</figure>
<p class="TX">Once logging has started, you might disconnect the mouse and keyboard from the PC so others can’t interrupt the proceedings. Furthermore, by using a cloud-based tool such as Google Sheets, you can monitor and review the results in real time from any web-enabled device in the world, as shown in <a href="chapter11.xhtml#fig11-7">Figure 11-7</a>.<span aria-label=" Page 167. " epub:type="pagebreak" id="pg_167" role="doc-pagebreak"/></p>
<figure class="IMG"><img alt="A SCREENSHOT OF EXAMPLE OUTPUT DATA FOR PROJECT #32 IN GOOGLE WORKSPACE SHEETS" class="img5" id="fig11-7" src="../images/fig11-7.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 11-7: Example results in Google Sheets</samp></p></figcaption>
</figure>
<p class="TX">Let’s see how this works:</p>
<span id="pro-32"/>

<pre><code>// Project #32 - Data logging using USB keyboard emulation

#define Ctrl 128
#define Semicolon 59
#define Shift 129
#define Tab 179
#define Enter 176

<span aria-label="annotation1" class="CodeAnnotationHang">❶</span> #include "Keyboard.h"
#include "Wire.h"
#include "Adafruit_BMP085.h"
Adafruit_BMP085 bmp;

<span aria-label="annotation2" class="CodeAnnotationHang">❷</span> void spreadsheetDate()
{
    Keyboard.press(Ctrl);
    Keyboard.press(Semicolon);
    delay(100);
    Keyboard.releaseAll(); // Let go of all buttons
}

<span aria-label="annotation3" class="CodeAnnotationHang">❸</span> void spreadsheetTime()
{
    Keyboard.press(Ctrl);
    Keyboard.press(Shift);
    Keyboard.press(Semicolon);
    delay(100);
    Keyboard.releaseAll(); // Let go of all buttons
}

void pressTab()
{
    Keyboard.write(Tab);
}

<span aria-label=" Page 168. " epub:type="pagebreak" id="pg_168" role="doc-pagebreak"/>void pressEnter()
{
    Keyboard.write(Enter);
}

void setup()
{
    Keyboard.begin();
    bmp.begin();
  <span aria-label="annotation4" class="CodeAnnotationHang1">❹</span> delay(10000);
}

void loop()
{
    spreadsheetDate();
    pressTab();
    spreadsheetTime();
    pressTab();
    Keyboard.print(bmp.readTemperature());
    pressTab();
    Keyboard.print(bmp.readPressure());
    pressEnter();
    delay(5000);
}
</code></pre>

<p class="TX">The sketch first initializes the sensor and the Keyboard library <span aria-label="annotation1" class="CodeAnnotationCode">❶</span>. The custom function <span aria-label="annotation2" class="CodeAnnotationCode">❷</span> emulates pressing <small>CTRL</small>-+, a shortcut used in many spreadsheets to insert the date into the current cell. There is a small delay before releasing the keys. The next custom function <span aria-label="annotation3" class="CodeAnnotationCode">❸</span> emulates pressing <small>CTRL</small>-<small>SHIFT</small>-+, the shortcut to insert the time into the current cell. This is followed by functions that press <small>TAB</small> and <small>ENTER</small>, for the sake of convenience, to save you using the raw commands.</p>
<p class="TX">The keyboard controls are based on those for a Windows-based computer. If you’re using macOS or another operating system, you may need to change the required keys for moving the cursor around the screen or the shortcuts in the spreadsheet software.</p>
<p class="TX">The usual initialization takes place in <samp class="SANS_TheSansMonoCd_W5Regular_11">void setup()</samp>, plus a long delay <span aria-label="annotation4" class="CodeAnnotationCode">❹</span>, which gives the user enough time to navigate the cursor to the starting cell in the spreadsheet before the Leonardo starts typing. Finally, in <samp class="SANS_TheSansMonoCd_W5Regular_11">void loop()</samp>, the date, time, temperature, and air pressure are “typed” into the spreadsheet using the required combination of keys, followed by a delay before the next sample is logged.</p>
<p class="TX">Now that you have a solid understanding of keyboard emulation, let’s build another tool you can use on a regular basis: the shortcut keyboard.</p>
<p class="HeadProject"><span id="h1-76"/><samp class="SANS_Futura_Std_Heavy_B_21">Project #33: Building a USB Shortcut Keyboard</samp></p>
<p class="TNI">Those who work or play with a PC daily will, over time, need to type various things repeatedly, such as passwords, keyboard shortcuts, or commonly used lines of text. With an Arduino Leonardo and the 12-button keypad <span aria-label=" Page 169. " epub:type="pagebreak" id="pg_169" role="doc-pagebreak"/>described in <span class="Xref">Project #3 in <a href="chapter1.xhtml">Chapter 1</a></span>, you can build a handy shortcut keyboard with 12 different options.</p>
<p class="TX">For the purposes of demonstration, the project will have a variety of examples assigned to the keypad. However, apart from useful text, you can research shortcuts for your PC’s operating system or favorite software and then create your own. <a href="chapter11.xhtml#tab11-2">Table 11-2</a> lists a variety of keyboard and typing shortcuts.</p>
<figure class="table">
<p class="TableTitle" id="tab11-2"><span class="Heavy"><samp class="SANS_Futura_Std_Heavy_B_11">Table 11-2:</samp></span> <samp class="SANS_Futura_Std_Book_11">Example Shortcuts</samp></p>
<table class="table">
<thead>
<tr>
<th class="table TCH" scope="col"><p class="TCH"><samp class="SANS_Futura_Std_Heavy_B_11">Button</samp></p></th>
<th class="table TCH" scope="col"><p class="TCH"><samp class="SANS_Futura_Std_Heavy_B_11">Shortcut</samp></p></th>
<th class="table TCH" scope="col"><p class="TCH"><samp class="SANS_Futura_Std_Heavy_B_11">Required emulation presses</samp></p></th>
</tr>
</thead>
<tbody>
<tr>
<td class="table TBF"><p class="TB"><samp class="SANS_Futura_Std_Book_11">1</samp></p></td>
<td class="table TBF"><p class="TB"><samp class="SANS_Futura_Std_Book_11">Enter PIN 456700.</samp></p></td>
<td class="table TBF"><p class="TB"><samp class="SANS_Futura_Std_Book_11">456700</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">2</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">Lock the screen in Windows 11.</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">CTRL-ALT-DEL, then ENTER</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">3</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">Display Windows Task Manager.</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">CTRL-ESC-SHIFT</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">4</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">Print to default printer.</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">CTRL-P, then ENTER</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">5</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">Switch between apps.</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">ALT-TAB</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">6</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">Save open pages as bookmarks in the Edge browser.</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">CTRL-SHIFT-D</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">7</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">Switch to Page Layout view in Excel.</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">ALT</samp><samp class="SANS_Futura_Std_Book_11">-W, then P</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">8</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">Switch to Normal Layout view in Excel.</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">ALT-W, then L</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">9</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">You can contact me via email at … or telephone … after 3 PM</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">Typed text</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">10</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">We cannot solve your problem via social media. Please email … for technical support.</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">Typed text</samp></p></td>
</tr>
<tr>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">11</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">Thank you for your email. I will reply in more detail once I can locate the required information.</samp></p></td>
<td class="table TB"><p class="TB"><samp class="SANS_Futura_Std_Book_11">Typed text</samp></p></td>
</tr>
<tr>
<td class="table TBL"><p class="TB"><samp class="SANS_Futura_Std_Book_11">12</samp></p></td>
<td class="table TBL"><p class="TB"><samp class="SANS_Futura_Std_Book_11">Without examining the product in person, we can’t determine the fault. Please post it to …</samp></p></td>
<td class="table TBL"><p class="TB"><samp class="SANS_Futura_Std_Book_11">Typed text</samp></p></td>
</tr>
</tbody>
</table>
</figure>
<p class="TX">You’ll need the following parts for this project:</p>
<ul class="ul">
<li class="BL">An Arduino Leonardo or compatible board and USB cable</li>
<li class="BL">Keypad hardware as described in <span class="Xref">Project #3 in <a href="chapter1.xhtml">Chapter 1</a></span></li>
</ul>
<p class="TX">Assembly is the same as in <span class="Xref">Project #3</span>, substituting an Arduino Leonardo for an Uno, as shown in <a href="chapter11.xhtml#fig11-8">Figure 11-8</a>. You may want to check the ADC values reported by each keypad button by using the sketch from <span class="Xref">Project #1</span> and then updating the ranges in our analogkeypad library.</p>
<figure class="IMG"><img alt="THE SCHEMATIC FOR PROJECT #33" class="img1" id="fig11-8" src="../images/fig11-8.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 11-8: The schematic for Project #33</samp></p></figcaption>
</figure>
<p class="TX"><span aria-label=" Page 170. " epub:type="pagebreak" id="pg_170" role="doc-pagebreak"/>Now enter and upload the following sketch:</p>
<span id="pro-33"/>

<pre><code>// Project #33 - USB shortcut keyboard

#define Ctrl 128
#define Alt 130
#define Escape 177
#define Shift 129
#define Tab 179
#define Enter 176
#define Delete 212

<span aria-label="annotation1" class="CodeAnnotationHang">❶</span> #include "Keyboard.h"
#include "analogkeypad.h"
analogkeypad keypad;

void button1()
{
    Keyboard.print("456700");
}

void button2()
{
    Keyboard.press(Ctrl);
    Keyboard.press(Alt);
    Keyboard.press(212);
    delay(100);
    Keyboard.releaseAll(); // Let go of all buttons
    delay(100);
    Keyboard.write(Enter);
    delay(100);
}

void button3()
{
    Keyboard.press(Ctrl);
    Keyboard.press(Shift);
    Keyboard.press(Escape);
    delay(100);
    Keyboard.releaseAll(); // Let go of all buttons
}

void button4()
{
    Keyboard.press(Ctrl);
    Keyboard.press(112); // Press P
    delay(100);
    Keyboard.releaseAll(); // Let go of all buttons
    delay(100);
    Keyboard.write(Enter);
    delay(100);
}

<span aria-label=" Page 171. " epub:type="pagebreak" id="pg_171" role="doc-pagebreak"/>void button5()
{
    Keyboard.press(Alt);
    Keyboard.press(Tab);
    delay(100);
    Keyboard.releaseAll(); // Let go of all buttons
}

void button6()
{
    Keyboard.press(Ctrl);
    Keyboard.press(Shift);
    Keyboard.press(100); // Press d
    delay(100);
    Keyboard.releaseAll(); // Let go of all buttons
}

void button7()
{
    Keyboard.press(130);
    Keyboard.press(119); // Press w
    delay(100);
    Keyboard.releaseAll(); // Let go of all buttons
    Keyboard.write(112); // Press p
}

void button8()
{
    Keyboard.press(Alt);
    Keyboard.press(119); // Press w
    delay(100);
    Keyboard.releaseAll(); // Let go of all buttons
    Keyboard.write(108); // Press l
}

void button9()
{
    Keyboard.println("You can contact me via email at email@address.com
or telephone 212-555-1213 after 3 p.m. ");
}

void button10()
{
    Keyboard.println("We cannot solve your problem via social media.
Please email support@company.com for technical support. ");
}

void button11()
{
    Keyboard.println("Thank you for your email, I will reply in more detail
once I can locate the required information. ");
}

<span aria-label=" Page 172. " epub:type="pagebreak" id="pg_172" role="doc-pagebreak"/>void button12()
{
    Keyboard.println("Without examining the product in person, we cannot
determine the fault. Please post it to: ");
    Keyboard.println("129 West 81st Street");
    Keyboard.println("Apt 5B");
    Keyboard.println("New York NY 10024");
}

void setup()
{
  <span aria-label="annotation2" class="CodeAnnotationCode">❷</span> Keyboard.begin();
}

void loop()
{
  <span aria-label="annotation3" class="CodeAnnotationCode">❸</span> switch (keypad.readKeypad()) // Read button status
    {
        case 1: button1(); break;
        case 2: button2(); break;
        case 3: button3(); break;
        case 4: button4(); break;
        case 5: button5(); break;
        case 6: button6(); break;
        case 7: button7(); break;
        case 8: button8(); break;
        case 9: button9(); break;
        case 10: button10(); break;
        case 11: button11(); break;
        case 12: button12(); break;
    }
    delay(250);
}
</code></pre>

<p class="TX">The sketch takes advantage of the analogkeypad library for the hardware and the Keyboard library to emulate the USB keyboard. These libraries are included <span aria-label="annotation1" class="CodeAnnotationCode">❶</span> and then initialized <span aria-label="annotation2" class="CodeAnnotationCode">❷</span>. The sketch then loops while it waits for a button press, which is actioned at <span aria-label="annotation3" class="CodeAnnotationCode">❸</span>. After that, it’s a simple matter of monitoring the keypad and calling one of the custom functions from <samp class="SANS_TheSansMonoCd_W5Regular_11">button1()</samp> to <samp class="SANS_TheSansMonoCd_W5Regular_11">button12()</samp> matched to each button. Each custom button function then performs the required emulation task, which you change for your own requirements.</p>
<p class="TX">Once the sketch has been uploaded, your keypad should operate as a shortcut keyboard. For example, upon receiving an email about a faulty product, our example user can hit Reply on the email, press the 12th button, and send it. <a href="chapter11.xhtml#fig11-9">Figure 11-9</a> shows an example email exchange.<span aria-label=" Page 173. " epub:type="pagebreak" id="pg_173" role="doc-pagebreak"/></p>
<figure class="IMG"><img alt="" class="img5" id="fig11-9" src="../images/fig11-9.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 11-9: Example output email for Project #33</samp></p></figcaption>
</figure>
<p class="TX">For someone answering customer support emails, this would save a lot of time. Based on your own daily computer usage habits, you can replace the shortcuts in the sketch with your own.</p>
</section>
</section>
<section aria-labelledby="sec4" epub:type="division">
<h2 class="H1" id="sec4"><span id="h1-77"/><samp class="SANS_Futura_Std_Bold_B_11">USB Mice</samp></h2>
<p class="TNI">You can also activate mouse emulation with your Leonardo by including the Arduino Mouse library with the following two lines of code:</p>

<pre><code>#include "Mouse.h" // Entered at start of sketch
Mouse.begin();    // Entered in void setup()
</code></pre>

<p class="TX">To have the Leonardo move the mouse pointer around as a USB mouse, use this function:</p>

<pre><code>Mouse.move(<var>x</var>,<var>y</var>,<var>z</var>);
</code></pre>

<p class="TX">The parameter are as follows:</p>
<p class="RunInPara1"><samp class="SANS_TheSansMonoCd_W7Bold_Italic_I_11">x</samp>    The amount to move on the x-axis. Use a positive number to move to the right, a negative number to move to the left, and 0 to stay on the current x-axis.</p>
<p class="RunInPara"><samp class="SANS_TheSansMonoCd_W7Bold_Italic_I_11">y</samp>    The amount to move on the y-axis. Use a positive number to move down, a negative number to move up, and 0 to stay on the current y-axis.</p>
<p class="RunInPara2"><samp class="SANS_TheSansMonoCd_W7Bold_Italic_I_11">z</samp>    Emulates movement of a mouse scroll wheel. Use a positive number to roll “toward you,” and a negative number to roll “away from you.” If you have changed the default mouse operation in your computer’s operating system, you will need to swap negative for positive numbers.</p>
<p class="TX">To end mouse emulation in a sketch, use:</p>

<pre><code>Mouse.end();
</code></pre>

<p class="TX"><span aria-label=" Page 174. " epub:type="pagebreak" id="pg_174" role="doc-pagebreak"/>When using the mouse emulation, you need a small delay of 2 ms after each mouse function to give the computer time to catch up. You can test controlling pointer movement with <a href="#LiT-11-4">Listing 11-4</a>.</p>
<span id="LiT-11-4"/>

<pre><code>#include &lt;Mouse.h&gt;
void setup()
{
    Mouse.begin();
}

void loop()
{
  <span aria-label="annotation1" class="CodeAnnotationHang1">❶</span> Mouse.move(−10, −5, 0);
    delay(500);
}
</code></pre>

<p class="CodeListingCaption"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Listing 11-4: Controlling pointer movement</samp></p>
<p class="TX">The sketch first initializes the library. The mouse pointer then moves 10 pixels to the left and 5 up <span aria-label="annotation1" class="CodeAnnotationCode">❶</span>. There’s a short delay afterward, just to slow things down a little.</p>
<p class="TX">After you upload the sketch, your mouse pointer should meander toward the top left of the screen. You can always change its position with the PC mouse, too. When finished, upload a non-mouse sketch to stop the movement.</p>
<p class="TX">You’ll now put these mouse-emulation functions to use with a simple project.</p>
<p class="HeadProject"><span id="h1-78"/><samp class="SANS_Futura_Std_Heavy_B_21">Project #34: Keeping Your PC Awake Automatically</samp></p>
<p class="TNI">Some PCs or other devices with USB mouse input may go into a “sleep mode” or require mouse movement on a regular basis to prove a user is present. In this project, you’ll program your Leonardo to “wiggle” the mouse every 30 seconds or so to keep the PC awake or the boss happy.</p>
<p class="TX">The only required hardware is your Arduino Leonardo and a matching USB cable. Enter and upload the following sketch:</p>
<span id="pro-34"/>

<pre><code>// Project #34 - PC "Keep Awake"

#include &lt;Mouse.h&gt;
void wiggleMouse()
{
  <span aria-label="annotation1" class="CodeAnnotationHang1">❶</span> Mouse.move(−50, 0, 0);
    delay(500);
  <span aria-label="annotation2" class="CodeAnnotationHang1">❷</span> Mouse.move(50, 0, 0);
    delay(500);
}

<span aria-label=" Page 175. " epub:type="pagebreak" id="pg_175" role="doc-pagebreak"/>void setup()
{
        Mouse.begin();
}

void loop()
{
    wiggleMouse();
    delay(30000);
}
</code></pre>

<p class="TX">The mouse pointer should move to the left <span aria-label="annotation1" class="CodeAnnotationCode">❶</span>, wait a moment, move back to the right <span aria-label="annotation2" class="CodeAnnotationCode">❷</span>, and then wait another moment, as instructed by the functions in the <samp class="SANS_TheSansMonoCd_W5Regular_11">wiggleMouse()</samp> custom function. The delays in the function and in the main loop are purely arbitrary; alter them to suit your requirements.</p>
</section>
<section aria-labelledby="sec5" epub:type="division">
<h2 class="H1" id="sec5"><span id="h1-79"/><samp class="SANS_Futura_Std_Bold_B_11">USB Mouse Buttons</samp></h2>
<p class="TNI">To program your Leonardo to “click” (press and then release) the emulated mouse buttons, you can use</p>

<pre><code>Mouse.click(); // Clicks the left mouse button by default
</code></pre>

<p class="BodyContinued">or</p>

<pre><code>Mouse.click(<var>x</var>);
</code></pre>

<p class="BodyContinued">where <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">x</samp> can be <samp class="SANS_TheSansMonoCd_W5Regular_11">MOUSE_LEFT</samp>, <samp class="SANS_TheSansMonoCd_W5Regular_11">MOUSE_RIGHT</samp>, or <samp class="SANS_TheSansMonoCd_W5Regular_11">MOUSE_MIDDLE</samp> for the respective buttons.</p>
<p class="TX">To press and hold down a mouse button, use the following function:</p>

<pre><code>Mouse.press(); // Presses and holds down the left mouse button by default
</code></pre>

<p class="TX">To release a mouse button being pressed, use the following function:</p>

<pre><code>Mouse.release(); // Defaults to releasing the left mouse button
</code></pre>

<p class="TX">You can also use the same parameters as <samp class="SANS_TheSansMonoCd_W5Regular_11">Mouse.click()</samp> for the middle and right buttons. Note that the definition of what is left and right with regard to the mouse buttons is defined by the settings in your operating system. For example, if you’ve swapped the buttons (so “right” is the physical left button), you will need to take that into account.</p>
<p class="TX">Let’s demonstrate mouse button control by creating a fun drawing project.</p>
<p class="HeadProject"><span id="h1-80"/><span aria-label=" Page 176. " epub:type="pagebreak" id="pg_176" role="doc-pagebreak"/><samp class="SANS_Futura_Std_Heavy_B_21">Project #35: Creating a PC Random Painter</samp></p>
<p class="TNI">This project will randomly move the mouse pointer and randomly <small>CTRL</small>-click the left mouse button. By running this sketch in conjunction with a PC painting program, you can create some avant-garde Arduino-generated works of art.</p>
<p class="TX">Again, the only hardware required is your Arduino Leonardo and matching USB cable. Enter, but don’t upload, the Project #35 sketch. Now open a PC painting program, such as Microsoft Paint, then switch over to the Arduino IDE and upload the sketch. Switch back to the paint software and place the cursor in the painting area after selecting a paintbrush and color. The sketch should start drawing based on random mouse movements, creating a painting like the one in <a href="chapter11.xhtml#fig11-10">Figure 11-10</a>.</p>
<figure class="IMG"><img alt="A SCREENSHOT OF AN EXAMPLE OUTPUT DRAWING FROM PROJECT #35" class="img5" id="fig11-10" src="../images/fig11-10.png"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 11-10: Example results from the random PC painter</samp></p></figcaption>
</figure>
<p class="TX">Let’s see how this works:</p>
<span id="pro-35"/>

<pre><code>// Project #35 - PC Random Painter

#include &lt;Mouse.h&gt;
void setup()
{
    Mouse.begin();
    randomSeed(analogRead(0));
  <span aria-label="annotation1" class="CodeAnnotationHang1">❶</span> delay(10000);
}

void loop()
{
  <span aria-label="annotation2" class="CodeAnnotationHang1">❷</span> Mouse.press();
    delay(2);
    switch (random(8))
  <span aria-label="annotation3" class="CodeAnnotationHang1">❸</span> {
        case 0: Mouse.move(−10, 0, 0); break;
        case 1: Mouse.move(10, 0, 0); break;
<span aria-label=" Page 177. " epub:type="pagebreak" id="pg_177" role="doc-pagebreak"/>        case 2: Mouse.move(0, −10, 0); break;
        case 3: Mouse.move(0, 10, 0); break;
        case 4: Mouse.move(10, 10, 0); break;
        case 5: Mouse.move(10, −10, 0); break;
        case 6: Mouse.move(−10, 10, 0); break;
        case 7: Mouse.move(−10, 10, 0); break;
    }
    delay(1000);
  <span aria-label="annotation4" class="CodeAnnotationHang1">❹</span> Mouse.release();
    delay(2);
    switch (random(8))
  <span aria-label="annotation5" class="CodeAnnotationHang1">❺</span> {
        case 0: Mouse.move(−10, 0, 0); break;
        case 1: Mouse.move(10, 0, 0); break;
        case 2: Mouse.move(0, −10, 0); break;
        case 3: Mouse.move(0, 10, 0); break;
        case 4: Mouse.move(10, 10, 0); break;
        case 5: Mouse.move(10, −10, 0); break;
        case 6: Mouse.move(−10, 10, 0); break;
        case 7: Mouse.move(−10, 10, 0); break;
    }
    delay(1000);
}
</code></pre>

<p class="TX">To create this masterpiece, the sketch first presses the mouse button <span aria-label="annotation2" class="CodeAnnotationCode">❷</span>, makes one of eight random mouse movements <span aria-label="annotation3" class="CodeAnnotationCode">❸</span>, and then releases the mouse button <span aria-label="annotation4" class="CodeAnnotationCode">❹</span>. It then makes another random mouse movement <span aria-label="annotation5" class="CodeAnnotationCode">❺</span> before repeating the process. The large delay <span aria-label="annotation1" class="CodeAnnotationCode">❶</span> gives you time to move from the Arduino IDE to the paint software after uploading the sketch.</p>
<p class="TX">For a final challenge, you might add a start button to your project so the Arduino doesn’t take over the keyboard or the mouse until you’re ready for it to do so. You might also try making an Etch A Sketch simulator, using two potentiometers for x- and y-axis control of the mouse.</p>
</section>
<section aria-labelledby="sec6" epub:type="division">
<h2 class="H1" id="sec6"><span id="h1-81"/><samp class="SANS_Futura_Std_Bold_B_11">Moving On</samp></h2>
<p class="TNI">At this point, you have the skills and practice you need to implement USB keyboard and mouse emulation for your own projects. You learned how to instruct the Arduino Leonardo or compatible board to behave as a keyboard and also behave as a mouse. Whenever you do so, make sure that there is a sufficient delay at the start of your project to enable any required preparation on the PC. This also gives you time to easily upload a new sketch to the board if you’re finished with the emulation experiments. If you completely lose control of your board, you can upload a new sketch using USBasp hardware via the ICSP pins.</p>
<p class="TX">In the next chapter, you’ll learn to read and write data to and from USB flash drives with your Arduino.</p>
</section>
</section>
</body>
</html>