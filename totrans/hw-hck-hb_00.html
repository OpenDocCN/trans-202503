<html><head></head><body>
<section>
<header><h1 class="FrontmatterTitle" id="fm-278748f07-0001"><span epub:type="pagebreak" title="xxiii" id="Page_xxiii"/>Introduction</h1></header>
<figure class="opener">
<img src="image_fi/book_art/chapterart.png" alt=""/>
</figure>
<p class="ChapterIntro">Once upon a time, in a universe not too far away, computers were massive machines that filled up big rooms and needed a small crew to run. With shrinking technology, it became more and more feasible to put computers in small spaces. Around 1965, the Apollo Guidance Computer was small enough to be carried into space, and it supported the astronauts with computation functions and control over the Apollo modules. This computer could be considered one of the earliest embedded systems. Nowadays, the overwhelming majority of processor chips produced are embedded—in phones, cars, medical equipment, critical infrastructure, and “smart” devices. Even your laptop has bundles of them. In other words, everyone’s lives are being affected by these little chips, which means understanding their security is critical.</p>
<p>Now, what qualifies a device to be labeled <em>embedded</em>? Embedded devices are computers small enough to be included in the structure of the equipment that they control. These computers are generally in the form of microprocessors that most likely include memory and interfaces to control the <span epub:type="pagebreak" title="xxiv" id="Page_xxiv"/>equipment in which they are embedded. The word <em>embedded</em> emphasizes that they’re used deep inside some object. Sometimes embedded devices are small enough to fit inside the thickness of a credit card to provide the intelligence to manage a transaction. Embedded devices are intended to be virtually undetectable to users who have limited or no access to their internal workings and are unable to modify the software on them.</p>
<p>What do these devices actually do? Embedded devices are used in a multitude of applications. They can host a full-blown Android operating system (OS) in a smart TV or be featured in a motor car’s electronic control unit (ECU) running a real-time OS. They can take the form of a Windows 98 PC inside a magnetic resonance imaging (MRI) scanner. Programmable logic controllers (PLCs) in industrial settings use them, and they even provide the control and communications in internet-connected toothbrushes.</p>
<p>Reasons for restricting access to the innards of a device often have to do with warranty, safety, and regulatory compliance. This inaccessibility, of course, makes reverse engineering more interesting, complicated, and enticing. Embedded systems come with a great variety of board designs, processors, and different operating systems, so there is a lot to explore, and the reverse engineering challenges are wide. This book is meant to help readers meet these challenges by providing an understanding of the design of the system and its components. It pushes the limits of embedded system security by exploring analysis methods called power-side channel attacks and fault attacks.</p>
<p>Many live embedded systems ensure safe use of equipment or may have actuators that can cause damage if triggered outside their intended working environment. We encourage you to play with a secondhand ECU in your lab, but we don’t encourage you to play with the ECU while your car is being driven! Have fun, be careful, and don’t hurt yourself or others.</p>
<p>In this book, you’ll learn how to progress from admiring a device in your hands to learning about security strengths and weaknesses. This book shows each step in that process and provides sufficient theoretical background for you to understand the process, with a focus on showing how to perform practical experiments yourself. We cover the entire process, so you’ll learn more than what is in the academic and other literature, but yet is important and relevant, such as how to identify components on a printed circuit board (PCB). We hope you enjoy it!</p>
<h2 id="h1-278748f07-0001">What Embedded Devices Look Like</h2>
<p class="BodyFirst">Embedded devices are designed with functions appropriate to the equipment in which they’re embedded. During development, aspects such as safety, functionality, reliability, size, power consumption, time-to-market, cost, and, yes, even security are subject to trade-offs. The variety of implementation makes it possible for most designs to be unique, as required by a particular application. For example, in an automotive electronic control unit, the focus on safety may mean that multiple redundant central <span epub:type="pagebreak" title="xxv" id="Page_xxv"/>processing unit (CPU) cores are simultaneously computing the same brake actuator response so that a final arbiter can verify their individual decisions.</p>
<p>Security is sometimes the prime function of an embedded device, such as in credit cards. Despite the importance of financial security, cost trade-offs are made since the card itself must remain affordable. Time to market could be a significant consideration with a new product because a company needs to get into the market before losing dominance to competitors. In the case of an internet-connected toothbrush, security may be considered a low priority and take a back seat in the final design.</p>
<p>With the ubiquity of cheap, off-the-shelf hardware from which to develop embedded systems, there is a trend away from custom parts. Application-specific integrated circuits (ASICs) are being replaced by common microcontrollers. Custom OS implementations are being replaced by FreeRTOS, bare Linux kernels, or even full Android stacks. The power of modern-day hardware can make some embedded devices the equivalent of a tablet, a phone, or even a complete PC.</p>
<p>This book is written to apply to most of the embedded systems you will encounter. We recommend that you start off with a development board of a simple microcontroller; anything under $100 and ideally with Linux support will do. This will help you understand the basics before moving on to more complex devices or devices you have less knowledge of or control over.</p>
<h2 id="h1-278748f07-0002">Ways of Hacking Embedded Devices</h2>
<p class="BodyFirst">Say you have a device with a security requirement not to allow third-party code, but your goal is to run code on it anyway. When contemplating a hack for whatever reason, the function of the device and its technical implementation influence the approach. For example, if the device contains a full Linux OS with an open network interface, it may be possible to gain full access simply by logging in with the known default root account password. You can then run your code on it. However, if you have a different microcontroller performing firmware signature verification and all debugging ports have been disabled, that approach will not work.</p>
<p>To reach the same goal, a different device will require you to take a different approach. You must carefully match your goal to the device’s hardware implementation. In this book, we approach this need by drawing an attack tree, which is a way of doing some lightweight threat modeling to help visualize and understand the best path to your goal.</p>
<h2 id="h1-278748f07-0003">What Does Hardware Attack Mean?</h2>
<p class="BodyFirst">We focus mostly on hardware attacks and what you need to know to execute them rather than software attacks, which have been covered extensively elsewhere. First, let’s straighten out some terminology. We aim to give useful definitions and avoid going into all the exceptions.</p>
<p><span epub:type="pagebreak" title="xxvi" id="Page_xxvi"/>A device comprises both software and hardware. For our purposes, we consider <em>software</em> to consist of bits, and we consider <em>hardware</em> to consist of atoms. We regard <em>firmware</em> (code that is embedded in the embedded device) to be the same as software.</p>
<p>When speaking of hardware attacks, it’s easy to conflate an attack that <em>uses</em> hardware versus an attack that <em>targets</em> hardware. It becomes more confusing when we realize that there are also software targets and software attacks. Here are some examples that describe the various combinations:</p>
<ul>
<li>We can attack a device’s ring oscillator (hardware target) by glitching the supply voltage (hardware attack).</li>
<li>We can inject a voltage glitch on a CPU (hardware attack) that influences an executing program (software target).</li>
<li>We can flip bits in memory (hardware target) by running Rowhammer code on the CPU (software attack).</li>
<li>For completeness, we can perform a buffer overflow (software attack) on a network daemon (software target).</li>
</ul>
<p>In this book, we’re addressing hardware attacks, so the target is either the software or the hardware. Bear in mind that hardware attacks are generally harder to execute than software attacks because software attacks require less tricky physical intervention. However, where a device may be resistant to software attacks, a hardware attack may end up being the successful, cheaper (and, in our opinion, definitely more fun) option. Remote attacks, where the device is not at hand, are limited to access through a network interface, whereas every type of attack can be performed if the hardware is physically accessible.</p>
<p>In summary, there are many different types of embedded devices, and each device has its own function, trade-offs, security objectives, and implementations. This variety makes possible a range of hardware attack strategies, which this book will teach you.</p>
<h2 id="h1-278748f07-0004">Who Should Read This Book?</h2>
<p class="BodyFirst">In this book, we’ll assume that you’re taking the role of an attacker who is interested in breaking security to do good. We’ll also assume that you’re mostly able to use some relatively inexpensive hardware like simple oscilloscopes and soldering equipment, and that you have a computer with Python installed.</p>
<p>We won’t assume that you have access to laser equipment, particle accelerators, or other items beyond the limits of a hobbyist’s budget. If you do have access to such equipment, perhaps at your local university laboratory, you should be able to benefit even further from this book. In terms of embedded device targets, we assume that you have physical access to them and that you’re interested in accessing assets stored in your devices. And most important, we assume that you’re interested in learning about new techniques, have a reverse-engineering mindset, and are ready to dig in!</p>
<h2 id="h1-278748f07-0005"><span epub:type="pagebreak" title="xxvii" id="Page_xxvii"/>About This Book</h2>
<p class="BodyFirst">Here’s a brief overview of what you’ll find in this book:</p>
<p class="ListHead"><b>Chapter 1: Dental Hygiene: Introduction to Embedded Security</b></p>
<p class="ListBody">Focuses on the various implementation architectures of embedded systems and some threat modeling, as well as discusses various attacks.</p>
<p class="ListHead"><b>Chapter 2: Reaching Out, Touching Me, Touching You: Hardware Peripheral Interfaces</b></p>
<p class="ListBody">Talks about a variety of ports and communication protocols, including the electrical basics needed to understand signaling and measurement.</p>
<p class="ListHead"><b>Chapter 3: Casing the Joint: Identifying Components and Gathering Information</b></p>
<p class="ListBody">Describes how to gather information about your target, interpret datasheets and schematics, identify components on a PCB, and extract and analyze firmware images.</p>
<p class="ListHead"><b>Chapter 4: Bull in a Porcelain Shop: Introducing Fault Injection</b></p>
<p class="ListBody">Presents the ideas behind fault attacks, including how to identify points of fault injection, prepare a target, create a fault injection setup, and hone in on effective parameters.</p>
<p class="ListHead"><b>Chapter 5: Don’t Lick the Probe: How to Inject Faults</b></p>
<p class="ListBody">Discusses clock, voltage, electromagnetic, laser and body biasing </p>fault injection, and what sort of tools you need to build or buy to perform them.
<p class="ListHead"><b>Chapter 6: Bench Time: Fault Injection Lab</b></p>
<p class="ListBody">Presents three practical fault injection labs to perform at home.</p>
<p class="ListHead"><b>Chapter 7: X Marks the Spot: Trezor One Wallet Memory Dump</b></p>
<p class="ListBody">Takes the Trezor One wallet and shows how to extract the key using fault injection on a vulnerable firmware version.</p>
<p class="ListHead"><b>Chapter 8: I’ve Got the Power: Introduction to Power Analysis</b></p>
<p class="ListBody">Introduces timing attacks and simple power analysis, and shows how these can be used to extract passwords and cryptographic keys.</p>
<p class="ListHead"><b>Chapter 9: Bench Time: Simple Power Analysis</b></p>
<p class="ListBody">Takes you all the way from building a basic hardware setup to everything needed to perform an SPA attack in your home lab.</p>
<p class="ListHead"><b>Chapter 10: Splitting the Difference: Differential Power Analysis</b></p>
<p class="ListBody">Explains differential power analysis and shows how tiny fluctuations in power consumption can lead to cryptographic key extraction.</p>
<p class="ListHead"><b><span epub:type="pagebreak" title="xxviii" id="Page_xxviii"/>Chapter 11: Gettin’ Nerdy with It: Advanced Power Analysis</b></p>
<p class="ListBody">Provides a smorgasbord of techniques that allow you to level up your power analysis: from practical measurement tips to trace set filtering, signal analysis, processing, and visualization.</p>
<p class="ListHead"><b>Chapter 12: Bench Time: Differential Power Analysis</b></p>
<p class="ListBody">Takes a physical target with a special bootloader and breaks various secrets using different power analysis techniques.</p>
<p class="ListHead"><b>Chapter 13: No Kiddin’: Real-Life Examples</b></p>
<p class="ListBody">Summarizes a number of published fault and side-channel attacks performed on real-life targets.</p>
<p class="ListHead"><b>Chapter 14: Think of the Children: Countermeasures, Certifications, and Goodbytes</b></p>
<p class="ListBody">Discusses numerous countermeasures that mitigate some of the risks explained in this book and touches on device certification and where to go next.</p>
<p class="ListHead"><b>Appendix A: Maxing Out Your Credit Card: Setting Up a Test Lab</b></p>
<p class="ListBody">Makes your mouth water with a splendid exposé of all the tools you’ll ever want, and more.</p>
<p class="ListHead"><b>Appendix B: All Your Base Are Belong to Us: Popular Pinouts</b></p>
<p class="ListBody">A cheat sheet for a few popular pinouts you’ll regularly encounter.</p>
</section>
</body></html>