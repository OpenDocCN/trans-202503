<html><head></head><body>
<div id="sbo-rt-content" class="calibre1"><section aria-labelledby="ch11" epub:type="chapter" role="doc-chapter">
<hgroup>
<h2 class="title" id="ch11">
<span class="cn"><span aria-label=" Page 111. " epub:type="pagebreak" id="pg_111" role="doc-pagebreak" class="calibre2"/><span class="sans_dogma_ot_bold_b_">11</span></span>
<span class="ct1"><span class="sans_dogma_ot_bold_b_">PARAMETERS AND ARGUMENTS</span></span>
</h2>
</hgroup>
<figure class="opener"><img alt="" class="opener1" height="407" src="../images/chapter.jpg" width="408"/>
</figure>
<p class="chapterintro">In the previous chapter, I demonstrated how a bat file can call both internal routines and other bat files, but I didn’t discuss how to pass data back and forth between the calling and called logic. By default, all variables set in the calling code are exposed to the called code, and vice versa. If the code is closely coupled, there’s technically no need to pass arguments and accept parameters, but to make that work, both sets of code must agree on and use the same set of variables.</p>
<p class="tx">That’s adequate if you’re creating a second bat file simply to break up a large project and the called bat file will never be called from elsewhere, but to make more generic code that’s reusable by other processes and coders, the act of parameterizing the data going in and out of bat files and routines is critical.</p>
<p class="tx"><span aria-label=" Page 112. " epub:type="pagebreak" id="pg_112" role="doc-pagebreak"/>In this chapter, I’ll detail everything you need to know about arguments and parameters, including the esoteric syntax unique to Batch. You’ll learn how to pass arguments to a bat file or routine and how to accept returned parameters. You’ll even learn about the hidden parameter, how and why to shift parameters, and how to pass arguments to a bat file with just a few mouse clicks.</p>
<section aria-labelledby="sec1" epub:type="division">
<h3 class="h" id="sec1"><span id="h1-77"/><span class="sans_futura_std_bold_b_">Passing Arguments</span></h3>
<p class="tni">To demonstrate how to pass arguments and accept parameters, I’ll write a short bat file that builds a simple example of Mad Libs, the game that made long car trips tolerable for kids before the ubiquity of handheld electronic devices. The bat file accepts three ordered parameters (an adjective, a verb, and a noun) and inserts them into the following text before displaying the result to the user:</p>
<p class="blockquotesingle"><span class="sans_futura_std_book_">Bats are <span aria-hidden="true">_______</span> (adjective) mammals. They <span aria-hidden="true">_______</span> (verb) around in caves, but if you stand under them, you might get hit with <span aria-hidden="true">_______</span> (noun).</span></p>
<p class="tx">I’m not sharing the called bat file with you just yet, because I’ll first concentrate on how to call <i class="calibre6">MadLibs.bat</i> while passing it the three arguments. After all, the calling bat file really doesn’t care how the sausage is made; it just wants a grinder. The calling bat file needs to know only the arguments to pass and the expected results. That’s it. (In the next section, I’ll look at this from the perspective of the called bat file, <i class="calibre6">MadLibs.bat</i>.)</p>
<p class="tx">In <span class="xref"><a href="chapter10.xhtml" class="calibre3">Chapter 10</a></span>, I demonstrated how the <span class="sans_thesansmonocd_w5regular_">call</span> command invokes another bat file. That’s exactly what the next command is doing, but now three arguments follow the name of the bat file representing an adjective, a verb, and a noun, precisely in that order, all delimited by spaces:</p>
<pre class="pre"><code class="calibre11">call C:\Batch\MadLibs.bat adorable fly guano</code></pre>
<p class="tx">Someone is obviously cheating because the result written to the console makes far too much sense for this game:</p>
<pre class="pre"><code class="calibre11">Bats are adorable mammals. They fly around in caves,
but if you stand under them, you might get hit with guano.
</code></pre>
<p class="tx">More typically, if an 11-year-old boy were to play this game, he might come up with the following set of words representing an adjective, verb, and noun:</p>
<pre class="pre"><code class="calibre11">call C:\Batch\MadLibs.bat stinky fart poop</code></pre>
<p class="tx"><span aria-label=" Page 113. " epub:type="pagebreak" id="pg_113" role="doc-pagebreak"/>The result is</p>
<pre class="pre"><code class="calibre11">Bats are stinky mammals. They fart around in caves,
but if you stand under them, you might get hit with poop.
</code></pre>
<p class="tni">which somehow still works—at least for a preteen boy.</p>
<section aria-labelledby="sec2" epub:type="division">
<h4 class="h1" id="sec2"><span id="h2-29"/><span class="sans_futura_std_heavy_oblique_bi_">Argument Delimiters</span></h4>
<p class="tni">The passed arguments in the previous example are delimited from each other and the name of the called bat file by spaces. The space is by far the most common delimiter, with the comma a definitive second, but the semicolon, equal sign, and tab character also work. Consider these two <span class="sans_thesansmonocd_w5regular_">call</span> commands:</p>
<pre class="pre"><code class="calibre11">call C:\Batch\MadLibs.bat adorable fly guano
call C:\Batch\MadLibs.bat,adorable;fly=guano
</code></pre>
<p class="tni">Both commands are functionally equivalent, but the second looks to be an exercise in obfuscations.</p>
<p class="tx">Comma-delimited data is fairly common (for instance, the contents of a <i class="calibre6">.csv</i> file). Because the comma is in the set of Batch argument delimiters, you can store comma-delimited data in a variable and then resolve that variable as part of a <span class="sans_thesansmonocd_w5regular_">call</span> command like so:</p>
<pre class="pre"><code class="calibre11">set myArgs=adorable,fly,guano 
call C:\Batch\MadLibs.bat %myArgs%
</code></pre>
<p class="tx">The interpreter treats each piece of text separated by a comma as a unique argument (assuming other delimiters aren’t in the data). This might look like a single argument, but in reality, the command is passing three arguments.</p>
</section>
<section aria-labelledby="sec3" epub:type="division">
<h4 class="h1" id="sec3"><span id="h2-30"/><span class="sans_futura_std_heavy_oblique_bi_">Argument Encasing</span></h4>
<p class="tni">Looking at the list of permissible argument delimiters does raise an interesting question: Is it possible to pass spaces and the other delimiters as actual argument data? Yes, it’s very possible, but first consider the problem posed by these (three?) arguments:</p>
<pre class="pre"><code class="calibre11">call C:\Batch\MadLibs.bat ad hominem took off ice cream</code></pre>
<p class="tx">Someone is clearly being very difficult, using two-word versions of the three arguments. (And anyone who uses <span class="sans_thesansmonocd_w5regular_">ad hominem</span> as a Mad Libs adjective is being more pretentious than difficult. He’s probably a certain guy in the office correcting everyone’s use of parameter and argument.) The result is six arguments, not three, for the interpreter to handle.</p>
<p class="tx">Since a space is one of the characters for delimiting arguments, the interpreter considered <span class="sans_thesansmonocd_w5regular_">ad</span> to be the adjective argument, while the verb argument is <span class="sans_thesansmonocd_w5regular_">hominem</span>, and the noun argument is <span class="sans_thesansmonocd_w5regular_">took</span>. This results in a nonsensical <span aria-label=" Page 114. " epub:type="pagebreak" id="pg_114" role="doc-pagebreak"/>word salad, even by the standard of Mad Libs. The remainder of the command, <span class="sans_thesansmonocd_w5regular_">off ice cream</span>, becomes the fourth, fifth, and sixth arguments to a bat file that accepts only three; they are duly ignored with no further harm done.</p>
<p class="tx">The solution to this issue is to encase each argument in double quotes, which also provides the side benefit of being far more readable:</p>
<pre class="pre"><code class="calibre11">call C:\Batch\MadLibs.bat "ad hominem" "took off" "ice cream"</code></pre>
<p class="tx">The called bat file needs to do something to work with arguments that may or may not be double quoted, and I’ll get to that shortly.</p>
<p class="tx">With all of this in place, the output at least makes grammatical sense, mostly:</p>
<pre class="pre"><code class="calibre11">Bats are ad hominem mammals. They took off around in caves,
but if you stand under them, you might get hit with ice cream.
</code></pre>
<p class="tx">The encasing double quotes provide another great advantage; they’ll hold the place of any missing arguments or those set to spaces. For instance, just to be contrarian, someone might refuse to supply the first argument. (After all, dropping an adjective will still make grammatical sense, but omitting a noun or verb will surely break the sentence structure.) Without the double quotes in the following example, the second argument would skew to become the first, and the third would become the second. Instead, three arguments are being passed, even if the first is null:</p>
<pre class="pre"><code class="calibre11">call C:\Batch\MadLibs.bat "" "hop" "fudge"</code></pre>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">hop</span> and <span class="sans_thesansmonocd_w5regular_">fudge</span> arguments correctly map to the verb and noun, respectively, and there’s no adjective, resulting in the following output:</p>
<pre class="pre"><code class="calibre11">Bats are  mammals. They hop around in caves,
but if you stand under them, you might get hit with fudge.
</code></pre>
<p class="tx">The encasing double quotes also allow you to the use commas, semicolons, equal signs, and even tab characters as arguments or as part of arguments.</p>
</section>
<section aria-labelledby="sec4" epub:type="division">
<h4 class="h1" id="sec4"><span id="h2-31"/><span class="sans_futura_std_heavy_oblique_bi_">Argument Variables</span></h4>
<p class="tni">Up to this point I’ve shown only hardcoded arguments, but more often than not, arguments are variables, and if you can’t be absolutely certain that there are no (and never will be) embedded spaces, I suggest adding double quotes to the resolved variables:</p>
<pre class="pre"><code class="calibre11">call C:\Batch\MadLibs.bat "%arg0%" "%arg1%" "%arg2%"</code></pre>
<p class="tx">When the <span class="sans_thesansmonocd_w5regular_">call</span> command executes, the three argument variables are resolved and passed to the called bat file, each encased in double quotes.</p>
<span aria-label=" Page 115. " epub:type="pagebreak" id="pg_115" role="doc-pagebreak"/>
<blockquote class="calibre8">
<p class="warning"><span class="sans_dogma_ot_bold_b_1">NOTE</span></p>
</blockquote>
<p class="warning-txt"><i class="calibre6">The “parameter versus argument” argument: there’s some debate about the difference between these two terms. I’ve seen different definitions, but I’m writing with the distinction that</i> <span class="copyright_accent">arguments</span> <i class="calibre6">are passed from the</i> <span class="copyright_accent">calling</span> <i class="calibre6">code, and</i> <span class="copyright_accent">parameters</span> <i class="calibre6">are accepted by the</i> <span class="copyright_accent">called</span> <i class="calibre6">code. But there’s a gray area, and it’s commonplace to hear coders talking about “passing parameters” and “receiving arguments.” We all know what’s meant. I don’t want to be that pedantic jerk in the office correcting everyone, but I’ll try to use these words consistently.</i></p>
</section>
</section>
<section aria-labelledby="sec5" epub:type="division">
<h3 class="h" id="sec5"><span id="h1-78"/><span class="sans_futura_std_bold_b_">Accepting Parameters</span></h3>
<p class="tni">Let’s change our perspective by 180 degrees and look at <a href="#Lis11-1" class="calibre3">Listing 11-1</a> where the called bat file accepts the three parameters, which means finally sharing the entirety of <i class="calibre6">MadLibs.bat</i>, which produced multiple rounds of output in the previous examples.</p>
<span id="Lis11-1"/>
<pre class="pre"><code class="calibre11">set adjective=%~1
set verb=%~2
set noun=%~3

&gt; con echo.
&gt; con echo Bats are %adjective% mammals. They %verb% around in caves, 
&gt; con echo but if you stand under them, you might get hit with %noun%.
goto :eof
</code></pre>
<p class="listingcaption"><span class="futura_std_book_oblique_i_">Listing 11-1: The</span> <span class="sans_futura_std_book_">MadLibs.bat</span> <span class="futura_std_book_oblique_i_">bat file accepts three parameters and displays a Mad Lib.</span></p>
<p class="tx">Any bat file that accepts parameters should begin in one of two ways. It should have remarks detailing the parameters that the bat file accepts, or it should define the parameters at the top of the file with <span class="sans_thesansmonocd_w5regular_">set</span> commands using unambiguously named variables. For this bat file, I chose the latter approach.</p>
<p class="tx">The first parameter is descriptively named <span class="sans_thesansmonocd_w5regular_">adjective</span>, and <span class="sans_thesansmonocd_w5regular_">%~1</span> is the best syntax for resolving the first argument passed into a bat file. Incrementing the integer gives us the value of the second argument, <span class="sans_thesansmonocd_w5regular_">%~2</span>, which is assigned to <span class="sans_thesansmonocd_w5regular_">verb</span>. Finally, another unambiguously named variable, <span class="sans_thesansmonocd_w5regular_">noun</span>, is assigned to the third argument, <span class="sans_thesansmonocd_w5regular_">%~3</span>.</p>
<section aria-labelledby="sec6" epub:type="division">
<h4 class="h1" id="sec6"><span id="h2-32"/><span class="sans_futura_std_heavy_oblique_bi_">Resolving Parameters with a Tilde</span></h4>
<p class="tni">This next point is as important as it is subtle; if you remove the tilde from the first line of the bat file, <span class="sans_thesansmonocd_w5regular_">%1</span> resolves to the first parameter exactly as it’s received, with or without double quotes. However, <span class="sans_thesansmonocd_w5regular_">%~1</span> resolves to the first parameter with its encasing double quotes removed—and if there are no double quotes to remove, the resolved parameter is unchanged, so the tilde causes no harm. The same holds for the other parameters: <span class="sans_thesansmonocd_w5regular_">%~2</span> resolves to the second parameter with any double quotes removed, and <span class="sans_thesansmonocd_w5regular_">%2</span> resolves to that parameter as it was passed.</p>
<p class="tx">The inclusion of the tilde is exactly what I was referring to in the prior section when I mentioned that the called bat file would need to do <span aria-label=" Page 116. " epub:type="pagebreak" id="pg_116" role="doc-pagebreak"/>something in order to work with arguments that may or may not be encased in double quotes in the <span class="sans_thesansmonocd_w5regular_">call</span> command. The <i class="calibre6">MadLibs.bat</i> file clearly has the syntax with the tilde allowing it to work both ways, thus providing a courtesy to the coder of the calling bat file.</p>
<p class="tx">The <i class="calibre6">only</i> time that I wouldn’t use a tilde to resolve a parameter is when I explicitly want to maintain the double quotes, and such instances are rare at best. Using the tilde gives the calling bat file the flexibility to use double quotes or not. Consider these functionally equivalent commands:</p>
<pre class="pre"><code class="calibre11">call C:\Batch\MadLibs.bat ugly running "cell phone"
call C:\Batch\MadLibs.bat "ugly" "running" "cell phone"
</code></pre>
<p class="tx">The calling bat file must use the double quotes for arguments with any embedded spaces, such as the third one above; otherwise, the double quotes aren’t required, but they won’t hurt. I mentioned that these two commands are functionally equivalent, but that wouldn’t be true if <i class="calibre6">MadLibs.bat</i> hadn’t used the tildes in the first three commands.</p>
<p class="tx">If you think the syntax for resolving a parameter looks odd, you aren’t alone. Variables are typically resolved with two percent signs, but here a single percent sign is followed by a one-digit number (or a tilde and a number) and nothing else. Variables named with a leading number can’t be resolved with percent signs, so when the interpreter sees a percent sign followed by a number (with maybe a tilde between them) a parameter is assumed. Once understood, it does offer a very concise syntax for resolving parameters.</p>
</section>
<section aria-labelledby="sec7" epub:type="division">
<h4 class="h1" id="sec7"><span id="h2-33"/><span class="sans_futura_std_heavy_oblique_bi_">Resolving the Entire Parameter List</span></h4>
<p class="tni">You can resolve an entire parameter list, regardless of the number of values, simply with a percent sign followed by an asterisk, which is very handy when a called bat file wants to call another bat file or a routine passing along the same parameter list. Consider this command inside a called bat file, particularly the trailing <span class="sans_thesansmonocd_w5regular_">%*</span> characters:</p>
<pre class="pre"><code class="calibre11">call C:\Batch\SecondCalledBat.bat "%arg0%" %*</code></pre>
<p class="tx">This command is passing an argument list consisting of a simple variable, followed by the parameter list coming into the bat file or routine. I’ve encased the first argument, the <span class="sans_thesansmonocd_w5regular_">arg0</span> variable, in double quotes just in case it contains any embedded delimiter characters, such as a space; this ensures that the interpreter treats the variable as a single argument, not multiple arguments. The rest of the arguments are the complete set of parameters passed into the called bat file, regardless of how many. Ultimately, the first parameter into the bat file is the second argument in the call, and so on. (Spoiler alert: we’ll use this technique extensively when we get to object-oriented design in <span class="xref"><a href="chapter32.xhtml" class="calibre3">Chapter 32</a></span>.)</p>
</section>
</section>
<section aria-labelledby="sec8" epub:type="division">
<h3 class="h" id="sec8"><span id="h1-79"/><span aria-label=" Page 117. " epub:type="pagebreak" id="pg_117" role="doc-pagebreak"/><span class="sans_futura_std_bold_b_">Internal Routine Parameters</span></h3>
<p class="tni">To this point I’ve discussed parameters only in reference to the calling of another bat file. Fortunately, there really is no difference when calling a routine inside a bat file. We can easily rewrite the complete bat file from <a href="#Lis11-1" class="calibre3">Listing 11-1</a> as an internal routine. Notice in <a href="#Lis11-2" class="calibre3">Listing 11-2</a> that the only difference is the addition of the label.</p>
<span id="Lis11-2"/>
<pre class="pre"><code class="calibre11">:MadLibs
 set adjective=%~1
 set verb=%~2
 set noun=%~3

 &gt; con echo.
 &gt; con echo Bats are %adjective% mammals. They %verb% around in caves, 
 &gt; con echo but if you stand under them, you might get hit with %noun%.
 goto :eof
</code></pre>
<p class="listingcaption"><span class="futura_std_book_oblique_i_">Listing 11-2: The :MadLibs routine accepts three parameters and displays a Mad Lib.</span></p>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">call</span> command to invoke the routine has the same arguments, and the double quotes are handled the same way:</p>
<pre class="pre"><code class="calibre11">call :MadLibs "ad hominem" "took off" "ice cream"</code></pre>
<p class="tni">The only difference is that a label is called instead of another bat file. Everything else works exactly the same.</p>
</section>
<section aria-labelledby="sec9" epub:type="division">
<h3 class="h" id="sec9"><span id="h1-80"/><span class="sans_futura_std_bold_b_">The Hidden Parameter</span></h3>
<p class="tni">Many modern languages treat the incoming parameter list as an array, in particular a zero-offset array. Coupling that with the fact that Batch surprisingly uses a zero-offset for substringing, many coders have looked for a parameter in <span class="sans_thesansmonocd_w5regular_">%~0</span> (yours truly included). The result can be befuddling, as adding the following <span class="sans_thesansmonocd_w5regular_">echo</span> command at the top of the routine from <a href="#Lis11-2" class="calibre3">Listing 11-2</a> demonstrates:</p>
<pre class="pre"><code class="calibre11">:MadLibs
 &gt; con echo Parm 0 is %~0
 set adjective=%~1
</code></pre>
<p class="tni">The text written to the console contains the name of the routine being executed:</p>
<pre class="pre"><code class="calibre11">Parm 0 is :MadLibs</code></pre>
<p class="tx">Before I explain what exactly is going on, earlier in the chapter, the Mad Libs logic was in an external file and called like so:</p>
<pre class="pre"><code class="calibre11">call C:\Batch\MadLibs.bat "adorable" "fly" "guano"</code></pre>
<p class="tni"><span aria-label=" Page 118. " epub:type="pagebreak" id="pg_118" role="doc-pagebreak"/>Take the same <span class="sans_thesansmonocd_w5regular_">echo</span> command added to the previous <span class="sans_thesansmonocd_w5regular_">:MadLibs</span> routine, and add it to the called bat file from <a href="#Lis11-1" class="calibre3">Listing 11-1</a>, and the result is the following:</p>
<pre class="pre"><code class="calibre11">Parm 0 is C:\Batch\MadLibs.bat</code></pre>
<p class="tx">I hesitate to call <span class="sans_thesansmonocd_w5regular_">%0</span> the first parameter. It’s more of a hidden parameter coming just prior to the first parameter. From this example, it’s obvious that the hidden parameter is the name of the routine or bat file being executed, but where’s it coming from?</p>
<p class="tx">A bat file is often the first argument of the <span class="sans_thesansmonocd_w5regular_">call</span> command, and that argument is passed into the called bat file itself as <span class="sans_thesansmonocd_w5regular_">%0</span>. In fact, <span class="sans_thesansmonocd_w5regular_">%0</span> matches the capitalization of the path and filename (or label name) in the <span class="sans_thesansmonocd_w5regular_">call</span> command, not the capitalization of the actual path and filename. If the path isn’t part of the argument, it isn’t part of <span class="sans_thesansmonocd_w5regular_">%0</span>. Furthermore, if the <span class="sans_thesansmonocd_w5regular_">call</span> command has double quotes around the path and filename, so will <span class="sans_thesansmonocd_w5regular_">%0</span>. For that reason, it’s usually best to resolve it with the tilde, <span class="sans_thesansmonocd_w5regular_">%~0</span>, just like the other parameters.</p>
<p class="tx">The hidden parameter is omnipresent in all bat files, not just called bat files or called routines. Even a high-level bat file, the one that you may have started with a double mouse click, has its path and filename in the hidden parameter. We don’t often think about what’s going on when we open a bat file, but it isn’t magic. Windows executes a <span class="sans_thesansmonocd_w5regular_">call</span> command, with the bat file as its only argument, for you. The result is <span class="sans_thesansmonocd_w5regular_">%0</span> being resolved to the path and the name of the bat file encased in double quotes.</p>
<p class="tx">This hidden parameter has many uses. For error handling, it offers an easy means of logging the routine in which the error occurred. If the bat file is moved to a different directory, computer, or domain, the hidden parameter allows the bat file to know its location. When we get to the <span class="sans_thesansmonocd_w5regular_">for</span> command, there’s a relatively straightforward means of retrieving just the path from a variable holding a path and filename. You can then use it in any number of ways. For instance, you can drop output files into a subfolder under the bat file, or the bat file can perform different actions based on where it resides. It’s a very useful, and hidden, feature of Batch.</p>
</section>
<section aria-labelledby="sec10" epub:type="division">
<h3 class="h" id="sec10"><span id="h1-81"/><span class="sans_futura_std_bold_b_">Shifting Parameters</span></h3>
<p class="tni">If the first parameter is resolved with <span class="sans_thesansmonocd_w5regular_">%~1</span> and the ninth parameter is resolved with <span class="sans_thesansmonocd_w5regular_">%~9</span>, it might make sense that the 10th parameter would be resolved with <span class="sans_thesansmonocd_w5regular_">%~10</span>. Alas no, the interpreter recognizes only parameters <span class="sans_thesansmonocd_w5regular_">0</span> through <span class="sans_thesansmonocd_w5regular_">9</span>, or single-digit ordinal numbers. It would be nice if a compiler could gently remind you that <span class="sans_thesansmonocd_w5regular_">%~10</span> isn’t a valid parameter, but again no, this is Batch. To demonstrate what can go wrong when this parameter is resolved, consider the example of a double-digit parameter list shown in <a href="#Lis11-3" class="calibre3">Listing 11-3</a>. The first half of the alphabet is being passed to a routine that’s attempting to write five selected letters to the console.</p>
<span id="Lis11-3"/>
<pre class="pre"><code class="calibre11"><span aria-label=" Page 119. " epub:type="pagebreak" id="pg_119" role="doc-pagebreak"/> call :Alphabet A B C D E F G H I J K L M
 goto :eof

:Alphabet
 &gt; con echo Parm 1 is "%~1"
 &gt; con echo Parm 2 is "%~2"
 &gt; con echo Parm 9 is "%~9"
 &gt; con echo Parm 10 is "%~10"
 &gt; con echo Parm 13 is "%~13"
 goto :eof
</code></pre>
<p class="listingcaption"><span class="futura_std_book_oblique_i_">Listing 11-3: A first pass at the routine :Alphabet to display five parameters</span></p>
<p class="tx">The first three look fine, but parameters 10 and 13 look to be junk:</p>
<pre class="pre"><code class="calibre11">Parm 1 is "A"
Parm 2 is "B"
Parm 9 is "I"
Parm 10 is "A0"
Parm 13 is "A3"
</code></pre>
<p class="tx">When we humans ponder <span class="sans_thesansmonocd_w5regular_">%~13</span>, we see the number 13 and might expect the 13th parameter, <span class="sans_thesansmonocd_w5regular_">M</span>, to be resolved. But the interpreter has never been confused with artificial intelligence, much less human intelligence. When it encounters <span class="sans_thesansmonocd_w5regular_">%~13</span>, it sees the first parameter, <span class="sans_thesansmonocd_w5regular_">%~1</span>, which is resolved to <span class="sans_thesansmonocd_w5regular_">A</span>, followed by the hardcoded value <span class="sans_thesansmonocd_w5regular_">3</span>. The result is <span class="sans_thesansmonocd_w5regular_">A3</span>. Similarly, <span class="sans_thesansmonocd_w5regular_">%~10</span> resolves to the first parameter, but it’s appended with a zero, resulting in <span class="sans_thesansmonocd_w5regular_">A0</span>.</p>
<p class="tx">Batch, however, isn’t limited to only nine parameters. In fact, I’ve seen dozens passed as there’s no practical limit (other than the limit of 8,191 characters in any command). To access the 10th parameter and beyond, you need the <span class="sans_thesansmonocd_w5regular_">shift</span> command. To demonstrate, let’s fix the <span class="sans_thesansmonocd_w5regular_">:Alphabet</span> routine from <a href="#Lis11-3" class="calibre3">Listing 11-3</a>:</p>
<pre class="pre"><code class="calibre11">:Alphabet
 &gt; con echo Parm 1 is "%~1"
 &gt; con echo Parm 2 is "%~2"
 &gt; con echo Parm 9 is "%~9"
 shift
 &gt; con echo Parm 10 is "%~9"
 shift &amp; shift &amp; shift
 &gt; con echo Parm 13 is "%~9"
 goto :eof
</code></pre>
<p class="tx">The resolutions of parameters 1, 2, and 9 are unchanged before the <span class="sans_thesansmonocd_w5regular_">shift</span> command executes, which shifts each parameter one position to the left. The second becomes the first, the third becomes the second, and the 10th parameter becomes the ninth. It may be counterintuitive, but after <span aria-label=" Page 120. " epub:type="pagebreak" id="pg_120" role="doc-pagebreak"/>a <span class="sans_thesansmonocd_w5regular_">shift</span> command, <span class="sans_thesansmonocd_w5regular_">%~9</span> resolves to parameter 10. Then after three more <span class="sans_thesansmonocd_w5regular_">shift</span> commands, <span class="sans_thesansmonocd_w5regular_">%~9</span> resolves to <span class="sans_thesansmonocd_w5regular_">M</span>, the 13th parameter, producing the desired output:</p>
<pre class="pre"><code class="calibre11">Parm 1 is "A"
Parm 2 is "B"
Parm 9 is "I"
Parm 10 is "J"
Parm 13 is "M"
</code></pre>
<p class="tx">When introducing the command separator (<span class="sans_thesansmonocd_w5regular_">&amp;</span>) in <span class="xref"><a href="chapter2.xhtml" class="calibre3">Chapter 2</a></span>, I mentioned you should use it sparingly. In other situations, it can make a mess of the code, but <span class="sans_thesansmonocd_w5regular_">shift</span> is such a simple and succinct command, putting three on one line actually cleans up the code.</p>
<p class="tx">Note that the <span class="sans_thesansmonocd_w5regular_">shift</span> command doesn’t impact the resolution of <span class="sans_thesansmonocd_w5regular_">%*</span>. This funky syntax still resolves to the complete and original parameter list regardless of how many <span class="sans_thesansmonocd_w5regular_">shift</span> commands execute.</p>
<p class="tx">Shifting the parameters raises an interesting question. What happens to the path and filename resolved with <span class="sans_thesansmonocd_w5regular_">%0</span> after the <span class="sans_thesansmonocd_w5regular_">shift</span> command executes? The short answer is that it gets wiped out and replaced with the first parameter, at least by default. But the <span class="sans_thesansmonocd_w5regular_">shift</span> command has a lone option, and that option defines which parameter gets dropped with the shift; all parameters prior to it are maintained. It’s formatted differently from the options we’ve described to this point. The <span class="sans_thesansmonocd_w5regular_">/n</span> option drops the <i class="calibre6">n</i>th parameter, so that the following command drops the first and preserves <span class="sans_thesansmonocd_w5regular_">%0</span>:</p>
<pre class="pre"><code class="calibre11">shift /1</code></pre>
<p class="tx">Parameter 0, or the hidden parameter, is unchanged. Parameter 1 is discarded while parameter 2 slides over to become parameter 1. The third parameter becomes the second, and so on. With a small change, the following command preserves the first four parameters (and the hidden parameter), while discarding the fifth:</p>
<pre class="pre"><code class="calibre11">shift /5</code></pre>
<p class="tni">Parameter 6 is shifted to parameter 5, and the rest are shifted accordingly.</p>
<p class="tx">This option accepts parameters 0 through 8—although there’s no need to use <span class="sans_thesansmonocd_w5regular_">/0</span> as that’s the default behavior. For some unknown reason, <span class="sans_thesansmonocd_w5regular_">/9</span> is invalid. Don’t ask.</p>
</section>
<section aria-labelledby="sec11" epub:type="division">
<h3 class="h" id="sec11"><span id="h1-82"/><span class="sans_futura_std_bold_b_">Returning Parameters</span></h3>
<p class="tni">You now know how to pass arguments to routines and other bat files and write the received parameters to the console, but in the real coding world many routines accept some parameters and pass others back to the caller. Because Batch variables in a called process are globally available, some <span aria-label=" Page 121. " epub:type="pagebreak" id="pg_121" role="doc-pagebreak"/>coders simply set a hardcoded variable name in a routine and use it elsewhere. Such Philistines! A far more elegant and flexible solution is to allow the caller to define the name of the variable returned.</p>
<blockquote class="calibre8">
<p class="warning"><span class="sans_dogma_ot_bold_b_1">NOTE</span></p>
</blockquote>
<p class="warning-txt"><i class="calibre6">I’m using</i> <span class="copyright_accent">Philistines</span> <i class="calibre6">as a pejorative, but not without pause. Today the term is concise shorthand for brutish individuals indifferent to aesthetics and artistry, and that’s exactly how I’m using it. But we wouldn’t slur an entire people if they had modern day representation. Even the gypsy moth is being renamed, rightly, so as not to offend a group of people, although the moth can still be slandered with impunity. I’m sure that there were both good and bad Philistines, but because they were completely wiped out over two and half millennia ago and viewed unfavorably in the texts of three major world religions, their name is taken in vain with little or no remorse. In recent decades even our more distant cousin, the Neanderthals, have enjoyed a more rehabilitated image than the Philistines.</i></p>
<p class="tx">The following example contains three parameters; the first two are numbers to be added and the third is the result of the addition. This routine may be short, but due to its complexity, a comment is really needed:</p>
<pre class="pre"><code class="calibre11">rem - Parm 3 is the sum of Parms 1 and 2
 :Add
  set /A %~3 = %~1 + %~2
  goto :eof
</code></pre>
<p class="tx">To the right of the equal sign in the <span class="sans_thesansmonocd_w5regular_">set /A</span> command, the first two parameters are being resolved and added together. To the left of the equal sign—that is, what’s being set—is the cryptic text <span class="sans_thesansmonocd_w5regular_">%~3</span>. A variable name in this area may have been expected, but instead the third parameter is being resolved. The <span class="sans_thesansmonocd_w5regular_">set /A</span> command is in fact setting a named variable to the sum of the two numbers. Most important, that variable name is the third parameter passed into this routine. This technique isn’t difficult, but it’s unintuitive, and it isn’t common in other languages. I’ve seen it flummox many a coder.</p>
<p class="tx">An example of a call to the routine should clarify what’s happening. The following <span class="sans_thesansmonocd_w5regular_">call</span> command passes two numbers and a variable name, where the double quotes are optional:</p>
<pre class="pre"><code class="calibre11">call :Add "7" "8" "sum"</code></pre>
<p class="tx">After this call, the <span class="sans_thesansmonocd_w5regular_">sum</span> variable contains the value of <span class="sans_thesansmonocd_w5regular_">15</span>. I can’t stress enough that with this technique, the calling code defines the name of the variable to be returned. To further make this point, the three calls in this example are done to the same <span class="sans_thesansmonocd_w5regular_">:Add</span> routine:</p>
<pre class="pre"><code class="calibre11">call :Add "5" "8" "sum1"
call :Add "9" "11" "sum2"
call :Add "%sum1%" "%sum2%" "sum4Nbrs"
&gt; con echo The sum of all four numbers is %sum4Nbrs%.
</code></pre>
<p class="tni"><span aria-label=" Page 122. " epub:type="pagebreak" id="pg_122" role="doc-pagebreak"/>The first two have hardcoded numbers, returning the <span class="sans_thesansmonocd_w5regular_">sum1</span> and <span class="sans_thesansmonocd_w5regular_">sum2</span> variables, respectively. Both of those variables are resolved and passed as arguments in the third call, returning <span class="sans_thesansmonocd_w5regular_">sum4Nbrs</span>.</p>
<p class="tx">Notice that <span class="sans_thesansmonocd_w5regular_">sum1</span> and <span class="sans_thesansmonocd_w5regular_">sum2</span> don’t have delimiting percent signs in the first two calls because the variable name is being passed. But in the third call, I’m resolving them because their values are being passed—the same values that were assigned during the first two calls. Finally, the <span class="sans_thesansmonocd_w5regular_">echo</span> command writes this to the console:</p>
<pre class="pre"><code class="calibre11">The sum of all four numbers is 33.</code></pre>
<p class="tx">The same variable used as the output for one call is the input for another, but can the variable be used for both purposes in a single call?</p>
</section>
<section aria-labelledby="sec12" epub:type="division">
<h3 class="h" id="sec12"><span id="h1-83"/><span class="sans_futura_std_bold_b_">One Variable as Input and Output</span></h3>
<p class="tni">A single variable can simultaneously be an input to and an output of a routine or bat file. To set this up, imagine a routine that squares an integer. The first parameter is the input, and the second parameter is the output—simply the input multiplied by itself:</p>
<pre class="pre"><code class="calibre11">:Square
 set /A %~2 = %~1 * %~1
 goto :eof
</code></pre>
<p class="tni">The routine doesn’t show much that we haven’t already discussed, although the input of <span class="sans_thesansmonocd_w5regular_">%~1</span> is used twice. The calling code defines the output variable, which is resolved as <span class="sans_thesansmonocd_w5regular_">%~2</span> in the routine.</p>
<p class="tx">The calling code could use two different variables for the input and output. But suppose that you want to replace a variable’s value with its square. To accomplish this, you could pass its value as the first argument—notice the percent signs encasing it—and pass the name of the variable as the second argument, not encased with percent signs:</p>
<pre class="pre"><code class="calibre11">call :Square %nbr% nbr</code></pre>
<p class="tx">If <span class="sans_thesansmonocd_w5regular_">nbr</span> was set to <span class="sans_thesansmonocd_w5regular_">5</span> before the call, it’ll be set to <span class="sans_thesansmonocd_w5regular_">25</span> afterward. The <span class="sans_thesansmonocd_w5regular_">:Square</span> routine offers some real flexibility, usable with two different variables or the same one.</p>
<p class="tx">Let’s make one more tweak to this code and write a routine with a single parameter that’s both the input and output. The parameter is a variable containing a number as its value, and the routine replaces that value with its square, which makes calling the routine even easier:</p>
<pre class="pre"><code class="calibre11"><span aria-label=" Page 123. " epub:type="pagebreak" id="pg_123" role="doc-pagebreak"/> call :SquareMe nbr
 &gt; con echo The squared number is %nbr%.
 goto :eof

:SquareMe
 set /A %~1 = !%~1! * !%~1!
 goto :eof
</code></pre>
<p class="tx">First, notice the new routine (or label) name. More important, notice that the routine accepts a single argument, the unresolved variable name of an integer—not the integer value.</p>
<p class="tx">Comparing <span class="sans_thesansmonocd_w5regular_">:SquareMe</span> to the <span class="sans_thesansmonocd_w5regular_">:Square</span> routine, the <span class="sans_thesansmonocd_w5regular_">set /A</span> command has two critical updates. First, instead of multiplying <span class="sans_thesansmonocd_w5regular_">%~1</span> by itself, <span class="sans_thesansmonocd_w5regular_">!%~1!</span> is now each operand. In the prior example, a value was being accepted, but now a variable name is the input, so <span class="sans_thesansmonocd_w5regular_">%~1</span> resolves to the variable name, and with the use of delayed expansion, the exclamation marks resolve that name to the integer value. (Have I yet mentioned the true awesomeness of delayed expansion? The applications are limited only by your imagination.)</p>
<p class="tx">The second change is that the product is being assigned to the first parameter, <span class="sans_thesansmonocd_w5regular_">%~1</span>, and not the second, <span class="sans_thesansmonocd_w5regular_">%~2</span>. Remember that in <span class="sans_thesansmonocd_w5regular_">:SquareMe</span> the sole parameter is now the variable name. The result is that a call to this routine changes the value of the variable even though that variable isn’t explicitly mentioned in the routine.</p>
<blockquote class="calibre8">
<p class="warning"><span class="sans_dogma_ot_bold_b_1">NOTE</span></p>
</blockquote>
<p class="warning-txt"><i class="calibre6">I’ve demonstrated return parameters with routines, but returning a parameter from a called bat file works virtually the same way. Actually, it works exactly the same way if the called bat file is</i> <span class="copyright_accent">not</span> <i class="calibre6">limiting scope via the setlocal and endlocal commands. If it is limiting scope, there’s a special technique that allows one or more variables to survive the endlocal, and I’ll detail it in <a href="chapter16.xhtml" class="calibre3">Chapter 16</a>.</i></p>
</section>
<section aria-labelledby="sec13" epub:type="division">
<h3 class="h" id="sec13"><span id="h1-84"/><span class="sans_futura_std_bold_b_">Input Parameter Lists of Varying Lengths</span></h3>
<p class="tni">Let’s build more of a real-world routine that uses what we’ve learned so far in this chapter. The following routine accepts a list of one-to-many numbers (no reasonable limit) and returns two variables, one populated with the sum of the inputs and the other populated with the product of the inputs:</p>
<pre class="pre"><code class="calibre11">rem - Parm 1 = Sum of multiple numbers, returned parm
rem - Parm 2 = Product of multiple numbers, returned parm
rem - Parms 3+ = Set of numbers to add and multiply
 :Arithmetic
  set %~1=0
  set %~2=1
 :NextParm
  set /A %~1 += %~3
  set /A %~2 *= %~3
  shift /3
  if "%~3" neq ""  goto :NextParm
  goto :eof
</code></pre>
<p class="tx"><span aria-label=" Page 124. " epub:type="pagebreak" id="pg_124" role="doc-pagebreak"/>Since we don’t know how many input parameters to expect for a given call, we put those at the end of the parameter list, with the output parameters occupying the first two positions. (No one said inputs must come before outputs.) Due to its complexity, the <span class="sans_thesansmonocd_w5regular_">:Arithmetic</span> routine includes much needed comments defining the parameter list.</p>
<p class="tx">The sum, represented as <span class="sans_thesansmonocd_w5regular_">%~1</span> because it doesn’t yet have an actual variable name, is initialized to <span class="sans_thesansmonocd_w5regular_">0</span>. Likewise, the product, <span class="sans_thesansmonocd_w5regular_">%~2</span>, is initialized to <span class="sans_thesansmonocd_w5regular_">1</span>. (For my fellow math geeks, that’s what we respectively call additive and multiplicative unity.) Ignore the second label, <span class="sans_thesansmonocd_w5regular_">:NextParm</span>, for a moment and focus on the two <span class="sans_thesansmonocd_w5regular_">set /A</span> commands that follow. The first command sets the first parameter, the sum, to itself plus the first input number on the list, <span class="sans_thesansmonocd_w5regular_">%~3</span>, which is the third parameter. Similarly, the next command sets the second parameter, the product, to itself multiplied by the first number on the list, again <span class="sans_thesansmonocd_w5regular_">%~3</span>.</p>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">shift</span> command that comes next is crucial. The number of input parameters is unknown, so we want to discard the just used third parameter and shift the parameters that come after it to the left without disturbing the first two, which are also the return parameters in this instance. The <span class="sans_thesansmonocd_w5regular_">/3</span> option accomplishes that seamlessly. Next, we look at the newly minted third parameter to see whether it’s populated. Keep in mind that this was the second input number on the original list or the fourth overall parameter before the shift. If it’s populated, we’ll go back to the <span class="sans_thesansmonocd_w5regular_">:NextParm</span> label that we ignored earlier. Now those two <span class="sans_thesansmonocd_w5regular_">set /A</span> commands add and multiply the second input parameter to the sum and product, respectively.</p>
<p class="tx">This process repeats until the list of numbers, regardless of its length, is exhausted, at which point the conditional clause of the <span class="sans_thesansmonocd_w5regular_">if</span> command is false, allowing control to fall to the trailing <span class="sans_thesansmonocd_w5regular_">goto :eof</span> command and the routine passes back the first two parameters.</p>
<p class="tx">The following code tests the new routine:</p>
<pre class="pre"><code class="calibre11">call :Arithmetic sum product 5 8 9 11
&gt; con echo The sum is %sum%.
&gt; con echo The product is %product%.
</code></pre>
<p class="tni">The resulting text is written to the console:</p>
<pre class="pre"><code class="calibre11">The sum is 33.
The product is 3960.
</code></pre>
<p class="tx">By the way, if this construct looks familiar, that’s because it’s an example of a Batch <span class="sans_thesansmonocd_w5regular_">do...while</span> command from <span class="xref"><a href="chapter9.xhtml" class="calibre3">Chapter 9</a></span>. At least one input parameter is assumed, and the routine performs the arithmetic as long as, or <i class="calibre6">while</i>, more parameters exist.</p>
</section>
<section aria-labelledby="sec14" epub:type="division">
<h3 class="h" id="sec14"><span id="h1-85"/><span class="sans_futura_std_bold_b_">Drag-and-Drop Parameters</span></h3>
<p class="tni">With a few mouse clicks, you can pass the path and name of any file, or multiple files, into a bat file. It’s something that dumbfounded multiple people, <span aria-label=" Page 125. " epub:type="pagebreak" id="pg_125" role="doc-pagebreak"/>including me when I was learning Batch. Simply right-click on any file and select <b class="calibre10">Copy</b>; then right-click on the bat file to execute and select <b class="calibre10">Paste</b>. The bat file executes, with the sole parameter being the path and filename of the copied file (encased in double quotes if the path or filename has embedded spaces). Alternatively, you can select the file, drag, and drop it onto the bat file with the same result.</p>
<p class="tx">This technique works for any number of files. If you copy <i class="calibre6">n</i> files onto your bat file, <i class="calibre6">n</i> space-delimited parameters are passed—each one being a path and filename. The same is true if you drag and drop <i class="calibre6">n</i> files onto your bat file, and it even works for directories.</p>
<p class="tx">At first, the dragging and dropping of files onto a bat file might seem like little more than a Batch parlor trick, but its uses are manifold. You can design a wrapper bat file that processes a single file. Maybe a program is being executed with a file as input; the program might convert the file to a different format or add a trailer record. Maybe the Batch code will simply rename the file or add an extension to the existing filename. What’s important is that the bat file is performing some action on an input file.</p>
<p class="tx">One possible action is to simply copy the input file to another directory. Consider the following two commands that make up the entirety of <i class="calibre6">BackUpOneFile.bat</i>:</p>
<pre class="pre"><code class="calibre11">xcopy %1 D:\Some\Deep\Hard\To\Reach\Folder\ /F /Y
pause
</code></pre>
<p class="tx">The first argument to the <span class="sans_thesansmonocd_w5regular_">xcopy</span> command, which is <span class="sans_thesansmonocd_w5regular_">%1</span>, resolves to the bat file’s first parameter, which will be the path and filename of any file dragged and dropped onto <i class="calibre6">BackUpOneFile.bat</i>. The command copies the input file to the desired target path, some deep hard to reach folder on the <i class="calibre6">D:\</i> drive. (I’m intentionally retaining any encasing double quotes with the <span class="sans_thesansmonocd_w5regular_">%1</span> syntax, instead of <span class="sans_thesansmonocd_w5regular_">%~1</span>, because the <span class="sans_thesansmonocd_w5regular_">xcopy</span> command requires the double quotes if the path or filename have any embedded spaces.) Finally, the <span class="sans_thesansmonocd_w5regular_">pause</span> command simply holds the window open for the user to see the result of the copy.</p>
<p class="tx">Ultimately, if you place <i class="calibre6">BackUpOneFile.bat</i> on the Windows desktop, you can quickly drag and drop any one file onto it, and the bat file will copy the input file to the desired directory without your needing to navigate to that directory.</p>
<p class="tx">In order to pass an argument to a bat file without this drag-and-drop technique, you must enter a <span class="sans_thesansmonocd_w5regular_">call</span> command (into another bat file or at the command prompt) with the input file keyed in as the argument. But with this technique, any user, even noncoders, can easily run the bat file without any input from the keyboard. You can create a Windows shortcut for the bat file located anywhere on the network so as to hide the source Batch code, making it more difficult for a user to accidentally delete or modify it.</p>
<p class="tx">When a path and filename is passed to a bat file as a parameter, Batch offers an easy way to get quite a bit of information about the file, such as the last modified date and time, size, attributes, path, extension, filename, and more. I’ll discuss this in detail after exploring the <span class="sans_thesansmonocd_w5regular_">for</span> command in <span aria-label=" Page 126. " epub:type="pagebreak" id="pg_126" role="doc-pagebreak"/><span class="xref"><a href="chapter17.xhtml" class="calibre3">Chapter 17</a></span>. The <span class="sans_thesansmonocd_w5regular_">for</span> command will also unlock loops, so that if we drag and drop <i class="calibre6">n</i> files onto a bat file, each can be processed sequentially.</p>
</section>
<section aria-labelledby="sec15" epub:type="division">
<h3 class="h" id="sec15"><span id="h1-86"/><span class="sans_futura_std_bold_b_">Summary</span></h3>
<p class="tni">This chapter along with <span class="xref"><a href="chapter8.xhtml" class="calibre3">Chapters 8</a> through <a href="chapter10.xhtml" class="calibre3">10</a></span> have hopefully opened up your Batch universe to far more than a single routineless sequentially executed bat file. In the not-so-distant past, your bat files couldn’t call executables or other bat files, and the interpreter executed each command just once and in order until it found the end of the bat file. But now you have the tools to start building interesting and complex bat files.</p>
<p class="tx">In this chapter, you learned how to pass arguments to bat files and routines and receive them as parameters in the called bat file. I detailed how to delimit the arguments and even how to pass the delimiters themselves as arguments. You also got a glimpse of the hidden parameter, the Yeti of the Batch universe. I demonstrated how to pass back caller-defined variables containing a return value. You may have even learned how to play Mad Libs.</p>
<p class="tx">In the next chapter, I’ll expand that universe even more by introducing various outputs, created by both the interpreter and you. I’ll show you how to capture the output of Batch commands and how to create files of your own.</p>
</section>
</section>
</div></body></html>