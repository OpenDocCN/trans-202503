- en: '[6](nsp-enoka501485-0007.xhtml#rch06)'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '[6](nsp-enoka501485-0007.xhtml#rch06)'
- en: Improving Browsing and Privacy with the Squid Proxy
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Squid 代理提升浏览和隐私保护
- en: '![Chapter opening icon](images/nsp-enoka501485-ct.jpg)'
  id: totrans-2
  prefs: []
  type: TYPE_IMG
  zh: '![章节开头图标](images/nsp-enoka501485-ct.jpg)'
- en: A proxy server acts as an intermediary between you and the internet. When you
    request a web page, the proxy receives the request and then forwards it on to
    the web server (if necessary). A proxy allows you to protect your privacy by obfuscating
    the metadata that is usually available to the services we interact with daily
    on the internet. Proxies also allow the administrator to block access to certain
    content, like social media or online gambling.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 代理服务器充当你与互联网之间的中介。当你请求一个网页时，代理会接收请求并将其转发到 Web 服务器（如果需要）。代理允许你通过模糊化通常可以向我们日常互动的服务提供的元数据，来保护你的隐私。代理还允许管理员屏蔽某些内容，如社交媒体或在线赌博。
- en: This chapter will show you how to install, configure, and use the *Squid proxy*,
    a solution that runs on most operating systems. With Squid, you’ll be able to
    speed up access to websites, enhance your security, and allow or prevent access
    to specific domains or websites. [Chapter 7](nsp-enoka501485-0016.xhtml#ch07)
    covers another proxy solution, Pi-Hole, which offers the same benefits as Squid,
    but additionally blocks ads and prevents other tracking and privacy issues as
    well. Choosing the best proxy for your needs will depend on which you find easier
    to use and which provides you the best user experience.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将向你展示如何安装、配置和使用*Squid 代理*，这是一种可以在大多数操作系统上运行的解决方案。通过使用 Squid，你将能够加速网站访问，增强安全性，并允许或禁止访问特定的域名或网站。[第七章](nsp-enoka501485-0016.xhtml#ch07)介绍了另一种代理解决方案，Pi-Hole，它提供与
    Squid 相同的好处，但额外地能够阻止广告并解决其他追踪和隐私问题。选择最适合你需求的代理，取决于你觉得哪一种更易于使用，以及哪一种提供了最佳的用户体验。
- en: '[Why Use a Proxy?](nsp-enoka501485-0007.xhtml#rah0801)'
  id: totrans-5
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[为什么使用代理？](nsp-enoka501485-0007.xhtml#rah0801)'
- en: Every time you visit a website, your computer makes a request to a web server
    that responds by sending you the information necessary to view the website. The
    communication between your browser and the server may expose your personal information
    (the browser you’re using, your public IP address, and so on) through *metadata*.
    The metadata allows the web server to make guesses about you and your device,
    such as your location, what time of day it is where you are, and your browsing
    habits. For lots of reasons, you might want to keep this information private.
    Additionally, loading web pages and their content consumes bandwidth, so as more
    people use an internet connection, the connection can begin to slow down, negatively
    affecting everyone using it.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 每次你访问一个网站时，你的计算机会向 Web 服务器发送请求，服务器响应并向你提供浏览该网站所需的信息。浏览器与服务器之间的通信可能会通过*元数据*暴露你的个人信息（如你使用的浏览器、你的公共
    IP 地址等）。这些元数据使得 Web 服务器能够推测出你和你的设备的一些信息，例如你的位置、你所在时区的时间以及你的浏览习惯。出于多种原因，你可能希望保持这些信息的隐私性。此外，加载网页及其内容会消耗带宽，因此当越来越多的人使用同一个互联网连接时，连接可能会开始变慢，从而影响到所有使用者。
- en: One great thing about proxies is that they *cache* any traffic that passes through
    them. This means that every time a web page is retrieved, the proxy will keep
    a local copy of that page. The next time someone tries to browse to that site,
    the proxy first checks its cache for a copy, and if it holds a copy, it presents
    that copy to the user rather than sending a request to the web server for a fresh
    copy of the web page. By default, Squid will keep a cached copy of a website for
    a set period before it no longer considers the cache “fresh” and will then retrieve
    the latest version of the page, whether or not the content has changed. This reduces
    the load on the network, the time it takes to load frequently visited sites, and
    the overall amount of bandwidth used, leading to a better experience for everyone
    involved.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 代理的一个伟大之处在于它们会*缓存*所有通过它们的流量。这意味着每次检索网页时，代理会保留该页面的本地副本。下次有人尝试浏览该网站时，代理首先检查其缓存中是否有副本，如果有，它会向用户呈现该副本，而不是向
    Web 服务器发送请求获取页面的新副本。默认情况下，Squid 会将网站的缓存副本保留一段时间，之后当缓存被认为“不再新鲜”时，它会重新获取该页面的最新版本，无论内容是否发生变化。这减少了网络负载、加载频繁访问网站的时间以及总的带宽使用量，从而提高了每个人的体验。
- en: Proxies also reduce the amount of *personally identifiable information (PII)*
    leaked to web servers. PII is any data or information that can be used to identify
    any specific individual (such as you). For example, a proxy can identify itself
    to a web server as any web browser. You might be using Google Chrome, but the
    proxy could present Firefox to the server instead. The proxy can also have a different
    public IP address to hide the one you’re using if it’s located somewhere other
    than where you are (like in the cloud), obscuring your physical location and internet
    service provider.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 代理还减少了向网页服务器泄露的*个人身份信息（PII）*的数量。PII 是任何可以用来识别特定个人（例如你）的数据或信息。例如，代理可以将自己标识为任何网页浏览器，虽然你可能使用的是
    Google Chrome，但代理可以向服务器呈现 Firefox。代理还可以拥有一个不同的公共 IP 地址来隐藏你正在使用的地址，如果它位于你所在的地方以外（例如云端），则能模糊你的物理位置和互联网服务提供商。
- en: Even though it isn’t directly relevant to small network administrators, you
    might be interested to know that commercial organizations often rely on proxies
    (including Squid) for the benefits we’ve already discussed, as well as for content
    delivery, such as streaming audio and video. Content providers, such as Netflix
    and YouTube, strategically place proxy servers globally to keep local copies of
    content. This practice allows users of those services to access the content from
    a source closer to home, rather than all users accessing the content from a single
    location, which would be far less efficient and would result in poor performance
    in a lot of cases.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 即使这与小型网络管理员直接相关性不大，你可能会感兴趣的是，商业组织通常依赖代理（包括 Squid），以便利用我们已经讨论的好处，以及内容交付，如流媒体音频和视频。内容提供商，如
    Netflix 和 YouTube，战略性地在全球范围内部署代理服务器，以保留本地内容副本。这种做法使得这些服务的用户可以从离家更近的地方访问内容，而不是所有用户都从单一位置访问内容，这样会更有效，并且避免在很多情况下出现性能差的问题。
- en: '[#21: Setting Up Squid](nsp-enoka501485-0007.xhtml#rhd0801)'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: '[#21: 配置 Squid](nsp-enoka501485-0007.xhtml#rhd0801)'
- en: 'The Squid web proxy provides all the benefits you just learned about: it reduces
    bandwidth, making surfing the web faster for users. It’s also capable of anonymizing
    your personal information if configured correctly; information about your identity,
    such as where your web requests are coming from or the web browser you’re using,
    can be stripped or changed before traffic is sent to the internet. Many enterprise-grade
    devices use Squid. While you could use many other proxy solutions, such as NGINX,
    Apache Traffic Server, or Forcepoint, Squid is free and open source, so it provides
    greater access to underlying configurations and data than a commercial solution
    might.'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: Squid 网络代理提供了你刚刚学习到的所有好处：它减少了带宽，使用户的上网速度更快。如果配置正确，它还能够匿名化你的个人信息；例如，你的身份信息（如网络请求来自哪里或者你使用的网页浏览器）可以在流量发送到互联网之前被删除或更改。许多企业级设备都使用
    Squid。虽然你也可以使用其他代理解决方案，如 NGINX、Apache Traffic Server 或 Forcepoint，但 Squid 是免费的开源软件，因此相比商业解决方案，它提供了更多对底层配置和数据的访问。
- en: A wealth of information is available online about using Squid to protect and
    enhance your network. You can find more information on Squid proxy configuration
    in the Squid wiki at [https://wiki.squid-cache.org/SquidFaq/](https://wiki.squid-cache.org/SquidFaq/).
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 网上有大量关于使用 Squid 保护和增强网络的信息。你可以在 Squid 的维基上找到更多关于 Squid 代理配置的信息，链接地址是 [https://wiki.squid-cache.org/SquidFaq/](https://wiki.squid-cache.org/SquidFaq/)。
- en: This project will cover the initial installation and configuration of Squid,
    configuring clients in your network to use the proxy, testing the proxy once configured,
    and performing some additional steps to allow or deny access to certain internet
    resources using the proxy.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 本项目将涵盖 Squid 的初始安装和配置，配置你网络中的客户端使用代理，配置完成后测试代理，以及执行一些额外步骤，以通过代理允许或拒绝访问某些互联网资源。
- en: '[Configuring Squid](nsp-enoka501485-0007.xhtml#rbh0801)'
  id: totrans-14
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[配置 Squid](nsp-enoka501485-0007.xhtml#rbh0801)'
- en: 'Create a base Ubuntu server following the steps in [Chapter 1](nsp-enoka501485-0010.xhtml#ch01).
    If you want to hide your location or prefer not to give away your internet service
    provider (in addition to preventing your metadata being recorded), create the
    proxy server in the cloud in a country different from your own. Otherwise, locate
    the proxy server inside your network. Don’t forget to add your new server to your
    network map and asset list you created in previous chapters. Once you’ve done
    so, log in to the server via SSH as a standard, non-root user. To install the
    proxy, use the following command:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 按照[第1章](nsp-enoka501485-0010.xhtml#ch01)中的步骤创建一个基础的Ubuntu服务器。如果你想隐藏自己的位置或不希望泄露你的互联网服务提供商（除了防止记录你的元数据），可以在云端的一个与自己国家不同的国家创建代理服务器。否则，可以将代理服务器部署在你自己的网络内。不要忘记将新服务器添加到你在前几章中创建的网络地图和资产列表中。完成后，通过SSH以标准非root用户登录服务器。要安装代理，使用以下命令：
- en: '[PRE0]'
  id: totrans-16
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The installation should complete in less than a minute. By default, you’ll find
    the configuration file located at */etc/squid/squid.conf*, the logfiles at */var/log/squid/*,
    and the cache data (that is, cached website information) at */var/spool/squid/*.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 安装应该在一分钟内完成。默认情况下，你会找到配置文件位于*/etc/squid/squid.conf*，日志文件位于*/var/log/squid/*，缓存数据（即缓存的网站信息）位于*/var/spool/squid/*。
- en: 'Open the *squid.conf* configuration file with a text editor to familiarize
    yourself with the settings:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 使用文本编辑器打开*squid.conf*配置文件，以熟悉其中的设置：
- en: '[PRE1]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Squid has many possible configurations, so it’s easy to become overwhelmed.
    Notice, though, that many settings aren’t active as they’re commented out by default.
    Let’s start by focusing on the active settings. You can explore other changes
    when your proxy server is functioning as you want it to.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: Squid有许多可能的配置，所以很容易让人感到不知所措。不过请注意，许多设置并未启用，因为它们默认被注释掉了。我们先专注于活动设置。当你的代理服务器按预期工作时，你可以再探索其他更改。
- en: 'Search by pressing CTRL-W; then type your search term and press ENTER to find
    the section marked `Recommended minimum configuration`:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 通过按CTRL-W进行搜索；然后输入搜索词并按ENTER找到标有`Recommended minimum configuration`的部分：
- en: '[PRE2]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: This section details the *access controls lists (ACLs)* that tell Squid which
    endpoints should have permission to access internet resources via the proxy server.
    An ACL is a list of ports, addresses, or resources that you’ve specifically allowed
    or banned from communication within the network.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 本节详细介绍了*访问控制列表（ACLs）*，它告诉Squid哪些端点可以通过代理服务器访问互联网资源。ACL是一个包含你特别允许或禁止在网络中进行通信的端口、地址或资源的列表。
- en: An ACL consists of several elements. First is a unique name, such as `localnet`,
    that identifies a specific ACL. Each named ACL then contains an ACL type (such
    as `src`) followed by a value or list of values, such as IP addresses or port
    numbers. These values can be entered over multiple lines, and Squid will combine
    them into a single list.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 一个ACL由多个元素组成。首先是一个唯一的名称，例如`localnet`，用于标识一个特定的ACL。每个命名的ACL接着包含一个ACL类型（例如`src`），后面跟着一个值或值的列表，如IP地址或端口号。这些值可以跨多行输入，Squid会将它们合并成一个单一的列表。
- en: Keywords like `src` indicate to Squid the direction in which the traffic is
    flowing; `src 10.0.0.0/8`, for example, indicates any traffic coming from an address
    in the *10.0.0.0/8* IP address range to any IP address in any range.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: '`src`这样的关键词告诉Squid流量的流向；例如，`src 10.0.0.0/8`表示来自*10.0.0.0/8* IP地址范围内的任何流量，目的地是任何IP地址的任何范围。'
- en: 'Comment out any lines that don’t apply to your network. For example, if your
    internal IP addresses follow the *10.x.x.x* format, leave the relevant directive
    as is and comment out all other lines beginning with `acl localnet src` by adding
    a `#` at the start of each line:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 注释掉不适用于你网络的任何行。例如，如果你的内部IP地址遵循*10.x.x.x*格式，保留相关指令不变，并通过在每行开头添加`#`来注释掉所有其他以`acl
    localnet src`开头的行：
- en: '`--snip--`'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: '`--snip--`'
- en: '#acl localnet src 0.0.0.1-0.255.255.255  # RFC 1122 "this" network (LAN)'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: '#acl localnet src 0.0.0.1-0.255.255.255  # RFC 1122 "this"网络（LAN）'
- en: acl localnet src 10.0.0.0/8              # RFC 1918 local private network (LAN)
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: acl localnet src 10.0.0.0/8              # RFC 1918本地私有网络（LAN）
- en: '`#`acl localnet src 100.64.0.0/10          # RFC 6598 shared address space
    (CGN)'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '`#`acl localnet src 100.64.0.0/10          # RFC 6598共享地址空间（CGN）'
- en: '`#`acl localnet src 169.254.0.0/16         # RFC 3927 link-local machines'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: '`#`acl localnet src 169.254.0.0/16         # RFC 3927链路本地机器'
- en: '`#`acl localnet src 172.16.0.0/12          # RFC 1918 local private network
    (LAN)'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '`#`acl localnet src 172.16.0.0/12          # RFC 1918本地私有网络（LAN）'
- en: '`#`acl localnet src 192.168.0.0/16         # RFC 1918 local private network
    (LAN)'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '`#`acl localnet src 192.168.0.0/16         # RFC 1918 本地私有网络（LAN）'
- en: '`#`acl localnet src fc00::/7               # RFC 4193 local private network
    range'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: '`#`acl localnet src fc00::/7               # RFC 4193 本地私有网络范围'
- en: '`#`acl localnet src fe80::/10              # RFC 4291 link-local machines'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: '`#`acl localnet src fe80::/10              # RFC 4291 链路本地机器'
- en: '`--snip--`'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: '`--snip--`'
- en: 'The second portion of the recommended minimum configuration section tells Squid
    which ports can send and receive traffic:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 推荐的最小配置部分的第二部分告诉 Squid 哪些端口可以发送和接收流量：
- en: '[PRE3]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Here, `SSL_ports` and `Safe_ports` are ACL names, and the `port` type tells
    Squid to interpret the number that follows as a port number used for communication
    by a specific service (see [Chapter 1](nsp-enoka501485-0010.xhtml#ch01)). The
    `acl SSL_ports port 443` line sets the port your proxy should use for secured,
    filtered tunnels, such as those used for HTTPS traffic. Directives containing
    the label `Safe_ports` determine the ports on which Squid should allow connections.
    If you don’t need a certain protocol or port, comment it out to reduce your attack
    surface. To be prudent, you might keep only ports 80 and 443 and comment out the
    `acl Safe_ports port 1025-65535` line, thereby blocking ports from 1025 through
    65535\. However, doing so may cause some applications or services to malfunction
    if they require other ports. You can use Google and the website or manual for
    a given application to determine what other ports it might need to function correctly.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，`SSL_ports` 和 `Safe_ports` 是 ACL 名称，而 `port` 类型告诉 Squid 将后面的数字解释为特定服务用于通信的端口号（请参见
    [第 1 章](nsp-enoka501485-0010.xhtml#ch01)）。`acl SSL_ports port 443` 行设置了代理用于加密过滤隧道的端口，如
    HTTPS 流量所使用的端口。包含 `Safe_ports` 标签的指令决定了 Squid 应该允许连接的端口。如果您不需要某个协议或端口，可以注释掉以减少攻击面。为了谨慎起见，您可以只保留端口
    80 和 443，并注释掉 `acl Safe_ports port 1025-65535` 行，从而阻止 1025 到 65535 之间的端口。然而，这样做可能会导致某些应用程序或服务无法正常工作，如果它们需要其他端口。您可以使用
    Google 以及给定应用程序的官方网站或手册来确定它可能需要哪些其他端口才能正常运行。
- en: 'A little further in the configuration file, you’ll find directives that enable
    these ACLs:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 在配置文件的稍后部分，您会找到启用这些 ACL 的指令：
- en: '[PRE4]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The `http_access deny !Safe_ports` directive tells Squid to prohibit communication
    between all ports except those listed in the `Safe_ports` list. Likewise, the
    `http_access deny CONNECT !SSL_ports` line tells Squid to prohibit filtered tunnels
    on any port other than the one specified in `SSL_ports`.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: '`http_access deny !Safe_ports` 指令告诉 Squid 禁止除 `Safe_ports` 列表中列出的端口以外的所有端口之间的通信。同样，`http_access
    deny CONNECT !SSL_ports` 行告诉 Squid 禁止在除 `SSL_ports` 中指定的端口之外的任何端口上建立过滤隧道。'
- en: 'The next section of the configuration file relates to your local network as
    opposed to the internet:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 配置文件的下一部分与您的本地网络相关，而不是互联网：
- en: '[PRE5]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Remove the `#` from the `http_access allow localnet` directive to enable the
    `localnet` settings you specified earlier, which allow endpoints on your local
    network to access the internet through your proxy. Finally, `http_access deny`
    `all` ensures the proxy denies all other traffic to keep it from affecting your
    internal network. By denying all traffic that isn’t specifically allowed, you’ll
    protect your network from unwanted traffic, which can include malware.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 删除 `#` 符号以启用之前指定的 `localnet` 设置，该设置允许您本地网络上的终端通过代理访问互联网。最后，`http_access deny`
    `all` 确保代理拒绝所有其他流量，以防影响您的内部网络。通过拒绝所有没有明确允许的流量，您将保护网络免受不必要的流量，包括恶意软件。
- en: 'If you want to change the port on which Squid listens for requests, modify
    the following line in your configuration file:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想更改 Squid 监听请求的端口，请在配置文件中修改以下行：
- en: '[PRE6]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Your devices will use this port to connect to the proxy server so they can send
    requests, receive traffic, and generally browse the internet.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 您的设备将使用此端口连接到代理服务器，以便发送请求、接收流量并浏览互联网。
- en: 'Once you’ve finished your edits, save and close the configuration file. Reload
    the updated Squid configuration using the following command so the changes take
    effect (be aware, though, that reloading the configuration can interrupt any open
    connections):'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 完成编辑后，保存并关闭配置文件。使用以下命令重新加载更新后的 Squid 配置，以使更改生效（请注意，重新加载配置可能会中断任何打开的连接）：
- en: '[PRE7]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'You can now make sure that Squid was able to start successfully and is running
    with the following command:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您可以使用以下命令确认 Squid 是否成功启动并正在运行：
- en: $ `sudo systemctl status squid`
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: $ `sudo systemctl status squid`
- en: squid.service - Squid Web Proxy Server
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: squid.service - Squid Web 代理服务器
- en: 'Loaded: loaded (/lib/systemd/system/squid.service; enabled; vendor preset:
    enabled)'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '已加载: 加载 (/lib/systemd/system/squid.service; 已启用; 供应商预设: 已启用)'
- en: 'Active: active (running); 2min 5s ago'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '活动: active (running); 2分钟5秒前'
- en: '`--snip--`'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '`--snip--`'
- en: 'A green dot before `squid.service` and a status of `active (running)` indicates
    Squid is running as expected. If Squid didn’t start properly due to an error,
    you’ll see a failed message with a red dot before `squid.service`:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 在`squid.service`前有一个绿色点并且状态显示`active (running)`，表示Squid正常运行。如果Squid由于错误未能正确启动，你会看到一个失败的消息，`squid.service`前有一个红点：
- en: $ `sudo systemctl status squid`
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: $ `sudo systemctl status squid`
- en: squid.service - Squid Web Proxy Server
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: squid.service - Squid Web 代理服务器
- en: 'Loaded: loaded (/lib/systemd/system/squid.service; enabled; vendor preset:
    enabled)'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '已加载: 加载 (/lib/systemd/system/squid.service; 已启用; 供应商预设: 已启用)'
- en: 'Active: failed (Result: exit-code); 2min 5s ago'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '活动: 失败 (结果: 退出代码); 2分钟5秒前'
- en: '`--snip--`'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: '`--snip--`'
- en: 'Go back and check your configuration again or validate your configuration file
    using this command:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 返回并再次检查你的配置，或者使用以下命令验证你的配置文件：
- en: $ `squid -k parse`
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: $ `squid -k parse`
- en: '2024/05/06 00:44:06| Processing: acl denylist dstdomain .twitter.com'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: '2024/05/06 00:44:06| 处理: acl 拒绝列表 dstdomain .twitter.com'
- en: '2024/05/06 00:44:06| Processing: http_deny denylist'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: '2024/05/06 00:44:06| 处理: http_deny 拒绝列表'
- en: '2024/05/06 00:44:06| /etc/squid/squid.conf:1406 unrecognized: ''http_deny'''
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '2024/05/06 00:44:06| /etc/squid/squid.conf:1406 无法识别: ''http_deny'''
- en: '2024/05/06 00:44:06| Processing: anonymize_headers deny From Referer Server'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '2024/05/06 00:44:06| 处理: anonymize_headers 拒绝 From Referer Server'
- en: '2024/05/06 00:44:06| /etc/squid/squid.conf:1408 unrecognized: ''anonymize_headers'''
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: '2024/05/06 00:44:06| /etc/squid/squid.conf:1408 无法识别: ''anonymize_headers'''
- en: '2024/05/06 00:44:06| Processing: anonymize_headers deny User-Agent WWW-Authenticate'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: '2024/05/06 00:44:06| 处理: anonymize_headers 拒绝 User-Agent WWW-Authenticate'
- en: '2024/05/06 00:44:06| /etc/squid/squid.conf:1409 unrecognized: ''anonymize_headers'''
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: '2024/05/06 00:44:06| /etc/squid/squid.conf:1409 无法识别: ''anonymize_headers'''
- en: '2024/05/06 00:44:06| Processing: http_access allow localnet'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: '2024/05/06 00:44:06| 处理: http_access 允许 localnet'
- en: '`--snip--`'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: '`--snip--`'
- en: 'This output shows what you’d see if you used the unrecognized directives `http_deny`
    and `anonymize_headers`. When you’ve resolved any errors with the configuration,
    start Squid with the `start` command:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 此输出显示的是如果你使用无法识别的指令`http_deny`和`anonymize_headers`时的情况。当你解决了配置中的任何错误后，使用`start`命令启动Squid：
- en: '[PRE8]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: You’ve now finished the basic Squid proxy configuration.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你已经完成了基本的Squid代理配置。
- en: '[Configuring Devices to Use Squid](nsp-enoka501485-0007.xhtml#rbh0802)'
  id: totrans-77
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[配置设备使用Squid](nsp-enoka501485-0007.xhtml#rbh0802)'
- en: Next, you’ll need to configure the proxy settings on each device that will use
    the proxy. We’ll explain how to configure Windows, macOS, and Linux devices.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，你需要在每个将使用代理的设备上配置代理设置。我们将解释如何配置Windows、macOS和Linux设备。
- en: Windows
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: Windows
- en: 1\. On your Windows host, open the **Windows Settings** dialog.
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1\. 在你的Windows主机上，打开**Windows 设置**对话框。
- en: 2\. In the Find a Setting box, search for *Proxy Settings*.
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2\. 在查找设置框中，搜索*代理设置*。
- en: 3\. Turn on the **Use a Proxy Server** toggle in the Proxy window.
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 3\. 在代理窗口中启用**使用代理服务器**开关。
- en: 4\. Enter your proxy server’s IP address and port—for example, *192.168.1.50:3128*.
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 4\. 输入你的代理服务器的IP地址和端口——例如，*192.168.1.50:3128*。
- en: 5\. Be sure to tick the **Don’t Use the Proxy Server for Local (Intranet) Addresses**
    checkbox.
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 5\. 确保勾选**不为本地（内网）地址使用代理服务器**复选框。
- en: macOS
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: macOS
- en: 1\. Open **System Preferences**.
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1\. 打开**系统偏好设置**。
- en: 2\. Choose **Network** and select your wireless or Ethernet adapter.
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2\. 选择**网络**并选择你的无线或以太网适配器。
- en: 3\. Click **Advanced▸Proxies**.
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 3\. 点击**高级▸代理**。
- en: 4\. Check the box for **Web Proxy (HTTP)**. Enter your proxy server’s IP address
    and port number—for example, *192.168.1.50:3128*. Do this for each of the protocols
    listed, which you configured earlier in your */etc/squid/squid.conf* file.
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 4\. 勾选**Web代理 (HTTP)**框。输入你的代理服务器的IP地址和端口号——例如，*192.168.1.50:3128*。对于之前在*/etc/squid/squid.conf*文件中配置的每个协议都执行此操作。
- en: 5\. Enter your local network into the Bypass Proxy Settings for these Hosts
    & Domains box.
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 5\. 将你的本地网络输入到“为这些主机和域绕过代理设置”框中。
- en: 6\. Click **OK** and then **Apply**.
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 6\. 点击**确定**然后**应用**。
- en: Linux
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: Linux
- en: 1\. On your Linux endpoint, open the **Settings** dialog.
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1\. 在你的Linux端点上，打开**设置**对话框。
- en: 2\. Go to the **Network▸Network Proxy** settings.
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2\. 进入**网络▸网络代理**设置。
- en: 3\. Set the proxy to **Manual** and enter the HTTP Proxy IP address and port
    number—for example, *192.168.1.50:3128*.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 3\. 设置代理为**手动**，并输入HTTP代理的IP地址和端口号——例如，*192.168.1.50:3128*。
- en: 4\. Make sure to enter your local network in the Ignore Hosts box, and then
    close any open settings windows.
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 4\. 确保在忽略主机框中输入你的本地网络，然后关闭任何打开的设置窗口。
- en: '[Testing Squid](nsp-enoka501485-0007.xhtml#rbh0803)'
  id: totrans-97
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[测试 Squid](nsp-enoka501485-0007.xhtml#rbh0803)'
- en: 'With both the Squid server and at least one of your devices configured, make
    sure the device is actually using the proxy and that the proxy functions as expected.
    On the Squid server, use the following command to view the Squid proxy logfile
    as it’s populated:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 在配置好 Squid 服务器并确保至少有一台设备使用代理的情况下，确保设备实际在使用代理，并且代理按预期工作。在 Squid 服务器上，使用以下命令查看
    Squid 代理日志文件的实时更新：
- en: '[PRE9]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Your output will differ depending on the applications you’re using in your network.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 你的输出将根据你在网络中使用的应用程序不同而有所不同。
- en: If you don’t see any output (and your host is unable to browse the internet),
    update your iptables or other firewall rules using the steps in [Chapter 3](nsp-enoka501485-0012.xhtml#ch03)
    to allow traffic to and from the Squid proxy on port 3128 (or whichever port you
    configured Squid to listen on).
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 如果没有任何输出（并且你的主机无法浏览互联网），请按照[第3章](nsp-enoka501485-0012.xhtml#ch03)中的步骤更新你的 iptables
    或其他防火墙规则，以允许流量进出 Squid 代理服务器的 3128 端口（或你配置的 Squid 监听端口）。
- en: 'If you browse to Facebook from a host configured to use your proxy server while
    the `tail` command is running, you should see this request appear in the log as
    multiple requests to Facebook services:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在运行`tail`命令时从配置为使用代理服务器的主机访问 Facebook，你应该能在日志中看到此请求作为多个访问 Facebook 服务的请求：
- en: '`--snip--`'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '`--snip--`'
- en: 1584414232.470     3 192.168.1.51 NONE/503 0 CONNECT `pixel.facebook.com:443`
    - HIER_NONE/- -
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 1584414232.470     3 192.168.1.51 NONE/503 0 CONNECT `pixel.facebook.com:443`
    - HIER_NONE/- -
- en: 1584414237.647     0 192.168.1.51 NONE/503 0 CONNECT `pixel.facebook.com:443`
    - HIER_NONE/- -
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 1584414237.647     0 192.168.1.51 NONE/503 0 CONNECT `pixel.facebook.com:443`
    - HIER_NONE/- -
- en: 1584414242.652     0 192.168.1.51 NONE/503 0 CONNECT `pixel.facebook.com:443`
    - HIER_NONE/- -
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 1584414242.652     0 192.168.1.51 NONE/503 0 CONNECT `pixel.facebook.com:443`
    - HIER_NONE/- -
- en: 1584414247.864 69023 192.168.1.51 TCP_TUNNEL/200 6426 CONNECT `static.xx.fbcdn.net:443`
    - HIER_DIRECT/157.240.8.23 -
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 1584414247.864 69023 192.168.1.51 TCP_TUNNEL/200 6426 CONNECT `static.xx.fbcdn.net:443`
    - HIER_DIRECT/157.240.8.23 -
- en: 1584414248.566     0 192.168.1.51 NONE/503 0 CONNECT `pixel.facebook.com:443`
    - HIER_NONE/- -
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 1584414248.566     0 192.168.1.51 NONE/503 0 CONNECT `pixel.facebook.com:443`
    - HIER_NONE/- -
- en: 1584414254.535     0 192.168.1.51 NONE/503 0 CONNECT `pixel.facebook.com:443`
    - HIER_NONE/- -
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 1584414254.535     0 192.168.1.51 NONE/503 0 CONNECT `pixel.facebook.com:443`
    - HIER_NONE/- -
- en: '`--snip--`'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '`--snip--`'
- en: If not, try restarting the proxy server, your host, or both.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 如果没有，尝试重启代理服务器、主机或两者。
- en: '[Blocking and Allowing Domains](nsp-enoka501485-0007.xhtml#rbh0804)'
  id: totrans-112
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[阻止和允许域名](nsp-enoka501485-0007.xhtml#rbh0804)'
- en: 'Now that your proxy works, you’ll probably want to block (denylist) or allow
    (allowlist) some domains. For example, if you have children, you may want to prevent
    them from visiting distracting or inappropriate websites. To do this, open the
    *squid.conf* file in a text editor:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你的代理服务器正常工作，你可能想要阻止（黑名单）或允许（白名单）一些域名。例如，如果你有孩子，你可能希望防止他们访问分散注意力或不适当的网站。为此，打开
    *squid.conf* 文件并使用文本编辑器编辑：
- en: '[PRE10]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Now, find the comment that reads `INSERT YOUR OWN RULE(S) HERE`. In that section,
    you can define rules (that is, ACLs) of your own. As mentioned, an ACL is made
    up of an ACL name, an ACL type such as `allow` or `deny`, and a list of elements,
    such as IP addresses or domains. Your configuration will consist of one or more
    of these rules, identifying what is and is not allowed through the proxy. (Previously,
    you enabled rules like `http_access allow localnet` and `http_access deny !Safe_ports`
    to use the ACLs from the recommended minimum configuration section.)
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，找到那行注释，内容为 `INSERT YOUR OWN RULE(S) HERE`。在该部分，你可以定义自己的规则（即 ACL）。如前所述，ACL
    由 ACL 名称、如 `allow` 或 `deny` 的 ACL 类型以及 IP 地址或域名等元素列表组成。你的配置将由一个或多个这样的规则组成，标识哪些是允许通过代理的，哪些是不允许的。（之前，你启用了类似
    `http_access allow localnet` 和 `http_access deny !Safe_ports` 这样的规则，以使用推荐的最小配置部分中的
    ACL。）
- en: 'For example, to denylist Facebook, enter the following lines after the `include`
    directive:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，要将 Facebook 加入黑名单，在 `include` 指令后输入以下行：
- en: '[PRE11]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: The `acl` directive at the beginning of the line tells Squid to treat what follows
    as a list of items to either allow or deny. Next, `denylist` is the unique name
    of the list; choose any name you’d like, so long as it consists of alphanumeric
    characters. The `dstdomain` directive indicates that what follows is a list of
    destination domains. The period at the start of a domain indicates to Squid that
    it should denylist the entire domain, including subdomains. For example, [www.facebook.com](http://www.facebook.com)
    is a top-level domain name that might have a subdomain of *campus.facebook.com*
    or *hertz.facebook.com*. If you omit the leading period, Squid will block only
    the parent domain ([facebook.com](http://www.facebook.com)). Finally, the `http_access`
    directive with `deny` and `CONNECT` parameters tells the proxy to forbid connections
    to the domains or URLs specified in the ACL.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 行首的`acl`指令告诉Squid将接下来的内容视为允许或拒绝的项目列表。接下来，`denylist`是该列表的唯一名称；可以选择任何名称，只要它由字母数字字符组成。`dstdomain`指令表示接下来是一个目标域名的列表。域名前的句点告诉Squid应当将整个域名，包括子域名，列入denylist。例如，[www.facebook.com](http://www.facebook.com)是一个顶级域名，可能有子域名如*campus.facebook.com*或*hertz.facebook.com*。如果省略前导句点，Squid将仅阻止父域名（[facebook.com](http://www.facebook.com)）。最后，`http_access`指令与`deny`和`CONNECT`参数一起使用，告诉代理禁止连接到ACL中指定的域名或URL。
- en: 'Save the configuration file and reload Squid to make the change take effect:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 保存配置文件并重新加载Squid以使更改生效：
- en: '[PRE12]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Now, try browsing to [www.facebook.com](http://www.facebook.com) from a host
    configured to use the proxy server. You should see an error page as in [Figure
    6-1](nsp-enoka501485-0015.xhtml#fig0601).
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，尝试从配置为使用代理服务器的主机浏览到[www.facebook.com](http://www.facebook.com)。你应该看到类似于[图6-1](nsp-enoka501485-0015.xhtml#fig0601)的错误页面。
- en: '![The error page states, “This site can’t be reached,” “The web page at https://www.facebook.com/
    might be temporarily down or it may have moved permanently to a new web address,”
    “err_tunnel_connection_failed.”](images/nsp-enoka501485-fig0601.jpg)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
  zh: '![错误页面显示：“此网站无法访问”，“https://www.facebook.com/上的网页可能暂时无法使用，或者它可能已永久移动到新网址”，“err_tunnel_connection_failed。”](images/nsp-enoka501485-fig0601.jpg)'
- en: 'Figure 6-1: Web browser error caused by Squid'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-1：Squid引起的Web浏览器错误
- en: To allow access to Facebook again, either delete or comment out the lines you
    added, save the configuration file, and reload Squid.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 若要重新允许访问Facebook，可以删除或注释掉你所添加的行，保存配置文件并重新加载Squid。
- en: 'You can repeat the process for additional domains by adding them to the same
    denylist ACL:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过将额外的域名添加到相同的denylist ACL中来重复这个过程：
- en: '[PRE13]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Alternatively, you could create separate ACLs for each website or for groups
    or categories of websites as you desire.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 另外，你可以根据需要为每个网站或网站的组或类别创建单独的ACL。
- en: 'Allowlisting works in pretty much the same way; any domains that are added
    to the allowlist will be allowed, but only for users who are authenticated to
    the proxy:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 允许列表的工作方式基本相同；任何添加到允许列表中的域名都会被允许，但仅限于已通过代理认证的用户：
- en: '[PRE14]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'If you add new ACL rules, be aware of where they are located in relation to
    each other in the configuration file. Squid will interpret the ACL rules in the
    order they appear, much like a firewall. If there’s a `deny all` rule at the beginning
    of the list of ACL rules, Squid will interpret this rule first and then ignore
    any further rules in the file. That means you should put any custom rules before
    the following lines:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你添加新的ACL规则，请注意它们在配置文件中彼此的位置。Squid会按照规则出现的顺序解释ACL规则，就像防火墙一样。如果在ACL规则列表的开头有一个`deny
    all`规则，Squid会首先解释此规则，然后忽略文件中的其他规则。这意味着你应该将任何自定义规则放在以下几行之前：
- en: '[PRE15]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '[Protecting Personal Information with Squid](nsp-enoka501485-0007.xhtml#rbh0805)'
  id: totrans-132
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[使用Squid保护个人信息](nsp-enoka501485-0007.xhtml#rbh0805)'
- en: Squid is highly configurable and allows you as the administrator to set how
    much information about your users and their devices you want exposed to the internet.
    By default, there is no anonymization of the traffic that passes from a client
    device through the proxy to the internet.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: Squid具有高度的可配置性，允许你作为管理员设置希望在互联网上暴露多少关于用户及其设备的信息。默认情况下，通过代理从客户端设备传输到互联网的流量不会进行匿名化处理。
- en: 'To prevent anyone outside your network knowing where your traffic is coming
    from (that is, the server information or from which website or resource you may
    have been referred, like Amazon or a blog), use the `request_header_access` directive
    to deny this information:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 为了防止网络外部人员知道你的流量来源（也就是服务器信息，或者你可能被引导到哪个网站或资源，例如 Amazon 或博客），使用 `request_header_access`
    指令来拒绝这些信息：
- en: '[PRE16]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'To further anonymize your traffic, it may be wise to also deny the `User-Agent`,
    `WWW-Authenticate`, and `Link` header values, which may leak additional information
    about your browser or browsing activity:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 为了进一步匿名化你的流量，明智之举是也拒绝 `User-Agent`、`WWW-Authenticate` 和 `Link` 头部信息，这些信息可能会泄露关于你的浏览器或浏览活动的附加信息：
- en: '[PRE17]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Anonymizing your traffic with these options will limit the amount of PII you’re
    sending over the internet, making you more difficult to track and protecting,
    to some extent, your browsing history and habits.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 使用这些选项匿名化你的流量将限制你在互联网上发送的个人身份信息（PII）量，使你更难被追踪，并在一定程度上保护你的浏览历史和习惯。
- en: Note Some websites and services use user agents to determine how to display
    content to users, so be mindful that by removing the header information, you may
    experience content differently.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，某些网站和服务使用用户代理来决定如何向用户展示内容，因此要注意，移除头部信息可能会导致你体验到不同的内容。
- en: '[Disabling Caching for Specific Sites](nsp-enoka501485-0007.xhtml#rbh0806)'
  id: totrans-140
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[禁用特定网站的缓存](nsp-enoka501485-0007.xhtml#rbh0806)'
- en: 'There may be some websites that you don’t want Squid to cache, as you always
    want to retrieve the latest version from the web server rather than the cached
    version from your proxy. This is achieved by denying caching of that site or sites:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 可能有一些你不希望 Squid 缓存的网站，因为你总是希望从 Web 服务器获取最新版本，而不是从代理缓存中获取。可以通过拒绝缓存该网站或多个网站来实现：
- en: '[PRE18]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Remember to add an ACL entry for each website you want to prevent Squid from
    creating and keeping a cached copy.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 记得为每个你希望防止 Squid 创建并保留缓存副本的网站添加 ACL 条目。
- en: '[Squid Proxy Reports](nsp-enoka501485-0007.xhtml#rah0802)'
  id: totrans-144
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[Squid 代理报告](nsp-enoka501485-0007.xhtml#rah0802)'
- en: You may have noticed that the Squid logs can be difficult to read and take some
    getting used to. Third-party solutions are available that make activity reporting
    and reviewing logs easier. One of the simpler solutions is *Squid Analysis Report
    Generator (SARG)*. SARG is a web-based report generator and viewer that allows
    you to view your Squid logs in a browser window, rather than from the terminal.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能已经注意到，Squid 日志可能比较难以阅读，需要一定的适应时间。有一些第三方解决方案可以让活动报告和日志查看变得更加容易。其中一个较为简单的解决方案是
    *Squid 分析报告生成器（SARG）*。SARG 是一个基于 Web 的报告生成器和查看器，可以让你在浏览器窗口中查看 Squid 日志，而不是通过终端查看。
- en: 'On your Squid server, install SARG:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的 Squid 服务器上，安装 SARG：
- en: '[PRE19]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'The SARG report files will be accessed via a web browser, so you also need
    to install a web server. Install Apache:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: SARG 报告文件将通过 Web 浏览器访问，因此你还需要安装一个 Web 服务器。安装 Apache：
- en: '[PRE20]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Next, open the SARG configuration file that should be located at */etc/sarg/sarg.conf*:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，打开应该位于 */etc/sarg/sarg.conf* 的 SARG 配置文件：
- en: '[PRE21]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Find the line that starts with `access_log`, which specifies the Squid access
    log location:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 找到以 `access_log` 开头的行，该行指定了 Squid 访问日志的位置：
- en: '[PRE22]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Then, close the file and use the `find` command to make sure it matches the
    actual location of the logfile:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，关闭文件，并使用 `find` 命令确认它与日志文件的实际位置匹配：
- en: '[PRE23]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Open the file in a text editor and find the output directory tag (the line
    that starts with `output_dir`), comment out the line containing `/var/lib/sarg`,
    and replace it with a line that sets the directory to the Apache web location
    */var/www/html/squid-reports/*:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 在文本编辑器中打开文件，找到输出目录标签（以 `output_dir` 开头的行），注释掉包含 `/var/lib/sarg` 的行，并将其替换为一行，设置目录为
    Apache Web 位置 */var/www/html/squid-reports/*：
- en: '[PRE24]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Save and close the file. Feel free to peruse the other settings if you would
    like.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 保存并关闭文件。如果你愿意，可以浏览其他设置。
- en: 'To generate a SARG report, run the following command on your Squid server:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 要生成 SARG 报告，在你的 Squid 服务器上运行以下命令：
- en: '[PRE25]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'In your web browser, navigate to the reports location on your proxy server:
    *http://<proxy_ip_address>/squid-reports*. You should see a basic website, as
    shown in [Figure 6-2](nsp-enoka501485-0015.xhtml#fig0602).'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的 Web 浏览器中，导航到代理服务器上的报告位置： *http://<proxy_ip_address>/squid-reports*。你应该能看到一个基本的网站，如
    [图 6-2](nsp-enoka501485-0015.xhtml#fig0602) 所示。
- en: '![The SARG website shows a table with the heading “Squid User Access Reports”
    and the following columns: “FILE/PERIOD,” “CREATION DATE,” “USERS,” “BYTES,” and
    “AVERAGE.”](images/nsp-enoka501485-fig0602.jpg)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
  zh: '![SARG网站显示了一个表格，表格标题为“Squid用户访问报告”，列包括：“FILE/PERIOD（文件/时间段）”，“CREATION DATE（创建日期）”，“USERS（用户）”，“BYTES（字节）”和“AVERAGE（平均值）”。](images/nsp-enoka501485-fig0602.jpg)'
- en: 'Figure 6-2: SARG reports summary'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-2：SARG报告摘要
- en: Click the relevant report on the page displayed, and you should see information
    about each user connection through the proxy, how much data was transferred for
    each connection, how long the connection lasted, and a timestamp indicating when
    the connection was established, as shown in [Figure 6-3](nsp-enoka501485-0015.xhtml#fig0603).
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 点击显示页面上的相关报告，您应该会看到有关每个通过代理连接的用户的信息，包括每个连接传输了多少数据，连接持续了多长时间，以及一个时间戳，指示连接建立的时间，如[图6-3](nsp-enoka501485-0015.xhtml#fig0603)所示。
- en: '![Underneath the heading Squid User Access Reports is the following information:
    “Period,” “Sort,” “Top users,” “Top sites,” “Sites & Users,” “Denied accesses.”
    The table below it includes the following columns: “Num,” “USERID,” “CONNECT,”
    “BYTES,” “%BYTES,” “IN-CACHE-OUT,” “ELAPSED TIME,” “MILLISEC,” “%TIME.” Rows directly
    below this state the Total and Average of the “Connect,” “Bytes,” “In-Cache-Out,”
    “Elapsed Time,” and “Millisec” sections.](images/nsp-enoka501485-fig0603.jpg)'
  id: totrans-165
  prefs: []
  type: TYPE_IMG
  zh: '![在标题为“Squid用户访问报告”下，包含以下信息：“Period（时间段）”，“Sort（排序）”，“Top users（前用户）”，“Top
    sites（前站点）”，“Sites & Users（站点与用户）”，“Denied accesses（拒绝的访问）。”下面的表格包含以下列：“Num（编号）”，“USERID（用户ID）”，“CONNECT（连接）”，“BYTES（字节）”，“%BYTES（字节百分比）”，“IN-CACHE-OUT（缓存内外）”，“ELAPSED
    TIME（耗时）”，“MILLISEC（毫秒）”，“%TIME（时间百分比）。”紧接着的行表示“Connect（连接）”，“Bytes（字节）”，“In-Cache-Out（缓存内外）”，“Elapsed
    Time（耗时）”，“Millisec（毫秒）”部分的总计和平均值。](images/nsp-enoka501485-fig0603.jpg)'
- en: 'Figure 6-3: SARG report output'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-3：SARG报告输出
- en: The report shows the users, or hosts, that have used the proxy; the level of
    traffic they have sent and received (represented as bytes); and various other
    useful things about the use of the proxy. There are also links included for subreports,
    such as the top sites accessed via the proxy; the sites and users report, which
    lists the sites accessed and a list of the users or hosts that accessed each;
    and any cache or website access that was denied by the proxy based on the rules
    and configuration you provided.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 报告显示了使用代理的用户或主机，他们发送和接收的流量水平（以字节表示）；以及有关代理使用的其他有用信息。报告中还包含了子报告的链接，如通过代理访问的前站点；站点与用户报告，列出每个站点的访问情况以及访问该站点的用户或主机；以及任何根据您提供的规则和配置被代理拒绝的缓存或网站访问。
- en: Try using your new proxy server for a few weeks to see if it helps your bandwidth
    usage and browsing speed. Once you’re comfortable, you could investigate and begin
    experimenting with the proxy’s more advanced features, such as preventing users
    from downloading large files (this might be advisable if your internet service
    provider has data caps and charges for bandwidth).
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 尝试使用您的新代理服务器几个星期，看看它是否有助于改善带宽使用和浏览速度。一旦您感到舒适，您可以调查并开始尝试代理的更多高级功能，例如防止用户下载大文件（如果您的互联网服务提供商有数据限制并且对带宽收费，建议采取此措施）。
- en: '[Summary](nsp-enoka501485-0007.xhtml#rah0803)'
  id: totrans-169
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[总结](nsp-enoka501485-0007.xhtml#rah0803)'
- en: Using a proxy server such as Squid offers you a great deal of control over what’s
    allowed in and out of your network. You’ll be able to control the PII exposed
    from your endpoints, such as the web browser you’re using, to improve your network’s
    online privacy. A proxy server also provides a better overall browsing experience.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 使用像Squid这样的代理服务器，您可以更好地控制网络中允许进出数据的内容。您将能够控制从您的端点（例如您正在使用的网页浏览器）暴露的个人身份信息（PII），从而提高网络的在线隐私保护。代理服务器还提供更好的整体浏览体验。
