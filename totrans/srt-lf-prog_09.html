<html><head></head><body>
<h2 class="h2" id="ch09"><span epub:type="pagebreak" id="page_237"/><strong><span class="big">9</span><br/>THE WEB BROWSER</strong></h2>
<div class="image1"><img src="../images/common.jpg" alt="Image"/></div>
<p class="noindent">You probably don’t think of it this way, but the web browser you use every day is a <em>virtual machine</em>—an abstract computer with an incredibly complicated instruction set implemented entirely in software. In other words, it’s one of those interpreters you learned about in the last chapter.</p>
<p class="indent">In this chapter, you’ll learn about some of the functionality of this virtual machine. You’ll learn about the input language and how it’s interpreted by the browser. Browsers are extremely complicated beasties, however, so I can’t cover every feature.</p>
<p class="indent">One thing that makes browsers interesting to learn about is that, on one hand, they’re big, complex applications, and on the other, they’re software-implemented computers that you can program. Browsers have a <em>developer console</em>, which you can use while playing with the examples from this chapter. This allows you to get a real-time view of how the browser operates.</p>
<p class="indent"><span epub:type="pagebreak" id="page_238"/>Understanding the web browser also teaches us something about system design, which is arguably more important than programming (<a href="ch15.xhtml#ch15">Chapter 15</a> covers system design in more detail). The popularity of the web has turned the browser into a magnet for new features. Many of these features have extended browser functionality in a compatible manner by adding to the original instruction set. Other features have duplicated existing functionality in incompatible ways, the result being that browsers now support multiple instruction sets, and the complete set of features is not available in any of them. It should become clear in this chapter that I’m not thrilled by the latter category of features—those that are merely different instead of adding value.</p>
<p class="indent">For starters, having multiple ways to do things means you as a programmer have a lot more to learn, which isn’t a great use of your time for features that don’t add value. And you need to expend energy choosing which way to do your code. Adding multiple approaches also increases the complexity of programs. Industry statistics show a direct relationship between the amount of code in a program and the number of bugs. Browsers crash often. And, as <a href="ch13.xhtml#ch13">Chapter 13</a> covers in more detail, more complex code is more likely to contain security problems.</p>
<p class="indent">Incompatible ways of doing things makes programmers more prone to errors. It’s like an American driving a car in New Zealand: some of the controls are in different places because New Zealanders drive on the left-hand side of the road. People from countries where you drive on the right are easy to spot, as they turn on their windshield wipers when making a turn. You don’t want to program in an environment that facilitates these sorts of avoidable errors.</p>
<p class="indent">In my opinion, the fact that many of the web standards have become <em>living documents</em> is a clear sign of trouble. If you’re not familiar with that term, I’m referring to online documents that are constantly being updated. Standards exist to provide stability and interoperability. Living documents don’t; at best, they capture a moment in time. It’s difficult to program to constantly changing specifications. In this context, living documents make life easier for a few document creators (because those documents and the software that they reference never have to be “done”) and more difficult for a much larger number of consumers.</p>
<h3 class="h3" id="ch09lev1sec1"><strong>Markup Languages</strong></h3>
<p class="noindent">Had this book been written 15 years earlier, this chapter would have started with an introduction to HTML, the HyperText Markup Language. But, as I’ve already implied, the browser has a lot in common with the Great Pacific Garbage Patch: it keeps getting bigger by attracting features that stick to it. Among these are multiple markup languages, so we’ll begin with an overview of them.</p>
<p class="indent"><em>Markup</em> is a system for annotating or adding marks to text in a way that can be distinguished from that text—like homework that a teacher has written snarky comments in red pencil on.</p>
<p class="indent"><span epub:type="pagebreak" id="page_239"/>Markup languages are not new; they existed long before computers. They were developed as a side effect of the printing press so that authors and editors could describe what they wanted to the “pressmen” who set the type. This useful notion was carried forward when computers automated typesetting. Today’s markup languages are just the latest incarnations of an old idea.</p>
<p class="indent">There are a large number of markup languages. For example, I originally wrote this book in a markup language for typesetting called <code>troff</code>. The source for this paragraph is shown in <a href="ch09.xhtml#ch09list01">Listing 9-1</a>.</p>
<pre>.PP<br/>
There are a large number of markup languages.<br/>
For example, I originally wrote this book in a markup language for<br/>
typesetting, called \fCtroff\fP.<br/>
The source for this paragraph is shown in Listing 9-1.</pre>
<p class="listing" id="ch09list01"><em>Listing 9-1: <span class="codeitalic">troff</span> for the preceding paragraph</em></p>
<p class="indent">As you can see, most of it is just the text, but there are three elements of markup. The <code>.PP</code> tells <code>troff</code> to start a paragraph. The <code>\fC</code> tells <code>troff</code> to push the current font onto a stack and replace it with font <code>C</code>, for Courier. The <code>\fP</code> tells <code>troff</code> to pop the font stack (see “<a href="ch05.xhtml#ch05lev1sec3">Stacks</a>” on <a href="ch05.xhtml#page_122">page 122</a>), which restores the previous font.</p>
<p class="indent">Web pages are regular text files, just like the <code>troff</code> example. You don’t need a fancy program to create them; you can do it in any text editor. As a matter of fact, fancy web page creation programs produce bloated results that you can easily beat by handcrafting them yourself.</p>
<p class="indent">How do you mark up a regular text file when the only tool available is more text? By giving superpowers to some characters, the way Superman has superpowers even though he’s also a mild-mannered reporter. For example, <code>troff</code> gives superpowers to any line that begins with a <code>.</code> or <code>'</code> and to anything that begins with a <code>\</code>.</p>
<p class="indent">IBM rolled its own markup language, called <em>GML</em> (short for <em>Generalized Markup Language</em>, though it’s really named for its developers, Goldfarb, Mosher, and Lorie), which the company used for its ISIL publishing tool. This work was expanded into the <em>Standard Generalized Markup Language (SGML)</em>, which was adopted by the International Standards Organization in the 1980s. SGML was so “generalized” that it’s not clear that anybody was ever able to produce a complete working implementation of the standard.</p>
<p class="indent"><em>eXtensible Markup Language (XML)</em> is a more practical subset of SGML. Support for it was a later addition to browsers.</p>
<p class="indent">HTML and XML both have their roots in SGML. They borrow some of the same syntax but don’t conform to the standard.</p>
<p class="indent">XHTML is a modified form of HTML that conforms to the XML rules.</p>
<h3 class="h3" id="ch09lev1sec2"><strong>Uniform Resource Locators</strong></h3>
<p class="noindent">The first web browser (called WorldWideWeb), invented by English engineer and computer scientist Sir Tim Berners-Lee in 1990, was pretty <span epub:type="pagebreak" id="page_240"/>straightforward in how it worked, as shown in <a href="ch09.xhtml#ch09fig01">Figure 9-1</a>. The browser used a <em>Uniform Resource Locator (URL)</em> to request a document from a server using the HTTP protocol discussed in “<a href="ch06.xhtml#ch06lev3sec4">The World Wide Web</a>” on <a href="ch06.xhtml#page_159">page 159</a>. The server sent the document to the browser, which would display it. The document used to be written in HTML, but now it can be written in a variety of languages.</p>
<div class="image"><a id="ch09fig01"/><img src="../images/09fig01.jpg" alt="Image"/></div>
<p class="figcap"><em>Figure 9-1: Web browser interaction with web server</em></p>
<p class="indent">URLs are text strings that have some structure. Right now we just care about the three parts of that structure shown in <a href="ch09.xhtml#ch09fig02">Figure 9-2</a>.</p>
<div class="image"><a id="ch09fig02"/><img src="../images/09fig02.jpg" alt="Image"/></div>
<p class="figcap"><em>Figure 9-2: Anatomy of a URL</em></p>
<p class="indent">The <em>scheme</em> indicates the communication mechanism—for example, <code>https</code> selects HyperText Transfer Protocol (Secure). The server that we want to communicate with is the <em>host</em>. It can be a numeric internet address (see “<a href="ch06.xhtml#ch06lev3sec2">IP Addresses</a>” on <a href="ch06.xhtml#page_159">page 159</a>) but is most commonly specified as a domain name (see “<a href="ch06.xhtml#ch06lev3sec3">Domain Name System</a>” on <a href="ch06.xhtml#page_159">page 159</a>). The location of the document to be retrieved is the <em>path</em>, which looks just like a filesystem path.</p>
<p class="indent">One of the schemes is <code>file</code>. When it’s used, the host/path portion of the URL is a local filename—the name of a file on the same system on which the browser is running. In other words, the <code>file</code> scheme points to a file on your computer.</p>
<p class="indent">There are an ever-growing number of schemes, such as <code>bitcoin</code> for cryptocurrencies and <code>tv</code> for television broadcasts. These are similar, and in many cases identical, to the protocols that we saw back in “<a href="ch06.xhtml#ch06lev3sec4">The World Wide Web</a>.”</p>
<h3 class="h3" id="ch09lev1sec3"><strong>HTML Documents</strong></h3>
<p class="noindent">As mentioned, the first web pages were documents written in HTML. HTML utilized <em>hypertext</em>—text that links to something else, such as other web pages. Sci-fi buffs can think of it like combining hyperspace with text: you hit a link and, <em>zap</em>, you’re someplace else. Hypertext has been around for quite some time, but the web was its compelling application.</p>
<p class="indent">Take a look at the simple HTML document in <a href="ch09.xhtml#ch09list02">Listing 9-2</a>.</p>
<span epub:type="pagebreak" id="page_241"/>
<pre>&lt;html&gt;<br/>
    &lt;head&gt;<br/>
        &lt;title&gt;<br/>
            My First Web Page<br/>
        &lt;/title&gt;<br/>
    &lt;/head&gt;<br/>
    &lt;body&gt;<br/>
        This is my first web page.<br/>
        &lt;b&gt;<br/>
            &lt;big&gt;<br/>
                Cool!<br/>
            &lt;/big&gt;<br/>
        &lt;/b&gt;<br/>
    &lt;/body&gt;<br/>
&lt;/html&gt;</pre>
<p class="listing" id="ch09list02"><em>Listing 9-2: My First Web Page</em></p>
<p class="indent">Enter the HTML shown in <a href="ch09.xhtml#ch09list02">Listing 9-2</a> into a file and open it in your browser. You should see something like <a href="ch09.xhtml#ch09fig03">Figure 9-3</a>.</p>
<div class="image"><a id="ch09fig03"/><img src="../images/09fig03.jpg" alt="Image"/></div>
<p class="figcap"><em>Figure 9-3: Browser display of My First Web Page</em></p>
<p class="indent">You can see that the display in <a href="ch09.xhtml#ch09fig03">Figure 9-3</a> doesn’t look much like the text in <a href="ch09.xhtml#ch09list02">Listing 9-2</a>. That’s because the less-than sign (<code>&lt;</code>) is a character with superpowers. In this case, it begins an <em>element</em> of markup. You might notice that elements come in pairs; for each start <code>&lt;tag&gt;</code> there is a matching end <code>&lt;/tag&gt;</code>.</p>
<p class="indent">The tag determines how the browser interprets the markup element. Tags are essentially virtual machine instructions. For example, <code>&lt;title&gt;</code> puts its contents—what’s between the start and end tags—into the browser title bar. The <code>&lt;b&gt;</code> and <code>&lt;big&gt;</code> elements make the word “Cool!” bold and big, and it’s part of the <code>&lt;body&gt;</code> of the web page.</p>
<p class="indent">Because the <code>&lt;</code> has superpowers, you may wonder how to use that character without the superpowers—for example, if you wanted to display <code>This is my first web page with a &lt;</code>. HTML includes its own form of kryptonite called an <em>entity reference</em>, which is an alternate form of a character. In this case, the sequence <code>&amp;lt;</code> represents the <code>&lt;</code> character without triggering its superpowers. (Of course, now there’s a new superpowered character <code>&amp;</code>, which can itself be represented using the <code>&amp;amp;</code> sequence.) Using an entity reference, you could type <code>This is my first web page with a &amp;lt;</code> and it would look correct.</p>
<p class="indent">HTML elements aren’t quite as simple. There are a number of random exceptions where end tags are not required, and there’s a <code>&lt;tag/&gt;</code> form for <span epub:type="pagebreak" id="page_242"/>elements with no content. XHTML eliminates these exceptions. The only complication that we care about here is <em>attributes</em>, which are optional sets of name/value pairs, as shown in <a href="ch09.xhtml#ch09list03">Listing 9-3</a>.</p>
<pre>&lt;tag name1="value1" name2="value2" ...&gt;<br/>
    element content<br/>
&lt;/tag&gt;</pre>
<p class="listing" id="ch09list03"><em>Listing 9-3: HTML elements with attributes</em></p>
<p class="indent">Some attribute <code>names</code> have predefined behaviors; you can include arbitrary attributes for any that aren’t predefined. Attribute values are treated identically, with the exception of <code>class</code>, whose value is treated as a space-separated list of values.</p>
<h3 class="h3" id="ch09lev1sec4"><strong>The Document Object Model</strong></h3>
<p class="noindent">Web browsers process documents according to the <em>Document Object Model (DOM)</em>. You can think of a web page as a series of elements that enclose other elements as illustrated by the indentation in the <a href="ch09.xhtml#ch09list02">Listing 9-2</a> HTML. <a href="ch09.xhtml#ch09fig04">Figure 9-4</a>, which looks sort of like an aerial cutaway view of a twisted <em>matryoshka</em> (Russian nesting) doll, shows what this structure looks like for the code in <a href="ch09.xhtml#ch09list02">Listing 9-2</a>.</p>
<div class="image"><a id="ch09fig04"/><img src="../images/09fig04.jpg" alt="Image"/></div>
<p class="figcap"><em>Figure 9-4: Nested elements in an HTML document</em></p>
<p class="indent">Let’s grab that picture by the edge of the HTML and tilt it so that all of the innards hang out the bottom, as shown in <a href="ch09.xhtml#ch09fig05">Figure 9-5</a>.</p>
<p class="indent">Look familiar? It’s our old friend, the directed acyclic graph, or DAG (from “<a href="ch05.xhtml#ch05lev1sec3">Stacks</a>” on <a href="ch05.xhtml#page_122">page 122</a>), and a tree structure too (see “<a href="ch07.xhtml#ch07lev1sec11">Hierarchical Data Structures</a>” on <a href="ch07.xhtml#page_199">page 199</a>). Not only that, but the HTML can be processed using techniques from <a href="ch08.xhtml#ch08">Chapter 8</a> and the result is a parse tree (see “<a href="ch08.xhtml#ch08lev1sec7">Parse Trees</a>” on <a href="ch08.xhtml#page_228">page 228</a>).</p>
<span epub:type="pagebreak" id="page_243"/>
<div class="image"><a id="ch09fig05"/><img src="../images/09fig05.jpg" alt="Image"/></div>
<p class="figcap"><em>Figure 9-5: HTML document as a tree structure</em></p>
<h4 class="h4" id="ch09lev2sec1"><strong><em>Tree Lexicon</em></strong></h4>
<p class="noindent">Tree structures like the DOM are so common that an entire lexicon has developed around them. The examples in <a href="ch09.xhtml#ch09tab01">Table 9-1</a> are taken from <a href="ch09.xhtml#ch09fig05">Figure 9-5</a>.</p>
<p class="tabcap" id="ch09tab01"><strong>Table 9-1:</strong> Tree Lexicon</p>
<table class="topbot-d">
<colgroup>
<col style="width:20%"/>
<col style="width:40%"/>
<col style="width:40%"/>
</colgroup>
<thead>
<tr>
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Term</strong></p></td>
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Definition</strong></p></td>
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Example</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-v"><p class="taba">Node</p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">An element in the tree</p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba"><code>html</code>, <code>head</code>, <code>body</code></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba">Interior node</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">An element in the tree that has arrows entering and leaving</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba"><code>title</code></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-v"><p class="taba">Terminal node</p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">An element in the tree that has no arrows leaving it</p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba"><code>Cool!</code></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba">Root</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">The top of the tree</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba"><code>html</code></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-v"><p class="taba">Parent</p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">A node whose arrow points directly to another node</p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba"><code>html</code> is the parent of <code>head</code> and <code>body</code></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba">Child</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">A node directly pointed to by another node</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba"><code>head</code> and <code>body</code> are children of <code>html</code></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-v"><p class="taba">Descendant</p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">A node directly or indirectly pointed to by another node</p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba"><code>title</code> is a descendent of <code>html</code></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba">Ancestor</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">A node that directly or indirectly points to a node</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba"><code>body</code> is an ancestor of <code>big</code></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-va"><p class="taba">Sibling</p></td>
<td style="vertical-align: top;" class="table-va"><p class="taba">A node with a common parent</p></td>
<td style="vertical-align: top;" class="table-va"><p class="taba"><code>head</code> is a sibling of <code>body</code></p></td>
</tr>
</tbody>
</table>
<p class="indent">Nodes in a tree are ordered. For example, <code>head</code> is the first child of <code>html</code>, and <code>body</code> is the second and also last child of <code>html</code>.</p>
<h4 class="h4" id="ch09lev2sec2"><span epub:type="pagebreak" id="page_244"/><strong><em>Interpreting the DOM</em></strong></h4>
<p class="noindent">What does a browser do with a document tree? Although it’s possible that someone could build a piece of computing hardware with instructions corresponding to the HTML elements, nobody has done so yet. That rules out compiling the DOM parse tree into machine language. The other choice is to interpret it using <em>depth-first traversal</em>, as shown in <a href="ch09.xhtml#ch09fig06">Figure 9-6</a>.</p>
<div class="image"><a id="ch09fig06"/><img src="../images/09fig06.jpg" alt="Image"/></div>
<p class="figcap"><em>Figure 9-6: HTML document traversal order</em></p>
<p class="indent">As you can see, the browser starts at the root, descends to the first child, then to its first child, and so on until it hits a terminal node. It then goes up to the closest ancestor that has another child and does the same thing from there, and so on until every node in the tree is visited. Note that the ordering follows the way in which the HTML is written. Depth-first traversal is yet another application of stacks.</p>
<h3 class="h3" id="ch09lev1sec5"><strong>Cascading Style Sheets</strong></h3>
<p class="noindent">An original idea behind HTML was that authors wrote web pages and browsers figured out how to display them. This made sense because there was no way for the author to know things like the size of a browser’s window, the screen resolution, or the number of available colors and fonts.</p>
<p class="indent">Once the web became popular, the marketing types got their hands on it. Glitz became important. All sorts of stuff got added (mostly via the creation of a new CSS specification) to allow authors to finely control how their pages are displayed. Of course, this is exactly the opposite of the original intent. The result is messy.</p>
<p class="indent">HTML web pages originally included styling information. For example, the <code>font</code> element that selected a text font had a <code>size</code> attribute that controlled <span epub:type="pagebreak" id="page_245"/>the size. This approach didn’t work as well when pages were displayed on a diverse set of devices from desktops to cell phones. <em>Cascading Style Sheets (CSS)</em> separates the styling from the HTML so that the HTML can be written once and have different styles applied depending on the target device.</p>
<p class="indent"><a href="ch09.xhtml#ch09fig07">Figure 9-7</a> shows a data structure that could be used to represent an HTML element in memory.</p>
<div class="image"><a id="ch09fig07"/><img src="../images/09fig07.jpg" alt="Image"/></div>
<p class="figcap"><em>Figure 9-7: HTML element data structure</em></p>
<p class="indent">This diagram looks really complicated, but it simply glues together a few things you’ve already learned about. There’s a compound data type (see “<a href="ch07.xhtml#ch07lev1sec5">Compound Data Types</a>” on <a href="ch07.xhtml#page_189">page 189</a>) for elements and another for attributes. The attributes are organized as a singly linked list (see “<a href="ch07.xhtml#ch07lev1sec6">Singly Linked Lists</a>” on <a href="ch07.xhtml#page_191">page 191</a>). Elements are arranged in a tree (see “<a href="ch07.xhtml#ch07lev1sec11">Hierarchical Data Structures</a>” on <a href="ch07.xhtml#page_199">page 199</a>). Because there are an arbitrary number of children whose ordering matters, they’re organized using a doubly linked list (see “<a href="ch07.xhtml#ch07lev1sec10">Doubly Linked Lists</a>” on <a href="ch07.xhtml#page_198">page 198</a>).</p>
<p class="indent">This organization matters because CSS uses a variation of regular expressions (see “<a href="ch08.xhtml#ch08lev2sec2">Regular Expressions</a>” on <a href="ch08.xhtml#page_224">page 224</a>) called <em>selectors</em> to locate elements in the DOM, similar to how <code>yacc</code> matches tokens on a stack. CSS then allows attributes to be associated with the selected elements. This enables a web page designer, for example, to change the text size depending on the target device or to collapse a side menu into a drop-down menu for devices with smaller screens.</p>
<p class="indent">CSS muddies up the terminology. It defines a large number of <em>properties</em>—things like color, font size, and so on. Once these properties are associated with a DOM element, they’re called <em>attributes</em>.</p>
<p class="indent"><a href="ch09.xhtml#ch09tab02">Table 9-2</a> shows some of the CSS selectors. Originally there were only a few, but new ones are being added at an alarming rate.</p>
<span epub:type="pagebreak" id="page_246"/>
<p class="tabcap" id="ch09tab02"><strong>Table 9-2:</strong> CSS Selectors</p>
<table class="topbot-d">
<colgroup>
<col style="width:30%"/>
<col style="width:70%"/>
</colgroup>
<thead>
<tr>
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Pattern</strong></p></td>
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Meaning</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-v"><p class="taba"><code>*</code></p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">Matches any element</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba"><code>E</code></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">Matches any element of type <code>E</code> (that is, <code>&lt;E&gt;</code>...<code>&lt;/E&gt;</code>)</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-v"><p class="taba"><code>F</code></p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">Matches any element of type <code>F</code> (that is, <code>&lt;F&gt;</code>...<code>&lt;/F&gt;</code>)</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba"><code>E F</code></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">Matches any element <code>F</code> that is a descendent of an <code>E</code> element</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-v"><p class="taba"><code>E &gt; F</code></p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">Matches any element <code>F</code> that is a child of an <code>E</code> element</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba"><code>E + F</code></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">Matches any element <code>F</code> with an immediate sibling element <code>E</code></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-v"><p class="taba"><code>E - F</code></p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">Matches any element <code>F</code> preceded by any sibling element <code>E</code></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba"><code>E[name]</code></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">Matches any element <code>E</code> that has attribute <code>name</code></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-v"><p class="taba"><code>E[name=value]</code></p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">Matches any element <code>E</code> that has attribute <code>name</code> with <code>value</code></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba"><code>E[name~="value"]</code></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">Matches any <code>E</code> element whose <code>name</code> attribute is a space-separated list of words, one of which matches <code>value</code></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-v"><p class="taba"><code>E#id</code></p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">Matches any <code>E</code> element that has an ID attribute with a value of <code>id</code></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba"><code>E.class</code></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">Matches any <code>E</code> element that has a class attribute with a value of <code>class</code></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-v"><p class="taba"><code>E:first-child</code></p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">Matches element <code>E</code> if it is the first child of its parent</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba"><code>E:last-child</code></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">Matches element <code>E</code> if it is the last child of its parent</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-v"><p class="taba"><code>E:</code><span class="codeitalic">n</span><code>th-child(</code><span class="codeitalic">n</span><code>)</code></p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">Matches element <code>E</code> if it is the <em>n</em>th child of its parent</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba"><code>E:empty</code></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">Matches element <code>E</code> if it has no children</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-v"><p class="taba"><code>E:link</code></p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">Matches element <code>E</code> if it is a hyperlink anchor such as <code>&lt;a&gt;</code></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba"><code>E:visited</code></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">Matches element <code>E</code> if it is a hyperlink anchor such as <code>&lt;a&gt;</code> that has been visited</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-v"><p class="taba"><code>E:hover</code></p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">Matches element <code>E</code> when the mouse hovers over it</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba"><code>E:active</code></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">Matches element <code>E</code> on which the mouse is down</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-va"><p class="taba"><code>E:focus</code></p></td>
<td style="vertical-align: top;" class="table-va"><p class="taba">Matches element <code>E</code> if it has the input focus, meaning that it’s listening to the keyboard</p></td>
</tr>
</tbody>
</table>
<p class="indent">HTML includes a <code>&lt;link&gt;</code> element that can be used to associate a separate file containing CSS with a web page. That’s the preferred usage because it conforms to the principle of keeping the content separate from the styling. But that’s overkill for what we’re doing here. HTML also includes a <code>&lt;style&gt;</code> element that allows CSS to be embedded directly in HTML documents. That’s what we’ll use for our examples.</p>
<p class="indent">Let’s modify our web page from <a href="ch09.xhtml#ch09list01">Listing 9-1</a> to include some simple styling, which is shown in <span class="codestrong">bold</span> in <a href="ch09.xhtml#ch09list04">Listing 9-4</a>.</p>
<pre>&lt;html&gt;<br/>
    &lt;head&gt;<br/>
        &lt;title&gt;<br/>
            My First Web Page<br/>
        &lt;/title&gt;<br/>
        <span class="codestrong1">&lt;style&gt;</span><br/>
<span epub:type="pagebreak" id="page_247"/>            <span class="codestrong1">body {</span><br/>
                <span class="codestrong1">color:     blue;</span><br/>
            <span class="codestrong1">}</span><br/>
            <span class="codestrong1">big {</span><br/>
                <span class="codestrong1">color:     yellow;</span><br/>
                <span class="codestrong1">font-size: 200%;</span><br/>
            <span class="codestrong1">}</span><br/>
        <span class="codestrong1">&lt;/style&gt;</span><br/>
    &lt;/head&gt;<br/>
    &lt;body&gt;<br/>
        This is my first web page.<br/>
        &lt;b&gt;<br/>
            &lt;big&gt;<br/>
                Cool!<br/>
            &lt;/big&gt;<br/>
        &lt;/b&gt;<br/>
    &lt;/body&gt;<br/>
&lt;/html&gt;</pre>
<p class="listing" id="ch09list04"><em>Listing 9-4: Web page with embedded CSS</em></p>
<p class="indent">You can see that there are two selectors in <a href="ch09.xhtml#ch09list04">Listing 9-4</a>: <code>body</code> and <code>big</code>. Each selector is followed by a list of property names and values; a colon separates each name from its value, there is a semicolon after the value, and the list of names and values for each selector is enclosed in curly brackets. First, we set the <code>color</code> of all text in the document body to <code>blue</code>. Next, we set the <code>color</code> of the text inside the <code>&lt;big&gt;</code> element to <code>yellow</code>, and we set the <code>font-size</code> to <code>200%</code> of normal. Give it a try!</p>
<p class="indent">CSS was an afterthought; nobody had it in mind when developing HTML. There are some quirks as a result. HTML has all sorts of elements with defined meanings. For example, there is a <code>&lt;b&gt;</code> element that makes text <strong>bold</strong> and a <code>&lt;i&gt;</code> element for <em>italics</em>. But the CSS snippet in <a href="ch09.xhtml#ch09list05">Listing 9-5</a> changes their meanings to be the opposite.</p>
<pre>b {<br/>
    font-style:  italic;<br/>
    font-weight: normal;<br/>
}<br/>
i {<br/>
    font-style:  normal;<br/>
    font-weight: bold;<br/>
}</pre>
<p class="listing" id="ch09list05"><em>Listing 9-5: Swapping bold and italic using CSS</em></p>
<p class="indent">For all intents and purposes, CSS eliminates the distinction between many HTML elements. You can think of HTML elements as having a default set of styles, but once those styles are changed via CSS, the element name may no longer have any relation to to its original purpose.</p>
<p class="indent">CSS originally just provided a more flexible mechanism for attaching attributes to elements, but then it started adding new attributes. These new attributes were not retrofitted into HTML. As a result, some attributes <span epub:type="pagebreak" id="page_248"/>can be specified in both HTML and CSS, and others only in CSS. There’s a bit of an attitude among the programming community that the old way should no longer be used, but that ignores the issues of maintaining existing code.</p>
<h3 class="h3" id="ch09lev1sec6"><strong>XML and Friends</strong></h3>
<p class="noindent">XML looks a lot like HTML. However, like SGML it requires <em>well-formed</em> elements. This means that each <code>&lt;tag&gt;</code> must have a matching <code>&lt;/tag&gt;</code>. Implicit end tags are not permitted. The big distinction between HTML and XML is that HTML was created for a specific application: web pages. XML is a general-purpose markup language that can be used for many different applications.</p>
<p class="indent">Most XML tags don’t have preassigned meanings. You can assign any meaning to them that you want. XML provides structure you can use to create your own application-specific markup languages. For example, suppose you want to keep track of vegetables in your garden. You could create a Vegetable Markup Language (VML) that looks like <a href="ch09.xhtml#ch09list06">Listing 9-6</a>.</p>
<pre>&lt;xml&gt;<br/>
    &lt;garden&gt;<br/>
        &lt;vegetable&gt;<br/>
            &lt;name&gt;tomato&lt;/name&gt;<br/>
            &lt;variety&gt;Cherokee Purple&lt;/variety&gt;<br/>
            &lt;days-until-maturity&gt;80&lt;/days-until-maturity&gt;<br/>
        &lt;/vegetable&gt;<br/>
        &lt;vegetable&gt;<br/>
            &lt;name&gt;rutabaga&lt;/name&gt;<br/>
            &lt;variety&gt;American Purple Top&lt;/variety&gt;<br/>
            &lt;days-until-maturity&gt;90&lt;/days-until-maturity&gt;<br/>
        &lt;/vegetable&gt;<br/>
        &lt;vegetable&gt;<br/>
            &lt;name&gt;rutabaga&lt;/name&gt;<br/>
            &lt;variety&gt;Helenor&lt;/variety&gt;<br/>
            &lt;days-until-maturity&gt;100&lt;/days-until-maturity&gt;<br/>
        &lt;/vegetable&gt;<br/>
        &lt;vegetable&gt;<br/>
            &lt;name&gt;rutabaga&lt;/name&gt;<br/>
            &lt;variety&gt;White Ball&lt;/variety&gt;<br/>
            &lt;days-until-maturity&gt;75&lt;/days-until-maturity&gt;<br/>
        &lt;/vegetable&gt;<br/>
        &lt;vegetable&gt;<br/>
            &lt;name&gt;rutabaga&lt;/name&gt;<br/>
            &lt;variety&gt;Purple Top White Globe&lt;/variety&gt;<br/>
            &lt;days-until-maturity&gt;45&lt;/days-until-maturity&gt;<br/>
            &lt;/vegetable&gt;<br/>
    &lt;/garden&gt;<br/>
&lt;/xml&gt;</pre>
<p class="listing" id="ch09list06"><em>Listing 9-6: XML-based markup language example</em></p>
<p class="indent"><span epub:type="pagebreak" id="page_249"/>Conflicts can arise from allowing people to create their own markup languages, however. For example, suppose that in addition to VML, someone else creates a Recipe Markup Language (RML) that also includes a <code>&lt;name&gt;</code> element, as in <a href="ch09.xhtml#ch09list07">Listing 9-7</a>.</p>
<pre>&lt;xml&gt;<br/>
    &lt;garden&gt;<br/>
        &lt;vegetable&gt;<br/>
            &lt;name&gt;tomato&lt;/name&gt;<br/>
            &lt;variety&gt;Cherokee Purple&lt;/variety&gt;<br/>
            &lt;days-until-maturity&gt;80&lt;/days-until-maturity&gt;<br/>
            &lt;name&gt;Purple Tomato Salad&lt;/name&gt;<br/>
        &lt;/vegetable&gt;<br/>
    &lt;/garden&gt;<br/>
&lt;/xml&gt;</pre>
<p class="listing" id="ch09list07"><em>Listing 9-7: XML-based markup language example with name conflict</em></p>
<p class="indent">There is no way to tell whether the <code>&lt;name&gt;</code> elements are vegetable names or recipe names. We need a mechanism to allow us to combine VML and RML without confusing the <code>&lt;name&gt;</code> elements. This mechanism is an element tag prefix known as a <em>namespace</em>.</p>
<p class="indent">As you’d expect from something browser related, there are multiple ways to specify namespaces, but I cover only one of them here. Each namespace is associated with a URL, although there’s no requirement that it be a valid URL; it just has to be distinct from the others. The <code>xmlns</code> attribute on the <code>&lt;xml&gt;</code> element associates a namespace prefix with a URL. <a href="ch09.xhtml#ch09list08">Listing 9-8</a> shows our combined garden and recipe markups with distinguishing namespaces.</p>
<pre>&lt;xml  &gt;<br/>
    &lt;vml:garden&gt;<br/>
        &lt;vml:vegetable&gt;<br/>
            &lt;vml:name&gt;tomato&lt;/vml:name&gt;<br/>
            &lt;vml:variety&gt;Cherokee Purple&lt;/vml:variety&gt;<br/>
            &lt;vml:days-until-maturity&gt;80&lt;/vml:days-until-maturity&gt;<br/>
            &lt;rml:name&gt;Purple Tomato Salad&lt;/rml:name&gt;<br/>
        &lt;/vml:vegetable&gt;<br/>
    &lt;/vml:garden&gt;<br/>
&lt;/xml&gt;</pre>
<p class="listing" id="ch09list08"><em>Listing 9-8: XML-based markup language example with namespaces</em></p>
<p class="indent">You can see that the elements from both fictitious markup languages are combined and that they are distinguished by prefix. The namespace prefix is arbitrary and left up to whatever is combining the different markup languages together. There’s no requirement that <code>rml</code> be the prefix for the Recipe Markup Language; we could choose <code>recipe</code> if we needed to combine this code with another RML, such as Ridiculous Markup Language.</p>
<p class="indent">Plenty of tools are available to help you write applications that understand custom markup languages such as the ones just described. There are also libraries for many programming languages that create and operate on parse trees from XML documents.</p>
<p class="indent"><span epub:type="pagebreak" id="page_250"/>One tool is a <em>Document Type Definition (DTD)</em>. You can think of this as meta-markup. A DTD is an XML-looking document (there are no ending tags for some reason) that defines the legal elements in a markup language. XML includes a mechanism that allows an XML document to reference a DTD. You could, for example, make a DTD that says that one or more <code>&lt;vegetable&gt;</code> elements are allowed in a <code>&lt;garden&gt;</code> element and that a <code>&lt;vegetable&gt;</code> can contain only <code>&lt;name&gt;</code>, <code>&lt;variety&gt;</code>, and <code>&lt;days-until-maturity&gt;</code> elements. XML parsers can validate the XML against the DTD. Although this is useful, it doesn’t do the most important part. For example, although a DTD can ensure that a required <code>&lt;variety&gt;</code> exists, it can’t test for a valid variety.</p>
<p class="indent">The <em>XML Path Language (XPath)</em> provides selectors for XML documents by, as you might guess, creating yet another incompatible syntax; it has essentially the same functionality of CSS selectors but in a completely different syntax that you may need to learn. XPath isn’t very useful by itself but is an important component of <em>Xtensible Stylesheet Language Transformations (XSLT)</em>.</p>
<p class="indent">XSLT is yet another XML-based language. When combined with XPath, it allows you to write a piece of XML that transforms an XML document into other forms by searching and modifying the parse tree. <a href="ch09.xhtml#ch09list09">Listing 9-9</a> shows a simple example where an XPath expression is used to match any vegetable in the garden and then output the name and variety of each, separated by a space.</p>
<pre>&lt;xsl:stylesheet  version="1.0"&gt;<br/>
    &lt;xsl:template match="/garden/vegetable"&gt;<br/>
        &lt;xsl:value-of select="variety"/&gt;<br/>
        &lt;xsl:text&gt; &lt;/xsl:text&gt;<br/>
        &lt;xsl:value-of select="name"/&gt;<br/>
    &lt;/xsl:template&gt;<br/>
&lt;/xsl:stylesheet&gt;</pre>
<p class="listing" id="ch09list09"><em>Listing 9-9: Call any vegetable using XSLT and XPath</em></p>
<p class="indent">Applying the XSLT in <a href="ch09.xhtml#ch09list09">Listing 9-9</a> to the XML in <a href="ch09.xhtml#ch09list06">Listing 9-6</a> produces the results in <a href="ch09.xhtml#ch09list10">Listing 9-10</a>.</p>
<pre>Cherokee Purple tomato<br/>
American Purple Top rutabaga<br/>
Helenor rutabaga<br/>
White Ball rutabaga<br/>
Purple Top White Globe rutabaga</pre>
<p class="listing" id="ch09list10"><em>Listing 9-10: Call any vegetable results</em></p>
<p class="indent">Another example is shown in <a href="ch09.xhtml#ch09list11">Listing 9-11</a>, which selects only vegetables when the value of the name is <code>rutabaga</code>.</p>
<pre>&lt;xsl:stylesheet  version="1.0"&gt;<br/>
    &lt;xsl:template match="/garden/vegetable[name/text()='rutabaga']"&gt;<br/>
        &lt;xsl:value-of select="name"/&gt;<br/>
        &lt;xsl:text&gt; &lt;/xsl:text&gt;<br/>
    &lt;/xsl:template&gt;<br/>
<span epub:type="pagebreak" id="page_251"/>    &lt;xsl:template match="text()"/&gt;<br/>
&lt;/xsl:stylesheet&gt;</pre>
<p class="listing" id="ch09list11"><em>Listing 9-11: Call it by name</em></p>
<p class="indent">Applying the XSLT from <a href="ch09.xhtml#ch09list11">Listing 9-11</a> to the XML in <a href="ch09.xhtml#ch09list06">Listing 9-6</a> produces what you see in <a href="ch09.xhtml#ch09list12">Listing 9-12</a>.</p>
<pre>rutabaga rutabaga rutabaga rutabaga</pre>
<p class="listing" id="ch09list12"><em>Listing 9-12: Call it by name results</em></p>
<p class="indent">XSLT is especially useful for transforming markup containing arbitrary data into HTML for display in a browser.</p>
<h3 class="h3" id="ch09lev1sec7"><strong>JavaScript</strong></h3>
<p class="noindent">Our example web page is static—that is, all it does is display some formatted text. Going back to <a href="ch09.xhtml#ch09fig01">Figure 9-1</a>, the only way to change what’s displayed is to send another URL to a web server to get a new document. Not only is this a slow process, but it also wastes resources. If you entered a phone number into a form, the data would have to be sent to a server to determine whether it contained all numbers, and the server would have to send back a page with an error message if it didn’t.</p>
<p class="indent">In 1993, Mark Andreesen created the graphical Mosaic web browser, which fueled the consumer internet boom. He went on to found Netscape, which released the Netscape Navigator browser in 1994. Realizing the need for more interactive web pages, Netscape introduced the JavaScript programming language in 1995. JavaScript has since been standardized by the Ecma International standards organization, formerly the European Computer Manufacturers Association, as ECMA-262. It’s also known as ECMAScript, which sounds like a skin condition and has since been known to make browsers flaky. JavaScript borrowed from both the C programming language and from Java, which itself borrowed from C.</p>
<p class="indent">JavaScript allows web pages to contain actual programs that run on your computer instead of on the server. These programs can modify the DOM and can communicate directly with a web server, as shown in <a href="ch09.xhtml#ch09fig08">Figure 9-8</a>.</p>
<div class="image"><a id="ch09fig08"/><img src="../images/09fig08.jpg" alt="Image"/></div>
<p class="figcap"><em>Figure 9-8: Web browser interaction with JavaScript and web server</em></p>
<p class="indent"><span epub:type="pagebreak" id="page_252"/>The interaction between the JavaScript program and the server is not the same as the browser/server communication we saw in <a href="ch09.xhtml#ch09fig01">Figure 9-1</a>. Instead, it takes place via <em>Asynchronous JavaScript and XML (AJAX)</em>. Let’s break that down. <em>Asynchronous</em> is related to what we saw with ripple counters in “<a href="ch03.xhtml#ch03lev2sec6">Counters</a>” on <a href="ch03.xhtml#page_77">page 77</a>; in this instance, it means the browser has no control over when (and if) a server responds. The <em>JavaScript</em> part just means it’s under the control of a JavaScript program. I’m not going to explain the <em>and</em>. Finally, the data from the server to the JavaScript program was initially encoded using <em>XML</em>, not HTML.</p>
<p class="indent">You can include JavaScript in an HTML document by enclosing it in <code>&lt;script&gt;</code> elements. Let’s add some to what we had in <a href="ch09.xhtml#ch09list04">Listing 9-4</a>, again showing the changes in bold, in <a href="ch09.xhtml#ch09list13">Listing 9-13</a>.</p>
<pre>&lt;html&gt;<br/>
    &lt;head&gt;<br/>
        &lt;title&gt;<br/>
            My First Web Page<br/>
        &lt;/title&gt;<br/>
        &lt;style&gt;<br/>
            body {<br/>
                color: blue;<br/>
            }<br/>
            big {<br/>
                color:     yellow;<br/>
                font-size: 200%;<br/>
            }<br/>
        &lt;/style&gt;<br/>
        <span class="codestrong1">&lt;script&gt;</span><br/>
            <span class="codestrong1">window.onload = function() {</span><br/>
                <span class="codestrong1">var big = document.getElementsByTagName('big');</span><br/>
                <span class="codestrong1">big[0].style.background = "green";</span><br/>
            <span class="codestrong1">}</span><br/>
        <span class="codestrong1">&lt;/script&gt;</span><br/>
    &lt;/head&gt;<br/>
    &lt;body&gt;<br/>
        This is my first web page.<br/>
        &lt;b&gt;<br/>
            &lt;big&gt;<br/>
                Cool!<br/>
            &lt;/big&gt;<br/>
        &lt;/b&gt;<br/>
    &lt;/body&gt;<br/>
&lt;/html&gt;</pre>
<p class="listing" id="ch09list13"><em>Listing 9-13: Web page with embedded JavaScript</em></p>
<p class="indent">Let’s see what this does without going into all the nitpicky details. Part of the browser definition is that there is a <code>window.onload</code> variable that can be set to a function to execute when the initial page has finished loading. Another part of the definition says that there is a <code>document.getElementsByTagName</code> function that returns an array of all matching elements in the DOM. Here it returns the one <code>&lt;big&gt;</code> element. Finally, it allows us to change various element properties. In this case, we set the background color to green.</p>
<p class="indent"><span epub:type="pagebreak" id="page_253"/>There are a large number of defined functions for DOM manipulation. They allow us to do more than just change CSS styles from a program. There are also functions that allow you to rearrange the DOM tree, including the ability to add and delete elements.</p>
<h3 class="h3" id="ch09lev1sec8"><strong>jQuery</strong></h3>
<p class="noindent">Using the browser DOM functions from the previous section has two problems. First, the DOM functions don’t have exactly the same behavior on different browsers. Second, they’re pretty cumbersome to use—not exactly a user-friendly interface.</p>
<p class="indent">Enter <em>jQuery</em>, a library introduced by American software engineer John Resig in 2006. It solved both of the problems just mentioned. It smoothed over the incompatibilities between browsers so that the programmers using it didn’t have to. And it supplied a DOM manipulation interface that was much easier to use.</p>
<p class="indent">The jQuery library combines selectors with <em>actions</em>. The code in <a href="ch09.xhtml#ch09list14">Listing 9-14</a> does exactly the same thing as the code in <a href="ch09.xhtml#ch09list13">Listing 9-13</a> but in a more programmer-friendly way.</p>
<pre>&lt;html&gt;<br/>
  &lt;head&gt;<br/>
    &lt;title&gt;<br/>
      My First Web Page<br/>
    &lt;/title&gt;<br/>
    &lt;style&gt;<br/>
      body {<br/>
        color:      blue;<br/>
      }<br/>
      big {<br/>
        color:      yellow;<br/>
        font-size:  200%;<br/>
      }<br/>
    &lt;/style&gt;<br/>
    <span class="codestrong1">&lt;script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"&gt; &lt;/script&gt;</span><br/>
    <span class="codestrong1">&lt;script&gt;</span><br/>
      <span class="codestrong1">$(function() {</span><br/>
        <span class="codestrong1">$('big').css('background', 'green');</span><br/>
      <span class="codestrong1">});</span><br/>
    <span class="codestrong1">&lt;/script&gt;</span><br/>
  &lt;/head&gt;<br/>
  &lt;body&gt;<br/>
    This is my first web page.<br/>
      &lt;b&gt;<br/>
        &lt;big&gt;<br/>
       Cool!<br/>
     &lt;/big&gt;<br/>
    &lt;/b&gt;<br/>
  &lt;/body&gt;<br/>
&lt;/html&gt;</pre>
<p class="listing" id="ch09list14"><em>Listing 9-14: Web page with embedded JavaScript and jQuery</em></p>
<p class="indent"><span epub:type="pagebreak" id="page_254"/>The first <code>&lt;script&gt;</code> element imports the jQuery library; the second contains our code. The “document ready” function that the browser calls when the page is loaded contains a single jQuery statement. The first part of it, <code>$('big')</code>, is a selector. It’s similar to the CSS selectors we saw in <a href="ch09.xhtml#ch09tab02">Table 9-2</a>. The remainder of the statement, <code>.css('background', 'green')</code>, is an action to perform on the selected elements. In this case, the <code>css</code> function modifies the <code>background</code> property, setting it to <code>green</code>.</p>
<p class="indent">Let’s add the piece of jQuery in <a href="ch09.xhtml#ch09list15">Listing 9-15</a> to the document ready function to add some interactivity.</p>
<pre>$('big').click(function() {<br/>
    $('big').before('&lt;i&gt;Very&lt;/i&gt;');<br/>
    $('big').css('font-size', '500%');<br/>
});</pre>
<p class="listing" id="ch09list15"><em>Listing 9-15: jQuery event handler</em></p>
<p class="indent">This simple piece of code attaches an <em>event handler</em> to the <code>&lt;big&gt;</code> element that is executed when the mouse clicks it. This handler does two things: it inserts a new <code>&lt;i&gt;</code> element before the <code>&lt;big&gt;</code> element, and it increases the <code>&lt;big&gt;</code> font size.</p>
<p class="indent">As you can see in this example, jQuery makes it easy to manipulate the DOM using JavaScript. You can open up your browser’s debugging console and watch these changes occur when you click.</p>
<p class="indent">jQuery blazed a path, and a very popular one at that; the library is very widely used. However, as seems endemic in the web community, some programmers decided to create parallel, incompatible paths. There are now a number of JavaScript libraries that do the same things, only differently.</p>
<h3 class="h3" id="ch09lev1sec9"><strong>SVG</strong></h3>
<p class="noindent"><em>Scalable Vector Graphics (SVG)</em> is kind of an odd duck in the collection of browser additions. It’s yet another completely different language that allows you to produce nice-looking graphics and text in a manner that is completely incompatible with everything else.</p>
<p class="indent">John Warnock and Chuck Geschke founded Adobe Systems in 1982 and developed the PostScript language. Warnock had been working on more complicated versions of the ideas in PostScript for years, and the development of PostScript was similar to the way that the overly complex SGML was simplified to HTML. The duo caught a lucky break when Steve Jobs requested that they use PostScript to drive laser printers. The PostScript-based Apple LaserWriter was a major factor in the formation of the desktop publishing industry and was responsible for Adobe’s success.</p>
<p class="indent">PostScript had some issues with <em>portability</em>—getting the same results everywhere. The <em>Portable Document Format (PDF)</em>, based on PostScript, was <span epub:type="pagebreak" id="page_255"/>created to address these issues. SVG is more or less PDF wedged into browsers. Of course, SVG and PDF aren’t completely compatible because that would make too much sense.</p>
<p class="indent">In general, SVG is more automatic than the recently added canvas (covered in the next section). You can tell it to do things, and it will, whereas with a canvas you have to write a program to manipulate it. Add the contents of <a href="ch09.xhtml#ch09list16">Listing 9-16</a> to the <code>body</code> of your web page and give it a spin, because every web page needs a red pulsing circle.</p>
<pre>&lt;br&gt;<br/>
&lt;svg  width="400" height="400"&gt;<br/>
  &lt;circle id="c" r="10" cx="200" cy="200" fill="red"/&gt;<br/>
  &lt;animate xlink:href="ch09.xhtml#c" attributeName="r" from="10" to="200" dur="5s" repeatCount="indefinite"/&gt;<br/>
&lt;/svg&gt;</pre>
<p class="listing" id="ch09list16"><em>Listing 9-16: SVG animated circle</em></p>
<h3 class="h3" id="ch09lev1sec10"><strong>HTML5</strong></h3>
<p class="noindent">As I mentioned at the beginning of this chapter, it seems that in the browser world, there’s no idea that should be implemented only once. HTML5 is the latest incarnation of HTML. Among other things, it adds a big pile of <em>semantic</em> elements, including <code>&lt;header&gt;</code>, <code>&lt;footer&gt;</code>, and <code>&lt;section&gt;</code>, which—if used as intended—would add consistent structure to documents.</p>
<p class="indent">HTML5 introduces the <em>canvas</em>, which provides pretty much the same functionality as SVG but in a completely different way. The major difference is that canvases can be manipulated only with a new set of JavaScript functions, unlike SVG, which can use the existing DOM functions. In other words, you would have to write a JavaScript program in order to duplicate <a href="ch09.xhtml#ch09list16">Listing 9-16</a> using a canvas.</p>
<p class="indent">HTML5 also adds <code>&lt;audio&gt;</code> and <code>&lt;video&gt;</code>, which provide somewhat standard mechanisms for audio and video.</p>
<h3 class="h3" id="ch09lev1sec11"><strong>JSON</strong></h3>
<p class="noindent">I touched on AJAX back in “<a href="ch09.xhtml#ch09lev1sec7">JavaScript</a>” on <a href="ch09.xhtml#page_251">page 251</a> and mentioned that asynchronous XML-formatted data is sent from the server to the browser JavaScript program. Well, that’s <em>so</em> four sections ago. The <em>X</em> in AJAX is now a <em>J</em> for JSON. Although the acronym AJAJ floats around, the technique is still called AJAX.</p>
<p class="indent"><em>JSON</em> stands for JavaScript Object Notation. It’s essentially a human-readable text format for a JavaScript <em>object</em>, which is one of JavaScript’s compound data types. The theory is that data in this format can be exchanged in an interoperable manner, although problems with the specification mean that this exchange is possible only if you adhere to certain unspecified rules such as avoiding certain characters. Programmers also need to work around the fact that JSON doesn’t support all the JavaScript data types.</p>
<p class="indent"><span epub:type="pagebreak" id="page_256"/><a href="ch09.xhtml#ch09list17">Listing 9-17</a> builds a JavaScript object and converts it to JSON format. It then shows the result that was stored in the variable <span class="codestrong">the_quest</span>, shown in bold below.</p>
<pre>var argonauts = {};<br/>
argonauts.goal = "Golden Fleece";<br/>
argonauts.sailors = [];<br/>
argonauts.sailors[0] = { name: "Acastus", father: "Pelias" };<br/>
argonauts.sailors[1] = { name: "Actor", father: "Hippasus" };<br/>
argonauts.sailors[2] = { name: "Admentus", father: "Pheres" };<br/>
argonauts.sailors[3] = { name: "Amphiarus", father: "Oicles" };<br/>
argonauts.sailors[4] = { name: "Ancaeus", father: "Poseidon" };<br/>
<br/>
var the_quest = JSON.stringify(argonauts);<br/>
<br/>
<span class="codestrong1">"{</span><br/>
    <span class="codestrong1">"goal": "Golden Fleece",</span><br/>
    <span class="codestrong1">"sailors": [</span><br/>
        <span class="codestrong1">{ "name": "Acastus", "father": "Pelias" },</span><br/>
        <span class="codestrong1">{ "name": "Actor", "father": "Hippasus" },</span><br/>
        <span class="codestrong1">{ "name": "Admentus", "father": "Pheres" },</span><br/>
        <span class="codestrong1">{ "name": "Amphiarus", "father": "Oicles" },</span><br/>
        <span class="codestrong1">{ "name": "Ancaeus", "father": "Poseidon" }</span><br/>
    <span class="codestrong1">]</span><br/>
<span class="codestrong1">}"</span></pre>
<p class="listing" id="ch09list17"><em>Listing 9-17: JSON and the Argonauts</em></p>
<p class="indent">JSON has an advantage over XML when using JavaScript, and not just because converting JavaScript objects into JSON is trivial, as shown in <a href="ch09.xhtml#ch09list17">Listing 9-17</a>. The companion JavaScript <code>eval</code> function can execute JSON directly, because it’s data, as if it’s a JavaScript program. JSON is popular because it eliminates the need for extra code to handle data export and import.</p>
<p class="indent">Just because it’s easy to use JSON doesn’t mean you can be cavalier about it, however. Blithely importing JSON data using <code>eval</code> can allow an attacker to execute arbitrary code in a browser. More recently, a companion <code>JSON.parse</code> function has been added that safely converts JSON back into a JavaScript object.</p>
<h3 class="h3" id="ch09lev1sec12"><strong>Summary</strong></h3>
<p class="noindent">In this chapter, you’ve learned the basics of how many of the components comprising a web browser work. <a href="ch09.xhtml#ch09fig09">Figure 9-9</a> illustrates the pieces we’ve discussed. Of course, browsers include a lot more functionality that isn’t particularly interesting, such as bookmarks and history.</p>
<span epub:type="pagebreak" id="page_257"/>
<div class="image"><a id="ch09fig09"/><img src="../images/09fig09.jpg" alt="Image"/></div>
<p class="figcap"><em>Figure 9-9: Browser block diagram</em></p>
<p class="indent">The diagram may look pretty complicated, but it’s just an assemblage of parts that you’ve already seen. These include language parsers, parse trees, regular expressions, interpreters, networking, input, and output.</p>
<p class="indent">It also illustrates a distinction between hardware and software design. Designing hardware is more expensive than designing software. It’s unlikely that a hardware designer would construct a system that used six different incompatible methods to do the same thing before breakfast. But because there isn’t the same up-front cost in software, software designers are often less careful. The result is often a larger, more complex result that might cost less up front but often costs more later because of the number of complicated interoperating parts that must be maintained.</p>
<p class="indent">Now that you’ve learned something about the workings of this complex interpreter, in the next chapter we’ll write some programs for it. You’ll see a program written for a browser in JavaScript and the same program written in C. This will illustrate some of the important system-level considerations that are hidden from web programmers but are important for system-level programming.<span epub:type="pagebreak" id="page_258"/></p>
</body></html>