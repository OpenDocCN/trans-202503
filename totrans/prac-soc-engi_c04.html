<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en">
<head>
<title>Chapter 4: Gathering Business OSINT</title>
<link href="NSTemplate_v1.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:5e8bb34b-260b-4fef-91f3-caabb4446e65" name="Adept.expected.resource"/>
</head>
<body epub:type="bodymatter chapter">
<section>
<header>
<h1 class="chapter">
<span class="ChapterNumber"><span epub:type="pagebreak" id="Page_35" title="35"/>4</span><br/>
<span class="ChapterTitle">Gathering Business OSINT</span></h1>
</header>
<figure class="opener">
<img alt="" src="image_fi/book_art/chapterart.png"/>
</figure>
<p class="ChapterIntro"><em>Open Source Intelligence (OSINT)</em> is any data you can find from publicly available, unhidden sources. The amount and significance of available public data can make or break your campaign. If you contact a target without any knowledge of their likes and dislikes, operating environment, organizational structure, or internal company lingo, you’ll probably fail. </p>
<p>On the other hand, taking the time to understand what makes the target click will provide you with immediate context for the contact. Too often, people attempt to perform social engineering operations after either skipping or rushing the OSINT gathering, leaving them without a reason to talk to their target.</p>
<p>This chapter introduces three OSINT categories: business, people, and cyber threat intelligence. Then I’ll go over some business OSINT tools for useful tasks like finding the names of company executives, discovering publicly available files, collecting email addresses, and reading document metadata. </p>
<h2 id="h1-500983c04-0001"><span epub:type="pagebreak" id="Page_36" title="36"/>Case Study: Why OSINT Matters</h2>
<p class="BodyFirst">In 2017, I won DerbyCon’s Social Engineering Capture the Flag (SECTF). This exercise pit me and five other competitors against an unknowing Fortune 500 business in the Louisville, KY area. We spent three weeks collecting OSINT, followed by 20 minutes in a (mostly) soundproof booth to vish the target company’s employees. While researching my target company, I checked an executive’s social media accounts and learned that he’d been late to a business meeting in Amsterdam because an airline had delayed his flight in Newark. This seemingly harmless piece of information gave me the perfect excuse for contacting him. </p>
<p>With this knowledge, I added that airline’s phone number to my list of numbers to vish. I then acquired the executive’s name, email address, and phone number, and added those to my list of targets. Had this been an engagement allowing phishing, I would have sent an apology email that mimicked the airline’s template, and then followed up with a phone call, pretending to be the airline. Then I could have confirmed the information I already knew and asked “security questions” to convince the target that I was a trusted source. I might have even incorporated a few Windows operating system sounds to amplify my credibility. Finally, I would have asked him potentially lethal questions about the company’s operating environment, such as the status of equipment upgrades, operating schedules, or other company-specific confidential data.</p>
<p>These attacks would be impossible if I had not first discovered the executive’s post about his delayed flight. Rarely will an effective social engineering attack happen without an informed understanding of the target. Better OSINT makes better social engineering. </p>
<h2 id="h1-500983c04-0002">Understanding Types of OSINT</h2>
<p class="BodyFirst">OSINT can be about an organization, a person, or a piece of code. In <em>business OSINT</em> gathering, we look for information about the company as a whole: technologies used, vendors, customers, operations, and locations. </p>
<p>For collecting <em>people OSINT</em>, we can go in two directions. We can target the person themselves, hunting for information such as their likes, dislikes, further connections, password-reset questions, and context for guessing passwords. Alternatively, we can leverage the person to learn about the business for which they work. This kind of OSINT could include pictures of the person at work, resumes, complaints or grievances, any bragging they’ve done about work, and travel they’ve done for work, to name a few.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">Note</span></h2>
<p>	As a rule of thumb, I won’t explicitly target a person’s personal accounts as part of an engagement. I may gather information to use, but I won’t try to contact them on a personal Facebook, Twitter, or LinkedIn account. </p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p><em>OSINT</em> can be used to enable <em>cyber threat intelligence (CTI)</em> which usually involves a piece of code or a specific adversary. We use it as a means to identify the perpetrator of an attack and their motives. For example, you might track down elements of code to determine its author or country. Or you might trace an email address or phone number that contacted your <span epub:type="pagebreak" id="Page_37" title="37"/>organization. People debate the efficacy of OSINT for threat intelligence. Some organizations do it very well, while others try to make a quick buck at the expense of their customers.</p>
<h2 id="h1-500983c04-0003">Business OSINT</h2>
<p class="BodyFirst">This section will get you started collecting business OSINT. What context can you use to build rapport when you communicate with a company’s employees? I’ll go over some OSINT collection tools here.</p>
<h3 id="h2-500983c04-0001">Getting Basic Business Information from Crunchbase</h3>
<p class="BodyFirst">Various platforms can give you insight about a company. While most charge for in-depth information, some allow collection of a limited amount of information for free or without authentication. An example of such a site is <em>Crunchbase </em>(<a class="LinkURL" href="https://www.crunchbase.com/">https://www.crunchbase.com/</a>).<em> </em>Crunchbase has a free tier that meets most needs for casual OSINT enthusiasts. If you plan on using this heavily or as a professional consultant, I recommend paying for the Pro tier. </p>
<p>Searching Crunchbase for <em>Walmart</em> pulls up a profile with multiple tabs. <a href="#figure4-1" id="figureanchor4-1">Figure 4-1</a> shows the Summary tab, which allows you to get an address for corporate headquarters. Before having to scroll down, you can find out the number of mergers, acquisitions, and exits to which the company has been a party. You can see its stock ticker (if it’s a publicly traded company), recent news about the company, and the beginning of foundational, sometimes historical, information about the company. Crunchbase gathers this information from a combination of input from analysts, web scraping, and self-reporting, which varies in accuracy.</p>
<figure>
<img alt="&lt;&lt; Crunchbase web page shows “Summary” tab for Walmart business profile, including sections for About, Highlights, Recent News and Activity, and Details.&gt;&gt;" class="keyline" src="image_fi/500983c04/f04001.png"/>
<figcaption><p><a id="figure4-1">Figure 4-1</a>: Crunchbase profile’s Summary tab for Walmart</p></figcaption>
</figure>
<p><span epub:type="pagebreak" id="Page_38" title="38"/>The Financials tab provides specific information about investments, exits, and fundraising (<a href="#figure4-2" id="figureanchor4-2">Figure 4-2</a>). </p>
<figure>
<img alt="&lt;&lt;Crunchbase web page shows “Financials” tab for Walmart business profile, including sections for investment Highlights, Funding, and IPO and Stock Price.&gt;&gt;" class="keyline" src="image_fi/500983c04/f04002.png"/>
<figcaption><p><a id="figure4-2">Figure 4-2</a>: Walmart’s stock information in the Crunchbase Financials tab</p></figcaption>
</figure>
<p>If the company is publicly traded, you’ll find the initial public offering (IPO) and stock price information. If you’re researching a privately held company, you would see little to nothing in this section, or perhaps would learn about fundraising efforts, including amounts raised, investors, and dates. If the company has invested money or made donations, that will be listed next (<a href="#figure4-3" id="figureanchor4-3">Figure 4-3</a>), followed by Exits and completed by Acquisitions (<a href="#figure4-4" id="figureanchor4-4">Figure 4-4</a>). </p>
<figure>
<img alt="&lt;&lt;Crunchbase web page shows “Financials” tab for Walmart business profile, displaying the company's Lead Investments (8) and Total Investments (14) in specific organizations.&gt;&gt;" class="keyline" src="image_fi/500983c04/f04003.png"/>
<figcaption><p><a id="figure4-3">Figure 4-3</a>: Walmart’s investment information in the Crunchbase Financials tab</p></figcaption>
</figure>
<span epub:type="pagebreak" id="Page_39" title="39"/><figure>
<img alt="&lt;&lt;Crunchbase web page shows “Financials” tab for Walmart business profile, displaying the company's exits (5) and acquisitions (25).&gt;&gt;" class="keyline" src="image_fi/500983c04/f04004.png"/>
<figcaption><p><a id="figure4-4">Figure 4-4</a>: Walmart’s acquisition information in the Crunchbase Financials tab </p></figcaption>
</figure>
<p>Next is the People tab, which includes important employees. These are typically executives overseeing certain key areas or people who have had an impact on the organization’s history. For example, <a href="#figure4-5" id="figureanchor4-5">Figure 4-5</a> lists Sam Walton, the founder of Walmart, as a “Founder &amp; Admin” under Current Team and a member of the Board of Directors despite his having passed away in 1992. </p>
<figure>
<img alt="&lt;&lt;Crunchbase web page shows “People” tab for Walmart business profile, including sections for Highlights, About, and Current Team of 141 members and 21 board members.&gt;&gt;" class="keyline" src="image_fi/500983c04/f04005.png"/>
<figcaption><p><a id="figure4-5">Figure 4-5</a>: Crunchbase profile’s People tab for Walmart</p></figcaption>
</figure>
<p><span epub:type="pagebreak" id="Page_40" title="40"/>The Technology tab is mostly locked unless you have a Pro tier account. If you do have such an account, this tab will show you web traffic statistics, mobile app metrics, and limited information about the company’s patents and other intellectual property filings. This information can be found elsewhere on the internet, so being locked out isn’t a terribly big deal. Try looking at BuiltWith (<a class="LinkURL" href="https://www.builtwith.com/">https://www.builtwith.com/</a>), Wappalyzer (<a class="LinkURL" href="https://www.wappalyzer.com/">https://www.wappalyzer.com/</a>), or Shodan (<a class="LinkURL" href="https://www.shodan.io/">https://www.shodan.io/</a>).</p>
<p>The final tab, Signals &amp; News, aggregates relevant news and leadership changes (<a href="#figure4-6" id="figureanchor4-6">Figure 4-6</a>). </p>
<figure>
<img alt="&lt;&lt;Crunchbase web page shows “Signals and News” tab for Walmart business profile, displaying the most recent articles and media activity concerning Leadership Hires and Layoffs.&gt;&gt;" class="keyline" src="image_fi/500983c04/f04006.png"/>
<figcaption><p><a id="figure4-6">Figure 4-6</a>: Crunchbase profile’s Signals &amp; News tab for Walmart</p></figcaption>
</figure>
<p>This tab also lists events that the organization has some affiliation with, either by sponsoring them or having employees speak at them. This is a good starting point, but not a replacement for other sources of information, including public filings, press releases, and reports by the media. (We’ll discuss these sources in the next few chapters.) This tab may also suggest possible search terms you could enter on the search engine of your choice. </p>
<h3 id="h2-500983c04-0002">Identifying Website Owners with WHOIS</h3>
<p class="BodyFirst">Pronounced “who is,” <em>WHOIS</em> is a directory of websites, their owners, their network blocks, and their points of contact. Its purpose is to allow people with legitimate business inquiries to contact companies’ web teams regarding the web presence. To read more about it, see RFC 9312.</p>
<p>You can search WHOIS via DomainTools, as shown in <a href="#figure4-7" id="figureanchor4-7">Figure 4-7</a>. The <code>whois</code> command is built into both the Offensive Security and Trace Labs Kali versions and can be added to any Linux system via <code>apt-get</code> or similar commands for other Linux distributions.</p>
<span epub:type="pagebreak" id="Page_41" title="41"/><figure>
<img alt="&lt;&lt;Walmart Domain Profile shows the WHOIS record via DomainTools, displaying the company's registration information and name servers.&gt;&gt;" class="keyline" src="image_fi/500983c04/f04007.png"/>
<figcaption><p><a id="figure4-7">Figure 4-7</a>: Walmart WHOIS record via DomainTools </p></figcaption>
</figure>
<p>The top of the page shows domains that are similar to the target’s domain and up for auction. These may come in handy for domain squatting and further phishing or baiting attempts. Spoofing is easy to detect, and most mail clients have protections against it, weakening your potential as a social engineer. Domain squatting or typo squatting are more likely to get emails through filters and into inboxes. </p>
<p>Next, notice that <em>transfer </em>is prohibited, meaning you likely won’t be able to transfer that domain to a different provider, an activity that red teams often attempt. Also notice the age of the domain. This helps confirm that you’re looking at the right target. Alternatively, this same feature can reveal that the domains you use are fake. That’s why it’s a good idea to purchase domains and wait six months to a year before using them. </p>
<p>Next are the domain name servers that the site uses. These can sometimes indicate other software employed by the company. For example, Walmart uses Akamai and UltraDNS. Akamai also provides content distribution network (CDN) services (to allow faster page loading and mitigate DOS attacks) and performs web protection and load balancing (further DOS mitigation). This is important to know if you’re preparing for a penetration test. </p>
<p>Be aware that, as of May 25, 2018, the EU General Data Protection Regulation (GDPR) has changed the way that WHOIS is handled in its jurisdiction. This prompted the Internet Corporation for Assigned Names and Numbers (ICANN), the governing body for WHOIS, to change the information presented for companies and contacts located in the EU. </p>
<h3 id="h2-500983c04-0003"><span epub:type="pagebreak" id="Page_42" title="42"/>Collecting OSINT from the Command Line with Recon-ng</h3>
<p class="BodyFirst"><em>Recon-ng</em> is a command line tool for Linux, written by Tim Tomes, for collecting OSINT. It operates a lot like Metasploit: you can input information, set targets, and then use the <code>run</code> command to perform a search. </p>
<p>A plethora of tools are built into Recon-ng for collecting both business and people OSINT, ranging from breached emails from Have I Been Pwned (discussed in <span class="xref" itemid="xref_target_Chapter 6">Chapter 6</span>) and netblocks from DNS records to hosts or ports from Shodan (discussed in <span class="xref" itemid="xref_target_Chapter 5">Chapter 5</span>). You can find most things that you seek to learn about a company by using Recon-ng.</p>
<h4 id="h3-500983c04-0001">Installing Recon-ng</h4>
<p class="BodyFirst">Recon-ng comes preinstalled on both the Offensive Security and Trace Labs Kali versions. To use Recon-ng on a different Linux system, you’ll need Python 3, the pip3 package management tool, and Git. Then you can install it in the <em>/opt</em> directory with the following commands:</p>
<pre><code>root@se-book:/opt# <b>git clone https://github.com/lanmaster53/recon-ng</b>
Cloning into 'recon-ng'...
<var>---snip--</var>
Resolving deltas: 100% (4824/4824), done.
root@se-book:/opt# cd recon-ng/
root@se-book:/opt/recon-ng# ls -la
<var>--snip--</var>
-rw-r--r-- 1 root root    97 Sep 25 18:37 REQUIREMENTS
<var>--snip--</var>
-rwxr-xr-x 1 root root  2498 Sep 25 18:37 recon-ng
-rwxr-xr-x 1 root root    97 Sep 25 18:37 recon-web
root@se-book:/opt/recon-ng# python3 -m <b>pip install -r REQUIREMENTS</b> 
Requirement already satisfied: pyyaml in /usr/lib/python3/dist-packages (from -r REQUIREMENTS (line 2))
Collecting dnspython (from -r REQUIREMENTS (line 3))
  Downloading https://files.pythonhosted.org/packages/ec/d3/3aa0e7213ef72b8585747aa0e271a9523e713813b9a20177ebe1e939deb0/dnspython-1.16.0-py2.py3-none-any.whl (188kB)
    100% |████████████████████████████████| 194kB 5.6MB/s</code></pre>
<h4 id="h3-500983c04-0002">Setting Up a Workspace</h4>
<p class="BodyFirst">Recon-ng lets you define separate workspaces, which are great for keeping your collected information segmented. You can define the workspace as you open Recon-ng and store the data collected in its own unique SQLite database. If I am searching for various entities or companies as part of the same investigation, I will give them their own workspace so to not confuse myself as I review the information collected. If you don’t define a workspace, Recon-ng will write all results to the default workspace and associated database. </p>
<p>To use a workspace when starting Recon-ng, run the following:</p>
<pre><code><b>recon-ng -w </b><var class="bold">workspace_name</var> </code></pre>
<p><span epub:type="pagebreak" id="Page_43" title="43"/>For example, if I were investigating Walmart, I might run this:</p>
<pre><code>recon-ng -w walmart</code></pre>
<p>The resulting workspace would look like this:</p>
<pre><code>[recon-ng][walmart]</code></pre>
<p>If you’re already in Recon-ng, you can view available workspaces by issuing the <code>workspace list</code> command. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">Note</span></h2>
<p>	You cannot do this while a module is loaded, so in that situation, you’ll need to issue the <code>back</code> command.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>If you want to load an existing workspace, you can issue this command:</p>
<pre><code><b>workspace load</b> <var class="bold">workspace_name</var> </code></pre>
<p>You can also create a workspace by using the following: </p>
<pre><code><b>workspace create</b> <var class="bold">workspace_name</var> </code></pre>
<p>After you no longer need any of the information within a workspace and your retention requirements have passed, you can remove it: </p>
<pre><code><b>workspace remove</b> <var class="bold">workspace_name</var></code></pre>
<h4 id="h3-500983c04-0003">Installing Recon-ng Modules</h4>
<p class="BodyFirst">Next, you have to enable and install modules. Let’s see which modules are available by using <code>marketplace search</code>:</p>
<pre><code>[recon-ng][walmart] &gt; <b>marketplace search</b>
+-----------------------------------------------------------------------------------    ------+
|.             Path                            | Version |     Status    |  Updated   | D | K |
+---------------------------------------------------------------------------------------    --+
| discovery/info_disclosure/cache_snoop        | 1.0     | not installed | 2019-06-24 |   |   |
| discovery/info_disclosure/interesting_files  | 1.0     | not installed | 2019-06-24 |   |   |
| exploitation/injection/command_injector      | 1.0     | not installed | 2019-06-24 |   |   |
| exploitation/injection/xpath_bruter          | 1.1     | not installed | 2019-08-19 |   |   |
| import/csv_file                              | 1.1     | not installed | 2019-08-09 |   |   |
| import/list                                  | 1.0     | not installed | 2019-06-24 |   |   |</code></pre>
 
<p>You can install modules in two ways: one by one or all at once. To install a single module, enter the following command, replacing <var>import/csv_file</var> with the complete path of the module:</p>
<pre><code>[recon-ng][walmart] &gt; <b>marketplace install</b><b> </b><var class="bold">import/csv_file</var>
[*] Module installed: import/csv_file
[*] Reloading modules...</code></pre>
<p><span epub:type="pagebreak" id="Page_44" title="44"/>To install all available modules, use the following command:</p>
<pre><code>[recon-ng][walmart] &gt; <b>marketplace install all</b>
[*] Module installed: discovery/info_disclosure/cache_snoop
[*] Module installed: discovery/info_disclosure/interesting_files
[*] Module installed: exploitation/injection/command_injector
<var>--snip--</var>
[*] Module installed: reporting/xml
[*] Reloading modules...
[!] 'google_api' key not set. pushpin module will likely fail at runtime. See 'keys add'.
[!] 'bing_api' key not set. bing_linkedin_cache module will likely fail at runtime. See 'keys add'.
[!] 'censysio_id' key not set. censysio module will likely fail at runtime. See 'keys add'.</code></pre>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">Note</span></h2>
<p>	Ignore the warnings about missing API keys. We’ll import API keys for only the modules we need. </p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h4 id="h3-500983c04-0004">Acquiring and Adding API Keys</h4>
<p class="BodyFirst">In order for some of the tools to access outside resources, you’ll need to add API keys from various websites. Each website has its own process for getting these keys, and those procedures tend to change frequently. You can find my up-to-date tutorial for obtaining these API keys at <a class="LinkURL" href="https://www.theosintion.com/practical-social-engineering/">https://www.theosintion.com/practical-social-engineering/</a><em> </em>or check the pages for API keys on the websites for each tool. </p>
<p>Once you have the keys, use the following syntax in Recon-ng to add them:</p>
<pre><code><b>keys add</b> <var class="bold">name_of_module value</var></code></pre>
<p>Verify that Recon-ng has the key in the database with the following command:</p>
<pre><code><b>keys list</b></code></pre>
<h4 id="h3-500983c04-0005">Finding and Running Recon-ng Modules </h4>
<p class="BodyFirst">There are five kinds of Recon-ng modules: discovery, exploitation, import, recon, and reporting. In this book, we’ll use the discovery, recon, and reporting module types. </p>
<p>To see the modules relative to a specific type, use the <code>search</code> command, followed by the type’s name:</p>
<pre><code><b>modules search discovery</b></code></pre>
<p>If you know part of the module’s name, you can use the <code>search</code> function to locate it, like this:</p>
<pre><code><b>modules search hibp</b></code></pre>
<p><span epub:type="pagebreak" id="Page_45" title="45"/>You can also invoke a module directly with the <code>modules load</code> command if you know either the module’s name or the beginning of the module’s name:</p>
<pre><code><b>modules load metacr</b></code></pre>
<p>The preceding command will load the <code>metacrawler</code> module. Now let’s explore some of these modules in more detail.</p>
<p>To set a target for a module, you’ll need to know what inputs the module accepts. Find this out by issuing the <code>info</code> command. Once you’re ready to enter a target or value in one of the accepted fields, issue the <code class="bold">options set </code><var class="bold">name_of_field value_of_field</var> command.</p>
<h4 id="h3-500983c04-0006">Enumerating Files with Metacrawler</h4>
<p class="BodyFirst">The <code>metacrawler</code> module searches a target site or sites for Microsoft PowerPoint, Word, Excel, and PDF files. It’s the equivalent of doing a <em>Google dork</em>—writing long search queries, like this:</p>
<pre><code>site:nostarch.com Filetype:XLS* OR Filetype:DOC* OR Filetype:PPT* or Filetype:PDF</code></pre>
<p>For example, to search <em>nostarch.com</em> for all file types, use the following commands: </p>
<pre><code>[recon-ng][default][metacrawler] &gt; <b>options </b><b>set SOURCE nostarch.com</b>
SOURCE =&gt; nostarch.com
[recon-ng][default][metacrawler] &gt; <b>run</b>
------------
NOSTARCH.COM
------------
[*] Searching Google for: site:nostarch.com filetype:pdf OR filetype:docx OR 
filetype:xlsx OR filetype:pptx OR filetype:doc OR filetype:xls OR 
filetype:ppt
[*] https://www.nostarch.com/download/WGC_Chapter_3.pdf
[*] Producer: Acrobat Distiller 6.0 (Windows)
[*] Title: Write Great Code
[*] Author: (c) 2004 Randall Hyde
[*] Creator: PScript5.dll Version 5.2
[*] Moddate: D:20041006112107-07'00'
[*] Creationdate: D:20041006111512-07'00'
[*] https://www.nostarch.com/download/wcss_38.pdf
[*] Producer: Acrobat Distiller 5.0 (Windows)
[*] Title: wcss_book03.book
[*] Author: Riley
[*] Creator: PScript5.dll Version 5.2
[*] Moddate: D:20040206172946-08'00'
[*] Creationdate: D:20040116180100Z</code></pre>
<p>If <code>Extract</code> is set to <code>True</code>, this command outputs all documents on the target’s public website that are in PDF or Microsoft Office formats (Excel, Word, or PowerPoint) with a link to the file and metadata, including the <span epub:type="pagebreak" id="Page_46" title="46"/>author, the software that created it, the modification date, the software that produced it, and the date on which it was created. If <code>Extract</code> is set to <code>False</code>, the output provides the filename and link only. </p>
<p>Given this information, you can do numerous things. From the metadata, you can enumerate users, operating systems, and software used. From the files themselves, you might be able to find information the target intended to keep private, including names, email addresses, phone and fax numbers, locations, and important business matters. </p>
<h4 id="h3-500983c04-0007">Finding Domain Points of Contact with whois_pocs</h4>
<p class="BodyFirst">The <code>whois_pocs</code> module enumerates all known points of contact for a given domain. It’s more robust for this feature than the <code>whois_miner</code> module and works even against targets with domain privacy. Here is an example of running this module against Walmart: </p>
<pre><code>[recon-ng][default][whois_pocs] &gt;<b> modules load whois_pocs</b>
[recon-ng][default][whois_pocs] &gt;<b> options set SOURCE walmart.com</b>
SOURCE =&gt; nostarch.com
[recon-ng][default][whois_pocs] &gt;<b> info</b>
      Name: Whois POC Harvester
      Path: modules/recon/domains-contacts/whois_pocs.py
    Author: Tim Tomes (@LaNMaSteR53)
Description:
  Uses the ARIN Whois RWS to harvest POC data from whois queries for the given
domain. Updates the 'contacts' table with the results.
Options:
  Name    Current Value  Required  Description
  ------  -------------  --------  -----------
  SOURCE  walmart.com    yes       source of input (see 'show info' for details)
Source Options:
  default        SELECT DISTINCT domain FROM domains WHERE domain IS NOT NULL
  &lt;string&gt;       string representing a single input
  &lt;path&gt;         path to a file containing a list of inputs
  query &lt;sql&gt;    database query returning one column of inputs
[recon-ng][default][whois_pocs] &gt; <b>run</b>
-----------
WALMART.COM
-----------
[*] URL: http://whois.arin.net/rest/pocs;domain=walmart.com
[*] URL: http://whois.arin.net/rest/poc/ABUSE327-ARIN
[*] Country: United States
[*] Email: abuse@walmart.com
[*] First_Name: None
[*] Last_Name: Abuse
[*] Middle_Name: None
[*] Notes: None
[*] Phone: None
[*] Region: Brisbane, CA
[*] Title: Whois contact
[*] --------------------------------------------------</code></pre>
<p><span epub:type="pagebreak" id="Page_47" title="47"/>Keep in mind that some organizations don’t publish their WHOIS information.</p>
<h4 id="h3-500983c04-0008">Using mx_spf_ip to Learn About a Domain’s Email Policies</h4>
<p class="BodyFirst">The <code>mx_sfp_ip</code> module retrieves the DNS mail exchanger (MX) record for a domain. The <em>MX record</em> defines how the domain processes email. It shows the mail servers used and any <em>Sender Policy Framework (SPF) records</em> that restrict IP ranges from which the domain can receive mail, as well as domains that can email the organization without scrutiny. </p>
<p>Using the MX record, an attacker can leverage the information it contains to craft a successful email spoofing attack. For example, the attacker can enumerate the IP ranges listed in the record and their associated domains. This may provide clues into business relationships, vendors, or technologies used.</p>
<p>The following command retrieves the MX record for <em>nostarch.com</em>. The output confirms that the site uses Google mail servers, but the lack of an SPF record indicates that No Starch hasn’t implemented SPF: </p>
<pre><code>[recon-ng][book][mx_spf_ip] &gt; <b>options set </b><b>SOURCE </b><b>nostarch.com</b>
SOURCE =&gt; nostarch.com
[recon-ng][book][mx_spf_ip] &gt; <b>run</b>
[*] Retrieving MX records for nostarch.com.
[*] [host] alt1.aspmx.l.google.com (&lt;blank&gt;)
[*] [host] aspmx.l.google.com (&lt;blank&gt;)
[*] [host] alt3.aspmx.l.google.com (&lt;blank&gt;)
[*] [host] alt2.aspmx.l.google.com (&lt;blank&gt;)
[*] [host] alt4.aspmx.l.google.com (&lt;blank&gt;)
[*] Retrieving SPF records for nostarch.com.
[*] nostarch.com =&gt; No record found.</code></pre>
<p>On the other hand, the following output shows us that Walmart uses SPF:</p>
<pre><code>[recon-ng][book][mx_spf_ip] &gt; <b>options set SOURCE walmart.com</b>
SOURCE =&gt; walmart.com
[recon-ng][book][mx_spf_ip] &gt; <b>run</b>
[*] Retrieving MX records for walmart.com.
[*] [host] mxb-000c7201.gslb.pphosted.com (&lt;blank&gt;)<span aria-label="annotation1" class="CodeAnnotation">1</span>
[*] [host] mxa-000c7201.gslb.pphosted.com (&lt;blank&gt;)
[*] Retrieving SPF records for walmart.com.
[*] TXT record: "dtOeNuIs42WbSVe3Zf2qizxLw9LSQpFd6bWqCr166oTRIuJ9yKS+etPsGGNOvaiasQk2C6GV0/5PjT9CI2nNAg=="
[*] TXT record: "google-site-verification=ZZYRwyiI6QKg0jVwmdIha68vuiZlNtfAJ90msPo1i7E"
[*] TXT record: "adobe-idp-site-verification=7f3fb527466337ac0ac0752c569ca2ac48926dc6c6dad3636d581aa131a1cf3e"
[*] TXT record: "v=spf1 ip4:161.170.248.0/24 ip4:161.170.244.0/24 ip4:161.170.236.31 ip4:161.170.238.31 ip4:161.170.241.16/30 ip4:161.170.245.0/24 ip4:161.170.249.0/24 include:Walmart.com include:_netblocks.walmart.com include:_vspf1.walmart.com include:_vspf2.walmart.co" "m include:_vspf3.walmart.com ~all"
[*] [netblock] 161.170.248.0/24<span aria-label="annotation2" class="CodeAnnotation">2</span>
[*] [netblock] 161.170.244.0/24
[*] [host] &lt;blank&gt; (161.170.236.31)
[*] [host] &lt;blank&gt; (161.170.238.31)
<span epub:type="pagebreak" id="Page_48" title="48"/>[*] [netblock] 161.170.241.16/30
[*] [netblock] 161.170.245.0/24
[*] [netblock] 161.170.249.0/24
[*] TXT record: "facebook-domain-verification=ximom3azpca8zph4n8lu200sos1nrk"<span aria-label="annotation3" class="CodeAnnotation">3</span>
[*] TXT record: "adobe-idp-site-verification=5800a1970527e7cc2f5394a2bfe99bcda4e5938e132c0a19139fda9bf6e30704"<span aria-label="annotation4" class="CodeAnnotation">4</span>
[*] TXT record: "docusign=5bdc0eb1-5fb2-471c-99a0-d0d9cc5fdac8"<span aria-label="annotation5" class="CodeAnnotation">5</span>
[*] TXT record: "MS=E4F53D5B1A485B7BA06E0D36A9D38654A16609F3"<span aria-label="annotation6" class="CodeAnnotation">6</span></code></pre>
<p>The SPF record lists domain verifications for Adobe, Facebook, DocuSign, Microsoft, and Google. The text (TXT) record that begins with <code>MS=</code> indicates that Walmart uses Microsoft Office 365 <span aria-label="annotation6" class="CodeAnnotation">6</span>. It also uses <code>adobe-idp-site-verification</code> to validate domains for Adobe Enterprise products like Creative Cloud <span aria-label="annotation4" class="CodeAnnotation">4</span>. The <code>facebook-domain-verification</code> TXT record restricts the domains that edit the official Facebook page for the domain <span aria-label="annotation3" class="CodeAnnotation">3</span>. The TXT record that begins with <code>docusign=</code> indicates that the site uses DocuSign to sign official documents <span aria-label="annotation5" class="CodeAnnotation">5</span>.</p>
<p>Notice <em>pphosted.com </em><span aria-label="annotation1" class="CodeAnnotation">1</span> listed as a host. This indicates the use of Proofpoint, an anti-spoofing technology that adds a custom message, often the string <code>[EXTERNAL]</code>, to the subject line of received emails, making phishes or attempts at business email compromise easier to spot. </p>
<p>Some network ranges are also listed <span aria-label="annotation2" class="CodeAnnotation">2</span>. These are the target’s public IP addresses, and the two hosts listed are the main mail servers. You can confirm this by using other tools. </p>
<h3 id="h2-500983c04-0004">Using Other Tools: theHarvester and OSINT Framework</h3>
<p class="BodyFirst">Like Recon-ng, <em>theHarvester</em> is a Linux-based command line OSINT tool freely available as part of Kali and Buscador. You can also find it on GitHub. Written by Christian Martorella, theHarvester requires API keys for Shodan and Google Custom Search Engine (CSE). You can enter these keys in the following files:</p>
<pre><code><var>theHarvester_path</var>/discovery/googleCSE.py</code></pre>
<p>and</p>
<pre><code><var>theHarvester_path</var>/discovery/shodansearch.py</code></pre>
<p>On theHarvester, you can use switches to direct the tool to perform tasks. The decision to use theHarvester instead of Recon-ng is a matter of preference. Even if you use Recon-ng as your primary tool, you may want to get a second opinion using theHarvester to see if Recon-ng missed any additional information. </p>
<p><em>OSINT Framework</em> (<a class="LinkURL" href="https://osintframework.com/">https://osintframework.com/</a>) is a GUI-based collection of tools. Curated by Justin Nordine, OSINT Framework groups resources based on what you’re looking for (<a href="#figure4-8" id="figureanchor4-8">Figure 4-8</a>).</p>
<span epub:type="pagebreak" id="Page_49" title="49"/><figure>
<img alt="&lt;&lt;OSINT Framework web page displays grouped resources, including Username, Email Address, Domain Name, IP Address, Images/Videos/Docs, Social Networks, Instant Messaging, People Search Engines, Dating, Telephone Numbers, Public Records, Business Records, Transportation, Geolocation Tools/Maps, Search Engines, Forums/Blogs/IRC, Archives, Language Translation, Metadata, Mobile Emulation, Terrorism, and Dark Web.&gt;&gt;" class="keyline" src="image_fi/500983c04/f04008.png"/>
<figcaption><p><a id="figure4-8">Figure 4-8</a>: OSINT Framework</p></figcaption>
</figure>
<h3 id="h2-500983c04-0005">Finding Email Addresses with Hunter</h3>
<p class="BodyFirst">You’ll often need to find email addresses and a company’s <em>email address</em> <em>syntax</em> (the format the company uses for its employees’ email addresses). <em>Hunter</em> is an excellent tool to help enumerate these. Without logging in, you can get the basic email address syntax used at the company. Once you create an account and log in, you can get the most common email address syntaxes, full company email addresses, and occasionally, a person’s title. </p>
<p><a href="#figure4-9" id="figureanchor4-9">Figure 4-9</a> shows the output of an unauthenticated search.</p>
<figure>
<img alt="&lt;&lt;Hunter web page shows results for an unauthenticated user’s search of walmart.com, displaying email syntax patterns and partial email addresses.&gt;&gt;" class="keyline" src="image_fi/500983c04/f04009.png"/>
<figcaption><p><a id="figure4-9">Figure 4-9</a>: Hunter search results for an unauthenticated user. (Note: Hunter censored these results.)</p></figcaption>
</figure>
<p><span epub:type="pagebreak" id="Page_50" title="50"/><a href="#figure4-10" id="figureanchor4-10">Figure 4-10</a> shows an authenticated search that returns valid email addresses for our target domain, as well as where they were found. </p>
<figure>
<img alt="&lt;&lt;Hunter web page shows results for an authenticated user's search of walmart.com. Displays email syntax patterns, 678 CSV-exportable full names and email addresses (censored by author), job titles, and detailed source information, all outlined in red.&gt;&gt;" class="keyline" src="image_fi/500983c04/f04010.png"/>
<figcaption><p><a id="figure4-10">Figure 4-10</a>: Hunter search results for an authenticated user. (Note: The author censored these results.)</p></figcaption>
</figure>
<p>By looking at these results, you can deduce the syntax of the company’s email addresses. You can then pivot to LinkedIn and the corporate website to get more names, and then put more email addresses together yourself should you want to phish those people. </p>
<p>Hunter provides varying levels of service; at the time of this writing, these range from free (100 requests per month and no CSV export) all the way to $399 per month, which includes 50,000 requests and allows CSV exports.</p>
<h3 id="h2-500983c04-0006">Exploiting Mapping and Geolocation Tools</h3>
<p class="BodyFirst">You’ve probably used Google Maps or Bing Maps to orient yourself using map views, satellite views, and views taken from the street. When it comes to collecting OSINT, the satellite and street view modes are usually the most valuable. </p>
<p>The satellite view can show gates, dumpsters, satellite dishes, entrances and exits, parking schemas, and adjacent facilities. You can zoom in fairly close to some sites to help you determine hiding places, entrances, and smoking areas.</p>
<p>The street view allows you to see the building and facilities as you would if you walked or drove up. From this view, you can identify the following:</p>
<ul>
<li>Dumpster vendor (useful information for onsite pretexting that could help you gain access to the building or dumpster dive)</li>
<li><span epub:type="pagebreak" id="Page_51" title="51"/>Gates, doors, and fences, and whether they’re routinely left open (and, sometimes, the presence of security guards)</li>
<li>Delivery companies whose trucks are parked outside</li>
<li>The specific names of buildings, such as the Walmart Innovation Center, Walmart People Center, or Walmart Home Office, which can help you blend into the organization better (a quick way to be outed is to call Disney or Walmart employees <em>employees</em> instead of <em>cast members</em> or <em>associates</em>, respectively) </li>
<li>Other tenants</li>
</ul>
<p>During the DerbyCon SECTF I mentioned at the beginning of this chapter, I used Google Maps to determine the shipping vendors for my target company by checking whose trucks were within the confines of the gates. I could have used this information to gain physical access, maybe by finding a uniform at a thrift shop, or as a vishing pretext to call about a shipment.</p>
<p>Using both Google Maps and Bing Maps can give you better information, as the source of the apps’ data is different. Furthermore, the images are collected on different days, so you might, for example, find a delivery truck in one app but not in another, a new dumpster in a more recent photo, or poorly censored vendor names.</p>
<h2 id="h1-500983c04-0004">Conclusion</h2>
<p class="BodyFirst">You can take many avenues for collecting OSINT. This chapter only scratches the surface of these tools’ capabilities, and it’s meant as a starting point that will help you apply OSINT techniques to social engineering, penetration testing, or any other ethical application. Through the exercises in this chapter, you’ve collected domains, IP addresses, email addresses, names, and technologies associated with businesses using open source tools. </p>
<p>The next chapter covers strategies for collecting OSINT without fancy tools. <span class="xref" itemid="xref_target_Chapter 6">Chapter 6</span> covers OSINT operations against people. </p>
</section>
</body>
</html>