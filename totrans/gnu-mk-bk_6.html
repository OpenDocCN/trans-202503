<html><head></head><body><div class="chapter" title="Chapter&#xA0;6.&#xA0;The GNU Make Standard Library"><div class="titlepage"><div><div><h1 class="title"><a id="gnu_make_standard_library"/>Chapter 6. The GNU Make Standard Library</h1></div></div></div><p><a id="iddle1317" class="indexterm"/><a id="iddle1368" class="indexterm"/>The <span class="emphasis"><em>GNU Make Standard Library (GMSL)</em></span> is a SourceForge-hosted, open source project that I started to capture common functions that makefile authors end up writing over and over again. To prevent makefile writers from reinventing the wheel, the GMSL implements common functions, such as reversing lists, uppercasing a string, or mapping a function across every element of a list.</p><p>The GMSL has list and string manipulation functions, a complete integer arithmetic library, and functions for data structures. Also included are GNU <code class="literal">make</code> implementations of associative arrays, sets, and stacks, as well as built-in debugging facilities.</p><p>In this chapter, you’ll learn how to use the functions of the GMSL in realistic makefiles. In addition, you’ll see a complete reference for the different categories of GMSL functions. For the latest revision of the GMSL, visit <span class="emphasis"><em><a class="ulink" href="http://gmsl.sf.net/">http://gmsl.sf.net/</a></em></span>.</p><div class="sect1" title="Importing the GMSL"><div class="titlepage"><div><div><h1 class="title"><a id="importing_the_gmsl"/>Importing the GMSL</h1></div></div></div><p><a id="iddle1125" class="indexterm"/><a id="iddle1127" class="indexterm"/><a id="iddle1318" class="indexterm"/><a id="iddle1319" class="indexterm"/><a id="iddle1376" class="indexterm"/><a id="iddle1379" class="indexterm"/><a id="iddle1423" class="indexterm"/>The GMSL is implemented as a pair of makefiles named <code class="literal">gmsl</code> and <code class="literal">__gmsl</code>. <code class="literal">__gmsl</code> is imported by <code class="literal">gmsl</code>, so to include the GMSL in your makefile, just add this:</p><a id="pro_id00480"/><pre class="programlisting">include gmsl</pre><p>You can do this in as many files as you want. To prevent multiple definitions and unintended error messages, the GMSL automatically detects if it has already been included.</p><p>Of course, GNU <code class="literal">make</code> must be able to find <code class="literal">gmsl</code> and <code class="literal">__gmsl</code>. To do that, GNU <code class="literal">make</code> looks for makefiles in a number of places by default, including <code class="literal">/usr/local/include</code>, <code class="literal">/usr/gnu/include/</code>, <code class="literal">/usr/include</code>, the current directory, and any directories specified by the GNU <code class="literal">make -I</code> (or <code class="literal">--include-dirL</code>) command line option.</p><p>A good place to put <code class="literal">gmsl</code> and <code class="literal">__gmsl</code> is <code class="literal">/usr/local/include</code>, where they’ll be available to all your makefiles.</p><p>If GNU <code class="literal">make</code> can’t find <code class="literal">gmsl</code> or <code class="literal">__gmsl</code>, you’ll get the regular GNU <code class="literal">make</code> error message:</p><a id="pro_id00481"/><pre class="programlisting">Makefile:1: gmsl: No such file or directory</pre><p>The GMSL uses a little trick to make the location of <code class="literal">gmsl</code> completely flexible. Because <code class="literal">gmsl</code> uses <code class="literal">include</code> to find <code class="literal">__gmsl</code>, the <code class="literal">gmsl</code> makefile needs to know where to find <code class="literal">__gmsl</code>.</p><p>Let’s suppose that <code class="literal">gmsl</code> was stored in <code class="literal">/foo</code> and included with <code class="literal">include /foo/gmsl</code>. To make this work without having to modify <code class="literal">gmsl</code> to hardcode the location of <code class="literal">__gmsl</code>, <code class="literal">gmsl</code> figures out where it’s located using <code class="literal">MAKEFILE_LIST</code> and then prepends the appropriate path to the <code class="literal">include __gmsl</code>:</p><a id="pro_id00482"/><pre class="programlisting"># Try to determine where this file is located. If the caller did
# include /foo/gmsl then extract the /foo/ so that __gmsl gets
# included transparently

__gmsl_root := $(word $(words $(MAKEFILE_LIST)),$(MAKEFILE_LIST))

# If there are any spaces in the path in __gmsl_root then give up

ifeq (1,$(words $(__gmsl_root)))
__gmsl_root := $(patsubst %gmsl,%,$(__gmsl_root))
else
__gmsl_root :=
endif

include $(__gmsl_root)__gmsl</pre><p>That’s a handy technique if you want your makefiles to be location independent.</p></div><div class="sect1" title="Calling a GMSL Function"><div class="titlepage"><div><div><h1 class="title"><a id="calling_a_gmsl_function"/>Calling a GMSL Function</h1></div></div></div><p><a id="iddle1085" class="indexterm"/><a id="iddle1102" class="indexterm"/><a id="iddle1320" class="indexterm"/><a id="iddle1371" class="indexterm"/><a id="iddle1372" class="indexterm"/>The functions in the GMSL are implemented as normal GNU <code class="literal">make</code> function declarations. For example, the function <code class="literal">last</code> (which returns the last element of a list) is declared like this:</p><a id="pro_id00483"/><pre class="programlisting">last = $(if $1,$(word $(words $1),$1))</pre><p>The function is called using GNU <code class="literal">make</code>’s built-in <code class="literal">$(call)</code>. For example, to return the last element of the list <code class="literal">1 2 3</code>, do this:</p><a id="pro_id00484"/><pre class="programlisting">$(call last,1 2 3)</pre><p>This will return <code class="literal">3</code>. <code class="literal">$(call)</code> expands the variable named in its first argument (in this case, <code class="literal">last</code>), setting special local variables (<code class="literal">$1</code>, <code class="literal">$2</code>, <code class="literal">$3</code>, . . .)to the arguments given to <code class="literal">$(call)</code> after the function name. So <code class="literal">$1</code> is <code class="literal">1 2 3</code> in this case.</p><p>The GMSL defines the Boolean values <code class="literal">true</code> and <code class="literal">false</code>, which are just variables and can be accessed using <code class="literal">$()</code> or <code class="literal">${}</code>: for example, <code class="literal">$(true)</code> or <code class="literal">${false}</code>. <code class="literal">false</code> is an empty string, and <code class="literal">true</code> is the letter <code class="literal">T</code>; these definitions correspond to GNU <code class="literal">make</code>’s notion of true (a non-empty string) and false (an empty string). You can use <code class="literal">true</code> and <code class="literal">false</code> in GNU <code class="literal">make</code>’s <code class="literal">$(if)</code> function or within a preprocessor <code class="literal">ifeq</code>:</p><a id="pro_id00485"/><pre class="programlisting">$(if $(true),It's true!,Totally false)

ifeq ($(true),$(true))
--<span class="emphasis"><em>snip</em></span>--
<span class="emphasis"><em>endif</em></span></pre><p>These examples are contrived. You’d expect the <code class="literal">$(true)</code> in the <code class="literal">$(if)</code> and the first <code class="literal">$(true)</code> in the <code class="literal">ifeq</code> to be the return values from a function call, not a constant value.</p></div><div class="sect1" title="Checking the GMSL Version"><div class="titlepage"><div><div><h1 class="title"><a id="checking_the_gmsl_version"/>Checking the GMSL Version</h1></div></div></div><p>The GMSL includes a function that you can use to check that the version included is compatible with your use of the GMSL. The function <code class="literal">gmsl_compatible</code> checks that the version number of the included GMSL is greater than or equal to the version number passed as an argument.</p><p>At the time of this writing, the current GMSL version is <code class="literal">v1.1.7</code>. To check that the included GMSL is at least, say, <code class="literal">v1.1.2</code>, call <code class="literal">gmsl_compatible</code> with a list argument containing three elements: <code class="literal">1 1 2</code>.</p><a id="pro_id00486"/><pre class="programlisting">$(call gmsl_compatible,1 1 2)</pre><p><a id="iddle1046" class="indexterm"/><a id="iddle1104" class="indexterm"/><a id="iddle1150" class="indexterm"/><a id="iddle1288" class="indexterm"/><a id="iddle1289" class="indexterm"/><a id="iddle1384" class="indexterm"/><a id="iddle1412" class="indexterm"/><a id="iddle1457" class="indexterm"/><a id="iddle1606" class="indexterm"/><a id="iddle1648" class="indexterm"/><a id="iddle1773" class="indexterm"/>This will return <code class="literal">$(true)</code> because the current GMSL is <code class="literal">v1.1.7</code>, which is greater than <code class="literal">v1.1.2</code>. If we asked for <code class="literal">v2.0.0</code>, we’d get the response <code class="literal">$(false)</code>:</p><a id="pro_id00487"/><pre class="programlisting">$(call gmsl_compatible,2 0 0)</pre><p>A simple way to make sure that you are using the right version of GMSL is to wrap the call to <code class="literal">gmsl_compatible</code> in an assertion:</p><a id="pro_id00488"/><pre class="programlisting">$(call assert,$(call gmsl_compatible,1 0 0),Wrong GMSL version)</pre><p>This will stop the <code class="literal">make</code> process with an error if an incompatible version of GMSL is found.</p></div><div class="sect1" title="Example Real-World GMSL Use"><div class="titlepage"><div><div><h1 class="title"><a id="example_real-world_gmsl_use"/>Example Real-World GMSL Use</h1></div></div></div><p>Now that you’re set up with the GMSL, let’s look at some examples. All of these solve problems that real-world makefiles have to deal with, like caseinsensitive comparisons and searching a path for a file.</p><div class="sect2" title="Case-Insensitive Comparison"><div class="titlepage"><div><div><h2 class="title"><a id="case-insensitive_comparison"/>Case-Insensitive Comparison</h2></div></div></div><p>GMSL contains two functions that let you create a simple function to do a case-insensitive comparison of two strings:</p><a id="pro_id00489"/><pre class="programlisting">ifcase = $(call seq,$(call lc,$1),$(call lc,$2))</pre><p>This works by lowercasing its two arguments (using the GMSL <code class="literal">lc</code> function) and then calling <code class="literal">seq</code> (the GMSL string equality function) to see if they are the same. Here’s one way to use <code class="literal">ifcase</code>:</p><a id="pro_id00490"/><pre class="programlisting">CPPFLAGS += $(if $(call ifcase,$(DEBUG),yes),-DDEBUG,)</pre><p>Here it’s used to see if the <code class="literal">DEBUG</code> variable has been set to <code class="literal">yes</code>; if it has, <code class="literal">-DDEBUG</code> is added to <code class="literal">CPPFLAGS</code>.</p></div><div class="sect2" title="Finding a Program on the Path"><div class="titlepage"><div><div><h2 class="title"><a id="finding_a_program_on_the_path"/>Finding a Program on the Path</h2></div></div></div><p>Here’s a function definition that will search the <code class="literal">PATH</code> for an executable:</p><a id="pro_id00491"/><pre class="programlisting">findpath = $(call first,$(call map,wildcard,$(call addsuffix,/$1,$(call split,:,$(PATH)))))</pre><p>For example, <code class="literal">$(call findpath,cat)</code> will search the <code class="literal">PATH</code> for the first <code class="literal">cat</code> program. It uses three functions from the GMSL: <code class="literal">first</code>, <code class="literal">map</code>, and <code class="literal">split</code>. It uses two built-in functions: <code class="literal">wildcard</code> and <code class="literal">addsuffix</code>.</p><p>The call to <code class="literal">split</code> breaks the <code class="literal">PATH</code> variable into a list, separating it at colons. Then the built-in <code class="literal">addsuffix</code> function is called, which adds <code class="literal">/$1</code> to each element of the <code class="literal">PATH</code>. <code class="literal">$1</code> contains the parameter to <code class="literal">findpath</code>, which is the name of the program we’re searching for (in this case, it was <code class="literal">cat</code>).</p><p><a id="iddle1067" class="indexterm"/><a id="iddle1432" class="indexterm"/><a id="iddle1522" class="indexterm"/>Then the GMSL <code class="literal">map</code> function is called to perform a built-in <code class="literal">wildcard</code> on each possible program filename. With no wildcard characters in the filename, <code class="literal">wildcard</code> will return the name of the file if it exists or an empty string. So <code class="literal">map</code> has the effect of finding the location (or locations) of <code class="literal">cat</code> on the <code class="literal">PATH</code> by testing each file in turn.</p><p>Finally, a call to the GMSL function <code class="literal">first</code> returns the first element of the list that <code class="literal">map</code> returns (the list of all <code class="literal">cat</code> programs on the <code class="literal">PATH</code>).</p><p>A debugging feature of GMSL is the ability to trace calls to GMSL functions. By setting <code class="literal">GMSL_TRACE</code> to <code class="literal">1</code>, GMSL will output each call to a GMSL function with its parameters. For example:</p><a id="pro_id00492"/><pre class="programlisting">Makefile:8: split(':', '/home/jgc/bin:/usr/local/bin:/usr/bin:/usr/X11R6/bin:/
bin:/usr/games:/opt/gnome/bin:/opt/kde3/bin:/usr/lib/java/jre/bin')
Makefile:8: map('wildcard',' /home/jgc/bin/make /usr/local/bin/make /usr/bin/
make /usr/X11R6/bin/make /bin/make /usr/games/make /opt/gnome/bin/make /opt/
kde3/bin/make /usr/lib/java/jre/bin/make')
Makefile:8: first(' /usr/bin/make')</pre><p>Here we’re searching for <code class="literal">cat</code> using the <code class="literal">findpath</code> function with tracing turned on.</p></div><div class="sect2" title="Using Assertions to Check Inputs"><div class="titlepage"><div><div><h2 class="title"><a id="using_assertions_to_check_inputs"/>Using Assertions to Check Inputs</h2></div></div></div><p>Typically, a makefile is executed specifying a goal for the build (or under the assumption that there’s an <code class="literal">all</code> target or similar at the start of the makefile). In addition, there are typically environment variables (like debug options, architecture settings, and so on) that affect the build. A quick way to check that these have been set correctly is to use GMSL assertion functions.</p><p>Here’s an example that checks that <code class="literal">DEBUG</code> has been set to <code class="literal">yes</code> or <code class="literal">no</code>, that <code class="literal">ARCH</code> contains the word <code class="literal">Linux</code>, that we’ve specified an output directory in the <code class="literal">OUTDIR</code> variable, and that that directory exists:</p><a id="pro_id00493"/><pre class="programlisting">$(call assert,$(OUTDIR),Must set OUTDIR)
$(call assert_exists,$(OUTDIR),Must set OUTDIR)
$(call assert,$(if $(call seq,$(DEBUG),yes),$(true),$(call seq,$(DEBUG),no)),DEBUG must be yes or no)
$(call assert,$(call findstring,Linux,$(ARCH)),ARCH must be Linux)</pre><p>The assertion functions will generate a fatal error if their first argument is <code class="literal">$(false)</code> (that is, an empty string).</p><p>The first assert checks that <code class="literal">$(OUTDIR)</code> has been set to something. If it has a non-empty value, the assertion passed; otherwise, an error is generated:</p><a id="pro_id00494"/><pre class="programlisting">Makefile:3: *** GNU Make Standard Library: Assertion failure: Must set OUTDIR.
Stop.</pre><p><a id="iddle1063" class="indexterm"/><a id="iddle1084" class="indexterm"/><a id="iddle1582" class="indexterm"/><a id="iddle1706" class="indexterm"/><a id="iddle1708" class="indexterm"/>The second assertion is of the form <code class="literal">assert_exists</code>, which checks to see whether its first argument exists in the file system. In this case, it checks to see whether the directory pointed to by <code class="literal">$(OUTDIR)</code> exists. It doesn’t check to see whether it’s a directory. We can add another assertion to do that, like this:</p><a id="pro_id00495"/><pre class="programlisting">$(call assert,$(wildcard $(OUTDIR)/.),OUTDIR must be a directory)</pre><p>This looks to see if <code class="literal">$(OUTDIR)</code> contains a dot (<span class="strong"><strong><code class="literal">.</code></strong></span>). If not, <code class="literal">$(OUTDIR)</code> is not a directory, and the call to <code class="literal">wildcard</code> will return an empty string, causing the assertion to fail.</p><p>The third assertion checks that <code class="literal">DEBUG</code> is either <code class="literal">yes</code> or <code class="literal">no</code> using the GMSL <code class="literal">seq</code> function to check the value. Finally, we assert using <code class="literal">findstring</code> that <code class="literal">$(ARCH)</code> must contain the word <code class="literal">Linux</code> (with the <code class="literal">L</code> capitalized).</p></div><div class="sect2" title="Is DEBUG Set to Y?"><div class="titlepage"><div><div><h2 class="title"><a id="is_debug_set_to_yquestion_mark"/>Is DEBUG Set to Y?</h2></div></div></div><p>The GMSL has the logical operators <code class="literal">and</code>, <code class="literal">or</code>, <code class="literal">xor</code>, <code class="literal">nand</code>, <code class="literal">nor</code>, <code class="literal">xnor</code>, and <code class="literal">not</code> that work with GNU <code class="literal">make</code>’s concept of truth values and the GMSL variables <code class="literal">$(true)</code> and <code class="literal">$(false)</code>.</p><p>You can use GNU <code class="literal">make</code>’s (and GMSL’s) Boolean values with both GMSL functions and GNU <code class="literal">make</code>’s built-in <code class="literal">$(if)</code>. The GMSL logical operators were designed for use with <code class="literal">$(if)</code> and the GNU <code class="literal">make</code> preprocessor <code class="literal">ifeq</code> directive.</p><p>Imagine that a makefile has a debug option, enabled by setting the <code class="literal">DEBUG</code> environment variable to <code class="literal">Y</code>. Using the GMSL function <code class="literal">seq</code> (string equal) and the <code class="literal">or</code> operator, you can easily determine whether debugging is desired or not:</p><a id="pro_id00496"/><pre class="programlisting">include gmsl

debug_needed := $(call or,$(call seq,$(DEBUG),Y),$(call seq,$(DEBUG),y))</pre><p>Because the GMSL has a lowercase function (<code class="literal">lc</code>), you can write this example without the <code class="literal">or</code>:</p><a id="pro_id00497"/><pre class="programlisting">include gmsl

debug_needed := $(call seq,$(call lc,$(DEBUG)),y)</pre><p>But the logical operator <code class="literal">or</code> lets us be even more generous and accept <code class="literal">YES</code> as well as <code class="literal">Y</code> for the debug option:</p><a id="pro_id00498"/><pre class="programlisting">include gmsl

debug_needed := $(call or,$(call seq,$(call lc,$(DEBUG)),y),$(call seq,$(call lc,$(DEBUG)),yes))</pre><p>The function <code class="literal">debug_needed</code> is case insensitive too.</p></div><div class="sect2" title="Is DEBUG Set to Y or N?"><div class="titlepage"><div><div><h2 class="title"><a id="is_debug_set_to_y_or_nquestion_mark"/>Is DEBUG Set to Y or N?</h2></div></div></div><p><a id="iddle1414" class="indexterm"/><a id="iddle1415" class="indexterm"/><a id="iddle1422" class="indexterm"/><a id="iddle1487" class="indexterm"/><a id="iddle1632" class="indexterm"/>Another possible use of the logical operators is to force the user of the makefile to set <code class="literal">DEBUG</code> to either <code class="literal">Y</code> or <code class="literal">N</code>, thus avoiding problems if they forget about the debug option. The GMSL assertion function <code class="literal">assert</code> will output a fatal error if its argument is not true. So we can use it to assert that <code class="literal">DEBUG</code> must be <code class="literal">Y</code> or <code class="literal">N</code>:</p><a id="pro_id00499"/><pre class="programlisting">include gmsl

$(call assert,$(call or,$(call seq,$(DEBUG),Y),$(call seq,$(DEBUG),N)),DEBUG must be Y or N)</pre><p>Here’s an example:</p><a id="pro_id00500"/><pre class="programlisting">$ <span class="strong"><strong>make DEBUG=Oui</strong></span>
Makefile:1: *** GNU Make Standard Library: Assertion failure: DEBUG must be Y or N.
Stop.</pre><p>The assertion generates this error if the user makes the mistake of setting <code class="literal">DEBUG</code> to <code class="literal">Oui</code>.</p></div><div class="sect2" title="Using Logical Operators in the Preprocessor"><div class="titlepage"><div><div><h2 class="title"><a id="using_logical_operators_in_the_preproces"/>Using Logical Operators in the Preprocessor</h2></div></div></div><p>Because GNU <code class="literal">make</code>’s preprocessor (which has <code class="literal">ifeq</code>, <code class="literal">ifneq</code>, and <code class="literal">ifdef</code> directives) doesn’t have any logical operations, it’s difficult to write a complex statement. For example, to define a section of a makefile if <code class="literal">DEBUG</code> is set to <code class="literal">Y</code> or <code class="literal">Yes</code> in GNU <code class="literal">make</code>, you must either duplicate a section of code (yuck!) or write a statement that’s hard to understand:</p><a id="pro_id00501"/><pre class="programlisting">ifeq ($(DEBUG),$(filter $(DEBUG),Y Yes))
--<span class="emphasis"><em>snip</em></span>--
endif</pre><p>This works by filtering the list <code class="literal">Y Yes</code> with the value of <code class="literal">$(DEBUG)</code>, which returns an empty list if <code class="literal">$(DEBUG)</code> is not <code class="literal">Y</code> or <code class="literal">Yes</code>, or returns the value of <code class="literal">$(DEBUG)</code> if it is. The <code class="literal">ifeq</code> then compares the resulting value with <code class="literal">$(DEBUG)</code>. That’s pretty ugly, hard to maintain, and contains a subtle bug. (What happens if <code class="literal">$(DEBUG)</code> is empty? Hint: empty is the same as <code class="literal">Y</code> or <code class="literal">Yes</code>.) Fixing the bug means doing something like this:</p><a id="pro_id00502"/><pre class="programlisting">ifeq (x$(DEBUG)x,$(filter x$(DEBUG)x,xYx xYesx))
--<span class="emphasis"><em>snip</em></span>--
endif</pre><p>The GMSL <code class="literal">or</code> operator makes this much clearer:</p><a id="pro_id00503"/><pre class="programlisting">include gmsl

ifeq ($(true),$(call or,$(call seq,$(DEBUG),Y),$(call seq,$(DEBUG),Yes)))
--<span class="emphasis"><em>snip</em></span>--
endif</pre><p><a id="iddle1229" class="indexterm"/><a id="iddle1473" class="indexterm"/><a id="iddle1601" class="indexterm"/><a id="iddle1788" class="indexterm"/><a id="iddle1843" class="indexterm"/><a id="iddle1850" class="indexterm"/><a id="iddle1852" class="indexterm"/><a id="iddle1893" class="indexterm"/><a id="iddle1895" class="indexterm"/>This is much more maintainable. It works by <code class="literal">or</code>ing two calls to <code class="literal">seq</code> and comparing the result with <code class="literal">$(true)</code>.</p></div><div class="sect2" title="Removing Duplicates from a List"><div class="titlepage"><div><div><h2 class="title"><a id="removing_duplicates_from_a_list"/>Removing Duplicates from a List</h2></div></div></div><p>The GMSL function <code class="literal">uniq</code> removes duplicates from a list. GNU <code class="literal">make</code> has a built-in <code class="literal">sort</code> function that sorts a list and removes duplicates; <code class="literal">uniq</code> removes duplicates without sorting the list (which can be handy if list order is important).</p><p>For example, <code class="literal">$(sort c b a a c)</code> will return <code class="literal">a b c</code>, whereas <code class="literal">$(call uniq,c b a a c)</code> returns <code class="literal">c b a</code>.</p><p>Say you need to simplify the <code class="literal">PATH</code> variable by removing duplicate entries while preserving the order. The <code class="literal">PATH</code> is typically a colon-separated list of paths (like <code class="literal">/usr/bin:/bin:/usr/local/bin:/bin</code>). Here <code class="literal">simple-path</code> is the <code class="literal">PATH</code> with duplicates removed and order preserved:</p><a id="pro_id00504"/><pre class="programlisting">include gmsl

simple-path := $(call merge,:,$(call uniq,$(call split,:,$(PATH))))</pre><p>This uses three GMSL functions: <code class="literal">uniq</code>, <code class="literal">split</code> (which splits a string into a list at a certain separator character; in this case, a colon), and <code class="literal">merge</code> (which merges a list into a string separating list entries with a character; in this case, a colon).</p></div><div class="sect2" title="Automatically Incrementing a Version Number"><div class="titlepage"><div><div><h2 class="title"><a id="automatically_incrementing_a_version_num"/>Automatically Incrementing a Version Number</h2></div></div></div><p>When it’s release time for a piece of software, it’s handy to have a way to increment the version number automatically. Suppose that a project contains a file called <code class="literal">version.c</code> that contains the current version number as a string:</p><a id="pro_id00505"/><pre class="programlisting">char * ver = "1.0.0";</pre><p>It would be ideal to just type <code class="literal">make major-release</code>, <code class="literal">make minor-release</code>, or <code class="literal">make dot-release</code> and have one of the three parts of the version number automatically update and the <code class="literal">version.c</code> file change.</p><p>Here’s how to do that:</p><a id="pro_id00506"/><pre class="programlisting">   VERSION_C := version.c
   VERSION := $(shell cat $(VERSION_C))

   space :=
   space +=

   PARTS := $(call split,",$(subst $(space),,$(VERSION)))

   VERSION_NUMBER := $(call split,.,$(word 2,$(PARTS)))
   MAJOR := $(word 1,$(VERSION_NUMBER))
   MINOR := $(word 2,$(VERSION_NUMBER))
   DOT := $(word 3,$(VERSION_NUMBER))
   major-release minor-release dot-release:
➊ → @$(eval increment_name := $(call uc,$(subst -release,,$@)))
➋ → @$(eval $(increment_name) := $(call inc,$($(increment_name))))
➌ → @echo 'char * ver = "$(MAJOR).$(MINOR).$(DOT)";' &gt; $(VERSION_C)</pre><p>The <code class="literal">VERSION</code> variable contains the contents of the <code class="literal">version.c</code> file, which will be something like <code class="literal">char * ver = "1.0.0";</code>. The <code class="literal">PARTS</code> variable is a list created by first removing all the whitespace from <code class="literal">VERSION</code> and then splitting on the double quotes. That splits <code class="literal">VERSION</code> into the list <code class="literal">char*ver= 1.0.0 ;</code>.</p><p>So <code class="literal">PARTS</code> is a list with three elements, and the second element is the current version number, which is extracted into <code class="literal">VERSION_NUMBER</code> and turned into a list of three elements: <code class="literal">1 0 0</code>.</p><p>Next, variables called <code class="literal">MAJOR</code>, <code class="literal">MINOR</code>, and <code class="literal">DOT</code> are extracted from <code class="literal">VERSION_NUMBER</code>. If the version number in <code class="literal">version.c</code> was <code class="literal">1.2.3</code>, then <code class="literal">MAJOR</code> will be <code class="literal">1</code>, <code class="literal">MINOR</code> will be <code class="literal">2</code>, and <code class="literal">DOT</code> will be <code class="literal">3</code>.</p><p>Finally, three rules are defined for major, minor, and dot releases. These use some <code class="literal">$(eval)</code> trickery to use the same rule body to update the major, minor, or dot release number depending on which of <code class="literal">major-release</code>, <code class="literal">minor-release</code>, or <code class="literal">dot-release</code> was specified on the command line.</p><p>To understand how it works, follow what happens when you do <code class="literal">make minor-release</code> with an existing version number of <code class="literal">1.0.0</code>.</p><p>The <code class="literal">$(eval increment_name := $(call uc,$(subst -release,,$@)))</code> ➊ first uses <code class="literal">$(subst)</code> to remove <code class="literal">-release</code> from the target name (so <code class="literal">minor-release</code> becomes simply <code class="literal">minor</code>).</p><p>Then it calls the GMSL <code class="literal">uc</code> function (which uppercases a string) to turn <code class="literal">minor</code> into <code class="literal">MINOR</code>. It stores that in a variable called <code class="literal">increment-name</code>. Here’s the tricky part: <code class="literal">increment-name</code> will be used as the name of a variable to increment (one of <code class="literal">MAJOR</code>, <code class="literal">MINOR</code>, or <code class="literal">DOT</code>).</p><p>At ➋, <code class="literal">$(eval $(increment_name) := $(call inc,$($(increment_name))))</code> actually does that work. It uses the GMSL <code class="literal">inc</code> function to increment the value stored in the variable whose name is in <code class="literal">increment-name</code> (notice the <code class="literal">$($(increment-name))</code>, which finds the value of a variable whose name is in another variable) and then sets that value to the incremented value.</p><p>Finally, it just creates a new <code class="literal">version.c</code> containing the new version number ➌. For example:</p><a id="pro_id00507"/><pre class="programlisting">$ <span class="strong"><strong>make -n major-release</strong></span>
echo 'char * ver = "2.0.0";' &gt; version.c
$ <span class="strong"><strong>make -n minor-release</strong></span>
echo 'char * ver = "1.1.0";' &gt; version.c
$ <span class="strong"><strong>make -n dot-release</strong></span>
echo 'char * ver = "1.0.1";' &gt; version.c</pre><p>This is the result of using the <code class="literal">-n</code> option when starting from version 1.0.0 and asking for the different possible releases.</p></div></div><div class="sect1" title="GMSL Reference"><div class="titlepage"><div><div><h1 class="title"><a id="gmsl_reference"/>GMSL Reference</h1></div></div></div><p><a id="iddle1166" class="indexterm"/><a id="iddle1332" class="indexterm"/><a id="iddle1381" class="indexterm"/><a id="iddle1486" class="indexterm"/><a id="iddle1497" class="indexterm"/>This section is a complete reference for the GNU Make Standard Library version 1.1.7 and covers GMSL logical operators; integer functions; list, string, and set manipulation functions; associative arrays; and named stacks. For each category of GMSL functions, you’ll see an introduction to the functions, followed by a quick reference section that lists arguments and returns. For the latest version of the complete reference, check the GMSL website at <span class="emphasis"><em><a class="ulink" href="http://gmsl.sf.net/">http://gmsl.sf.net/</a></em></span>.</p><p>If you’re interested in advanced GNU <code class="literal">make</code> programming, it’s worth studying the source code of the GMSL (especially the file <code class="literal">__gmsl</code>). The techniques used to create individual GMSL functions are often useful in other situations.</p><div class="sect2" title="Logical Operators"><div class="titlepage"><div><div><h2 class="title"><a id="logical_operators"/>Logical Operators</h2></div></div></div><p>GMSL has Booleans <code class="literal">$(true)</code>, a non-empty string actually set to the single character <code class="literal">T</code>, and <code class="literal">$(false)</code>, an empty string. You can use the following operators with those variables or with functions that return those values.</p><p>Although these functions are consistent in that they always return <code class="literal">$(true)</code> or <code class="literal">$(false)</code>, they are lenient about accepting any non-empty string that indicates <span class="emphasis"><em>true</em></span>. For example:</p><a id="pro_id00508"/><pre class="programlisting">$(call or,$(wildcard /tmp/foo),$(wildcard /tmp/bar))</pre><p>This tests for the existence of either of two files, <code class="literal">/tmp/foo</code> and <code class="literal">/tmp/bar</code>, using <code class="literal">$(wildcard)</code> and the GMSL <code class="literal">or</code> function. Doing <code class="literal">$(wildcard /tmp/foo)</code> will return <code class="literal">/tmp/foo</code> if the file exists or an empty string if not. So the output of the <code class="literal">$(wildcard /tmp/foo)</code> can be fed directly into <code class="literal">or</code>, where <code class="literal">/tmp/foo</code> will be interpreted as <span class="emphasis"><em>true</em></span> and an empty string as <span class="emphasis"><em>false</em></span>.</p><p>If you feel more comfortable working exclusively with values like <code class="literal">$(true)</code> and <code class="literal">$(false)</code>, define a <code class="literal">make-bool</code> function like this:</p><a id="pro_id00509"/><pre class="programlisting">make-bool = $(if $(strip $1),$(true),$(false))</pre><p>This will turn any non-empty string (after stripping off whitespace) into <code class="literal">$(true)</code> and leave a blank string (or one that had only whitespace in it) as <code class="literal">$(false)</code>. <code class="literal">make-bool</code> can be handy when whitespace might slip into values returned by functions.</p><p>For example, here’s a small GNU <code class="literal">make</code> variable that is <code class="literal">$(true)</code> if the current month is January:</p><a id="pro_id00510"/><pre class="programlisting">january-now := $(call make-bool,$(filter Jan,$(shell date)))</pre><p>This runs the <code class="literal">date</code> shell command, extracts the word <code class="literal">Jan</code>, and turns it into a truth value using <code class="literal">make-bool</code>. Using <code class="literal">$(filter)</code> like this treats the result of <code class="literal">date</code> as a list and then filters out any word in the list that is not <code class="literal">Jan</code>. This technique can be handy in other situations for extracting parts of a string.</p><p><a id="iddle1050" class="indexterm"/><a id="iddle1570" class="indexterm"/><a id="iddle1581" class="indexterm"/><a id="iddle1933" class="indexterm"/>You can make a generic function to discover if a list contains a word:</p><a id="pro_id00511"/><pre class="programlisting">contains-word = $(call make-bool,$(filter $1,$2))
january-now := $(call contains-word,Jan,$(shell date))</pre><p>Using <code class="literal">contains-word</code>, you can redefine <code class="literal">january-now</code>.</p><div class="sect3" title="not"><div class="titlepage"><div><div><h3 class="title"><a id="not"/>not</h3></div></div></div><p>The GMSL includes all the common logical operators. The simplest is the <code class="literal">not</code> function, which logically negates its argument:</p><a id="pro_id00512"/><pre class="programlisting"><span class="strong"><strong>not</strong></span>

Argument: A single boolean value
Returns:  $(true) if the boolean is $(false) and vice versa</pre><p>For example, <code class="literal">$(call not,$(true))</code> returns <code class="literal">$(false)</code>.</p></div><div class="sect3" title="and"><div class="titlepage"><div><div><h3 class="title"><a id="and"/>and</h3></div></div></div><p>The <code class="literal">and</code> function returns <code class="literal">$(true)</code> if (and only if) both its arguments are true:</p><a id="pro_id00513"/><pre class="programlisting"><span class="strong"><strong>and</strong></span>

Arguments: Two boolean values
Returns:   $(true) if both of the arguments are $(true)</pre><p>For example, <code class="literal">$(call and,$(true),$(false))</code> returns <code class="literal">$(false)</code>.</p></div><div class="sect3" title="or"><div class="titlepage"><div><div><h3 class="title"><a id="or"/>or</h3></div></div></div><p>The <code class="literal">or</code> function returns <code class="literal">$(true)</code> if either of its arguments is true:</p><a id="pro_id00514"/><pre class="programlisting"><span class="strong"><strong>or</strong></span>

Arguments: Two boolean values
Returns:   $(true) if either of the arguments is $(true)</pre><p>For example, <code class="literal">$(call or,$(true),$(false))</code> returns <code class="literal">$(true)</code>.</p></div><div class="sect3" title="xor"><div class="titlepage"><div><div><h3 class="title"><a id="xor"/>xor</h3></div></div></div><p>The <code class="literal">xor</code> function is <span class="emphasis"><em>exclusive or</em></span>:</p><a id="pro_id00515"/><pre class="programlisting"><span class="strong"><strong>xor</strong></span>

Arguments: Two boolean values
Returns:   $(true) if exactly one of the booleans is true</pre><p>For example, <code class="literal">$(call xor,$(true),$(false))</code> returns <code class="literal">$(true)</code>.</p></div><div class="sect3" title="nand"><div class="titlepage"><div><div><h3 class="title"><a id="nand"/>nand</h3></div></div></div><p><a id="iddle1329" class="indexterm"/><a id="iddle1377" class="indexterm"/><a id="iddle1437" class="indexterm"/><a id="iddle1445" class="indexterm"/><a id="iddle1553" class="indexterm"/><a id="iddle1564" class="indexterm"/><a id="iddle1623" class="indexterm"/><a id="iddle1743" class="indexterm"/><code class="literal">nand</code> is simply <span class="emphasis"><em>not and</em></span>:</p><a id="pro_id00516"/><pre class="programlisting"><span class="strong"><strong>nand</strong></span>

Arguments: Two boolean values
Returns:   Value of 'not and'</pre><p>For example, <code class="literal">$(call nand,$(true),$(false))</code> returns <code class="literal">$(true)</code> where <code class="literal">$(call and,$(true),$(false))</code> returns <code class="literal">$(false)</code>.</p></div><div class="sect3" title="nor"><div class="titlepage"><div><div><h3 class="title"><a id="nor"/>nor</h3></div></div></div><p><code class="literal">nor</code> is simply <span class="emphasis"><em>not or</em></span>:</p><a id="pro_id00517"/><pre class="programlisting"><span class="strong"><strong>nor</strong></span>

Arguments: Two boolean values
Returns:   Value of 'not or'</pre><p>For example, <code class="literal">$(call nor,$(true),$(false))</code> returns <code class="literal">$(false)</code> where <code class="literal">$(call or,$(true),$(false))</code> returns <code class="literal">$(true)</code>.</p></div><div class="sect3" title="xnor"><div class="titlepage"><div><div><h3 class="title"><a id="xnor"/>xnor</h3></div></div></div><p>The rarely used <code class="literal">xnor</code> is <span class="emphasis"><em>not xor</em></span>:</p><a id="pro_id00518"/><pre class="programlisting"><span class="strong"><strong>xnor</strong></span>

Arguments: Two boolean values
Returns:   Value of 'not xor'</pre><p>Note that the GMSL logical functions <code class="literal">and</code> and <code class="literal">or</code> are not <span class="emphasis"><em>short circuiting</em></span>; both of the arguments to those functions are expanded before performing the logical <code class="literal">and</code> or <code class="literal">or</code>. GNU <code class="literal">make</code> 3.81 introduced built-in <code class="literal">and</code> and <code class="literal">or</code> functions that are short circuiting: they evaluate their first argument and then decide whether it’s necessary to evaluate their second.</p></div></div><div class="sect2" title="Integer Arithmetic Functions"><div class="titlepage"><div><div><h2 class="title"><a id="integer_arithmetic_functions"/>Integer Arithmetic Functions</h2></div></div></div><p>In <a class="xref" href="ch05.html" title="Chapter 5. Pushing the Envelope">Chapter 5</a>, you saw how to perform arithmetic inside GNU <code class="literal">make</code> by representing non-negative integers as lists of <code class="literal">x</code>s. For example, 4 is <code class="literal">x x x x</code>. GMSL uses the same representation for integers and provides a wide range of functions for integer calculations.</p><p>The arithmetic library functions come in two forms: one form of each function takes integers as arguments, and the other form takes encoded arguments (<code class="literal">x</code>s created by a call to <code class="literal">int_encode</code>). For example, there are two <code class="literal">plus</code> functions: <code class="literal">plus</code> (called with integer arguments, returns an integer) and <code class="literal">int_plus</code> (called with encoded arguments, returns an encoded result).</p><p><a id="iddle1434" class="indexterm"/><a id="iddle1439" class="indexterm"/><code class="literal">plus</code> will be slower than <code class="literal">int_plus</code> because its arguments and result must be translated between the <code class="literal">x</code> format and integers. If you’re doing a complex calculation, use the <code class="literal">int_*</code> forms with a single encoding of inputs and single decoding of the output. For simple calculations, you can use the direct forms.</p><div class="sect3" title="int_decode"><div class="titlepage"><div><div><h3 class="title"><a id="intunderscoredecode"/>int_decode</h3></div></div></div><p>The <code class="literal">int_decode</code> function takes a number in <code class="literal">x</code>-representation and returns the decimal integer that it represents:</p><a id="pro_id00519"/><pre class="programlisting"><span class="strong"><strong>int_decode</strong></span>

Arguments: 1: A number in x-representation
Returns:   The integer for human consumption that is represented
           by the string of x's</pre></div><div class="sect3" title="int_encode"><div class="titlepage"><div><div><h3 class="title"><a id="intunderscoreencode"/>int_encode</h3></div></div></div><p><code class="literal">int_encode</code> is the opposite of <code class="literal">int_decode</code>: it takes a decimal integer and returns the <code class="literal">x</code>-representation:</p><a id="pro_id00520"/><pre class="programlisting"><span class="strong"><strong>int_encode</strong></span>

Arguments: 1: A number in human-readable integer form
Returns:   The integer encoded as a string of x's</pre></div><div class="sect3" title="int_plus"><div class="titlepage"><div><div><h3 class="title"><a id="intunderscoreplus"/>int_plus</h3></div></div></div><p><code class="literal">int_plus</code> adds two numbers in <code class="literal">x</code>-representation together and returns their sum in <code class="literal">x</code>-representation:</p><a id="pro_id00521"/><pre class="programlisting"><span class="strong"><strong>int_plus</strong></span>

Arguments: 1: A number in x-representation
           2: Another number in x-representation
Returns:   The sum of the two numbers in x-representation</pre></div><div class="sect3" title="plus"><div class="titlepage"><div><div><h3 class="title"><a id="plus"/>plus</h3></div></div></div><p>To add decimal integers, use the <code class="literal">plus</code> function, which converts to and from <code class="literal">x</code>-representation and calls <code class="literal">int_plus</code>:</p><a id="pro_id00522"/><pre class="programlisting"><span class="strong"><strong>plus</strong></span> (wrapped version of int_plus)

Arguments: 1: An integer
           2: Another integer
Returns:   The sum of the two integers</pre></div><div class="sect3" title="int_subtract"><div class="titlepage"><div><div><h3 class="title"><a id="intunderscoresubtract"/>int_subtract</h3></div></div></div><p><a id="iddle1444" class="indexterm"/><a id="iddle1446" class="indexterm"/><a id="iddle1548" class="indexterm"/><a id="iddle1803" class="indexterm"/><code class="literal">int_subtract</code> subtracts two numbers in <code class="literal">x</code>-representation and returns the difference in <code class="literal">x</code>-representation:</p><a id="pro_id00523"/><pre class="programlisting"><span class="strong"><strong>int_subtract</strong></span>

Arguments: 1: A number in x-representation
           2: Another number in x-representation
Returns:   The difference of the two numbers in x-representation,
           or outputs an error on a numeric underflow</pre><p>If the difference will be less than 0 (which can’t be represented), an error occurs.</p></div><div class="sect3" title="subtract"><div class="titlepage"><div><div><h3 class="title"><a id="subtract"/>subtract</h3></div></div></div><p>To subtract decimal integers, use the <code class="literal">subtract</code> function, which converts to and from <code class="literal">x</code>-representation and calls <code class="literal">int_subtract</code>:</p><a id="pro_id00524"/><pre class="programlisting"><span class="strong"><strong>subtract</strong></span> (wrapped version of int_subtract)

Arguments: 1: An integer
           2: Another integer
Returns:   The difference of the two integers, or outputs an error on a
           numeric underflow</pre><p>If the difference will be less than 0 (which can’t be represented), an error occurs.</p></div><div class="sect3" title="int_multiply"><div class="titlepage"><div><div><h3 class="title"><a id="intunderscoremultiply"/>int_multiply</h3></div></div></div><p><code class="literal">int_multiply</code> multiplies two numbers that are in <code class="literal">x</code>-representation:</p><a id="pro_id00525"/><pre class="programlisting"><span class="strong"><strong>int_multiply</strong></span>

Arguments: 1: A number in x-representation
           2: Another number in x-representation
Returns:   The product of the two numbers in x-representation</pre></div><div class="sect3" title="multiply"><div class="titlepage"><div><div><h3 class="title"><a id="multiply"/>multiply</h3></div></div></div><p><code class="literal">multiply</code> will multiply two decimal integers and return their product. It automatically converts to and from <code class="literal">x</code>-representation and calls <code class="literal">int_multiply</code>:</p><a id="pro_id00526"/><pre class="programlisting"><span class="strong"><strong>multiply</strong></span> (wrapped version of int_multiply)

Arguments: 1: An integer
           2: Another integer
Returns:   The product of the two integers</pre></div><div class="sect3" title="int_divide"><div class="titlepage"><div><div><h3 class="title"><a id="intunderscoredivide"/>int_divide</h3></div></div></div><p><a id="iddle1218" class="indexterm"/><a id="iddle1435" class="indexterm"/><a id="iddle1442" class="indexterm"/><a id="iddle1443" class="indexterm"/><a id="iddle1527" class="indexterm"/><a id="iddle1538" class="indexterm"/><code class="literal">int_divide</code> divides one number by another; both are in <code class="literal">x</code>-representation, as is the result:</p><a id="pro_id00527"/><pre class="programlisting"><span class="strong"><strong>int_divide</strong></span>
Arguments: 1: A number in x-representation
           2: Another number in x-representation
Returns:   The result of integer division of argument 1 divided
           by argument 2 in x-representation</pre></div><div class="sect3" title="divide"><div class="titlepage"><div><div><h3 class="title"><a id="divide"/>divide</h3></div></div></div><p>The <code class="literal">divide</code> function calls <code class="literal">int_divide</code> to divide two decimal integers, automatically converting to and from <code class="literal">x</code>-representation:</p><a id="pro_id00528"/><pre class="programlisting"><span class="strong"><strong>divide</strong></span> (wrapped version of int_divide)

Arguments: 1: An integer
           2: Another integer
Returns:   The integer division of the first argument by the second</pre></div><div class="sect3" title="int_max and int_min"><div class="titlepage"><div><div><h3 class="title"><a id="intunderscoremax_and_intunderscoremin"/>int_max and int_min</h3></div></div></div><p><code class="literal">int_max</code> and <code class="literal">int_min</code> return the maximum and minimum, respectively, of two numbers in <code class="literal">x</code>-representation:</p><a id="pro_id00529"/><pre class="programlisting"><span class="strong"><strong>int_max</strong></span>, <span class="strong"><strong>int_min</strong></span>

Arguments: 1: A number in x-representation
           2: Another number in x-representation
Returns:   The maximum or minimum of its arguments in x-representation</pre></div><div class="sect3" title="max and min"><div class="titlepage"><div><div><h3 class="title"><a id="max_and_min"/>max and min</h3></div></div></div><p>The decimal integer equivalents of <code class="literal">int_max</code> and <code class="literal">int_min</code> are <code class="literal">max</code> and <code class="literal">min</code>; they automatically convert to and from <code class="literal">x</code>-representation:</p><a id="pro_id00530"/><pre class="programlisting"><span class="strong"><strong>max</strong></span>, <span class="strong"><strong>min</strong></span>

Arguments: 1: An integer
           2: Another integer
Returns:   The maximum or minimum of its integer arguments</pre></div><div class="sect3" title="int_inc"><div class="titlepage"><div><div><h3 class="title"><a id="intunderscoreinc"/>int_inc</h3></div></div></div><p><a id="iddle1178" class="indexterm"/><a id="iddle1225" class="indexterm"/><a id="iddle1402" class="indexterm"/><a id="iddle1424" class="indexterm"/><a id="iddle1433" class="indexterm"/><a id="iddle1436" class="indexterm"/><a id="iddle1441" class="indexterm"/><code class="literal">int_inc</code> is a small helper function that just adds one to an <code class="literal">x</code>-representation number:</p><a id="pro_id00531"/><pre class="programlisting"><span class="strong"><strong>int_inc</strong></span>

Arguments: 1: A number in x-representation
Returns:   The number incremented by 1 in x-representation</pre></div><div class="sect3" title="inc"><div class="titlepage"><div><div><h3 class="title"><a id="inc"/>inc</h3></div></div></div><p>The <code class="literal">inc</code> function adds one to a decimal integer:</p><a id="pro_id00532"/><pre class="programlisting"><span class="strong"><strong>inc</strong></span>

Arguments: 1: An integer
Returns:   The argument incremented by 1</pre></div><div class="sect3" title="int_dec"><div class="titlepage"><div><div><h3 class="title"><a id="intunderscoredec"/>int_dec</h3></div></div></div><p>The opposite of <code class="literal">int_inc</code> is <code class="literal">int_dec</code>: it decreases a number by one:</p><a id="pro_id00533"/><pre class="programlisting"><span class="strong"><strong>int_dec</strong></span>

Arguments: 1: A number in x-representation
Returns:   The number decremented by 1 in x-representation</pre></div><div class="sect3" title="dec"><div class="titlepage"><div><div><h3 class="title"><a id="dec"/>dec</h3></div></div></div><p>The <code class="literal">dec</code> function decrements a decimal integer by one:</p><a id="pro_id00534"/><pre class="programlisting"><span class="strong"><strong>dec</strong></span>

Arguments: 1: An integer
Returns:   The argument decremented by 1</pre></div><div class="sect3" title="int_double"><div class="titlepage"><div><div><h3 class="title"><a id="intunderscoredouble"/>int_double</h3></div></div></div><p>The <code class="literal">double</code> and <code class="literal">halve</code> functions (and their <code class="literal">int_double</code> and <code class="literal">int_halve</code> equivalents) are provided for performance reasons. If you’re multiplying by two or dividing by two, these functions will be faster than multiplication and division.</p><p><code class="literal">int_double</code> will double an integer:</p><a id="pro_id00535"/><pre class="programlisting"><span class="strong"><strong>int_double</strong></span>

Arguments: 1: A number in x-representation
Returns:   The number doubled (* 2) and returned in x-representation</pre></div><div class="sect3" title="double"><div class="titlepage"><div><div><h3 class="title"><a id="double"/>double</h3></div></div></div><p><a id="iddle1151" class="indexterm"/><a id="iddle1226" class="indexterm"/><a id="iddle1330" class="indexterm"/><a id="iddle1378" class="indexterm"/><a id="iddle1403" class="indexterm"/><a id="iddle1438" class="indexterm"/><a id="iddle1440" class="indexterm"/><code class="literal">double</code> will double a decimal integer:</p><a id="pro_id00536"/><pre class="programlisting"><span class="strong"><strong>double</strong></span>

Arguments: 1: An integer
Returns:   The integer times 2</pre><p>Internally, it converts to <code class="literal">x</code>-representation and calls <code class="literal">int_double</code>.</p></div><div class="sect3" title="int_halve"><div class="titlepage"><div><div><h3 class="title"><a id="intunderscorehalve"/>int_halve</h3></div></div></div><p>You can perform an integer division by two by calling <code class="literal">int_halve</code> on an <code class="literal">x</code>-representation number:</p><a id="pro_id00537"/><pre class="programlisting"><span class="strong"><strong>int_halve</strong></span>

Arguments: 1: A number in x-representation
Returns:   The number halved (/ 2) and returned in x-representation</pre></div><div class="sect3" title="halve"><div class="titlepage"><div><div><h3 class="title"><a id="halve"/>halve</h3></div></div></div><p>Finally, there’s <code class="literal">halve</code>:</p><a id="pro_id00538"/><pre class="programlisting"><span class="strong"><strong>halve</strong></span>

Arguments: 1: An integer
Returns:   The integer divided by 2</pre><p>This is the decimal integer equivalent of <code class="literal">int_halve</code>.</p></div></div><div class="sect2" title="Integer Comparison Functions"><div class="titlepage"><div><div><h2 class="title"><a id="integer_comparison_functions"/>Integer Comparison Functions</h2></div></div></div><p>All the integer comparison functions return <code class="literal">$(true)</code> or <code class="literal">$(false)</code>:</p><a id="pro_id00539"/><pre class="programlisting"><span class="strong"><strong>int_gt</strong></span>, <span class="strong"><strong>int_gte</strong></span>, <span class="strong"><strong>int_lt</strong></span>, <span class="strong"><strong>int_lte</strong></span>, <span class="strong"><strong>int_eq</strong></span>, <span class="strong"><strong>int_ne</strong></span>

Arguments: Two x-representation numbers to be compared
Returns:   $(true) or $(false)

int_gt  First argument is greater than second argument
int_gte First argument is greater than or equal to second argument
int_lt  First argument is less than second argument
int_lte First argument is less than or equal to second argument
int_eq  First argument is numerically equal to the second argument
int_ne  First argument is not numerically equal to the second argument</pre><p>These can be used with GNU <code class="literal">make</code> and GMSL functions as well as with directives that expect Boolean values (such as the GMSL logical operators).</p><p><a id="iddle1082" class="indexterm"/><a id="iddle1175" class="indexterm"/><a id="iddle1176" class="indexterm"/><a id="iddle1177" class="indexterm"/><a id="iddle1179" class="indexterm"/><a id="iddle1334" class="indexterm"/><a id="iddle1382" class="indexterm"/><a id="iddle1408" class="indexterm"/><a id="iddle1540" class="indexterm"/><a id="iddle1576" class="indexterm"/><a id="iddle1709" class="indexterm"/>But you are more likely to use these versions of the comparison functions:</p><a id="pro_id00540"/><pre class="programlisting"><span class="strong"><strong>gt</strong></span>, <span class="strong"><strong>gte</strong></span>, <span class="strong"><strong>lt</strong></span>, <span class="strong"><strong>lte</strong></span>, <span class="strong"><strong>eq</strong></span>, <span class="strong"><strong>ne</strong></span>

Arguments: Two integers to be compared
Returns:   $(true) or $(false)

int_gt  First argument is greater than second argument
int_gte First argument is greater than or equal to second argument
int_lt  First argument is less than second argument
int_lte First argument is less than or equal to second argument
int_eq  First argument is numerically equal to the second argument
int_ne  First argument is not numerically equal to the second argument</pre><p>These operate on decimal integers, not the internal <code class="literal">x</code>-representation that GMSL uses.</p></div><div class="sect2" title="Miscellaneous Integer Functions"><div class="titlepage"><div><div><h2 class="title"><a id="miscellaneous_integer_functions"/>Miscellaneous Integer Functions</h2></div></div></div><p>Most likely, you’re not going to need to do anything advanced with GNU <code class="literal">make</code> arithmetic, but the miscellaneous functions detailed here do base conversions and generation of numeric sequences. They can, on occasion, be useful.</p><div class="sect3" title="sequence"><div class="titlepage"><div><div><h3 class="title"><a id="sequence"/>sequence</h3></div></div></div><p>You use the <code class="literal">sequence</code> function to generate a sequence of numbers:</p><a id="pro_id00541"/><pre class="programlisting"><span class="strong"><strong>sequence</strong></span>

Arguments: 1: An integer
           2: An integer
Returns:   The sequence [arg1 arg2] if arg1 &gt;= arg2 or [arg2 arg1] if arg2 &gt; arg1</pre><p>For example, <code class="literal">$(call sequence,10,15)</code> will be the list <code class="literal">10 11 12 13 14 15</code>. To create a decreasing sequence, you invert the parameters to <code class="literal">sequence</code>. For example, <code class="literal">$(call sequence,15,10)</code> will be the list <code class="literal">15 14 13 12 11 10</code>.</p></div><div class="sect3" title="dec2hex, dec2bin, and dec2oct"><div class="titlepage"><div><div><h3 class="title"><a id="dec2hexcomma_dec2bincomma_and_dec2oct"/>dec2hex, dec2bin, and dec2oct</h3></div></div></div><p>The <code class="literal">dec2hex</code>, <code class="literal">dec2bin</code>, and <code class="literal">dec2oct</code> functions perform conversion between decimal numbers and hexadecimal, binary, and octal forms:</p><a id="pro_id00542"/><pre class="programlisting"><span class="strong"><strong>dec2hex</strong></span>, <span class="strong"><strong>dec2bin</strong></span>, <span class="strong"><strong>dec2oct</strong></span>

Arguments: 1: An integer
Returns:   The decimal argument converted to hexadecimal, binary or octal</pre><p>For example, <code class="literal">$(call dec2hex,42)</code> will be <code class="literal">2a</code>.</p><p><a id="iddle1331" class="indexterm"/><a id="iddle1380" class="indexterm"/><a id="iddle1468" class="indexterm"/><a id="iddle1476" class="indexterm"/><a id="iddle1592" class="indexterm"/><a id="iddle1680" class="indexterm"/><a id="iddle1906" class="indexterm"/>No options are available for padding with leading zeroes. If that’s necessary, you can use GMSL string functions. For example, here’s a padded version of <code class="literal">dec2hex</code> that takes two parameters: a decimal number to be converted to hexadecimal and the number of digits to output:</p><a id="pro_id00543"/><pre class="programlisting">__repeat = $(if $2,$(call $0,$1,$(call rest,$2),$1$3),$3)

repeat = $(call __repeat,$1,$(call int_encode,$2),)</pre><p>This works by defining some helper functions. First, <code class="literal">repeat</code> creates a string consisting of a number of copies of another string. For example, <code class="literal">$(call repeat,10,A)</code> will be <code class="literal">AAAAAAAAAA</code>.</p><p>Some subtle things are happening in this definition. The <code class="literal">repeat</code> function calls <code class="literal">__repeat</code> with three parameters: <code class="literal">$1</code> is the string to be repeated, <code class="literal">$2</code> is the number of times to repeat <code class="literal">$1</code>, and <code class="literal">$3</code> has been set to a blank string by the trailing comma in the <code class="literal">$(call)</code> to __<code class="literal">repeat</code>. The <code class="literal">$0</code> variable contains the name of the current function; in <code class="literal">__repeat</code> it will be <code class="literal">__repeat</code>.</p><p>The <code class="literal">__repeat</code> function is recursive and uses the <code class="literal">$2</code> as the recursion guard. The <code class="literal">repeat</code> function converts the number of desired repeats into the <code class="literal">x</code>-representation used by GMSL arithmetic functions and passes it to <code class="literal">__repeat</code>. For example, <code class="literal">$(call repeat,Hello,5)</code> turns into <code class="literal">$(call __repeat,Hello,x x x x x,)</code>, and <code class="literal">__repeat</code> chops an <code class="literal">x</code> off <code class="literal">$2</code> each time around until <code class="literal">$2</code> is empty.</p><p>With <code class="literal">repeat</code> written, we just need a way to pad a string to some number of characters with a padding character. The function <code class="literal">pad</code> achieves that:</p><a id="pro_id00544"/><pre class="programlisting">pad = $(call repeat,$1,$(call subtract,$2,$(call strlen,$3)))$3

paddeddec2hex = $(call pad,0,$2,$(call dec2hex,$1))</pre><p>Its three arguments are the character to pad with, the total width of the padded output in character, and the string to pad. For example, <code class="literal">$(call pad,0,4,2a)</code> would return <code class="literal">002a</code>. From that, a padded <code class="literal">dec2hex</code> can easily be defined. It takes two parameters: the first is the decimal number to convert to hexadecimal, and the second is the number of characters to pad to.</p><p>As you’d expect, <code class="literal">$(call paddeddec2hex,42,8)</code> returns <code class="literal">0000002a</code>.</p></div></div><div class="sect2" title="List Manipulation Functions"><div class="titlepage"><div><div><h2 class="title"><a id="list_manipulation_functions"/>List Manipulation Functions</h2></div></div></div><p>In GNU <code class="literal">make</code> and GMSL terms, a list is a string of characters that has whitespace as separators. Both the GNU <code class="literal">make</code> built-in functions that work on lists and the GMSL functions treat multiple whitespaces as a single space. So the lists <code class="literal">1 2 3</code> and <code class="literal">1 2 3</code> are the same.</p><p>I’ll explain a few of the list manipulation functions in detail in the following sections. These functions are more complicated than the others in their use, and they’re typically available in functional languages.</p><div class="sect3" title="Applying a Function to a List with map"><div class="titlepage"><div><div><h3 class="title"><a id="applying_a_function_to_a_list_with_map"/>Applying a Function to a List with map</h3></div></div></div><p><a id="iddle1523" class="indexterm"/><a id="iddle1676" class="indexterm"/><a id="iddle1753" class="indexterm"/><a id="iddle1806" class="indexterm"/><a id="iddle1900" class="indexterm"/>When you’re working with GNU <code class="literal">make</code> functions (either built-ins or your own), you’re actually programming in a simple functional language. In functional programming, it’s common to have a map function that applies a function to every element of a list. GMSL defines <code class="literal">map</code> to do exactly that. For example:</p><a id="pro_id00545"/><pre class="programlisting">SRCS := src/FOO.c src/SUBMODULE/bar.c src/foo.c
NORMALIZED := $(call uniq,$(call map,lc,$(SRCS)))</pre><p>Given a list of filenames (perhaps with paths specified) in <code class="literal">SRCS</code>, this will ensure that all the filenames are lowercased and then apply the <code class="literal">uniq</code> function to get a unique list of source files.</p><p>This uses the GMSL function <code class="literal">lc</code> to lowercase each filename in <code class="literal">SRCS</code>. You can use the <code class="literal">map</code> function with both built-in and user-defined functions. Here, <code class="literal">NORMALIZED</code> would be <code class="literal">src/foo.c src/submodule/bar.c</code>.</p><p>Another use of <code class="literal">map</code> might be to get the size of every source file:</p><a id="pro_id00546"/><pre class="programlisting">size = $(firstword $(shell wc -c $1))

SOURCE_SIZES := $(call map,size,$(SRCS))</pre><p>Here we define a <code class="literal">size</code> function that uses <code class="literal">$(shell)</code> to call <code class="literal">wc</code>, and then we apply it to every file in <code class="literal">SRCS</code>.</p><p>Here <code class="literal">SOURCE_SIZES</code> might be something like <code class="literal">1538 1481</code> with one element for each source file.</p></div><div class="sect3" title="Making a reduce Function"><div class="titlepage"><div><div><h3 class="title"><a id="making_a_reduce_function"/>Making a reduce Function</h3></div></div></div><p>Another common function in functional languages is <code class="literal">reduce</code>. <code class="literal">reduce</code> applies a function that takes two parameters to successive elements of a list, feeding the return value from the function into the next call to it. The GMSL doesn’t have a built-in <code class="literal">reduce</code> function, but you can easily define it:</p><a id="pro_id00547"/><pre class="programlisting">reduce = $(if $2,$(call $0,$1,$(call rest,$2),$(call $1,$3,$(firstword $2))),$3)</pre></div><div class="sect3" title="Summing a List of Numbers Using reduce"><div class="titlepage"><div><div><h3 class="title"><a id="summing_a_list_of_numbers_using_reduce"/>Summing a List of Numbers Using reduce</h3></div></div></div><p>Combining <code class="literal">reduce</code> with the <code class="literal">plus</code> function, you can easily make a GNU <code class="literal">make</code> function that sums a list of numbers:</p><a id="pro_id00548"/><pre class="programlisting">sum-list = $(call reduce,plus,$1,0)</pre><p>The <code class="literal">sum-list</code> function takes a single parameter, a list of numbers, and returns the sum of those numbers. It passes three things to <code class="literal">reduce</code>: the name of the function to call for each element of the list (in this case, <code class="literal">plus</code>), the list of numbers, and a starting number (in this case, <code class="literal">0</code>).</p><p><a id="iddle1291" class="indexterm"/><a id="iddle1593" class="indexterm"/><a id="iddle1935" class="indexterm"/>Here’s how it works. Suppose <code class="literal">$(call sum-list,1 2 3 4 5)</code> is called. The following sequence of calls to <code class="literal">plus</code> will be performed:</p><a id="pro_id00549"/><pre class="programlisting">$(call plus,1,0) which returns 1
$(call plus,1,2) which returns 3
$(call plus,3,3) which returns 6
$(call plus,6,4) which returns 10
$(call plus,10,5) which returns 15</pre><p>The first call uses the first element of the list and the starting number <code class="literal">0</code>. Each subsequent call uses the next element from the list and the last result of calling <code class="literal">plus</code>.</p><p>You could combine <code class="literal">sum-list</code> with the <code class="literal">SOURCE_SIZES</code> variable to get the total size of the source code:</p><a id="pro_id00550"/><pre class="programlisting">TOTAL_SIZE := $(call sum-list,$(SOURCE_SIZES))</pre><p>In this case, <code class="literal">TOTAL_SIZE</code> would be <code class="literal">3019</code>.</p></div><div class="sect3" title="Mapping a Function Across a Pair of Lists"><div class="titlepage"><div><div><h3 class="title"><a id="mapping_a_function_across_a_pair_of_list"/>Mapping a Function Across a Pair of Lists</h3></div></div></div><p>The other interesting function that GMSL defines for lists is <code class="literal">pairmap</code>. It takes three arguments: two lists (which should be the same length) and a function. The function is applied to the first element of each list, the second element, the third element, and so on.</p><p>Suppose <code class="literal">SRCS</code> contains a list of source files. Using the <code class="literal">size</code> function we defined, combined with <code class="literal">map</code>, we defined <code class="literal">SOURCE_SIZES</code>, which contains a list of the sizes of each source file. Using <code class="literal">pairmap</code>, we can zip the two lists together to output the name of each file and its size:</p><a id="pro_id00551"/><pre class="programlisting">zip = $1:$2

SOURCES_WITH_SIZES := $(call pairmap,zip,$(SRCS),$(SOURCE_SIZES))</pre><p>The <code class="literal">zip</code> function is applied to each source filename and size in turn, and makes a string separating the filename and its size with a colon. Using our example files and sizes from this section, <code class="literal">SOURCES_WITH_SIZES</code> would be <code class="literal">src/foo.c:1538 src/submodule/bar.c:1481</code>.</p></div><div class="sect3" title="first"><div class="titlepage"><div><div><h3 class="title"><a id="first"/>first</h3></div></div></div><p><code class="literal">first</code> takes in a list and returns its first element:</p><a id="pro_id00552"/><pre class="programlisting"><span class="strong"><strong>first</strong></span>

Arguments: 1: A list
Returns:   Returns the first element of a list</pre><p>Note that <code class="literal">first</code> is identical to the GNU <code class="literal">make</code> function <code class="literal">$(firstword)</code>.</p></div><div class="sect3" title="last"><div class="titlepage"><div><div><h3 class="title"><a id="last"/>last</h3></div></div></div><p><a id="iddle1113" class="indexterm"/><a id="iddle1453" class="indexterm"/><a id="iddle1524" class="indexterm"/><a id="iddle1594" class="indexterm"/><a id="iddle1681" class="indexterm"/>The <code class="literal">last</code> function returns the final element of a list:</p><a id="pro_id00553"/><pre class="programlisting"><span class="strong"><strong>last</strong></span>

Arguments: 1: A list
Returns:   The last element of a list</pre><p>GNU <code class="literal">make</code> 3.81 introduced <code class="literal">$(lastword)</code>, which works the same way <code class="literal">last</code> does.</p></div><div class="sect3" title="rest"><div class="titlepage"><div><div><h3 class="title"><a id="rest"/>rest</h3></div></div></div><p>The <code class="literal">rest</code> function is almost the opposite of <code class="literal">first</code>. It returns everything but the first element of a list:</p><a id="pro_id00554"/><pre class="programlisting"><span class="strong"><strong>rest</strong></span>

Arguments: 1: A list
Returns:   The list with the first element removed</pre></div><div class="sect3" title="chop"><div class="titlepage"><div><div><h3 class="title"><a id="chop"/>chop</h3></div></div></div><p>To remove the last element of a list, use the <code class="literal">chop</code> function:</p><a id="pro_id00555"/><pre class="programlisting"><span class="strong"><strong>chop</strong></span>

Arguments: 1: A list
Returns:   The list with the last element removed</pre></div><div class="sect3" title="map"><div class="titlepage"><div><div><h3 class="title"><a id="map"/>map</h3></div></div></div><p>The <code class="literal">map</code> function iterates over a list (its second argument) and calls a function (named in its first argument) on each list element. The list of values returned by each call to the named function is returned:</p><a id="pro_id00556"/><pre class="programlisting"><span class="strong"><strong>map</strong></span>
Arguments: 1: Name of function to $(call) for each element of list
           2: List to iterate over calling the function in 1
Returns:   The list after calling the function on each element</pre></div><div class="sect3" title="pairmap"><div class="titlepage"><div><div><h3 class="title"><a id="pairmap"/>pairmap</h3></div></div></div><p><code class="literal">pairmap</code> is similar to map but iterates over a pair of lists:</p><a id="pro_id00557"/><pre class="programlisting"><span class="strong"><strong>pairmap</strong></span>

Arguments: 1: Name of function to $(call) for each pair of elements
           2: List to iterate over calling the function in 1
           3: Second list to iterate over calling the function in 1
Returns:   The list after calling the function on each pair of elements</pre><p><a id="iddle1460" class="indexterm"/><a id="iddle1478" class="indexterm"/><a id="iddle1683" class="indexterm"/><a id="iddle1851" class="indexterm"/>The function in the first argument is called with two arguments: one element from each of the lists being iterated over.</p></div><div class="sect3" title="leq"><div class="titlepage"><div><div><h3 class="title"><a id="leq"/>leq</h3></div></div></div><p>The <code class="literal">leq</code> list equality testing function will correctly return <code class="literal">$(true)</code> for lists that are identical other than having different whitespace:</p><a id="pro_id00558"/><pre class="programlisting"><span class="strong"><strong>leq</strong></span>

Arguments: 1: A list to compare against...
           2: ...this list
Returns:   $(true) if the two lists are identical</pre><p>For example, <code class="literal">leq</code> considers <code class="literal">1 2 3</code> and <code class="literal">1 2 3</code> to be the same list.</p></div><div class="sect3" title="lne"><div class="titlepage"><div><div><h3 class="title"><a id="lne"/>lne</h3></div></div></div><p><code class="literal">lne</code> is the opposite of <code class="literal">leq</code>: it returns <code class="literal">$(true)</code> when two lists are not equal:</p><a id="pro_id00559"/><pre class="programlisting"><span class="strong"><strong>lne</strong></span>

Arguments: 1: A list to compare against...
           2: ...this list
Returns:   $(true) if the two lists are different</pre></div><div class="sect3" title="reverse"><div class="titlepage"><div><div><h3 class="title"><a id="reverse"/>reverse</h3></div></div></div><p>To <code class="literal">reverse</code> a list can be useful (particularly because it can then be fed into <code class="literal">$(foreach)</code> and iterated backward).</p><a id="pro_id00560"/><pre class="programlisting"><span class="strong"><strong>reverse</strong></span>

Arguments: 1: A list to reverse
Returns:   The list with its elements in reverse order</pre></div><div class="sect3" title="uniq"><div class="titlepage"><div><div><h3 class="title"><a id="uniq"/>uniq</h3></div></div></div><p>The built-in <code class="literal">$(sort)</code> function will deduplicate a list, but it does so at the same time as sorting it. The GMSL <code class="literal">uniq</code> function deduplicates a list while preserving the order in which elements are first found:</p><a id="pro_id00561"/><pre class="programlisting"><span class="strong"><strong>uniq</strong></span>

Arguments: 1: A list to deduplicate
Returns:   The list with elements in the original order but without duplicates</pre><p>For example, <code class="literal">$(call uniq,a c b a c b)</code> will return <code class="literal">a c b</code>.</p></div><div class="sect3" title="length"><div class="titlepage"><div><div><h3 class="title"><a id="length"/>length</h3></div></div></div><p><a id="iddle1159" class="indexterm"/><a id="iddle1337" class="indexterm"/><a id="iddle1387" class="indexterm"/><a id="iddle1459" class="indexterm"/><a id="iddle1775" class="indexterm"/><a id="iddle1790" class="indexterm"/>To find out the number of elements in a list, call <code class="literal">length</code>:</p><a id="pro_id00562"/><pre class="programlisting"><span class="strong"><strong>length</strong></span>

Arguments: 1: A list
Returns:   The number of elements in the list</pre><p>The <code class="literal">length</code> function is the same as the GNU <code class="literal">make $(words)</code> function.</p></div></div><div class="sect2" title="String Manipulation Functions"><div class="titlepage"><div><div><h2 class="title"><a id="string_manipulation_functions"/>String Manipulation Functions</h2></div></div></div><p>A string is a sequence of any characters, including whitespace. The string equality (and string inequality) function <code class="literal">seq</code> works even with strings that contain whitespace or consist only of whitespace. For example:</p><a id="pro_id00563"/><pre class="programlisting"># space contains the space character

space :=
space +=

# tab contains a tab

tab :=→  # needed to protect the tab character

$(info $(call seq,White Space,White Space))
$(info $(call seq,White$(space)Space,White Space))
$(info $(call sne,White$(space)Space,White$(tab)Space))
$(info $(call seq,$(tab),$(tab)))
$(info $(call sne,$(tab),$(space)))</pre><p>This outputs <code class="literal">T</code> five times, indicating that each call to <code class="literal">seq</code> or <code class="literal">sne</code> returned <code class="literal">$(true)</code>.</p><p>As with the list manipulation functions, I’ll cover a few of the more complicated functions in detail in the following sections.</p><div class="sect3" title="Splitting CSV Data into a GNU make List"><div class="titlepage"><div><div><h3 class="title"><a id="splitting_csv_data_into_a_gnu_make_list"/>Splitting CSV Data into a GNU make List</h3></div></div></div><p>You can use the <code class="literal">split</code> function to turn a value in CSV format into a GNU <code class="literal">make</code> list. For example, splitting on a comma turns a CSV line into a list from which individual items can be extracted:</p><a id="pro_id00564"/><pre class="programlisting">CSV_LINE := src/foo.c,gcc,-Wall

comma := ,
FIELDS := $(call split,$(comma),$(CSV_LINE))

$(info Compile '$(word 1,$(FIELDS))' using compiler '$(word 2,$(FIELDS))' with \
options '$(word 3,$(FIELDS))')</pre><p><a id="iddle1110" class="indexterm"/><a id="iddle1470" class="indexterm"/><a id="iddle1477" class="indexterm"/><a id="iddle1602" class="indexterm"/><a id="iddle1707" class="indexterm"/><a id="iddle1836" class="indexterm"/><a id="iddle1838" class="indexterm"/>Notice how the variable <code class="literal">comma</code> is defined to contain a comma character so it can be used in the <code class="literal">$(call)</code> to the <code class="literal">split</code> function. This trick was discussed in <a class="xref" href="ch01.html" title="Chapter 1. The Basics Revisited">Chapter 1</a>.</p></div><div class="sect3" title="Making a PATH from a List of Directories"><div class="titlepage"><div><div><h3 class="title"><a id="making_a_path_from_a_list_of_directories"/>Making a PATH from a List of Directories</h3></div></div></div><p>The <code class="literal">merge</code> function does the opposite of <code class="literal">split</code>: it makes a string from a list by separating the list items by some character. For example, to turn a list of directories into a form suitable for the <code class="literal">PATH</code> (which is usually separated by colons), define <code class="literal">list-to-path</code> as follows:</p><a id="pro_id00565"/><pre class="programlisting">DIRS := /usr/bin /usr/sbin /usr/local/bin /home/me/bin

list-to-path = $(call merge,:,$1)

$(info $(call list-to-path,$(DIRS)))</pre><p>This outputs <code class="literal">/usr/bin:/usr/sbin:/usr/local/bin:/home/me/bin</code>.</p></div><div class="sect3" title="Translating Characters Using tr"><div class="titlepage"><div><div><h3 class="title"><a id="translating_characters_using_tr"/>Translating Characters Using tr</h3></div></div></div><p>The most complicated string function is <code class="literal">tr</code>, which operates like the tr shell program. It transforms each character from a collection of characters into a corresponding character in a second list. The GMSL defines some common character classes for use with <code class="literal">tr</code>. For example, it defines variables called <code class="literal">[A-Z]</code> and <code class="literal">[a-z]</code> (yes, those are really the names) that contain the uppercase and lowercase characters.</p><p>We can use <code class="literal">tr</code> to make a function that translates to leet-speak:</p><a id="pro_id00566"/><pre class="programlisting">leet = $(call tr,A E I O L T,4 3 1 0 1 7,$1)

$(info $(call leet,I AM AN ELITE GNU MAKE HAXOR))</pre><p>This outputs <code class="literal">1 4M 4N 31173 GNU M4K3 H4X0R</code>.</p></div><div class="sect3" title="seq"><div class="titlepage"><div><div><h3 class="title"><a id="seq"/>seq</h3></div></div></div><p>The slightly confusingly named <code class="literal">seq</code> function tests whether two strings are equal:</p><a id="pro_id00567"/><pre class="programlisting"><span class="strong"><strong>seq</strong></span>

Arguments: 1: A string to compare against...
           2: ...this string
Returns:   $(true) if the two strings are identical</pre></div><div class="sect3" title="sne"><div class="titlepage"><div><div><h3 class="title"><a id="sne"/>sne</h3></div></div></div><p><a id="iddle1758" class="indexterm"/><a id="iddle1774" class="indexterm"/><a id="iddle1787" class="indexterm"/><a id="iddle1793" class="indexterm"/><a id="iddle1800" class="indexterm"/><a id="iddle1801" class="indexterm"/>The opposite, string inequality, is tested with <code class="literal">sne</code>:</p><a id="pro_id00568"/><pre class="programlisting"><span class="strong"><strong>sne</strong></span>

Arguments: 1: A string to compare against...
           2: ...this string
Returns:   $(true) if the two strings are not the same</pre></div><div class="sect3" title="streln"><div class="titlepage"><div><div><h3 class="title"><a id="streln"/>streln</h3></div></div></div><p>The <code class="literal">length</code> function gets the length of a list; the equivalent for strings is <code class="literal">strlen</code>:</p><a id="pro_id00569"/><pre class="programlisting"><span class="strong"><strong>strlen</strong></span>

Arguments: 1: A string
Returns:   The length of the string</pre></div><div class="sect3" title="substr"><div class="titlepage"><div><div><h3 class="title"><a id="substr"/>substr</h3></div></div></div><p>It’s possible to extract a substring using the <code class="literal">substr</code> function:</p><a id="pro_id00570"/><pre class="programlisting"><span class="strong"><strong>substr</strong></span>

Arguments: 1: A string
           2: Starting offset (first character is 1)
           3: Ending offset (inclusive)
Returns:   A substring</pre><p>Note that in GMSL, strings start from position 1, not 0.</p></div><div class="sect3" title="split"><div class="titlepage"><div><div><h3 class="title"><a id="split"/>split</h3></div></div></div><p>To split a string into a list, you use the <code class="literal">split</code> function:</p><a id="pro_id00571"/><pre class="programlisting"><span class="strong"><strong>split</strong></span>

Arguments: 1: The character to split on
           2: A string to split
Returns:   A list separated by spaces at the split character in the
           first argument</pre><p>Note that if the string contains spaces, the result may not be as expected. GNU <code class="literal">make</code>’s use of spaces as the list delimiter makes working with spaces and lists together very difficult. See <a class="xref" href="ch04.html" title="Chapter 4. Pitfalls and Problems">Chapter 4</a> for more on GNU <code class="literal">make</code>’s handling of spaces.</p></div><div class="sect3" title="merge"><div class="titlepage"><div><div><h3 class="title"><a id="merge"/>merge</h3></div></div></div><p><a id="iddle1238" class="indexterm"/><a id="iddle1336" class="indexterm"/><a id="iddle1386" class="indexterm"/><a id="iddle1458" class="indexterm"/><a id="iddle1533" class="indexterm"/><a id="iddle1710" class="indexterm"/><a id="iddle1715" class="indexterm"/><a id="iddle1722" class="indexterm"/><a id="iddle1839" class="indexterm"/><a id="iddle1844" class="indexterm"/><code class="literal">merge</code> is the opposite of <code class="literal">split</code>. It takes a list and outputs a string with a character between each list element:</p><a id="pro_id00572"/><pre class="programlisting"><span class="strong"><strong>merge</strong></span>

Arguments: 1: The character to put between fields
           2: A list to merge into a string
Returns:   A single string, list elements are separated by the character in
           the first argument</pre></div><div class="sect3" title="tr"><div class="titlepage"><div><div><h3 class="title"><a id="tr"/>tr</h3></div></div></div><p>You use the <code class="literal">tr</code> function to translate individual characters, and it’s a building block for creating the <code class="literal">uc</code> and <code class="literal">lc</code> functions:</p><a id="pro_id00573"/><pre class="programlisting"><span class="strong"><strong>tr</strong></span>

Arguments: 1: The list of characters to translate from 
           2: The list of characters to translate to
           3: The text to translate
Returns:   The text after translating characters</pre></div><div class="sect3" title="uc"><div class="titlepage"><div><div><h3 class="title"><a id="uc"/>uc</h3></div></div></div><p><code class="literal">uc</code> performs simple uppercasing of the alphabet a-z:</p><a id="pro_id00574"/><pre class="programlisting"><span class="strong"><strong>uc</strong></span>

Arguments: 1: Text to uppercase
Returns:   The text in uppercase</pre></div><div class="sect3" title="lc"><div class="titlepage"><div><div><h3 class="title"><a id="lc"/>lc</h3></div></div></div><p>Finally, we have <code class="literal">lc</code>:</p><a id="pro_id00575"/><pre class="programlisting"><span class="strong"><strong>lc</strong></span>

Arguments: 1: Text to lowercase
Returns:   The text in lowercase</pre><p>This performs simple lowercasing of the alphabet A-Z.</p></div></div><div class="sect2" title="Set Manipulation Functions"><div class="titlepage"><div><div><h2 class="title"><a id="set_manipulation_functions"/>Set Manipulation Functions</h2></div></div></div><p>Sets are represented by sorted, deduplicated lists. To create a set from a list, use <code class="literal">set_create</code> or start with the <code class="literal">empty_set</code> and <code class="literal">set_insert</code> individual elements. The empty set is defined by the variable <code class="literal">empty_set</code>.</p><p><a id="iddle1711" class="indexterm"/><a id="iddle1716" class="indexterm"/>For example, a makefile could keep track of all the directories that it made using the marker technique discussed in <a class="xref" href="ch04.html#making_directories" title="Making Directories">Making Directories</a>:</p><a id="pro_id00576"/><pre class="programlisting">MADE_DIRS := $(empty_set)

marker = $1.f
make_dir = $(eval $1.f: ; @$$(eval MADE_DIRS := $$(call      \
set_insert,$$(dir $$@),$$(MADE_DIRS))) mkdir -p $$(dir $$@); \
touch $$@)

all: $(call marker,/tmp/foo/) $(call marker,/tmp/bar/)
→  @echo Directories made: $(MADE_DIRS)

$(call make_dir,/tmp/foo/)
$(call make_dir,/tmp/bar/)</pre><p>Updating the <code class="literal">make_dir</code> function (which creates rules to make directories) with a call to <code class="literal">set_insert</code> means that the variable <code class="literal">MADE_DIRS</code> will keep track of the set of directories created.</p><p>In a real makefile, many directories would likely be built, and using a set would be an easy way to discover which had been built at any point.</p><p>Note that because a set is implemented as a GNU <code class="literal">make</code> list, you can’t insert an item that contains a space.</p><div class="sect3" title="set_create"><div class="titlepage"><div><div><h3 class="title"><a id="setunderscorecreate"/>set_create</h3></div></div></div><p>You create a set by using the <code class="literal">set_create</code> function:</p><a id="pro_id00577"/><pre class="programlisting"><span class="strong"><strong>set_create</strong></span>

Arguments: 1: A list of set elements
Returns:   The newly created set</pre><p>It takes a list of elements and adds them to a set. The set itself is returned. Note that set elements may not contain spaces.</p></div><div class="sect3" title="set_insert"><div class="titlepage"><div><div><h3 class="title"><a id="setunderscoreinsert"/>set_insert</h3></div></div></div><p>Once a set has been created using <code class="literal">set_create</code>, you can add an element to it using <code class="literal">set_insert</code>:</p><a id="pro_id00578"/><pre class="programlisting"><span class="strong"><strong>set_insert</strong></span>

Arguments: 1: A single element to add to a set
           2: A set
Returns:   The set with the element added</pre></div><div class="sect3" title="set_remove"><div class="titlepage"><div><div><h3 class="title"><a id="setunderscoreremove"/>set_remove</h3></div></div></div><p><a id="iddle1717" class="indexterm"/><a id="iddle1720" class="indexterm"/><a id="iddle1724" class="indexterm"/><a id="iddle1725" class="indexterm"/>To remove an element from a set, call <code class="literal">set_remove</code>:</p><a id="pro_id00579"/><pre class="programlisting"><span class="strong"><strong>set_remove</strong></span>

Arguments: 1: A single element to remove from a set
           2: A set
Returns:   The set with the element removed</pre><p>It is not an error to remove an element from a set when that element was not present.</p></div><div class="sect3" title="set_is_member"><div class="titlepage"><div><div><h3 class="title"><a id="setunderscoreisunderscoremember"/>set_is_member</h3></div></div></div><p>To test whether an element is a member of a set, call <code class="literal">set_is_member</code>. It returns a Boolean value indicating whether the element was present:</p><a id="pro_id00580"/><pre class="programlisting"><span class="strong"><strong>set_is_member</strong></span>

Arguments: 1: A single element
           2: A set
Returns:   $(true) if the element is in the set</pre></div><div class="sect3" title="set_union"><div class="titlepage"><div><div><h3 class="title"><a id="setunderscoreunion"/>set_union</h3></div></div></div><p>You merge two sets together by calling the <code class="literal">set_union</code> function on the two sets. The merged set is returned:</p><a id="pro_id00581"/><pre class="programlisting"><span class="strong"><strong>set_union</strong></span>

Arguments: 1: A set
           2: Another set
Returns:   The union of the two sets</pre></div><div class="sect3" title="set_intersection"><div class="titlepage"><div><div><h3 class="title"><a id="setunderscoreintersection"/>set_intersection</h3></div></div></div><p>To determine the elements common to two sets, use <code class="literal">set_intersection</code>. It returns the set of elements that were present in both sets passed in as arguments:</p><a id="pro_id00582"/><pre class="programlisting"><span class="strong"><strong>set_intersection</strong></span>

Arguments: 1: A set
           2: Another set
Returns:   The intersection of the two sets</pre></div><div class="sect3" title="set_is_subset"><div class="titlepage"><div><div><h3 class="title"><a id="setunderscoreisunderscoresubset"/>set_is_subset</h3></div></div></div><p><a id="iddle1060" class="indexterm"/><a id="iddle1069" class="indexterm"/><a id="iddle1325" class="indexterm"/><a id="iddle1370" class="indexterm"/><a id="iddle1385" class="indexterm"/><a id="iddle1489" class="indexterm"/><a id="iddle1712" class="indexterm"/><a id="iddle1721" class="indexterm"/><a id="iddle1901" class="indexterm"/>It is sometimes useful to know if one set is a subset of another, which you can test by calling <code class="literal">set_is_subset</code>:</p><a id="pro_id00583"/><pre class="programlisting"><span class="strong"><strong>set_is_subset</strong></span>

Arguments: 1: A set
           2: Another set
Returns:   $(true) if the first set is a subset of the second</pre><p><code class="literal">set_is_subset</code> returns a Boolean value indicating whether the first set is a subset of the second.</p></div><div class="sect3" title="set_equal"><div class="titlepage"><div><div><h3 class="title"><a id="setunderscoreequal"/>set_equal</h3></div></div></div><p>To determine if two sets are equal, call <code class="literal">set_equal</code>:</p><a id="pro_id00584"/><pre class="programlisting"><span class="strong"><strong>set_equal</strong></span>

Arguments: 1: A set
           2: Another set
Returns:   $(true) if the two sets are identical</pre><p><code class="literal">set_equal</code> returns <code class="literal">$(true)</code> if the two sets have exactly the same elements.</p></div></div><div class="sect2" title="Associative Arrays"><div class="titlepage"><div><div><h2 class="title"><a id="associative_arrays"/>Associative Arrays</h2></div></div></div><p>An <span class="emphasis"><em>associative array</em></span> maps a key value (a string with no spaces in it) to a single value (any string). Associative arrays are sometimes referred to as maps or even hash tables (although that’s an implementation detail, and the GMSL associative arrays do not use hashing).</p><p>You can use associative arrays as <span class="emphasis"><em>lookup tables</em></span>. For example:</p><a id="pro_id00585"/><pre class="programlisting">C_FILES := $(wildcard *.c)

get-size = $(call first,$(shell wc -c $1))
$(foreach c,$(C_FILES),$(call set,c_files,$c,$(call get-size,$c)))

$(info All the C files: $(call keys,c_files))
$(info foo.c has size $(call get,c_files,foo.c))</pre><p>This small makefile gets a list of all the <code class="literal">.c</code> files in the current directory and their sizes, and then it makes an associative array mapping from a filename to its size.</p><p>The <code class="literal">get-size</code> function uses <code class="literal">wc</code> to get the number of bytes in a file. The <code class="literal">C_FILES</code> variable contains all the <code class="literal">.c</code> files in the current directory. The <code class="literal">$(foreach)</code> uses the GMSL <code class="literal">set</code> function to set a mapping in an associative array called <code class="literal">c_files</code> between each <code class="literal">.c</code> file and its size.</p><p><a id="iddle1310" class="indexterm"/><a id="iddle1450" class="indexterm"/><a id="iddle1714" class="indexterm"/>Here’s an example run:</p><a id="pro_id00586"/><pre class="programlisting">$ <span class="strong"><strong>make</strong></span>
All the C files: bar.c foo.c foo.c
has size 551</pre><p>The first line is a list of all the <code class="literal">.c</code> files found; it’s printed using the <code class="literal">keys</code> function to get all the keys in the associative array. The second line comes from looking up the length of <code class="literal">foo.c</code> using <code class="literal">get</code>.</p><div class="sect3" title="set"><div class="titlepage"><div><div><h3 class="title"><a id="set"/>set</h3></div></div></div><p>The GMSL keeps internal track of named associative arrays, but it is not necessary to explicitly create them. Simply call <code class="literal">set</code> to add elements to the array, and the array will be created if it does not exist. Note that array keys cannot contain spaces.</p><a id="pro_id00587"/><pre class="programlisting"><span class="strong"><strong>set</strong></span>

Arguments: 1: Name of associative array
           2: The key value to associate
           3: The value associated with the key
Returns:   Nothing</pre></div><div class="sect3" title="get"><div class="titlepage"><div><div><h3 class="title"><a id="get"/>get</h3></div></div></div><p>To retrieve an item from an associate array, call <code class="literal">get</code>. If the key is not present, <code class="literal">get</code> will return an empty string.</p><a id="pro_id00588"/><pre class="programlisting"><span class="strong"><strong>get</strong></span>

Arguments: 1: Name of associative array
           2: The key to retrieve
Returns:   The value stored in the array for that key</pre></div><div class="sect3" title="keys"><div class="titlepage"><div><div><h3 class="title"><a id="keys"/>keys</h3></div></div></div><p>The <code class="literal">keys</code> function returns a list of all the keys present in an associative array. You can use this with <code class="literal">$(foreach)</code> to iterate an associative array:</p><a id="pro_id00589"/><pre class="programlisting"><span class="strong"><strong>keys</strong></span>

Arguments: 1: Name of associative array
Returns:   A list of all defined keys in the array</pre></div><div class="sect3" title="defined"><div class="titlepage"><div><div><h3 class="title"><a id="defined"/>defined</h3></div></div></div><p><a id="iddle1335" class="indexterm"/><a id="iddle1383" class="indexterm"/><a id="iddle1551" class="indexterm"/><a id="iddle1611" class="indexterm"/><a id="iddle1779" class="indexterm"/><a id="iddle1837" class="indexterm"/><a id="iddle1916" class="indexterm"/>To test whether a key is present in an associated array, call <code class="literal">defined</code>:</p><a id="pro_id00590"/><pre class="programlisting"><span class="strong"><strong>defined</strong></span>

Arguments: 1: Name of associative array
           2: The key to test
Returns:   $(true) if the key is defined (i.e., not empty)</pre><p><code class="literal">defined</code> returns a Boolean indicating whether the key was defined or not.</p></div></div><div class="sect2" title="Named Stacks"><div class="titlepage"><div><div><h2 class="title"><a id="named_stacks"/>Named Stacks</h2></div></div></div><p>A <span class="emphasis"><em>stack</em></span> is an ordered list of strings (with no spaces in them). In GMSL, stacks are stored internally, and they have names, like associative arrays do. For example:</p><a id="pro_id00591"/><pre class="programlisting">traverse-tree = $(foreach d,$(patsubst %/.,%,$(wildcard $1/*/.)),  \
$(call push,dirs,$d)$(call traverse-tree,$d))

$(call traverse-tree,sources)

dump-tree = $(if $(call sne,$(call depth,dirs),0),$(call pop,dirs) \
$(call dump-tree))

$(info $(call dump-tree))</pre><p>This small makefile uses a stack to follow a tree of directories.</p><div class="sect3" title="traverse-tree"><div class="titlepage"><div><div><h3 class="title"><a id="traverse-tree"/>traverse-tree</h3></div></div></div><p>The <code class="literal">traverse-tree</code> function finds all the subdirectories of its argument (stored in <code class="literal">$1</code>) using the <code class="literal">$(wildcard)</code> function to find the <code class="literal">.</code> file that is always present in a directory. It uses the <code class="literal">$(patsubst)</code> function to strip off the trailing <code class="literal">/.</code> from each value returned by <code class="literal">$(wildcard)</code> to get the full directory name.</p><p>Before it traverses down into that directory, it pushes the directory found onto a stack called <code class="literal">dirs</code>.</p></div><div class="sect3" title="dump-tree"><div class="titlepage"><div><div><h3 class="title"><a id="dump-tree"/>dump-tree</h3></div></div></div><p>The <code class="literal">dump-tree</code> function <code class="literal">pop</code>s items off the <code class="literal">dirs</code> tree until there are none left (until the <code class="literal">depth</code> becomes <code class="literal">0</code>).</p><p><a class="xref" href="ch06.html#directory_structure" title="Example 6-1. A directory structure">Example 6-1</a> shows a directory structure.</p><div class="example"><a id="directory_structure"/><p class="title">Example 6-1. A directory structure</p><div class="example-contents"><pre class="programlisting">$ <span class="strong"><strong>ls -R sources</strong></span>
sources:
bar  foo

sources/bar:
barsub
sources/bar/barsub:

sources/foo:
subdir  subdir2

sources/foo/subdir:
subsubdir

sources/foo/subdir/subsubdir:

sources/foo/subdir2:</pre></div></div><p><a id="iddle1199" class="indexterm"/><a id="iddle1212" class="indexterm"/><a id="iddle1626" class="indexterm"/><a id="iddle1667" class="indexterm"/><a id="iddle1778" class="indexterm"/><a id="iddle1929" class="indexterm"/>If this directory structure exists under <code class="literal">sources</code>, the makefile will output:</p><a id="pro_id00592"/><pre class="programlisting">sources/foo sources/foo/subdir2 sources/foo/subdir sources/foo/subdir/
subsubdir sources/bar sources/bar/barsub</pre><p>If it’s desirable to traverse the directory tree in a depth-first fashion, you can use the stack functions to define <code class="literal">dfs</code>, which searches a directory tree and builds the <code class="literal">dirs</code> stack containing the directories in depth-first order:</p><a id="pro_id00593"/><pre class="programlisting">__dfs = $(if $(call sne,$(call depth,work),0),$(call push,dirs,$(call    \
peek,work)$(foreach d,$(patsubst %/.,%,$(wildcard $(call                 \
pop,work)/*/.)),$(call push,work,$d)))$(call __dfs))

dfs = $(call push,work,$1)$(call __dfs)

$(call dfs,sources)

dump-tree = $(if $(call sne,$(call depth,dirs),0),$(call pop,dirs) $(call \
dump-tree))

$(info $(call dump-tree,dirs))</pre><p>The <code class="literal">dump-tree</code> function hasn’t changed (it just outputs everything in the stack by successive calls to <code class="literal">pop</code>). But the <code class="literal">dfs</code> function is new. It uses a working stack called <code class="literal">work</code> to keep track of directories to visit. It first pushes the starting directory onto the <code class="literal">work</code> stack and then calls the <code class="literal">__dfs</code> helper.</p><p>The real work is done by <code class="literal">__dfs</code>. It pushes the current directory onto the <code class="literal">dirs</code> stack, pushes all the children of that directory onto the <code class="literal">work</code> stack, and then it recurses. Recursion stops when the <code class="literal">work</code> stack is empty.</p><p>The output for the directory structure in <a class="xref" href="ch06.html#directory_structure" title="Example 6-1. A directory structure">Example 6-1</a> is now:</p><a id="pro_id00594"/><pre class="programlisting">sources/bar/barsub sources/bar sources/foo/subdir/subsubdir sources/foo/subdir
sources/foo/subdir2 sources/foo sources.</pre></div><div class="sect3" title="push"><div class="titlepage"><div><div><h3 class="title"><a id="push"/>push</h3></div></div></div><p><a id="iddle1198" class="indexterm"/><a id="iddle1304" class="indexterm"/><a id="iddle1328" class="indexterm"/><a id="iddle1375" class="indexterm"/><a id="iddle1532" class="indexterm"/><a id="iddle1617" class="indexterm"/><a id="iddle1627" class="indexterm"/><a id="iddle1651" class="indexterm"/>Anyone who has used a stack will be familiar with pushing and popping elements. The GMSL stack functions are very similar. To add an element to the top of the stack, call <code class="literal">push</code>:</p><a id="pro_id00595"/><pre class="programlisting"><span class="strong"><strong>push</strong></span>

Arguments: 1: Name of stack
           2: Value to push onto the top of the stack (must not contain
           a space)
Returns:   None</pre></div><div class="sect3" title="pop"><div class="titlepage"><div><div><h3 class="title"><a id="pop"/>pop</h3></div></div></div><p>To retrieve the top element, call <code class="literal">pop</code>:</p><a id="pro_id00596"/><pre class="programlisting"><span class="strong"><strong>pop</strong></span>

Arguments: 1: Name of stack
Returns:   Top element from the stack after removing it</pre></div><div class="sect3" title="peek"><div class="titlepage"><div><div><h3 class="title"><a id="peek"/>peek</h3></div></div></div><p>The <code class="literal">peek</code> function operates like <code class="literal">pop</code> but doesn’t remove the top stack element; it just returns its value:</p><a id="pro_id00597"/><pre class="programlisting"><span class="strong"><strong>peek</strong></span>

Arguments: 1: Name of stack
Returns:   Top element from the stack without removing it</pre></div><div class="sect3" title="depth"><div class="titlepage"><div><div><h3 class="title"><a id="depth"/>depth</h3></div></div></div><p>Finally, you can call <code class="literal">depth</code>:</p><a id="pro_id00598"/><pre class="programlisting"><span class="strong"><strong>depth</strong></span>

Arguments: 1: Name of stack
Returns:   Number of items on the stack</pre><p><code class="literal">depth</code> determines how many elements are present on the stack.</p></div></div><div class="sect2" title="Function Memoization"><div class="titlepage"><div><div><h2 class="title"><a id="function_memoization"/>Function Memoization</h2></div></div></div><p>To reduce the number of calls to slow functions, such as <code class="literal">$(shell)</code>, a single memoization function is provided. For example, suppose a makefile needs to know the MD5 values of various files and defines a function <code class="literal">md5</code>.</p><a id="pro_id00599"/><pre class="programlisting">md5 = $(shell md5sum $1)</pre><p><a id="iddle1155" class="indexterm"/><a id="iddle1269" class="indexterm"/><a id="iddle1321" class="indexterm"/><a id="iddle1326" class="indexterm"/><a id="iddle1333" class="indexterm"/><a id="iddle1339" class="indexterm"/><a id="iddle1374" class="indexterm"/><a id="iddle1530" class="indexterm"/><a id="iddle1539" class="indexterm"/><a id="iddle1841" class="indexterm"/>That’s a pretty expensive function to call (because of the time <code class="literal">md5sum</code> would take to execute), so it would be desirable to call it only once for each file. A memoized version of the <code class="literal">md5</code> function looks like this:</p><a id="pro_id00600"/><pre class="programlisting">md5once = $(call memoize,md5,$1)</pre><p>It will call the <code class="literal">md5sum</code> function just once for each inputted filename and record the returned value internally so that a subsequent call to <code class="literal">md5once</code> with the same filename returns the MD5 value without having to run <code class="literal">md5sum</code>. For example:</p><a id="pro_id00601"/><pre class="programlisting">$(info $(call md5once,/etc/passwd))
$(info $(call md5once,/etc/passwd))</pre><p>This prints out the MD5 value of <code class="literal">/etc/passwd</code> twice but executes <code class="literal">md5sum</code> only once.</p><p>The actual <code class="literal">memoize</code> function is defined using the GMSL associative array functions:</p><a id="pro_id00602"/><pre class="programlisting"><span class="strong"><strong>memoize</strong></span>

Arguments: 1: Name of function to memoize
           2: String argument for the function
Returns:   Result of $1 applied to $2 but only calls $1 once for each unique $2</pre></div><div class="sect2" title="Miscellaneous and Debugging Facilities"><div class="titlepage"><div><div><h2 class="title"><a id="miscellaneous_and_debugging_facilities"/>Miscellaneous and Debugging Facilities</h2></div></div></div><p><a class="xref" href="ch06.html#gmsl_constants" title="Table 6-1. GMSL Constants">Table 6-1</a> shows constants that GMSL defines.</p><div class="table"><a id="gmsl_constants"/><p class="title">Table 6-1. GMSL Constants</p><div class="table-contents"><table summary="GMSL Constants" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/><col/></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Constant</p></th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Value</p></th><th style="border-bottom: 0.5pt solid ; " valign="top"><p>Purpose</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>true</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>T</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The Boolean value true</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>false</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>(an empty string)</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The Boolean value false</p></td></tr><tr><td style="border-right: 0.5pt solid ; " valign="top"><p>gmsl_version</p></td><td style="border-right: 0.5pt solid ; " valign="top"><p>1 1 7</p></td><td style="" valign="top"><p>Current GMSL version number (major minor revision)</p></td></tr></tbody></table></div></div><p>You access these constants as normal GNU <code class="literal">make</code> variables by wrapping them in <code class="literal">$()</code> or <code class="literal">${}</code>.</p><div class="sect3" title="gmsl_compatible"><div class="titlepage"><div><div><h3 class="title"><a id="gmslunderscorecompatible"/>gmsl_compatible</h3></div></div></div><p>You know the <code class="literal">gmsl_compatible</code> function from <a class="xref" href="ch06.html#checking_the_gmsl_version" title="Checking the GMSL Version">Checking the GMSL Version</a>:</p><a id="pro_id00603"/><pre class="programlisting"><span class="strong"><strong>gmsl_compatible</strong></span>

Arguments: List containing the desired library version number (major minor
           revision)
Returns:   $(true) if the current version of the library is compatible
           with the requested version number, otherwise $(false)</pre><p><a id="iddle1064" class="indexterm"/><a id="iddle1066" class="indexterm"/><a id="iddle1324" class="indexterm"/>In <a class="xref" href="ch01.html" title="Chapter 1. The Basics Revisited">Chapter 1</a>, you saw a recipe for outputting variable values using a pattern rule with target <code class="literal">print-%</code>. Because this is such a useful rule, GMSL defines its own <code class="literal">gmsl-print-%</code> target that you can use to print the value of any variable defined in a makefile that includes GMSL.</p><p>For example:</p><a id="pro_id00604"/><pre class="programlisting">include gmsl

FOO := foo bar baz
all:</pre></div><div class="sect3" title="gmsl-print-%"><div class="titlepage"><div><div><h3 class="title"><a id="gmsl-print-percent"/>gmsl-print-%</h3></div></div></div><p><code class="literal">gmsl-print-%</code> can be used to print any makefile variable, including variables inside GMSL. For example, <code class="literal">make gmsl-print-gmsl_version</code> would print the current GMSL version.</p><a id="pro_id00605"/><pre class="programlisting"><span class="strong"><strong>gmsl-print-%</strong></span> (target not a function)

Arguments: The % should be replaced by the name of a variable that you
           wish to print
Action:    Echoes the name of the variable that matches the % and its value</pre></div><div class="sect3" title="assert"><div class="titlepage"><div><div><h3 class="title"><a id="assert-id00012"/>assert</h3></div></div></div><p>As discussed in <a class="xref" href="ch02.html#makefile_assertions" title="Makefile Assertions">Makefile Assertions</a>, it can be useful to have assertions in a makefile. GMSL provides two assertion functions: <code class="literal">assert</code> and <code class="literal">assert_exists</code>.</p><a id="pro_id00606"/><pre class="programlisting"><span class="strong"><strong>assert</strong></span>

Arguments: 1: A boolean that must be true or the assertion will fail
           2: The message to print with the assertion
Returns:   None</pre></div><div class="sect3" title="assert_exists"><div class="titlepage"><div><div><h3 class="title"><a id="assertunderscoreexists-id00013"/>assert_exists</h3></div></div></div><p>To assert that an individual file or directory exists, GMSL provides the <code class="literal">assert_exists</code> function:</p><a id="pro_id00607"/><pre class="programlisting"><span class="strong"><strong>assert_exists</strong></span>

Arguments: 1: Name of file that must exist, if it is missing an assertion
           will be generated
Returns:   None</pre></div></div><div class="sect2" title="Environment Variables"><div class="titlepage"><div><div><h2 class="title"><a id="environment_variables"/>Environment Variables</h2></div></div></div><p><a id="iddle1246" class="indexterm"/><a id="iddle1248" class="indexterm"/><a id="iddle1322" class="indexterm"/><a id="iddle1323" class="indexterm"/><a id="iddle1327" class="indexterm"/><a id="iddle1338" class="indexterm"/><a id="iddle1373" class="indexterm"/><a class="xref" href="ch06.html#gmsl_environment_variables" title="Table 6-2. GMSL Environment Variables">Table 6-2</a> shows GMSL environment variables (or command line overrides), which control various bits of functionality.</p><div class="table"><a id="gmsl_environment_variables"/><p class="title">Table 6-2. GMSL Environment Variables</p><div class="table-contents"><table summary="GMSL Environment Variables" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Variable</p></th><th style="border-bottom: 0.5pt solid ; " valign="top"><p>Purpose</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>GMSL_NO_WARNINGS</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>If set, prevents GMSL from outputting warning messages. For example, arithmetic functions can generate underflow warnings.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>GMSL_NO_ERRORS</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>If set, prevents GMSL from generating fatal errors: division by zero or failed assertions are fatal.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " valign="top"><p>GMSL_TRACE</p></td><td style="" valign="top"><p>Enables function tracing. Calls to GMSL functions will result in name and arguments being traced. See <a class="xref" href="ch02.html#tracing_variable_values" title="Tracing Variable Values">Tracing Variable Values</a> for a discussion of makefile tracing.</p></td></tr></tbody></table></div></div><p>These environment variables can all be set in the environment or on the command line.</p><p>For example, this makefile contains an assertion that will always fail, stopping the <code class="literal">make</code> process:</p><a id="pro_id00608"/><pre class="programlisting">include gmsl

$(call assert,$(false),Always fail)

all:</pre><p>Setting <code class="literal">GMSL_NO_ERRORS</code> prevents the assertion from stopping the <code class="literal">make</code> process. In that case the output of the <code class="literal">assert</code> is hidden and <code class="literal">make</code> continues normally:</p><a id="pro_id00609"/><pre class="programlisting">$ <span class="strong"><strong>make</strong></span>
Makefile:5: *** GNU Make Standard Library: Assertion failure: Always fail.
Stop.
$ <span class="strong"><strong>make GMSL_NO_ERRORS=1</strong></span>
make: Nothing to be done for `all'.</pre><p>A few well-placed GMSL assertions in a makefile can make a big difference. By checking for makefile prerequisites (such as the presence of a specific file or that a compiler has a certain version number), a conscientious makefile writer can alert a user to a problem without forcing them to debug the often arcane output from <code class="literal">make</code>.</p></div></div></div></body></html>