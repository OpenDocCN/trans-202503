<html><head></head><body>
<div class="imagec"><span epub:type="pagebreak" id="page_39"/><img alt="Image" src="../images/common1.jpg"/></div>
<h2 class="h2" id="ch02"><strong>2</strong><br/><strong>SUPER SONIC</strong></h2>
<p class="noindent">In this chapter, we’ll explore using sound with the micro:bit. We’ll teach the micro:bit to play music and even imitate speech, and we’ll get it to hear sound by connecting it to a microphone. You’ll try out a couple of experiments and create two simple projects: the first project is a musical doorbell that lets the Mad Scientist know when visitors have arrived, and the second is a Shout-o-meter that measures and displays the volume of sounds it detects.</p>
<h3 class="h3" id="ch00lev1sec48"><span epub:type="pagebreak" id="page_40"/><strong>CONNECTING A LOUDSPEAKER TO A MICRO:BIT</strong></h3>
<p class="noindent">There are a couple of ways to hear sound from your micro:bit. Which one you should choose depends on how much sound you want to make.</p>
<h4 class="h4" id="ch00lev1sec49"><strong>The Quiet Method: Headphones</strong></h4>
<p class="noindent">Perhaps the easiest way to get sound from your micro:bit is to use alligator clip cables to connect the micro:bit to a pair of headphones (see <a href="ch02.xhtml#ch2fig1">Figure 2-1</a>).</p>
<div class="image" id="ch2fig1"><img alt="Image" src="../images/02fig01.jpg"/></div>
<p class="figcap"><em>Figure 2-1: Alligator clips attached to headphones</em></p>
<p class="indent">If you look closely at the metal plug on the headphones, you should see that it is really made of three pieces separated by rings of plastic. This means the plug has three connections. The section closest to the headphones’ wire is the ground connection. Connect this to the micro:bit’s GND (0V) connection with an alligator clip.</p>
<p class="indent">The other two connectors are the audio signals for your left and right ears. If you want to hear sound in both ears, place the alligator clip so that it spans both of the two connectors on the end. You can also attach the alligator clip to the very tip for sound in just one ear (as shown in <a href="ch02.xhtml#ch2fig1">Figure 2-1</a>). Either way, clip the other end of the alligator clip to any of the three micro:bit pins: 0, 1, or 2. Micro:bit users traditionally use pin 0 for audio.</p>
<div class="note">
<p class="notep"><span epub:type="pagebreak" id="page_41"/><span class="yellow"><strong>NOTE</strong></span> <em>Headphones designed for use with a cellphone that include a microphone will have four connectors on the plug rather than three. This shouldn’t make a difference. You can still use the tip as the audio connection and the connector closest to the plug body as the GND connection.</em></p>
</div>
<div class="imagec"><img alt="Image" src="../images/f0041-01.jpg"/></div>
<p class="indent">To upgrade this method slightly, you can use an <em>audio jack adapter</em> like the one shown in <a href="ch02.xhtml#ch2fig2">Figure 2-2</a>. Just plug your headphones straight into the adapter, with the black wire connected to GND and the other to pin 0. Adapters like this fit directly onto the headphones and provide a more reliable connection than alligator clips.</p>
<div class="image" id="ch2fig2"><img alt="Image" src="../images/02fig02.jpg"/></div>
<p class="figcap"><em>Figure 2-2: An adapter to connect an alligator clip to a 3.5 mm audio jack</em></p>
<h4 class="h4" id="ch00lev1sec50"><span epub:type="pagebreak" id="page_42"/><strong>The Ghetto Blaster Method: Speaker</strong></h4>
<p class="noindent">With an amplified speaker such as the one shown in <a href="ch02.xhtml#ch2fig3">Figure 2-3</a>, you can produce a lot more sound using the same connection methods described earlier: either connecting directly to the speaker plug or using an audio jack adapter.</p>
<div class="image" id="ch2fig3"><img alt="Image" src="../images/02fig03.jpg"/></div>
<p class="figcap"><em>Figure 2-3: Connecting a micro:bit to an amplified speaker</em></p>
<p class="noindent">Some speakers are designed especially for use with micro:bits. Some of these have cables that end in alligator clips to attach to your micro:bit, while others, like the Monk Makes Speaker for micro:bit shown in <a href="ch02.xhtml#ch2fig4">Figure 2-4</a>, end in pins similar to the micro:bit’s, making it easy to connect the two with alligator clip cables.</p>
<div class="image" id="ch2fig4"><img alt="Image" src="../images/02fig04.jpg"/></div>
<p class="figcap"><em>Figure 2-4: The Monk Makes Speaker for micro:bit</em></p>
<p class="indent"><span epub:type="pagebreak" id="page_43"/>Amplified speakers need a power source. In some cases, the amplified speaker may have its own batteries or USB cable. Otherwise, the micro:bit itself could power the speaker, in which case the devices will have to connect in three places: to GND (0V) and 3V on the micro:bit in order to power the speaker and to pin 0 (or one of the other pins) for the audio signal coming from the micro:bit.</p>
<p class="indent">Whatever you’re using for audio output, let’s test it out!</p>
<h3 class="h3" id="ch00lev1sec51"><strong>EXPERIMENT 1: GENERATING SOUNDS</strong></h3>
<div class="image"><img alt="Image" src="../images/common2.jpg"/></div>
<p class="noindent">In this experiment, you’ll learn how to generate sounds using your micro:bit and a loudspeaker or headphones.</p>
<h4 class="h4" id="ch00lev1sec52"><strong>What You’ll Need</strong></h4>
<p class="noindent">To carry out this experiment, you just need:</p>
<p class="noindentint"><strong><span class="blue">Micro:bit</span></strong></p>
<p class="noindentin"><strong><span class="blue">Speaker or headphones</span></strong></p>
<p class="noindentinb"><strong><span class="blue">Alligator clip cables</span></strong></p>
<p class="indent">You can find sources for these in the <a href="app01.xhtml">appendix</a>.</p>
<p class="indent">Here we’ll assume you’re using a Monk Makes Speaker for micro:bit and a set of alligator clips, but any of the speaker connection methods listed earlier will work.</p>
<h4 class="h4" id="ch00lev1sec53"><strong>Construction</strong></h4>
<ol>
<li class="noindent">Connect the speaker using one of the methods shown in <a href="ch02.xhtml#ch2fig1">Figures 2-1</a> to <a href="ch02.xhtml#ch2fig4">2-4</a>. Then plug your micro:bit into your computer.</li>
<li class="noindent">Go to <em><a href="https://github.com/simonmonk/mbms/">https://github.com/simonmonk/mbms/</a></em> to access this book’s code repository and click the link for <strong>Experiment 1: Generating Sounds</strong>. Once the program has opened, click <strong>Download</strong> and then copy the hex file onto your micro:bit. If you get stuck, head back to <a href="ch01.xhtml#ch01">Chapter 1</a>, where we discuss the process of getting programs onto your micro:bit in full.
<p class="indent"><span epub:type="pagebreak" id="page_44"/>If you prefer to use Python, download the code from the same website. For instructions for downloading and using the book’s examples, see “Downloading the Code” on <a href="ch01.xhtml#page_34">page 34</a>. The Python file for this experiment is <em>Experiment_01.py</em>.</p></li>
<li class="noindent">Once you’ve successfully programmed the micro:bit, press <strong>button A</strong>. You should hear a tone through your speaker or headphones!</li>
</ol>
<h4 class="h4" id="ch00lev1sec54"><strong>Code</strong></h4>
<p class="noindent">You won’t need much code for this experiment. Whether you use Blocks code or MicroPython, it’s just a matter of detecting button A being pressed and then playing a -.</p>
<h5 class="h5" id="ch00lev1sec55"><strong>Blocks Code</strong></h5>
<p class="noindent">The Blocks code for this experiment is shown here.</p>
<div class="imagec"><img alt="Image" src="../images/f0044-01.jpg"/></div>
<p class="indent">The code uses the <code>on button A pressed</code> block to run the <code>play tone</code> block every time button A is pressed. You drop the <code>play tone</code> block into the <code>on button A pressed</code> block so it clicks into place. Then from the drop-down menu, select the tone you want to hear (in this case <code>Middle C</code>) and the duration of the note (<code>1 beat</code>).</p>
<h5 class="h5" id="ch00lev1sec56"><strong>MicroPython Code</strong></h5>
<p class="noindent">Here’s the MicroPython version of the code:</p>
<div class="programs1"><span class="green">from</span> microbit <span class="green">import</span> <span class="purple">*</span><br/><span class="green">import</span> music<br/><br/><span class="green">while</span> <span class="green">True</span><span class="purple">:</span><br/>    <span class="green">if</span> button_a<span class="purple">.</span>was_pressed<span class="purple">():</span><br/>        music<span class="purple">.</span>pitch<span class="purple">(</span><span class="blue1">262</span><span class="purple">,</span> <span class="blue1">1000</span><span class="purple">)</span></div>
<p class="indent">Python has a huge number of <em>libraries</em>, which are collections of code that do a specific thing. By asking your code <span epub:type="pagebreak" id="page_45"/>to use these libraries, you get access to a lot of functionality without having to write complicated code yourself. The music library is an example: it contains functions you can use to make your micro:bit make sound. To make MicroPython use the music library, you first import the library using the <code>import music</code> command.</p>
<p class="indent">While Blocks code will handle some things on its own, like knowing how often to run code and what order to run it in, MicroPython requires you to make that clear in the code itself. Here, you use a <code>while True:</code> loop to tell the micro:bit to keep checking whether someone has pressed button A.</p>
<p class="indent">When someone does press button A, the note plays using the <code>pitch</code> command, which needs two pieces of information: the frequency of the note (<code>262</code> is middle C) and the duration of the note in milliseconds (in this case, <code>1000</code> milliseconds or 1 second).</p>
<h4 class="h4" id="ch00lev1sec57"><strong>Things to Try</strong></h4>
<p class="noindent">You might like to try changing the tone produced. If you are using Blocks code, go back to the browser and click the <strong>Edit</strong> button to alter the code, then click <strong>Middle C</strong>. This will open up a mini keyboard where you can choose a different note to play. To change the note in MicroPython, enter a new number instead of 262 for the frequency. Then click the <strong>Flash</strong> button again. Later in this chapter, you’ll learn a better way to choose notes using MicroPython.</p>
<p class="indent">You could also try making both buttons A and B play tones and even have them play different tones—a chord!</p>
<h4 class="h4" id="ch00lev1sec58"><strong>How It Works: Frequency and Sound</strong></h4>
<p class="noindent">How does the micro:bit create sound in the speaker? Essentially, the micro:bit switches a current (the flow of electricity) on and off incredibly fast, causing part of the speaker to vibrate, creating sound. The speed at which the micro:bit switches the current on and off determines the <em>frequency</em> of the sound, and that’s what makes different tones. I’ll explain this in more detail.</p>
<p class="indent"><a href="ch02.xhtml#ch2fig5">Figure 2-5</a> shows the parts of a loudspeaker. A rigid, usually metal frame holds a cone in place. The narrow end of this <span epub:type="pagebreak" id="page_46"/>cone is cylindrical and has a coil of wire wrapped around it. Around this coil, fixed to the frame of the loudspeaker, is a strong magnet.</p>
<p class="indent">When a current passes through the coil, it—and hence the whole cone—moves back and forth very rapidly. This vibration creates pressure waves in the air that we hear as sound.</p>
<div class="image" id="ch2fig5"><img alt="Image" src="../images/02fig05.jpg"/></div>
<p class="figcap"><em>Figure 2-5: A loudspeaker</em></p>
<p class="indent">To make a particular sound, the speaker cone needs to move back and forth a certain number of times per second. The number of times per second the speaker moves is its frequency, measured in <em>hertz</em> (shortened to Hz). The higher the frequency, the higher the pitch of the sound. A frequency of 262 Hz corresponds to middle C on a piano. The C an octave higher has a frequency of 524 Hz, or double middle C. In music, when you go up an octave, you double the frequency.</p>
<p class="indent">The micro:bit controls the current and therefore the frequency by turning pin 0 on and off very rapidly. When pin 0 is off, it has an output voltage of 0V, and when it is on, it has a voltage of 3V. If you were to draw a chart of the output voltage against time, it would look like <a href="ch02.xhtml#ch2fig6">Figure 2-6</a>.</p>
<p class="indent">For obvious reasons, this type of wave is called a <em>square wave</em>. Since a micro:bit’s outputs can only ever be on or off, this is the only kind of wave that we can generate from the micro:bit.</p>
<div class="image" id="ch2fig6"><span epub:type="pagebreak" id="page_47"/><img alt="Image" src="../images/02fig06.jpg"/></div>
<p class="figcap"><em>Figure 2-6: A square wave</em></p>
<p class="indent">When the micro:bit sends its signal to the amplified speaker, the speaker takes the low current signal from the micro:bit and increases the current to drive the speaker with more power, making everything louder.</p>
<p class="indent">Now let’s experiment with making sounds.</p>
<h3 class="h3" id="ch00lev1sec59"><strong>EXPERIMENT 2: IT SPEAKS!</strong></h3>
<div class="image"><img alt="Image" src="../images/common2.jpg"/></div>
<p class="noindent">The micro:bit’s MicroPython software has a really neat feature that allows you to make your micro:bit read out phrases. In this experiment, we will try out this feature and have our micro:bit talk to us.</p>
<p class="indent">Although the software that generates the speech was designed for use with English, by experimenting with the spelling, you should be able to make the library speak in other languages.</p>
<p class="indent">This feature isn’t (at the time of writing) available through the Blocks code, so we’ll be using MicroPython.</p>
<h4 class="h4" id="ch00lev1sec60"><strong>What You’ll Need</strong></h4>
<p class="noindent">This project uses exactly the same hardware as Experiment 1.</p>
<p class="noindentint"><strong><span class="blue">Micro:bit</span></strong></p>
<p class="noindentin"><strong><span class="blue">Speaker or headphones</span></strong></p>
<p class="noindentin"><strong><span class="blue">Alligator clip cables</span></strong></p>
<h4 class="h4" id="ch00lev1sec61"><strong>Construction</strong></h4>
<ol>
<li class="noindent">Connect the speaker using one of the methods shown in <a href="ch02.xhtml#ch2fig1">Figures 2-1</a> to <a href="ch02.xhtml#ch2fig4">2-4</a>.</li>
<li class="noindent"><span epub:type="pagebreak" id="page_48"/>This project uses the speech library, which is not available in Blocks code, so this experiment code is for Python only. Go to <em><a href="https://github.com/simonmonk/mbms/">https://github.com/simonmonk/mbms/</a></em> and download the <em>Experiment_02</em>.py file. You’ll also find code for the other projects and instructions for downloading and using the book’s examples on the GitHub page. Flash the program onto your micro:bit.</li>
<li class="noindent">Once the micro:bit has been successfully programmed, press <strong>button A</strong> on the micro:bit. You should hear a message being spoken through your speaker or headphones. The Mad Scientist likes to hear this voice as it’s a reminder of their dear old friend Professor Hawkins, who alas is no longer with us.</li>
</ol>
<h4 class="h4" id="ch00lev1sec62"><strong>Code</strong></h4>
<p class="noindent">The MicroPython code for the experiment is listed here:</p>
<div class="programs1"><span class="green">from</span> microbit <span class="green">import</span> <span class="purple">*</span><br/><span class="green">import</span> speech<br/><br/><span class="green">while</span> <span class="green">True</span><span class="purple">:</span><br/>    <span class="green">if</span> button_a<span class="purple">.</span>was_pressed<span class="purple">():</span><br/>        speech<span class="purple">.</span>say<span class="purple">(</span><span class="red1">"Mad Scientists love micro bits"</span><span class="purple">)</span></div>
<p class="indent">Aside from importing the speech library, getting the micro:bit to speak is as simple as putting some text for it to say in the <code>say</code> function.</p>
<p class="indent">The speech library is quite sophisticated—you can even use it to vary the pitch to make your micro:bit sing! You can find out all about the library at <em><a href="https://microbit-micropython.readthedocs.io/en/latest/tutorials/speech.html">https://microbit-micropython.readthedocs.io/en/latest/tutorials/speech.html</a></em>.</p>
<h3 class="h3" id="ch00lev1sec63"><strong>PROJECT: MUSICAL DOORBELL</strong></h3>
<div class="image"><img alt="Image" src="../images/common3.jpg"/></div>
<p class="difficulty"><em>Difficulty: Easy</em></p>
<p class="noindent">The Mad Scientist is particularly partial to a musical doorbell. In fact, you will not be surprised to hear that one of the scientist’s favorite tunes is “Imperial March” from <em>Star Wars</em>.</p>
<p class="indent">In <a href="ch10.xhtml#ch10">Chapter 10</a>, we will revisit this project, adding a second micro:bit that will make the doorbell work wirelessly.</p>
<p class="indent"><span epub:type="pagebreak" id="page_49"/>This project (shown in <a href="ch02.xhtml#ch2fig7">Figure 2-7</a>) is a variation on Experiment 1, except that instead of playing a single tone when a button is pressed, the doorbell will play tunes. We’ll have button A play one tune and button B play another. You can see a short video of the project in action here: <em><a href="https://youtu.be/xmLupw4PxYQ/">https://youtu.be/xmLupw4PxYQ/</a></em>.</p>
<div class="image" id="ch2fig7"><img alt="Image" src="../images/02fig07.jpg"/></div>
<p class="figcap"><em>Figure 2-7: The musical doorbell project</em></p>
<p class="indent">Giving the visitor two tunes to choose from allows them to indicate the level of urgency of their visit. Then if the Mad Scientist is busy, they can just ignore the person at the door!</p>
<h4 class="h4" id="ch00lev1sec64"><strong>What You’ll Need</strong></h4>
<p class="noindent">For this project, you will need the following items:</p>
<p class="noindentint"><strong><span class="blue">Micro:bit</span></strong> To be the controller for this project and provide two buttons to press</p>
<p class="noindentin"><strong><span class="blue">3 × Alligator clip cables</span></strong> To connect the micro:bit to the speaker (Longer cables will make this easier)</p>
<p class="noindentin"><strong><span class="blue">USB power adapter or 3V battery pack with power switch</span></strong> To power the micro:bit and speaker</p>
<p class="noindentin"><strong><span class="blue">Speaker</span></strong> To play the doorbell tune (I recommend the Monk Makes Speaker for micro:bit)</p>
<p class="noindentin"><strong><span class="blue">Adhesive putty or self-adhesive pads</span></strong> To attach the micro:bit to the door frame and the speaker to the inside of the door frame</p>
<div class="imagec"><span epub:type="pagebreak" id="page_50"/><img alt="Image" src="../images/f0050-01.jpg"/></div>
<p class="indent">If you use batteries for this project, it’s a good idea to use a battery box with a power switch so that when not in use, the doorbell can be switched off to save the batteries. Otherwise, the batteries will be exhausted after only a day or so of use. A USB power supply offers a longer-term solution that can be left on all the time.</p>
<h4 class="h4" id="ch00lev1sec65"><strong>Construction</strong></h4>
<p class="noindent">When building a new project, it’s always worth constructing and testing it at your desk before you fit it into place where it will be used.</p>
<ol>
<li class="noindent">Connect the speaker to the micro:bit using the three alligator cables, as shown in <a href="ch02.xhtml#ch2fig7">Figure 2-7</a>.
<p class="indent">It’s a good idea to use color-coding for your cables, with black for GND, red for 3V, and any other color for the audio connection from pin 0 of the micro:bit. Using different colors will help you keep track of the connections.</p></li>
<li class="noindent">Go to <em><a href="https://github.com/simonmonk/mbms/">https://github.com/simonmonk/mbms/</a></em> to access the book’s code repository and click the link for <strong>Musical Doorbell</strong>. Once the program has opened, click <strong>Download</strong> and then copy the hex file onto your micro:bit. If you get <span epub:type="pagebreak" id="page_51"/>stuck on this, head back to <a href="ch01.xhtml#ch01">Chapter 1</a>, where we discuss the process of getting programs onto your micro:bit in full. If you prefer to use Python, download the code from the same website, along with instructions for downloading and using the book’s examples. The Python file for this experiment is <em>ch_02_Doorbell.py</em>.</li>
<li class="noindent">Once the micro:bit has been successfully programmed, press <strong>button A</strong> on the micro:bit and you should hear a tune playing (Scott Joplin’s “The Entertainer”). Now press <strong>button B</strong> and you will hear Frédéric Chopin’s “Funeral March.”</li>
<li class="noindent">Once you have everything working, disconnect the micro:bit from your computer and plug it into your USB power adapter or battery box. Test it out again to make sure you’ve got it working. Then fix the micro:bit part of the project onto one side of your door and the speaker side of the project to the other side of the door. There are a few things to note here:
<p class="indent">Firstly, sticking things to walls, even with adhesive putty, can make a mess, so make sure you get permission if you need to. This is especially true if you are using sticky pads, as these can attach quite permanently to paint.</p>
<p class="indent">Secondly, the alligator clips will need to pass from one side of the door to the other in such a way that they don’t get too pinched when the door closes. So work out where they need to go before you start sticking anything down. In <a href="ch10.xhtml#ch10">Chapter 10</a>, we will make another version of this project that uses a second micro:bit to provide a wireless link.</p>
<p class="indent">Finally, if you are using a USB power adapter, you will need a power outlet that’s close enough for the USB power adapter to reach your micro:bit.</p></li>
</ol>
<h4 class="h4" id="ch00lev1sec66"><strong>Code</strong></h4>
<p class="noindent">Now let’s talk through the code for the project.</p>
<h5 class="h5" id="ch00lev1sec67"><span epub:type="pagebreak" id="page_52"/><strong>Blocks Code</strong></h5>
<p class="noindent">Here’s the Blocks code.</p>
<div class="imagec"><img alt="Image" src="../images/f0052-01.jpg"/></div>
<p class="indent">The code is similar to that of Experiment 1, with a few differences. First, we have two stacks of code: one for button A and one for button B. Second, we choose <code>once</code> from the <code>repeating</code> menu, because we want the melody to play only once.</p>
<p class="indent">Third, we use the <code>start melody</code> block to play a whole sequence of notes rather than just a single note. Notice that these tunes are already available in the blocks—you just need to select them from the menu!</p>
<h5 class="h5" id="ch00lev1sec68"><strong>MicroPython Code</strong></h5>
<p class="noindent">Here is the MicroPython version of the program:</p>
<div class="programs1"><span class="green">from</span> microbit <span class="green">import</span> <span class="purple">*</span><br/><span class="green">import</span> music<br/><br/><span class="green">while</span> <span class="green">True</span><span class="purple">:</span><br/>    <span class="green">if</span> button_a<span class="purple">.</span>was_pressed<span class="purple">():</span><br/>        music<span class="purple">.</span>play<span class="purple">(</span>music<span class="purple">.</span>ENTERTAINER<span class="purple">)</span><br/>    <span class="green">elif</span> button_b<span class="purple">.</span>was_pressed<span class="purple">():</span><br/>        music<span class="purple">.</span>play<span class="purple">(</span>music<span class="purple">.</span>FUNERAL<span class="purple">)</span></div>
<p class="indent">This works exactly the same as the Blocks code. The <code>music.play</code> method is equivalent to the <code>start melody</code> block, and we use <code>if</code> statements to check which button was pressed. The <code>if</code> statements allow button A and button B to play different tunes.</p>
<p class="indent"><span epub:type="pagebreak" id="page_53"/>The same predefined tunes are available to play in both Blocks and MicroPython code.</p>
<h4 class="h4" id="ch00lev1sec69"><strong>Things to Try</strong></h4>
<p class="noindent">Picking from a selection of predefined tunes is all very well, but the Mad Scientist may have particular tastes in music. They may want to compose their own tunes!</p>
<p class="indent">If you are using Blocks code, you can make your own tune by creating a list of <code>play tone</code> blocks, like the example shown here. You fill out the notes you want played, and each note is played in turn.</p>
<div class="imagec"><img alt="Image" src="../images/f0053-01.jpg"/></div>
<p class="indent">So if you know all the notes for a particular tune, you can create it like this. You’ll also need to specify how long each note needs to play. You may have to experiment a bit before you get your music to sound just the way you want.</p>
<p class="indent">Now let’s see how to create a tune in MicroPython:</p>
<div class="programs1"><span class="green">from</span> microbit <span class="green">import</span> <span class="purple">*</span><br/><span class="green">import</span> music<br/><br/>notes <span class="purple">=</span> <span class="purple">[</span><span class="red1">'A4:4'</span><span class="purple">,</span> <span class="red1">'A'</span><span class="purple">,</span> <span class="red1">'A'</span><span class="purple">,</span> <span class="red1">'F:2'</span><span class="purple">,</span> <span class="red1">'C5:2'</span><span class="purple">,</span> <span class="red1">'A4:4'</span><span class="purple">,</span> <span class="red1">'F:2'</span><span class="purple">,</span> <span class="red1">'C5:2'</span><span class="purple">,</span> <span class="red1">'A4:4'</span><span class="purple">]</span><br/><br/><span class="green">while</span> <span class="green">True</span><span class="purple">:</span><br/>    <span class="green">if</span> button_a<span class="purple">.</span>was_pressed<span class="purple">():</span><br/>        music<span class="purple">.</span>play<span class="purple">(</span>notes<span class="purple">)</span></div>
<p class="indent">The music library for MicroPython takes care of playing whole tunes by letting you use a special notation to write your own melodies. Each note is made up of a string of characters (see <a href="ch01.xhtml#ch01">Chapter 1</a> for more information on strings). The <span epub:type="pagebreak" id="page_54"/>first character of the string is the note name (a letter A to G). Next comes an octave number—middle C is in octave number 4, so you will probably want to restrict your tune to around octaves 3, 4, and 5. The octave number is optional, and if you don’t give it, Python will assume you want the first octave.</p>
<p class="indent">Once you specify an octave number, the music library will assume that octave applies to all following notes until you specify a different octave number.</p>
<p class="indent">Next, you can optionally put a colon followed by a duration. The duration is measured in quarter-notes. For example, to play middle C for a half-note, you would write <code>C4:2</code>.</p>
<p class="indent">To string together several notes, you have to create a <em>list</em>. So far we’ve used variables that hold only a single element. A list is like a variable that can hold multiple elements, and you can access and use each element independently. To indicate that the <code>notes</code> variable contains a list of values, rather than just a single value, you’ll separate the array values by commas and enclose the whole thing between <code>[</code> and <code>]</code>.</p>
<p class="indent">In our array, each element is a note string. To play the whole sequence of notes, you use the <code>play</code> function, providing it with the list of notes to play. This example plays the opening few notes from the <em>Star Wars</em> “Imperial March.”</p>
<p class="indent">Here, you see we import the usual microbit library, as well as the music library. We save our tune in a variable called <code>notes</code>. Then we make another <code>while True:</code> loop so that the code keeps running and checking whether the button was pressed. We tell the program that if button A is pressed, it should play the <code>notes</code> variable.</p>
<h3 class="h3" id="ch00lev1sec70"><strong>PROJECT: SHOUT-O-METER</strong></h3>
<div class="image"><img alt="Image" src="../images/common3.jpg"/></div>
<p class="difficulty"><em>Difficulty: Easy</em></p>
<p class="noindent">The Mad Scientist likes to measure things. To that end, this project makes a simple sound meter that indicates the volume of a noise. Then the scientist can tell the neighbors off for making too much noise—and prove they really are.</p>
<h4 class="h4" id="ch00lev1sec71"><span epub:type="pagebreak" id="page_55"/><strong>What You’ll Need</strong></h4>
<p class="noindent">For this project, you need a microphone to pick up sounds so you can measure their volume. I’m going to use the microphone built into the Monk Makes Sensor, which has a bunch of sensors. The sound’s volume then appears on the micro:bit’s LED display. The louder the sound, the more LEDs will light up.</p>
<p class="indent">For this project, you will need the following items:</p>
<p class="noindentint"><strong><span class="blue">Micro:bit</span></strong> To be the controller for this project and provide two buttons to press</p>
<p class="noindentin"><strong><span class="blue">3 × Alligator clip cables</span></strong> To connect the micro:bit to the speaker (Longer cables will make this easier)</p>
<p class="noindentin"><strong><span class="blue">Any micro:bit power source</span></strong> Can be the USB computer cable or a battery box</p>
<p class="noindentin"><strong><span class="blue">Monk Makes Sensor for micro:bit</span></strong> To supply a microphone</p>
<h4 class="h4" id="ch00lev1sec72"><strong>Construction</strong></h4>
<ol>
<li class="noindent">Connect the sensor board to the micro:bit using the three alligator clips, as shown in <a href="ch02.xhtml#ch2fig8">Figure 2-8</a>. You need to connect 3V on the sensor to 3V on the micro:bit, GND to GND, and the hole with the microphone picture to pin 0 on the micro:bit.
<p class="indent">It’s a good idea to stick to the color-coding of the cables, with black for GND, red for 3V, and any other color for the microphone connection from pin 0 of the micro:bit.</p>
<div class="image" id="ch2fig8"><img alt="Image" src="../images/02fig08.jpg"/></div>
<p class="figcap"><em>Figure 2-8: The Shout-o-meter project</em></p></li>
<li class="noindent"><span epub:type="pagebreak" id="page_56"/>Go to <em><a href="https://github.com/simonmonk/mbms/">https://github.com/simonmonk/mbms/</a></em> to access the book’s code repository and click the link for <strong>Shout-O-Meter</strong>. Once the program has opened, click <strong>Download</strong> and then copy the hex file onto your micro:bit. If you get stuck on this, head back to <a href="ch01.xhtml#ch01">Chapter 1</a>, where we discuss in detail how to get programs onto your micro:bit.
<p class="indent">If you prefer to use Python, then download the code from the same website, along with instructions for downloading and using the book’s examples. The Python file for this experiment is <em>ch_2_Shoutometer.py</em>.</p></li>
<li class="noindent">Once you’ve programmed the micro:bit, try whistling near the microphone (<a href="ch02.xhtml#ch2fig9">Figure 2-9</a>) and notice how the LEDs jump in response to the sound level. You can also try tapping the microphone. You can see a short video of the project in action here: <em><a href="https://youtu.be/6pGDSHmfFng/">https://youtu.be/6pGDSHmfFng/</a></em>.
<div class="image" id="ch2fig9"><img alt="Image" src="../images/02fig09.jpg"/></div>
<p class="figcap"><em>Figure 2-9: The Monk Makes Sensor for micro:bit microphone</em></p></li>
</ol>
<h4 class="h4" id="ch00lev1sec73"><strong>Code</strong></h4>
<p class="noindent">The Blocks version of this code is able to make use of the built-in <code>plot bar graph of</code> block, whereas the MicroPython version is more complicated because we have to implement our own version of this feature.</p>
<h5 class="h5" id="ch00lev1sec74"><span epub:type="pagebreak" id="page_57"/><strong>Blocks Code</strong></h5>
<p class="noindent">The Blocks language includes a useful block called <code>plot bar graph of</code> that makes the code for displaying the sound level really easy.</p>
<div class="imagec"><img alt="Image" src="../images/f0057-01.jpg"/></div>
<p class="indent">We put a <code>forever</code> block in, so the code inside is constantly running. Then we add the <code>plot bar graph of</code> block, which will display the loudness from the microphone.</p>
<p class="indent">As you can see, the analog value read from pin 0 of the micro:bit has <code>511</code> subtracted from it before being passed to <code>plot bar graph of</code> with a maximum value of <code>up to</code> set to <code>512</code>. The reason for this bit of math is discussed in “How It Works: Microphone Output” on <a href="ch02.xhtml#page_59">page 59</a>.</p>
<p class="indent">Getting the right blocks assembled can be tricky, especially when it comes to math. Fortunately, the editor allows you to freely move blocks around, so if they are not in the right place to give you the results you want, you can just drag them to where they should be. See <a href="ch01.xhtml#ch01">Chapter 1</a> for more information on editing code.</p>
<h5 class="h5" id="ch00lev1sec75"><strong>MicroPython Code</strong></h5>
<p class="noindent">The MicroPython version of the code is a little more complicated than the Blocks code. MicroPython does not have a built-in bar graph display, so we have to write our own. The <code>plot bar graph of</code> block provides a nice, smooth display, despite rapidly changing data. To get the same result in MicroPython, I had to add code to read the maximum sound level from 10 samples.</p>
<div class="programs1"><span epub:type="pagebreak" id="page_58"/><span class="green">from</span> microbit <span class="green">import</span> <span class="purple">*</span><br/><br/><span class="green">def</span> <span class="blue1">sound_level</span><span class="purple">():</span><br/>    max_level <span class="purple">=</span> <span class="blue1">0</span><br/>    <span class="green">for</span> i <span class="green">in</span> <span class="blue1">range</span><span class="purple">(</span><span class="blue1">0</span><span class="purple">,</span> <span class="blue1">10</span><span class="purple">):</span><br/>        sound_level = <span class="purple">(</span>pin0<span class="purple">.</span>read_analog<span class="purple">()</span> <span class="purple">-</span> <span class="blue1">511</span><span class="purple">)</span> <span class="purple">/</span> <span class="blue1">100</span><br/>        <span class="green">if</span> sound_level <span class="purple">&gt;</span> max_level<span class="purple">:</span><br/>            max_level <span class="purple">=</span> sound_level<br/>    <span class="green">return</span> max_level<br/><br/><span class="green">def</span> <span class="blue1">bargraph</span><span class="purple">(</span>a<span class="purple">):</span><br/>    display<span class="purple">.</span>clear<span class="purple">()</span><br/>    <span class="green">for</span> y <span class="green">in</span> <span class="blue1">range</span><span class="purple">(</span><span class="blue1">0</span><span class="purple">,</span> <span class="blue1">5</span><span class="purple">):</span><br/>        <span class="green">if</span> a <span class="purple">&gt;</span> y<span class="purple">:</span><br/>            <span class="green">for</span> x <span class="green">in</span> <span class="blue1">range</span><span class="purple">(</span><span class="blue1">0</span><span class="purple">,</span> <span class="blue1">5</span><span class="purple">):</span><br/>                display<span class="purple">.</span>set_pixel<span class="purple">(</span>x<span class="purple">,</span> <span class="blue1">4</span><span class="purple">-</span>y<span class="purple">,</span> <span class="blue1">9</span><span class="purple">)</span><br/><br/><span class="green">while</span> <span class="green">True</span><span class="purple">:</span><br/>    bargraph<span class="purple">(</span>sound_level<span class="purple">())</span><br/>    sleep<span class="purple">(</span><span class="blue1">10</span><span class="purple">)</span></div>
<p class="indent">We use the <code>sound_level</code> function and make a <code>for</code> loop to take 10 samples of sound. Each sample value is (as with the Blocks version of the code) the analog value with <code>511</code> subtracted from it. However in this case, to scale down the number of rows to be lit to 0 to 4, we divide the resulting value by 100. We then compare the sound level stored in the variable <code>sound_level</code> to the variable <code>max_level</code> and, if it is greater, <code>max_level</code> is changed to be the <code>sound_level</code>. When all 10 samples have been taken, the largest one will be in <code>max_level</code>, and this value is returned by the function.</p>
<p class="indent">The <code>bargraph</code> function takes a value, represented by <code>a</code>, to display. The higher the value, the more LEDs will be lit, indicating a louder noise. This value should be between 0 and 4. However, if it is greater than 4, it doesn’t matter—all the LEDs in the display will turn on, but nothing else will happen. The function works by looping over each row of the display, and, if the value of <code>a</code> is greater than the row number, every LED on that row is illuminated by the inner <code>for</code> loop that asks whether <code>x</code> is in the range of 0 to 4.</p>
<p class="indent">All the main <code>while</code> loop has to do is call the function <code>bargraph</code>, supplying it with the sound level returned by the function <code>sound_level</code>.</p>
<h4 class="h4" id="ch00lev1sec76"><span epub:type="pagebreak" id="page_59"/><strong>How It Works: Microphone Output</strong></h4>
<p class="noindent"><a href="ch02.xhtml#ch2fig10">Figure 2-10</a> shows a graph of the output of the microphone when it is detecting sound. Voltage is on the vertical axis, and time in on the horizontal axis.</p>
<div class="image" id="ch2fig10"><img alt="Image" src="../images/02fig10.jpg"/></div>
<p class="figcap"><em>Figure 2-10: A sample of sound</em></p>
<p class="indent">As you can see from the left-hand side of the plot, before the sound starts, the output voltage from the sensor is level at about 1.5V. When the sound starts, the voltage oscillates above and below this 1.5V value as the microphone picks up the pressure waves of the sound. A reading of 1.5V on the micro:bit gives an analog value of 511. This is why we subtract 511 from the reading before displaying it on the micro:bit; otherwise, half the LEDs would be on during silence.</p>
<h3 class="h3" id="ch00lev1sec77"><strong>SUMMARY</strong></h3>
<p class="noindent">In this chapter, the Mad Scientist explored the world of sound, both by producing music and speech from the micro:bit and by detecting sound using a microphone. We have started our exploration of the micro:bit with a couple of easy projects.</p>
<p class="indent">In the next chapter, we will take a look at light. We’ll measure light with a special sensor and use the micro:bit’s LED display. Then we’ll tackle a large project, using the multicolored NeoPixel display and combining light with sound to make a light-controlled musical instrument. After that, we’ll move on to other, even more challenging projects.<span epub:type="pagebreak" id="page_60"/></p>
</body></html>