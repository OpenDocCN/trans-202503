<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" epub:prefix="z3998: http://www.daisy.org/z3998/2012/vocab/structure/#" lang="en" xml:lang="en">
  <head>
    <title>Project 9: All-in-One Weather Sensor Station</title>
    <link href="../styles/9781593278717.css" rel="stylesheet" type="text/css"/>
    <link href="../68851547a55f.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <div id="sbo-rt-content"><h2 class="h2" id="ch09"><span epub:type="pagebreak" id="page_126"/><strong>9<br/>All-in-One Weather Sensor Station</strong></h2>
<p class="noindent"><span class="violet">In this project, you’ll build a local weather station that detects the temperature, humidity, and barometric pressure with the Sense HAT. You’ll also create a graphical user interface to display temperature, humidity, and barometric pressure readings in real time.</span></p>
<div class="image"><span epub:type="pagebreak" id="page_127"/><img src="../images/f0127-01.jpg" alt="image"/></div>
<p class="cap"><span class="violet"><strong>PARTS REQUIRED</strong></span></p>
<p class="cap1">Raspberr y Pi (versions with 40 GPIOs)</p>
<p class="cap1">Sense HAT</p>
<h3 class="h3" id="lev97"><span epub:type="pagebreak" id="page_128"/><span class="violet"><strong>THE SENSE HAT AS A WEATHER STATION</strong></span></h3>
<p class="noindent">The Sense HAT makes an excellent small and affordable weather station, as it comes with temperature, humidity, and barometric pressure sensors. Reading sensor values with the Sense HAT is very straightforward, so this is a good starting point to learn about sensor readings.</p>
<h4 class="h4" id="lev98"><span class="violet"><strong>The Temperature Sensor</strong></span></h4>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep"><em>The temperature readings might be a few degrees off when compared to the real value. The Sense HAT fits over the Pi and the heat from the Raspberry Pi processor can alter the results slightly.</em></p>
</div>
<p class="noindent">As the name suggests, the temperature sensor measures temperature. By default, the Sense HAT reads the temperature in degrees Celsius, so if you prefer the temperature in degrees Fahrenheit, you’ll need to convert the reading. To do so, multiply the degrees in Celsius by 9, divide by 5, and add 32, as shown in the following formula.</p>
<div class="image1"><img src="../images/f0128-01.jpg" alt="image"/></div>
<p class="indent">You can add this formula to your code so that it does the conversion for you.</p>
<h4 class="h4" id="lev99"><span class="violet"><strong>The Humidity Sensor</strong></span></h4>
<p class="noindent">There are two common ways of expressing humidity: absolute humidity and relative humidity. <em>Absolute humidity</em> is the mass of water vapor in a certain volume of air, regardless of temperature, and it is expressed as kilograms per cubic meter (kg/m<sup>3</sup>). The amount of water vapor that the air can hold changes with temperature. The higher the temperature, the more water vapor it can hold. <em>Relative humidity</em> is expressed as a percentage and is the current water vapor in the air in relation to the maximum possible amount at a given temperature.</p>
<p class="indent">The Sense HAT records relative humidity because it’s more useful for weather forecasts: the greater the relative humidity percentage, the higher the probability of precipitation. As relative humidity changes with temperature, it’s always coupled with a temperature sensor.</p>
<h4 class="h4" id="lev100"><span class="violet"><strong>The Barometric Pressure Sensor</strong></span></h4>
<p class="noindent">The barometric pressure sensor reads atmospheric pressure, the “weight” of the air at a given point, measured in hPa (hectoPascal), which is equivalent to mbar (millibar). Why is it interesting to measure pressure? Because changes in atmospheric pressure can help you forecast the weather. Rising pressure tends to be a sign of good weather to come, and falling pressure a sign of bad weather, like rain or storms.</p>
<p class="indent"><span epub:type="pagebreak" id="page_129"/>Changes in pressure are really small. You need to follow your barometer readings meticulously to notice a trend.</p>
<h3 class="h3" id="lev101"><span class="violet"><strong>READING TEMPERATURE, HUMIDITY, AND PRESSURE</strong></span></h3>
<p class="noindent">Now let’s look at how to read from the sensors and print the readings to the Python shell.</p>
<p class="indent">Mount your Sense HAT on your Pi like you did in <a href="ch08.xhtml#ch08">Project 8</a> and make sure it’s well connected. When it’s first connected, the Sense HAT should display a rainbow background that matches the rainbow you see on the screen when you boot your Pi (see <a href="ch09.xhtml#ch09fig1">Figure 9-1</a>).</p>
<div class="image"><a id="ch09fig1"/><img src="../images/f0129-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 9-1:</strong> Sense HAT rainbow background</p>
<p class="indent">Inside your <em>Projects</em> folder create a new folder called <em>Sensors</em>. Then open <strong>Python 3 (IDLE)</strong> and go to <strong>File</strong> <span class="ent">▸</span> <strong>New</strong> to create a new script called <em>weather_data.py</em> and enter the code in <a href="ch09.xhtml#ch09list1">Listing 9-1</a> (remember that you can download all the scripts at <em><a href="https://www.nostarch.com/RaspberryPiProject/">https://www.nostarch.com/RaspberryPiProject/</a></em> ).</p>
<p class="listing" id="ch09list1"><strong>LISTING 9-1:</strong> Reading temperature, humidity, and pressure with the Sense HAT</p>
<div class="box">
<p class="programs"><span class="ent">➊</span> <span class="orange">from</span> sense_hat <span class="orange">import</span> SenseHat<br/>  <span class="red1">#from sense_emu import SenseHat</span><br/><br/>  <span class="orange">from</span> time <span class="orange">import</span> sleep<br/><br/>  <span class="red1">#create an object called sense</span><br/><span class="ent">➋</span> sense = SenseHat()<br/><br/>  <span class="orange">while True</span>:<br/>   <span class="ent">➌</span> temperature = sense.temperature<br/>   <span class="ent">➍</span> temperature = <span class="purple">str</span>(<span class="purple">round</span>(temperature, 2))<br/>   <span class="ent">➎</span> <span class="purple">print</span>(<span class="green">'Temperature: '</span> + temperature + <span class="green">'*C\n'</span>)<br/><span epub:type="pagebreak" id="page_130"/>     humidity = sense.humidity<br/>     humidity = <span class="purple">str</span>(<span class="purple">round</span>(humidity, 2))<br/>     <span class="purple">print</span> (<span class="green">'Humidity: '</span> + humidity + <span class="green">'%\n'</span>)<br/><br/>     pressure = sense.pressure<br/>     pressure = <span class="purple">str</span>(<span class="purple">round</span>(pressure, 2))<br/>     <span class="purple">print</span>(<span class="green">'Pressure: '</span> + pressure + <span class="green">'hPa\n'</span>)<br/><br/>     sleep(1)</p>
</div>
<p class="indent">First you import the <span class="literal">SenseHat</span> class from the sense_hat library <span class="ent">➊</span>. Then, you create an object called <span class="literal">sense</span> to refer to the Sense HAT <span class="ent">➋</span>.</p>
<p class="indent">Getting the sensor readings <span class="ent">➌</span> is simple thanks to the following, aptly named functions:</p>
<ul>
<li class="noindent"><span class="literal">sense.temperature</span> gets the temperature reading.</li>
<li class="noindent"><span class="literal">sense.humidity</span> gets the humidity reading.</li>
<li class="noindent"><span class="literal">sense.pressure</span> gets the pressure reading.</li>
</ul>
<p class="indent">The readings are given to several decimal places, so you use the function <span class="literal">round()</span> to round the numbers and make the results more readable. The <span class="literal">round()</span> function <span class="ent">➍</span> accepts as arguments the number you want to round and the number of decimal places you want to set, in that order—here, it’s set to two decimal places. You also use the <span class="literal">str()</span> function that converts the argument it takes into a string. You need to convert the readings into a string so you can concatenate them with the text you’ll print to the shell <span class="ent">➎</span>.</p>
<p class="indent">Now you’re almost a meteorologist! Next, you’ll build a user interface for your weather data.</p>
<h3 class="h3" id="lev102"><span class="violet"><strong>BUILDING A USER INTERFACE FOR YOUR READINGS</strong></span></h3>
<p class="noindent">Let’s take this project to another level and build a cool user interface to display your sensor readings. Your interface should feature:</p>
<ul>
<li class="noindent">A window in your desktop that displays temperature, humidity, and pressure</li>
<li class="noindent">The humidity displayed in a vertical progress bar from 0 to 100 percent</li>
<li class="noindent">The temperature and pressure displayed in numbers</li>
<li class="noindent">Labels for each reading</li>
</ul>
<p class="indent"><a href="ch09.xhtml#ch09fig2">Figure 9-2</a> shows a draft layout for the user interface that should help you work out how to go about the code.</p>
<div class="image"><span epub:type="pagebreak" id="page_131"/><a id="ch09fig2"/><img src="../images/f0131-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 9-2:</strong> Graphical user interface draft</p>
<p class="indent">You’ll also be able to edit the code to choose font type, size, and color, and how labels and readings are positioned within the window. The following table gives you a list of all the titles and values and how we’ll display them.</p>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_th-l"><p class="tab_th"><strong>WIDGET</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>OPTIONS</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">Window Title</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="taba"><span class="violet">Text: “Local Weather Station”</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">Humidity Title</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="taba"><span class="violet">Text: “Humidity”, Font: Helvetica, Size: 18, Vertical padding: 3</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">Humidity Value</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="taba"><span class="violet">Font: Courier, Size: 20, Color: Blue, Position: North</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">Humidity Progress Bar</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="taba"><span class="violet">Orientation: Vertical, Size: 20, Color: Blue, Position: North, Length: 200, Maximum Value: 100</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">Temperature Title</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="taba"><span class="violet">Text: “Temperature”, Font: Helvetica, Size: 18, Position: South</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">Temperature Value</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="taba"><span class="violet">Font: Courier, Size: 20, Color: Red, Position: North</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">Pressure Title</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="taba"><span class="violet">Text: “Pressure”, Font: Helvetica, Size: 18, Position: South</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">Pressure Value</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="taba"><span class="violet">Font: Courier, Size: 20, Color: Green, Position: North</span></p></td>
</tr>
</tbody>
</table>
<h3 class="h3" id="lev103"><span class="violet"><strong>WRITING THE SCRIPT</strong></span></h3>
<p class="noindent">Open <strong>Python 3 (IDLE)</strong> and go to <strong>File</strong> <span class="ent">▸</span> <strong>New File</strong> to create a new script. Copy the code in <a href="ch09.xhtml#ch09list2">Listing 9-2</a> to the Python Editor and save the script as <em>weather_station.py</em> inside the <em>Sensors</em> folder (remember <span epub:type="pagebreak" id="page_132"/>that you can download all the scripts at <em><a href="https://www.nostarch.com/RaspberryPiProject/">https://www.nostarch.com/RaspberryPiProject/</a></em>):</p>
<p class="listing" id="ch09list2"><strong>LISTING 9-2:</strong> Displaying the Sense HAT readings in a graphical user interface</p>
<div class="box">
<p class="programs">  <span class="red1">#import necessary libraries</span><br/><span class="ent">➊</span> <span class="orange">from</span> tkinter <span class="orange">import</span> *<br/>  <span class="orange">from</span> tkinter <span class="orange">import</span> ttk<br/>  <span class="orange">import</span> time<br/>  <span class="orange">from</span> sense_hat <span class="orange">import</span> SenseHat<br/>  <span class="red1">#from sense_emu import SenseHat</span><br/><br/>  <span class="red1">#create an object called sense</span><br/>  sense = SenseHat()<br/><br/>  <span class="red1">#create window</span><br/><span class="ent">➋</span> window = Tk()<br/>  window.title(<span class="green">'Local Weather Station'</span>)<br/>  window.geometry(<span class="green">'200x480'</span>)<br/><br/>  <span class="red1">#create humidity label for title and value</span><br/><span class="ent">➌</span> humidity_label = Label(window, text = <span class="green">'Humidity'</span>, font =<br/>  (<span class="green">'Helvetica'</span>, 18), pady = 3)<br/>  humidity_label.pack()<br/><br/><span class="ent">➍</span> humidity = StringVar()<br/><br/><span class="ent">➎</span> humidity_value=Label(window, textvariable = humidity,font =<br/>  (<span class="green">'Courier'</span>, 20), fg = <span class="green">'</span><span class="green">blue'</span>, anchor = N, width = 200)<br/>  humidity_value.pack()<br/><br/>  <span class="red1">#create humidity canvas</span><br/><span class="ent">➏</span> humidity_canvas = Canvas(window, width = 200, height = 200)<br/>  humidity_canvas.pack()<br/><br/>  <span class="red1">#create humidity progress bar</span><br/><span class="ent">➐</span> humidity_bar = DoubleVar()<br/><br/><span class="ent">➑</span> progressbar_humidity = ttk.Progressbar(humidity_canvas, variable =<br/>  humidity_bar, orient = VERTICAL, length = 200, maximum = 100)<br/>  progressbar_humidity.pack(fill=X, expand=1)<br/><br/>  <span class="red1">#create temperature label for title and value</span><br/>  temperature_label = Label(window, text = <span class="green">'Temperature'</span>, font =<br/>  (<span class="green">'Helvetica'</span>, 18),anchor = S, width = 200, height = 2)<br/>  temperature_label.pack()<br/><br/>  temperature = StringVar()<br/><br/>  temperature_value = Label(window, textvariable = temperature, font =<br/>  (<span class="green">'</span><span class="green">Courier'</span>, 20),fg = <span class="green">'red'</span>, anchor = N, width = 200)<br/>  temperature_value.pack()<br/><br/>  <span class="red1">#create pressure label for title and value</span><br/><span epub:type="pagebreak" id="page_133"/>  pressure_label = Label(window, text = <span class="green">'Pressure'</span>, font =<br/>  (<span class="green">'Helvetica'</span>, 18), anchor = S, width = 200, height = 2)<br/>  pressure_label.pack()<br/><br/>  pressure = StringVar()<br/><br/>  pressure_value = Label(window, textvariable = pressure, font =<br/>  (<span class="green">'Courier'</span>, 20), fg = <span class="green">'green'</span>, anchor = N, width = 200)<br/>  pressure_value.pack()<br/><br/><span class="ent">➒</span> <span class="orange">def</span> <span class="blue">update_readings</span>():<br/>      humidity.set(<span class="purple">str</span>(<span class="purple">round</span>(sense.humidity, 2)) + <span class="green">'%'</span>)<br/>      humidity_bar.set(sense.humidity)<br/>      temperature.set(<span class="purple">str</span>(<span class="purple">round</span>(sense.temperature, 2)) + <span class="green">'°C'</span>)<br/>      <span class="red1">#temperature.set(str(round(sense.temperature*(9/5)+32, 2))</span><br/>  <span class="red1">+ '*F')</span><br/>      pressure.set(<span class="purple">str</span>(<span class="purple">round</span>(sense.pressure)) + <span class="green">'hPa'</span>)<br/>      window.update_idletasks()<br/>      window.after(3000, update_readings)<br/><br/><span class="ent">➓</span> update_readings()<br/>  window.mainloop()</p>
</div>
<p class="indent">As usual, you start the code by importing the necessary libraries <span class="ent">➊</span>. You may wonder why we need to import ttk if we’ve already imported everything with <span class="literal">*</span> from the tkinter library in the previous line. In this case, when you import with the wildcard <span class="literal">*</span>, you’re importing only a subset of what’s stored in the library folder—there isn’t any particular reason for this, it’s just the way the author of the library decided to do it—so we need to import the ttk library that’s also needed for this user interface separately.</p>
<p class="indent">To gather weather data, you need to use the physical Sense HAT and the sense_hat library.</p>
<h4 class="h4" id="lev104"><span class="violet"><strong>Creating the User Interface</strong></span></h4>
<p class="noindent">After importing all of the libraries, you implement the part of the code that creates the user interface. First, you create a window that’s 200×480 pixels and give it the title <span class="literal">Local Weather Station</span> <span class="ent">➋</span>. Then, you create a label for the humidity title <span class="ent">➌</span> with the settings shown in the table on <a href="ch09.xhtml#page_131">page 131</a>. At <span class="ent">➍</span>, you create a string variable called <span class="literal">humidity</span> that will hold the humidity value. This value is then displayed at <span class="ent">➎</span>.</p>
<p class="indent">The lines of code at <span class="ent">➏</span> create a canvas to place the progress bar in—the canvas is like a reserved space for the progress bar. After that, the code initializes a variable called <span class="literal">humidity_bar</span> of type <span class="literal">double</span> <span class="ent">➐</span>, <span epub:type="pagebreak" id="page_134"/>which is the variable type accepted by the progress bar. Finally, the lines at <span class="ent">➑</span> create the humidity progress bar to place on the canvas.</p>
<p class="indent">The process for displaying titles and values for temperature and pressure follows the same steps as at <span class="ent">➌</span>, <span class="ent">➍</span>, and <span class="ent">➎</span>.</p>
<h4 class="h4" id="lev105"><span class="violet"><strong>Automatically Updating the Readings</strong></span></h4>
<p class="noindent">At <span class="ent">➒</span>, you define the <span class="literal">update_readings()</span> function, which updates the displayed values every three seconds to keep your weather readings up to date.</p>
<p class="indent">The following line updates the <span class="literal">temperature</span> variable:</p>
<div class="box">
<p class="programs">temperature.set(<span class="purple">str</span>(<span class="purple">round</span>(sense.temperature, 2)) + <span class="green">'*C'</span>)</p>
</div>
<p class="indent">Let’s break this line into its component parts:</p>
<ul>
<li class="noindent"><span class="literal">sense.temperature</span> retrieves the temperature reading from the Sense HAT.</li>
<li class="noindent"><span class="literal">round(sense.temperature,2)</span> rounds the temperature readings to two decimal places.</li>
<li class="noindent"><span class="literal">str(round(sense.temperature,2)</span> converts the rounded reading to a string.</li>
<li class="noindent"><span class="literal">(str(round(sense.temperature,2)) + '*C')</span> concatenates the degree symbol to the string.</li>
<li class="noindent"><span class="literal">temperature.set(str(round(sense.temperature, 2)) + '*C')</span> updates the <span class="literal">temperature</span> variable with the latest reading.</li>
</ul>
<p class="indent">The script uses a similar procedure for updating the <span class="literal">pressure</span> and <span class="literal">humidity</span> variables.</p>
<p class="indent">The <span class="literal">window.update_idletasks()</span> function keeps the window up to date while monitoring. Finally, <span class="literal">window.after(3000, update_readings)</span> adds <span class="literal">update_readings</span> as an event to the <span class="literal">mainloop()</span>, and tells the Pi to call this function every 3,000 milliseconds (3 seconds).</p>
<p class="indent">At <span class="ent">➓</span>, you call the <span class="literal">update_readings()</span> function and the <span class="literal">window.mainloop()</span> function that keeps the window running.</p>
<p class="indent">Finally, you can display the temperature in Fahrenheit by commenting and uncommenting these two lines:</p>
<div class="box">
<p class="programs"><span class="red1">#temperature.set(str(round(sense.temperature, 2)) + '*C')</span><br/>temperature.set(<span class="purple">str</span>(<span class="purple">round</span>(sense.temperature*(9/5)+32, 2)) + <span class="green">'*F'</span>)</p>
</div>
<h4 class="h4" id="lev106"><span epub:type="pagebreak" id="page_135"/><span class="violet"><strong>Running the Script</strong></span></h4>
<p class="noindent">Press <strong>F5</strong> or go to <strong>Run</strong> <span class="ent">▸</span> <strong>Run Module</strong> to run the script. You should see your weather data displayed in the user interface as shown at the beginning of the project.</p>
<p class="indent">Congratulations! You’ve made your own weather station. You are officially a budding meteorologist.</p>
<h3 class="h3" id="lev107"><span class="violet"><strong>TAKING IT FURTHER</strong></span></h3>
<p class="noindent">Here are some ideas for customizing this project:</p>
<ul>
<li class="noindent">Add the Fahrenheit conversion to the code and display the temperature as °F.</li>
<li class="noindent">Change the graphical user interface—layout, font color, size, and type—to suit your tastes.</li>
<li class="noindent">Use the LED matrix display on the Sense HAT to display information about the weather. For example, you can display text, relative bar graphs, or green and red arrows indicating temperature, humidity, or pressure rising or falling.</li>
<li class="noindent">In the rest of the projects within this part, you’ll learn how to send an email with Python and how to save sensor readings. Use these skills to send your weather data to your email or build a weather station data logger. Make sure you don’t miss the next projects!</li>
</ul>
</div>
  </body>
</html>
