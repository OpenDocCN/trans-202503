- en: '[7](nsp-enoka501485-0007.xhtml#rch07)'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '[7](nsp-enoka501485-0007.xhtml#rch07)'
- en: Blocking Internet Advertisements
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 阻止互联网广告
- en: '![Chapter opening icon](images/nsp-enoka501485-ct.jpg)'
  id: totrans-2
  prefs: []
  type: TYPE_IMG
  zh: '![章节开头图标](images/nsp-enoka501485-ct.jpg)'
- en: Companies monetize the internet through advertising, which has caused the number
    of online ads to proliferate (or more accurately, explode). These ads have become
    more insidious over time, as websites track your activity to display the promotions
    most likely to lead to purchases. Even worse, advertising has caused slower internet
    connections through websites becoming so bloated with autoplaying advertisements.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 公司通过广告实现互联网盈利，这导致了在线广告的数量激增（更准确地说，是爆炸式增长）。这些广告随着时间的推移变得更加隐蔽，因为网站会跟踪你的活动，以显示最有可能促成购买的广告。更糟糕的是，广告使得互联网连接变慢，因为网站因自动播放广告而变得臃肿。
- en: You can block ads from your network in several ways. This chapter will first
    discuss various browser ad-blocking solutions. Then, we’ll build an ad-blocking
    DNS proxy server using Pi-Hole to provide users with a much better browsing experience
    while also improving data and privacy protection.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过多种方式阻止来自网络的广告。本章将首先讨论各种浏览器广告拦截解决方案。然后，我们将使用Pi-Hole构建一个广告拦截DNS代理服务器，以为用户提供更好的浏览体验，同时提高数据和隐私保护。
- en: '[Browser-Level Ad Blocking](nsp-enoka501485-0007.xhtml#rah0901)'
  id: totrans-5
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[浏览器级广告拦截](nsp-enoka501485-0007.xhtml#rah0901)'
- en: Most modern browsers have some form of ad-blocking technology built-in to the
    application itself. By default, some browsers prevent various trackers and scripts
    from operating as designed. These include social media trackers, cookies, fingerprinters,
    and cryptominers. Blocking *social media trackers* disallows sites such as Facebook,
    Twitter, and LinkedIn from tracking you as you browse websites that implement
    social media buttons or instant sharing links. *Cookies* are files used by sites
    to track information and user preferences between visits; this can leak your private information
    from one site to another. *Fingerprinters* are similar in that they identify a
    specific user by a number of metrics collected from their browsing habits, which
    allows advertisers to track your activity during a browsing session. Finally,
    *cryptominers* are applications (some might say malware) that use your computer
    hardware to mine cryptocurrency, such as Bitcoin. This is a highly resource-intensive
    process that can cause system instability. All of these can negatively impact
    your browsing experience and should be blocked.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数现代浏览器都有某种形式的内置广告拦截技术。默认情况下，一些浏览器会阻止各种跟踪器和脚本按设计运行。这些包括社交媒体跟踪器、Cookies、指纹识别器和加密矿工。阻止*社交媒体跟踪器*意味着像Facebook、Twitter和LinkedIn等网站无法在你浏览包含社交媒体按钮或即时分享链接的网站时进行跟踪。*Cookies*是网站用来跟踪信息和用户偏好的文件，跨站点泄露你的私人信息。*指纹识别器*通过收集浏览习惯的多个指标来识别特定用户，从而让广告商在浏览会话期间跟踪你的活动。最后，*加密矿工*是利用你计算机硬件进行加密货币挖矿的应用程序（有些人可能会说它是恶意软件）。这是一项非常消耗资源的过程，可能导致系统不稳定。所有这些都会对你的浏览体验产生负面影响，因此应当被阻止。
- en: Besides the built-in functionality provided by some web browsers, some of the
    most popular browser ad blockers are browser *extensions*, also known as *add-ons*—software
    that you can add to your browser to improve its functionality or add capabilities.
    For example, *Adblock Plus*—installable in most browsers—works by intercepting
    advertisements before they’re displayed to the user, though the ads are still
    downloaded to your computer.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 除了一些网页浏览器提供的内置功能外，一些最流行的浏览器广告拦截器是浏览器的*扩展程序*，也叫做*附加组件*——这些是你可以添加到浏览器中的软件，用以改善其功能或增加其他功能。例如，*Adblock
    Plus*——可以在大多数浏览器中安装——通过在广告显示给用户之前拦截广告来工作，尽管广告仍然会下载到你的计算机上。
- en: Many websites can identify when browser extensions are in use and will either
    modify their content or completely block users from viewing web pages until the
    extension has been disabled or the site is allowlisted to play ads. Browser extensions
    are discussed further in [Chapter 11](nsp-enoka501485-0020.xhtml#ch11). The following
    projects cover how to set up browser ad blocking for Google Chrome, Mozilla Firefox,
    and Brave browsers.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 许多网站能够识别浏览器扩展程序的使用，并会修改其内容或完全阻止用户查看网页，直到扩展程序被禁用或网站被列入白名单以允许播放广告。浏览器扩展程序在[第11章](nsp-enoka501485-0020.xhtml#ch11)中进行了进一步讨论。以下项目涵盖了如何为Google
    Chrome、Mozilla Firefox和Brave浏览器设置广告拦截功能。
- en: '[#22: Blocking Ads in Google Chrome](nsp-enoka501485-0007.xhtml#rhd0901)'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: '[#22: 在Google Chrome中阻止广告](nsp-enoka501485-0007.xhtml#rhd0901)'
- en: 'Chrome’s ad blocker ([https://www.google.com/chrome/](https://www.google.com/chrome/))
    is designed to hide ads on websites that have too many ads or whose ads detract
    from the user experience, such as by flashing or making noise. Chrome also blocks
    ads on sites that put content behind a *paywall*, which obscures the website entirely
    until the user either allows the ads to display or pays a fee to view the content.
    This behavior applies to the Android version of Chrome in addition to the desktop
    version. It’s possible to activate or deactivate the built-in ad blocker, as well
    as to allowlist specific sites:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: Chrome的广告拦截器（[https://www.google.com/chrome/](https://www.google.com/chrome/)）旨在隐藏网页上广告过多或干扰用户体验的广告，比如闪烁或发出噪音的广告。Chrome还会拦截那些将内容隐藏在*付费墙*后的广告，这种广告会完全遮挡网页，直到用户允许显示广告或支付费用以查看内容。这种行为适用于Chrome的安卓版本以及桌面版本。你可以激活或停用内置的广告拦截器，并允许特定网站：
- en: 1\. At the top right of the Chrome browser, click the **More** icon (three horizontal
    lines).
  id: totrans-11
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Chrome浏览器的右上角，点击**更多**图标（三个水平线）。
- en: 2\. Click **Settings▸Advanced▸Site Settings▸Ads**.
  id: totrans-12
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**设置▸高级▸站点设置▸广告**。
- en: 3\. If the text “Blocked on sites that tend to show intrusive ads (recommended)”
    is displayed, Chrome is currently blocking ads for you.
  id: totrans-13
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果显示“已在通常会显示干扰性广告的网站上屏蔽广告（推荐）”的文字，说明Chrome正在为你屏蔽广告。
- en: 4\. If you’d like to turn ad blocking off, hit the toggle to switch the setting
    to **Allowed**.
  id: totrans-14
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你想关闭广告拦截功能，点击开关将设置更改为**允许**。
- en: 'Another way to protect your privacy online is to use a private browsing window.
    Chrome’s *incognito mode* either won’t save your personal information or immediately
    deletes it (including tracking information such as cookies) when you close the
    browser. Your browsing history and internet searches won’t be saved. To open an
    incognito window, follow these steps:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 保护你在线隐私的另一种方式是使用私人浏览窗口。Chrome的*隐身模式*不会保存你的个人信息，或在你关闭浏览器时立即删除这些信息（包括跟踪信息如Cookie）。你的浏览历史和互联网搜索记录将不会被保存。要打开隐身窗口，请按照以下步骤操作：
- en: 5\. At the top right of the Chrome browser, click the **More** icon (three horizontal
    lines).
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Chrome浏览器的右上角，点击**更多**图标（三个水平线）。
- en: 6\. Click **New Private Window**.
  id: totrans-17
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**新建私密窗口**。
- en: A new browser window will open that has a different appearance when compared
    to a normal Chrome window—text such as “You’ve gone Incognito” is typically displayed.
    This is how you know you’re browsing privately.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 会打开一个新的浏览器窗口，其外观与正常的Chrome窗口不同——通常会显示类似“您已进入隐身模式”的文字。这就是你知道正在以私密方式浏览的标志。
- en: '[#23: Blocking Ads in Mozilla Firefox](nsp-enoka501485-0007.xhtml#rhd0902)'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: '[#23: 在Mozilla Firefox中阻止广告](nsp-enoka501485-0007.xhtml#rhd0902)'
- en: 'Firefox’s *Private* browsing ([https://www.mozilla.org/](https://www.mozilla.org/))
    windows block not only ads but also tracking content, including videos and other
    media displayed on a web page. To open a new Private window, follow these steps:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: Firefox的*私人*浏览（[https://www.mozilla.org/](https://www.mozilla.org/)）窗口不仅拦截广告，还会阻止跟踪内容，包括网页上显示的视频和其他媒体。要打开一个新的私人窗口，请按照以下步骤操作：
- en: 1\. At the top right of the Firefox browser, click the **More** icon (three
    horizontal lines).
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Firefox浏览器的右上角，点击**更多**图标（三个水平线）。
- en: 2\. Click **New Private Window**.
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**新建私密窗口**。
- en: 'You can change Firefox’s default behavior to disable tracking content in all
    Firefox windows, rather than just Private windows. To modify these settings, follow
    these steps:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以更改Firefox的默认行为，以禁用所有Firefox窗口中的跟踪内容，而不仅仅是私密窗口。要修改这些设置，请按照以下步骤操作：
- en: 1\. Click **More** in the top right of the Firefox window.
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击Firefox窗口右上角的**更多**。
- en: 2\. Click **Preferences▸Privacy & Security**.
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**首选项▸隐私与安全**。
- en: 3\. Set your Enhanced Tracking Protection settings to Standard (the default),
    Strict (provides greater privacy but may break some websites), or Custom.
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置增强跟踪保护的设置为标准（默认）、严格（提供更高隐私保护，但可能导致某些网站无法正常显示）或自定义。
- en: 4\. Configure your Cookie settings to delete cookies on browser exit by ticking
    the **Delete Cookies and Site Data When Firefox is Closed** checkbox.
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置你的Cookie设置，在浏览器退出时删除Cookie，通过勾选**关闭Firefox时删除Cookies和站点数据**复选框。
- en: 5\. Make Firefox forget your browsing history by setting the History drop-down
    menu to **Never Remember History**.
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过将历史记录下拉菜单设置为**从不记住历史**，使Firefox忘记你的浏览历史。
- en: 6\. Set permissions for things like your webcam and microphone so that Firefox
    isn’t able to watch or listen without authorization.
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置诸如摄像头和麦克风的权限，以便Firefox无法在未授权的情况下进行监视或监听。
- en: You can find more information on disabling trackers and other security and privacy
    settings in the Mozilla knowledge base at [https://support.mozilla.org/en-US/kb/enhanced-tracking-protection-firefox-desktop/](https://support.mozilla.org/en-US/kb/enhanced-tracking-protection-firefox-desktop/).
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在 Mozilla 知识库中找到更多关于禁用追踪器和其他安全与隐私设置的信息，链接：[https://support.mozilla.org/en-US/kb/enhanced-tracking-protection-firefox-desktop/](https://support.mozilla.org/en-US/kb/enhanced-tracking-protection-firefox-desktop/)。
- en: '[#24: Controlling Brave’s Privacy Settings](nsp-enoka501485-0007.xhtml#rhd0903)'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: '[#24: 控制 Brave 的隐私设置](nsp-enoka501485-0007.xhtml#rhd0903)'
- en: Brave ([https://brave.com/](https://brave.com/)) is a relatively new web browser
    based on Google’s Chromium (so it shares a lot of the same features as Chrome);
    all the extensions that are compatible with Chrome are also compatible with Brave.
    The great thing about Brave, when compared to other browsers, is that its goal
    is to provide a private, tracker- and ad-free experience for users. By having
    an aggressive approach to blocking ads in the browser, Brave claims not only to
    save you time and bandwidth while using the internet but also to reduce the amount
    of battery your browser uses.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: Brave ([https://brave.com/](https://brave.com/)) 是一款基于谷歌 Chromium 的相对较新的网页浏览器（因此它与
    Chrome 具有很多相同的功能）；所有与 Chrome 兼容的扩展也都与 Brave 兼容。与其他浏览器相比，Brave 的优点在于它的目标是为用户提供一个私密、无追踪器和广告的浏览体验。通过在浏览器中积极屏蔽广告，Brave
    声称不仅能为用户节省上网时间和带宽，还能减少浏览器消耗的电池电量。
- en: 'Brave provides much more granular control over your security and privacy settings,
    and it makes these settings much easier to get to than other browsers:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: Brave 提供了比其他浏览器更细粒度的安全性和隐私设置控制，并且使这些设置比其他浏览器更易访问：
- en: 1\. At the top right of the Brave browser, click the **More** icon (three horizontal
    lines).
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1\. 在 Brave 浏览器的右上角，点击**更多**图标（三条横线）。
- en: 2\. Click **Settings▸Shields**.
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2\. 点击**设置▸护盾**。
- en: 3\. Set Trackers & Ads Blocking to Standard or Aggressive.
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 3\. 将追踪器和广告屏蔽设置为标准或积极模式。
- en: 4\. Turn on **Upgrade Connections to HTTPS**.
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开**升级连接为 HTTPS**。
- en: 5\. Set Cookie Blocking to Only Cross-site or All (your browser won’t remember
    your session information once closed).
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 5\. 将 Cookie 屏蔽设置为仅跨站或全部（浏览器关闭后不会记住你的会话信息）。
- en: 6\. Set Fingerprinting blocking to Standard or Strict (might break some websites).
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 6\. 将指纹识别屏蔽设置为标准或严格（可能会导致一些网站无法正常显示）。
- en: Experiment with these settings, as well as the social media blocking settings,
    until you find a combination that works for you.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 尝试调整这些设置以及社交媒体屏蔽设置，直到找到适合自己的组合。
- en: '[#25: Blocking Ads with Pi-Hole](nsp-enoka501485-0007.xhtml#rhd0904)'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: '[#25: 使用 Pi-Hole 屏蔽广告](nsp-enoka501485-0007.xhtml#rhd0904)'
- en: Blocking ads with a browser extension or built-in tools is a great start to
    enhancing your internet browsing experience. However, those options apply to only
    one device at a time, and managing settings for multiple devices can quickly become
    onerous. Not only that, but some websites can block browser extensions. Blocking
    ads at the DNS level mitigates all of these issues.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 使用浏览器扩展或内置工具来屏蔽广告是提升互联网浏览体验的一个良好开始。然而，这些选项每次仅适用于一个设备，且管理多个设备的设置可能会很快变得繁琐。不仅如此，一些网站可能会屏蔽浏览器扩展。从
    DNS 层面屏蔽广告可以解决所有这些问题。
- en: The *Domain Name System (DNS)* enables your computer (or browser) to communicate
    with websites on the internet. All websites have an IP address (or more than one)
    assigned to them. Compared to IP addresses, the URLs that you use to access websites
    (for example, [www.facebook.com](http://www.facebook.com)) are human-readable
    and easy to remember. Your computer translates that URL into an IP address to
    find the web server on the internet that serves Facebook to you—enter DNS. DNS
    acts like the postal service, in that IP addresses are equivalent to physical
    addresses, and URLs are like street names. DNS allows you to send and receive
    internet traffic to a specific address (or server) without having to remember
    the exact address (the IP address) of that server.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: '*域名系统（DNS）*使你的计算机（或浏览器）能够与互联网上的网站进行通信。所有网站都有一个分配给它们的 IP 地址（或多个 IP 地址）。与 IP
    地址相比，你用来访问网站的 URL（例如，[www.facebook.com](http://www.facebook.com)）是人类可读的，并且易于记忆。你的计算机会将该
    URL 转换为 IP 地址，以便找到互联网上为你提供 Facebook 服务的 web 服务器——这就是 DNS 的作用。DNS 像邮政服务一样工作，IP
    地址相当于物理地址，而 URL 则像街道名称。DNS 允许你向特定地址（或服务器）发送和接收互联网流量，而无需记住该服务器的确切地址（IP 地址）。'
- en: Given that advertising domains also use DNS to serve you ads, let’s build a
    *Pi-Hole* server to send all of those requests to a blackhole and provide your
    users with a better browsing experience. Pi-Hole is similar to the Squid proxy
    discussed in [Chapter 6](nsp-enoka501485-0015.xhtml#ch06); it sits between you
    and the websites you want to browse, observing all internet traffic, identifying
    advertising at the DNS level via a curated list of known advertising domains and
    addresses, and allowing only legitimate, non-ad traffic to pass through to your
    browser. Pi-Hole is capable of blocking a larger percentage of ads than browser
    solutions, and it’s much harder for websites to detect and circumvent.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑到广告域名也使用 DNS 向你发送广告，我们来构建一个 *Pi-Hole* 服务器，将所有这些请求发送到黑洞，从而为你的用户提供更好的浏览体验。Pi-Hole
    类似于[第 6 章](nsp-enoka501485-0015.xhtml#ch06)中讨论的 Squid 代理；它位于你和你想要浏览的网站之间，观察所有互联网流量，通过一份精心策划的已知广告域名和地址列表，在
    DNS 层面识别广告，并允许只有合法、非广告的流量通过到浏览器。与浏览器解决方案相比，Pi-Hole 能屏蔽更大比例的广告，而且网站更难检测和绕过。
- en: Set up an Ubuntu server in your local network, as discussed in [Chapter 1](nsp-enoka501485-0010.xhtml#ch01),
    and add it to your network map and asset list. It’s possible to use a server located
    in the cloud, but exposing a DNS server to the open internet creates some technical
    challenges we won’t cover in this chapter. The right mitigating controls can solve
    these challenges, so if you choose to use a cloud server, proceed cautiously and
    do some research into how to mitigate the risks. If you’ve installed a perimeter
    firewall as discussed in [Chapter 3](nsp-enoka501485-0012.xhtml#ch03) and you
    create your Pi-Hole server using a virtual machine, the server should be located
    behind the firewall (that is, on the network side of the firewall, rather than
    the internet side).
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的本地网络中设置一个 Ubuntu 服务器，如[第 1 章](nsp-enoka501485-0010.xhtml#ch01)中所述，并将其添加到网络地图和资产列表中。虽然可以使用位于云端的服务器，但将
    DNS 服务器暴露到开放互联网会带来一些技术挑战，这些挑战我们不会在本章中讨论。适当的控制措施可以解决这些挑战，因此如果你选择使用云服务器，务必谨慎操作并进行相关风险缓解的研究。如果你已经安装了[第
    3 章](nsp-enoka501485-0012.xhtml#ch03)中讨论的周边防火墙，并且你通过虚拟机创建了 Pi-Hole 服务器，那么该服务器应该位于防火墙之后（即在防火墙的网络端，而不是互联网端）。
- en: It’s possible to use Pi-Hole in conjunction with Squid (discussed in [Chapter
    6](nsp-enoka501485-0015.xhtml#ch06)) by using Pi-Hole to handle DNS requests and
    Squid to handle HTTP traffic. However, by default Squid uses an internal DNS client—this
    can’t be changed without rebuilding Squid, which is outside the scope of this
    book. If you choose to use both Squid and Pi-Hole, you can follow the instructions
    supplied for configuring each solution separately on your endpoints and achieve
    the same outcome.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 可以将 Pi-Hole 与 Squid 一起使用（在[第 6 章](nsp-enoka501485-0015.xhtml#ch06)中讨论），通过 Pi-Hole
    处理 DNS 请求，通过 Squid 处理 HTTP 流量。然而，默认情况下，Squid 使用内部 DNS 客户端——这不能更改，除非重新构建 Squid，而这超出了本书的讨论范围。如果你选择同时使用
    Squid 和 Pi-Hole，可以根据每个解决方案的配置说明分别在终端上进行配置，以达到相同的效果。
- en: '[Configure Pi-Hole](nsp-enoka501485-0007.xhtml#rbh0901)'
  id: totrans-47
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[配置 Pi-Hole](nsp-enoka501485-0007.xhtml#rbh0901)'
- en: 'Begin by creating a base Ubuntu server, as described in [Chapter 1](nsp-enoka501485-0010.xhtml#ch01).
    Then, install the Pi-Hole server using the following steps:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 首先创建一个基础的 Ubuntu 服务器，如[第 1 章](nsp-enoka501485-0010.xhtml#ch01)中所述。然后，使用以下步骤安装
    Pi-Hole 服务器：
- en: '1\. Log in to your Ubuntu server via SSH as a standard, non-root user. Then,
    download the Pi-Hole installation script from [https://install.pi-hole.net/](https://install.pi-hole.net/),
    make it executable, and execute the script using `sudo`:'
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1\. 通过 SSH 以标准的非 root 用户身份登录到你的 Ubuntu 服务器。接着，从 [https://install.pi-hole.net/](https://install.pi-hole.net/)
    下载 Pi-Hole 安装脚本，使其可执行，并使用 `sudo` 执行脚本：
- en: '[PRE0]'
  id: totrans-50
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 2\. At this point, the automated installer will take over your terminal window.
    Read the various informational screens that come up, pressing enter to move to
    the next one.
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2\. 此时，自动化安装程序将接管你的终端窗口。阅读出现的各种信息屏幕，按回车键进入下一屏幕。
- en: 3\. When prompted to select an upstream DNS server, as shown in [Figure 7-1](nsp-enoka501485-0016.xhtml#fig0701),
    choose whichever upstream (authoritative) DNS provider you’re comfortable with.
    Google or Quad9 is a good choice.
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 3\. 当提示选择上游 DNS 服务器时，如[图 7-1](nsp-enoka501485-0016.xhtml#fig0701)所示，选择你觉得合适的上游（权威）DNS
    提供商。Google 或 Quad9 都是不错的选择。
- en: Note Use the arrow keys or TAB to navigate through the options, spacebar to
    select options, and ENTER to accept settings.
  id: totrans-53
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 注意：使用箭头键或 TAB 键在选项之间导航，空格键选择选项，回车键接受设置。
- en: '![The prompt to select an upstream DNS Provider contains a list of options,
    including Google (ECS), OpenDNS (ECS, DNSSEC), Level3, Comodo, DNS.WATCH, Quad9
    (filtered, DNSSEC), and Quad9 (unfiltered, no DNSSEC). You can use your own by
    selecting “Custom.” Once you’ve selected a DNS Provider, click OK on the bottom
    left-hand side of the window, or click Cancel to revert changes.](images/nsp-enoka501485-fig0701.jpg)'
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![选择上游DNS提供商的提示包含多个选项，包括Google（ECS）、OpenDNS（ECS、DNSSEC）、Level3、Comodo、DNS.WATCH、Quad9（过滤，DNSSEC）和Quad9（未过滤，无DNSSEC）。你也可以选择“自定义”来使用自己的DNS提供商。选择DNS提供商后，点击窗口左下方的OK按钮，或点击取消以恢复更改。](images/nsp-enoka501485-fig0701.jpg)'
- en: 'Figure 7-1: Upstream DNS provider'
  id: totrans-55
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图7-1：上游DNS提供商
- en: To perform DNS lookups, your Pi-Hole server will need an authoritative DNS server
    to query when it attempts to resolve domains that aren’t already cached by the
    proxy server. An *authoritative* DNS server is a nameserver that holds the actual
    DNS records for a particular domain or address, such as [www.google.com](http://www.google.com).
    By contrast, your server is *recursive*, an intermediary between you and your
    host and one or more authoritative DNS servers. When you make a request for a
    website, your device will pass this request to the Pi-Hole server, which will
    then farm this request out to an authoritative server to find the address of the
    website you want to view.
  id: totrans-56
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 为了执行DNS查询，当Pi-Hole服务器尝试解析未缓存的域名时，它需要一个权威DNS服务器来查询。*权威*DNS服务器是持有特定域名或地址实际DNS记录的名称服务器，例如[www.google.com](http://www.google.com)。相比之下，你的服务器是*递归*的，是你和一个或多个权威DNS服务器之间的中介。当你请求一个网站时，你的设备会将请求传递给Pi-Hole服务器，后者会将此请求转发给权威服务器，以查找你想访问的网站的地址。
- en: 4\. Select all the available blocklists when prompted.
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 4\. 在提示时，选择所有可用的屏蔽列表。
- en: Pi-Hole uses *blocklists* (curated lists of advertising domains maintained by
    third parties) to identify and intercept advertisements on the internet. The chosen
    lists can be changed later.
  id: totrans-58
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Pi-Hole使用*屏蔽列表*（由第三方维护的广告域名列表）来识别并拦截互联网上的广告。所选择的列表可以稍后更改。
- en: 5\. Select IPv6 in addition to IPv4 at the protocol screen if you use IPv6 in
    your network.
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 5\. 如果你的网络中使用IPv6，在协议屏幕上选择IPv6和IPv4。
- en: In most cases, IPv6 isn’t necessary. IPv6 provides internet-addressable IP space
    to endpoints, which you don’t need to do in this situation. It’s best to disable
    IPv6 to reduce your attack surface, unless you have a legitimate use for it.
  id: totrans-60
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在大多数情况下，IPv6并不必要。IPv6为终端提供互联网可寻址的IP空间，但在这种情况下你并不需要这样做。除非你有合法需求，否则最好禁用IPv6，以减少攻击面。
- en: 6\. The following screen indicates the static IP address and gateway of your
    server. If the address details listed on this page are correct, press ENTER to
    accept them. Otherwise, select **No** and press ENTER; then set your desired static
    IP details manually.
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 6\. 以下屏幕显示了你的服务器的静态IP地址和网关。如果此页面上列出的地址信息正确，按ENTER键以接受。如果不正确，选择**否**并按ENTER键；然后手动设置所需的静态IP地址。
- en: The gateway for your Pi-Hole could be your firewall or router. Once you’ve configured
    or accepted the IP settings for your server, the automated installer will warn
    about configuring your router or DHCP server to reserve the IP address for this
    server. If you don’t do this, your network may encounter address conflicts, but
    most routers will be able to avoid this conflict without your input. (See “[Static
    IP Addressing](nsp-enoka501485-0013.xhtml#ah0602)” in [Chapter 4](nsp-enoka501485-0013.xhtml#ch04)
    for configuring static IP addresses on a router.) Press enter to acknowledge the
    warning.
  id: totrans-62
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你的Pi-Hole网关可以是你的防火墙或路由器。一旦你配置或接受了服务器的IP设置，自动化安装程序将提醒你配置你的路由器或DHCP服务器，以为此服务器保留IP地址。如果你不这么做，网络可能会遇到地址冲突，但大多数路由器可以在不需要你干预的情况下避免这个冲突。（有关在路由器上配置静态IP地址，请参见[第4章](nsp-enoka501485-0013.xhtml#ch04)中的“[静态IP地址配置](nsp-enoka501485-0013.xhtml#ah0602)”）。按回车键以确认警告。
- en: 7\. Select **On** to install the web interface, which makes the server configuration
    easier to manage (even for advanced administrators), and then press ENTER.
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 7\. 选择**开启**以安装Web界面，这使得服务器配置更容易管理（即使对于高级管理员也是如此），然后按下ENTER键。
- en: 8\. Select **On** to install the web server offered by the automated installer,
    unless you plan to install your own (this is beyond the scope of this book).
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 8\. 选择**开启**以安装由自动化安装程序提供的网络服务器，除非你计划安装自己的服务器（这超出了本书的范围）。
- en: 9\. Select **On** to log the DNS queries that pass through your Pi-Hole server.
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 9\. 选择**开启**以记录通过你的Pi-Hole服务器的DNS查询。
- en: Since Pi-Hole is a proxy, it will record and cache all web requests that pass
    through it. This means that any endpoint configured to use your Pi-Hole server
    for DNS will have its browsing history recorded. If this poses concerns for your
    users, either get their permission or turn logging off. You don’t need logging
    to use Pi-Hole’s ad-blocking features, but enabling it can help troubleshoot any
    issues.
  id: totrans-66
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 由于 Pi-Hole 是一个代理，它会记录并缓存所有通过它的 Web 请求。这意味着任何配置为使用您 Pi-Hole 服务器进行 DNS 的端点都会被记录其浏览历史。如果这对您的用户构成隐私问题，可以获取他们的许可，或者关闭日志记录。您不需要日志记录就可以使用
    Pi-Hole 的广告拦截功能，但启用它可以帮助排查任何问题。
- en: 10\. Select a privacy level that is acceptable within your network.
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 10\. 选择一个在您的网络中可以接受的隐私级别。
- en: Pi-Hole uses *Faster Than Light (FTL)* DNS, which provides statistics about Pi-Hole
    activity and displays it graphically. You’ll be able to see information such as
    how many ads were blocked, and for which endpoints, over a given period. FTL gets
    this data by parsing the Pi-Hole text logs. Like logging, this isn’t necessary
    for Pi-Hole to function and can cause privacy concerns for your users. Be sure
    to get their permission ahead of time, or set the privacy levels to Hide Domains
    and Clients, as shown in [Figure 7-2](nsp-enoka501485-0016.xhtml#fig0702). Doing
    so will prompt FTL to collect anonymized data, allowing the statistics and graphical
    displays to function while preserving the privacy of your users. You could also
    decide to disable statistics entirely by turning logging off in the previous step.
  id: totrans-68
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Pi-Hole 使用 *比光速更快（FTL）* DNS，它提供有关 Pi-Hole 活动的统计数据，并以图形方式显示。您将能够看到诸如在给定时间内屏蔽了多少广告、以及屏蔽了哪些端点等信息。FTL
    通过解析 Pi-Hole 文本日志来获取这些数据。与日志记录一样，这对 Pi-Hole 的正常运行并不是必需的，但可能会引发用户隐私方面的担忧。务必事先获得他们的许可，或者将隐私级别设置为隐藏域名和客户端，如[图7-2](nsp-enoka501485-0016.xhtml#fig0702)所示。这样做将促使
    FTL 收集匿名数据，在确保用户隐私的同时，使统计数据和图形显示功能得以正常运行。您也可以选择完全禁用统计数据，方法是在前一步关闭日志记录。
- en: '![Screenshot of the FTL DNS settings window that states “Select a privacy mode
    for FTL” and includes a link to learn more about privacy levels (https://docs.pi-hole.net/ftldns/privacylevels/)
    as well as the following options: Show everything, Hide domains, Hide domains
    and clients, and Anonymous mode.](images/nsp-enoka501485-fig0702.jpg)'
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![FTL DNS 设置窗口的截图，显示“为 FTL 选择隐私模式”，并包含一个链接，了解更多关于隐私级别的信息（https://docs.pi-hole.net/ftldns/privacylevels/），以及以下选项：显示所有内容、隐藏域名、隐藏域名和客户端、匿名模式。](images/nsp-enoka501485-fig0702.jpg)'
- en: 'Figure 7-2: FTL DNS settings'
  id: totrans-70
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图7-2：FTL DNS 设置
- en: 11\. When the installation finishes, you’ll be presented with a screen showing
    your configuration, as well as the URL and administrator password for the web
    interface, as shown in [Figure 7-3](nsp-enoka501485-0016.xhtml#fig0703). Be sure
    to record these values, ideally in a password vault (discussed in [Chapter 11](nsp-enoka501485-0020.xhtml#ch11))
    for security and safety purposes; then press ENTER to return to the terminal.
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 11\. 当安装完成时，您将看到一个显示配置的屏幕，并显示 Web 界面的 URL 和管理员密码，如[图7-3](nsp-enoka501485-0016.xhtml#fig0703)所示。务必记录这些值，最好将其存储在密码库中（在[第11章](nsp-enoka501485-0020.xhtml#ch11)中讨论过），以确保安全；然后按
    ENTER 返回终端。
- en: '![Screenshot of the Installation Complete window that contains the following
    information: “Configure your devices to use the Pi-hole as their DNS server using:
    IPv4: 172.16.90.11 IPv6: Not Configured; If you set a new IP address, you should
    restart the Pi. The install log is in /etc/pihole. View the web interface at http://pi.hole/admin
    or http://172.16.90.11/admin; Your Admin Webpage login password is rOhpBpI3.”](images/nsp-enoka501485-fig0703.jpg)'
  id: totrans-72
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![安装完成窗口的截图，其中包含以下信息：“使用以下信息将设备配置为使用 Pi-Hole 作为 DNS 服务器：IPv4：172.16.90.11，IPv6：未配置；如果设置了新的
    IP 地址，您应重新启动 Pi。安装日志位于 /etc/pihole。查看 Web 界面：http://pi.hole/admin 或 http://172.16.90.11/admin；您的管理员
    Web 页面登录密码是 rOhpBpI3。”](images/nsp-enoka501485-fig0703.jpg)'
- en: 'Figure 7-3: Pi-Hole installation complete'
  id: totrans-73
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图7-3：Pi-Hole 安装完成
- en: 'You can change the administrator password with the following command:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用以下命令更改管理员密码：
- en: '[PRE1]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'To keep Pi-Hole up-to-date, periodically run the following command:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 为了保持 Pi-Hole 的更新，定期运行以下命令：
- en: '[PRE2]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Ensuring that Pi-Hole and its components are up-to-date is crucial in keeping
    your Pi-Hole server, and your network, secure.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 确保 Pi-Hole 及其组件是最新的，这对于保持 Pi-Hole 服务器和您的网络安全至关重要。
- en: '[Using Pi-Hole](nsp-enoka501485-0007.xhtml#rbh0902)'
  id: totrans-79
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[使用 Pi-Hole](nsp-enoka501485-0007.xhtml#rbh0902)'
- en: Browse to the administrator URL displayed in the last configuration step (*http://<your_server_ip>/admin/*)
    where you should see the user dashboard. When a new update is available, you’ll
    be notified at the bottom of this screen, as in [Figure 7-4](nsp-enoka501485-0016.xhtml#fig0704).
    At this time, it’s not possible to update Pi-Hole from the web interface; it must
    be updated using the commands in the previous section.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 浏览到最后配置步骤中显示的管理员 URL (*http://<your_server_ip>/admin/*)，你应该能够看到用户仪表板。当有新更新时，你将在屏幕底部收到通知，如[图
    7-4](nsp-enoka501485-0016.xhtml#fig0704)所示。目前，无法通过 Web 界面更新 Pi-Hole；必须使用前一节中的命令进行更新。
- en: '![At the bottom of the screen, under a link to Donate, is the following list:
    Pi-hole, Web Interface, FTL. Next to each of these items is the version number
    and text that says “Update available!” if an update is available.](images/nsp-enoka501485-fig0704.jpg)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
  zh: '![在屏幕底部，捐赠链接下方是以下列表：Pi-Hole、Web 界面、FTL。每个项目旁边都有版本号，如果有更新可用，旁边会显示“更新可用！”的文字。](images/nsp-enoka501485-fig0704.jpg)'
- en: 'Figure 7-4: Pi-Hole update required'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7-4：需要更新 Pi-Hole
- en: Click **Login** on the left side of the screen and authenticate with your administrator
    username and password. The dashboard will then display more detailed information.
    You’ll find additional options in the administrator menu once logged in, as shown
    in [Figure 7-5](nsp-enoka501485-0016.xhtml#fig0705).
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 点击屏幕左侧的**登录**，并使用管理员用户名和密码进行身份验证。验证后，仪表板将显示更详细的信息。登录后，你将在管理员菜单中找到更多选项，如[图 7-5](nsp-enoka501485-0016.xhtml#fig0705)所示。
- en: '![Pi-Hole’s admin dashboard contains a Main Navigation list on the left side.
    The Dashboard shows the number of Total queries, Queries Blocked, Percent Blocked,
    and Domains on Blocklist at the top. Underneath this, bar graphs show the Total
    queries over the last 24 hours and Client activity over the last 24 hours.](images/nsp-enoka501485-fig0705.jpg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![Pi-Hole 的管理员仪表板左侧包含主导航列表。仪表板显示顶部的总查询数、被阻止的查询数、阻止百分比和黑名单上的域名数量。下面是过去 24 小时内的总查询数和客户端活动的条形图。](images/nsp-enoka501485-fig0705.jpg)'
- en: 'Figure 7-5: Pi-Hole administrator dashboard'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7-5：Pi-Hole 管理员仪表板
- en: 'Brief descriptions of the important options in the navigation dashboard are
    as follows:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 导航仪表板中重要选项的简要描述如下：
- en: Query Log A chronological, searchable history of all browser requests for websites
    that pass through the Pi-Hole proxy server.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 查询日志 浏览器所有请求的按时间顺序排列且可搜索的历史记录，这些请求经过 Pi-Hole 代理服务器。
- en: Long-term Data A more extensive history of requests to the proxy server that
    you can filter based on ranges of dates.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 长期数据 代理服务器请求的更详细历史记录，你可以根据日期范围进行筛选。
- en: Whitelist Websites that Pi-Hole blocks by default but to which you’d like to
    allow access.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 白名单 Pi-Hole 默认阻止的域名，但你希望允许访问的域名。
- en: Blacklist Domains that the proxy may not block by default but that you’d like
    to block explicitly.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 黑名单 代理服务器可能默认不会阻止的域名，但你希望显式阻止的域名。
- en: Note While we’ve been using allowlist/denylist, Pi-Hole uses whitelist/blacklist
    for its menu options and configuration. When discussing Pi-Hole, we’ll adhere
    to this terminology.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 注意 尽管我们使用了允许列表/拒绝列表，Pi-Hole 在其菜单选项和配置中使用了白名单/黑名单术语。在讨论 Pi-Hole 时，我们将遵循这一术语。
- en: Disable Disable the proxy for a set period.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 禁用 禁用代理服务器一段时间。
- en: Tools Used to debug or update the blocklists, and review backend proxy logs.
    The backend logs provide debug information about Pi-Hole itself, rather than web
    traffic.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 工具 用于调试或更新黑名单，并查看后台代理日志。后台日志提供有关 Pi-Hole 本身的调试信息，而非 Web 流量。
- en: Tools▸Network Displays all clients connected to the Pi-Hole server to help identify
    which endpoints are using the proxy and which may be bypassing it (your network
    map and asset list will come in handy).
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 工具▸网络 显示所有连接到 Pi-Hole 服务器的客户端，帮助你识别哪些端点正在使用代理，哪些端点可能绕过了代理（你的网络地图和资产清单会派上用场）。
- en: Settings▸System Contains the Pi-Hole proxy settings (including settings configured
    during installation); displays critical information; allows you to disable, restart,
    and power off the server; and lets you flush (delete) DNS proxy logs.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 设置▸系统 包含 Pi-Hole 代理设置（包括安装过程中配置的设置）；显示关键信息；允许你禁用、重启和关闭服务器；并允许你清除（删除）DNS 代理日志。
- en: Settings▸DNS Change the authoritative DNS servers used for domain name translation
    and modify the network interface on which requests are received and passed through
    the proxy filter (though the default settings are usually the safest).
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 设置▸DNS更改用于域名翻译的权威DNS服务器，并修改接收请求并通过代理过滤器传递的网络接口（虽然默认设置通常是最安全的）。
- en: Settings▸DHCP Allows the Pi-Hole server to act as a DHCP server if desired.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 设置▸DHCP允许Pi-Hole服务器作为DHCP服务器运行（如果需要）。
- en: Settings▸Privacy Increase or decrease the level of privacy used when reporting
    about queries by choosing to link endpoints with their browsing activity or anonymize
    the data captured by the proxy.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 设置▸隐私通过选择将终端与浏览活动关联或匿名化代理捕获的数据，来增加或减少查询报告时的隐私级别。
- en: Settings▸Teleporter Imports or exports Pi-Hole settings to or from another server.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 设置▸传送器将Pi-Hole的设置导入或导出到其他服务器。
- en: Logout Logs you out of the administration dashboard.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 注销会将你从管理仪表板登出。
- en: Explore the various menus and options to familiarize yourself with Pi-Hole’s
    settings and configurations. Consider reading the manual as well to get a better
    understanding of how Pi-Hole works and how powerful it really is.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 探索各种菜单和选项，熟悉Pi-Hole的设置和配置。考虑阅读手册，以更好地了解Pi-Hole的工作原理及其强大功能。
- en: '[Configure DNS on Your Endpoints](nsp-enoka501485-0007.xhtml#rbh0903)'
  id: totrans-102
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[配置终端上的DNS](nsp-enoka501485-0007.xhtml#rbh0903)'
- en: 'At this point, there’s only one thing left to do: make your clients use the
    Pi-Hole server as their DNS server. You need to configure your DHCP server or
    router to push the DNS settings to devices that access the internet. Alternatively,
    you can configure each endpoint individually using its internal network settings.
    You might want to do this if you’d like only specific devices on the network to
    connect through the proxy while letting others connect to the internet directly.
    That said, making all devices go through the Pi-Hole server will provide the best
    experience to users and allow you to have better control of network traffic and
    identify issues earlier. The server will also cache more websites as users browse
    to them, which will make browsing to frequently visited sites faster for everyone.'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 此时，只剩下一件事要做：让你的客户端使用Pi-Hole服务器作为其DNS服务器。你需要配置你的DHCP服务器或路由器，将DNS设置推送到访问互联网的设备。或者，你可以通过设备的内部网络设置单独配置每个终端。如果你希望只有特定设备通过代理连接，而让其他设备直接连接互联网，可能需要这样做。也就是说，让所有设备都通过Pi-Hole服务器连接，能为用户提供最佳体验，并使你更好地控制网络流量，及早发现问题。服务器还将缓存更多网站，用户浏览时会更快地访问常用网站。
- en: Note Your router is capable of specifying the DNS server your endpoints use
    to access the internet. In the ASUS router we’ve been using as an example, it’s
    under Advanced Settings▸LAN▸DNS Server. Enter your Pi-Hole server’s IP address
    in the DNS Server1 box and click **Apply** to set the DNS server connected clients
    will use.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 注意 你的路由器能够指定终端访问互联网时使用的DNS服务器。在我们使用的ASUS路由器示例中，设置路径为高级设置▸LAN▸DNS服务器。输入Pi-Hole服务器的IP地址到DNS服务器1框中，然后点击**应用**，以设置连接设备将使用的DNS服务器。
- en: If you want only some of your endpoints to use the Pi-Hole server, either you
    can configure those clients using their local DNS settings or you can use the
    DNS settings in your pfSense firewall (if you implemented pfSense, as discussed
    in [Chapter 3](nsp-enoka501485-0012.xhtml#ch03)).
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你只希望某些终端使用Pi-Hole服务器，你可以通过配置这些客户端的本地DNS设置，或使用pfSense防火墙中的DNS设置（如果你实施了pfSense，如[第3章](nsp-enoka501485-0012.xhtml#ch03)所述）。
- en: Windows DNS Settings
  id: totrans-106
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: Windows DNS设置
- en: 'To configure the DNS settings on a Windows client, follow these steps:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 要在Windows客户端上配置DNS设置，请按照以下步骤操作：
- en: 1\. Open **Settings▸Network & Internet4Change Adapter Options**.
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1\. 打开**设置▸网络和互联网4更改适配器选项**。
- en: 2\. Right-click **Ethernet Adapter**.
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2\. 右键点击**以太网适配器**。
- en: 3\. Click **Properties**.
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 3\. 点击**属性**。
- en: 4\. Click **Internet Protocol Version 4 (TCP/IPv4)▸Properties**.
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 4\. 点击**互联网协议版本4 (TCP/IPv4)▸属性**。
- en: 5\. Select the **Use the Following DNS Server Addresses** radio button.
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 5\. 选择**使用以下DNS服务器地址**单选按钮。
- en: 6\. Enter the IP address of your Pi-Hole server in the Preferred DNS Server
    box.
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 6\. 在首选DNS服务器框中输入你的Pi-Hole服务器的IP地址。
- en: 7\. Click **OK** and close all remaining windows.
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 7\. 点击**确定**并关闭所有剩余的窗口。
- en: macOS DNS Settings
  id: totrans-115
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: macOS DNS设置
- en: 'To configure your Mac to use your Pi-Hole server for DNS, follow these steps:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 要配置你的Mac使用Pi-Hole服务器进行DNS设置，请按照以下步骤操作：
- en: 1\. Open **System Preferences▸Network**.
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1\. 打开**系统偏好设置▸网络**。
- en: 2\. Select your network adapter (**Ethernet** or **Wi-Fi**) in the connection
    list on the left.
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2\. 在左侧的连接列表中选择你的网络适配器（**以太网**或**Wi-Fi**）。
- en: 3\. Click **Advanced▸DNS**.
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 3\. 点击**高级▸DNS**。
- en: 4\. Add your Pi-Hole server’s IP address to the DNS servers list on the left.
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 4\. 将你的Pi-Hole服务器的IP地址添加到左侧的DNS服务器列表中。
- en: 5\. Click **OK▸Apply**.
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 5\. 点击**确定▸应用**。
- en: Linux DNS Settings
  id: totrans-122
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: Linux DNS设置
- en: 'To route DNS requests through your Pi-Hole server on Linux endpoints, follow
    these steps:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 要在Linux端点上通过Pi-Hole服务器路由DNS请求，请按照以下步骤操作：
- en: 1\. Open **Settings▸Network**.
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1\. 打开**设置▸网络**。
- en: 2\. Click the configuration **Cog** to the right of your Wired or Wireless connection.
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2\. 点击你有线或无线连接右侧的配置**齿轮**。
- en: 3\. Select the **IPv4** tab.
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 3\. 选择**IPv4**标签。
- en: 4\. Enter your Pi-Hole server’s IP address in the DNS box.
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 4\. 在DNS框中输入你的Pi-Hole服务器的IP地址。
- en: 5\. Click **Apply**.
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 5\. 点击**应用**。
- en: pfSense DNS Settings
  id: totrans-129
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: pfSense DNS设置
- en: 'Using pfSense, you’re able to configure DNS settings either per client within
    the static IP addressing settings you will have used earlier or en masse by pointing
    your pfSense appliance at your Pi-Hole server for DNS. To send all DNS requests
    through your Pi-Hole server, enter your Pi-Hole IP address in the DNS servers
    box on the **Services▸DHCP Server** page. If you want to specify which endpoints
    will use the Pi-Hole server for DNS, follow these steps:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 使用pfSense，你可以通过之前使用过的静态IP地址设置为每个客户端配置DNS，或者通过将pfSense设备指向你的Pi-Hole服务器进行DNS配置，从而批量设置DNS。如果你想通过Pi-Hole服务器发送所有DNS请求，请在**服务▸DHCP服务器**页面的DNS服务器框中输入你的Pi-Hole
    IP地址。如果你想指定哪些端点将使用Pi-Hole服务器进行DNS解析，请按照以下步骤操作：
- en: 1\. Browse to the **Services▸DHCP Server** page of your pfSense appliance.
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1\. 浏览到pfSense设备的**服务▸DHCP服务器**页面。
- en: 2\. Find the Static Mapping option for the relevant endpoint in the DHCP Static
    Mappings table at the bottom of the page.
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2\. 在页面底部的DHCP静态映射表中找到相关端点的静态映射选项。
- en: 3\. Click the **Edit** pencil icon for that endpoint.
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 3\. 点击该端点的**编辑**铅笔图标。
- en: 4\. Enter your Pi-Hole server’s IP address in the DNS box.
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 4\. 在DNS框中输入你的Pi-Hole服务器的IP地址。
- en: 5\. Click **Save▸Apply Changes**.
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 5\. 点击**保存▸应用更改**。
- en: Once you’ve configured your endpoints using any of the previous options, you
    can test your ad-blocking capability using a website like [https://canyoublockit.com/](https://canyoublockit.com/).
    Such websites provide several options for testing your ad blockers, whether they’re
    browser-based or something more substantial like Pi-Hole, from simple to advanced
    testing methods. If you run these tests and see no ads, your ad blocker is working.
    If you still see ads, review the earlier sections of this chapter and ensure your
    settings are correct. Log in to your Pi-Hole server and check the dashboard to
    see if your DNS queries are being seen by, and are therefore passing through,
    the server.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你使用之前的任意选项配置了端点，你可以通过像[https://canyoublockit.com/](https://canyoublockit.com/)这样的站点测试你的广告屏蔽功能。这类网站提供了多种测试广告屏蔽工具的方法，无论是基于浏览器的，还是像Pi-Hole这样更为强大的工具，从简单到高级的测试方式都有。如果你运行这些测试并且没有看到广告，说明你的广告屏蔽工具正在正常工作。如果你仍然看到广告，请回顾本章的早期部分，确保设置正确。登录到你的Pi-Hole服务器，检查仪表盘，看看你的DNS查询是否被服务器看到并通过了服务器。
- en: '[Summary](nsp-enoka501485-0007.xhtml#rah0902)'
  id: totrans-137
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[总结](nsp-enoka501485-0007.xhtml#rah0902)'
- en: Regardless of how you choose to use Pi-Hole, you now have a means of monitoring
    and controlling internet usage in your network, and everyone should have a better
    internet browsing experience. You can choose to use Pi-Hole in addition to the
    Squid proxy you might have implemented in [Chapter 6](nsp-enoka501485-0015.xhtml#ch06),
    or you can use either Squid or Pi-Hole without the other. Whichever solution you
    choose, you’ll experience the benefits associated with that technology. Alternatively,
    you can forego DNS-level ad blocking if you prefer to use browser-based blocking
    utilizing browser add-ons; the choice is yours.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 无论你选择如何使用Pi-Hole，你现在都有了一个监控和控制网络中互联网使用的手段，大家的互联网浏览体验也会变得更好。你可以选择在你可能在[第6章](nsp-enoka501485-0015.xhtml#ch06)实现的Squid代理的基础上使用Pi-Hole，或者仅使用Squid或Pi-Hole中的任何一个。无论你选择哪种解决方案，你都会体验到与该技术相关的好处。或者，如果你更喜欢使用基于浏览器的屏蔽功能并使用浏览器插件，也可以选择放弃DNS级别的广告屏蔽；选择权在你。
