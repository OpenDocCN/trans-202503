<html><head></head><body>
<div id="book-content">
<div id="sbo-rt-content"><section>
<header>
<h1 class="chapter">
<span class="ChapterNumber"><span epub:type="pagebreak" title="219" id="Page_219"/><a class="XrefDestination" id="14"/><span class="XrefDestination" id="xref-503007c14-001"/>14</span><br/>
<span class="ChapterTitle"><a class="XrefDestination" id="TipsandTricks"/><span class="XrefDestination" id="xref-503007c14-002"/>Tips and Tricks</span></h1>
</header>
<figure class="opener">
<img src="image_fi/book_art/chapterart.png" alt="" width="200" height="200"/>
</figure>
<p class="ChapterIntro">In this chapter, you’ll build confidence in your new MySQL skills by reviewing common pitfalls and how to avoid them. Then, you’ll look at transactions and the MySQL command line client. You’ll also learn how to load data to and from files.</p>
<h2 id="h1-503007c14-0001"><a class="XrefDestination" id="CommonMistakes"/><span class="XrefDestination" id="xref-503007c14-003"/>Common Mistakes</h2>
<p class="BodyFirst">MySQL can process sets of information very quickly. You can update thousands of rows in the blink of an eye. While this gives you a lot of power, it also means there is greater potential for mistakes, like running SQL against the wrong database or server or running partial SQL statements.</p>
<h3 id="h2-503007c14-0001"><span epub:type="pagebreak" title="220" id="Page_220"/><a class="XrefDestination" id="WorkingintheWrongDatabase"/><span class="XrefDestination" id="xref-503007c14-004"/>Working in the Wrong Database</h3>
<p class="BodyFirst">When working with relational databases like MySQL, you need to be cognizant of which database you’re working in. It’s surprisingly common to run a SQL statement in the wrong one. Let’s look at some ways you can avoid it.</p>
<p>Say you’ve been asked to create a new database called <code>distribution</code> and to create a table called <code>employee</code>.</p>
<p>You might use these SQL commands:</p>
<pre><code>create database distribution;

create table employee
  (
    employee_id     int            primary key,
    employee_name   varchar(100),
    tee_shirt_size  varchar(3)
  );</code></pre>
<p>If you’re using MySQL Workbench to run the commands, you’ll see two green checkmarks in the lower panel telling you that your database and table were successfully created (<a href="#figure14-1" id="figureanchor14-1">Figure 14-1</a>).</p>
<figure>
<img src="image_fi/503007c14/f14001.png" class="keyline" alt="" width="694" height="269"/>
<figcaption><p><a id="figure14-1">Figure 14-1</a>: You used MySQL Workbench to create an <span class="LiteralInCaption"><code>employee</code></span> table in the <span class="LiteralInCaption"><code>distribution</code></span> database . . . didn’t you?</p></figcaption>
</figure>
<p>Everything looks good, so you declare victory and move on to your next task. Then you start to get calls saying that the table wasn’t created. What went wrong?</p>
<p>Although you created the <code>distribution</code> database, you didn’t set your current database to <code>distribution</code> before you created the table. Your new <code>employee</code> table instead was created in whatever your current database happened to be at the time. You should have included the <code>use</code> command before you created the table, like so:</p>
<pre><code>create database distribution;

<b>use distribution;</b>

create table employee
<span epub:type="pagebreak" title="221" id="Page_221"/>  (
    employee_id     int            primary key,
    employee_name   varchar(100),
    tee_shirt_size  varchar(3)
  );</code></pre>
<p>One way to avoid creating a table in the wrong database is to <em>fully qualify</em> the table name when you create it. You can specify the name of the database to create the table in, so that even if you aren’t currently in that database, the table will be created there. Here you specify that you want to create the <code>employee</code> table in the <code>distribution</code> database:</p>
<pre><code>create table distribution.employee</code></pre>
<p>Another way you could have avoided creating the table in the wrong database is by checking what your current database was before creating the table, like so:</p>
<pre><code>select database();</code></pre>
<p>If your result was anything other than <code>distribution</code>, this would have alerted you that you forgot to correctly set your current database with the <code>use</code> command.</p>
<p>You can fix such a mistake by figuring out which database the <code>employee</code> table was created in, dropping the table, and then re-creating the <code>employee</code> table in the <code>distribution</code> database.</p>
<p>To determine which database or databases have an <code>employee</code> table, run this query:</p>
<pre><code>select table_schema,
       create_time
from   information_schema.tables
where  table_name = 'employee';</code></pre>
<p>You’ve queried the <code>tables</code> table in the <code>information_schema</code> database, and selected the <code>create_time</code> column to see if this table was created recently. The output is as follows:</p>
<pre><code>TABLE_SCHEMA  CREATE_TIME
------------  -------------------
     bank     2024-02-05 14:35:00</code></pre>
<p>It’s possible that you could have different tables named <code>employee</code> in more than one database. If that were the case, your query would have returned more than one row. But in this example, the only database with an <code>employee</code> table is <code>bank</code>, so that’s where your table was mistakenly created.</p>
<p>As an extra check, see how many rows are in the <code>employee</code> table:</p>
<pre><code>use bank;

select count(*) from employee;

<span epub:type="pagebreak" title="222" id="Page_222"/>count(*)
--------
    0</code></pre>
<p>There are no rows in this table, which is expected for a table that was created by mistake. Confident that the <code>employee</code> table in the <code>bank</code> database is the one you accidentally created in the wrong place, you can now run these commands to correct your mistake:</p>
<pre><code>use bank;

-- Remove the employee table mistakenly created in the bank database
drop table employee;

use distribution;

-- Create the employee table in the bank database
create table employee
  (
    employee_id     int            primary key,
    employee_name   varchar(100),
    tee_shirt_size  varchar(3)
  );</code></pre>
<p>Your <code>employee</code> table in the <code>bank</code> database has been removed, and an <code>employee</code> table in the <code>distribution</code> database has been created.</p>
<p>You could have moved the table from one database to the other with the <code>alter table</code> command instead, like so:</p>
<pre><code>alter table bank.employee rename distribution.employee;</code></pre>
<p>It’s preferable to drop and re-create a table rather than altering the table, however, especially if the table has triggers or foreign keys associated with it that might still be pointing to the wrong database.</p>
<h3 id="h2-503007c14-0002"><a class="XrefDestination" id="UsingtheWrongServer"/><span class="XrefDestination" id="xref-503007c14-005"/>Using the Wrong Server</h3>
<p class="BodyFirst">Sometimes, SQL statements can be executed against the wrong MySQL server. Companies often set up different servers for production and development. The <em>production</em> environment is the live environment that end users access, so you want to be careful with its data. The <em>development</em> environment is where developers test new code. Since the data in this environment is seen only by developers, you should always test your SQL statements here before releasing them to production.</p>
<p>It’s not unusual for a developer to have two windows open: one connected to the production server and one connected to the development server. If you’re not careful, you can make changes in the wrong window.</p>
<p>If you’re using a tool like MySQL Workbench, consider naming your connections <em>Production</em> and <em>Development</em> so that its tabs clearly state which environment is which (see <a href="#figure14-2" id="figureanchor14-2">Figure 14-2</a>).</p>
<span epub:type="pagebreak" title="223" id="Page_223"/><figure>
<img src="image_fi/503007c14/f14002.png" class="keyline" alt="" width="390" height="198"/>
<figcaption><p><a id="figure14-2">Figure 14-2</a>: Naming the MySQL Workbench tabs Development and Production</p></figcaption>
</figure>
<p>To name connections in MySQL Workbench, go to <b>Database</b><span class="MenuArrow">▶</span><b>Manage Connections</b>. In the Setup New Connection window that opens, enter a connection name like Development or Production that specifies the environment.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	To avoid potential mistakes, consider opening a connection to the production environment <em>only</em> when you’re making changes that have already been tested, and closing that window once you’re finished.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>Other tools have similar ways to mark production and development environments. Some allow you to change the background color, so you might consider setting your production screen to red as a reminder to be careful in that environment.</p>
<h3 id="h2-503007c14-0003"><a class="XrefDestination" id="LeavingwhereClausesIncomplete"/><span class="XrefDestination" id="xref-503007c14-006"/>Leaving where Clauses Incomplete</h3>
<p class="BodyFirst">When you insert, update, or delete data in a table, it’s crucial that your <code>where</code> clause is complete. If it isn’t, you run the risk of changing unintended rows.</p>
<p>Imagine you own a used car dealership and you store the cars you have in stock in the <code>inventory</code> table. Check what’s in the table:</p>
<pre><code>select * from inventory;</code></pre>
<p>The results are:</p>
<pre><code>vin                mfg         model     color
----------         ----------  --------  ------
1ADCQ67RFGG234561  Ford        Mustang   red
2XBCE65WFGJ338565  Toyota      RAV4      orange
3WBXT62EFGS439561  Volkswagen  Golf      black
4XBCX68RFWE532566  Ford        Focus     green
5AXDY62EFWH639564  Ford        Explorer  yellow
6DBCZ69UFGQ731562  Ford        Escort    white
7XBCX21RFWE532571  Ford        Focus     black
8AXCL60RWGP839567  Toyota      Prius     gray
9XBCX11RFWE532523  Ford        Focus     red</code></pre>
<p><span epub:type="pagebreak" title="224" id="Page_224"/>Looking at a Ford Focus on the lot, you notice that you have it listed as green, but its color is actually closer to blue. You decide to update its color in the database (<a href="#listing14-1" id="listinganchor14-1">Listing 14-1</a>).</p>
<pre><code>update inventory
set    color = 'blue'
where  mfg = 'Ford'
and    model = 'Focus';</code></pre>
<p class="CodeListingCaption"><a id="listing14-1">Listing 14-1</a>: An <code>update</code> statement with incomplete criteria in the <code>where</code> clause</p>
<p>When you run the <code>update</code> statement, you’re surprised to see MySQL return a message of <code>3 row(s) affected</code>. You meant to update only one row, but it appears that three rows were changed.</p>
<p>You run a query to see what happened:</p>
<pre><code>select *
from   inventory
where  mfg = 'Ford'
and    model = 'Focus';</code></pre>
<p>The results are:</p>
<pre><code>4XBCX68RFWE532566  Ford  Focus  blue
7XBCX21RFWE532571  Ford  Focus  blue
9XBCX11RFWE532523  Ford  Focus  blue</code></pre>
<p>Because the <code>where</code> clause in your <code>update</code> statement was missing criteria, you mistakenly updated the color of every Ford Focus in the table to <code>blue</code>.</p>
<p>Your <code>update</code> statement in <a href="#listing14-1">Listing 14-1</a> should have been:</p>
<pre><code>update inventory
set    color = 'blue'
where  mfg = 'Ford'
and    model = 'Focus'
<b>and    color = 'green';</b></code></pre>
<p>The last line is missing in <a href="#listing14-1">Listing 14-1</a>. With this additional criteria, the <code>update</code> statement would have changed just <em>green</em> Ford Focuses to blue. Since you had only one green Ford Focus on the lot, only the correct car would have been updated.</p>
<p>A more efficient way to do the update would have been to use the VIN (Vehicle Identification Number) in your <code>where</code> clause:</p>
<pre><code>update inventory
set    color = 'blue'
<b>where  vin = '4XBCX68RFWE532566';</b></code></pre>
<p>Since each car has a distinct VIN, with this approach you are guaranteed that your <code>update</code> statement will update just one vehicle.</p>
<p><span epub:type="pagebreak" title="225" id="Page_225"/>Either of these <code>update</code> statements would have provided enough criteria to identify the one row you intended to change, and you would have updated just that row.</p>
<p>A simple sanity check you can perform before you insert, update, or delete rows is to <code>select</code> from the table using the same <code>where</code> clause. For example, if you were planning to run the <code>update</code> statement in <a href="#listing14-1">Listing 14-1</a>, you would run this <code>select</code> statement first:</p>
<pre><code>select *
from   inventory
where  mfg = 'Ford'
and    model = 'Focus';</code></pre>
<p>The results would have been:</p>
<pre><code>vin                mfg         model     color
----------         ----------  --------  ------
4XBCX68RFWE532566  Ford        Focus     green
7XBCX21RFWE532571  Ford        Focus     black
9XBCX11RFWE532523  Ford        Focus     red</code></pre>
<p>The query produces a list of the rows that you are about to update. If you really wanted to update all three rows, you could then run the <code>update</code> statement that uses the same <code>where</code> clause. In this case, you would have recognized that this <code>where</code> clause in your <code>select</code> statement matched too many rows and could have avoided updating more than the single row you intended.</p>
<h3 id="h2-503007c14-0004"><a class="XrefDestination" id="RunningPartialSQLStatements"/><span class="XrefDestination" id="xref-503007c14-007"/>Running Partial SQL Statements</h3>
<p class="BodyFirst">MySQL Workbench has three lightning bolt icons that can be used for executing SQL statements in different ways. Each icon’s actions are listed in <a href="#table14-1" id="tableanchor14-1">Table 14-1</a>.</p>
<figure>
<figcaption class="TableTitle"><p><a id="table14-1">Table 14-1</a>: Lightning Bolt Icons in MySQL Workbench</p></figcaption>
<table id="table-503007c14-0001" border="1"><tbody>
<tr>
<td style="padding-bottom:8px;">Simple lightning bolt<br/>
<span class="GraphicInline"><img src="image_fi/503007c14/i14001.png" alt="i14001" width="37" height="38"/></span></td>
<td>Executes the selected statements or, if nothing is selected, all statements</td>
</tr>
<tr>
<td style="padding-bottom:8px;">Cursor lightning bolt<br/>
<span class="GraphicInline"><img src="image_fi/503007c14/i14002.png" alt="i14002" width="38" height="38"/></span></td>
<td>Executes the statement under the keyboard cursor</td>
</tr>
<tr>
<td style="padding-bottom:8px;">Magnifying glass lightning bolt<br/>
<span class="GraphicInline"><img src="image_fi/503007c14/i14003.png" alt="i14003" width="38" height="38"/></span></td>
<td>Executes the EXPLAIN plan for the statement under the cursor</td>
</tr>
</tbody>
</table>
</figure>
<p>Most MySQL Workbench users will use the simple and cursor lightning bolt icons for their day-to-day work. The magnifying glass lightning bolt is used less often, as it is an optimization tool that explains what steps MySQL would take to run your query.</p>
<p><span epub:type="pagebreak" title="226" id="Page_226"/>If you use the simple lightning bolt icon without realizing part of your SQL statement is highlighted, you’ll inadvertently run that highlighted section. For example, say you want to delete the Toyota Prius from the <code>inventory</code> table. You write the following <code>delete</code> statement to delete the car with the Prius’s VIN:</p>
<pre><code>delete from inventory
where vin = '8AXCL60RWGP839567';</code></pre>
<p>Now, you’ll use MySQL Workbench to run your <code>delete</code> statement (<a href="#figure14-3" id="figureanchor14-3">Figure 14-3</a>).</p>
<figure>
<img src="image_fi/503007c14/f14003.png" class="keyline" alt="" width="494" height="290"/>
<figcaption><p><a id="figure14-3">Figure 14-3</a>: Mistakenly deleting all rows in the table using MySQL Workbench</p></figcaption>
</figure>
<p>When you click the simple lightning bolt icon, MySQL tells you that all rows in the table were deleted. What happened?</p>
<p>Before you ran the <code>delete</code> statement, you mistakenly highlighted the first line of the SQL command. This told MySQL to delete all rows in the table, rather than the one you attempted to specify.</p>
<h2 id="h1-503007c14-0002"><a class="XrefDestination" id="Transactions"/><span class="XrefDestination" id="xref-503007c14-008"/>Transactions</h2>
<p class="BodyFirst">You can lessen the possibility of mistakes by executing statements as part of a transaction. A <em>transaction</em> is a group of one or more SQL statements that can be <em>committed</em> (made permanent) or <em>rolled</em> <em>back</em> (canceled). For example, before updating your <code>inventory</code> table, you could use the <code>start transaction</code> command to begin a transaction that you can later commit or roll back:</p>
<pre><code>start transaction;

update inventory
set    color = 'blue'
where  mfg = 'Ford'
and    model = 'Focus';</code></pre>
<p>The <code>begin</code> command is an alias for <code>start transaction</code>. You can use either.</p>
<p><span epub:type="pagebreak" title="227" id="Page_227"/>If you run your <code>update</code> statement and MySQL returns a message of <code>3 row(s) affected</code>, but you were expecting one row to be changed, you can roll back the transaction:</p>
<pre><code>rollback;</code></pre>
<p>Your <code>update</code> gets rolled back, the changes are canceled, and the rows remain unchanged in the table. To make the changes permanent, commit the transaction:</p>
<pre><code>commit;</code></pre>
<p>Transactions are helpful when you’re using Data Manipulation Language (DML) statements like <code>insert</code>, <code>update</code>, or <code>delete</code>. Data Definition Language (DDL) statements like <code>create function</code>, <code>drop procedure</code>, or <code>alter table</code> shouldn’t be made in a transaction. They can’t be rolled back—running them will automatically commit the transaction.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="boxcustom1">
<h2>Try It Yourself</h2>
<p class="BoxBodyFirst">The <code>zoo</code> table in the <code>travel</code> database contains the following data:</p>
<pre><code>zoo_name                  country
------------------------  ---------
Beijing Zoo               China
Berlin Zoological Garden  Germany
Bronx Zoo                 USA
Ueno Zoo                  Japan
Singapore Zoo             Singapore
Chester Zoo               England
San Diego Zoo             USA
Toronto Zoo               Canada
Korkeasaari Zoo           Finland
Henry Doorly Zoo          USA</code></pre>
<p class="BoxListNumberCustom1"><b>14-1.</b>	Using MySQL Workbench, run these commands one at a time:</p>
<pre><code>use travel;

start transaction;

update zoo
set    zoo_name = 'SD Zoo'
where  country = 'USA';

rollback;

select * from zoo;</code></pre>
<p class="ListBody"><span epub:type="pagebreak" title="228" id="Page_228"/>Did the <code>update</code> statement take effect, or was it rolled back?</p>
<p class="BoxListNumberCustom1"><b>14-2.</b>	Now run the same commands one at a time, but instead of using <code>rollback</code>, use <code>commit</code>. Does the <code>update</code> statement take effect now?</p>
<pre><code>use travel;

start transaction;

update zoo
set    zoo_name = 'SD Zoo'
where  country = 'USA';

commit;

select * from zoo;</code></pre>
<p class="ListBody">Did the <code>update</code> statement update only the <code>San Diego Zoo</code>? Should this <code>update</code> statement have been rolled back or committed?</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>Until you commit or roll back your <code>update</code> statement, MySQL will keep the table locked. For example, if you run these commands</p>
<pre><code>start transaction;

update inventory
set    color = 'blue'
where  mfg = 'Ford'
and    model = 'Focus';</code></pre>
<p class="BodyContinued">the <code>inventory</code> table will remain locked and no other users will be able to make changes to its data until you commit or roll back your changes. If you start the transaction and then go to lunch without committing or rolling it back, you might come back to some angry database users.</p>
<h2 id="h1-503007c14-0003"><a class="XrefDestination" id="SupportinganExistingSystem"/><span class="XrefDestination" id="xref-503007c14-010"/>Supporting an Existing System</h2>
<p class="BodyFirst">You may find yourself supporting a MySQL system that has already been developed. A good way to start to understand an existing system is by browsing through its database objects using MySQL Workbench (<a href="#figure14-4" id="figureanchor14-4">Figure 14-4</a>).</p>
<p>You can learn a lot about an existing system by exploring using MySQL’s navigator panel. Are there many databases with a few tables in each one, or are there one or two databases with a lot of tables in each? What are the naming conventions you should follow? Are there many stored procedures, or is most of the business logic handled outside of MySQL in a programming language like PHP or Python? Have primary and foreign keys been set up for most tables? Do they use many triggers? Looking at the procedures, <span epub:type="pagebreak" title="229" id="Page_229"/>functions, and triggers, which delimiter do they use? Check the existing database objects and follow that lead when it comes to naming conventions for any new code you add to the system.</p>
<figure>
<img src="image_fi/503007c14/f14004.png" class="keyline" alt="" width="685" height="718"/>
<figcaption><p><a id="figure14-4">Figure 14-4</a>: Exploring an existing MySQL database</p></figcaption>
</figure>
<p>Sometimes the hardest part of supporting an existing system is understanding the problem set and terminology of the application. A good first question for you to ask is, “What are the most important tables?” Focus your attention on learning about them first. You can select from the table and understand how those primary key values uniquely identify the rows in the table. Check for triggers on those tables and look through the trigger code to understand what actions happen automatically when data in the tables is changed.</p>
<p>MySQL Workbench also presents a nice graphical depiction of the way that MySQL objects hang together. For example, you can see in <a href="#figure14-4">Figure 14-4</a> that databases have tables, stored procedures, and functions. Tables have columns, indexes, foreign keys, and triggers.</p>
<h2 id="h1-503007c14-0004"><span epub:type="pagebreak" title="230" id="Page_230"/><a class="XrefDestination" id="UsingtheMySQLCommandLineClient"/><span class="XrefDestination" id="xref-503007c14-011"/>Using the MySQL Command Line Client</h2>
<p class="BodyFirst">The MySQL command line client, <code>mysql</code>, allows you to run SQL commands from the command line interface of your computer (often called the <em>console</em>, <em>command</em> <em>prompt</em>, or <em>terminal</em>). This is useful in situations where you want to run SQL statements against a MySQL database but don’t need a graphical user interface like MySQL Workbench.</p>
<p>At the command line of your computer, enter <code class="bold">mysql</code> to start the MySQL command line client tool, and supply additional information like:</p>
<pre><code>mysql --host <var class="bold">localhost</var> --database <var class="bold">investment</var> --user <var class="bold">rick</var> --password=<var class="bold">icu2</var></code></pre>
<p>You can also use single-letter options with a single dash—for example, <code>-h</code> instead of <code>--host</code>; <code>-D</code> for <code>--database</code>; and <code>-u</code> and <code>-p</code> for <code>--user</code> and <code>--password=</code>, respectively.</p>
<p>You specify the host where the MySQL server is located with <code>--host</code>. In this example, the MySQL server is installed on my computer, so I’ve supplied the value <code>localhost</code>. If you’re connecting to a server that’s installed on another computer, you can the specify the host, like <code>--host www.nostarch.com</code>, or supply an IP address.</p>
<p>Then, enter the name of the database you want to connect to after <code>--database</code>, your MySQL user ID after <code>--user</code>, and your MySQL password after the <code>--password=</code> option.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">Note</span></h2>
<p>	If your computer doesn’t recognize the <code>mysql</code> command, try adding the directory where <code>mysql</code> is located to your path. If you have a Windows computer, you can add the directory to your <code>PATH</code> environment variable using the Environment Variables system properties dialog. If you have a Mac, you usually change the <code>$PATH</code> variable in the <em>.bash_profile</em> file. You can find more information by searching for “Customizing the Path for MySQL Tools” in the online reference manual at <a href="https://dev.mysql.com/doc/refman/8.0/en/" class="LinkURL">https://dev.mysql.com/doc/refman/8.0/en/</a>.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>You should see this warning:</p>
<pre><code>[Warning] Using a password on the command line interface can be insecure.</code></pre>
<p>That’s because you supplied the database password in plaintext. This isn’t a great idea, as anyone looking over your shoulder could see your password. A more secure approach is to let <code>mysql</code> prompt you for it. If you use <code>-p</code> at the command line without specifying the password, the tool will prompt you to enter the password. As you type the letters of the password, asterisks will appear:</p>
<pre><code>mysql -h localhost -D investment -u rick -p
Enter password: <b>****</b></code></pre>
<p>Another approach is to use the MySQL configuration utility to securely store your credentials:</p>
<pre><code>&gt; mysql_config_editor set --host=localhost --user=investment --password
Enter password: ****</code></pre>
<p><span epub:type="pagebreak" title="231" id="Page_231"/>You specify host and user with the <code>--host</code> and <code>--user</code> options. The <code>--password</code> option allows you to enter your password.</p>
<p>Once you have saved credentials, you can use the <code>print --all</code> option to show them:</p>
<pre><code>mysql_config_editor print --all</code></pre>
<p>The password appears as asterisks:</p>
<pre><code>[client]
user = "investment"
password = ****
host = "localhost"</code></pre>
<p>Now you can enter the MySQL command line client, <code>mysql</code>, at the command line without having to enter your username, password, or host:</p>
<pre><code><b>mysql -D investment</b></code></pre>
<p>In other words, you can log in to MySQL by providing only the name of the database.</p>
<p>You might wonder why you would use a text-based tool like <code>mysql</code> when more sophisticated graphical tools like MySQL Workbench are available. The <code>mysql</code> tool is particularly useful when you want to run SQL statements that are in a script file. A <em>script file</em> is a set of SQL commands saved in a file on your computer. For example, you could create a file called <em>max_and_min_indexes.sql</em> that contains the following SQL statements, which get the market index with the smallest and largest values:</p>
<pre><code>use investment;

select *
from   market_index
where  market_value =
(
  select  min(market_value)
  from    market_index
);

select *
from   market_index
where  market_value =
(
  select  max(market_value)
  from    market_index
);</code></pre>
<p>You can then run the SQL script from your command line using <code>mysql</code>:</p>
<pre><code>mysql –h localhost -D investment -u rick -picu2 &lt; min_and_max.sql &gt; min_and_max.txt</code></pre>
<p><span epub:type="pagebreak" title="232" id="Page_232"/>You used <code>&lt;</code> so that <code>mysql</code> will take its input from the <em>min_and_max.sql</em> script, and <code>&gt;</code> so that it will write its output to the <em>min_and_max.txt</em> file. If you supply the password, in this case <code>icu2</code>, don’t add a space after <code>-p</code>. Strangely, <code>-picu2</code> works but <code>-p icu2</code> does not.</p>
<p>After you run the command, the output file <em>min_and_max.txt</em> should look like this:</p>
<pre><code>market_index    market_value
S&amp;P             500 4351.77
market_index                    market_value
Dow Jones Industrial Average    34150.66</code></pre>
<p>The <code>mysql</code> tool writes a tab between the columns in the file.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">Note</span></h2>
<p>	To see a complete list of options, type <code class="bold">mysql --help</code> at the command line.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-503007c14-0005"><a class="XrefDestination" id="LoadingDatafromaFile"/><span class="XrefDestination" id="xref-503007c14-012"/>Loading Data from a File</h2>
<p class="BodyFirst">Oftentimes you’ll get data in the form of files, such as accepting a data feed from another organization. The <code>load data</code> command reads data from a file and writes it into a table.</p>
<p>To test loading data from a file into a table, I created a data file on my computer called<em> market_indexes.txt</em> in the <em>C:\Users\rick\market\ </em>directory. The file looks like this:</p>
<pre><code>Dow Jones Industrial Average   34150.66
Nasdaq                         13552.93
S&amp;P 500                         4351.77</code></pre>
<p>The file contains the names and current value of three financial market indexes. It is <em>tab-delimited</em>, which means that the fields in the file are separated by the tab character.</p>
<p>In MySQL, load the file into a table like so:</p>
<pre><code>use investment;

load data local
infile 'C:/Users/rick/market/market_indexes.txt'
into table market_index;</code></pre>
<p>You use the <code>load data</code> command and specify <code>local</code>, which tells MySQL to look for the data file on your local computer, not on the server where MySQL is installed. By default, <code>load data</code> loads tab-delimited files.</p>
<p>After the <code>infile</code> keyword, you give the name of the input file you want to load. In this example, you’re using the path of a file on a Windows computer. To specify the directory where the file is located on Windows, use forward slashes, as backslashes will result in an error. To load a file in a Mac or Linux environment, use forward slashes as usual.</p>
<p><span epub:type="pagebreak" title="233" id="Page_233"/>Take a look at the data that was loaded into the table:</p>
<pre><code>select * from market_index;</code></pre>
<p>The result is:</p>
<pre><code>market_index                  market_value
----------------------------  ------------
Dow Jones Industrial Average     34150.66
Nasdaq                           13552.93
S&amp;P 500                           4351.77</code></pre>
<p>There were two fields in the file and two columns in the table, so the fields on the left were loaded into the first column and the fields on the right were loaded into the second column in the table.</p>
<p>Another common data file format is a <em>comma-separated values (CSV)</em> file. You could have loaded a data file called <em>market_indexes.csv</em> that looks like this:</p>
<pre><code>Dow Jones Industrial Average, 34150.66
Nasdaq, 13552.93
S&amp;P 500, 4351.77</code></pre>
<p>To load this file, add the syntax <code>fields terminated by ","</code> to declare the delimiter in this file as a comma. MySQL uses the commas in the data file to identify the beginning and end of the fields.</p>
<pre><code>load data local
infile 'C:/Users/rick/market/market_indexes.csv'
into table market_index
<b>fields terminated by ",";</b></code></pre>
<p>Occasionally, you’ll want to load a data file that has a header row, like this:</p>
<pre><code>Financial Index, Current Value
Dow Jones Industrial Average, 34150.66
Nasdaq, 13552.93
S&amp;P 500, 4351.77</code></pre>
<p>You can have <code>load data</code> skip the header by using the <code>ignore</code> keyword:</p>
<pre><code>load data local
infile 'C:/Users/rick/market/market_indexes.csv'
into table market_index
fields terminated by ","
<b>ignore 1 lines;</b></code></pre>
<p>There was one header line in the data file, so you used the <code>ignore 1 lines</code> syntax to prevent the first line from loading into the table. The three rows of data are loaded, but the <code>Financial Index</code> and <code>Current Value</code> headings in the data file are ignored.</p>
<h2 id="h1-503007c14-0006"><span epub:type="pagebreak" title="234" id="Page_234"/><a class="XrefDestination" id="LoadingDatatoaFile"/><span class="XrefDestination" id="xref-503007c14-013"/>Loading Data to a File</h2>
<p class="BodyFirst">You can provide data to another department or organization by sending data files. One way to write data from the database to a file is to use the syntax <code>select...into outfile</code>. You can run queries and select the results to a file rather than to your screen.</p>
<p>You can specify which delimiters you want to use to format the output. Create a CSV file containing the values in the <code>market_index</code> table like so:</p>
<pre><code>select * from market_index
into outfile 'C:/ProgramData/MySQL/MySQL Server 8.0/Uploads/market_index.csv'
fields terminated by ',' optionally enclosed by '"';</code></pre>
<p>You select all values from the <code>market_index</code> table and write them to the <em>market_index.csv</em> file in the <em>C:/ProgramData/MySQL/MySQL Server 8.0/Uploads</em> directory on the host computer.</p>
<p>You use commas as the delimiter in your output file by using the syntax <code>fields terminated by ','</code>.</p>
<p>The <code>optionally enclosed by</code><code> '"'</code> line tells MySQL to wrap fields in quotes for any columns that have a <code>string</code> data type.</p>
<p>Your <em>market_index.csv</em> gets created like this:</p>
<pre><code>"Dow Jones Industrial Average",34150.66
"Nasdaq",13552.93
"S&amp;P 500",4351.77</code></pre>
<p>The <code>select...into outfile</code> syntax can create a file only on the server where MySQL is running. It can’t create a file on your local computer.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2><a class="XrefDestination" id="HowtoEnableLoadingdata"/><span class="XrefDestination" id="xref-503007c14-014"/>How to Enable Loading data</h2>
<p class="BoxBodyFirst">Depending on how your MySQL environment is configured, running the <code>load data local</code> command may produce an error like this:</p>
<pre><code>Error Code: 3948. Loading local data is disabled; this must be enabled on both the client and server sides</code></pre>
<p>You or your database administrator can configure MySQL to allow loading local files by setting the <code>local_infile</code> system variable to <code>ON</code>. You can see the current value of your <code>local_infile</code> setting using this command:</p>
<pre><code>show global variables like 'local_infile';</code></pre>
<p>The result may show that the value is set to <code>OFF</code>:</p>
<pre><code>Variable_name   Value
-------------   -----
local_infile    OFF</code></pre>
<p><span epub:type="pagebreak" title="235" id="Page_235"/>If it is set to <code>OFF</code>, you won’t be able to load files from your client computer. You can set it to <code>ON</code> using this command:</p>
<pre><code>set global local_infile = on;</code></pre>
<p>If you work in a highly secure environment, your database administrator might not want to allow local files to be loaded, and may choose not to change this setting to <code>ON</code>.</p>
<p>To load files that reside on the host—the server where MySQL is installed—check for a setting called <code>secure_file_priv</code> that controls which directory on the server you can load files from. You can check this value using this command:</p>
<pre><code>show global variables like 'secure_file_priv';</code></pre>
<p>If the <code>Value</code> returned is a directory, then that is the only directory on the server you’ll be allowed to import or export files to and from.</p>
<pre><code>Variable_name     Value
----------------  ----------------------------------------------
secure_file_priv  C:\ProgramData\MySQL\MySQL Server 8.0\Uploads\</code></pre>
<p>In this case, when you use <code>load data</code>, the files must be loaded from the <em>C:\ProgramData\MySQL\MySQL Server 8.0\Uploads\</em> directory on the server. This setting also affects writing to a file with <code>select...into outfile</code>. You won’t be able to write to files in any other directories on the server.</p>
<p>If the <code>secure_file_priv</code> is set to <code>null</code>, you won’t be able to read from or write to files on the server at all. If it is set to blank (<code>''</code>), then you can read from or write to files in any directory on the server.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-503007c14-0007"><a class="XrefDestination" id="MySQLShell"/><span class="XrefDestination" id="xref-503007c14-015"/>MySQL Shell</h2>
<p class="BodyFirst">While the MySQL command line client (<code>mysql</code>) is a tried-and-true way to run SQL commands that has been used for decades, MySQL Shell (<code>mysqlsh</code>) is a newer MySQL command line client tool that can run SQL, Python, or JavaScript commands.</p>
<p>You saw earlier that the <code>mysql</code> syntax to run a script called <em>min_and_max.sql</em> is:</p>
<pre><code>mysql –h localhost -D investment -u rick -picu2 &lt; min_and_max.sql &gt; min_and_max.txt</code></pre>
<p>If you prefer, you could use MySQL Shell to run that same script using this command:</p>
<pre><code>mysqlsh --sql –h localhost -D investment -u rick -picu2 &lt; min_and_max.sql &gt; min_and_max.txt</code></pre>
<p><span epub:type="pagebreak" title="236" id="Page_236"/>The syntax is similar, except you call <code>mysqlsh</code> instead of <code>mysql</code>. Also, since <code>mysqlsh</code> can run in SQL, Python, or JavaScript mode, you need to specify <code>--sql</code> to run in SQL mode. (The default mode is JavaScript.)</p>
<p>MySQL Shell comes with a handy utility called <em>parallel table import</em> (<code>import-table</code>) that can load large data files to tables faster than <code>load data</code>.</p>
<pre><code>mysqlsh <span class="CodeAnnotationCode" aria-label="annotation1">❶</span> --mysql -h localhost -u rick -picu2 <span class="CodeAnnotationCode" aria-label="annotation2">❷</span> -- util import-table c:\Users
\rick\market_indexes.txt --schema=investment --table=market_index</code></pre>
<p>When you use the <code>import-table</code> utility, you need to call <code>mysqlsh</code> with the <code>--mysql</code> syntax <span class="CodeAnnotation" aria-label="annotation1">❶</span> to use a classic MySQL protocol connection to communicate between the client and the MySQL server.</p>
<p>To run the parallel table import utility, use the <code>-- util</code> syntax and then give the name of the utility you want to use—in this case, <code>import-table</code> <span class="CodeAnnotation" aria-label="annotation2">❷</span>. You provide the name of the file you want to load, <em>c:\Users\rick\market_indexes.txt</em>, and the database, <code>investment</code>, as well as the table that you want to load the data into, <code>market_index</code>.</p>
<p>The choice to use <code>mysql</code> or <code>mysqlsh</code> is yours. As <code>mysqlsh</code> matures, more developers will move to it and away from <code>mysql</code>. If you have a large data load that is slow to run, using <code>mysqlsh</code> with its parallel table import utility will be considerably faster than using <code>load data</code>.</p>
<p>You can learn more about MySQL Shell at <a href="https://dev.mysql.com/doc/mysql-shell/8.0/en/" class="LinkURL">https://dev.mysql.com/doc/mysql-shell/8.0/en/</a>.</p>
<h2 id="h1-503007c14-0008"><a class="XrefDestination" id="Summary"/><span class="XrefDestination" id="xref-503007c14-016"/>Summary</h2>
<p class="BodyFirst">In this chapter, you looked at some tips and tricks, including how to avoid making common mistakes, use transactions, support existing systems, and load data to and from files.</p>
<p>In the next chapter, you’ll call MySQL from programming languages like PHP, Python, and Java.</p>
</section>
</div>
</div>
</body></html>