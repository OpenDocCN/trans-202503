<html><head></head><body><div id="sbo-rt-content"><span epub:type="pagebreak" id="page_41"/>
<h2 class="h2" id="ch04"><strong><span class="big">4</span><br/>GETTING STARTED WITH GHIDRA</strong></h2>
<div class="image1"><img src="Images/com.jpg" alt="Image" width="204" height="204"/></div>
<p class="noindent">It’s about time we got down to actually using Ghidra. The remainder of this book is dedicated to various features of Ghidra and how you can leverage them to best meet your reverse engineering needs. In this chapter, we begin by covering the options you are presented with when you launch Ghidra, and then we describe what happens when you open a single binary file for analysis. Finally, we present a quick overview of the user interface to lay the groundwork for the remaining chapters.</p>
<h3 class="h3" id="ch04lev52"><strong>Launching Ghidra</strong></h3>
<p class="noindent">Anytime you launch Ghidra, you will be greeted briefly by a splash screen that displays the Ghidra logo, build information, the Ghidra and Java version numbers, and the licensing information. If you wish to thoroughly read the splash screen to learn more about your versions, you can display it at any time by choosing Help ▸ About Ghidra from the Ghidra Project window. <span epub:type="pagebreak" id="page_42"/>Once the splash screen clears, Ghidra displays the Ghidra Project window behind a Tip of the Day dialog, as shown in <a href="ch04.xhtml#fig4_1">Figure 4-1</a>. You can scroll through tips by clicking the Next Tip button. When you are ready to begin working, close the Tip of the Day dialog.</p>
<p class="indent">If you prefer not to see the daily tips, feel free to uncheck the Show Tips on Startup? checkbox at the bottom of the dialog. If you uncheck the box and find yourself missing the Tip of the Day dialog, you can easily restore it through the Ghidra Help menu.</p>
<div class="image"><img src="Images/fig4-1.jpg" alt="image" width="686" height="785"/></div>
<p class="figcap" id="fig4_1"><em>Figure 4-1: Launching Ghidra</em></p>
<p class="indent">If you close the Tip of the Day dialog or uncheck the box and restart Ghidra, you will be presented with the Ghidra Project window. Ghidra uses a project environment to allow you to manage and control the tools and data associated with a file or group of files as you are working with them. This initial introduction focuses on a single file as a component of a nonshared project. More complex project capabilities are discussed in <a href="ch11.xhtml#ch11">Chapter 11</a>.</p>
<span epub:type="pagebreak" id="page_43"/>
<h3 class="h3" id="ch04lev53"><strong>Creating a New Project</strong></h3>
<p class="noindent">If this is your first time launching Ghidra, you will need to create a project. If you have launched Ghidra previously, the active project will be the one you used most recently. Choosing File ▸ New Project allows you to specify characteristics of the environment associated with the project. The first step in creating a new project is to choose between a nonshared project and a shared project. In this chapter, we begin with a nonshared project. With that choice out of the way, you will be presented with the dialog in <a href="ch04.xhtml#fig4_2">Figure 4-2</a>. Nonshared projects require you to specify a project directory and name.</p>
<div class="image"><img src="Images/fig4-2.jpg" alt="image" width="694" height="240"/></div>
<p class="figcap" id="fig4_2"><em>Figure 4-2: Creating a Ghidra project</em></p>
<p class="indent">Once you have entered the project location information, click <strong>Finish</strong> to complete the project creation process. This will return you to the Project window with the newly created project selected, as shown in <a href="ch04.xhtml#fig4_3">Figure 4-3</a>.</p>
<div class="image"><img src="Images/fig4-3.jpg" alt="image" width="694" height="494"/></div>
<p class="figcap" id="fig4_3"><em>Figure 4-3: Ghidra Project window</em></p>
<span epub:type="pagebreak" id="page_44"/>
<h4 class="h4" id="ch04lev54"><strong><em>Ghidra File Loading</em></strong></h4>
<p class="noindent">To do any useful work, you will need to add at least one file to your new project. You can open a file either by choosing File ▸ Import File and browsing to the file you wish to import or by dragging and dropping a file directly into a folder in the Project window. After you have selected a file, you will be presented with the Import dialog shown in <a href="ch04.xhtml#fig4_4">Figure 4-4</a>.</p>
<div class="image"><img src="Images/fig4-4.jpg" alt="image" width="612" height="390"/></div>
<p class="figcap" id="fig4_4"><em>Figure 4-4: Ghidra Import dialog</em></p>
<p class="indent">Ghidra generates a list of potential file types and provides these to you in the Format picklist at the top of the dialog. Clicking the Information button to the right of the Format field will provide you with a list of supported formats, which are described in <a href="ch17.xhtml#ch17">Chapter 17</a>. The Format picklist provides the subset of Ghidra loaders that are best suited for dealing with the selected file. For this example, two options are provided in the Format picklist: Portable Executable (PE) and Raw Binary. The Raw Binary option will always be present since it is Ghidra’s default for loading files that it does not recognize; this provides the lowest-level option for loading any file. When offered the choice of several loaders, it is not a bad strategy to accept the default selections unless you possess specific information that contradicts Ghidra’s determination.</p>
<p class="indent">The Language field allows you to specify which processor module should be used during the disassembly process. A Ghidra language/compiler specification can consist of a processor type, an endian-ness specification (LE/BE), a bitness value (16/32/64), a processor variant, and a compiler ID (for example, ARM:LE:32:v7:default). For more information, refer to the Language/Compiler Specifications callout in <a href="ch13.xhtml#ch13">Chapter 13</a> as well as “<a href="ch17.xhtml#ch17lev333">Language Definition Files</a>” on <a href="ch17.xhtml#page_396">page 396</a>. In most cases, Ghidra will choose the proper processor based on information that it reads from the executable file’s headers.</p>
<span epub:type="pagebreak" id="page_45"/>
<p class="indent">The Destination Folder field lets you select the project folder in which the newly imported file will be displayed. The default is to display the top-level project folder, but subfolders can be added to organize imported programs within a project. You can select the extension buttons to the right of the Language and Destination Folder fields to view other options for each. You can also edit the text in the Program Name field. Don’t be confused by the change in terminology: Program Name is the name that Ghidra uses to refer to the imported binary within the project, including for display in the project window. It defaults to the name of the imported file but could be changed to something more descriptive, such as “Malware from Starship Enterprise.”</p>
<p class="indent">In addition to the four fields shown in <a href="ch04.xhtml#fig4_4">Figure 4-4</a>, you can access other options to control the loading process via the Options button. These options are dependent on the selected format and processor. The options for <em>ch4_example.exe</em>, a PE file for x86, are shown in <a href="ch04.xhtml#fig4_5">Figure 4-5</a>, with the default options selected. While moving ahead with the default options is generally a good approach, you may choose other options as you gain experience. For example, you could include the Load External Libraries option if you wanted to have any dependent libraries imported into your project as well.</p>
<div class="image"><img src="Images/fig4-5.jpg" alt="image" width="491" height="364"/></div>
<p class="figcap" id="fig4_5"><em>Figure 4-5: Ghidra PE file-loading options</em></p>
<p class="indent">The import options are used to gain finer control over the file-loading process. The options are not applicable to all input file types, and in most cases, you can rely on the default selections. Additional information about options is available in Ghidra Help. More details about Ghidra’s import process and loaders are provided in <a href="ch17.xhtml#ch17">Chapter 17</a>.</p>
<p class="indent">When you are happy with your loading options and click OK to close the dialogs, you are presented with an Import Results Summary window, as shown in <a href="ch04.xhtml#fig4_6">Figure 4-6</a>. This provides you an opportunity to review the selected import options along with basic information that the loader has extracted from your chosen file. In “<a href="ch13.xhtml#ch13lev218">Importing Files</a>” on <a href="ch13.xhtml#page_262">page 262</a>, we discuss ways to modify some of the import results prior to analysis if you <span epub:type="pagebreak" id="page_46"/>have additional information that isn’t reflected in the Import Results Summary window.</p>
<div class="image"><img src="Images/fig4-6.jpg" alt="image" width="694" height="876"/></div>
<p class="figcap" id="fig4_6"><em>Figure 4-6: Ghidra Import Results Summary window</em></p>
<h4 class="h4" id="ch04lev55"><strong><em>Using the Raw Binary Loader</em></strong></h4>
<p class="noindent">At times, Raw Binary will be the only entry in the Format picklist. This is Ghidra’s way of telling you that none of its loaders recognize the chosen file. Examples of situations that may call for the use of the Raw Binary loader include the analysis of custom firmware images and exploit payloads that may have been extracted from network packet captures or log files. In these <span epub:type="pagebreak" id="page_47"/>cases, Ghidra cannot recognize any file header information to guide the loading process, so it is up to you to step in and perform tasks that loaders often do automatically, like specifying the processor, the bit size, and, in some cases, a particular compiler.</p>
<p class="indent">For example, if you know the binary contains x86 code, many choices are available in the Language dialog, as shown in <a href="ch04.xhtml#fig4_7">Figure 4-7</a>. Often some research, and occasionally some trial and error, is required to narrow your language choices to something that will work for your binary. Any information you can obtain about the device the file was designed to run on will be useful. If you are confident that the file is not intended for a Windows system, you should select gcc or default (if available) for the Compiler setting.</p>
<div class="image"><img src="Images/fig4-7.jpg" alt="image" width="652" height="633"/></div>
<p class="figcap" id="fig4_7"><em>Figure 4-7: Language and compiler selection options</em></p>
<p class="indent">If the binary file contains no header information Ghidra can work with, Ghidra also will not recognize the memory layout of the file. If you know the base address, file offset, or length of the file, you can enter those values into the corresponding loader option fields shown in <a href="ch04.xhtml#fig4_8">Figure 4-8</a>, or continue to load the file without entering this additional information. (This information can be provided or adjusted at any point before or after <span epub:type="pagebreak" id="page_48"/>analysis through the Memory Map window discussed in the “<a href="ch05.xhtml#ch05lev86">The Memory Map Window</a>” on <a href="ch05.xhtml#page_85">page 85</a>.)</p>
<div class="image"><img src="Images/fig4-8.jpg" alt="image" width="429" height="380"/></div>
<p class="figcap" id="fig4_8"><em>Figure 4-8: Ghidra Raw Binary loader options</em></p>
<p class="indent"><a href="ch17.xhtml#ch17">Chapter 17</a> provides a more detailed discussion of manually loading and organizing unrecognized binary files.</p>
<h3 class="h3" id="ch04lev56"><strong>Analyzing Files with Ghidra</strong></h3>
<p class="noindent">At its heart, Ghidra is essentially a database application controlled by a library of plugins, each with its own functionality. All project data is stored using a custom database that grows and evolves as the user adds information to the project. The various displays that Ghidra offers are simply views into the database that reveal information in formats useful to the software reverse engineer. Any modifications that users make to the database are reflected in the views and saved into the database, but these changes have no effect on the original executable file. The power of Ghidra lies in the tools it contains to analyze and manipulate the data within the database.</p>
<p class="indent">The CodeBrowser anchors the many tools available in Ghidra and has unique functionality to help you keep your windows organized, add and delete tools, rearrange content, and document your process. By default, the CodeBrowser opens with windows for Program Tree, Symbol Tree, Data Type Manager, Listing, Decompiler, and Console. These and other displays are introduced in <a href="ch05.xhtml#ch05">Chapter 5</a>.</p>
<p class="indent">The process just described can be used to create projects and populate them with files, but the real work of analysis has not yet begun. When you double-click a file in the Ghidra Project window, you are presented with the CodeBrowser window, shown in <a href="ch04.xhtml#fig4_9">Figure 4-9</a>. If this is your first time selecting one of the files you have imported, you will be presented with an option to allow Ghidra to auto analyze the file. An example of auto analysis using the Analysis Options dialog is shown in <a href="ch04.xhtml#fig4_10">Figure 4-10</a>. In the majority of cases <span epub:type="pagebreak" id="page_49"/>involving binaries taken from common platforms and built with commonly available compilers, auto analysis is probably the correct first choice. You can halt the auto analysis process at any time by clicking the red stop button at the bottom-right corner of the CodeBrowser window. (The button is visible only during auto analysis.)</p>
<div class="image"><img src="Images/fig4-9.jpg" alt="image" width="694" height="550"/></div>
<p class="figcap" id="fig4_9"><em>Figure 4-9: Ghidra CodeBrowser window</em></p>
<div class="image"><img src="Images/fig4-10.jpg" alt="image" width="694" height="393"/></div>
<p class="figcap" id="fig4_10"><em>Figure 4-10: The Analysis Options dialog</em></p>
<span epub:type="pagebreak" id="page_50"/>
<p class="indent">Keep in mind that if you are not happy with Ghidra’s auto analysis, you can always discard your work by closing the CodeBrowser and electing not to save your changes, at which point you may reopen the file and try a different combination of auto analysis options. The most common reasons for modifying your auto analysis options involve unusually structured files such as obfuscated binaries, or binaries built with compilers or on operating systems that may be unknown to Ghidra.</p>
<p class="indent">Note that if you are opening an extremely large binary (perhaps 10MB or larger), Ghidra may take minutes to hours to perform its auto analysis. In such cases, you may opt to disable or set an analysis time-out for some of the more demanding analyzers (for example, Decompiler Switch Analysis, Decompiler Parameter ID, and Stack). As shown in <a href="ch04.xhtml#fig4_10">Figure 4-10</a>, highlighting an analyzer will display a description of the analyzer, which may include useful warnings about the amount of time the analyzer may take to run. In addition, you will see the Options frame, which provides you an opportunity to control some behavioral aspects of the individual analyzers. Any analysis that you opt to disable or that times out can always be run later using the options available under Ghidra’s Analysis menu.</p>
<div class="box5">
<p class="boxtitle-c"><strong>AUTO ANALYSIS WARNINGS</strong></p>
<p class="noindent">Once a loader begins to analyze a file, it may encounter issues during analysis that it deems important enough to warn you about. One example of this occurs with PE files that have been built without an associated Program Database (PDB) file. In such cases, once analysis is complete, you will be presented with an Auto Analysis Summary dialog that includes a message summarizing any issues encountered (see <a href="ch04.xhtml#fig4_11">Figure 4-11</a>).</p>
<div class="image"><img src="Images/fig4-11.jpg" alt="image" width="616" height="162"/></div>
<p class="figcap" id="fig4_11"><em>Figure 4-11: Auto Analysis Summary dialog</em></p>
<p class="indent">In most cases, the messages are simply informational. In some cases, the messages are instructional, offering you suggestions for ways to resolve an issue, perhaps by installing an optional, third-party utility for Ghidra to make use of in the future.</p>
</div>
<p class="indent">After Ghidra has auto analyzed the file, you can see that the import summary information has been supplemented with new information about your file, as shown in <a href="ch04.xhtml#fig4_12">Figure 4-12</a>.</p>
<span epub:type="pagebreak" id="page_51"/>
<div class="image"><img src="Images/fig4-12.jpg" alt="image" width="694" height="807"/></div>
<p class="figcap" id="fig4_12"><em>Figure 4-12: Ghidra Help ▸ About ch4_example.exe view of import summary information</em></p>
<h4 class="h4" id="ch04lev57"><strong><em>Auto Analysis Results</em></strong></h4>
<p class="noindent">Ghidra’s auto analysis is carried out by running each of the selected analyzers over your newly loaded binary. The Analysis Options dialog, as well as Ghidra Help, offers descriptions of each analyzer. The default analyzers are chosen because Ghidra users have historically found them to be the most useful across a wide range of file types. In the sections that follow, we discuss some of the most useful information extracted from a binary file during its initial loading and subsequent auto analysis.</p>
<h5 class="h5" id="ch04lev58"><strong>Compiler Identification</strong></h5>
<p class="noindent">Identifying the compiler used to build a piece of software can help us understand function-calling conventions used in a binary as well as <span epub:type="pagebreak" id="page_52"/>determine which libraries the binary may be linked with. If the compiler can be identified when a file is loaded, Ghidra’s auto analysis will incorporate knowledge of behaviors specific to the identified compiler. Differences that you may observe when using different compilers and different compile time options are the focus of <a href="ch20.xhtml#ch20">Chapter 20</a>.</p>
<h5 class="h5" id="ch04lev59"><strong>Function Argument and Local Variable Identification</strong></h5>
<p class="noindent">Within each identified function (identified from symbol table entries and addresses that are targets of call instructions), Ghidra performs a detailed analysis of the behavior of the stack pointer register in order to both recognize accesses to variables located within the stack and understand the layout of the function’s stack frame. Names are automatically generated for such variables based on their use as either local variables within the function or as stack-allocated arguments passed into the function as part of the function call process. Stack frames are discussed further in <a href="ch06.xhtml#ch06">Chapter 6</a>.</p>
<h5 class="h5" id="ch04lev60"><strong>Data Type Information</strong></h5>
<p class="noindent">Ghidra uses its knowledge of common library functions and their associated parameters to identify functions, data types, and data structures used within each function. This information is added to the Symbol Tree and Data Type Manager windows as well as the Listing window. This process saves you a tremendous amount of time by providing information that would otherwise need to be manually retrieved and applied from various application programming interface (API) references. Detailed information about Ghidra’s handling of library functions and associated data types is discussed in <a href="ch08.xhtml#ch08">Chapter 8</a>.</p>
<h3 class="h3" id="ch04lev61"><strong>Desktop Behavior During Initial Analysis</strong></h3>
<p class="noindent">A tremendous amount of activity takes place within the CodeBrowser desktop during the initial analysis of a newly opened file. You can gain an understanding of this analysis by watching the analysis updates in the bottom right of the CodeBrowser window. This also keeps you updated on the progress of the analysis. If you are not an expert in speed reading, you can open the associated Ghidra log file and peruse the activities at a more leisurely pace. You can open the log file from the Ghidra Project window by selecting Help ▸ Show Log. (Note that the Show Log menu option is available only in the Ghidra Project ▸ Help menu, not in the CodeBrowser ▸ Help menu.)</p>
<p class="indent">The following output is from the log file generated by Ghidra during the auto analysis of <em>ch4_example.exe</em> and is representative of messages generated during the auto analysis process. The messages form a narrative of the analysis process and offer insight into the sequence of operations performed by Ghidra as well as the time required for each task during that analysis:</p>
<p class="programs">2019-09-23 15:38:26 INFO  (AutoAnalysisManager) -----------------------------<br/>
    ASCII Strings                              0.016 secs<br/>
    Apply Data Archives                        1.105 secs<br/>
<span epub:type="pagebreak" id="page_53"/>
    Call Convention Identification             0.018 secs<br/>
    Call-Fixup Installer                       0.000 secs<br/>
    Create Address Tables                      0.012 secs<br/>
    Create Function                            0.000 secs<br/>
    Data Reference                             0.014 secs<br/>
    Decompiler Parameter ID                    2.866 secs<br/>
    Decompiler Switch Analysis                 2.693 secs<br/>
    Demangler                                  0.004 secs<br/>
    Disassemble Entry Points                   0.016 secs<br/>
    Embedded Media                             0.031 secs<br/>
    External Entry References                  0.000 secs<br/>
    Function ID                                0.312 secs<br/>
    Function Start Search                      0.051 secs<br/>
    Function Start Search After Code           0.006 secs<br/>
    Function Start Search After Data           0.005 secs<br/>
    Non-Returning Functions - Discovered       0.062 secs<br/>
    Non-Returning Functions - Known            0.000 secs<br/>
    PDB                                        0.000 secs<br/>
    Reference                                  0.025 secs<br/>
    Scalar Operand References                  0.074 secs<br/>
    Shared Return Calls                        0.000 secs<br/>
    Stack                                      0.063 secs<br/>
    Subroutine References                      0.016 secs<br/>
    Windows x86 PE Exception Handling          0.000 secs<br/>
    Windows x86 PE RTTI Analyzer               0.000 secs<br/>
    WindowsResourceReference                   0.100 secs<br/>
    X86 Function Callee Purge                  0.001 secs<br/>
    x86 Constant Reference Analyzer            0.509 secs<br/>
-----------------------------------------------------<br/>
     Total Time   7 secs<br/>
-----------------------------------------------------<br/>
2019-09-23 15:38:26 DEBUG (ToolTaskManager)   task finish (8.128 secs)<br/>
2019-09-23 15:38:26 DEBUG (ToolTaskManager)   Queue - Auto Analysis<br/>
2019-09-23 15:38:26 DEBUG (ToolTaskManager)   (0.0 secs)<br/>
2019-09-23 15:38:26 DEBUG (ToolTaskManager)   task Complete (8.253 secs)</p>
<p class="indent">Even before the auto analysis has completed, you can begin navigating through the various data displays. When the auto analysis is complete, it is safe to make any changes you like to your project file.</p>
<h4 class="h4" id="ch04lev62"><strong><em>Saving Your Work and Exiting</em></strong></h4>
<p class="noindent">When you need to take a break from your analysis, it is a good idea to save your work. This is easy to accomplish in the CodeBrowser window in any of the following ways:</p>
<ul>
<li class="noindent">Use one of the Save options within the <strong>CodeBrowser File</strong> menu.</li>
<li class="noindent">Click the <strong>Save</strong> icon in the <strong>CodeBrowser</strong> toolbar.</li>
<li class="noindent">Close the <strong>CodeBrowser</strong> window.</li>
<li class="noindent">Save the project in the <strong>Ghidra</strong> window.</li>
<li class="noindent">Exit Ghidra through the <strong>Ghidra File</strong> menu.</li>
</ul>
<span epub:type="pagebreak" id="page_54"/>
<p class="indent">In each case, you will be prompted to save any modified files. More detailed information about changing the appearance and functionality of CodeBrowser and other Ghidra tools is discussed in <a href="ch12.xhtml#ch12">Chapter 12</a>.</p>
<h3 class="h3" id="ch04lev63"><strong>Ghidra Desktop Tips and Tricks</strong></h3>
<p class="noindent">Ghidra displays a tremendous amount of information, and its desktop can become cluttered. Here are some quick tips for making the best use of your desktop:</p>
<ul>
<li class="noindent">The more screen real estate you dedicate to Ghidra, the happier you will be. Use this fact to justify the purchase of a king-size monitor (or four)!</li>
<li class="noindent">Don’t forget to use the Window menu in the CodeBrowser as a means of opening new views or restoring data displays that you have inadvertently closed. Many windows can also be opened using tool buttons on the CodeBrowser toolbar.</li>
<li class="noindent">When you open a new window, it may appear in front of an existing window. When this happens, look for tabs at the top or bottom of windows that allow you to switch between them.</li>
<li class="noindent">You can close any window and reopen it as needed and drag it to a new location in the CodeBrowser desktop.</li>
<li class="noindent">The appearance of displays can be controlled using Edit ▸ Tool Options and locating the associated Display options.</li>
</ul>
<p class="indent">While these pointers are just the tip of the iceberg, they should be helpful as you begin to navigate the Ghidra CodeBrowser desktop. Additional CodeBrowser tips and tricks, including shortcuts and toolbar options, are discussed in <a href="ch05.xhtml#ch05">Chapter 5</a>.</p>
<h3 class="h3" id="ch04lev64"><strong>Summary</strong></h3>
<p class="noindent">Familiarity with the CodeBrowser desktop will greatly enhance your Ghidra experience. Reverse engineering binary code is difficult enough without having to struggle with your tools. The options you choose during the initial loading phase and the associated analysis performed by Ghidra set the stage for all of the analysis you will do later. At this point, you may be content with the work that Ghidra has accomplished on your behalf, and for simple binaries, this may be all that you need. On the other hand, if you wonder how you can gain additional control over your reverse engineering process, you are now ready to dive deeper into the functionality of Ghidra’s many data displays. In the coming chapters, you will be introduced to each of the primary displays, the circumstances under which you will find each one useful, and how to gain mastery of the tools and displays to optimize your workflow.</p>
</div>



  </body></html>