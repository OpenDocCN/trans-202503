<html><head></head><body>
<div id="sbo-rt-content" class="calibre1"><section aria-labelledby="ch2" epub:type="chapter" role="doc-chapter">
<hgroup>
<h2 class="title" id="ch2">
<span class="tpt"><span aria-label=" Page 19. " epub:type="pagebreak" id="pg_19" role="doc-pagebreak" class="calibre2"/><span class="sans_dogma_ot_bold_b_">2</span></span>
<span class="ct"><span class="sans_dogma_ot_bold_b_">PRINCIPLES OF DATA VISUALIZATION</span></span>
</h2>
</hgroup>
<figure class="opener"><img alt="" class="opener1" height="407" src="../images/chapter.jpg" width="407"/>
</figure>
<p class="cos">In the spring of 2021, nearly all of the American West was in a drought. Officials in Southern California declared a water emergency in April, citing unprecedented conditions. This probably didn’t come as news to residents of California and other western states. Drought conditions like those in the West in 2021 are becoming increasingly common, yet communicating the extent of the problem remains difficult. How can this data be presented in a way that is both accurate and compelling enough to get people to take notice?</p>
<p class="tx">Data visualization designers C<span class="copyright_accent">é</span>dric Scherer and Georgios Karamanis took on this challenge in the fall of 2021 to create a graph of US drought conditions over the last two decades for the magazine <i class="calibre4">Scientific American</i>. They turned to the <span class="sans_thesansmonocd_w5regular_">ggplot2</span> package to transform dry data (pardon the pun) <span aria-label=" Page 20. " epub:type="pagebreak" id="pg_20" role="doc-pagebreak"/>from the National Drought Center into a visually arresting and impactful visualization.</p>
<p class="tx">This chapter delves into why the data visualization that Scherer and Karamanis created is effective and introduces you to the <i class="calibre4">grammar of graphics</i>, a theory to make sense of graphs that underlies the <span class="sans_thesansmonocd_w5regular_">ggplot2</span> package. You’ll then learn how to use <span class="sans_thesansmonocd_w5regular_">ggplot2</span> by re-creating the drought graph step-by-step. In the process, I’ll highlight some key principles of high-quality data visualization that you can use to improve your own work.</p>
<section aria-labelledby="sec1" epub:type="division">
<h3 class="h1" id="sec1"><span id="h1-14"/><span class="sans_dogma_ot_bold_b_1">The Drought Visualization</span></h3>
<p class="tni">Other news organizations had relied on the same National Drought Center data in their stories, but Scherer and Karamanis visualized it so that it both grabs attention and communicates the scale of the phenomenon. <a href="chapter2.xhtml#fig2-1" class="calibre3">Figure 2-1</a> shows a section of the final visualization (due to space constraints, I could include only four regions). The graph makes apparent the increase in drought conditions over the last two decades, especially in California and the Southwest.</p>
<p class="tx">To understand why this visualization is effective, let’s break it down. At the broadest level, the data visualization is notable for its minimalist aesthetic. For example, there are no grid lines and few text labels, as well as minimal text along the axes. Scherer and Karamanis removed what statistician Edward Tufte, in his 1983 book <i class="calibre4">The Visual Display of Quantitative Information</i> (Graphics Press), calls <i class="calibre4">chartjunk</i>. Tufte wrote that extraneous elements often hinder, rather than help, our understanding of charts (and researchers and data visualization designers have generally agreed).</p>
<p class="tx">Need proof that Scherer and Karamanis’s decluttered graph is better than the alternative? <a href="chapter2.xhtml#fig2-2" class="calibre3">Figure 2-2</a> shows a version with a few tweaks to the code to include grid lines and text labels on axes.<span aria-label=" Page 21. " epub:type="pagebreak" id="pg_21" role="doc-pagebreak"/><span aria-label=" Page 22. " epub:type="pagebreak" id="pg_22" role="doc-pagebreak"/></p>
<figure class="img"><img alt="" class="img1" height="2240" id="fig2-1" src="../images/fig2-1.jpg" width="1283"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 2-1: A section of the final drought visualization, with a few tweaks made to fit this book</span></p></figcaption>
</figure>
<figure class="img"><img alt="" class="img1" height="2234" id="fig2-2" src="../images/fig2-2.jpg" width="1240"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 2-2: The cluttered version of the drought visualization</span></p></figcaption>
</figure>
<p class="tx"><span aria-label=" Page 23. " epub:type="pagebreak" id="pg_23" role="doc-pagebreak"/>It’s not just that this cluttered version looks worse; the clutter actively inhibits understanding. Rather than focusing on overall drought patterns (the point of the graph), our brains get stuck reading repetitive and unnecessary axis text.</p>
<p class="tx">One of the best ways to reduce clutter is to break a single chart into a set of component charts, as Scherer and Karamanis have done (this approach, known as <i class="calibre4">faceting</i>, will be discussed further in <span class="xref">“Faceting the Plot” on <a href="#pg_36" class="calibre3">page 36</a></span>). Each rectangle represents one region in one year. Filtering the larger chart to show the Southwest region in 2003 produces the graph shown in <a href="chapter2.xhtml#fig2-3" class="calibre3">Figure 2-3</a>, where the x-axis indicates the week and the y-axis indicates the percentage of that region at different drought levels.</p>
<figure class="img"><img alt="" class="img2" height="686" id="fig2-3" src="../images/fig2-3.jpg" width="880"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 2-3: A drought visualization for the Southwest in 2003</span></p></figcaption>
</figure>
<p class="tx">Zooming in on a single region in a single year also makes the color choices more obvious. The lightest orange bars (lightest gray as printed here) show the percentage of the region that is abnormally dry, and the darkest purple bars (darkest gray as printed) show the percentage experiencing exceptional drought conditions. As you’ll see shortly, this range of colors was intentionally chosen to make differences in the drought levels visible to all readers.</p>
<p class="tx">Despite the graph’s complexity, the R code that Scherer and Karamanis wrote to produce it is relatively simple, due largely to a theory called the <i class="calibre4">grammar of graphics</i>.</p>
</section>
<section aria-labelledby="sec2" epub:type="division">
<h3 class="h1" id="sec2"><span id="h1-15"/><span class="sans_dogma_ot_bold_b_1">The Grammar of Graphics</span></h3>
<p class="tni">When working in Excel, you begin by selecting the type of graph you want to make. Need a bar chart? Click the bar chart icon. Need a line chart? Click the line chart icon. If you’ve only ever made charts in Excel, this first step may seem so obvious that you’ve never even given the data visualization process <span aria-label=" Page 24. " epub:type="pagebreak" id="pg_24" role="doc-pagebreak"/>much thought, but in fact there are many ways to think about graphs. For example, rather than thinking of graph types as distinct, we can recognize and use their commonalities as the starting point for making them.</p>
<p class="tx">This approach to thinking about graphs comes from the late statistician Leland Wilkinson. For years, Wilkinson thought deeply about what data visualization is and how we can describe it. In 1999 he published a book called <i class="calibre4">The Grammar of Graphics</i> (Springer) that sought to develop a consistent way of describing all graphs. In it, Wilkinson argued that we should think of plots not as distinct types, <span class="copyright_accent">à</span> la Excel, but as following a grammar that we can use to describe <i class="calibre4">any</i> plot. Just as English grammar tells us that a noun is typically followed by a verb (which is why “he goes” works, while the opposite, “goes he,” does not), the grammar of graphics helps us understand why certain graph types “work.”</p>
<p class="tx">Thinking about data visualization through the lens of the grammar of graphics helps highlight, for example, that graphs typically have some data that is plotted on the x-axis and other data that is plotted on the y-axis. This is the case whether the graph is a bar chart or a line chart, as <a href="chapter2.xhtml#fig2-4" class="calibre3">Figure 2-4</a> shows.</p>
<figure class="img"><img alt="" class="img2" height="743" id="fig2-4" src="../images/fig2-4.jpg" width="851"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 2-4: A bar chart and a line chart showing identical data</span></p></figcaption>
</figure>
<p class="tx">While the graphs look different (and would, to the Excel user, be different types of graphs), Wilkinson’s grammar of graphics emphasizes their similarities. (Incidentally, Wilkinson’s feelings on graph-making tools like Excel became clear when he wrote that “most charting packages channel user requests into a rigid array of chart types.”)</p>
<p class="tx">When Wilkinson wrote his book, no data visualization tool could implement his grammar of graphics. This would change in 2010, when Hadley Wickham announced the <span class="sans_thesansmonocd_w5regular_">ggplot2</span> package for R in the article “A Layered Grammar of Graphics,” published in the <i class="calibre4">Journal of Computational and</i> <span aria-label=" Page 25. " epub:type="pagebreak" id="pg_25" role="doc-pagebreak"/><i class="calibre4">Graphical Statistics</i>. By providing the tools to implement Wilkinson’s ideas, <span class="sans_thesansmonocd_w5regular_">ggplot2</span> would come to revolutionize the world of data visualization.</p>
</section>
<section aria-labelledby="sec3" epub:type="division">
<h3 class="h1" id="sec3"><span id="h1-16"/><span class="sans_dogma_ot_bold_b_1">Working with ggplot</span></h3>
<p class="tni">The <span class="sans_thesansmonocd_w5regular_">ggplot2</span> R package (which I, like nearly everyone in the data visualization world, will refer to simply as <i class="calibre4">ggplot</i>) relies on the idea of plots having multiple layers. This section will walk you through some of the most important ones. You’ll begin by selecting variables to map to aesthetic properties. Then you’ll choose a geometric object to use to represent your data. Next, you’ll change the aesthetic properties of your chart (its color scheme, for example) using a <span class="sans_thesansmonocd_w5regular_">scale_</span> function. Finally, you’ll use a <span class="sans_thesansmonocd_w5regular_">theme_</span> function to set the overall look and feel of your plot.</p>
<section aria-labelledby="sec4" epub:type="division">
<h4 class="h2" id="sec4"><span id="h2-11"/><span class="sans_futura_std_heavy_oblique_bi_">Mapping Data to Aesthetic Properties</span></h4>
<p class="tni">To create a graph with ggplot, you begin by mapping data to aesthetic properties. All this really means is that you use elements like the x- or y-axis, color, and size (the so-called <i class="calibre4">aesthetic properties</i>) to represent variables. You’ll use the data on life expectancy in Afghanistan, introduced in <a href="chapter2.xhtml#fig2-4" class="calibre3">Figure 2-4</a>, to generate a plot. To access this data, enter the following code:</p>
<pre id="pre-23" class="calibre10"><code class="calibre11"><b class="calibre9">library(tidyverse)</b>

<b class="calibre9">gapminder_10_rows &lt;- read_csv("https://data.rfortherestofus.com/data/gapminder_10_rows.csv")</b>
</code></pre>
<p class="tx">This code first loads the <span class="sans_thesansmonocd_w5regular_">tidyverse</span> package, introduced in <span class="xref"><a href="chapter1.xhtml" class="calibre3">Chapter 1</a></span>, and then uses the <span class="sans_thesansmonocd_w5regular_">read_csv()</span> function to access data from the book’s website and assign it to the <span class="sans_thesansmonocd_w5regular_">gapminder_10_rows</span> object.</p>
<p class="tx">The resulting <span class="sans_thesansmonocd_w5regular_">gapminder_10_rows</span> tibble looks like this:</p>
<pre id="pre-24" class="calibre10"><code class="calibre11">#&gt; # A tibble: 10 × 6
#&gt;    country     continent  year lifeExp      pop gdpPercap
#&gt;    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;    &lt;dbl&gt;
#&gt;  1 Afghanistan Asia       1952    28.8  8425333      779.
#&gt;  2 Afghanistan Asia       1957    30.3  9240934      821.
#&gt;  3 Afghanistan Asia       1962    32.0 10267083      853.
#&gt;  4 Afghanistan Asia       1967    34.0 11537966      836.
#&gt;  5 Afghanistan Asia       1972    36.1 13079460      740.
#&gt;  6 Afghanistan Asia       1977    38.4 14880372      786.
#&gt;  7 Afghanistan Asia       1982    39.9 12881816      978.
#&gt;  8 Afghanistan Asia       1987    40.8 13867957      852.
#&gt;  9 Afghanistan Asia       1992    41.7 16317921      649.
#&gt; 10 Afghanistan Asia       1997    41.8 22227415      635.
</code></pre>
<p class="tx">This output is a shortened version of the full <span class="sans_thesansmonocd_w5regular_">gapminder</span> data frame, which includes over 1,700 rows of data.</p>
<p class="tx">Before making a chart with ggplot, you need to decide which variable to put on the x-axis and which to put on the y-axis. For data showing change over time, it’s common to put the date (in this case, <span class="sans_thesansmonocd_w5regular_">year</span>) on the <span aria-label=" Page 26. " epub:type="pagebreak" id="pg_26" role="doc-pagebreak"/>x-axis and the changing value (in this case, <span class="sans_thesansmonocd_w5regular_">lifeExp</span>) on the y-axis. To do so, define the <span class="sans_thesansmonocd_w5regular_">ggplot()</span> function as follows:</p>
<pre id="pre-25" class="calibre10"><code class="calibre11">ggplot(
  data = gapminder_10_rows,
  mapping = aes(
    x = year,
    y = lifeExp
  )
)
</code></pre>
<p class="tx">This function contains numerous arguments. Each argument goes on its own line, for the sake of readability, separated by commas. The <span class="sans_thesansmonocd_w5regular_">data</span> argument tells R to use the data frame <span class="sans_thesansmonocd_w5regular_">gapminder_10_rows</span>, and the <span class="sans_thesansmonocd_w5regular_">mapping</span> argument maps <span class="sans_thesansmonocd_w5regular_">year</span> to the x-axis and <span class="sans_thesansmonocd_w5regular_">lifeExp</span> to the y-axis.</p>
<p class="tx">Running this code produces the chart in <a href="chapter2.xhtml#fig2-5" class="calibre3">Figure 2-5</a>, which doesn’t look like much yet.</p>
<figure class="img"><img alt="" class="img2" height="752" id="fig2-5" src="../images/fig2-5.jpg" width="880"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 2-5: A blank chart that maps year values to the x-axis and life expectancy values to the y-axis</span></p></figcaption>
</figure>
<p class="tx">Notice that the x-axis corresponds to <span class="sans_thesansmonocd_w5regular_">year</span> and the y-axis corresponds to <span class="sans_thesansmonocd_w5regular_">lifeExp</span>, and the values on both axes match the scope of the data. In the <span class="sans_thesansmonocd_w5regular_">gapminder_10_rows</span> data frame, the first year is 1952 and the last year is 1997. The range of the x-axis has been created with this data in mind. Likewise, the values for <span class="sans_thesansmonocd_w5regular_">lifeExp</span>, which go from about 28 to about 42, will fit nicely on the y-axis.</p>
</section>
<section aria-labelledby="sec5" epub:type="division">
<h4 class="h2" id="sec5"><span id="h2-12"/><span class="sans_futura_std_heavy_oblique_bi_">Choosing the Geometric Objects</span></h4>
<p class="tni">Axes are nice, but the graph is missing any type of visual representation of the data. To get this, you need to add the next ggplot layer: geoms. Short for <i class="calibre4">geometric objects</i>, <i class="calibre4">geoms</i> are functions that provide different ways <span aria-label=" Page 27. " epub:type="pagebreak" id="pg_27" role="doc-pagebreak"/>of representing data. For example, to add points to the graph, you use <span class="sans_thesansmonocd_w5regular_">geom_point()</span>:</p>
<pre id="pre-26" class="calibre10"><code class="calibre11">ggplot(
  data = gapminder_10_rows,
  mapping = aes(
    x = year,
    y = lifeExp
  )
) +
<b class="calibre9">  geom_point()</b>
</code></pre>
<p class="tx">Now the graph shows that people in 1952 had a life expectancy of about 28 and that this value rose every year in the dataset (see <a href="chapter2.xhtml#fig2-6" class="calibre3">Figure 2-6</a>).</p>
<figure class="img"><img alt="" class="img2" height="751" id="fig2-6" src="../images/fig2-6.jpg" width="880"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 2-6: The life expectancy chart with points added</span></p></figcaption>
</figure>
<p class="tx">Say you change your mind and want to make a line chart instead. All you have to do is replace <span class="sans_thesansmonocd_w5regular_">geom_point()</span> with <span class="sans_thesansmonocd_w5regular_">geom_line()</span> like so:</p>
<pre id="pre-27" class="calibre10"><code class="calibre11">ggplot(
  data = gapminder_10_rows,
  mapping = aes(
    x = year,
    y = lifeExp
  )
) +
<b class="calibre9">  geom_line()</b>
</code></pre>
<p class="tx"><a href="chapter2.xhtml#fig2-7" class="calibre3">Figure 2-7</a> shows the result.<span aria-label=" Page 28. " epub:type="pagebreak" id="pg_28" role="doc-pagebreak"/></p>
<figure class="img"><img alt="" class="img2" height="745" id="fig2-7" src="../images/fig2-7.jpg" width="880"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 2-7: The same data as a line chart</span></p></figcaption>
</figure>
<p class="tx">To really get fancy, you could add both <span class="sans_thesansmonocd_w5regular_">geom_point()</span> and <span class="sans_thesansmonocd_w5regular_">geom_line()</span> as follows:</p>
<pre id="pre-28" class="calibre10"><code class="calibre11">ggplot(
  data = gapminder_10_rows,
  mapping = aes(
    x = year,
    y = lifeExp
  )
) +
<b class="calibre9">  geom_point() +</b>
<b class="calibre9">  geom_line()</b>
</code></pre>
<p class="tx">This code generates a line chart with points, as shown in <a href="chapter2.xhtml#fig2-8" class="calibre3">Figure 2-8</a>.</p>
<figure class="img"><img alt="" class="img2" height="750" id="fig2-8" src="../images/fig2-8.jpg" width="880"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 2-8: The same data with both points and a line</span></p></figcaption>
</figure>
<p class="tx"><span aria-label=" Page 29. " epub:type="pagebreak" id="pg_29" role="doc-pagebreak"/>You can swap in <span class="sans_thesansmonocd_w5regular_">geom_col()</span> to create a bar chart:</p>
<pre id="pre-29" class="calibre10"><code class="calibre11">ggplot(
  data = gapminder_10_rows,
  mapping = aes(
    x = year,
    y = lifeExp
  )
) +
<b class="calibre9">  geom_col()</b>
</code></pre>
<p class="tx">Notice in <a href="chapter2.xhtml#fig2-9" class="calibre3">Figure 2-9</a> that the y-axis range has been automatically updated, going from 0 to 40 to account for the different geom.</p>
<figure class="img"><img alt="" class="img2" height="743" id="fig2-9" src="../images/fig2-9.jpg" width="872"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 2-9: The life expectancy data as a bar chart</span></p></figcaption>
</figure>
<p class="tx">As you can see, the difference between a line chart and a bar chart isn’t as great as the Excel chart-type picker might have you believe. Both can have the same underlying properties (namely, years on the x-axis and life expectancies on the y-axis). They simply use different geometric objects to visually represent the data.</p>
<p class="tx">Many geoms are built into ggplot. In addition to <span class="sans_thesansmonocd_w5regular_">geom_bar()</span>, <span class="sans_thesansmonocd_w5regular_">geom_point()</span>, and <span class="sans_thesansmonocd_w5regular_">geom_line()</span>, the geoms <span class="sans_thesansmonocd_w5regular_">geom_histogram()</span>, <span class="sans_thesansmonocd_w5regular_">geom_boxplot()</span>, and <span class="sans_thesansmonocd_w5regular_">geom_area()</span> are among the most commonly used. To see all geoms, visit the ggplot documentation website at <i class="calibre4"><a href="https://ggplot2.tidyverse.org/reference/index.xhtml#geoms" class="calibre3">https://ggplot2.tidyverse.org/reference/index.xhtml#geoms</a></i>.</p>
</section>
<section aria-labelledby="sec6" epub:type="division">
<h4 class="h2" id="sec6"><span id="h2-13"/><span class="sans_futura_std_heavy_oblique_bi_">Altering Aesthetic Properties</span></h4>
<p class="tni">Before we return to the drought data visualization, let’s look at a few additional layers you can use to alter the bar chart. Say you want to change the color of the bars. In the grammar of graphics approach to chart-making, this means mapping some variable to the aesthetic property of <span class="sans_thesansmonocd_w5regular_">fill</span>. (For a bar chart, the aesthetic property of <span class="sans_thesansmonocd_w5regular_">color</span> would change only the outline of <span aria-label=" Page 30. " epub:type="pagebreak" id="pg_30" role="doc-pagebreak"/>each bar.) In the same way that you mapped <span class="sans_thesansmonocd_w5regular_">year</span> to the x-axis and <span class="sans_thesansmonocd_w5regular_">lifeExp</span> to the y-axis, you can map <span class="sans_thesansmonocd_w5regular_">fill</span> to a variable, such as <span class="sans_thesansmonocd_w5regular_">year</span>:</p>
<pre id="pre-30" class="calibre10"><code class="calibre11">ggplot(
  data = gapminder_10_rows,
  mapping = aes(
    x = year,
    y = lifeExp,
<b class="calibre9">    fill = year</b>
  )
) +
  geom_col()
</code></pre>
<p class="tx"><a href="chapter2.xhtml#fig2-10" class="calibre3">Figure 2-10</a> shows the result. Now the fill is darker for earlier years and lighter for later years (as also indicated by the legend, added to the right of the plot).</p>
<figure class="img"><img alt="" class="img2" height="744" id="fig2-10" src="../images/fig2-10.jpg" width="856"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 2-10: The same chart, now with added colors</span></p></figcaption>
</figure>
<p class="tx">To change the fill colors, use a new scale layer with the <span class="sans_thesansmonocd_w5regular_">scale_fill_viridis_c()</span> function (the <span class="sans_thesansmonocd_w5regular_">c</span> at the end of the function name refers to the fact that the data is continuous, meaning it can take any numeric value):</p>
<pre id="pre-31" class="calibre10"><code class="calibre11">ggplot(
  data = gapminder_10_rows,
  mapping = aes(
    x = year,
    y = lifeExp,
    fill = year
  )
) +
  geom_col() +
<b class="calibre9">  scale_fill_viridis_c()</b>
</code></pre>
<p class="tx"><span aria-label=" Page 31. " epub:type="pagebreak" id="pg_31" role="doc-pagebreak"/>This function changes the default palette to one that is colorblind-friendly and prints well in grayscale. The <span class="sans_thesansmonocd_w5regular_">scale_fill_viridis_c()</span> function is just one of many that start with <span class="sans_thesansmonocd_w5regular_">scale_</span> and can alter the fill scale. <a href="chapter11.xhtml" class="calibre3">Chapter 11</a> of <i class="calibre4">ggplot2: Elegant Graphics for Data Analysis</i>, 3rd edition, discusses various color and fill scales. You can read it online at <i class="calibre4"><a href="https://ggplot2-book.org/scales-colour.xhtml" class="calibre3">https://ggplot2-book.org/scales-colour.xhtml</a></i>.</p>
</section>
<section aria-labelledby="sec7" epub:type="division">
<h4 class="h2" id="sec7"><span id="h2-14"/><span class="sans_futura_std_heavy_oblique_bi_">Setting a Theme</span></h4>
<p class="tni">The final layer we’ll look at is the theme layer, which allows you to change the overall look and feel of your plots (including their background and grid lines). As with the <span class="sans_thesansmonocd_w5regular_">scale_</span> functions, a number of functions also start with <span class="sans_thesansmonocd_w5regular_">theme_</span>. Add <span class="sans_thesansmonocd_w5regular_">theme_minimal()</span> as follows:</p>
<pre id="pre-32" class="calibre10"><code class="calibre11">ggplot(
  data = gapminder_10_rows,
  mapping = aes(
    x = year,
    y = lifeExp,
    fill = year
  )
) +
  geom_col() +
  scale_fill_viridis_c() +
<b class="calibre9">  theme_minimal()</b>
</code></pre>
<p class="tx">This theme starts to declutter the plot, as you can see in <a href="chapter2.xhtml#fig2-11" class="calibre3">Figure 2-11</a>.</p>
<figure class="img"><img alt="" class="img2" height="743" id="fig2-11" src="../images/fig2-11.jpg" width="856"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 2-11: The same chart with theme_minimal() added</span></p></figcaption>
</figure>
<p class="tx">By now, you should see why Hadley Wickham described the <span class="sans_thesansmonocd_w5regular_">ggplot2</span> package as using a layered grammar of graphics. It implements Wilkinson’s theory by creating multiple layers: first, variables to map to aesthetic properties; second, geoms to represent the data; third, the <span class="sans_thesansmonocd_w5regular_">scale_</span> function to <span aria-label=" Page 32. " epub:type="pagebreak" id="pg_32" role="doc-pagebreak"/>adjust aesthetic properties; and finally, the <span class="sans_thesansmonocd_w5regular_">theme_</span> function to set the plot’s overall look and feel.</p>
<p class="tx">You could still improve this plot in many ways, but instead let’s return to the drought data visualization by Scherer and Karamanis. By walking through their code, you’ll learn about making high-quality data visualization with ggplot and R.</p>
</section>
</section>
<section aria-labelledby="sec8" epub:type="division">
<h3 class="h1" id="sec8"><span id="h1-17"/><span class="sans_dogma_ot_bold_b_1">Re-creating the Drought Visualization</span></h3>
<p class="tni">The drought visualization code relies on a combination of ggplot fundamentals and some lesser-known tweaks that make it really shine. To understand how Scherer and Karamanis made their data visualization, we’ll start with a simplified version of their code, then build it up layer by layer, adding elements as we go.</p>
<p class="tx">First, you’ll import the data. Scherer and Karamanis did a bunch of data wrangling on the raw data, but I’ve saved the simplified output for you. Because it’s in JavaScript Object Notation (JSON) format, Scherer and Karamanis use the <span class="sans_thesansmonocd_w5regular_">import()</span> function from the <span class="sans_thesansmonocd_w5regular_">rio</span> package, which simplifies the process of importing JSON data:</p>
<pre id="pre-33" class="calibre10"><code class="calibre11"><b class="calibre9">library(rio)</b>

<b class="calibre9">dm_perc_cat_hubs &lt;- import("https://data.rfortherestofus.com/dm_perc_cat_hubs.json"))</b>
</code></pre>
<p class="tx"><i class="calibre4">JSON</i> is a common format for data used in web applications, though it’s far less common in R, where it can be complicated to work with. Luckily, the <span class="sans_thesansmonocd_w5regular_">rio</span> package simplifies its import.</p>
<section aria-labelledby="sec9" epub:type="division">
<h4 class="h2" id="sec9"><span id="h2-15"/><span class="sans_futura_std_heavy_oblique_bi_">Plotting One Region and Year</span></h4>
<p class="tni">Scherer and Karamanis’s final plot consists of many years and regions. To see how they created it, we’ll start by looking at just the Southwest region in 2003.</p>
<p class="tx">First, you need to create a data frame. You’ll use the <span class="sans_thesansmonocd_w5regular_">filter()</span> function twice: the first time to keep only data for the Southwest region, and the second time to keep only data from 2003. In both cases, you use the following syntax:</p>
<pre id="pre-34" class="calibre10"><code class="calibre11">filter(<var class="calibre14">variable_name == value</var>)
</code></pre>
<p class="tx">This tells R to keep only observations where <span class="sans_thesansmonocd_w5regular_italic_i_">variable_name</span> is equal to some <span class="sans_thesansmonocd_w5regular_italic_i_">value</span>. The code starts with the <span class="sans_thesansmonocd_w5regular_">dm_perc_cat_hubs_raw</span> data frame before filtering it and then saving it as a new object called <span class="sans_thesansmonocd_w5regular_">southwest_2003</span>:</p>
<pre id="pre-35" class="calibre10"><code class="calibre11">southwest_2003 &lt;- dm_perc_cat_hubs %&gt;%
  filter(hub == "Southwest") %&gt;%
  filter(year == 2003)
</code></pre>
<p class="tx"><span aria-label=" Page 33. " epub:type="pagebreak" id="pg_33" role="doc-pagebreak"/>To take a look at this object and see the variables you have to work with, enter <span class="sans_thesansmonocd_w7bold_b_">southwest_2003</span> in the console, which should return this output:</p>
<pre id="pre-36" class="calibre10"><code class="calibre11">#&gt; # A tibble: 255 × 7
#&gt;    date       hub  category  percentage  year  week max_week
#&gt;    &lt;date&gt;    &lt;fct&gt; &lt;fct&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
#&gt;  1 2003-12-30 Sout... D0           0.0718  2003    52       52
#&gt;  2 2003-12-30 Sout... D1           0.0828  2003    52       52
#&gt;  3 2003-12-30 Sout... D2           0.2693  2003    52       52
#&gt;  4 2003-12-30 Sout... D3           0.3108  2003    52       52
#&gt;  5 2003-12-30 Sout... D4           0.0796  2003    52       52
#&gt;  6 2003-12-23 Sout... D0           0.0823  2003    51       52
#&gt;  7 2003-12-23 Sout... D1           0.1312  2003    51       52
#&gt;  8 2003-12-23 Sout... D2           0.1886  2003    51       52
#&gt;  9 2003-12-23 Sout... D3           0.3822  2003    51       52
#&gt; 10 2003-12-23 Sout... D4           0.0828  2003    51       52
#&gt; # 245 more rows
</code></pre>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">date</span> variable represents the start date of the week in which the observation took place. The <span class="sans_thesansmonocd_w5regular_">hub</span> variable is the region, and <span class="sans_thesansmonocd_w5regular_">category</span> is the level of drought: a value of <span class="sans_thesansmonocd_w5regular_">D0</span> indicates the lowest level of drought, while <span class="sans_thesansmonocd_w5regular_">D5</span> indicates the highest level. The <span class="sans_thesansmonocd_w5regular_">percentage</span> variable is the percentage of that region in that drought category, ranging from <span class="sans_thesansmonocd_w5regular_">0</span> to <span class="sans_thesansmonocd_w5regular_">1</span>. The <span class="sans_thesansmonocd_w5regular_">year</span> and <span class="sans_thesansmonocd_w5regular_">week</span> variables are the observation year and week number (beginning with week 1). The <span class="sans_thesansmonocd_w5regular_">max_week</span> variable is the maximum number of weeks in a given year.</p>
<p class="tx">Now you can use this <span class="sans_thesansmonocd_w5regular_">southwest_2003</span> object for your plot:</p>
<pre id="pre-37" class="calibre10"><code class="calibre11">ggplot(
  data = <b class="calibre9">southwest_2003</b>,
  aes(
    x = week,
    y = percentage,
    fill = category
  )
) +
  geom_col()
</code></pre>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">ggplot()</span> function tells R to put <span class="sans_thesansmonocd_w5regular_">week</span> on the x-axis and <span class="sans_thesansmonocd_w5regular_">percentage</span> on the y-axis, as well as to use the <span class="sans_thesansmonocd_w5regular_">category</span> variable for the <span class="sans_thesansmonocd_w5regular_">fill</span> color. The <span class="sans_thesansmonocd_w5regular_">geom_col()</span> function creates a bar chart in which each bar’s <span class="sans_thesansmonocd_w5regular_">fill</span> color represents the percentage of the region at each drought level for that particular week, as shown in <a href="chapter2.xhtml#fig2-12" class="calibre3">Figure 2-12</a>.<span aria-label=" Page 34. " epub:type="pagebreak" id="pg_34" role="doc-pagebreak"/></p>
<figure class="img"><img alt="" class="img2" height="744" id="fig2-12" src="../images/fig2-12.jpg" width="864"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 2-12: One year (2003) and region (Southwest) of the drought visualization</span></p></figcaption>
</figure>
<p class="tx">The colors, which include bright pinks, blues, greens, and reds (displayed in grayscale here), don’t match the final version of the plot, but you can start to see the outlines of Scherer and Karamanis’s data visualization.</p>
</section>
<section aria-labelledby="sec10" epub:type="division">
<h4 class="h2" id="sec10"><span id="h2-16"/><span class="sans_futura_std_heavy_oblique_bi_">Changing Aesthetic Properties</span></h4>
<p class="tni">Scherer and Karamanis next selected different <span class="sans_thesansmonocd_w5regular_">fill</span> colors for their bars. To do so, they used the <span class="sans_thesansmonocd_w5regular_">scale_fill_viridis_d()</span> function. The <i class="calibre4">d</i> here means that the data to which the fill scale is being applied has discrete categories (D0, D1, D2, D3, D4, and D5):</p>
<pre id="pre-38" class="calibre10"><code class="calibre11">ggplot(
  data = southwest_2003,
  aes(
    x = week,
    y = percentage,
    fill = category
  )
) +
  geom_col() +
  <b class="calibre9">scale_fill_viridis_d(</b>
<b class="calibre9">    option = "rocket",</b>
<b class="calibre9">    direction = -1</b>
<b class="calibre9">  )</b>
</code></pre>
<p class="tx">They used the argument <span class="sans_thesansmonocd_w5regular_">option = "rocket"</span> to select the rocket palette, whose colors range from cream to nearly black. You could use several other palettes within the <span class="sans_thesansmonocd_w5regular_">scale_fill_viridis_d()</span> function; see them at <i class="calibre4"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.xhtml" class="calibre3">https://sjmgarnier.github.io/viridisLite/reference/viridis.xhtml</a></i>.</p>
<p class="tx">Then they used the <span class="sans_thesansmonocd_w5regular_">direction = -1</span> argument to reverse the order of fill colors so that darker colors mean higher drought conditions.</p>
<p class="tx"><span aria-label=" Page 35. " epub:type="pagebreak" id="pg_35" role="doc-pagebreak"/>Scherer and Karamanis also tweaked the appearance of the x- and y-axes:</p>
<pre id="pre-39" class="calibre10"><code class="calibre11">ggplot(
  data = southwest_2003,
  aes(
    x = week,
    y = percentage,
    fill = category
  )) +
  geom_col() +
  scale_fill_viridis_d(
    option = "rocket",
    direction = -1
  ) +
<b class="calibre9">  scale_x_continuous(</b>
<b class="calibre9">    name = NULL,</b>
<b class="calibre9">    guide = "none"</b>
<b class="calibre9">  ) +</b>
<b class="calibre9">  scale_y_continuous(</b>
<b class="calibre9">    name = NULL,</b>
<b class="calibre9">    labels = NULL,</b>
<b class="calibre9">    position = "right"</b>
<b class="calibre9">  )</b>
</code></pre>
<p class="tx">On the x-axis, they removed both the axis title (“week”) using <span class="sans_thesansmonocd_w5regular_">name = NULL</span> and the axis labels (the weeks numbered 0 to 50) with <span class="sans_thesansmonocd_w5regular_">guide = "none"</span>. On the y-axis, they removed the title and text showing percentages using <span class="sans_thesansmonocd_w5regular_">labels = NULL</span>, which functionally does the same thing as <span class="sans_thesansmonocd_w5regular_">guide = "none"</span>. They also moved the axis lines themselves to the right side using <span class="sans_thesansmonocd_w5regular_">position = "right"</span>. These axis lines are apparent only as tick marks at this point but will become more visible later. <a href="chapter2.xhtml#fig2-13" class="calibre3">Figure 2-13</a> shows the result of these tweaks.</p>
<figure class="img"><img alt="" class="img2" height="744" id="fig2-13" src="../images/fig2-13.jpg" width="857"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 2-13: The 2003 drought data for the Southwest with adjustments to the x- and y-axes</span></p></figcaption>
</figure>
<p class="tx"><span aria-label=" Page 36. " epub:type="pagebreak" id="pg_36" role="doc-pagebreak"/>Up to this point, we’ve focused on one of the single plots that make up the larger data visualization. But the final product that Scherer and Karamanis made is actually 176 plots visualizing 22 years and 8 regions. Let’s discuss the ggplot feature they used to create all of these plots.</p>
</section>
<section aria-labelledby="sec11" epub:type="division">
<h4 class="h2" id="sec11"><span id="h2-17"/><span class="sans_futura_std_heavy_oblique_bi_">Faceting the Plot</span></h4>
<p class="tni">One of ggplot’s most useful capabilities is <i class="calibre4">faceting</i> (or, as it’s more commonly known in the data visualization world, <i class="calibre4">small multiples</i>). Faceting uses a variable to break down a single plot into multiple plots. For example, think of a line chart showing life expectancy by country over time; instead of multiple lines on one plot, faceting would create multiple plots with one line per plot. To specify which variable to put in the rows and which to put in the columns of your faceted plot, you use the <span class="sans_thesansmonocd_w5regular_">facet_grid()</span> function, as Scherer and Karamanis did in their code:</p>
<pre id="pre-40" class="calibre10"><code class="calibre11">dm_perc_cat_hubs %&gt;%
  filter(hub %in% c(
    "Northwest",
    "California",
    "Southwest",
    "Northern Plains"
  )) %&gt;%
  ggplot(aes(
    x = week,
    y = percentage,
    fill = category
  )) +
  geom_col() +
  scale_fill_viridis_d(
    option = "rocket",
    direction = -1
  ) +
  scale_x_continuous(
    name = NULL,
    guide = "none"
  ) +
  scale_y_continuous(
    name = NULL,
    labels = NULL,
    position = "right"
  ) +
<b class="calibre9">  facet_grid(</b>
<b class="calibre9">    rows = vars(year),</b>
<b class="calibre9">    cols = vars(hub),</b>
<b class="calibre9">    switch = "y"</b>
<b class="calibre9">  )</b>
</code></pre>
<p class="tx">Scherer and Karamanis put <span class="sans_thesansmonocd_w5regular_">year</span> in rows and <span class="sans_thesansmonocd_w5regular_">hub</span> (region) in columns. The <span class="sans_thesansmonocd_w5regular_">switch = "y"</span> argument moves the year label from the right side (where it appears by default) to the left. With this code in place, you can see the final plot coming together in <a href="chapter2.xhtml#fig2-14" class="calibre3">Figure 2-14</a>.<span aria-label=" Page 37. " epub:type="pagebreak" id="pg_37" role="doc-pagebreak"/></p>
<figure class="img"><img alt="" class="img2" height="2359" id="fig2-14" src="../images/fig2-14.jpg" width="1344"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 2-14: The faceted version of the drought visualization</span></p></figcaption>
</figure>
<p class="tx"><span aria-label=" Page 38. " epub:type="pagebreak" id="pg_38" role="doc-pagebreak"/>Incredibly, the broad outlines of the plot took just 10 lines of code to create. The rest of the code falls into the category of small polishes. That’s not to minimize how important small polishes are (very) or the time it takes to create them (a lot). It does show, however, that a little bit of ggplot goes a long way.</p>
</section>
<section aria-labelledby="sec12" epub:type="division">
<h4 class="h2" id="sec12"><span id="h2-18"/><span class="sans_futura_std_heavy_oblique_bi_">Adding Final Polishes</span></h4>
<p class="tni">Now let’s look at a few of the small polishes that Scherer and Karamanis made. The first is to apply a theme. They used <span class="sans_thesansmonocd_w5regular_">theme_light()</span>, which removes the default gray background and changes the font to Roboto using the <span class="sans_thesansmonocd_w5regular_">base_family</span> argument.</p>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">theme_light()</span> function is what’s known as a <i class="calibre4">complete theme</i>, one that changes the overall look and feel of a plot. The ggplot package has multiple complete themes that you can use (they’re listed at <i class="calibre4"><a href="https://ggplot2.tidyverse.org/reference/index.xhtml#themes" class="calibre3">https://ggplot2.tidyverse.org/reference/index.xhtml#themes</a></i>). Individuals and organizations also make their own themes, as you’ll do in <span class="xref"><a href="chapter3.xhtml" class="calibre3">Chapter 3</a></span>. For a discussion of which themes you might consider using, see my blog post at <i class="calibre4"><a href="https://rfortherestofus.com/2019/08/themes-to-improve-your-ggplot-figures" class="calibre3">https://rfortherestofus.com/2019/08/themes-to-improve-your-ggplot-figures</a></i>.</p>
<p class="tx">Scherer and Karamanis didn’t stop by simply applying <span class="sans_thesansmonocd_w5regular_">theme_light()</span>. They also used the <span class="sans_thesansmonocd_w5regular_">theme()</span> function to make additional tweaks to the plot’s design:</p>
<pre id="pre-41" class="calibre10"><code class="calibre11">dm_perc_cat_hubs %&gt;%
  filter(hub %in% c(
    "Northwest",
    "California",
    "Southwest",
    "Northern Plains"
  )) %&gt;%
  ggplot(aes(
    x = week,
    y = percentage,
    fill = category
  )) +
  geom_rect(
    aes(
      xmin = .5,
      xmax = max_week + .5,
      ymin = -0.005,
      ymax = 1
    ),
    fill = "#f4f4f9",
    color = NA,
    size = 0.4
  ) +
  geom_col() +
  scale_fill_viridis_d(
    option = "rocket",
    direction = -1
  ) +
  scale_x_continuous(
<span aria-label=" Page 39. " epub:type="pagebreak" id="pg_39" role="doc-pagebreak"/>    name = NULL,
    guide = "none"
  ) +
  scale_y_continuous(
    name = NULL,
    labels = NULL,
    position = "right"
  ) +
  facet_grid(
    rows = vars(year),
    cols = vars(hub),
    switch = "y"
  ) +
  theme_light(base_family = "Roboto") +
  theme(
    axis.title = element_text(
      size = 14,
      color = "black"
    ),
    axis.text = element_text(
      family = "Roboto Mono",
      size = 11
    ),
  <span aria-label="annotation1" class="code_codeannotation">❶</span> axis.line.x = element_blank(),
    axis.line.y = element_line(
      color = "black",
      size = .2
    ),
    axis.ticks.y = element_line(
      color = "black",
      size = .2
    ),
    axis.ticks.length.y = unit(2, "mm"),
  <span aria-label="annotation2" class="code_codeannotation">❷</span> legend.position = "top",
    legend.title = element_text(
      color = "#2DAADA",
      face = "bold"
    ),
    legend.text = element_text(color = "#2DAADA"),
    strip.text.x = element_text(
      hjust = .5,
      face = "plain",
      color = "black",
      margin = margin(t = 20, b = 5)
    ),
    strip.text.y.left = element_text(
    <span aria-label="annotation3" class="code_codeannotation">❸</span> angle = 0,
      vjust = .5,
      face = "plain",
      color = "black"
    ),
    strip.background = element_rect(
      fill = "transparent",
      color = "transparent"
    ),
<span aria-label=" Page 40. " epub:type="pagebreak" id="pg_40" role="doc-pagebreak"/>  <span aria-label="annotation4" class="code_codeannotation">❹</span> panel.grid.minor = element_blank(),
    panel.grid.major = element_blank(),
    panel.spacing.x = unit(0.3, "lines"),
    panel.spacing.y = unit(0.25, "lines"),
  <span aria-label="annotation5" class="code_codeannotation">❺</span> panel.background = element_rect(
      fill = "transparent",
      color = "transparent"
    ),
    panel.border = element_rect(
      color = "transparent",
      size = 0
    ),
    plot.background = element_rect(
      fill = "transparent",
      color = "transparent",
      size = .4
    ),
    plot.margin = margin(rep(18, 4))
  )
  )
</code></pre>
<p class="tx">The code in the <span class="sans_thesansmonocd_w5regular_">theme()</span> function does many different things, but let’s look at a few of the most important. First, it moves the legend from the right side (the default) to the top of the plot <span aria-label="annotation2" class="codeannotation">❷</span>. Then, the <span class="sans_thesansmonocd_w5regular_">angle = 0</span> argument rotates the year text in the columns from vertical to horizontal <span aria-label="annotation3" class="codeannotation">❸</span>. Without this argument, the years would be much less legible.</p>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">theme()</span> function also makes the distinctive axis lines and ticks that appear on the right side of the final plot <span aria-label="annotation1" class="codeannotation">❶</span>. Calling <span class="sans_thesansmonocd_w5regular_">element_blank()</span> removes all grid lines <span aria-label="annotation4" class="codeannotation">❹</span>. Finally, this code removes the borders and gives each individual plot a transparent background <span aria-label="annotation5" class="codeannotation">❺</span>.</p>
<p class="tx">You might be thinking, <i class="calibre4">Wait. Didn’t the individual plots have a gray background behind them?</i> Yes, dear reader, they did. Scherer and Karamanis made these with a separate geom, <span class="sans_thesansmonocd_w5regular_">geom_rect()</span>:</p>
<pre id="pre-42" class="calibre10"><code class="calibre11">geom_rect(
  aes(
    xmin = .5,
    xmax = max_week + .5,
    ymin = -0.005,
    ymax = 1
  ),
  fill = "#f4f4f9",
  color = NA,
  size = 0.4
)
</code></pre>
<p class="tx">They also set some additional aesthetic properties specific to this geom—<span class="sans_thesansmonocd_w5regular_">xmin</span>, <span class="sans_thesansmonocd_w5regular_">xmax</span>, <span class="sans_thesansmonocd_w5regular_">ymin</span>, and <span class="sans_thesansmonocd_w5regular_">ymax</span>—which determine the boundaries of the rectangle it produces. The result is a gray background behind each small multiple, as shown in <a href="chapter2.xhtml#fig2-15" class="calibre3">Figure 2-15</a>.<span aria-label=" Page 41. " epub:type="pagebreak" id="pg_41" role="doc-pagebreak"/></p>
<figure class="img"><img alt="" class="img2" height="2200" id="fig2-15" src="../images/fig2-15.jpg" width="1216"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 2-15: The faceted version of the drought visualization with a gray background behind each small multiple</span></p></figcaption>
</figure>
<p class="tx"><span aria-label=" Page 42. " epub:type="pagebreak" id="pg_42" role="doc-pagebreak"/>Finally, Scherer and Karamanis made some tweaks to the legend. Previously you saw a simplified version of the <span class="sans_thesansmonocd_w5regular_">scale_fill_viridis_d()</span> function. Here’s a more complete version:</p>
<pre id="pre-43" class="calibre10"><code class="calibre11">scale_fill_viridis_d(
  option = "rocket",
  direction = -1,
  name = "Category:",
  labels = c(
    "Abnormally Dry",
    "Moderate Drought",
    "Severe Drought",
    "Extreme Drought",
    "Exceptional Drought"
  )
)
</code></pre>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">name</span> argument sets the legend title, and the <span class="sans_thesansmonocd_w5regular_">labels</span> argument specifies the labels that show up in the legend. <a href="chapter2.xhtml#fig2-16" class="calibre3">Figure 2-16</a> shows the result of these changes.</p>
<figure class="img"><img alt="" class="img1" height="146" id="fig2-16" src="../images/fig2-16.jpg" width="1243"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 2-16: The drought visualization with changes to the legend text</span></p></figcaption>
</figure>
<p class="tx">Rather than D0, D1, D2, D3, and D4, the legend text now reads Abnormally Dry, Moderate Drought, Severe Drought, Extreme Drought, and Exceptional Drought—much more user-friendly categories.</p>
</section>
</section>
<section aria-labelledby="sec13" epub:type="division">
<h3 class="h1" id="sec13"><span id="h1-18"/><span class="sans_dogma_ot_bold_b_1">The Complete Visualization Code</span></h3>
<p class="tni">While I’ve shown you a nearly complete version of the code that Scherer and Karamanis wrote, I made some small changes to make it easier to understand. If you’re curious, the full code is here:</p>
<pre id="pre-44" class="calibre10"><code class="calibre11">ggplot(dm_perc_cat_hubs, aes(week, percentage)) +
  geom_rect(
    aes(
      xmin = .5,
      xmax = max_week + .5,
      ymin = -0.005,
      ymax = 1
    ),
    fill = "#f4f4f9",
    color = NA,
    size = 0.4,
    show.legend = FALSE
  ) +
  geom_col(
<span aria-label=" Page 43. " epub:type="pagebreak" id="pg_43" role="doc-pagebreak"/>    aes(
      fill = category,
      fill = after_scale(addmix(
        darken(
          fill,
          .05,
          space = "HLS"
        ),
        "#d8005a",
        .15
      )),
      color = after_scale(darken(
        fill,
        .2,
        space = "HLS"
      ))
    ),
    width = .9,
    size = 0.12
  ) +
  facet_grid(
    rows = vars(year),
    cols = vars(hub),
    switch = "y"
  ) +
  coord_cartesian(clip = "off") +
  scale_x_continuous(
    expand = c(.02, .02),
    guide = "none",
    name = NULL
  ) +
  scale_y_continuous(
    expand = c(0, 0),
    position = "right",
    labels = NULL,
    name = NULL
  ) +
  scale_fill_viridis_d(
    option = "rocket",
    name = "Category:",
    direction = -1,
    begin = .17,
    end = .97,
    labels = c(
      "Abnormally Dry",
      "Moderate Drought",
      "Severe Drought",
      "Extreme Drought",
      "Exceptional Drought"
    )
  ) +
  guides(fill = guide_legend(
    nrow = 2,
    override.aes = list(size = 1)
<span aria-label=" Page 44. " epub:type="pagebreak" id="pg_44" role="doc-pagebreak"/>  )) +
  theme_light(
    base_size = 18,
    base_family = "Roboto"
  ) +
  theme(
    axis.title = element_text(
      size = 14,
      color = "black"
    ),
    axis.text = element_text(
      family = "Roboto Mono",
      size = 11
    ),
    axis.line.x = element_blank(),
    axis.line.y = element_line(
      color = "black",
      size = .2
    ),
    axis.ticks.y = element_line(
      color = "black",
      size = .2
    ),
    axis.ticks.length.y = unit(2, "mm"),
    legend.position = "top",
    legend.title = element_text(
      color = "#2DAADA",
      size = 18,
      face = "bold"
    ),
    legend.text = element_text(
      color = "#2DAADA",
      size = 16
    ),
    strip.text.x = element_text(
      size = 16,
      hjust = .5,
      face = "plain",
      color = "black",
      margin = margin(t = 20, b = 5)
    ),
    strip.text.y.left = element_text(
      size = 18,
      angle = 0,
      vjust = .5,
      face = "plain",
      color = "black"
    ),
    strip.background = element_rect(
      fill = "transparent",
      color = "transparent"
    ),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_blank(),
    panel.spacing.x = unit(0.3, "lines"),
<span aria-label=" Page 45. " epub:type="pagebreak" id="pg_45" role="doc-pagebreak"/>    panel.spacing.y = unit(0.25, "lines"),
    panel.background = element_rect(
      fill = "transparent",
      color = "transparent"
    ),
    panel.border = element_rect(
      color = "transparent",
      size = 0
    ),
    plot.background = element_rect(
      fill = "transparent",
      color = "transparent",
      size = .4
    ),
    plot.margin = margin(rep(18, 4))
  )
</code></pre>
<p class="tx">There are a few additional tweaks to color and spacing, but most of the code reflects what you’ve seen so far.</p>
</section>
<section aria-labelledby="sec14" epub:type="division">
<h3 class="h1" id="sec14"><span id="h1-19"/><span class="sans_dogma_ot_bold_b_1">Summary</span></h3>
<p class="tni">You may be thinking that ggplot is the solution to all of your data visualization problems. And yes, you have a new hammer, but not everything is a nail. If you look at the version of the data visualization that appeared in <i class="calibre4">Scientific American</i> in November 2021, you’ll see that some of its annotations aren’t visible in our re-creation. That’s because they were added in post-production. While you could have found ways to create them in ggplot, it’s often not the best use of your time. Get yourself 90 percent of the way there with ggplot and then use Illustrator, Figma, or a similar tool to finish your work.</p>
<p class="tx">Even so, ggplot is a very powerful hammer, used to make plots that you’ve seen in the <i class="calibre4">New York Times</i>, FiveThirtyEight, the BBC, and other well-known news outlets. Although it’s not the only tool that can generate high-quality data visualizations, it makes the process straightforward. The graph by Scherer and Karamanis shows this in several ways:</p>
<ul class="ul">
<li class="listbullet">It strips away extraneous elements, such as grid lines, to keep the focus on the data itself. Complete themes such as <span class="sans_thesansmonocd_w5regular_">theme_light()</span> and the <span class="sans_thesansmonocd_w5regular_">theme()</span> function allowed Scherer and Karamanis to create a decluttered visualization that communicates effectively.</li>
<li class="listbullet">It uses well-chosen colors. The <span class="sans_thesansmonocd_w5regular_">scale_fill_viridis_d()</span> function allowed them to create a color scheme that demonstrates differences between groups, is colorblind-friendly, and shows up well when printed in grayscale.</li>
<li class="listbullet">It uses faceting to break down data from two decades and eight regions into a set of graphs that come together to create a single plot. With a single call to the <span class="sans_thesansmonocd_w5regular_">facet_grid()</span> function, Scherer and Karamanis created over 100 small multiples that the tool automatically combined into a single plot.</li>
</ul>
<p class="tx"><span aria-label=" Page 46. " epub:type="pagebreak" id="pg_46" role="doc-pagebreak"/>Learning to create data visualizations in ggplot involves a significant time investment. But the long-term payoff is even greater. Once you learn how ggplot works, you can look at others’ code and learn how to improve your own. By contrast, when you make a data visualization in Excel, the series of point-and-click steps disappears into the ether. To re-create a visualization you made last week, you’ll need to remember the exact steps you used, and to make someone else’s data visualization, you’ll need them to write up their process for you.</p>
<p class="tx">Because code-based data visualization tools allow you to keep a record of the steps you made, you don’t have to be the most talented designer to make high-quality data visualizations with ggplot. You can study others’ code, adapt it to your own needs, and create your own data visualization that not only is beautiful but also communicates effectively.</p>
</section>
<section aria-labelledby="sec15" epub:type="division">
<h3 class="h1" id="sec15"><span id="h1-20"/><span class="sans_dogma_ot_bold_b_1">Additional Resources</span></h3>
<ul class="ul">
<li class="listbullet">Will Chase, “The Glamour of Graphics,” online course, accessed November 6, 2023, <i class="calibre4"><a href="https://rfortherestofus.com/courses/glamour/" class="calibre3">https://rfortherestofus.com/courses/glamour/</a></i>.</li>
<li class="listbullet">Kieran Healy, <i class="calibre4">Data Visualization: A Practical Introduction</i> (Princeton, NJ: Princeton University Press, 2018), <i class="calibre4"><a href="https://socviz.co" class="calibre3">https://socviz.co</a></i>.</li>
<li class="listbullet">C<span class="copyright_accent">é</span>dric Scherer, <i class="calibre4">Graphic Design with ggplot2</i> (Boca Raton, FL: CRC Press, forthcoming).</li>
<li class="listbullet">Hadley Wickham, Danielle Navarro, and Thomas Lin Pedersen, <i class="calibre4">ggplot2: Elegant Graphics for Data Analysis</i>, 3rd ed. (New York: Springer, forthcoming), <i class="calibre4"><a href="https://ggplot2-book.org" class="calibre3">https://ggplot2-book.org</a></i>.</li>
<li class="listbullet">Claus Wilke, <i class="calibre4">Fundamentals of Data Visualization</i> (Sebastopol, CA: O’Reilly Media, 2019), <i class="calibre4"><a href="https://clauswilke.com/dataviz/" class="calibre3">https://clauswilke.com/dataviz/</a></i>.</li>
</ul>
</section>
</section>
</div></body></html>