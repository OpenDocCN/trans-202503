- en: '6'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Remote Hacking with Malware
  prefs: []
  type: TYPE_NORMAL
- en: '![](image_fi/book_art/chapterart.png)'
  prefs: []
  type: TYPE_IMG
- en: In this chapter, you’ll learn how attackers use malware over the internet to
    infect and control all kinds of computing devices from anywhere in the world.
    Short for *malicious software*, *malware* is any software designed to steal or
    damage data or to disrupt computer systems or users.
  prefs: []
  type: TYPE_NORMAL
- en: If an attacker can trick you into opening a malicious attachment, video, or
    app, they can take control of your computer, smartphone, or other internet-connected
    device. To protect yourself, you need to understand how easy it is for a black
    hat hacker to create a virus and infect your computer. Once a device is infected,
    the attacker can often see *everything*—including your files, your keystrokes,
    your screen, and even what your webcam sees!
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, you’ll safely create a virus on your Kali VM and infect your
    Windows VM across your virtual network. Then you’ll take control of the Windows
    VM from your Kali workstation and steal data, keystrokes, webcam video, and more—just
    like an attacker would. You’ll do this responsibly so the malware doesn’t escape
    your virtual environment. Along the way, you’ll learn to protect yourself from
    most malware on the internet.
  prefs: []
  type: TYPE_NORMAL
- en: To perform our hack, we’ll use one of Kali’s most famous tools, Metasploit.
    The Metasploit Framework is an open source penetration-testing toolkit maintained
    by computer security company Rapid7\. It’s called a framework because it’s a complete
    software platform for developing, testing, and executing exploits. An *exploit*
    is an attack designed to take advantage of a vulnerability in a computer system.
  prefs: []
  type: TYPE_NORMAL
- en: Metasploit has been called the hacker’s Swiss Army knife because it comes with
    so many useful tools built in. In fact, Metasploit contains a whopping 2,000 exploits
    and counting, including ones that target Windows, macOS, Linux, Microsoft Office,
    Adobe products, most browsers, iOS, Android, and more.
  prefs: []
  type: TYPE_NORMAL
- en: Building Your Own Virus
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We’ll start by building malware on your Kali VM to take over your Windows VM
    across the PublicNAT network we created in Chapter 3\. Specifically, we’ll create
    a *trojan*, a type of malware that looks harmless but can give an attacker control
    of your computer. Trojans are sometimes called *remote access trojans* *(RATs)*
    because they allow an attacker to control the target computer through the internet
    from anywhere in the world—no physical access needed.
  prefs: []
  type: TYPE_NORMAL
- en: Trojans are typically disguised as files someone would be tempted to download
    and run, such as a pirated copy of the latest hit song or movie or a cheat for
    a popular video game. As an example, we’ll call our trojan *Fortnite_cheat_mode.exe*.
    Log in to your Kali VM and let’s create some malware! You might be surprised by
    how easy it is.
  prefs: []
  type: TYPE_NORMAL
- en: In your Kali VM, click the Kali icon in the top left and go to **08 - Exploitation
    Tools**▶**Metasploit Framework**. If you’re asked for the sudo password, enter
    `kali`. The Metasploit Framework console (msfconsole) will start up, typically
    with a fun piece of ASCII text art at the top, like the one shown in [Figure 6-1](#figure6-1).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You should see a command prompt labeled `msf6 >`, short for “Metasploit Framework,
    version 6.” Enter `ip` `addr` to check your Kali VM’s IP address and make sure
    it’s connected to the PublicNAT network:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: '![f06001](image_fi/502000c06/f06001.png)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: 'Figure 6-1: Startup information for the Metasploit Framework console, with
    the Metasploit `msf``6` `>` command prompt at the bottom left'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Look for a line under the section `eth0:` that begins with `inet` followed
    by an IP address:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: As long as the address begins with `10.0.9` 1, you’re on the PublicNAT network
    you created in Chapter 3 and ready to go. Take note of the IP address; you’ll
    need to enter it as part of several commands. If you don’t see `10.0.9.``x` as
    your IP address, go back to Chapter 3, page 26, to create the PublicNAT network,
    or page 27 to connect your Kali VM to it correctly.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Enter the following two lines, replacing the `x` in the IP address with the
    number you just looked up:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: You should now see a file called *Fortnite_cheat_mode.exe* on your desktop,
    as shown in [Figure 6-2](#figure6-2). If you don’t see the file, open File Explorer
    and go to */home/kali/Desktop/* to find it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![f06002](image_fi/502000c06/f06002.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 6-2: The `msfvenom` tool creates a trojan named *Fortnite_cheat_mode.exe*
    and places it on the desktop (lower-left).'
  prefs: []
  type: TYPE_NORMAL
- en: You’ve now created your first trojan—nicely done! All it took was the two lines
    we entered at the `msf6 >` command prompt in step 4\. Actually, it was just one
    long command, but the backslash (`\`) at the end of the first line let us continue
    the command onto the second line.
  prefs: []
  type: TYPE_NORMAL
- en: 'So what did the command actually do? It told Metasploit’s `msfvenom` tool to
    create a piece of malware containing the Meterpreter shell, an interface that
    will give us command line (shell) control over the Windows VM from Kali. We told
    the Meterpreter shell where to receive commands from by typing `LHOST=` followed
    by the Kali VM’s IP address. The `-f` `exe` option told `msfvenom` that the format
    (`-f`) of the output should be a Windows executable (`exe`) program file. The
    `-o` option told `msfvenom` the name and location of the file to output: a file
    called *Fortnite_cheat_mode.exe* saved to the desktop (`~/Desktop/`).'
  prefs: []
  type: TYPE_NORMAL
- en: Sharing the Malware
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Now that we have a trojan Windows executable file, we need to get it onto your
    Windows VM. Often an attacker would try sending the trojan by email, but a lot
    of email programs scan attachments for malware, plus you wouldn’t want to send
    a trojan through your personal email account anyway. Instead, we’ll create a shared
    folder that the Windows user can surf to through their web browser.
  prefs: []
  type: TYPE_NORMAL
- en: 'Enter this command into the msfconsole window to create a folder called *share*
    at the default location for a shared web folder on most Linux computers:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Copy the trojan into the new folder:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Start the Apache web server application so the folder will be accessible through
    the web:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: To confirm that the trojan is now available for download, open the web browser
    in your Kali VM and go to *http://<10.0.9.x>/share*, replacing *<10.0.9.x>* with
    your Kali VM’s IP address. You’ll see a web page like the one shown in [Figure
    6-3](#figure6-3).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![f06003](image_fi/502000c06/f06003.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 6-3: Thanks to Kali’s Apache web server, our trojan malware is now available
    on the (virtual) web!'
  prefs: []
  type: TYPE_NORMAL
- en: Listening for the Trojan to Phone Home
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: We now need to prepare Metasploit to receive incoming connections from infected
    Windows machines (we sometimes call this *phoning home*). An incoming connection
    will let us send malicious commands to control a machine remotely. Typically,
    an attacker would send a virus email attachment to thousands of potential victims,
    waiting to see which ones open the attachment and get infected. In our case, we’ll
    infect only the one Windows VM. However, by following these steps, we could receive
    connections for controlling several infected computers at once just as easily.
  prefs: []
  type: TYPE_NORMAL
- en: 'Enter this command at the `msf6` `>` prompt to tell Metasploit to handle, or
    accept, multiple incoming connections from infected computers:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: The msfconsole prompt will change to let us know the *multi/handler* exploit
    is active.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Now tell Metasploit that the Trojan’s *payload*—that is, the malicious program
    we’re delivering—is a Meterpreter shell:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: The msfconsole will respond with `PAYLOAD` `=>` `windows/meterpreter/reverse_tcp`
    to let us know the Meterpreter payload has been selected.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Enter your Kali VM’s IP address to indicate the local host where connections
    will be coming in (remember to fill in the last number):'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Metasploit will respond with `LHOST =>` `10.0.9.x` to indicate that the local
    host option is set correctly.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Finally, the moment we’ve been waiting for: launch the exploit!'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: The `-j` option tells Metasploit to run the handler in the background so you
    can use the msfconsole while you wait for infected machines to connect to your
    Kali VM. Metasploit will confirm that the exploit is running in the background,
    ready to accept incoming connections on `10.0.9.``x``:4444`, or port 4444 on your
    Kali VM.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Infecting Your Windows VM
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Our trojan is primed and ready to go. Now it’s time to infect your Windows VM.
    First, we’ll disable a couple of Windows security features that would normally
    make it harder for users to do something stupid like download and open a questionable
    file from the internet. Then, with those safeguards turned off, that something
    stupid is exactly what we’ll do.
  prefs: []
  type: TYPE_NORMAL
- en: Remember, your Windows VM was created for you to practice hacking safely. If
    you mess it up, such as by infecting it with a trojan, you can simply delete the
    Windows VM and create a new one. With that in mind, start your Windows 10 VM in
    VirtualBox, entering the username `IEUser` and password `Passw0rd!` if prompted,
    and let’s get going.
  prefs: []
  type: TYPE_NORMAL
- en: Enter `cmd` in the Windows/Cortana search bar to find the command prompt. Right-click
    it and select **Run as administrator**. In the pop-up window asking if you want
    to allow this app to make changes to your device, click **Yes**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'In the Administrator: Command Prompt window that appears, enter this command
    to turn off your Windows VM’s firewall:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Normally, a *firewall* would block unwanted or malicious traffic from outside
    computers, and it can keep your computer from making suspicious connections to
    malicious servers. After running this command, you might see the pop-up message
    “Turn on Windows Firewall.” Windows is warning you that it’s dangerous to leave
    your firewall turned off—and it is!—but that’s what we want for this first remote
    hack.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Next, we’ll turn off Windows Defender, another safety tool. Enter `virus` in
    the search bar and open the **Virus & threat protection** settings.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click **Manage settings** and slide the toggle buttons for Real-time protection
    and Cloud-delivered protection to **Off**. Windows will ask again if you want
    to allow this app to make changes to your device. Click **Yes**. Your Windows
    10 VM is now as vulnerable as one-fourth of all PCs on the planet.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open the Edge web browser and go to *http://<10.0.9.x>/share/*.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click your trojan and choose **Save** to download the file to your Windows VM’s
    *Downloads* folder.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The moment of truth: open the Windows VM’s *Downloads* folder and double-click
    the trojan executable file to run it.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'It turns out that Windows 10 PCs have one more layer of virus protection to
    prevent boneheaded mistakes like the one we just made: Windows Defender SmartScreen
    will pop up a warning that it “prevented an unrecognized app from starting,” as
    shown in [Figure 6-4](#figure6-4). Click **More info** and then **Run anyway**.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You’ve now taken control of your first computer! You won’t see anything happen
    on the Windows VM, but if you switch back to the Kali VM, you should see something
    like the following in msfconsole:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 'The infected Windows VM called back to Kali and established a connection (also
    called a *session*). Congratulations: the Windows VM is now awaiting your commands!'
  prefs: []
  type: TYPE_NORMAL
- en: '![f06004a](image_fi/502000c06/f06004a.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 6-4: Windows Defender SmartScreen tries to protect your Windows VM one
    last time.'
  prefs: []
  type: TYPE_NORMAL
- en: Controlling Your Windows VM with Meterpreter
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Now that we’ve established a connection between your Kali and Windows VMs,
    we’re ready to start manipulating the Windows machine from Metasploit. To begin,
    enter `sessions` in the Metasploit terminal window to see the list of active Metasploit
    connections:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: As you can see, we’re connected to an infected Windows 10 machine named MSEdgeWin10
    under a username *IEUser*—that’s your Windows 10 VM! Our session has an ID number
    of 1\. If you ran the trojan on other machines as well, you’d see multiple sessions
    listed, each with its own ID number. Similarly, if you have to reestablish the
    connection with the Windows VM, it’ll be listed with a different ID number, such
    as 2.
  prefs: []
  type: TYPE_NORMAL
- en: 'Enter `sessions -i` `1` to start interacting with the Windows VM:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: 'The command prompt changes to `meterpreter` `>` to indicate that we’re interacting
    with the Meterpreter shell on the remote Windows VM. Let’s try a few commands.
    Enter `sysinfo` to view some information about the computer, such as its operating
    system (OS), the system language, and more:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: 'Now let’s try another command, `pwd`, short for *print working directory*,
    to see where the Meterpreter shell is running from:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: This tells us that the Meterpreter shell is running from the Windows VM’s *Downloads*
    directory—where our trojan is located.
  prefs: []
  type: TYPE_NORMAL
- en: Enter `help` to list some of the most common commands you can run on your Windows
    VM remotely from the Meterpreter shell. There are commands to run programs, terminate
    running processes, shut down or reboot the remote computer, clear event logs (to
    cover your tracks while hacking), capture keystrokes, take screenshots, and spy
    on the remote user’s desktop or webcam, just to name a few. In total, there are
    over 100 commands an attacker could use to take almost complete control of a computer.
    A partial listing of these commands is shown in [Figure 6-5](#figure6-5).
  prefs: []
  type: TYPE_NORMAL
- en: To find out how serious the threat really is, let’s see how easily an attacker
    could hack our files, keyboard, webcam, and more through an infected file. Not
    every command we’ll use will work every time you try it; you may have to make
    multiple attempts. However, exploring the damage these commands can do should
    motivate you *never* to install software from a random web page or email attachment.
  prefs: []
  type: TYPE_NORMAL
- en: '![f06005a](image_fi/502000c06/f06005a.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 6-5: A selection of frighteningly cool Meterpreter commands we can use
    to control the infected Windows VM'
  prefs: []
  type: TYPE_NORMAL
- en: Viewing and Uploading Files
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: We’ll start our exploitation of the Windows VM by browsing the computer’s files
    and uploading a backup copy of our trojan to the Windows VM.
  prefs: []
  type: TYPE_NORMAL
- en: 'At the `meterpreter >` command prompt, enter these commands to change the directory
    to the infected VM’s *Documents* folder and list the folder’s contents:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: You’ll see folders for music, pictures, videos, and more, just like on any other
    Windows computer. Attackers can use these commands to browse the target computer
    and look for interesting files to steal.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Upload a copy of the *Fortnite_cheat_mode.exe* malware file from your Kali
    VM into the *Documents* folder:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Switch back to your Windows 10 VM and open your *Documents* folder. You should
    see the newly uploaded trojan file, as shown in [Figure 6-6](#figure6-6).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![f06006](image_fi/502000c06/f06006.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 6-6: We can upload files to the infected Windows 10 VM from Kali.'
  prefs: []
  type: TYPE_NORMAL
- en: Now that you have a backup of the trojan on the Windows VM, you can always copy
    and paste it from *Documents* into *Downloads* if Windows Defender ever starts
    back up and deletes the trojan in the *Downloads* folder. Once someone opens a
    single infected file over the web or through email, an attacker will often upload
    multiple viruses in different locations on a computer to ensure that they can
    maintain control of the target machine.
  prefs: []
  type: TYPE_NORMAL
- en: Downloading Files from the Victim Computer
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The `download` command in Meterpreter allows you to download a file from the
    victim computer. To try it out, we’ll create a sample text file on the Windows
    VM and then steal it.
  prefs: []
  type: TYPE_NORMAL
- en: Enter this command at the `meterpreter >` prompt to take remote control of the
    victim computer’s Windows command line terminal, or *shell*.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Now create a file named *hacked.txt* that contains the text “You’ve been hacked!”
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Check the *Documents* folder on the Windows VM. You should see the *hacked.txt*
    file that we just created remotely from Kali.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Back in Kali, exit the Windows shell and return to Meterpreter:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Now download the file from Windows onto your Kali VM:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Finally, use the following command to view the file’s contents, our “You’ve
    been hacked!” message.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'We have successfully downloaded a file from the victim’s computer! In this
    case, it was a file that we created (remotely) from our attacking VM, but a real
    attacker could download much more important information. Any files the Windows
    user has access to become downloadable by the attacker when the Windows user runs
    the Meterpreter trojan: customer lists, family photos, budget spreadsheets, tax
    forms, bank statements, employee data, medical records, valuable intellectual
    property, or sensitive files of *any* kind can be stolen with just a few keystrokes.'
  prefs: []
  type: TYPE_NORMAL
- en: Viewing the Victim Computer’s Screen
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Trojans like the Meterpreter shell are often called *backdoors* because they
    give the attacker access to your computer in a way that bypasses all your other
    security measures (including logging in). It’s like sneaking in through the back
    door of a movie theater. When you clicked the Meterpreter trojan file on your
    Windows VM, you opened a secret door into your computer that allowed us to upload
    and download files. But it gets worse: you’ve given our attacking VM a backdoor
    to view your computer screen, record your keystrokes, and even turn on your webcam!
    To prove it, we’ll try viewing the Windows VM’s screen from within Kali.'
  prefs: []
  type: TYPE_NORMAL
- en: Enter `screenshot -v true` into the Meterpreter shell. With this command, an
    attacker can find out what the user of the victim machine is seeing.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE23]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: A window should pop up showing a screenshot from the Windows VM, as shown in
    [Figure 6-7](#figure6-7).![f06007](image_fi/502000c06/f06007.png)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Figure 6-7: Capturing a screenshot from the Windows VM'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'You might even be able to take it one step further and spy on the user’s computer
    screen in real time. In Meterpreter, enter the `screenshare` command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE24]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: This command doesn’t always work, and it may slow both your VMs (and your host
    computer) to a crawl because it attempts to stream real-time video of the Windows
    10 VM’s computer screen over the virtual network to the Kali VM. But if it does
    work, you’ll see the Windows 10 VM’s desktop through a browser window in Kali,
    as shown in [Figure 6-8](#figure6-8).
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Switch over to your Windows VM and move some files or windows around, empty
    the Recycle Bin, or open a web page. If you have multiple monitors or enough room
    to show both VMs, you can watch everything you do in the Windows VM through the
    streaming video in the browser in Kali. Creepy, right?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click back into the Meterpreter terminal window in Kali and press CTRL-C to
    stop the screenshare.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![f06008](image_fi/502000c06/f06008.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 6-8: The `screenshare` command lets an attacker on Kali spy on your
    Windows desktop over the internet.'
  prefs: []
  type: TYPE_NORMAL
- en: Logging Keystrokes
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Once in control of a machine, an attacker can log the user’s every keystroke.
    This gives the attacker a record of what the user is typing, including searches,
    commands, passwords, and more. Let’s see how it works.
  prefs: []
  type: TYPE_NORMAL
- en: 'Type `keyscan_start` into the Meterpreter shell to begin recording keystrokes
    from the target computer:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE25]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Switch back to your Windows VM, enter **notepad** in the search bar, and open
    the Notepad app.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Enter this information into Notepad:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE26]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Of course, you should never store sensitive information like this in plaintext
    on your computer, but many people in the world do.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Switch back over to the Kali VM and enter `keyscan_dump` to view the logged
    keystrokes:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE27]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Meterpreter captured all of the Windows 10 user’s keystrokes, including special
    keys like `<CR>` (short for *carriage return*, another name for the ENTER key).
    Typing into a text file might seem like an unrealistic example, but you can imagine
    instead that the user was typing their credit card number into an online shopping
    site or entering their username and password to log in to their bank’s web portal.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Enter `keyscan_stop` in the Meterpreter shell to stop capturing keystrokes
    from the Windows computer:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE28]'
  prefs: []
  type: TYPE_PRE
- en: Spying Through Webcams
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If logging keystrokes wasn’t creepy enough for you, viewing a victim computer’s
    webcam should make you want to move to a remote island with no internet (or at
    least convince you to cover your webcam with a sticky note). Connecting a webcam
    to the Windows VM might not work, but even if you can’t try this attack yourself,
    it works reliably against real Windows computers with webcams. To proceed, you’ll
    need a webcam (the one built into your laptop or a USB webcam attached to your
    desktop) and the patience to rerun the entire hack a few times following the steps
    in the Warning just given.
  prefs: []
  type: TYPE_NORMAL
- en: Check if your webcam appears under Devices▶Webcams on the Windows VM’s menu
    bar. If it does, select its name and skip ahead to step 6\. Otherwise, we’ll need
    to connect your webcam to the VM.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Close the Windows VM and select **Power off the machine**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In VirtualBox Manager, select the Windows VM and go to **Machine**▶**Settings**
    or **Machine**▶**Settings**▶**Ports** (on macOS). Select **USB** in the Settings
    menu and select the checkbox next to **Enable USB Controller**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Restart the Windows VM. Go to the menu bar, select **Devices**▶**Webcams** or
    **Devices**▶**USB**, and select the name of your webcam.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Turn off the Windows VM’s Firewall and Defender. Then run the trojan again.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Enter `webcam_list` at the Meterpreter prompt in Kali to find out if the webcam
    is available. You should see something like this:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE29]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: My webcam is showing up as `VirtualBox Webcam - Logitech HD Webcam C310`, for
    example.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Enter `webcam_stream` to connect to the webcam via Meterpreter.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE30]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Meterpreter will open Firefox and stream video from the Windows VM’s webcam,
    as shown in [Figure 6-9](#figure6-9).
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![f06009](image_fi/502000c06/f06009.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 6-9: The webcam stream shows me and the bookshelf in my office.'
  prefs: []
  type: TYPE_NORMAL
- en: 'You should see your webcam’s LED light up, showing that the camera is active.
    Unlike the `screenshare` and `keyscan` commands, the webcam hack lets you know
    someone’s spying on you. If your webcam light is ever on when you’re not using
    it, run a *thorough* antivirus scan and reboot your computer to see if the light
    turns off. However, don’t rely on the webcam LED: some advanced hacks enable spying
    through the webcam *without turning on* the LED. That’s why it’s important to
    practice the safety measures described in the next section.'
  prefs: []
  type: TYPE_NORMAL
- en: To stop streaming video from the Windows 10 VM’s webcam, close Firefox and press
    CTRL-C in the Meterpreter window to interrupt the `webcam_stream` command. Then
    grab a sticky note or a piece of masking tape and cover the webcam on your laptop!
  prefs: []
  type: TYPE_NORMAL
- en: Defending Against Malware
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As you’ve seen in this chapter, viruses are incredibly easy to create and distribute.
    Any suspicious email attachment, link, web page, app, or video that you receive
    or open could contain malware waiting to be launched. Attackers don’t even need
    a lot of skill; they just need to use Metasploit and trick people into downloading
    the virus. Once a computer is infected, the attacks an unethical hacker can use
    against it are downright frightening.
  prefs: []
  type: TYPE_NORMAL
- en: 'Your best defenses are the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Update software often. Update your operating system and applications, from your
    word processor and web browser to your PDF reader—at least monthly. Pick a certain
    day of the month, like the 1st, 15th, or 30th, and mark your calendar to update
    your devices and all applications. Think of it as another must-do task, like paying
    bills or mowing the lawn. Most of the 2,000+ exploits in Kali attack older versions
    of software, so you’ll be less vulnerable to an attack if you keep the latest
    security patches installed for the software you use.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Use a firewall and antivirus software. Keep your firewall turned on and update
    your antivirus software regularly. There are several free and low-cost antivirus
    tools out there. Research which ones stop the most malware and then update your
    antivirus tool weekly, or turn on automatic updates, to give it the best shot
    at protecting you.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Think before you click. Malware can be launched through infected program files,
    bootlegged videos, or even Office documents and PDFs. Peer-to-peer file-sharing
    sites are filled with “free” malware-infected files, waiting for unsuspecting
    victims. Run VirusTotal or another virus scan on *any* files from sources you
    don’t trust and don’t download suspicious or illegal files at all.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: These measures won’t make you invincible, but they’ll help you avoid most malware-based
    attacks, and they’ll make you a difficult enough target that most hackers will
    move on to other victims. Most attacks rely on the concept of *low-hanging fruit*—easy
    opportunities for a malicious hacker to break into your system, such as out-of-date
    software, a disabled firewall or antivirus program, or a user who opens links
    or downloads files without scanning them first. Unfortunately, there is enough
    low-hanging fruit to keep hackers busy, so taking a few smart precautions like
    these can keep you safe from more than 90 percent of attacks.
  prefs: []
  type: TYPE_NORMAL
- en: Oh . . . and cover that webcam when you’re not using it!
  prefs: []
  type: TYPE_NORMAL
- en: The Takeaway
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In this chapter, you learned how attackers create malware and how easily an
    unprotected computer can be infected. Using the Metasploit framework, you created
    a Meterpreter remote-access trojan (RAT), a special kind of malware that gives
    an attacker control of your computer from anywhere in the world as long as they
    have an internet connection. You shared your malware across a network by turning
    on the Apache web server in your Kali Linux VM and placing the trojan in a shared
    web folder. Then you downloaded the malware onto your Windows VM and opened the
    file to infect your machine.
  prefs: []
  type: TYPE_NORMAL
- en: Next, you took control of the Windows VM from the Meterpreter remote shell in
    Kali. You learned how an attacker can upload and download files, steal screenshots,
    log keystrokes, and spy through a webcam using only a command or two. For most
    of the attacks, your Windows VM didn’t even show it was being hacked.
  prefs: []
  type: TYPE_NORMAL
- en: Finally, you learned how to prevent many malware-based attacks. Avoiding suspicious
    downloads, links, and websites; keeping your firewall and antivirus software turned
    on and current; and regularly updating your operating system and applications
    are important precautions. If you employ multiple layers of security, you are
    a much more difficult target, and most attackers will move on to easier prey.
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we’ll take our skills one level higher and see how unethical
    hackers use Meterpreter and other tools to steal and crack passwords.
  prefs: []
  type: TYPE_NORMAL
