<html><head></head><body>
<div id="book-content">
<div id="sbo-rt-content"><section>
<header>
<h1 class="chapter">
<span class="ChapterNumber"><span epub:type="pagebreak" title="99" id="Page_99"/><a class="XrefDestination" id="8"/><span class="XrefDestination" id="xref-503007c08-001"/>8</span><br/>
<span class="ChapterTitle"><a class="XrefDestination" id="CallingBuilt-inMySQLFunctions"/><span class="XrefDestination" id="xref-503007c08-002"/>Calling Built-in MySQL Functions</span></h1>
</header>
<figure class="opener">
<img src="image_fi/book_art/chapterart.png" alt="" width="200" height="200"/>
</figure>
<p class="ChapterIntro">MySQL has hundreds of prewritten functions that perform a variety of tasks. In this chapter, you’ll review some common functions and learn how to call them from your queries. You’ll work with aggregate functions, which return a single value summary based on many rows of data in the database, and functions that help perform mathematical calculations, process strings, deal with dates, and much more.</p>
<p>In <a class="xref" href="c11.xhtml">Chapter 11</a>, you’ll learn to create your own functions, but for now you’ll focus on calling MySQL’s most useful built-in functions. For an up-to-date list of all the built-in functions, the best source is the MySQL reference manual. Search online for “MySQL built-in function and operator reference,” and bookmark the web page in your browser.</p>
<h2 id="h1-503007c08-0001"><span epub:type="pagebreak" title="100" id="Page_100"/><a class="XrefDestination" id="WhatIsaFunction?"/><span class="XrefDestination" id="xref-503007c08-003"/>What Is a Function?</h2>
<p class="BodyFirst">A <em>function</em> is a set of saved SQL statements that performs some task and returns a value. For example, the <code>pi()</code> function determines the value of pi and returns it. Here’s a simple query that calls the <code>pi()</code> function:</p>
<pre><code>select pi();</code></pre>
<p>Most of the queries you’ve seen thus far include a <code>from</code> clause that specifies which table to use. In this query, you aren’t selecting from any table, so you can call the function without <code>from</code>. It returns the following result:</p>
<pre><code>pi()
----------
3.141593</code></pre>
<p>For common tasks such as this, it makes more sense to use MySQL’s built-in function rather than having to remember the value every time you need it.</p>
<h2 id="h1-503007c08-0002"><a class="XrefDestination" id="PassingArgumentstoaFunction"/><span class="XrefDestination" id="xref-503007c08-004"/>Passing Arguments to a Function</h2>
<p class="BodyFirst">As you just saw, functions return a value. Some functions also let you pass values to them. When you call the function, you can specify a value that it should use. The values you pass to a function are called <em>arguments</em>.</p>
<p>To see how arguments work, you’ll call the <code>upper()</code> function, which allows you to accept one argument: a string value. The function determines what the uppercase equivalent of that string is and returns it. The following query calls <code>upper()</code> and specifies an argument of the text <code>rofl</code>:</p>
<pre><code>select upper('rofl');</code></pre>
<p>The result is as follows:</p>
<pre><code>upper('rofl')
--------------
ROFL</code></pre>
<p>The function translated each letter to uppercase and returned <code>ROFL</code>.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="boxcustom1">
<h2>Try It Yourself</h2>
<p class="BoxListNumberCustom1"><b>8-1.</b>	You can use the <code>lower()</code> function, which takes one argument, to return the lowercase version of a string. Call the <code>lower()</code> function with the argument <code>E.E. Cummings</code> and see what it returns.</p>
<p class="BoxListNumberCustom1"><b>8-2.</b>	The <code>now()</code> function returns the current date and time. Call <code>now()</code> with no arguments.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p><span epub:type="pagebreak" title="101" id="Page_101"/>In some functions, you can specify more than one argument. For example, <code>datediff()</code> allows you to specify two dates as arguments and then returns the difference in days between them. Here you call <code>datediff()</code> to find out how many days there are between Christmas and Thanksgiving in 2024:</p>
<pre><code>select datediff('2024-12-25', '2024-11-28');</code></pre>
<p>The result is:</p>
<pre><code>datediff('2024-12-25', '2024-11-28')
27</code></pre>
<p>When you called the <code>datediff()</code> function, you specified two arguments, the date of Christmas and the date of Thanksgiving, and separated them by commas. The function calculated the difference in days and returned that value (<code>27</code>).</p>
<p>Functions accept different numbers and types of values. For example, <code>upper()</code> accepts one string value, while <code>datediff()</code> accepts two <code>date</code> values. As you’ll see in this chapter, other functions accept values that are an integer, a boolean, or another data type.</p>
<h2 id="h1-503007c08-0003"><a class="XrefDestination" id="OptionalArguments"/><span class="XrefDestination" id="xref-503007c08-006"/>Optional Arguments</h2>
<p class="BodyFirst">Some functions accept an optional argument, in which you can supply another value for a more specific result when you call the function. The <code>round()</code> function, for example, which rounds decimal numbers, accepts one argument that must be provided and a second argument that is optional. If you call <code>round()</code> with the number you want rounded as the only argument, it will round the number to zero places. Try calling the <code>round()</code> function with one argument of <code>2.71828</code>:</p>
<pre><code>select round(2.71828);</code></pre>
<p>The <code>round()</code> function returns your rounded number with zero digits after the decimal point, which also removes the decimal point itself:</p>
<pre><code>round(2.71828)
--------------
       3</code></pre>
<p>If you supply <code>round()</code> with its optional argument, you can specify how many places after the decimal point you want it to round. Try calling <code>round()</code> with a first argument of <code>2.71828</code> and a second argument of <code>2</code>, separating the arguments with a comma:</p>
<pre><code>select round(2.71828, 2);</code></pre>
<p><span epub:type="pagebreak" title="102" id="Page_102"/>Now the result is:</p>
<pre><code>round(2.71828)
--------------
      2.72</code></pre>
<p>This time, <code>round()</code> returns a rounded number with two digits after the decimal point.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2><a class="XrefDestination" id="GettingHelp"/><span class="XrefDestination" id="xref-503007c08-007"/>Getting Help</h2>
<p class="BoxBodyFirst">MySQL provides the <code>help</code> statement so you can get help from the MySQL reference manual. If you type <code>help round</code>, for example, MySQL provides a wealth of information about the <code>round()</code> function, including the URL of the manual page for it and examples:</p>
<pre><code>&gt; <code class="bold">help round</code>
Name: 'ROUND'
Description:
Syntax:
ROUND(X), ROUND(X,D)

Rounds the argument X to D decimal places. The rounding algorithm
depends on the data type of X. D defaults to 0 if not specified. D can
be negative to cause D digits left of the decimal point of the value X
to become zero. The maximum absolute value for D is 30; any digits in
excess of 30 (or -30) are truncated.

URL: https://dev.mysql.com/doc/refman/8.0/en/mathematical-functions.html

Examples:
mysql&gt; SELECT ROUND(-1.23);
        -&gt; -1
mysql&gt; SELECT ROUND(-1.58);
        -&gt; -2
mysql&gt; SELECT ROUND(1.58);
        -&gt; 2
mysql&gt; SELECT ROUND(1.298, 1);
        -&gt; 1.3
mysql&gt; SELECT ROUND(1.298, 0);
        -&gt; 1
mysql&gt; SELECT ROUND(23.298, -1);
        -&gt; 20
mysql&gt; SELECT ROUND(.12345678901234567890123456789012345, 35);
        -&gt; 0.123456789012345678901234567890</code></pre>
<p><span epub:type="pagebreak" title="103" id="Page_103"/>The <code>help</code> statement can also assist with topics other than functions. For example, you could type <code>help 'data types'</code> to learn about MySQL data types:</p>
<pre><code>&gt; <code class="bold">help 'data types'</code>
You asked for help about help category: "Data Types"
For more information, type 'help &lt;item&gt;', where &lt;item&gt; is one of the following
topics:
   AUTO_INCREMENT
   BIGINT
   BINARY
   BIT
   BLOB
   BLOB DATA TYPE
   BOOLEAN
   CHAR
   CHAR BYTE
   DATE
   DATETIME
   <var>--snip--</var></code></pre>
<p>The <code>help</code> statement is case-insensitive, so getting help on <code>round</code> and <code>ROUND</code> will return the same information.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-503007c08-0004"><a class="XrefDestination" id="CallingFunctionsWithinFunctions"/><span class="XrefDestination" id="xref-503007c08-008"/>Calling Functions Within Functions</h2>
<p class="BodyFirst">You can use the results of one function in a call to another function by wrapping, or nesting, functions.</p>
<p>Say you want to get the rounded value of pi. You can wrap your call to the <code>pi()</code> function within a call to the <code>round()</code> function:</p>
<pre><code>select round(pi());</code></pre>
<p>The result is:</p>
<pre><code>round(pi())
-----------
     3</code></pre>
<p>The innermost function gets executed first and the results are passed to the outer function. The call to the <code>pi()</code> function returns <code>3.141593</code>, and that value is passed as an argument to the <code>round()</code> function, which returns <code>3</code>.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	If you find queries with nested functions hard to read, you can format your SQL to put the inner functions on their own line and indent them as follows:</p>
<pre><code>select round(
         pi()
       );</code></pre><div class="bottom hr"><hr/></div>
</section>
</aside>
<p><span epub:type="pagebreak" title="104" id="Page_104"/>You can modify your query and round pi to two digits by specifying a value in the <code>round()</code> function’s optional second argument, like so:</p>
<pre><code>select round(pi(), 2);</code></pre>
<p>The result is:</p>
<pre><code>round(pi(), 2)
-------------
     3.14</code></pre>
<p>This call to the <code>pi()</code> function returns <code>3.141593</code>, which is passed to <code>round()</code> as the function’s first argument. The statement evaluates to <code>round(3.141593,2)</code>, which returns <code>3.14</code>.</p>
<h2 id="h1-503007c08-0005"><a class="XrefDestination" id="CallingFunctionsfromDifferentPartsofYourQuery"/><span class="XrefDestination" id="xref-503007c08-009"/>Calling Functions from Different Parts of Your Query</h2>
<p class="BodyFirst">You can call functions in the <code>select</code> list of your query and also in the <code>where</code> clause. For example, take a look at the <code>movie</code> table, which contains the following data about movies:</p>
<pre><code>movie_name         star_rating  release_date
-----------------  -----------  ------------
Exciting Thriller  4.72         2024-09-27
Bad Comedy         1.2          2025-01-02
OK Horror          3.1789       2024-10-01</code></pre>
<p>The <code>star_rating</code> column holds the average number of stars that viewers rated the movie on a scale of 1 to 5. You’ve been asked to write a query to display movies that have more than 3 stars and a release date in 2024. You also need to display the movie name in uppercase and round the star rating:</p>
<pre><code>select upper(movie_name),
       round(star_rating)
from   movie
where  star_rating &gt; 3
and    year(release_date) = 2024;</code></pre>
<p>First, you use the <code>upper()</code> and <code>round()</code> functions in the <code>select</code> list of the query. You wrap the movie name values in the <code>upper()</code> function and wrap the star rating value in the <code>round()</code> function. You then specify that you’re pulling data from the <code>movie</code> table.</p>
<p>In the <code>where</code> clause, you call the <code>year()</code> function and specify one argument: the <code>release_date</code> from the <code>movie</code> table. The <code>year()</code> function returns the year of the movie’s release, which you compare (<code>=</code>) to <code>2024</code> to display only movies with a release date in 2024.</p>
<p>The results are:</p>
<pre><code>upper(movie_name)  round(star_rating)
-----------------  ------------------
EXCITING THRILLER           5
OK HORROR                   3</code></pre>
<h2 id="h1-503007c08-0006"><span epub:type="pagebreak" title="105" id="Page_105"/><a class="XrefDestination" id="AggregateFunctions"/><span class="XrefDestination" id="xref-503007c08-010"/>Aggregate Functions</h2>
<p class="BodyFirst">An <em>aggregate </em>function is a type of function that returns a single value based on multiple values in the database. Common aggregate functions include <code>count()</code>, <code>max()</code>, <code>min()</code>, <code>sum()</code>, and <code>avg()</code>. In this section, you’ll see how to call these functions with the following <code>continent</code> table:</p>
<pre><code>continent_id  continent_name  population
------------  --------------  ----------
1             Asia            4641054775
2             Africa          1340598147
3             Europe          747636026
4             North America   592072212
5             South America   430759766
6             Australia       43111704
7             Antarctica      0</code></pre>
<h3 id="h2-503007c08-0001"><a class="XrefDestination" id="count()"/><span class="XrefDestination" id="xref-503007c08-011"/>count()</h3>
<p class="BodyFirst">The <code>count()</code> function returns the number of rows returned from a query, and can help answer questions about your data like “How many customers do you have?” or “How many complaints did you get this year?”</p>
<p>You can use the <code>count()</code> function to determine how many rows are in the <code>continent</code> table, like so:</p>
<pre><code>select  count(*)
from    continent;</code></pre>
<p>When you call the <code>count()</code> function, you use an asterisk (or a wildcard) between the parentheses to count all rows. The asterisk selects all rows from a table, including all of each row’s column values.</p>
<p>The result is:</p>
<pre><code>count(*)
--------
   7</code></pre>
<p>Use a <code>where</code> clause to select all continents with a population of more than 1 billion:</p>
<pre><code>select  count(*)
from    continent
where   population &gt; 1000000000;</code></pre>
<p>The result is:</p>
<pre><code>count(*)
--------
   2</code></pre>
<p>The query returns <code>2</code> because only two continents, Asia and Africa, have more than 1 billion people.</p>
<h3 id="h2-503007c08-0002"><span epub:type="pagebreak" title="106" id="Page_106"/><a class="XrefDestination" id="max()"/><span class="XrefDestination" id="xref-503007c08-012"/>max()</h3>
<p class="BodyFirst">The <code>max()</code> function returns the maximum value in a set of values, and can help answer questions like “What was the highest yearly inflation rate?” or “Which salesperson sold the most cars this month?”</p>
<p>Here you use the <code>max()</code> function to find the maximum population for any continent in the table:</p>
<pre><code>select max(population)
from   continent;</code></pre>
<p>The result is:</p>
<pre><code>max(population)
---------------
  4641054775</code></pre>
<p>When you call the <code>max()</code> function, it returns the number of people who live in the most populated continent. The row in the table with the highest population for any continent is Asia, with a population of 4,641,054,775.</p>
<p>Aggregate functions like <code>max()</code> can be particularly useful in subqueries. Step away from the <code>continent</code> table for a moment, and turn your attention to the <code>train</code> table:</p>
<pre><code>train            mile
---------------  ----
The Chief        8000
Flying Scotsman  6500
Golden Arrow     2133</code></pre>
<p>Here you’ll use <code>max()</code> to help determine which train in the <code>train</code> table has traveled the most miles:</p>
<pre><code>select   *
from     train
where    mile =
(
  select max(mile)
  from   train
);</code></pre>
<p>In the inner query, you select the maximum number of miles that any train in your table has traveled. In the outer query, you display all the columns for trains that have traveled that number of miles.</p>
<p>The result is:</p>
<pre><code>train_name  mile
----------  ----
The Chief   8000</code></pre>
<h3 id="h2-503007c08-0003"><span epub:type="pagebreak" title="107" id="Page_107"/><a class="XrefDestination" id="min()"/><span class="XrefDestination" id="xref-503007c08-013"/>min()</h3>
<p class="BodyFirst">The <code>min()</code> function returns the minimum value in a set of values, and can help answer questions such as “What is the cheapest price for gas in town?” or “Which metal has the lowest melting point?”</p>
<p>Let’s return to the <code>continent</code> table. Use the <code>min()</code> function to find the population of the least populated continent:</p>
<pre><code>select min(population)
from   continent;</code></pre>
<p>When you call the <code>min()</code> function, it returns the minimum population value in the table:</p>
<pre><code>min(population)
---------------
       0</code></pre>
<p>The row in the table with the lowest population is Antarctica, with <code>0</code>.</p>
<h3 id="h2-503007c08-0004"><a class="XrefDestination" id="sum()"/><span class="XrefDestination" id="xref-503007c08-014"/>sum()</h3>
<p class="BodyFirst">The <code>sum()</code> function calculates the sum of a set of numbers, and helps answer questions like “How many bikes are there in China?” or “What were your total sales this year?”</p>
<p>Use the <code>sum()</code> function to get the total population of all the continents, like so:</p>
<pre><code>select sum(population)
from   continent;</code></pre>
<p>When you call the <code>sum()</code> function, it returns the sum total of the population for every continent.</p>
<p>The result is:</p>
<pre><code>max(population)
---------------
   7795232630</code></pre>
<h3 id="h2-503007c08-0005"><a class="XrefDestination" id="avg()"/><span class="XrefDestination" id="xref-503007c08-015"/>avg()</h3>
<p class="BodyFirst">The <code>avg()</code> function returns the average value based on a set of numbers, and can help answer questions including “What is the average amount of snow in Wisconsin?” or “What is the average salary for a doctor?”</p>
<p>Use the <code>avg()</code> function to find the average population of the continents:</p>
<pre><code>select avg(population)
from   continent;</code></pre>
<p><span epub:type="pagebreak" title="108" id="Page_108"/>When you call the <code>avg()</code> function, it returns the average population value of the continents in the table:</p>
<pre><code>avg(population)
---------------
1113604661.4286</code></pre>
<p>MySQL arrives at 1,113,604,661.4286 by totaling the population of every continent (7,795,232,630) and dividing that result by the number of continents (7).</p>
<p>Now, use the <code>avg()</code> function in a subquery to display all continents that are less populated than the average continent:</p>
<pre><code>select    *
from      continent
where     population &lt;
(
  select  avg(population)
  from    continent
);</code></pre>
<p>The inner query selects the average population size for all of continents: 1,113,604,661.4286 people. The outer query selects all columns from the <code>continent</code> table for continents with populations less than that value.</p>
<p>The result is:</p>
<pre><code>continent_id  continent_name  population
------------  --------------  ----------
     3        Europe           747636026
     4        North America    592072212
     5        South America    430759766
     6        Australia         43111704
     7        Antarctica               0</code></pre>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="boxcustom1">
<h2>Try it Yourself</h2>
<p class="BoxBodyFirst">In the <code>music</code> database, the <code>genre_stream</code> table contains the following data:</p>
<pre><code>Genre              Stream
-----------------  -------
R&amp;B, Hip Hop       3102456
Rock               1577569
Pop                1298756
Country             764789
Latin               601758
Dance, Electronic   308745</code></pre>
<p class="BoxListNumberCustom1"><b>8-3.</b>	Write a query to determine how many rows are in the table.</p>
<p class="BoxListNumberCustom1"><b>8-4.</b>	Write a query to find the average number of streams for all genres.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h3 id="h2-503007c08-0006"><span epub:type="pagebreak" title="109" id="Page_109"/><a class="XrefDestination" id="groupby"/><span class="XrefDestination" id="xref-503007c08-017"/>group by</h3>
<p class="BodyFirst">A <code>group by</code> clause tells MySQL how you want your results grouped, and can be used only in queries with aggregate functions. To see how <code>group by</code> works, take a look at the <code>sale</code> table, which stores a company’s sales:</p>
<pre><code>sale_id  customer_name  salesperson  amount
-------  -------------  -----------  ------
1        Bill McKenna   Sally        12.34
2        Carlos Souza   Sally        28.28
3        Bill McKenna   Tom           9.72
4        Bill McKenna   Sally        17.54
5        Jane Bird      Tom          34.44</code></pre>
<p>You can use the <code>sum()</code> aggregate function to add the sales amounts, but do you want to calculate one grand total for all sales, sum the amounts by customer, sum the amounts by salesperson, or calculate the totals that each salesperson sold to each customer?</p>
<p>To display amounts summed by customer, you <code>group by</code> the <code>customer_name</code> column, as in <a href="#listing8-1" id="listinganchor8-1">Listing 8-1</a>.</p>
<pre><code>select sum(amount)
from   sale
group by customer_name;</code></pre>
<p class="CodeListingCaption"><a id="listing8-1">Listing 8-1</a>: A query to sum amounts by customer</p>
<p>The results are as follows:</p>
<pre><code>sum(amount)
-----------
      39.60
      28.28
      34.44</code></pre>
<p>The sum total of the amount spent by customer Bill McKenna is $39.60; for Carlos Souza, it’s $28.28; and for Jane Bird, it’s $34.44. The results are ordered alphabetically by the customer’s first name.</p>
<p>Alternatively, you may want to see sum totals of the amounts by salesperson. <a href="#listing8-2" id="listinganchor8-2">Listing 8-2</a> shows you how to use <code>group by</code> on the <code>salesperson_name</code> column.</p>
<pre><code>select sum(amount)
from   sale
group by salesperson_name;</code></pre>
<p class="CodeListingCaption"><a id="listing8-2">Listing 8-2</a>: A query to sum amounts by salesperson</p>
<p>Your results are:</p>
<pre><code>sum(amount)
-----------
      58.16
      44.16</code></pre>
<p><span epub:type="pagebreak" title="110" id="Page_110"/>The total amount sold by Sally is $58.16, and for Tom it’s $44.16.</p>
<p>Because <code>sum()</code> is an aggregate function, it can operate on any number of rows and will return one value. The <code>group by</code> statement tells MySQL which rows you want <code>sum()</code> to operate on, so the syntax <code>group by salesperson_name</code> sums up the amounts for each salesperson.</p>
<p>Now say that you want to see just one row with a sum of every <code>amount</code> in the table. In this case, you don’t need to use <code>group by</code>, since you aren’t summing up by any group. Your query should look like the following:</p>
<pre><code>select  sum(amount)
from    sale;</code></pre>
<p>The result should be:</p>
<pre><code>sum(amount)
-----------
     102.32</code></pre>
<p>The <code>group by</code> clause works with all aggregate functions. For example, you could use <code>group by</code> with <code>count()</code> to return the count of sales for each salesperson, as in <a href="#listing8-3" id="listinganchor8-3">Listing 8-3</a>.</p>
<pre><code>select count(*)
from   sale
group by salesperson_name;</code></pre>
<p class="CodeListingCaption"><a id="listing8-3">Listing 8-3</a>: A query to count rows for each salesperson</p>
<p>The result is:</p>
<pre><code>count(*)
--------
   3
   2</code></pre>
<p>The query counted three rows in the <code>sales</code> table for Sally and two rows for Tom.</p>
<p>Or you can use <code>avg()</code> to get the average sale amount and group by <code>salesperson_name</code> to return the average sale amount per salesperson, as shown in <a href="#listing8-4" id="listinganchor8-4">Listing 8-4</a>.</p>
<pre><code>select   avg(amount)
from     sale
group by salesperson_name;</code></pre>
<p class="CodeListingCaption"><a id="listing8-4">Listing 8-4</a>: A query to get the average amount sold by each salesperson</p>
<p>The result is:</p>
<pre><code>avg(amount)
-----------
  19.386667
  22.080000</code></pre>
<p><span epub:type="pagebreak" title="111" id="Page_111"/>The results show that the average amount of each sale for Sally was $19.386667, and the average amount of each sale for Tom was $22.08.</p>
<p>When looking at these results, however, it’s not immediately clear which salesperson’s average was $19.386667 and which salesperson’s was $22.08. To clarify that, let’s modify the query to display more information in the result set. In <a href="#listing8-5" id="listinganchor8-5">Listing 8-5</a>, you select the salesperson’s name as well.</p>
<pre><code>select   salesperson_name,
         avg(amount)
from     sale
group by salesperson_name;</code></pre>
<p class="CodeListingCaption"><a id="listing8-5">Listing 8-5</a>: A query to display the salesperson’s name and their average amount sold</p>
<p>The results of your modified query are:</p>
<pre><code>salesperson_name  avg(amount)
----------------  -----------
Sally               19.386667
Tom                 22.080000</code></pre>
<p>Your averages appear with the same values, but now the salesperson’s name appears next to them. Adding this extra information makes your results much easier to understand.</p>
<p>After you’ve written several queries that use aggregate functions and <code>group by</code>, you might notice that you usually group by the same columns that you selected in the query. For example, in <a href="#listing8-5">Listing 8-5</a>, you selected the <code>salesperson_name</code> column and also grouped by the <code>salesperson_name</code> column.</p>
<p>To help you determine which column(s) to group by, look at the <em>select list</em>, or the part of the query between the words <code>select</code> and <code>from</code>. The select list contains the items you want to select from the database table; you almost always want to group by this same list. The only part of the select list that shouldn’t be part of the <code>group by</code> statement are the aggregate functions called.</p>
<p>For example, take a look at this <code>theme_park</code> table, which contains data from six different theme parks, including their country, state, and the city where they are located:</p>
<pre><code>country  state           city                park
-------  ------------    ------------------  -----------------
USA      Florida         Orlando             Disney World
USA      Florida         Orlando             Universal Studios
USA      Florida         Orlando             SeaWorld
USA      Florida         Tampa               Busch Gardens
Brazil   Santa Catarina  Balneario Camboriu  Unipraias Park
Brazil   Santa Catarina  Florianopolis       Show Water Park</code></pre>
<p>Say you want to select the country, state, and the number of parks for those countries and states. You might start to write your SQL statement like this:</p>
<pre><code>select country,
       state,
       count(*)
from   theme_park;</code></pre>
<p><span epub:type="pagebreak" title="112" id="Page_112"/>This query is incomplete, however, and running it will return an error message or incorrect results, depending on your configuration settings.</p>
<p>You should group by everything you’ve selected <em>that is not an aggregate function</em>. In this query, the columns you’ve selected, <code>country</code> and <code>state</code>, are not aggregate functions, so you will use <code>group by</code> with them:</p>
<pre><code>select   country,
         state,
         count(*)
from     theme_park
<b>group by country,</b>
<b>         state;</b></code></pre>
<p>The results are as follows:</p>
<pre><code>country state           count(*)
------  --------------  --------
USA     Florida            4
Brazil  Santa Catarina     2</code></pre>
<p>As you can see, the query now returns the correct results.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="boxcustom1">
<h2>Try it Yourself</h2>
<p class="BoxListNumberCustom1"><b>8-5.</b>	You can find the <code>theme_park</code> table in the <code>vacation</code> database. Write a query to select the country and the count of parks in each country. Do not display the state or the city. Which column should you <code>group by</code> in your query?</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-503007c08-0007"><a class="XrefDestination" id="StringFunctions"/><span class="XrefDestination" id="xref-503007c08-019"/>String Functions</h2>
<p class="BodyFirst">MySQL provides several functions to help you work with character strings and perform tasks such as comparing, formatting, and combining strings. Let’s take a look at the most useful string functions.</p>
<h3 id="h2-503007c08-0007"><a class="XrefDestination" id="concat()"/><span class="XrefDestination" id="xref-503007c08-020"/>concat()</h3>
<p class="BodyFirst">The <code>concat()</code> function <em>concatenates</em>, or joins, two or more strings together. For example, say you have the following <code>phone_book</code> table:</p>
<pre><code>first_name  last_name
----------  ----------
Jennifer    Perez
Richard     Johnson
John        Moore</code></pre>
<p><span epub:type="pagebreak" title="113" id="Page_113"/>You can write a query to display first and last names together, separated by a space character:</p>
<pre><code>select  concat(first_name, ' ', last_name)
from    phone_book;</code></pre>
<p>The results should be as follows:</p>
<pre><code>concat(first_name, ' ', last_name)
----------------------------------
Jennifer Perez
Richard Johnson
John Moore</code></pre>
<p>The names appear as one string, separated by a space.</p>
<h3 id="h2-503007c08-0008"><a class="XrefDestination" id="format()"/><span class="XrefDestination" id="xref-503007c08-021"/>format()</h3>
<p class="BodyFirst">The <code>format()</code> function formats a number by adding commas and showing the requested number of decimal points. For example, let’s revisit the <code>continent</code> table and select the population of Asia as follows:</p>
<pre><code>select  population
from    continent
where   continent_name = 'Asia';</code></pre>
<p>The result is:</p>
<pre><code>population
----------
4641054775</code></pre>
<p>It’s difficult to tell whether the population of Asia is about 4.6 billion or 464,000,000. To make the results more readable, you can format the <code>population</code> column with commas using the <code>format()</code> function like so:</p>
<pre><code>select format(population, 0)
from   continent;</code></pre>
<p>The <code>format()</code> function takes two arguments: a number to format and the number of positions to show after the decimal point. You called <code>format()</code> with two arguments: the <code>population</code> column and the number <code>0</code>.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	The <code>format()</code> function requires two arguments, meaning that you need to specify <code>0</code> as the second argument if you don’t want your result to show any numbers after the decimal point. This differs from the <code>round()</code> function, which allows you to leave the second argument blank. If you were to leave the second argument in <code>format()</code> blank, you’d get an error.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p><span epub:type="pagebreak" title="114" id="Page_114"/>Now that the <code>population</code> column has been formatted with commas, it’s clear in the result that Asia has around 4.6 billion people:</p>
<pre><code>population
-------------
4,641,054,775</code></pre>
<p>Now call the <code>format()</code> function to format the number 1234567.89 with five digits after the decimal point:</p>
<pre><code>select format(1234567.89, 5);</code></pre>
<p>The result is:</p>
<pre><code>format(1234567.89, 5)
---------------------
    1,234,567.89000</code></pre>
<p>The <code>format()</code> function accepts <code>1234567.89</code> as the number to be formatted in the first argument, adds commas, and add trailing zeros so that the result is displayed with five decimal positions.</p>
<h3 id="h2-503007c08-0009"><a class="XrefDestination" id="left()"/><span class="XrefDestination" id="xref-503007c08-022"/>left()</h3>
<p class="BodyFirst">The <code>left()</code> function returns some number of characters from the left side of a value. Consider the following <code>taxpayer</code> table:</p>
<pre><code>last_name  soc_sec_no
---------  ------------
Jagger     478-555-7598
McCartney  478-555-1974
Hendrix    478-555-3555</code></pre>
<p>To select last names from the <code>taxpayer</code> table, and also select the first three characters of the <code>last_name</code> column, you can write the following:</p>
<pre><code>select  last_name,
        left(last_name, 3)
from    taxpayer;</code></pre>
<p>The result is:</p>
<pre><code>last_name   left(last_name, 3)
----------  -----------------
Jagger      Jag
McCartney   McC
Hendrix     Hen</code></pre>
<p>The <code>left()</code> function is helpful in cases when you want to disregard the characters on the right.</p>
<h3 id="h2-503007c08-0010"><span epub:type="pagebreak" title="115" id="Page_115"/><a class="XrefDestination" id="right()"/><span class="XrefDestination" id="xref-503007c08-023"/>right()</h3>
<p class="BodyFirst">The <code>right()</code> function returns some number of characters from the right side of a value. Continue using the <code>taxpayer</code> table to select the last four digits of the taxpayers’ Social Security numbers:</p>
<pre><code>select  right(soc_sec_no, 4)
from    taxpayer;</code></pre>
<p>The result is:</p>
<pre><code>right(soc_sec_no, 4)
--------------------
        7598
        1974
        3555</code></pre>
<p>The <code>right()</code> function selects the rightmost characters without the characters on the left.</p>
<h3 id="h2-503007c08-0011"><a class="XrefDestination" id="lower()"/><span class="XrefDestination" id="xref-503007c08-024"/>lower()</h3>
<p class="BodyFirst">The <code>lower()</code> function returns the lowercase version of a string. Select the taxpayers’ last names in lowercase:</p>
<pre><code>select  lower(last_name)
from    taxpayer;</code></pre>
<p>The result is:</p>
<pre><code>lower(last_name)
----------------
jagger
mccartney
hendrix</code></pre>
<h3 id="h2-503007c08-0012"><a class="XrefDestination" id="upper()"/><span class="XrefDestination" id="xref-503007c08-025"/>upper()</h3>
<p class="BodyFirst">The <code>upper()</code> function returns the uppercase version of a string. Select the taxpayers’ last names in uppercase:</p>
<pre><code>select  upper(last_name)
from    taxpayer;</code></pre>
<p>The result is:</p>
<pre><code>upper(last_name)
----------------
JAGGER
MCCARTNEY
HENDRIX</code></pre>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2><span epub:type="pagebreak" title="116" id="Page_116"/><a class="XrefDestination" id="ThepowerofCOMBININGfunctions"/><span class="XrefDestination" id="xref-503007c08-026"/>The power of COMBINING functions</h2>
<p class="BoxBodyFirst">MySQL functions can be most useful when you combine them. Say you work for a tax agency, and you’re tasked with creating a new taxpayer identifier that will comprise the first three characters of the taxpayer’s last name in uppercase letters concatenated with the last four digits of their Social Security number. You can use the <code>concat()</code>, <code>upper()</code>, <code>left()</code>, and <code>right()</code> functions together to build the new taxpayer ID, like so:</p>
<pre><code>select  last_name,
        concat(
          upper(
            left(last_name, 3)
          ),
          right(soc_sec_no, 4)
        ) as new_taxpayer_id
from    taxpayer;</code></pre>
<p>The result is:</p>
<pre><code>last_name  new_taxpayer_id
---------  ---------------
Jagger        JAG7598
McCartney     MCC1974
Hendrix       HEN3555</code></pre>
<p>The result set shows two columns: the <code>last_name</code> column that you selected directly from the <code>taxpayer</code> table, and the <code>new_taxpayer_id</code> column that you built using parts of the <code>last_name</code> and <code>soc_sec_no</code> columns and some built-in functions.</p>
<p>To get the <code>new_taxpayer_id</code> values, you used the <code>left()</code> function to get the first three characters from the <code>last_name</code> column; called the <code>upper()</code> function to convert those three characters to uppercase; and used the <code>right()</code> function to get the last four digits from the <code>soc_sec_no</code> column. Then you passed those values into the <code>concat()</code> function to combine them into one string. Finally, you used the <code>as new_taxpayer_id</code> syntax to create a column alias of <code>new_taxpayer_id</code> so that the second column appears with that heading.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h3 id="h2-503007c08-0013"><a class="XrefDestination" id="substring()"/><span class="XrefDestination" id="xref-503007c08-027"/>substring()</h3>
<p class="BodyFirst">The <code>substring()</code> function returns part of a string and takes three arguments: a string, the starting character position of the substring you want, and the ending character position of the substring you want.</p>
<p>You can extract the substring <code>gum</code> from the string <code>gumbo</code> by using this query:</p>
<pre><code>select substring('gumbo', 1, 3);</code></pre>
<p><span epub:type="pagebreak" title="117" id="Page_117"/>The result is:</p>
<pre><code>substring('gumbo', 1, 3)
------------------------
          gum</code></pre>
<p>In <code>gumbo</code>, <code>g</code> is the first character, <code>u</code> is the second character, and <code>m</code> is the third. Selecting a substring starting at character 1 and going to character 3 returns those first three characters.</p>
<p>The second argument to the <code>substring()</code> function can accept a negative number. If you pass a negative number to it, the beginning position of your substring will be calculated by counting backward from the end of the string. For example:</p>
<pre><code>select substring('gumbo', -3, 2);</code></pre>
<p>The result is:</p>
<pre><code>substring('gumbo', -3, 2)
------------------------
          mb</code></pre>
<p>The string <code>gumbo</code> has five characters. You asked <code>substring()</code> to start your substring at the end of the string minus three character positions, which is position 3. Your third argument was 2, so your substring will start at the third character 3 and go for two characters, yielding the <code>mb</code> substring.</p>
<p>The third argument to the <code>substring()</code> function is optional. You can provide just the first two arguments—a string and the starting character position—to return the set of characters between the starting position until the end of the string:</p>
<pre><code>select substring('MySQL', 3);</code></pre>
<p>The result is:</p>
<pre><code>substring('MySQL', 3)
------------------------
          SQL</code></pre>
<p>The <code>substring()</code> function returned all the characters starting at the third character of the string <code>MySQL</code>, going all the way to the end of the string, resulting in <code>SQL</code>.</p>
<p>MySQL provides an alternate syntax for <code>substring()</code> that uses the <code>from</code> and <code>for</code> keywords. For example, to select the first three characters of the word <code>gumbo</code>, use the following syntax:</p>
<pre><code>select substring('gumbo' from 1 for 3);</code></pre>
<p><span epub:type="pagebreak" title="118" id="Page_118"/>This substring starts at the first character and continues for three characters. The result is as follows:</p>
<pre><code>substring('gumbo' from 1 for 3)
------------------------------
             gum</code></pre>
<p>This result is the same as the first substring example you saw, but you might find this syntax easier to read.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">Note</span></h2>
<p>	The <code>substring()</code> function has a synonym called <code>substr()</code>. Calling <code>substring('MySQL', 3)</code> and <code>substr('MySQL', 3)</code> yields identical results.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h3 id="h2-503007c08-0014"><a class="XrefDestination" id="trim()"/><span class="XrefDestination" id="xref-503007c08-028"/>trim()</h3>
<p class="BodyFirst">The <code>trim()</code> function strips any number of leading or trailing characters from a string. You can specify the characters you want removed, as well as whether you want the leading characters removed, the trailing characters removed, or both.</p>
<p>For example, if you have the string <code>**instructions**</code>, you could use <code>trim()</code> to return the string with the asterisks removed like so:</p>
<pre><code>select trim(leading  '*' from '**instructions**') as column1,
       trim(trailing '*' from '**instructions**') as column2,
       trim(both     '*' from '**instructions**') as column3,
       trim(         '*' from '**instructions**') as column4;</code></pre>
<p>In <code>column1</code>, you trim the <code>leading</code> asterisks. In <code>column2</code>, you trim the <code>trailing</code> asterisks. In <code>column3</code>, you trim <code>both</code> the leading and trailing asterisks. When you don’t specify <code>leading</code>, <code>trailing</code>, or <code>both</code>, as in <code>column4</code>, MySQL defaults to trimming both.</p>
<p>The results are as follows:</p>
<pre><code>column1         column2         column3       column4
--------------  --------------  ------------  ------------
instructions**  **instructions  instructions  instructions</code></pre>
<p>By default, <code>trim()</code> removes space characters. This means that if you have space characters around a string, you can use <code>trim()</code> without having to specify the character you want to strip:</p>
<pre><code>select trim('   asteroid   ');</code></pre>
<p>The result is the string <code>asteroid</code> with no spaces on either side:</p>
<pre><code>trim('   asteroid   ')
----------------------
asteroid</code></pre>
<p>The <code>trim()</code> function removes spaces from both sides of a string by default.</p>
<h3 id="h2-503007c08-0015"><span epub:type="pagebreak" title="119" id="Page_119"/><a class="XrefDestination" id="ltrim()"/><span class="XrefDestination" id="xref-503007c08-029"/>ltrim()</h3>
<p class="BodyFirst">The <code>ltrim()</code> function removes leading spaces from the left side of a string:</p>
<pre><code>select ltrim('   asteroid   ');</code></pre>
<p>The result is the string <code>asteroid</code> with no spaces on the left side of it:</p>
<pre><code>ltrim('   asteroid   ')
----------------------
asteroid</code></pre>
<p>The spaces to the right are unaffected.</p>
<h3 id="h2-503007c08-0016"><a class="XrefDestination" id="rtrim()"/><span class="XrefDestination" id="xref-503007c08-030"/>rtrim()</h3>
<p class="BodyFirst">The <code>rtrim()</code> function removes trailing spaces from the right side of a string:</p>
<pre><code>select rtrim('   asteroid   ');</code></pre>
<p>The result is the string <code>asteroid</code> with no spaces on the right side of it:</p>
<pre><code>rtrim('   asteroid   ')
----------------------
   asteroid</code></pre>
<p>The spaces to the left are unaffected.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="boxcustom1">
<h2>Try it Yourself</h2>
<p class="BoxListNumberCustom1"><b>8-6.</b>	A zip code (such as 24701 or 79936) is used for US postal delivery. Each character in a zip code has meaning. The first character is the national area. The second and third characters represent the sectional center. The fourth and fifth characters are for the associate post office.</p>
<p class="ListBody">The <code>mail</code> database contains an <code>address</code> table that has a <code>zip_code</code> column. The table contains character strings for the following zip codes: <code>94103</code>, <code>37188</code>, and <code>96718</code>.</p>
<p class="ListBody">Write a query that selects the zip code and uses the <code>substring()</code> function to select the other parts of the zip code from the <code>zip_code</code> column. The query should produce the following output:</p>
<pre><code>zip_code  national_area  sectional_center  associate_post_office
--------  -------------  ----------------  ---------------------
94103           9               41                   03
37188           3               71                   88
96718           9               67                   18</code></pre>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-503007c08-0008"><span epub:type="pagebreak" title="120" id="Page_120"/><a class="XrefDestination" id="DateandTimeFunctions"/><span class="XrefDestination" id="xref-503007c08-032"/>Date and Time Functions</h2>
<p class="BodyFirst">MySQL provides date-related functions that help you perform tasks like getting the current date and time, selecting a part of the date, and calculating how many days there are between two dates.</p>
<p>As you saw in <a class="xref" href="c04.xhtml">Chapter 4</a>, MySQL provides the <code>date</code>, <code>time</code>, and <code>datetime</code> data types, where <code>date</code> contains a month, day, and year; <code>time</code> contains hours, minutes, and seconds; and <code>datetime</code> has all of those parts because it comprises both a date and a time. These are the formats MySQL uses to return many of the results of the functions you’ll see here.</p>
<h3 id="h2-503007c08-0017"><a class="XrefDestination" id="curdate()"/><span class="XrefDestination" id="xref-503007c08-033"/>curdate()</h3>
<p class="BodyFirst">The <code>curdate()</code> function returns the current date in the <code>date</code> format:</p>
<pre><code>select curdate();</code></pre>
<p>Your result should look similar to the following:</p>
<pre><code>curdate()
----------
2024-12-14</code></pre>
<p>Both <code>current_date()</code> and <code>current_date</code> are synonyms for <code>curdate()</code> and will produce identical results.</p>
<h3 id="h2-503007c08-0018"><a class="XrefDestination" id="curtime()"/><span class="XrefDestination" id="xref-503007c08-034"/>curtime()</h3>
<p class="BodyFirst">The <code>curtime()</code> function returns the current time in the <code>time</code> format:</p>
<pre><code>select curtime();</code></pre>
<p>Your result should look similar to the following:</p>
<pre><code>curtime()
---------
09:02:41</code></pre>
<p>For me, the current time is 9:02 <span class="Caps">AM</span> and 41 seconds. Both <code>current_time()</code> and <code>current_time</code> are synonyms for <code>curtime()</code> and will produce identical results.</p>
<h3 id="h2-503007c08-0019"><a class="XrefDestination" id="now()"/><span class="XrefDestination" id="xref-503007c08-035"/>now()</h3>
<p class="BodyFirst">The <code>now()</code> function returns the current date and time in a <code>datetime</code> format:</p>
<pre><code>select now();</code></pre>
<p>Your results should look similar to the following:</p>
<pre><code>now()
-------------------
2024-12-14 09:02:18</code></pre>
<p><span epub:type="pagebreak" title="121" id="Page_121"/>Both <code>current_timestamp()</code> and <code>current_timestamp</code> are synonyms for <code>now()</code> and will produce identical results.</p>
<h3 id="h2-503007c08-0020"><a class="XrefDestination" id="date_add()"/><span class="XrefDestination" id="xref-503007c08-036"/>date_add()</h3>
<p class="BodyFirst">The <code>date_add()</code> function adds some amount of time to a <code>date</code> value. To add (or subtract) from date values, you use an <em>interval</em>, a value that you can use to perform calculations on dates and times. With an interval, you can supply a number and a unit of time, like <code>5 day</code>, <code>4 hour</code>, or <code>2 week</code>. Consider the following table called <code>event</code>:</p>
<pre><code>event_id  eclipse_datetime
--------  -------------------
   374    2024-10-25 11:01:20</code></pre>
<p>To select the <code>eclipse_datetime</code> date from the <code>event</code> table and add 5 days, 4 hours, and 2 weeks to the date, you use <code>date_add()</code> with <code>interval</code> as follows:</p>
<pre><code>select  eclipse_datetime,
        date_add(eclipse_datetime, interval 5 day)  as add_5_days,
        date_add(eclipse_datetime, interval 4 hour) as add_4_hours,
        date_add(eclipse_datetime, interval 2 week) as add_2_weeks
from    event
where   event_id = 374;</code></pre>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	The units of time are singular. For example, you use <code>minute</code>, not <code>minutes</code>. Other units of time commonly used with intervals include second, month, and year.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>Your results should look similar to this:</p>
<pre><code>eclipse_datetime     add_5_days           add_4_hours          add_2_weeks
-------------------  -------------------  -------------------  -------------------
2024-10-25 11:01:20  2024-10-30 11:01:20  2024-10-25 15:01:20  2024-11-08 11:01:20</code></pre>
<p>The results show that the intervals of 5 days, 4 hours, and 2 weeks were added to the eclipse date and time and have been listed in the columns you specified.</p>
<h3 id="h2-503007c08-0021"><a class="XrefDestination" id="date_sub()"/><span class="XrefDestination" id="xref-503007c08-037"/>date_sub()</h3>
<p class="BodyFirst">The <code>date_sub()</code> function subtracts a time interval from a <code>date</code> value. For example, here you subtract the same time intervals in the previous example from the <code>eclipse_datetime</code> column of the <code>event</code> table:</p>
<pre><code>select  eclipse_datetime,
        date_sub(eclipse_datetime, interval 5 day)  as sub_5_days,
        date_sub(eclipse_datetime, interval 4 hour) as sub_4_hours,
        date_sub(eclipse_datetime, interval 2 week) as sub_2_weeks
from    event
where   event_id = 374;</code></pre>
<p><span epub:type="pagebreak" title="122" id="Page_122"/>The results are:</p>
<pre><code>eclipse_datetime     sub_5_days           sub_4_hours          sub_2_weeks
-------------------  -------------------  -------------------  -------------------
2024-10-25 11:01:20  2024-10-20 11:01:20  2024-10-25 07:01:20  2024-10-11 11:01:20</code></pre>
<p>The results show that the intervals of 5 days, 4 hours, and 2 weeks were subtracted from the eclipse date and time and have been listed in the columns you specified.</p>
<h3 id="h2-503007c08-0022"><a class="XrefDestination" id="extract()"/><span class="XrefDestination" id="xref-503007c08-038"/>extract()</h3>
<p class="BodyFirst">The <code>extract()</code> function pulls out specified parts of a <code>date</code> or a <code>datetime</code> value. It uses the same units of time as <code>date_add()</code> and <code>date_sub()</code>, like <code>day</code>, <code>hour</code>, and <code>week</code>.</p>
<p>In this example, you select some parts of your <code>eclipse_datetime</code> column:</p>
<pre><code>select  eclipse_datetime,
        extract(year from eclipse_datetime)   as year,
        extract(month from eclipse_datetime)  as month,
        extract(day from eclipse_datetime)    as day,
        extract(week from eclipse_datetime)   as week,
        extract(second from eclipse_datetime) as second
from    event
where   event_id = 374;</code></pre>
<p>The <code>extract()</code> function takes the <code>eclipse_datetime</code> value from the <code>event</code> table and displays the individual parts requested by the column names you specify. The results are as follows:</p>
<pre><code>eclipse_datetime     year  month  day  week  second
-------------------  ----  -----  ---  ----  ------
2024-10-25 11:01:20  2024     10   25    43      20</code></pre>
<p>MySQL provides other functions you can use for the same purpose as <code>extract()</code>, including <code>year()</code>, <code>month()</code>, <code>day()</code>, <code>week()</code>, <code>hour()</code>, <code>minute()</code>, and <code>second()</code>. This query achieves the same result as the preceding one:</p>
<pre><code>select  eclipse_datetime,
        year(eclipse_datetime)   as year,
        month(eclipse_datetime)  as month,
        day(eclipse_datetime)    as day,
        week(eclipse_datetime)   as week,
        second(eclipse_datetime) as second
from    event
where   event_id = 374;</code></pre>
<p>You can also use the <code>date()</code> and <code>time()</code> functions to select just the <code>date</code> or <code>time</code> portion of a <code>datetime</code> value:</p>
<pre><code>select  eclipse_datetime,
        date(eclipse_datetime)   as date,
        time(eclipse_datetime)   as time
from    event
where   event_id = 374;</code></pre>
<p><span epub:type="pagebreak" title="123" id="Page_123"/>The results are:</p>
<pre><code>eclipse_datetime     date        time
-------------------  ----------  --------
2024-10-25 11:01:20  2024-10-25  11:01:20</code></pre>
<p>As you can see, the <code>date()</code> and <code>time()</code> functions provide a quick way to extract just the date or the time from a <code>datetime</code> value.</p>
<h3 id="h2-503007c08-0023"><a class="XrefDestination" id="datediff()"/><span class="XrefDestination" id="xref-503007c08-039"/>datediff()</h3>
<p class="BodyFirst">The <code>datediff()</code> function returns the number of days between two dates. Say you want to check how many days there are between New Year’s Day and Cinco de Mayo in 2024:</p>
<pre><code>select datediff('2024-05-05', '2024-01-01');</code></pre>
<p>The result is 125 days:</p>
<pre><code>datediff('2024-05-05', '2024-01-01')
------------------------------------
                 125</code></pre>
<p>If the date argument on the left is more recent than the date argument on the right, <code>datediff()</code> will return a positive number. If the date on the right is more recent, <code>datediff()</code> will return a negative number. If the two dates are the same, <code>0</code> will be returned.</p>
<h3 id="h2-503007c08-0024"><a class="XrefDestination" id="date_format()"/><span class="XrefDestination" id="xref-503007c08-040"/>date_format()</h3>
<p class="BodyFirst">The <code>date_format()</code> function formats a date according to a format string that you specify. The format string is made up of characters that you add and <em>specifiers</em> that start with a percent sign. The most common specifiers are listed in <a href="#table8-1" id="tableanchor8-1">Table 8-1</a>.</p>
<figure>
<figcaption class="TableTitle"><p><a id="table8-1">Table 8-1</a>: Common Specifiers</p></figcaption>
<table id="table-503007c08-0001" border="1">
<thead>
<tr>
<td><b>Specifier</b></td>
<td><b>Description</b></td>
</tr>
</thead>
<tbody>
<tr>
<td><code>%a</code></td>
<td>Abbreviated weekday name (<code>Sun</code>–<code>Sat</code>)</td>
</tr>
<tr>
<td><code>%b</code></td>
<td>Abbreviated month name (<code>Jan</code>–<code>Dec</code>)</td>
</tr>
<tr>
<td><code>%c</code></td>
<td>Month, numeric (<code>1</code>–<code>12</code>)</td>
</tr>
<tr>
<td><code>%D</code></td>
<td>Day of the month with suffix (<code>1st</code>, <code>2nd</code>, <code>3rd</code>, . . .)</td>
</tr>
<tr>
<td><code>%d</code></td>
<td>Day of the month, two digits with a leading zero where applicable (<code>01</code>–<code>31</code>)</td>
</tr>
<tr>
<td><code>%e</code></td>
<td>Day of the month (<code>1</code>–<code>31</code>)</td>
</tr>
<tr>
<td><code>%H</code></td>
<td>Hour with leading zero where applicable (<code>00</code>–<code>23</code>)</td>
</tr>
<tr>
<td><code>%h</code></td>
<td>Hour (<code>01</code>–<code>12</code>)</td>
</tr>
<tr>
<td><code>%i</code></td>
<td>Minutes (<code>00</code>–<code>59</code>)</td>
</tr>
<tr>
<td><code>%k</code></td>
<td>Hour (<code>0</code>–<code>23</code>)</td>
</tr>
<tr>
<td><code><span epub:type="pagebreak" title="124" id="Page_124"/>%l</code></td>
<td>Hour (<code>1</code>–<code>12</code>)</td>
</tr>
<tr>
<td><code>%M</code></td>
<td>Month name (<code>January</code>–<code>December</code>)</td>
</tr>
<tr>
<td><code>%m</code></td>
<td>Month (<code>00</code>–<code>12</code>)</td>
</tr>
<tr>
<td><code>%p</code></td>
<td><code>AM</code> or <code>PM</code></td>
</tr>
<tr>
<td><code>%r</code></td>
<td>Time, 12-hour (<code>hh:mm:ss</code> followed by <code>AM</code> or <code>PM</code>)</td>
</tr>
<tr>
<td><code>%s</code></td>
<td>Seconds (<code>00</code>–<code>59</code>)</td>
</tr>
<tr>
<td><code>%T</code></td>
<td>Time, 24-hour (<code>hh:mm:ss</code>)</td>
</tr>
<tr>
<td><code>%W</code></td>
<td>Weekday name (<code>Sunday</code>–<code>Saturday</code>)</td>
</tr>
<tr>
<td><code>%w</code></td>
<td>Day of the week (<code>0</code> = Sunday – <code>6</code> = Saturday)</td>
</tr>
<tr>
<td><code>%Y</code></td>
<td>Year, four digits</td>
</tr>
<tr>
<td><code>%y</code></td>
<td>Year, two digits</td>
</tr>
</tbody>
</table>
</figure>
<p>The datetime <code>2024-02-02 01:02:03</code> represents February 2, 2024, at 1:02 <span class="Caps">AM</span> and 3 seconds. Try experimenting with some different formats for that <code>datetime</code>:</p>
<pre><code>select  date_format('2024-02-02 01:02:03', '%r') as format1,
        date_format('2024-02-02 01:02:03', '%m') as format2,
        date_format('2024-02-02 01:02:03', '%M') as format3,
        date_format('2024-02-02 01:02:03', '%Y') as format4,
        date_format('2024-02-02 01:02:03', '%y') as format5,
        date_format('2024-02-02 01:02:03', '%W, %M %D at %T') as format6;</code></pre>
<p>The result is:</p>
<pre><code>format1      format2  format3   format4  format5  format6
-----------  -------  --------  -------  -------  -----------------------------------
01:02:03 AM     02    February    2024      24    Friday, February 2nd at 01:02:03</code></pre>
<p>The column you aliased as <code>format6</code> shows how the format specifiers can be combined. In that format string, you added a comma and the word <code>at</code> in addition to four specifiers for the date and time.</p>
<h3 id="h2-503007c08-0025"><a class="XrefDestination" id="str_to_date()"/><span class="XrefDestination" id="xref-503007c08-041"/>str_to_date()</h3>
<p class="BodyFirst">The <code>str_to_date()</code> function converts a string value to a date based on the format you provide. You use the same specifiers that you used for <code>date_format()</code>, but the two functions take opposite actions: <code>date_format()</code> converts a date to a string, while <code>str_to_date()</code> converts a string to a date.</p>
<p>Depending upon the format you provide, <code>str_to_date()</code> can convert a string to a <code>date</code>, a <code>time</code>, or a <code>datetime</code>:</p>
<pre><code>select str_to_date('2024-02-02 01:02:03', '%Y-%m-%d')          as date_format,
       str_to_date('2024-02-02 01:02:03', '%Y-%m-%d %H:%i:%s') as datetime_format,
       str_to_date('01:02:03', '%H:%i:%s')                     as time_format;</code></pre>
<p><span epub:type="pagebreak" title="125" id="Page_125"/>The result is:</p>
<pre><code>date_format  datetime_format      time_format
-----------  -------------------  -----------
2024-02-02   2024-02-02 01:02:03    01:02:03</code></pre>
<p>The last column, <code>time_format</code>, can also be converted with the function of the same name. We’ll look at it next.</p>
<h3 id="h2-503007c08-0026"><a class="XrefDestination" id="time_format()"/><span class="XrefDestination" id="xref-503007c08-042"/>time_format()</h3>
<p class="BodyFirst">As its name implies, the <code>time_format()</code> function formats time. You can use the same specifiers as <code>date_format()</code> for <code>time_format()</code>. For example, here’s how to get the current time and format it in some different ways:</p>
<pre><code>select  time_format(curtime(), '%H:%i:%s')                            as format1,
        time_format(curtime(), '%h:%i %p')                            as format2,
        time_format(curtime(), '%l:%i %p')                            as format3,
        time_format(curtime(), '%H hours, %i minutes and %s seconds') as format4,
        time_format(curtime(), '%r')                                  as format5,
        time_format(curtime(), '%T')                                  as format6;</code></pre>
<p>Expressed in military time, the current time for me is <code>21:09:55</code>, which is 9:09 <span class="Caps">PM</span> and 55 seconds. Your results should look similar to the following:</p>
<pre><code>format1   format2   format3  format4                              format5      format6
--------  --------  -------  -----------------------------------  -----------  --------
21:09:55  09:09 PM  9:09 PM  21 hours, 09 minutes and 55 seconds  09:09:55 PM  21:09:55</code></pre>
<p>The column you aliased as <code>format2</code> shows the hour with a leading <code>0</code> because you used the <code>%H</code> specifier, but the <code>format3</code> column does not because you used the <code>%h</code> specifier. In columns 1–3, you added colon characters to the format string. In <code>format4</code> you added the word <code>hours</code>, a comma, the word <code>minutes</code>, the word <code>and</code>, and the word <code>seconds</code>.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="boxcustom1">
<h2>Try It Yourself</h2>
<p class="BoxListNumberCustom1"><b>8-7.</b>	The Summer Olympics are scheduled to be held in Brisbane on July 23, 2032. Write a query to calculate how many days that is from today’s date.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-503007c08-0009"><a class="XrefDestination" id="MathematicalOperatorsandFunctions"/><span class="XrefDestination" id="xref-503007c08-044"/>Mathematical Operators and Functions</h2>
<p class="BodyFirst">MySQL provides many functions to perform calculations. There are also arithmetic operators available, like <code>+</code> for addition, <code>-</code> for subtraction, <code>*</code> for multiplication, <code>/</code> and <code>div</code> for division, and <code>%</code> and <code>mod</code> for modulo. You’ll start reviewing some queries that use these operators, and then you’ll use parentheses to control the order of operations. Afterward, you’ll use mathematical <span epub:type="pagebreak" title="126" id="Page_126"/>functions to perform various tasks, including raising a number to a power, calculating standard deviation, and rounding and truncating numbers.</p>
<h3 id="h2-503007c08-0027"><a class="XrefDestination" id="MathematicalOperators"/><span class="XrefDestination" id="xref-503007c08-045"/>Mathematical Operators</h3>
<p class="BodyFirst">You’ll start by performing some mathematical calculations using the data from the <code>payroll</code> table:</p>
<pre><code>employee   salary    deduction   bonus    tax_rate
--------  ---------  ---------  --------  --------
Max Bain   80000.00    5000.00  10000.00      0.24
Lola Joy   60000.00       0.00    800.00      0.18
Zoe Ball  110000.00    2000.00  30000.00      0.35</code></pre>
<p>Try out some of the arithmetic operators as follows:</p>
<pre><code>select  employee,
        salary - deduction,
        salary + bonus,
        salary * tax_rate,
        salary / 12,
        salary div 12
from    payroll;</code></pre>
<p>In this example, you use mathematical operators to get the employee’s salary minus their deductions, add their bonus to their salary, multiply their salary by their tax rate, and see their monthly salary by dividing their annual salary by 12, respectively.</p>
<p>The result is as follows:</p>
<pre><code>employee salary - deduction  salary + bonus   salary * tax_rate  salary / 12  salary div 12
-------- ------------------  --------------  ------------------  -----------  -------------
Max Bain           75000.00        90000.00   9199.999570846558  6666.666667           6666
Lola Joy           60000.00        60800.00  10800.000429153442  5000.000000           5000
Zoe Ball          108000.00       140000.00   38499.99934434891  9166.666667           9166</code></pre>
<p>Notice that in the two columns on the right, <code>salary / 12</code> and <code>salary div 12</code>, you received different results when using the <code>/</code> and the <code>div</code> operators. This is because <code>div</code> discards any fractional amount and <code>/</code> does not.</p>
<h4 id="h3-503007c08-0001"><a class="XrefDestination" id="Modulo"/><span class="XrefDestination" id="xref-503007c08-046"/>Modulo</h4>
<p class="BodyFirst">MySQL provides two operators for modulo: the percent sign (<code>%</code>) and the <code>mod</code> operator. <em>Modulo</em> takes one number, divides it by another, and returns the remainder. Consider a table called <code>roulette_winning_number</code>:</p>
<pre><code>winning_number
--------------
       21
        8
       13</code></pre>
<p><span epub:type="pagebreak" title="127" id="Page_127"/>You can use modulo to determine if a number is odd or even by dividing it by 2 and checking the remainder, like so:</p>
<pre><code>select  winning_number,
        winning_number % 2
from    roulette_winning_number;</code></pre>
<p>Anything with a remainder of 1 is an odd number. The results are as follows:</p>
<pre><code>winning_number  winning_number % 2
--------------  ------------------
       21              1
        8              0
       13              1</code></pre>
<p>The results show <code>1</code> for odd numbers and <code>0</code> for even numbers. In the first row, <code>21 % 2</code> evaluates to <code>1</code> because 21 divided by 2 is 10 with a remainder of 1.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	The terms <em>modulo</em> and <em>modulus</em> are often confused. Modulo is the name of a function that finds the remainder of one number being divided by another. Modulus is the number you are dividing by. For example, in the expression <code>21 % 2</code>, <code>2</code> is the modulus and <code>%</code> is the modulo operator.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>Using <code>mod</code> or <code>%</code> produces the same results. Modulo is also available as the <code>mod()</code> function. All of these queries return the same results:</p>
<pre><code>select winning_number % 2     from roulette_winning_number;
select winning_number mod 2   from roulette_winning_number;
select mod(winning_number, 2) from roulette_winning_number;</code></pre>
<h4 id="h3-503007c08-0002"><a class="XrefDestination" id="OperatorPrecedence"/><span class="XrefDestination" id="xref-503007c08-047"/>Operator Precedence</h4>
<p class="BodyFirst">When there is more than one arithmetic operator used in a mathematical expression, <code>*</code>, <code>/</code>, <code>div</code>, <code>%</code>, and <code>mod</code> are evaluated first; <code>+</code> and <code>-</code> are evaluated last. This is called <em>operator precedence</em>. The following query (which uses the <code>payroll</code> table) was written to calculate the taxes employees will pay based on their salary, bonus, and tax rate, but the query is returning the wrong tax amount:</p>
<pre><code>select  employee,
        salary,
        bonus,
        tax_rate,
        salary + bonus * tax_rate
from    payroll;</code></pre>
<p>The results are:</p>
<pre><code>employee  salary     bonus     tax_rate  salary + bonus * tax_rate
--------  ---------  --------  --------  -------------------------
Max Bain   80000.00  10000.00      0.24                 82400.0000
Lola Joy   60000.00    800.00      0.18                 60144.0000
Zoe Ball  110000.00  30000.00      0.35                120500.0000</code></pre>
<p><span epub:type="pagebreak" title="128" id="Page_128"/>The column on the right should represent the amount of taxes the employees have to pay, but it seems to be too high. If Max Bain’s salary is $80,000 and his bonus is $10,000, it doesn’t seem reasonable that he would be required to pay $82,400 in taxes.</p>
<p>The query is returning the wrong value because you expected MySQL to add <code>salary</code> and <code>bonus</code> first, and then multiply the result by the <code>tax_rate</code>. Instead, MySQL multiplied <code>bonus</code> by <code>tax_rate</code> first and then added the <code>salary</code>. The multiplication happened first because multiplication has a higher operator precedence than addition.</p>
<p>To correct the problem, use parentheses to tell MySQL to consider <code>salary +</code> <code>bonus</code> as a group:</p>
<pre><code>select  employee,
        salary,
        bonus,
        tax_rate,
        <b>(</b>salary + bonus<b>)</b> * tax_rate
from    payroll;</code></pre>
<p>The results are:</p>
<pre><code>employee  salary     bonus     tax_rate  salary + bonus * tax_rate
--------  ---------  --------  --------  -------------------------
Max Bain   80000.00  10000.00      0.24                 21600.0000
Lola Joy   60000.00    800.00      0.18                 10944.0000
Zoe Ball  110000.00  30000.00      0.35                 49000.0000</code></pre>
<p>Now the query returns $21,600 for Max Bain, which is the correct value. You should use parentheses frequently when performing calculations—not only because it gives you control over the order of operations, but also because it makes your SQL easier to read and understand.</p>
<h3 id="h2-503007c08-0028"><a class="XrefDestination" id="MathematicalFunctions"/><span class="XrefDestination" id="xref-503007c08-048"/>Mathematical Functions</h3>
<p class="BodyFirst">MySQL provides many mathematical functions that can help with tasks like rounding numbers, getting the absolute value of a number, and dealing with exponents, as well as finding cosines, logarithms, and radians.</p>
<h4 id="h3-503007c08-0003"><a class="XrefDestination" id="abs()"/><span class="XrefDestination" id="xref-503007c08-049"/>abs()</h4>
<p class="BodyFirst">The <code>abs()</code> function gets the absolute value of a number. The absolute value of a number is always positive. For example, the absolute value of 5 is 5, and the absolute value of –5 is 5.</p>
<p>Say you had a contest to guess the number of jelly beans in a jar. Write a query to see whose guess was closest to the actual number, 300:</p>
<pre><code>select  guesser,
        guess,
        300          as actual,
        300 – guess  as difference
from    jelly_bean;</code></pre>
<p><span epub:type="pagebreak" title="129" id="Page_129"/>Here you’ve selected the guesser’s name and their guess from the <code>jelly_bean</code> table. You select <code>300</code> and alias the column as <code>actual</code> so it will appear in your results with that heading. Then you subtract the guess from 300 and alias that column as <code>difference</code>. The results are:</p>
<pre><code>guesser  guess actual  difference
-------  ----- ------  ----------
Ruth       275    300          25
Henry      350    300         -50
Ike        305    300          -5</code></pre>
<p>The <code>difference</code> column shows how far off the guesses were from the actual value of 300, but the results are a bit hard to interpret. When the guess was higher than the actual amount of 300, your <code>difference</code> column appears as a negative number. When the guess was lower than the actual amount, your <code>difference</code> column appears as a positive number. For your contest, you don’t care whether the guess was higher or lower than 300, you only care about which guess was closest to 300.</p>
<p>You can use the <code>abs()</code> function to remove the negative numbers from the difference column:</p>
<pre><code>select  guesser,
        guess,
        300 as actual,
<b>        abs(</b>300 – guess<b>)</b> as difference
from    jelly_bean;</code></pre>
<p>The results are:</p>
<pre><code>guesser  guess actual  difference
-------  ----- ------  ----------
Ruth       275    300          25
Henry      350    300          50
Ike        305    300           5</code></pre>
<p>Now you can easily see that Ike won your contest because his value in the <code>difference</code> column is the smallest.</p>
<h4 id="h3-503007c08-0004"><a class="XrefDestination" id="ceiling()"/><span class="XrefDestination" id="xref-503007c08-050"/>ceiling()</h4>
<p class="BodyFirst">The <code>ceiling()</code> function returns the smallest whole number that is greater than or equal to the argument. If you pay $3.29 for gas, and you want to round that number up to the next whole dollar amount, you’d write the following query:</p>
<pre><code>select ceiling(3.29);</code></pre>
<p>The result is:</p>
<pre><code>ceiling(3.29)
-------------
      4</code></pre>
<p><span epub:type="pagebreak" title="130" id="Page_130"/>The <code>ceiling()</code> function has a synonym, <code>ceil()</code>, that produces identical results.</p>
<h4 id="h3-503007c08-0005"><a class="XrefDestination" id="floor()"/><span class="XrefDestination" id="xref-503007c08-051"/>floor()</h4>
<p class="BodyFirst">The <code>floor()</code> function returns the largest whole number that is less than or equal to the argument. To round $3.29 down to the next lowest whole dollar amount, you’d write the following query:</p>
<pre><code>select floor(3.29);</code></pre>
<p>The result is:</p>
<pre><code>floor(3.29)
-----------
      3</code></pre>
<p>If the argument is already a whole number, then that number will be returned in both the <code>ceiling()</code> and <code>floor()</code> functions. For example, <code>ceiling(33)</code> and <code>floor(33)</code> both return <code>33</code>.</p>
<h4 id="h3-503007c08-0006"><a class="XrefDestination" id="pi()"/><span class="XrefDestination" id="xref-503007c08-052"/>pi()</h4>
<p class="BodyFirst">The <code>pi()</code> function returns the value of pi, as seen at the beginning of this chapter.</p>
<h4 id="h3-503007c08-0007"><a class="XrefDestination" id="degrees()"/><span class="XrefDestination" id="xref-503007c08-053"/>degrees()</h4>
<p class="BodyFirst">The <code>degrees()</code> function converts radians to degrees. You can convert pi to degrees using this query:</p>
<pre><code>select degrees(pi());</code></pre>
<p>The result is:</p>
<pre><code>degrees(pi())
-------------
     180</code></pre>
<p>You got your answer by wrapping the <code>pi()</code> function in the <code>degrees()</code> function.</p>
<h4 id="h3-503007c08-0008"><a class="XrefDestination" id="radians()"/><span class="XrefDestination" id="xref-503007c08-054"/>radians()</h4>
<p class="BodyFirst">The <code>radians()</code> function converts degrees to radians. You can convert 180 to radians using this query:</p>
<pre><code>select radians(180);</code></pre>
<p><span epub:type="pagebreak" title="131" id="Page_131"/>Your results are:</p>
<pre><code>radians(180)
-----------------
3.141592653589793</code></pre>
<p>The function was sent an argument of <code>180</code> and returned a value of pi.</p>
<h4 id="h3-503007c08-0009"><a class="XrefDestination" id="exp()"/><span class="XrefDestination" id="xref-503007c08-055"/>exp()</h4>
<p class="BodyFirst">The <code>exp()</code> function returns the natural logarithm base number <em>e</em> raised to the power of the number you provide as an argument (2, in this example):</p>
<pre><code>select exp(2);</code></pre>
<p>The result is:</p>
<pre><code>7.38905609893065</code></pre>
<p>The function returned <code>7.38905609893065</code>, which is <em>e</em> (2.718281828459) squared.</p>
<h4 id="h3-503007c08-0010"><a class="XrefDestination" id="log()"/><span class="XrefDestination" id="xref-503007c08-056"/>log()</h4>
<p class="BodyFirst">The <code>log()</code> function returns the natural logarithm of the number you provide as an argument:</p>
<pre><code>select log(2);</code></pre>
<p>The result is:</p>
<pre><code>0.6931471805599453</code></pre>
<p>MySQL also provides the <code>log10()</code> function, which returns the base-10 logarithm, and <code>log2()</code>, which returns the base-2 logarithm.</p>
<p>The <code>log()</code> function can accept two arguments: the base of a number, then the number itself. For example, to find the log<sub>2</sub>(8), enter the following:</p>
<pre><code>select log(2, 8);</code></pre>
<p>The result is:</p>
<pre><code>log(2, 8)
--------
    3</code></pre>
<p>The function was sent two arguments, <code>2</code> and <code>8</code>, and returned a value of <code>3</code>.</p>
<h4 id="h3-503007c08-0011"><span epub:type="pagebreak" title="132" id="Page_132"/><a class="XrefDestination" id="mod()"/><span class="XrefDestination" id="xref-503007c08-057"/>mod()</h4>
<p class="BodyFirst">The <code>mod()</code> function, as you saw earlier, is the modulo function. It takes one number, divides it by another, and returns the remainder.</p>
<pre><code>select mod(7, 2);</code></pre>
<p>The result is:</p>
<pre><code>mod(7, 2)
--------
    1</code></pre>
<p>The <code>mod(7,2)</code> function evaluates to <code>1</code> because 7 divided by 2 is 3 with a remainder of 1. Modulo is also available as the <code>%</code> operator and the <code>mod</code> operator.</p>
<h4 id="h3-503007c08-0012"><a class="XrefDestination" id="pow()"/><span class="XrefDestination" id="xref-503007c08-058"/>pow()</h4>
<p class="BodyFirst">The <code>pow()</code> function returns a number raised to a power. To raise 5 to the power of 3, you could write this query:</p>
<pre><code>select pow(5, 3);</code></pre>
<p>The result is:</p>
<pre><code>pow(5, 3)
--------
   125</code></pre>
<p>The <code>pow()</code> function has a synonym, <code>power()</code>, that returns identical results.</p>
<h4 id="h3-503007c08-0013"><a class="XrefDestination" id="round()"/><span class="XrefDestination" id="xref-503007c08-059"/>round()</h4>
<p class="BodyFirst">The <code>round()</code> function, introduced earlier in the chapter, rounds decimal numbers. To round the number 9.87654321 to three digits after the decimal point, use the following query:</p>
<pre><code>select round(9.87654321, 3);</code></pre>
<p>The result is:</p>
<pre><code>round(9.87654321, 3)
-------------------
       9.877</code></pre>
<p>To round all of the fractional numbers, call <code>round()</code> with just one argument:</p>
<pre><code>select round(9.87654321);</code></pre>
<p><span epub:type="pagebreak" title="133" id="Page_133"/>The result is:</p>
<pre><code>round(9.87654321)
-------------------
         10</code></pre>
<p>Calling <code>round()</code> without the optional second argument causes it to default to 0 digits after the decimal point.</p>
<h4 id="h3-503007c08-0014"><a class="XrefDestination" id="truncate()"/><span class="XrefDestination" id="xref-503007c08-060"/>truncate()</h4>
<p class="BodyFirst">The <code>truncate()</code> function shortens a number to specified number of decimal places. To truncate the number 9.87654321 to three digits after the decimal point, use the following query:</p>
<pre><code>select truncate(9.87654321, 3);</code></pre>
<p>The result is:</p>
<pre><code>truncate(9.87654321, 3)
-----------------------
       9.876</code></pre>
<p>To truncate all of the fractional numbers, call <code>truncate()</code> with <code>0</code> as the second argument:</p>
<pre><code>select truncate(9.87654321, 0);</code></pre>
<p>The result is:</p>
<pre><code>truncate(9.87654321, 0)
----------------------
          9</code></pre>
<p>The <code>truncate()</code> function removes digits to convert the number to the requested number of digits after the decimal point. This differs from <code>round()</code>, which rounds numbers up or down before removing digits.</p>
<h4 id="h3-503007c08-0015"><a class="XrefDestination" id="sin()"/><span class="XrefDestination" id="xref-503007c08-061"/>sin()</h4>
<p class="BodyFirst">The <code>sin()</code> function returns the sine of a number given in radians. You can use this query to get the sine of 2:</p>
<pre><code>select sin(2);</code></pre>
<p>The result is:</p>
<pre><code>sin(2)
------------------
0.9092974268256817</code></pre>
<p><span epub:type="pagebreak" title="134" id="Page_134"/>The function was sent an argument of <code>2</code> and returned a value of <code>0.9092974268256817</code>.</p>
<h4 id="h3-503007c08-0016"><a class="XrefDestination" id="cos()"/><span class="XrefDestination" id="xref-503007c08-062"/>cos()</h4>
<p class="BodyFirst">The <code>cos()</code> function returns the cosine of a number that is given in radians. Use the following query to get the cosine of 2:</p>
<pre><code>select cos(2);</code></pre>
<p>The result is:</p>
<pre><code>cos(2)
-------------------
-0.4161468365471424</code></pre>
<p>The function was sent an argument of <code>2</code> and returned a value of <code>-0.4161468365471424</code>.</p>
<h4 id="h3-503007c08-0017"><a class="XrefDestination" id="sqrt()"/><span class="XrefDestination" id="xref-503007c08-063"/>sqrt()</h4>
<p class="BodyFirst">The <code>sqrt()</code> function returns the square root of a number. You can get the square root of 16<code> </code>like so:</p>
<pre><code>sqrt(16)
--------
   4</code></pre>
<p>The function was sent an argument of <code>16</code> and returned a value of <code>4</code>.</p>
<h4 id="h3-503007c08-0018"><a class="XrefDestination" id="stddev_pop()"/><span class="XrefDestination" id="xref-503007c08-064"/>stddev_pop()</h4>
<p class="BodyFirst">The <code>stddev_pop()</code> function returns the population standard deviation of the numbers provided. <em>Population standard deviation</em> is the standard deviation when all values of a dataset are taken into consideration. For example, look at the <code>test_score</code> table, which contains all of your test scores:</p>
<pre><code>score
-----
  70
  82
  97</code></pre>
<p>Now write a query to get the population standard deviation of test scores:</p>
<pre><code>select  stddev_pop(score)
from    test_score;</code></pre>
<p>The result is:</p>
<pre><code>stddev_pop(score)
------------------
11.045361017187261</code></pre>
<p><span epub:type="pagebreak" title="135" id="Page_135"/>The <code>std()</code> and <code>stddev()</code> functions are synonyms for <code>stddev_pop()</code> and will produce identical results.</p>
<p>To get the standard deviation of a sample of values, rather than the entire population of a dataset, you can use <code>stddev_samp()</code> function.</p>
<h4 id="h3-503007c08-0019"><a class="XrefDestination" id="tan()"/><span class="XrefDestination" id="xref-503007c08-065"/>tan()</h4>
<p class="BodyFirst">The <code>tan()</code> function accepts an argument in radians and returns the tangent. For example, you can get the tangent of 3.8 with the following query:</p>
<pre><code>select tan(3.8);</code></pre>
<p>The result is:</p>
<pre><code>0.7735560905031258</code></pre>
<p>The function was sent an argument of <code>3.8</code> and returned a value of <code>0.7735560905031258</code>.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="boxcustom1">
<h2>Try It Yourself</h2>
<p class="BoxListNumberCustom1"><b>8-8.</b>	The moon is 252,088 miles from Earth. Write a query to calculate how many kilometers the moon is from Earth. Round the number to the nearest kilometer. To convert miles to kilometers, multiply the miles by 1.60934.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-503007c08-0010"><a class="XrefDestination" id="OtherHandyFunctions"/><span class="XrefDestination" id="xref-503007c08-067"/>Other Handy Functions</h2>
<p class="BodyFirst">Other useful functions include <code>cast()</code>, <code>coalesce()</code>, <code>distinct()</code>, <code>database()</code>, <code>if()</code>, and <code>version()</code>.</p>
<h3 id="h2-503007c08-0029"><a class="XrefDestination" id="cast()"/><span class="XrefDestination" id="xref-503007c08-068"/>cast()</h3>
<p class="BodyFirst">The <code>cast()</code> function converts a value from one data type to a different data type. To call the <code>cast()</code> function, pass a value into <code>cast()</code> as the first argument, follow it with the <code>as</code> keyword, and then specify the data type you want to convert it to.</p>
<p>For example, select the <code>datetime</code> column <code>order_datetime</code> from the table called <code>online_order</code>:</p>
<pre><code>select  order_datetime
from    online_order;</code></pre>
<p>Your results show the following <code>datetime</code> values:</p>
<pre><code>order_datetime
-------------------
2024-12-08 11:39:09
2024-12-10 10:11:14</code></pre>
<p><span epub:type="pagebreak" title="136" id="Page_136"/>You can select those values without their time portion by casting from a <code>datetime</code> data type to a <code>date</code> data type, like so:</p>
<pre><code>select  cast(order_datetime as date)
from    online_order;</code></pre>
<p>Your results are:</p>
<pre><code>cast(order_datetime as date)
----------------------------
         2024-12-08
         2024-12-10</code></pre>
<p>The date part of the <code>datetime</code> now appears as a <code>date</code> value.</p>
<h3 id="h2-503007c08-0030"><a class="XrefDestination" id="coalesce()"/><span class="XrefDestination" id="xref-503007c08-069"/>coalesce()</h3>
<p class="BodyFirst">The <code>coalesce()</code> function returns the first non-null value in a list. You could specify null values followed by a non-null value, and <code>coalesce()</code> would return the non-null value:</p>
<pre><code>select coalesce(null, null, 42);</code></pre>
<p>The result is:</p>
<pre><code>coalesce(null, null, 42)
------------------------
            42</code></pre>
<p>The <code>coalesce()</code> function is also useful when you want to display a value in your result instead of <code>null</code>. For example, in the <code>candidate</code> table used in the following query, the <code>employer</code> column will sometimes store the candidate’s employer name, and other times that column will be <code>null</code>. In order to display the text <code>Between Jobs</code> instead of <code>null</code>, you’d enter the following:</p>
<pre><code>select employee_name,
       coalesce(employer, 'Between Jobs')
from   candidate;</code></pre>
<p>The results are:</p>
<pre><code>employee_name  employer
-------------  ------------
Jim Miller     Acme Corp
Laura Garcia   Globex
Jacob Davis    Between Jobs</code></pre>
<p>The query now displays <code>Between Jobs</code> rather than <code>null</code> for Jacob Davis, which is more informative, especially for nontechnical users who may not understand what <code>null</code> means.</p>
<h3 id="h2-503007c08-0031"><span epub:type="pagebreak" title="137" id="Page_137"/><a class="XrefDestination" id="distinct()"/><span class="XrefDestination" id="xref-503007c08-070"/>distinct()</h3>
<p class="BodyFirst">When you have duplicate values, you can use the <code>distinct()</code> function to display each value only once. For example, if you want to know which countries your customers are from, you could query the <code>customer</code> table like so:</p>
<pre><code>select country
from   customer;</code></pre>
<p>The result is:</p>
<pre><code>country
-------
India
USA
USA
USA
India
Peru</code></pre>
<p>The query is returning the <code>country</code> column value for every row in the <code>customer</code> table. You can use the <code>distinct()</code> function to see each country in your result set just once:</p>
<pre><code>select distinct(country)
from   customer;</code></pre>
<p>Now the result is:</p>
<pre><code>country
-------
India
USA
Peru</code></pre>
<p>The <code>distinct()</code> function is also available as an operator. To use it, remove the parentheses like so:</p>
<pre><code>select distinct country
from   customer;</code></pre>
<p>The result set is identical:</p>
<pre><code>country
-------
India
USA
Peru</code></pre>
<p><span epub:type="pagebreak" title="138" id="Page_138"/>The <code>distinct()</code> function is especially useful when combined with the <code>count()</code> function to find how many unique values you have. Here you write a query to count the number of distinct countries in your table:</p>
<pre><code>select count(distinct country)
from   customer;</code></pre>
<p>The result is:</p>
<pre><code>count(distinct country)
-----------------------
           3</code></pre>
<p>You identified the distinct countries using the <code>distinct()</code> function and wrapped them in the <code>count()</code> function to get a count of them.</p>
<h3 id="h2-503007c08-0032"><a class="XrefDestination" id="database()"/><span class="XrefDestination" id="xref-503007c08-071"/>database()</h3>
<p class="BodyFirst">The <code>database()</code> function tells you which database you’re currently using. As you saw in <a class="xref" href="c02.xhtml">Chapter 2</a>, the <code>use</code> command lets you select which database you want to use. Throughout your day, you might move between different databases and forget your current database. You can call the <code>database()</code> function like so:</p>
<pre><code>use airport;

select database();</code></pre>
<p>The result is:</p>
<pre><code>database()
----------
 airport</code></pre>
<p>If you’re not in the database you thought you were and you tried to query a table, MySQL would give an error saying the table doesn’t exist. Calling <code>database()</code> is a quick way to check.</p>
<h3 id="h2-503007c08-0033"><a class="XrefDestination" id="if()"/><span class="XrefDestination" id="xref-503007c08-072"/>if()</h3>
<p class="BodyFirst">The <code>if()</code> function returns a different value depending upon whether a condition is <code>true</code> or <code>false</code>. The <code>if()</code> function accepts three arguments: the condition you want to test, the value to return if the condition is <code>true</code>, and the value to return if the condition is <code>false</code>.</p>
<p>Let’s write a query that lists students and whether they passed or failed an exam. The <code>test_result</code> table contains the following data:</p>
<pre><code>student_name  grade
------------  -----
Lisa          98
Bart          41
Nelson        11</code></pre>
<p><span epub:type="pagebreak" title="139" id="Page_139"/>Your query to check if each student passed the exam should look similar to the following:</p>
<pre><code>select  student_name,
        if(grade &gt; 59, 'pass', 'fail')
from    test_result;</code></pre>
<p>The condition you’re testing is whether the student’s <code>grade</code> is greater than <code>59</code>. If so, you return the text <code>pass</code>. If not, you return the text <code>fail</code>. The results are:</p>
<pre><code>student_name  if(grade &gt; 59, 'pass', 'fail')
------------  ------------------------------
Lisa                       pass
Bart                       fail
Nelson                     fail</code></pre>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">Note</span></h2>
<p>	There is also an <code>if</code> statement that is described in <a class="xref" href="c11.xhtml">Chapter 11 </a>that you’ll use when you create your own functions and procedures. This statement is different from the <code>if()</code> function described here.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>MySQL also has a <code>case</code> operator that lets you perform more sophisticated logic than the <code>if()</code> function. The <code>case</code> operator lets you test more than one condition and returns the result for the first condition that is met. In the following query, you select the student name and add a comment to the student based on their grade:</p>
<pre><code>select  student_name,
case
  when grade &lt; 30 then 'Please retake this exam'
  when grade &lt; 60 then 'Better luck next time'
  else 'Good job'
end
from test_result;</code></pre>
<p>The <code>case</code> operator uses a matching <code>end</code> keyword that marks the end of the <code>case</code> statement.</p>
<p>For any students who received a grade less than 30, the <code>case</code> statement returns <code>Please retake this exam</code> and then control is passed to the <code>end</code> statement.</p>
<p>Students who received a grade of 30 or more aren’t handled by the first <code>when</code> condition of the <code>case</code> statement, so control drops to the next line.</p>
<p>If a student received a grade of 30 or higher but less than 60, <code>Better luck next time</code> is returned and control passes to the <code>end</code> statement.</p>
<p>If a student’s grade didn’t match either of the <code>when</code> conditions, meaning the student scored higher than 60, control drops to the <code>else</code> keyword, where <code>Good job</code> is returned. You use an <code>else</code> clause to capture any student grades that aren’t handled by the first two conditions. The results are:</p>
<pre><code>student_name  case when grade &lt; 30 then 'Please...
------------  ------------------------------------
Lisa          Good job
<span epub:type="pagebreak" title="140" id="Page_140"/>Bart          Better luck next time
Nelson        Please retake this exam</code></pre>
<p>Unlike the <code>if()</code> function—which returns a result if a condition is <code>true</code> or <code>false</code>—<code>case</code> lets you check several conditions and returns a result based on the first condition that is met.</p>
<h3 id="h2-503007c08-0034"><a class="XrefDestination" id="version()"/><span class="XrefDestination" id="xref-503007c08-073"/>version()</h3>
<p class="BodyFirst">The <code>version()</code> function returns the version of MySQL you are using:</p>
<pre><code>select version();</code></pre>
<p>The result is:</p>
<pre><code>version
-------
8.0.27</code></pre>
<p>The version of MySQL installed on my server is 8.0.27. Yours may be different.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="boxcustom1">
<h2>Try It Yourself</h2>
<p class="BoxListNumberCustom1"><b>8-9.</b>	In the <code>electricity</code> database, the <code>electrician</code> table contains the following data:</p>
<pre><code>electrician     years_experience
--------------  ----------------
Zach Zap               1
Wanda Wiring           6
Larry Light           21</code></pre>
<p class="ListBody">In this company, an electrician with less than 5 years’ experience gets the <code>Journeyman</code> title; an electrician with between 5 and 10 years’ experience has the <code>Apprentice</code> title; and the <code>Master Electrician</code> title is given to those with 10 years’ experience or more.</p>
<p class="ListBody">The following query was written to display each electrician’s name and title, but it is returning the wrong results:</p>
<pre><code>select  name,
case
  when years_experience &lt; 10 then 'Apprentice'
  when years_experience &lt; 5 then 'Journeyman'
  else 'Master Electrician'
end
from    electrician;</code></pre>
<p class="ListBody"><span epub:type="pagebreak" title="141" id="Page_141"/>The results are:</p>
<pre><code>name            case when years_e...
--------------  ------------------
Zach Zap        Apprentice
Wanda Wiring    Apprentice
Larry Light     Master Electrician</code></pre>
<p class="ListBody"><code>Zach Zap</code> should be appearing as a <code>Journeyman</code>, not an <code>Apprentice</code>. What is wrong with the query? Modify the query to return the correct names and titles.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-503007c08-0011"><a class="XrefDestination" id="Summary"/><span class="XrefDestination" id="xref-503007c08-075"/>Summary</h2>
<p class="BodyFirst">In this chapter, you looked at how to call MySQL built-in functions and pass values, known as arguments, to those functions. You explored the most useful functions and saw how to locate the more obscure ones when necessary. In the next chapter, you’ll look at how to insert, update, and delete data from a MySQL database.</p>
</section>
</div>
</div>
</body></html>