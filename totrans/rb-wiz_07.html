<html><head></head><body>
  <div class="chapter" title="Chapter&#xA0;8.&#xA0;Everything Is an Object (Almost)">&#13;
    <div class="titlepage">&#13;
      <h1 class="title" id="heading_id_2"><a id="everything_is_an_object_left_parenthesis"/>Chapter 8. Everything Is an Object (Almost)</h1>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="The Subject of Our Story Is an Object">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_3"><a id="subject_of_our_story_is_an_object"/>The Subject of Our Story Is an Object</h1>&#13;
      </div>&#13;
&#13;
      <p><a class="indexterm" id="iddle1623"/><a class="indexterm" id="iddle1831"/>Scarlet ran to the Computing Contraption. “Do you know the name of that directory of everyone in the kingdom?” she called to the King. “It’s a hash that associates everyone’s name with his or her address.”</p>&#13;
&#13;
      <p>“Let’s see,” said the King. “Ah, yes! I’m pretty sure it’s called <code class="literal">citizens</code>.”</p>&#13;
&#13;
      <p>Scarlet nodded and began typing into IRB. When she pressed <span class="smaller">ENTER</span>, this is what she saw:</p><a id="pro_id00201"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">citizens</span></strong></span>&#13;
=&gt; {&#13;
  :aaron_a_aardvark =&gt; 'A van down by the river',&#13;
  :alice_b_abracadabra =&gt; 'The green house with two chimneys',&#13;
  :trady_blix =&gt; 'Mal Abochny',&#13;
  # ...and so on and so forth&#13;
</pre>&#13;
&#13;
      <p><a class="indexterm" id="iddle1334"/><a class="indexterm" id="iddle1806"/>The King peered over her shoulder. “That’s it!” he said. “But whoa! There must be a bajillion people in the kingdom! How will we find Wherefore?”</p>&#13;
&#13;
      <p>Scarlet typed some more:</p><a id="pro_id00202"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">citizens.size</span></strong></span>&#13;
=&gt; 24042&#13;
</pre>&#13;
&#13;
      <p>“Yeah, the hash is definitely too big to go through by hand,” Scarlet said, “but I bet we can write our own method to find him!”</p>&#13;
&#13;
      <p>Ruben studied the <code class="literal">citizens</code> hash for a minute. “Remember how we could get the value of a hash key by typing the hash name, then the key in square brackets?” he asked.</p>&#13;
&#13;
      <p>“Yep,” Scarlet said.</p>&#13;
&#13;
      <p>“Well,” Ruben said, “what if we just write a method that takes a person’s name and the <code class="literal">citizens</code> hash, then tries to find that name in the hash?”</p>&#13;
&#13;
      <p>“Ruben, you’re a genius!” Scarlet said. She quickly typed:</p><a id="pro_id00203"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">def find_person(name, people)</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">if people[name]</span></strong></span>&#13;
&gt;&gt;     <span class="strong"><strong><span class="red">puts people[name]</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">else</span></strong></span>&#13;
&gt;&gt;     <span class="strong"><strong><span class="red">puts 'Not found!'</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
</pre>&#13;
&#13;
      <p>“Hang on, hang on. What’s all this?” the King asked. “Just a quick method I whipped up,” Scarlet said. “See? It’s called <code class="literal">find_person</code>, and it takes a person’s <code class="literal">name</code> as a symbol and a hash of <code class="literal">people</code> as parameters. If it finds the name in the hash, it prints it out; otherwise, it says the name’s not found!” She typed:</p><a id="pro_id00204"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">find_person(:wherefore, citizens)</span></strong></span>&#13;
=&gt; One half mile due east!&#13;
</pre>&#13;
&#13;
      <p>“There it is!” Scarlet said. “It found the <code class="literal">:wherefore</code> key in the <code class="literal">citizens</code> hash.”</p>&#13;
&#13;
      <p>“One half mile due east!” said the Off-White Knight. “That should only take a few minutes, and east is that way. Let’s go!”</p>&#13;
&#13;
      <p>The Dagron rose to her full height, blotting out the sun for an instant. “I’ll come as well,” she said. “Wherefore and I are old friends, and we haven’t spoken in some time. It will be good to see him again.”</p>&#13;
&#13;
      <p>“Well, then,” said the King, “lead the way!”</p>&#13;
&#13;
      <p>The Off-White Knight and the Dagron turned and headed toward the late morning sun, and the King, Scarlet, and Ruben followed. The trees became taller and closer together as they walked, and after a few minutes, the sun could only be seen as a warm red light through the tops of the Carmine Pines.</p>&#13;
&#13;
      <p>“Hold on a second,” Ruben said, stopping and turning his head to one side. “Do you hear that?”</p>&#13;
&#13;
      <p>They all paused. The King cupped his hand to his ear, shook his head, wiggled his little finger around in his ear, then cupped his hand to it again. “I don’t hear anything,” he said.</p>&#13;
&#13;
      <p>“I think I hear it too,” said the Dagron. “It’s—”</p>&#13;
&#13;
      <p>“Music!” cried Ruben. “It’s coming from over there!” He pointed a little to the right of where they’d been headed.</p>&#13;
&#13;
      <p>“Let’s go!” said Scarlet, and the group pressed on into the Pines.</p>&#13;
&#13;
      <p>The music grew louder, and after walking through a particularly dense thicket of trees, the group found themselves on the edge of a small meadow. In the very center, perched on a wide tree stump, was a man in a scarlet tunic and archer’s cap with a long white feather in it. He was playing a pink mandolin and occasionally stopping to furiously scribble on a long roll of parchment with a quill pen, which sported the same type of long white feather as his cap.</p>&#13;
&#13;
      <p>“Wherefore!” boomed the Dagron.</p>&#13;
&#13;
      <p>The man on the stump stopped scribbling and looked up. A wide grin broke out across his face. “The Dagron!” he called. “Wonderful to see you! Come in, come in, come in.”</p>&#13;
&#13;
      <div class="informalfigure">&#13;
        <a id="med_id00038a"/>&#13;
&#13;
        <div class="mediaobject"><a id="med_id00038"/><img alt="image with no caption" src="../Images/httpatomoreillycomsourcenostarchimages2160029.png.jpg"/></div>&#13;
      </div>&#13;
&#13;
      <p>Led by the Dagron, the group crossed the meadow and circled around Wherefore. Wherefore leapt nimbly from his stump, removed his cap, and bowed deeply.</p>&#13;
&#13;
      <p>“Friends,” he said, “welcome to my forest stronghold!” He gestured to the stump. “It’s not much to look at now, but I’ve always had a weak spot for a fixer-upper. And I,” he said, “am your humble host, Wherefore the Wand’ring Minstrel.” Wherefore replaced his cap on his head. “I know, of course, the Dagron, and I’ve met the Off-White Knight before.” He looked at the King and pressed his palms together. “Your Majesty,” he said. “I’ve not had the pleasure of meeting you before, but it <span class="emphasis"><em>is</em></span> a pleasure.”</p>&#13;
&#13;
      <p>“Likewise,” said the King. “We’ve heard much about you!”</p>&#13;
&#13;
      <p>Wherefore turned to Ruben and Scarlet. “Which leaves you fine rapscallions. What do you call yourselves?”</p>&#13;
&#13;
      <p>“I’m Scarlet,” said Scarlet, “and this is Ruben.”</p>&#13;
&#13;
      <p>“Hi!” said Ruben.</p>&#13;
&#13;
      <p>“Hello and hello!” said Wherefore. “Wonderful to meet you. I’m afraid you’ve caught me at a bit of a bad time, though.” He sighed. “I’ve spent all morning writing a ballad, and it’s hardly half done. I’ve got to get back to it immediately if I’m going to finish it before nightfall.”</p>&#13;
&#13;
      <p>“A ballad?” said Scarlet.</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1143"/><a class="indexterm" id="iddle1174"/><a class="indexterm" id="iddle1617"/><a class="indexterm" id="iddle1624"/>“Oh, yes,” Wherefore said, “you see, I’m something of a businessman. I operate a small-time ballad delivery service with dozens of customers. The only catch is,” he said, “that this means I do in fact have <span class="emphasis"><em>dozens</em></span> of customers, and each ballad takes me hours to write. I can hardly keep up!” He pulled a handkerchief from his tunic pocket and mopped his brow.</p>&#13;
&#13;
      <p>The Dagron hummed thoughtfully, exhaling little puffs of smoke. “You know,” she said, “I think I can be of service.” She looked around the nearly empty meadow. “But I’ll need a little Ruby magic. Do you happen to have a Computing Contraption nearby?”</p>&#13;
&#13;
      <p>Wherefore laughed. “<span class="emphasis"><em>Do</em></span> I have a Computing Contraption!” he said, and he stepped on the largest root of the tree stump. The stump shuddered, then rose a few feet out of the ground. It rotated slowly as it emerged, revealing the familiar glow of a Computing Contraption screen!</p>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="Classes and Objects">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_4"><a id="classes_and_objects"/>Classes and Objects</h1>&#13;
      </div>&#13;
&#13;
      <p>“Wonderful,” said the Dagron, coiling herself around the stump and leaning in close to the screen. “Now then! Every object in your Ruby program has a unique ID number,” she said. “You’ll find that objects you create usually have much higher numbers than objects Ruby creates. See?” She touched the screen of the Computing Contraption with her claw and said, “Ruby has a few objects that are very familiar, like <code class="literal">0</code> or <code class="literal">true</code>. Each object in Ruby has its very own ID number, and that’s how Ruby keeps track of them all. Have a look!”</p><a id="pro_id00205"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">0.object_id</span></strong></span>&#13;
=&gt; 1&#13;
&gt;&gt; <span class="strong"><strong><span class="red">true.object_id</span></strong></span>&#13;
=&gt; 20&#13;
</pre>&#13;
&#13;
      <p>“Built-in Ruby objects like these get ID numbers from Ruby automatically when IRB starts or the script loads,” the Dagron continued. “Ruby also gives IDs to Ruby objects we create in our programs, but they’re very high numbers. This is because Ruby <a class="indexterm" id="iddle1584"/>comes with so many built-in objects for us!” She touched the Computing Contraption again, and more text appeared:</p><a id="pro_id00206"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">:baloney.object_id</span></strong></span>&#13;
=&gt; 1238088&#13;
&gt;&gt; <span class="strong"><strong><span class="red">"The Ballad of Wherefore the Wand'ring Minstrel".object_id</span></strong></span>&#13;
=&gt; 2174481360&#13;
</pre>&#13;
&#13;
      <p>“How did she do that?” Ruben whispered to the Off-White Knight. “She didn’t even type anything!”</p>&#13;
&#13;
      <p>“She doesn’t need to,” the knight whispered back. “Dragons are magical creatures, and the Dagron is one of the most magical of all.”</p>&#13;
&#13;
      <p>“But where do all these objects come from?” the Dagron asked. Wherefore sat cross-legged on the ground and looked up expectantly at her.</p>&#13;
&#13;
      <p>“From <span class="emphasis"><em>classes</em></span>,” the Dagron said, answering her own question. “You can think of Ruby classes as little machines that make objects of a certain type, and each object in Ruby knows what class it belongs to. We can use the <code class="literal">class</code> method to ask objects what their classes are. To start, Ruby numbers are from the <code class="literal">Fixnum</code> class. Behold!” she said, and more code appeared on the screen:</p><a id="pro_id00207"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">7.class</span></strong></span>&#13;
=&gt; Fixnum&#13;
</pre>&#13;
&#13;
      <p>“A string’s class is naturally . . . <code class="literal">String</code>!” she continued:</p><a id="pro_id00208"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">'Odelay!'.class</span></strong></span>&#13;
=&gt; String&#13;
</pre>&#13;
&#13;
      <p>“That’s nice to know,” interrupted the King, “but what <span class="emphasis"><em>good</em></span> does it do us?”</p>&#13;
&#13;
      <p>“I was just getting to that,” said the Dagron. “When you know what class a Ruby object is, you can use the <code class="literal">new</code> method to make a new object of that class. You’ve seen this before, yes?” She gestured at new code on the screen:</p><a id="pro_id00209"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">greeting = 'Hello!'</span></strong></span>&#13;
</pre>&#13;
&#13;
      <p>“Yup!” said Ruben.</p>&#13;
&#13;
      <p>“Well, now you can do <span class="emphasis"><em>this</em></span>!” said the Dagron, touching the Computing Contraption once more.</p><a id="pro_id00210"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">greeting = String.new('Hello!')</span></strong></span>&#13;
=&gt; "Hello!"&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">greeting</span></strong></span>&#13;
=&gt; "Hello!"&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">greeting.class</span></strong></span>&#13;
=&gt; String&#13;
</pre>&#13;
&#13;
      <p>“You see?” said the Dagron, folding her claws. “Every object in Ruby has a class, which we can find with the <code class="literal">class</code> method. Not only that, but every object is created by a class with the <code class="literal">new</code> method, and it’s the class’s job to produce objects of a particular type!”</p>&#13;
&#13;
      <p>“So the class is like a cookie cutter, stamping out particular kinds of cookies,” said Wherefore, hitting his palm with his closed fist in a stamping motion. “Gingerbread men, chocolate chip cookies, sugar cookies shaped like snowflakes. And the objects are the cookies!”</p>&#13;
&#13;
      <p>“That’s a very good way of thinking about it,” said the Dagron.</p>&#13;
&#13;
      <p>“When’s lunch?” asked Wherefore.</p>&#13;
&#13;
      <div class="informalfigure">&#13;
        <a id="med_id00039a"/>&#13;
&#13;
        <div class="mediaobject"><a id="med_id00039"/><img alt="image with no caption" src="../Images/httpatomoreillycomsourcenostarchimages2160031.png.jpg"/></div>&#13;
      </div>&#13;
&#13;
      <p><a class="indexterm" id="iddle1166"/><a class="indexterm" id="iddle1544"/><a class="indexterm" id="iddle1783"/>“I’m afraid I still don’t quite understand,” the King interrupted. “And I’m still a bit mystified as to what makes classes so important.”</p>&#13;
&#13;
      <p>“I think I can help with that one,” said Scarlet. “When we’re dealing with numbers or strings, the helpful things classes do might not be obvious. But if we’re creating our <span class="emphasis"><em>own</em></span> objects with their <span class="emphasis"><em>own</em></span> new classes, classes become a way of creating a bunch of objects from a template. For example, if we have a <code class="literal">Minstrel</code> class, we can make a bunch of minstrels!”</p>&#13;
&#13;
      <p>“How?” asked the King.</p>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="Creating Our First Class, Minstrel">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_5"><a id="creating_our_first_classcomma_minstrel"/>Creating Our First Class, Minstrel</h1>&#13;
      </div>&#13;
&#13;
      <p>“I’m glad you asked! Let’s give it a try,” said the Dagron. She touched the Computing Contraption, and more code filled the screen.</p>&#13;
&#13;
      <div class="note" title="Note">&#13;
        <h3 class="title" id="heading_id_6"><a id="ch08note01"/>Note</h3>&#13;
&#13;
        <p><span class="emphasis"><em>For some of these longer code examples, we’ll write Ruby scripts! Whenever you see a filename in italics above the code, like</em></span> minstrel.rb <span class="emphasis"><em>for the next example, that means you can type the code into your text editor and save it as a file with the given name.</em></span></p>&#13;
      </div>&#13;
&#13;
      <p><span class="bolditalic red">minstrel.rb</span></p><a id="pro_id00211"/>&#13;
      <pre class="programlisting">&#13;
class Minstrel&#13;
  def initialize(name)&#13;
    @name = name&#13;
  end&#13;
&#13;
  def introduce&#13;
    puts "My name is #{@name}!"&#13;
  end&#13;
&#13;
  def sing&#13;
    puts 'Tralala!'&#13;
  end&#13;
end&#13;
</pre>&#13;
&#13;
      <p><a class="indexterm" id="iddle1154"/><a class="indexterm" id="iddle1271"/><a class="indexterm" id="iddle1415"/><a class="indexterm" id="iddle1450"/><a class="indexterm" id="iddle1491"/><a class="indexterm" id="iddle1522"/><a class="indexterm" id="iddle1572"/>“Now then,” the Dagron said, clearing her throat, “let’s have a look. The <code class="literal">class</code> keyword tells Ruby you’d like to make a new class,” she said. “Just like you use <code class="literal">def</code> and <code class="literal">end</code> to tell Ruby you’re defining a new method, you use <code class="literal">class</code> and <code class="literal">end</code> to tell Ruby you’d like to create a new class.</p>&#13;
&#13;
      <p>“After <code class="literal">class</code>, you type the name of the class, which can be whatever you like,” the Dagron explained. “Class names, however, <span class="emphasis"><em>always</em></span> begin with a capital letter, like <code class="literal">Minstrel</code>.” Wherefore had turned his parchment over and was taking notes as quickly as he could on the back of his ballad. “We’re creating the <code class="literal">Minstrel</code> class, so we can make lots of new minstrels.”</p>&#13;
&#13;
      <p>“Between <code class="literal">class</code> and that final <code class="literal">end</code>, you can add any methods you wish, just as you would define them outside a class,” the Dagron continued. “In the <code class="literal">Minstrel</code> class, I defined three: <code class="literal">initialize</code>, <code class="literal">introduce</code>, and <code class="literal">sing</code>.”</p>&#13;
&#13;
      <p>Ruben leaned in close to the Computing Contraption’s screen. “Why does that <code class="literal">@name</code> variable have an <code class="literal">@</code> in front of it?” he asked.</p>&#13;
&#13;
      <p>“All in good time,” said the Dagron.</p>&#13;
&#13;
      <div class="note" title="Note">&#13;
        <h3 class="title" id="heading_id_7"><a id="ch08note02"/>Note</h3>&#13;
&#13;
        <p><span class="emphasis"><em>To follow along with the Dagron, we’ll need to load her script into IRB. When we want to use code in IRB from a file we’ve written, we just start IRB while we’re in the folder that contains our Ruby script, then use the <code class="literal">load</code> command to load the file. Load</em></span> minstrel.rb <span class="emphasis"><em>like this:</em></span></p><a id="pro_id00212"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">load 'minstrel.rb'</span></strong></span>&#13;
=&gt; true&#13;
</pre>&#13;
&#13;
        <p><span class="emphasis"><em>Now let’s give the Dagron’s code a try!</em></span></p>&#13;
      </div>&#13;
&#13;
      <p>“First, let’s look at the <code class="literal">Minstrel</code> class’s <code class="literal">initialize</code> method. This gets called whenever we make a new instance of the class with the <code class="literal">new</code> method. Have a look!” The Dagron added more code to the screen.</p><a id="pro_id00213"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore = Minstrel.new('Wherefore')</span></strong></span>&#13;
=&gt; #&lt;Minstrel:0x000001052c77b0 @name="Wherefore"&gt;&#13;
</pre>&#13;
&#13;
      <p>“When we call <code class="literal">Minstrel.new</code>, we make a new minstrel. Because <code class="literal">initialize</code> takes a single parameter, <code class="literal">name</code>, we pass in a name <a class="indexterm" id="iddle1011"/><a class="indexterm" id="iddle1442"/><a class="indexterm" id="iddle1627"/><a class="indexterm" id="iddle1673"/>when we call the <code class="literal">new</code> method. See the <code class="literal">@name="Wherefore"</code> bit there? It means <code class="literal">wherefore</code>’s name is <code class="literal">'Wherefore'!</code>” The Dagron puffed thoughtfully for a second. “So if there’s any code you want to run as soon as a new instance of your class is created, you put it in the definition of your class’s <code class="literal">initialize</code> method.”</p>&#13;
&#13;
      <p>“Got it,” said the King.</p>&#13;
&#13;
      <p>“Now all that <code class="literal">Proc.new</code> stuff makes way more sense!” said Ruben. “We were just making new procs whenever we called <code class="literal">new</code>!”</p>&#13;
&#13;
      <p>“That’s right!” said the Off-White Knight. “<code class="literal">Proc</code> is a built-in Ruby class, and whenever we call <code class="literal">new</code>, we create a new one. We basically have a little factory that generates new procs whenever we want. And that’s all classes are: little factories that make objects!”</p>&#13;
&#13;
      <p>“Precisely,” puffed the Dagron, and she almost seemed to smile.</p>&#13;
&#13;
      <p>“What about the other two methods you added?” Scarlet asked.</p>&#13;
&#13;
      <p>“Ah, yes,” said the Dagron. “Our <code class="literal">wherefore</code> is a <code class="literal">Minstrel</code>, so he has access to those methods automatically.”</p><a id="pro_id00214"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore.introduce</span></strong></span>&#13;
My name is Wherefore!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“You see?” she said. “The <code class="literal">introduce</code> method prints a string with the minstrel’s name in it, which in this case is Wherefore. And not only can he introduce himself, he can also sing!”</p><a id="pro_id00215"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore.sing</span></strong></span>&#13;
Tralala!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>“We’ve talked about how classes make objects of a certain type,” said the Dagron, “but we haven’t really mentioned what an object <span class="emphasis"><em>is</em></span>. It’s quite simple: objects are just little collections of values! You can think of them as buckets of information—a thing that might have a name, or a size, or a color. Each object gets methods from its class that let us talk about its name or size or color, and that’s what makes up our Ruby code.”</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1008"/><a class="indexterm" id="iddle1101"/><a class="indexterm" id="iddle1159"/><a class="indexterm" id="iddle1358"/><a class="indexterm" id="iddle1430"/><a class="indexterm" id="iddle1493"/><a class="indexterm" id="iddle1773"/><a class="indexterm" id="iddle1918"/><a class="indexterm" id="iddle1926"/><a class="indexterm" id="iddle1932"/>“All right,” said the King, “I think I understand why classes are so important now: they let you reuse your code for many objects without having to rewrite all the information and methods each time, and Ruby code is made up of objects. But let’s go back to Ruben’s question—what was that kooky spiral we saw on <code class="literal">wherefore</code>’s <code class="literal">@name</code>?”</p>&#13;
&#13;
      <p>“The at sign (<code class="literal">@</code>) just shows Ruby that it’s a special kind of variable—the kind that talks about an object’s value, like its name or size or color! I’ll explain that a little more. Let’s try out an example using weezards,” said Wherefore.</p>&#13;
&#13;
      <p>“You mean wizards,” said Scarlet.</p>&#13;
&#13;
      <p>“No, weezards,” said Wherefore. “Short wizards. Wee things. Weezards.”</p>&#13;
&#13;
      <div class="informalfigure">&#13;
        <a id="med_id00040a"/>&#13;
&#13;
        <div class="mediaobject"><a id="med_id00040"/><img alt="image with no caption" src="../Images/httpatomoreillycomsourcenostarchimages2160033.png.jpg"/></div>&#13;
      </div>&#13;
&#13;
      <p>“Very well,” said the Dagron. “But to get there, I’ll need to explain the four different kinds of Ruby variables.”</p>&#13;
&#13;
      <p>“Four kinds!” exclaimed the King. “I thought there was only one!”</p>&#13;
&#13;
      <p>“The variables you’re used to seeing are called <span class="emphasis"><em>local variables</em></span>,” said the Dagron. “They’re very good for creating a variable that you’re going to use quickly. But once we start writing our own methods and classes, we’ll need to create variables that can be defined inside those method and class definitions but are used much later—for example, when we finally call a method or create an instance of a class.”</p>&#13;
&#13;
      <p>“The other three kinds of variables,” the Dagron continued, “are <span class="emphasis"><em>global variables</em></span>, <span class="emphasis"><em>class variables</em></span>, and <span class="emphasis"><em>instance variables</em></span>. It may seem confusing that we use different kinds of variables in different places, but once you get the hang of it, it’s very easy.”</p>&#13;
&#13;
      <p>“What do you mean by different places?” Scarlet asked.</p>&#13;
&#13;
      <p>“<span class="emphasis"><em>Scopes</em></span>,” said the Dagron.</p>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="Variable Scope">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_8"><a id="variable_scope"/>Variable Scope</h1>&#13;
      </div>&#13;
&#13;
      <p><a class="indexterm" id="iddle1530"/><a class="indexterm" id="iddle1774"/><a class="indexterm" id="iddle1935"/>Oh man, this is getting good. We’re getting into the real meat of the language! <span class="emphasis"><em>Scope</em></span> is a very important idea in Ruby, and I got so excited, well, I just couldn’t contain myself. I hope it’s okay if I take a second to explain scope to you while the Dagron explains it to our intrepid heroes. It’ll take but a minute.</p>&#13;
&#13;
      <p>This might come as a surprise to you, but not all variables are available for you to use willy-nilly at any point in a Ruby program. There are times in your program where even though you’ve defined a variable, if you try to use it, Ruby will complain and say it doesn’t exist! What could this mean?</p>&#13;
&#13;
      <p>What it means is this: at any given point in your program, only <span class="emphasis"><em>some</em></span> of the variables and methods you’ve defined can be seen. The collection of variables and methods that can be seen at any given time in your program defines the current scope; you can use anything that’s in scope, and you can’t use anything that’s out of scope.</p>&#13;
&#13;
      <p>What determines your variable’s scope in Ruby? For now, here’s a good rule of thumb: new scopes are created inside a method definition, inside a class definition, and inside a block. So if you’re using the run-of-the-mill local variables we’ve been using, this will work perfectly:</p><a id="pro_id00216"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">regular_old_variable = 'Hello!'</span></strong></span>&#13;
=&gt; "Hello!"&#13;
</pre>&#13;
&#13;
      <p>We’re just setting a <code class="literal">regular_old_variable</code> to the string <code class="literal">'Hello!'</code>. Pretty standard stuff.</p>&#13;
&#13;
      <p>Next, we’ll define a variable within a method:</p><a id="pro_id00217"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">def fancy_greeting</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">greeting = 'Salutations!'</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>Here, we’re defining the variable named <code class="literal">greeting</code> inside a method named <code class="literal">fancy_greeting</code>. You’ve seen method definitions before, so there’s nothing new here, either!</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1130"/><a class="indexterm" id="iddle1172"/><a class="indexterm" id="iddle1301"/><a class="indexterm" id="iddle1880"/><a class="indexterm" id="iddle1923"/>Next, we’ll revisit blocks:</p><a id="pro_id00218"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">3.times { |number| puts number }</span></strong></span>&#13;
0&#13;
1&#13;
2&#13;
=&gt; 3&#13;
</pre>&#13;
&#13;
      <p>You’re a block expert by this point, so you’ve got this too: we’re calling the <code class="literal">times</code> method on the number <code class="literal">3</code> and passing it a block. Inside the block, we use the variable <code class="literal">number</code> to keep track of which number we’re on, and we print out each number from 0 to 2 in turn. (Don’t forget that computers start counting things at 0, not 1.)</p>&#13;
&#13;
      <div class="sect2" title="These Variable Errors Will Shock and Surprise You!">&#13;
        <div class="titlepage">&#13;
          <h2 class="title" id="heading_id_9"><a id="these_variable_errors_will_shock_and_sur"/>These Variable Errors Will Shock and Surprise You!</h2>&#13;
        </div>&#13;
&#13;
        <p>What might surprise you, though, is that some of this stuff will cause Ruby to throw an error! Let’s look at these one by one. In the following code, we start by defining a variable. But that <code class="literal">regular_old_variable</code> exists outside the class definition of <code class="literal">FancyThings</code> (in the outer <span class="emphasis"><em>scope</em></span>), so it <span class="emphasis"><em>doesn’t</em></span> exist inside the class definition!</p><a id="pro_id00219"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">regular_old_variable = 'Hello!'</span></strong></span>&#13;
=&gt; "Hello!"&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">class FancyThings</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts regular_old_variable</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
NameError: undefined local variable or method `regular_old_variable'&#13;
for FancyThings:Class&#13;
</pre>&#13;
&#13;
        <p>Inside class definitions, you get a brand-new set of local variables (the kinds of variables you’ve seen all along so far), so Ruby rightfully tells you that inside the class, you don’t have anything called <code class="literal">regular_old_variable</code> yet.</p>&#13;
&#13;
        <p><a class="indexterm" id="iddle1137"/><a class="indexterm" id="iddle1286"/><a class="indexterm" id="iddle1539"/><a class="indexterm" id="iddle1565"/>The same goes for method definitions: they get their own sets of local variables, too, so when you define <code class="literal">regular_old_variable</code> within a method, it doesn’t exist outside the method definition:</p><a id="pro_id00220"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">def fancy_greeting</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts regular_old_variable</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">fancy_greeting</span></strong></span>&#13;
NameError: undefined local variable or method `regular_old_variable'&#13;
for main:Object&#13;
</pre>&#13;
&#13;
        <p>Another error!</p>&#13;
&#13;
        <p>And, as you might have already guessed, the <code class="literal">number</code> variable in our block example is <span class="emphasis"><em>local</em></span> to the block. It stops existing as soon as the block is over, so if we try to use it again after the block is finished, we get an error!</p><a id="pro_id00221"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">3.times { |number| puts number }</span></strong></span>&#13;
0&#13;
1&#13;
2&#13;
=&gt; 3&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">puts number</span></strong></span>&#13;
NameError: undefined local variable or method `number' for&#13;
main:Object&#13;
</pre>&#13;
&#13;
        <p>Here, for each number from 0 to 3, Ruby <code class="literal">puts</code> the <code class="literal">number</code> passed into the block. Now, here’s where blocks get interesting: just as with methods or classes, a variable defined in a block stops existing when the block is finished. <span class="emphasis"><em>Unlike</em></span> methods and classes, though, blocks can access variables and information that are outside them! In this case, our block knows about the number 3 and so knows that the variable <code class="literal">number</code> should take on each number between 0 and 3. Once the block is finished, though, Ruby no longer cares about <code class="literal">number</code>, so it causes an error if we try to use it again.</p>&#13;
&#13;
        <p>When I first learned that Ruby could see variables in some parts of a program and not others, I scratched my head for a <a class="indexterm" id="iddle1023"/><a class="indexterm" id="iddle1245"/><a class="indexterm" id="iddle1359"/><a class="indexterm" id="iddle1924"/>good while, and I’m sure you’re asking yourself the exact same thing I asked myself then: “If that’s true, how on Earth can I use variables that I make inside classes or methods elsewhere in my program?” Well, as luck would have it, the Dagron’s about to tell us!</p>&#13;
      </div>&#13;
&#13;
      <div class="sect2" title="Global Variables">&#13;
        <div class="titlepage">&#13;
          <h2 class="title" id="heading_id_10"><a id="global_variables"/>Global Variables</h2>&#13;
        </div>&#13;
&#13;
        <p>“Let’s start with <span class="emphasis"><em>global variables</em></span>, which can be seen from anywhere in the program. An example might help,” said the Dagron, and she touched the Computing Contraption’s screen with her claw:</p><a id="pro_id00222"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">$location = 'The Carmine Pines!'</span></strong></span>&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">def where_are_we?</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts $location</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">where_are_we?</span></strong></span>&#13;
The Carmine Pines!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
        <p>“Here,” said the Dagron, “we create a variable called <code class="literal">$location</code> that’s equal to the string <code class="literal">'The Carmine Pines!'</code>. Then we create a method, <code class="literal">where_are_we?</code>, that tries to access <code class="literal">$location</code>. Normally, this wouldn’t work, but because <code class="literal">$location</code> is a global variable, we get <code class="literal">'The Carmine Pines!'</code> when we call the <code class="literal">where_are_we?</code> method!”</p>&#13;
&#13;
        <p>“Aha! I’ve seen this kind of variable before,” said the Off-White Knight. “I recognize it by the dollar sign it starts with! Global variables can be useful, since they can be seen anywhere in a Ruby program. You can define a global variable outside a method, inside a method, in a class, anywhere you want, and if you try to use it anywhere else in your program, it will just work. But,” she said, holding up one finger, “if the variable can be seen anywhere in the program, it can also be <span class="emphasis"><em>changed</em></span> anywhere in the program, and it’s not always clear when or how that change happened.”</p>&#13;
&#13;
        <p><a class="indexterm" id="iddle1010"/><a class="indexterm" id="iddle1160"/><a class="indexterm" id="iddle1919"/><a class="indexterm" id="iddle1960"/>Scarlet nodded. “That’s right!” she said. “Remember when we found out that something was altering the variables in the Flowmatic Something-or-Other? Imagine how bad it would be if all our variables could be changed anywhere in our programs at any time!”</p>&#13;
&#13;
        <p>“Perish the thought!” said the King, shuddering. “We certainly don’t want <span class="emphasis"><em>that</em></span>. All right, so we won’t use global variables if we can help it! What are the other sorts of variables we can use?”</p>&#13;
      </div>&#13;
&#13;
      <div class="sect2" title="Class Variables">&#13;
        <div class="titlepage">&#13;
          <h2 class="title" id="heading_id_11"><a id="class_variables"/>Class Variables</h2>&#13;
        </div>&#13;
&#13;
        <p>“A wise choice, Your Majesty,” said the Dagron. “Another type of variable we can use is a <span class="emphasis"><em>class variable</em></span>, which is useful if we want a class to save some information about itself. Just as all global variables start with <code class="literal">$</code>, all class variables start with <code class="literal">@@</code>, and a class can have as many class variables as it wants. A class variable can be seen from inside the class and by any instances of the class; all instances share the same class variable. Now, Wherefore, we’ll use your weezard example.” She blew a smoke ring at the Computing Contraption, and this code filled the screen:</p>&#13;
&#13;
        <p><span class="bolditalic red">weezard.rb</span></p><a id="pro_id00223"/>&#13;
        <pre class="programlisting">&#13;
class Weezard&#13;
  @@spells = 5&#13;
&#13;
  def initialize(name, power='Flight')&#13;
    @name = name&#13;
    @power = power&#13;
  end&#13;
&#13;
  def cast_spell(name)&#13;
    if @@spells &gt; 0&#13;
      @@spells -= 1&#13;
      puts "Cast #{name}! Spells left: #{@@spells}."&#13;
    else&#13;
      puts 'No more spells!'&#13;
    end&#13;
  end&#13;
end&#13;
</pre>&#13;
&#13;
        <p><a class="indexterm" id="iddle1587"/>“We’ve defined a <code class="literal">Weezard</code> class with a class variable called <code class="literal">@@spells</code>,” said the Dagron, “as well as two methods: <code class="literal">initialize</code>, which sets up the name and power for a particular weezard, and <code class="literal">cast_spell</code>, which any weezard can use. Let’s go ahead and use <code class="literal">new</code> to create two new weezards with some special powers. Don’t forget to <code class="literal">load</code> the code you just wrote first!”</p><a id="pro_id00224"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">load 'weezard.rb'</span></strong></span>&#13;
=&gt; true&#13;
&gt;&gt; <span class="strong"><strong><span class="red">merlin = Weezard.new('Merlin', 'Sees the future')</span></strong></span>&#13;
=&gt; #&lt;Weezard:0x00000104949260 @name="Merlin", @power="Sees the&#13;
future"&gt;&#13;
&gt;&gt; <span class="strong"><strong><span class="red">fumblesnore = Weezard.new('Fumblesnore', 'Naps')</span></strong></span>&#13;
=&gt; #&lt;Weezard:0x0000010494c500 @name="Fumblesnore", @power="Naps"&gt;&#13;
</pre>&#13;
&#13;
        <p>“Here’s the interesting thing about our weezards,” the Dagron continued. “Even though <code class="literal">Merlin</code> and <code class="literal">Fumblesnore</code> have different powers, they’re interacting with the same variable, <code class="literal">@@spells</code>! Each time they use <code class="literal">cast_spell</code>, the spell variable decreases by one. Take a look.”</p><a id="pro_id00225"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">merlin.cast_spell('Prophecy')</span></strong></span>&#13;
Cast Prophecy! Spells left: 4.&#13;
=&gt; nil&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">fumblesnore.cast_spell('Nap')</span></strong></span>&#13;
Cast Nap! Spells left: 3.&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
        <p>“So when you create a class variable, there’s just one copy for the whole class, and any instances you create all share that one class variable?” Ruben asked.</p>&#13;
&#13;
        <p>“That’s right,” said the Dagron.</p>&#13;
&#13;
        <p>“It’s kind of weird that all weezards share a fixed group of spells, isn’t it?” asked Wherefore. “Wouldn’t it make sense for each weezard to have his own set of spells?”</p>&#13;
      </div>&#13;
&#13;
      <div class="sect2" title="Instance Variables">&#13;
        <div class="titlepage">&#13;
          <h2 class="title" id="heading_id_12"><a id="instance_variables"/>Instance Variables</h2>&#13;
        </div>&#13;
&#13;
        <p><a class="indexterm" id="iddle1009"/><a class="indexterm" id="iddle1102"/><a class="indexterm" id="iddle1431"/><a class="indexterm" id="iddle1927"/><a class="indexterm" id="iddle1961"/>The Dagron nodded. “Sometimes it makes sense for the class that creates objects to keep track of certain information, but not all that often,” she said. “For that reason, we don’t end up using a lot of class variables in Ruby; it’s mostly <span class="emphasis"><em>instance</em></span> and <span class="emphasis"><em>local</em></span> variables. In fact, with instance variables, we can give each weezard her own set of spells,” the Dagron continued, and more code appeared on the screen. “An instance variable can be seen from inside the class and by any instance of the class, just like class variables. The big difference is that each instance gets its very own copy of the variable!”</p>&#13;
&#13;
        <p><span class="bolditalic red">weezard_2.rb</span></p><a id="pro_id00226"/>&#13;
        <pre class="programlisting">&#13;
class Weezard&#13;
  def initialize(name, power='Flight')&#13;
    @name = name&#13;
    @power = power&#13;
    @spells = 5&#13;
  end&#13;
&#13;
  def cast_spell(name)&#13;
    if @spells &gt; 0&#13;
      @spells -= 1&#13;
      puts "Cast #{name}! Spells left: #{@spells}."&#13;
    else&#13;
      puts 'No more spells!'&#13;
    end&#13;
  end&#13;
end&#13;
</pre>&#13;
&#13;
        <p>“See how we’ve moved the <code class="literal">@@spells</code> variable from a variable that belongs to the class to a <code class="literal">@spells</code> instance variable inside the <code class="literal">initialize</code> method?” asked the Dagron. “Variables that start with <code class="literal">@</code> are <span class="emphasis"><em>instance variables</em></span>. They’re called instance variables because each <span class="emphasis"><em>instance</em></span>, which is what Ruby calls an object created by a class, has its own copy.”</p>&#13;
&#13;
        <p><a class="indexterm" id="iddle1429"/>“So when we create instances of the <code class="literal">Weezard</code> class with the <code class="literal">new</code> method, each instance will get assigned its own <code class="literal">@spells</code> variable?” Scarlet asked.</p>&#13;
&#13;
        <p>“Precisely,” said the Dagron. “In fact, let’s do that now. We’ll create our weezards, just as we did before.”</p><a id="pro_id00227"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">load 'weezard_2.rb'</span></strong></span>&#13;
=&gt; true&#13;
&gt;&gt; <span class="strong"><strong><span class="red">merlin = Weezard.new('Merlin', 'Sees the future')</span></strong></span>&#13;
=&gt; #&lt;Weezard:0x0000010459e160 @name="Merlin", @power="Sees the&#13;
future", @spells=5&gt;&#13;
&gt;&gt; <span class="strong"><strong><span class="red">fumblesnore = Weezard.new('Fumblesnore', 'Naps')</span></strong></span>&#13;
=&gt; #&lt;Weezard:0x000001045a13d8 @name="Fumblesnore", @power="Naps",&#13;
@spells=5&gt;&#13;
</pre>&#13;
&#13;
        <p>“This looks just like it did the last time we created weezards!” grumped the King.</p>&#13;
&#13;
        <p>“It’s very similar,” admitted the Dagron, “but there <span class="emphasis"><em>is</em></span> one important difference. Look what happens when each weezard casts a spell!”</p><a id="pro_id00228"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">merlin.cast_spell('Prophecy')</span></strong></span>&#13;
Cast Prophecy! Spells left: 4.&#13;
=&gt; nil&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">fumblesnore.cast_spell('Nap')</span></strong></span>&#13;
Cast Nap! Spells left: 4.&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
        <p>“They each have their own <code class="literal">@spells</code> variable!” said Scarlet. “That’s why <code class="literal">fumblesnore</code>’s spell count wasn’t affected when <code class="literal">merlin</code> cast a spell.”</p>&#13;
&#13;
        <p>“Exactly right,” said the Dagron. “Even though their <code class="literal">@spells</code> variables have the same names, each instance gets its own copy, so they don’t conflict with each other. Not only that, but because instances of classes can always access their instance variables, any instance variables we define in our classes’ <code class="literal">initialize</code> method can be used by the newly created objects.”</p>&#13;
&#13;
        <p><a class="indexterm" id="iddle1169"/><a class="indexterm" id="iddle1494"/><a class="indexterm" id="iddle1529"/><a class="indexterm" id="iddle1777"/><a class="indexterm" id="iddle1884"/><a class="indexterm" id="iddle1933"/>“That’s why we do things like <code class="literal">@name = name</code> in our <code class="literal">initialize</code> method definitions,” said the Off-White Knight. “It makes sure that when we pass in the <code class="literal">name</code> argument, each instance saves a copy in <code class="literal">@name</code>.”</p>&#13;
      </div>&#13;
&#13;
      <div class="sect2" title="Local Variables">&#13;
        <div class="titlepage">&#13;
          <h2 class="title" id="heading_id_13"><a id="local_variables"/>Local Variables</h2>&#13;
        </div>&#13;
&#13;
        <p>“Speaking of local variables,” said the Dagron, “let’s have a look at those, shall we? They should be quite familiar, but they’re worth a second look. A <span class="emphasis"><em>local variable</em></span> can be seen only in its current scope, which means it can be seen only in the method or class where it’s defined.”</p>&#13;
&#13;
        <p>New code appeared on the Computing Contraption’s screen:</p><a id="pro_id00229"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">class YeOldeClass</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">local_variable = 'I only exist inside the class!'</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">puts local_variable</span></strong></span>&#13;
NameError: undefined local variable or method `local_variable' for&#13;
main:Object&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">def yet_another_method</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">another_local = 'I only exist inside this method!'</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">puts another_local</span></strong></span>&#13;
NameError: undefined local variable or method `another_local' for&#13;
main:Object&#13;
</pre>&#13;
&#13;
        <p>“So really, local variables can be seen only inside the methods or classes where they’re defined, or we can use them outside <span class="emphasis"><em>all</em></span> class and method definitions,” Scarlet said.</p>&#13;
&#13;
        <p>“That’s right,” said the Dagron. “There is a special scope in Ruby called the <span class="emphasis"><em>top-level scope</em></span>, so if you define local variables outside <span class="emphasis"><em>any</em></span> method or class definition, Ruby can see them. Have a look!”</p><a id="pro_id00230"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">local_variable = "I'm the top-level local variable!"</span></strong></span>&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">def local_in_method</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">local_variable = "I'm the local variable in the method!"</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts local_variable</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">puts local_variable</span></strong></span>&#13;
I'm the top-level local variable!&#13;
=&gt; nil&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">local_in_method</span></strong></span>&#13;
I'm the local variable in the method!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
        <p><a class="indexterm" id="iddle1173"/><a class="indexterm" id="iddle1625"/>“You see?” said the Dagron. “Local variables can even have the exact same variable names, as long as they’re in different scopes! Ruby knows that the method definition gets its own set of local variables, so it doesn’t complain that there are two with the same name.”</p>&#13;
&#13;
        <p>“So local variables can be seen only in the classes or methods where we define them, or in this special top-level scope that’s outside any class or method,” said the King. “But global variables can be seen anywhere, and if we create an instance of a class, the instance can see any instance variables we created when we defined the class.”</p>&#13;
&#13;
        <p>“Precisely,” said the Dagron.</p>&#13;
&#13;
        <p>“And the class can see its own class variables,” the King continued.</p>&#13;
&#13;
        <p>“Correct!” said the Dagron. “In fact, it’s not just instances that can have methods like <code class="literal">initialize</code>, <code class="literal">introduce</code>, and <code class="literal">sing</code>; even <span class="emphasis"><em>classes</em></span> can have their own methods!”</p>&#13;
&#13;
        <p>“Just when I was starting to get this!” moaned the King. “How is that possible?”</p>&#13;
&#13;
        <p>“Because,” replied the Dagron, “Ruby classes <span class="emphasis"><em>are also objects</em></span>!”</p>&#13;
&#13;
        <p>“I need to sit down,” said the King.</p>&#13;
&#13;
        <p>“You <span class="emphasis"><em>are</em></span> sitting down,” said Wherefore.</p>&#13;
&#13;
        <p><a class="indexterm" id="iddle1412"/><a class="indexterm" id="iddle1556"/><a class="indexterm" id="iddle1630"/><a class="indexterm" id="iddle1795"/>“So I am,” said the King, who was sitting cross-legged between the Off-White Knight and the Wand’ring Minstrel. “Go on, Madame Dagron,” he said. “How can we add a method directly to a class itself, and not just an instance of a class?”</p>&#13;
      </div>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="Objects and self">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_14"><a id="objects_and_self"/>Objects and self</h1>&#13;
      </div>&#13;
&#13;
      <p>“Well,” said the Dagron, “Ruby keeps a special built-in variable named <code class="literal">self</code> around at all times, and <code class="literal">self</code> refers to whatever Ruby object we’re currently talking about.” She was talking quickly now, and small sparks leapt from her mouth as she continued. “So all we need to do is use <code class="literal">self</code> to define a method inside our class, and instead of adding that method to the instance, we add it to the class itself.”</p>&#13;
&#13;
      <p>“Perhaps an example would make things clearer,” said the Off-White Knight. She reached over and typed into the Computing Contraption:</p>&#13;
&#13;
      <p><span class="bolditalic red">monkey.rb</span></p><a id="pro_id00231"/>&#13;
      <pre class="programlisting">&#13;
class Monkey&#13;
  @@number_of_monkeys = 0&#13;
&#13;
  def initialize&#13;
    @@number_of_monkeys += 1&#13;
  end&#13;
&#13;
  def self.number_of_monkeys&#13;
    @@number_of_monkeys&#13;
  end&#13;
end&#13;
</pre>&#13;
&#13;
      <p>“Here I’ve created a <code class="literal">Monkey</code> class,” said the knight. “It has a <code class="literal">@@number_of_monkeys</code> class variable that will keep track of how many monkey instances we create, as well as the <code class="literal">initialize</code> method we’ve seen in classes before. When we call <code class="literal">new</code> on <code class="literal">Monkey</code> to create a new monkey, it will add 1 to the <code class="literal">@@number_of_monkeys</code>.”</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1157"/><a class="indexterm" id="iddle1290"/><a class="indexterm" id="iddle1605"/>“What about that <code class="literal">self.number_of_monkeys</code> method?” asked Ruben.</p>&#13;
&#13;
      <p>“That’s a class method!” said the knight. “It’s a method of the <code class="literal">Monkey</code> class itself, and when we call it, it will return the <code class="literal">@@number_of_monkeys</code>. Let’s have a look! First, we’ll load that script, and then we’ll create a few monkeys.”</p><a id="pro_id00232"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">load 'monkey.rb'</span></strong></span>&#13;
=&gt; true&#13;
&gt;&gt; <span class="strong"><strong><span class="red">monkey_1 = Monkey.new</span></strong></span>&#13;
=&gt; #&lt;Monkey:0x000001048fccf8&gt;&#13;
&gt;&gt; <span class="strong"><strong><span class="red">monkey_2 = Monkey.new</span></strong></span>&#13;
=&gt; #&lt;Monkey:0x00000104902310&gt;&#13;
&gt;&gt; <span class="strong"><strong><span class="red">monkey_3 = Monkey.new</span></strong></span>&#13;
=&gt; #&lt;Monkey:0x00000104907900&gt;&#13;
</pre>&#13;
&#13;
      <p>“Good!” said the Off-White Knight. “Now that we have some monkeys, let’s ask the <code class="literal">Monkey</code> class how many monkeys there are.” She typed into the Computing Contraption:</p><a id="pro_id00233"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">Monkey.number_of_monkeys</span></strong></span>&#13;
=&gt; 3&#13;
</pre>&#13;
&#13;
      <p>“Amazing!” said Wherefore. “But why not ask an individual monkey how many monkeys there are?”</p>&#13;
&#13;
      <p>“Well,” said the knight, “first, it doesn’t quite make sense to ask a monkey instance how many other instances there are—that’s the class’s business, not the instance’s! But more importantly, because we used <code class="literal">self</code> when we defined the <code class="literal">number_of_monkeys</code> method, it’s only a method of the class, not its instances! See?” She typed some more:</p><a id="pro_id00234"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">monkey_1.number_of_monkeys</span></strong></span>&#13;
NoMethodError: undefined method `number_of_monkeys' for&#13;
#&lt;Monkey:0x000001048fccf8&gt;&#13;
</pre>&#13;
&#13;
      <p>“There we are,” said the Dagron. “The <code class="literal">Monkey</code> class has its very own <code class="literal">number_of_monkeys</code> method now, but it’s only on the class itself; the monkey instances themselves don’t have that method.”</p>&#13;
&#13;
      <div class="informalfigure">&#13;
        <a id="med_id00041a"/>&#13;
&#13;
        <div class="mediaobject"><a id="med_id00041"/><img alt="image with no caption" src="../Images/httpatomoreillycomsourcenostarchimages2160035.png.jpg"/></div>&#13;
      </div>&#13;
&#13;
      <p><a class="indexterm" id="iddle1158"/><a class="indexterm" id="iddle1165"/><a class="indexterm" id="iddle1523"/><a class="indexterm" id="iddle1557"/>“In fact,” said the knight, “adding methods onto classes is common enough that Ruby has its own shorter syntax for it. It looks like this!” And she typed some more:</p>&#13;
&#13;
      <p><span class="bolditalic red">monkey_2.rb</span></p><a id="pro_id00235"/>&#13;
      <pre class="programlisting">&#13;
class Monkey&#13;
  @@number_of_monkeys = 0&#13;
&#13;
  def initialize&#13;
    @@number_of_monkeys += 1&#13;
  end&#13;
&#13;
  class &lt;&lt; self&#13;
    def number_of_monkeys&#13;
      @@number_of_monkeys&#13;
    end&#13;
  end&#13;
end&#13;
</pre>&#13;
&#13;
      <p>“See that?” she asked. “Instead of defining the <code class="literal">number_of_monkeys</code> method on the class with <code class="literal">self.number_of_monkeys</code>, I used <code class="literal">class &lt;&lt; self</code> to tell Ruby: ‘Hey! Every method I define until I say <code class="literal">end</code> is a method for the class, not its instances.’ Look what happens when I call the method on <code class="literal">Monkey</code> without creating any instances.”</p><a id="pro_id00236"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">load 'monkey_2.rb'</span></strong></span>&#13;
=&gt; true&#13;
&gt;&gt; <span class="strong"><strong><span class="red">Monkey.number_of_monkeys</span></strong></span>&#13;
=&gt; 0&#13;
</pre>&#13;
&#13;
      <p><a class="indexterm" id="iddle1433"/><a class="indexterm" id="iddle1532"/><a class="indexterm" id="iddle1929"/>“Now look what happens if I create an instance and call the method again,” said the knight.</p><a id="pro_id00237"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">monkey = Monkey.new</span></strong></span>&#13;
=&gt; #&lt;Monkey:0x0000010490af60&gt;&#13;
&gt;&gt; <span class="strong"><strong><span class="red">Monkey.number_of_monkeys</span></strong></span>&#13;
=&gt; 1&#13;
</pre>&#13;
&#13;
      <p>“See? It’s just like using <code class="literal">self.number_of_monkeys</code>,” the Off-White Knight said, beaming.</p>&#13;
&#13;
      <p>“Very interesting,” said the Dagron. “I’d never seen <code class="literal">class &lt;&lt; self</code> before.”</p>&#13;
&#13;
      <p>“Really?” asked Wherefore.</p>&#13;
&#13;
      <p>“No one knows everything,” said the Dagron. “Not even me!”</p>&#13;
&#13;
      <p>“Many people find the <code class="literal">def self.method_name</code> syntax easier to understand,” said the knight, “so it’s perfectly fine to use that whenever you need to add a method to a class.”</p>&#13;
&#13;
      <p>“Of course,” said Scarlet, “and now <code class="literal">self</code> makes so much more sense to me! It just refers to whatever the Ruby program is ‘talking about.’ And in this case, <code class="literal">self</code> is the class we’re inside!”</p>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="Methods and Instance Variables">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_15"><a id="methods_and_instance_variables"/>Methods and Instance Variables</h1>&#13;
      </div>&#13;
&#13;
      <p>“Precisely,” said the Dagron. “And with that, I have but one more trick to show you. You see, while it’s very easy to create instance variables for our instances, it’s not always so easy to get at them. See what I mean?” she said, and as she spoke, new code began to fill the screen:</p><a id="pro_id00238"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">class Minstrel</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">def initialize(name)</span></strong></span>&#13;
&gt;&gt;     <span class="strong"><strong><span class="red">@name = name</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
</pre>&#13;
&#13;
      <p><a class="indexterm" id="iddle1078"/><a class="indexterm" id="iddle1563"/>“I’ve re-created our <code class="literal">Minstrel</code> class from before, but with only an <code class="literal">initialize</code> method,” said the Dagron. “No <code class="literal">introduce</code> or <code class="literal">sing</code> methods! Let’s create an instance, like we did earlier.”</p><a id="pro_id00239"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore = Minstrel.new('Wherefore')</span></strong></span>&#13;
=&gt; #&lt;Minstrel:0x000001049637c8 @name="Wherefore"&gt;&#13;
</pre>&#13;
&#13;
      <p>“Now,” said the Dagron, “see how our minstrel instance has the name ‘Wherefore’? (You can tell by the <code class="literal">@name="Wherefore"</code> bit.) Let’s try to get to it.”</p><a id="pro_id00240"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore.name</span></strong></span>&#13;
NoMethodError: undefined method `name' for&#13;
#&lt;Minstrel:0x000001049637c8 @name="Wherefore"&gt;&#13;
</pre>&#13;
&#13;
      <p>“You see,” said the Dagron, “while <code class="literal">wherefore</code> has a <code class="literal">@name</code> instance variable, it doesn’t have a <code class="literal">name</code> <span class="emphasis"><em>method</em></span>. And when it comes to Ruby, all that matters are methods. In order to make <code class="literal">wherefore.name</code> actually work, we need to write a method to reach the <code class="literal">@name</code> instance variable.”</p>&#13;
&#13;
      <p>“Does that mean we’ll need to define a method in the <code class="literal">Minstrel</code> class called <code class="literal">name</code>?” Scarlet asked.</p>&#13;
&#13;
      <p>“That’s exactly right,” said the Dagron, and the code on the screen changed under her claw:</p>&#13;
&#13;
      <p><span class="bolditalic red">another_minstrel.rb</span></p><a id="pro_id00241"/>&#13;
      <pre class="programlisting">&#13;
class Minstrel&#13;
  def initialize(name)&#13;
    @name = name&#13;
  end&#13;
&#13;
  def name&#13;
    @name&#13;
  end&#13;
end&#13;
</pre>&#13;
&#13;
      <p>“Now we have a <code class="literal">name</code> method that returns the <code class="literal">@name</code> instance variable,” said the Dagron. “Let’s see what happens when we create a new minstrel with this <code class="literal">name</code> method and try to use it!”</p><a id="pro_id00242"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">load 'another_minstrel.rb'</span></strong></span>&#13;
=&gt; true&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore = Minstrel.new('Wherefore')</span></strong></span>&#13;
=&gt; #&lt;Minstrel:0x000001049637c8 @name="Wherefore"&gt;&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore.name</span></strong></span>&#13;
=&gt; "Wherefore"&#13;
</pre>&#13;
&#13;
      <p><a class="indexterm" id="iddle1032"/><a class="indexterm" id="iddle1079"/><a class="indexterm" id="iddle1279"/><a class="indexterm" id="iddle1291"/><a class="indexterm" id="iddle1574"/><a class="indexterm" id="iddle1575"/><a class="indexterm" id="iddle1606"/>“Huzzah!” cried the King. “We’ve done it! We’ve changed the minstrel’s name with the <code class="literal">name</code> method.”</p>&#13;
&#13;
      <p>“Truly wonderful,” said Wherefore, “but what if we want to change the minstrel’s name to something else?”</p>&#13;
&#13;
      <p>“Well,” said the Dagron, “let’s see if we can do that with the code we have now.” She added more code to the Computing Contraption’s glowing screen:</p><a id="pro_id00243"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore.name = 'Stinky Pete'</span></strong></span>&#13;
NoMethodError: undefined method `name=' for&#13;
#&lt;Minstrel:0x000001049637c8 @name="Wherefore"&gt;&#13;
</pre>&#13;
&#13;
      <p>“We can <span class="emphasis"><em>get</em></span> the name,” said the Dagron, “but we can’t <span class="emphasis"><em>change</em></span> it; Ruby’s complaining that our instance has no method that changes names. It’s looking for a method we haven’t written yet!”</p>&#13;
&#13;
      <p>Ruben studied the screen. “It’s that <code class="literal">NoMethodError</code> again,” he said. “It looks like Ruby wants the <code class="literal">Minstrel</code> class to have a method called <code class="literal">name=</code>!”</p>&#13;
&#13;
      <p>The Dagron nodded. “If we want to <span class="emphasis"><em>change</em></span> the <code class="literal">@name</code>, we have to write a special method called <code class="literal">name=</code> to do it,” she said. “If you write the name of a method with an equal sign at the end, Ruby understands it to mean: ‘I want this method to change the value of something.’ So to change the <code class="literal">@name</code>,” she finished, “we’d add a bit more code.”</p>&#13;
&#13;
      <p>She added the <code class="literal">name=</code> method to the rest of the code for all of them to see:</p>&#13;
&#13;
      <p><span class="bolditalic red">another_minstrel_2.rb</span></p><a id="pro_id00244"/>&#13;
      <pre class="programlisting">&#13;
class Minstrel&#13;
  def initialize(name)&#13;
    @name = name&#13;
  end&#13;
&#13;
  def name&#13;
    @name&#13;
  end&#13;
&#13;
  def name=(new_name)&#13;
    @name = new_name&#13;
  end&#13;
end&#13;
</pre>&#13;
&#13;
      <p><a class="indexterm" id="iddle1103"/><a class="indexterm" id="iddle1111"/><a class="indexterm" id="iddle1118"/><a class="indexterm" id="iddle1434"/><a class="indexterm" id="iddle1930"/>“Now we have a new method, <code class="literal">name=</code>, that takes a single parameter, the <code class="literal">new_name</code>,” said the Dagron. “This should tell Ruby to let us change the name simply by calling <code class="literal">wherefore.name = '</code><span class="emphasis"><em><code class="literal">some new name</code></em></span><code class="literal">'</code>! Let’s give it a try. First, we’ll create a new minstrel.”</p><a id="pro_id00245"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">load 'another_minstrel_2.rb'</span></strong></span>&#13;
=&gt; true&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore = Minstrel.new('Wherefore')</span></strong></span>&#13;
=&gt; #&lt;Minstrel:0x000001049637c8 @name="Wherefore"&gt;&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore.name</span></strong></span>&#13;
=&gt; "Wherefore"&#13;
</pre>&#13;
&#13;
      <p>“Next, we’ll try to change its name.”</p><a id="pro_id00246"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore.name = 'Stinky Pete'</span></strong></span>&#13;
=&gt; "Stinky Pete"&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore.name</span></strong></span>&#13;
=&gt; "Stinky Pete"&#13;
</pre>&#13;
&#13;
      <p>“That’s amazing!” said Ruben. “But writing all these methods to get and set instance variables sure is hard work. Is there any faster way to do it?”</p>&#13;
&#13;
      <p>The Dagron nodded. “As it turns out, there is,” she said. “There are three built-in shortcut methods for reading and writing instance variables: <code class="literal">attr_reader</code>, <code class="literal">attr_writer</code>, and <code class="literal">attr_accessor</code>. Here’s how they work.” She touched the Computing Contraption with her claw, and these words appeared:</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1080"/><a class="indexterm" id="iddle1104"/><a class="indexterm" id="iddle1112"/><span class="bolditalic red">another_minstrel_3.rb</span></p><a id="pro_id00247"/>&#13;
      <pre class="programlisting">&#13;
class Minstrel&#13;
  attr_accessor :name&#13;
  attr_reader :ballad&#13;
&#13;
  def initialize(name)&#13;
    @name = name&#13;
    @ballad = 'The Ballad of Chucky Jim'&#13;
  end&#13;
end&#13;
</pre>&#13;
&#13;
      <p>“For example, if you pass the symbol <code class="literal">:name</code> to <code class="literal">attr_reader</code>, it will automatically create a method called <code class="literal">name</code> that will read the instance variable <code class="literal">@name</code>. <code class="literal">attr_writer</code> will automatically create a method called <code class="literal">name=</code> that will change the value of <code class="literal">@name</code>, and <code class="literal">attr_accessor</code> will create both the <code class="literal">name</code> and <code class="literal">name=</code> methods.” The Dagron clicked her claws. “In this case, I’ve called <code class="literal">attr_accessor</code> with <code class="literal">:name</code> and <code class="literal">attr_reader</code> with <code class="literal">:ballad</code>, which should mean I can both get and change the minstrel’s name, but can only read his ballad without changing it. Let’s create a new minstrel to test out.”</p><a id="pro_id00248"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">load 'another_minstrel_3.rb'</span></strong></span>&#13;
=&gt; true&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore = Minstrel.new('Wherefore')</span></strong></span>&#13;
=&gt; #&lt;Minstrel:0x0000010413c0e0 @name="Wherefore", @ballad="The&#13;
Ballad of Chucky Jim"&gt;&#13;
</pre>&#13;
&#13;
      <p>“Perfect,” said the Dagron. “Let’s see if <code class="literal">attr_accessor</code> lets us get and change the minstrel’s <code class="literal">name</code>, like we could before.”</p><a id="pro_id00249"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore.name</span></strong></span>&#13;
=&gt; "Wherefore"&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore.name = 'Wherefive'</span></strong></span>&#13;
=&gt; "Wherefive"&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore</span></strong></span>&#13;
=&gt; #&lt;Minstrel:0x0000010413c0e0 @name="Wherefive", @ballad="The&#13;
Ballad of Chucky Jim"&gt;&#13;
</pre>&#13;
&#13;
      <p><a class="indexterm" id="iddle1113"/><a class="indexterm" id="iddle1292"/><a class="indexterm" id="iddle1607"/><a class="indexterm" id="iddle1621"/>“Now let’s see if we can read the minstrel’s <code class="literal">ballad</code>, but not change it; that’s what <code class="literal">attr_reader</code> is supposed to do,” said the Dagron. She filled in more code on the Computing Contraption:</p><a id="pro_id00250"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore.ballad</span></strong></span>&#13;
=&gt; "The Ballad of Chucky Jim"&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore.ballad = 'A Song of Mice and Friars'</span></strong></span>&#13;
NoMethodError: undefined method `ballad=' for&#13;
#&lt;Minstrel:0x0000010413c0e0&gt;&#13;
</pre>&#13;
&#13;
      <p>Wherefore shook his head in amazement. “Extraordinary!” he said. “With these Ruby tools, I’ll be able to write ballads in no time at all.”</p>&#13;
&#13;
      <p>“This is one of the most amazing parts of Ruby,” said the Off-White Knight. “When we design programs around objects, we’re doing something called <span class="emphasis"><em>object-oriented programming</em></span>, and it lets us write programs that describe real-life things like minstrels and ballads. Everything becomes a thousand times easier!”</p>&#13;
&#13;
      <p>“This is marvelous, truly marvelous,” said Wherefore. “I can’t thank you enough. How can I possibly repay you?”</p>&#13;
&#13;
      <p>“Well,” Scarlet said, “actually, we were looking for you to ask whether you’d seen anything unusual happening in the kingdom. Ruby systems all over the kingdom have been breaking all day, and we’re starting to think none of the problems is an accident.”</p>&#13;
&#13;
      <p>“Show him the scale!” Ruben said.</p>&#13;
&#13;
      <p>“Oh, yeah!” Scarlet said, and she pulled the glittering green scale from her pocket. “Have you ever seen anything like this? We thought at first it might have belonged to the Dagron, but we checked and she isn’t missing a one.”</p>&#13;
&#13;
      <p>“Hmm,” said Wherefore. “Quite the quandary. No, I don’t think I’ve seen any creature with scales like this, but I <span class="emphasis"><em>did</em></span> see something strange out here in the Pines not an hour ago.”</p>&#13;
&#13;
      <p>The King, Ruben, and Scarlet exchanged startled looks.</p>&#13;
&#13;
      <p>“What was it?” Scarlet asked.</p>&#13;
&#13;
      <p>“Well,” said Wherefore, “I only caught a snippet of conversation, but it was a few voices, talking in low tones behind that thicket yonder. I went to see what was going on, but they ran when I got near—three, maybe four of them,” he said.</p>&#13;
&#13;
      <div class="informalfigure">&#13;
        <a id="med_id00042a"/>&#13;
&#13;
        <div class="mediaobject"><a id="med_id00042"/><img alt="image with no caption" src="../Images/httpatomoreillycomsourcenostarchimages2160037.png.jpg"/></div>&#13;
      </div>&#13;
&#13;
      <p>“Who were they?” asked the King.</p>&#13;
&#13;
      <p>“I didn’t see,” said Wherefore, “but the part I overheard was dastardly indeed. They said something about not having made a big enough impact, and how they were going to see the Queen about whatever it is they were doing. I’ll bet my hat that when they fled, they were heading straight for the castle!”</p>&#13;
&#13;
      <p>“The castle! The Queen!” cried the King. “Oh my biscuits, oh my gravy! If these are our saboteurs, the Queen could be in terrible danger!”</p>&#13;
&#13;
      <p>“We’ve got to get back there, and fast!” said Scarlet. “Off-White Knight, Dagron, can you help us?”</p>&#13;
&#13;
      <p>The knight frowned thoughtfully. “I’m honor bound to stay in the Pines and to help anyone who wanders through,” she said. “But my duties are also to the King and Queen. I can spread the word as quickly as possible that trouble’s afoot and send as many friends to the castle as I can!”</p>&#13;
&#13;
      <p>“Please do!” said Scarlet. “What about you, Dagron?”</p>&#13;
&#13;
      <p>The Dagron shook her head. “Magic and wisdom come at a price,” she said. “I’m not able to leave the Carmine Pines. However, there <span class="emphasis"><em>is</em></span> a shortcut back to the castle.”</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1821"/>“Where?” asked Ruben.</p>&#13;
&#13;
      <p>“The underground passage!” said Wherefore. “Yes, I know it. Follow me, I’ll take you there!”</p>&#13;
&#13;
      <p>The King, Scarlet, and Ruben thanked the Off-White Knight and the Dagron and, waving goodbye, hurried to catch up with Wherefore, who was already halfway across the meadow. They all plunged headlong along a twisty path of roots and knotted tree trunks, and after a few minutes of breathless running, they arrived at an enormous red pine tree, bigger than all the ones around it as far as they could see.</p>&#13;
&#13;
      <p>“Going down!” cried Wherefore, and knocked on the trunk three times. With a pleasant <span class="emphasis"><em>ding</em></span>, a door slid open in the side of the trunk, revealing a cramped elevator car.</p>&#13;
&#13;
      <p>“Take the elevator to the sub-sub-basement,” he said, stuffing the three of them inside. “You’ll find a long, narrow passage that heads off to the west. Take that as far as you can, then look for a large black pipe. There’ll be words written on it that say—”</p>&#13;
&#13;
      <p>“—<span class="emphasis"><em>the Mysterious Pipe!</em></span>” cried Ruben and Scarlet together. “We saw Haldo disappear down into the lower levels of the castle earlier today; this passage must connect to the same place!”</p>&#13;
&#13;
      <p>“Then you know your way!” said Wherefore. “Goodbye and good luck—in the meantime, I’ll help the Off-White Knight and the Dagron send help your way.” And with that, the elevator doors slid shut, and the King, Scarlet, and Ruben began to descend deep into the earth.</p>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="Dial-a-Ballad, or the Minstrel’s Delivery Service">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_16"><a id="dial-a-balladcomma_or_the_minstrelapostr"/>Dial-a-Ballad, or the Minstrel’s Delivery Service</h1>&#13;
      </div>&#13;
&#13;
      <p>Now that we’ve taught Wherefore the Wand’ring Minstrel all about Ruby objects and classes, it’s time to help him create his very own <code class="literal">Ballad</code>! Otherwise, he won’t be much of a minstrel. Don’t worry, though—now that you know all about classes and how they work, creating a simple class to help Wherefore write faster, better ballads will be a breeze.</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1122"/><a class="indexterm" id="iddle1161"/><a class="indexterm" id="iddle1167"/><a class="indexterm" id="iddle1920"/>Let’s begin by making a new file called <span class="bolditalic red">ballad.rb</span> and typing the following code.</p>&#13;
&#13;
      <p><span class="bolditalic red">ballad.rb</span></p><a id="pro_id00251"/>&#13;
      <pre class="programlisting">&#13;
  class Ballad&#13;
➊   attr_accessor :title&#13;
    attr_accessor :lyrics&#13;
&#13;
➋   @@number_of_ballads = 0&#13;
&#13;
➌   def initialize(title, lyrics='Tralala!')&#13;
      @title = title&#13;
      @lyrics = lyrics&#13;
      @@number_of_ballads += 1&#13;
    end&#13;
&#13;
➍   def self.number_of_ballads&#13;
      @@number_of_ballads&#13;
    end&#13;
  end&#13;
&#13;
➎ ballad = Ballad.new('The Ballad of Chucky Jim')&#13;
&#13;
➏ puts "Number of ballads: #{Ballad.number_of_ballads}"&#13;
  puts "Ballad object ID: #{ballad.object_id}"&#13;
  puts "Ballad title: #{ballad.title}"&#13;
  puts "Ballad object ID again!: #{ballad.object_id}"&#13;
  puts "Ballad lyrics: #{ballad.lyrics}"&#13;
</pre>&#13;
&#13;
      <p>It’s hard to believe, but you now know so much Ruby that there’s actually nothing new here! You’ve seen all this stuff before: creating classes and instances of classes, using <code class="literal">attr_accessor</code>, using class and instance variables, adding methods to classes and instances, the whole shebang. Let’s step through it line by line and have a look at the output.</p>&#13;
&#13;
      <p>First, we create a <code class="literal">Ballad</code> class at ➊ with a <code class="literal">title</code> and <code class="literal">lyrics</code> we can both read and change (thanks to <code class="literal">attr_accessor</code>).</p>&#13;
&#13;
      <p>Next, at ➋, we set up a class variable, <code class="literal">@@number_of_ballads</code>, to track the number of ballads our class creates, and our <code class="literal">initialize</code> <a class="indexterm" id="iddle1105"/>method at ➌ both sets the name and lyrics of the ballad and adds 1 to the <code class="literal">@@number_of_ballads</code>.</p>&#13;
&#13;
      <p>For the last part of our class definition, we add a <code class="literal">number_of_ballads</code> method at ➍ on the <code class="literal">Ballad</code> class itself; that will let us get the <code class="literal">@@number_of_ballads</code> later.</p>&#13;
&#13;
      <p>Finally, we create a new ballad with <code class="literal">Ballad.new</code> at ➎, then print out some interesting facts about our ballad at ➏.</p>&#13;
&#13;
      <p>You can run the code in your file by using the terminal to go to the folder where you saved <span class="emphasis"><em>ballad.rb</em></span>, then typing <span class="strong"><strong><span class="red"><code class="literal">ruby ballad.rb</code></span></strong></span> on the command line.</p>&#13;
&#13;
      <p>Your object IDs will be slightly different from mine, but you should see something like this:</p><a id="pro_id00252"/>&#13;
      <pre class="programlisting">&#13;
Number of ballads: 1&#13;
Ballad object ID: #&lt;Ballad:0x0000010413e0e0&gt;&#13;
Ballad title: The Ballad of Chucky Jim&#13;
Ballad object ID again!: #&lt;Ballad:0x0000010413e0e0&gt;&#13;
Ballad lyrics: Tralala!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
      <p>We’ve just proved that our <code class="literal">self.number_of_ballads</code> method works, that our object ID doesn’t change once we create an object, and that we can get to all of the information we’ve stored in our ballad with the magic of <code class="literal">attr_accessor</code>.</p>&#13;
&#13;
      <p>All that’s well and good, but the <span class="emphasis"><em>really</em></span> interesting part is how you take it further! For example, you can start small by writing code to change the title of a ballad you create or to update its lyrics after it’s created. (Do you think this will change the object ID?)</p>&#13;
&#13;
      <p>You could also add more <code class="literal">attr_reader</code>s, <code class="literal">attr_writer</code>s, or <code class="literal">attr_accessor</code>s. You could add more methods (what about a <code class="literal">playing_time</code> method to return how many minutes long the ballad is?). You could add class methods or create additional ballads.</p>&#13;
&#13;
      <p>You could even take on the greatest challenge of all: actually writing the lyrics to “The Ballad of Chucky Jim”! The world is your oyster. (If you don’t like oysters, then the world is your cupcake.)</p>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="You Know This!">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_17"><a id="you_know_thisexclamation_mark-id00007"/>You Know This!</h1>&#13;
      </div>&#13;
&#13;
      <p><a class="indexterm" id="iddle1175"/><a class="indexterm" id="iddle1436"/><a class="indexterm" id="iddle1618"/><a class="indexterm" id="iddle1626"/><a class="indexterm" id="iddle1629"/>You learned a fair amount in this chapter, but nowhere near as much as you crammed into your noggin with methods! Learning about objects and classes was practically a vacation! Even so, let’s take the time to go over it all one more time, just to make sure you’ve got it all.</p>&#13;
&#13;
      <div class="sect2" title="Objects and Classes">&#13;
        <div class="titlepage">&#13;
          <h2 class="title" id="heading_id_18"><a id="objects_and_classes"/>Objects and Classes</h2>&#13;
        </div>&#13;
&#13;
        <p>You already knew that just about everything in Ruby is an object, but in this chapter, you learned more about objects and took a closer look at object IDs. An object’s ID number is like a fingerprint: every object has its very own, and no two objects have exactly the same one. As a general rule, objects created by Ruby have lower object ID numbers than objects you create:</p><a id="pro_id00253"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">0.object_id</span></strong></span>&#13;
=&gt; 1&#13;
&gt;&gt; <span class="strong"><strong><span class="red">:minstrel.object_id</span></strong></span>&#13;
=&gt; 465608&#13;
</pre>&#13;
&#13;
        <p>We also saw that <span class="emphasis"><em>classes</em></span> are how we can create a whole bunch of objects with similar characteristics. We create classes with the <code class="literal">class</code> keyword, like so:</p><a id="pro_id00254"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">class Monkey</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red"># Class magicks go here!</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
</pre>&#13;
&#13;
        <p>Creating classes is all well and good, but classes don’t really do much for us until we <span class="emphasis"><em>instantiate</em></span> (create) an object from that class. You can think of classes as cookie cutters and the objects they create as cookies: the cookie cutter (class) makes a bunch of things that are all very similar, but the thing we’re most interested in is the cookie itself (the object).</p>&#13;
&#13;
        <p>For instance, we can define a <code class="literal">Monkey</code> class with our <code class="literal">class</code> keyword, and we instantiate it—that is, we make a <span class="emphasis"><em>particular</em></span> monkey from our <code class="literal">Monkey</code> class cookie cutter—by calling <code class="literal">Monkey.new</code>:</p>&#13;
&#13;
        <p><span class="bolditalic red">monkey_review.rb</span></p><a id="pro_id00255"/>&#13;
        <pre class="programlisting">&#13;
class Monkey&#13;
  @@bananas = 5&#13;
&#13;
  def initialize(name)&#13;
    @name = name&#13;
  end&#13;
&#13;
  def eat_banana&#13;
    @@bananas -= 1&#13;
    puts "Ate a banana! #{@@bananas} left."&#13;
  end&#13;
end&#13;
</pre>&#13;
&#13;
        <p>Great! So far we’ve got a <code class="literal">Monkey</code> class with two methods and a class variable. The class variable <code class="literal">@@bananas</code> keeps track of how many bananas there are for <span class="emphasis"><em>all</em></span> monkey instances, the <code class="literal">initialize</code> method sets the monkey’s name when <code class="literal">Monkey.new</code> is called, and <code class="literal">eat_banana</code> decreases <code class="literal">@@bananas</code> by 1.</p>&#13;
&#13;
        <p>Next, let’s create a couple of monkeys:</p><a id="pro_id00256"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">load 'monkey_review.rb'</span></strong></span>&#13;
=&gt; true&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">socks = Monkey.new('Socks')</span></strong></span>&#13;
=&gt; #&lt;Monkey:0x000001052c77b0 @name="Socks"&gt;&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">stevie = Monkey.new('Stevie')</span></strong></span>&#13;
=&gt; #&lt;Monkey:0x00000104ca38e8 @name="Stevie"&gt;&#13;
</pre>&#13;
&#13;
        <p>Now we can have each monkey eat a banana and see what happens:</p><a id="pro_id00257"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">socks.eat_banana</span></strong></span>&#13;
Ate a banana! 4 left.&#13;
=&gt; nil&#13;
&gt;&gt; <span class="strong"><strong><span class="red">stevie.eat_banana</span></strong></span>&#13;
Ate a banana! 3 left.&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
        <p><a class="indexterm" id="iddle1024"/><a class="indexterm" id="iddle1361"/><a class="indexterm" id="iddle1916"/>Did you notice how our <code class="literal">Monkey</code> class’s <code class="literal">@@bananas</code> class variable was reduced every time <span class="emphasis"><em>any</em></span> monkey instance ate a banana? Remember, that’s because class variables are shared by all instances of that class.</p>&#13;
&#13;
        <p>We can assign any combination of local, instance, class, and global variables in combination with our classes, as shown here:</p>&#13;
&#13;
        <p><span class="bolditalic red">monkey_review_2.rb</span></p><a id="pro_id00258"/>&#13;
        <pre class="programlisting">&#13;
class Monkey&#13;
  $home = 'the jungle'&#13;
  @@number_of_monkeys = 0&#13;
&#13;
  def initialize(type)&#13;
    @type = type&#13;
    @@number_of_monkeys += 1&#13;
    puts "Made a new monkey! Now&#13;
  end&#13;
end&#13;
</pre>&#13;
&#13;
        <p>Here, we’ve changed our <code class="literal">Monkey</code> class to have a global <code class="literal">$home</code> variable (<code class="literal">'the jungle'</code>), a <code class="literal">@@number_of_monkeys</code> class variable that keeps track of how many instances the <code class="literal">Monkey</code> class has created, and a <code class="literal">@type</code> instance variable that lets each individual monkey be of a different type.</p><a id="pro_id00259"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">load 'monkey_review_2.rb'</span></strong></span>&#13;
=&gt; true&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">blue = Monkey.new('blue monkey')</span></strong></span>&#13;
Made a new monkey! Now there's 1.&#13;
=&gt; #&lt;Monkey:0x00000104aafb40 @type="blue monkey"&gt;&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">silver = Monkey.new('silver monkey')</span></strong></span>&#13;
Made a new monkey! Now there's 2.&#13;
=&gt; #&lt;Monkey:0x00000104ab3b28 @type="silver monkey"&gt;&#13;
&gt;&gt; <span class="strong"><strong><span class="red">gold = Monkey.new('golden monkey')</span></strong></span>&#13;
Made a new monkey! Now there's 3.&#13;
=&gt; #&lt;Monkey:0x00000104ab7c00 @type="golden monkey"&gt;&#13;
</pre>&#13;
&#13;
        <p><a class="indexterm" id="iddle1162"/><a class="indexterm" id="iddle1360"/><a class="indexterm" id="iddle1432"/><a class="indexterm" id="iddle1495"/><a class="indexterm" id="iddle1775"/><a class="indexterm" id="iddle1936"/>See how each <code class="literal">@type</code> is unique to each monkey, but they all change the same <code class="literal">@@number_of_monkeys</code> variable?</p>&#13;
&#13;
        <p>Finally, every part of the program also has access to the <code class="literal">$home</code> variable, since it’s global:</p><a id="pro_id00260"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">puts "Our monkeys live in #{$home}."</span></strong></span>&#13;
Our monkeys live in the jungle.&#13;
=&gt; nil&#13;
</pre>&#13;
      </div>&#13;
&#13;
      <div class="sect2" title="Variables and Scope">&#13;
        <div class="titlepage">&#13;
          <h2 class="title" id="heading_id_19"><a id="variables_and_scope"/>Variables and Scope</h2>&#13;
        </div>&#13;
&#13;
        <p>This can all be a bit tricky to keep straight, so I’ve created the following handy-dandy table to help you remember the differences between local, global, instance, and class variables.</p>&#13;
&#13;
        <div class="informaltable">&#13;
          <table class="sgc-6">&#13;
            <colgroup>&#13;
              <col/>&#13;
              <col/>&#13;
              <col/>&#13;
            </colgroup>&#13;
&#13;
            <thead>&#13;
              <tr>&#13;
                <th class="sgc-1" valign="bottom">&#13;
                  <p>Variable type</p>&#13;
                </th>&#13;
&#13;
                <th class="sgc-1" valign="bottom">&#13;
                  <p>Looks like</p>&#13;
                </th>&#13;
&#13;
                <th class="sgc-2" valign="bottom">&#13;
                  <p>Where can it be seen?</p>&#13;
                </th>&#13;
              </tr>&#13;
            </thead>&#13;
&#13;
            <tbody>&#13;
              <tr>&#13;
                <td class="sgc-3" valign="top">&#13;
                  <p>Local</p>&#13;
                </td>&#13;
&#13;
                <td class="sgc-3" valign="top">&#13;
                  <p><code class="literal">odelay</code></p>&#13;
                </td>&#13;
&#13;
                <td class="sgc-4" valign="top">&#13;
                  <p>Inside the top-level scope, method, or class where it’s defined.</p>&#13;
                </td>&#13;
              </tr>&#13;
&#13;
              <tr>&#13;
                <td class="sgc-3" valign="top">&#13;
                  <p>Global</p>&#13;
                </td>&#13;
&#13;
                <td class="sgc-3" valign="top">&#13;
                  <p><code class="literal">$odelay</code></p>&#13;
                </td>&#13;
&#13;
                <td class="sgc-4" valign="top">&#13;
                  <p>Anywhere!</p>&#13;
                </td>&#13;
              </tr>&#13;
&#13;
              <tr>&#13;
                <td class="sgc-3" valign="top">&#13;
                  <p>Instance</p>&#13;
                </td>&#13;
&#13;
                <td class="sgc-3" valign="top">&#13;
                  <p><code class="literal">@odelay</code></p>&#13;
                </td>&#13;
&#13;
                <td class="sgc-4" valign="top">&#13;
                  <p>Inside the class where it’s defined or in any instance of the class. Each instance gets its own copy.</p>&#13;
                </td>&#13;
              </tr>&#13;
&#13;
              <tr>&#13;
                <td class="sgc-5" valign="top">&#13;
                  <p>Class</p>&#13;
                </td>&#13;
&#13;
                <td class="sgc-5" valign="top">&#13;
                  <p><code class="literal">@@odelay</code></p>&#13;
                </td>&#13;
&#13;
                <td valign="top">&#13;
                  <p>Inside the class where it’s defined or in any instance of the class. Each instance shares the same class variable with all other instances.</p>&#13;
                </td>&#13;
              </tr>&#13;
            </tbody>&#13;
          </table>&#13;
        </div>&#13;
&#13;
        <p>Remember, it’s usually not a good idea to use global variables, because not only are they visible everywhere in our program but they can also be <span class="emphasis"><em>changed</em></span> from anywhere in our program. When things can be changed from a bunch of places, it can be hard to figure out what part of our program made the change if something unexpected happens. I’m showing you global variables so you know what they are and how they work, but in almost every situation, they’re much more trouble than they’re worth.</p>&#13;
&#13;
        <p><a class="indexterm" id="iddle1136"/><a class="indexterm" id="iddle1287"/><a class="indexterm" id="iddle1566"/>As you saw in the last example, we could reach the <code class="literal">$home</code> variable from outside the class definition because it was defined as global (global variables start with a <code class="literal">$</code>). We can only ever get at a variable if it’s in the proper scope. Let’s review some examples from earlier in the chapter:</p><a id="pro_id00261"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">local_variable = 'Local here!'</span></strong></span>&#13;
=&gt; "Local here!"&#13;
</pre>&#13;
&#13;
        <p>Our <code class="literal">local_variable</code> exists in this outer scope, but it doesn’t exist inside the class definition:</p><a id="pro_id00262"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">class OutOfTowner</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts local_variable</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
NameError: undefined local variable or method `local_variable' for&#13;
OutOfTowner:Class&#13;
</pre>&#13;
&#13;
        <p>The <code class="literal">local_variable</code> doesn’t exist inside the method definition, either!</p><a id="pro_id00263"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">def tourist</span></strong></span>&#13;
&gt;&gt;   <span class="strong"><strong><span class="red">puts "Can you take our picture, #{local_variable}?"</span></strong></span>&#13;
&gt;&gt; <span class="strong"><strong><span class="red">end</span></strong></span>&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">tourist</span></strong></span>&#13;
NameError: undefined local variable or method `local_variable' for&#13;
main:Object&#13;
</pre>&#13;
&#13;
        <p>Our variable <code class="literal">number</code> exists inside the block, but it’s gone as soon as the block’s code is finished:</p><a id="pro_id00264"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">3.times { |number| puts number }</span></strong></span>&#13;
0&#13;
1&#13;
2&#13;
=&gt; 3&#13;
&gt;&gt; <span class="strong"><strong><span class="red">puts number</span></strong></span>&#13;
NameError: undefined local variable or method `number' for&#13;
main:Object&#13;
</pre>&#13;
&#13;
        <p><a class="indexterm" id="iddle1558"/><a class="indexterm" id="iddle1683"/><a class="indexterm" id="iddle1792"/><a class="indexterm" id="iddle1794"/><a class="indexterm" id="iddle1797"/><a class="indexterm" id="iddle1928"/>We discovered that Ruby has a built-in variable, <code class="literal">self</code>, that refers to whatever object the method will be called on, and we can use <code class="literal">self</code> to add methods directly to classes (instead of just the objects they create), as shown here:</p>&#13;
&#13;
        <p><span class="bolditalic red">monkey_review_3.rb</span></p><a id="pro_id00265"/>&#13;
        <pre class="programlisting">&#13;
class Monkey&#13;
  @@number_of_monkeys = 0&#13;
&#13;
  def initialize&#13;
    @@number_of_monkeys += 1&#13;
  end&#13;
&#13;
  def self.number_of_monkeys&#13;
    @@number_of_monkeys&#13;
  end&#13;
end&#13;
</pre>&#13;
&#13;
        <p>You’ve seen this before! It’s our <code class="literal">Monkey</code> class with a <code class="literal">@@number_of_monkeys</code> class variable, an <code class="literal">initialize</code> method that increases that variable every time we make a new monkey, and a <code class="literal">self.number_of_monkeys</code> method that means that we can call <code class="literal">Monkey.number_of_monkeys</code> to find out how many we’ve created so far:</p><a id="pro_id00266"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">load 'monkey_review_3.rb'</span></strong></span>&#13;
=&gt; true&#13;
&gt;&gt; <span class="strong"><strong><span class="red">Monkey.number_of_monkeys</span></strong></span>&#13;
=&gt; 0&#13;
</pre>&#13;
&#13;
        <p>It’s <code class="literal">0</code> right now, but if we create a monkey, we’ll see that number go up!</p><a id="pro_id00267"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">monkey = Monkey.new</span></strong></span>&#13;
=&gt; #&lt;Monkey:0x0000010490af60&gt;&#13;
&gt;&gt; <span class="strong"><strong><span class="red">Monkey.number_of_monkeys</span></strong></span>&#13;
=&gt; 1&#13;
</pre>&#13;
&#13;
        <p>If you’re ever unsure of the value of <code class="literal">self</code> in a particular part of your program, you can always <code class="literal">puts self</code> to see what it is.</p>&#13;
&#13;
        <p><a class="indexterm" id="iddle1114"/><a class="indexterm" id="iddle1119"/><a class="indexterm" id="iddle1435"/><a class="indexterm" id="iddle1545"/><a class="indexterm" id="iddle1546"/><a class="indexterm" id="iddle1931"/>We also learned that if an object has an instance variable that we want to see or change, we have to write methods to do it. We <span class="emphasis"><em>can</em></span> write these methods ourselves as follows:</p>&#13;
&#13;
        <p><span class="bolditalic red">minstrel_review.rb</span></p><a id="pro_id00268"/>&#13;
        <pre class="programlisting">&#13;
class Minstrel&#13;
  def initialize(name)&#13;
    @name = name&#13;
  end&#13;
&#13;
  def name&#13;
    @name&#13;
  end&#13;
&#13;
  def name=(new_name)&#13;
    @name = new_name&#13;
  end&#13;
end&#13;
</pre>&#13;
&#13;
        <p>Here, we’ve set a <code class="literal">@name</code> in our <code class="literal">initialize</code> method, which means that any time we call <code class="literal">Minstrel.new</code>, we pass in a name for that minstrel. The <code class="literal">name</code> method gets that <code class="literal">@name</code> variable for us, and the <code class="literal">name=</code> method allows us to assign a <code class="literal">new_name</code> to the minstrel . . .</p>&#13;
&#13;
        <p>. . . but we can also use the shortcuts <code class="literal">attr_reader</code> (to read an instance variable), <code class="literal">attr_writer</code> (to change an instance variable), and <code class="literal">attr_accessor</code> (to do both). All we do is pass the instance variable name as a symbol, like so:</p>&#13;
&#13;
        <p><span class="bolditalic red">minstrel_review_2.rb</span></p><a id="pro_id00269"/>&#13;
        <pre class="programlisting">&#13;
class Minstrel&#13;
  attr_accessor :name&#13;
  attr_reader :ballad&#13;
&#13;
  def initialize(name)&#13;
    @name = name&#13;
    @ballad = 'The Ballad of Chucky Jim'&#13;
  end&#13;
end&#13;
</pre>&#13;
&#13;
        <p><a class="indexterm" id="iddle1106"/><a class="indexterm" id="iddle1115"/><a class="indexterm" id="iddle1564"/><a class="indexterm" id="iddle1622"/>Here, we’ve used <code class="literal">attr_accessor</code> and passed it a <code class="literal">:name</code> symbol to have it automatically create <code class="literal">name</code> and <code class="literal">name=</code> methods for us; we called <code class="literal">attr_reader</code> with <code class="literal">:ballad</code>, so we only get a <code class="literal">ballad</code> method to read the <code class="literal">@ballad</code> instance variable. Check out what happens if we try to change our ballad!</p><a id="pro_id00270"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">load 'minstrel_review_2.rb'</span></strong></span>&#13;
=&gt; true&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore = Minstrel.new('Wherefore')</span></strong></span>&#13;
=&gt; #&lt;Minstrel:0x0000010413c0e0 @name="Wherefore", @ballad="The&#13;
Ballad of Chucky Jim"&gt;&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore.ballad</span></strong></span>&#13;
=&gt; "The Ballad of Chucky Jim"&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore.name</span></strong></span>&#13;
=&gt; "Wherefore"&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore.name = 'Wherefive'</span></strong></span>&#13;
=&gt; "Wherefive"&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore.ballad = 'A Song of Mice and Friars'</span></strong></span>&#13;
NoMethodError: undefined method `ballad=' for&#13;
#&lt;Minstrel:0x0000010413c0e0&gt;&#13;
</pre>&#13;
      </div>&#13;
&#13;
      <div class="sect2" title="Object-Oriented Programming">&#13;
        <div class="titlepage">&#13;
          <h2 class="title" id="heading_id_20"><a id="object-oriented_programming"/>Object-Oriented Programming</h2>&#13;
        </div>&#13;
&#13;
        <p>Finally, we learned that writing programs that revolve around classes and objects is called <span class="emphasis"><em>object-oriented programming</em></span> (<span class="emphasis"><em>OOP</em></span>). Our <code class="literal">minstrel</code> is a good example of an object: a piece of code that acts just like something in the real world! It has attributes (facts about itself) as well as behavior, which is just a way of talking about the methods the object knows how to use. We can define the behavior of any minstrel with a <code class="literal">Minstrel</code> class, as follows.</p>&#13;
&#13;
        <p><a class="indexterm" id="iddle1547"/><span class="bolditalic red">minstrel_review_3.rb</span></p><a id="pro_id00271"/>&#13;
        <pre class="programlisting">&#13;
class Minstrel&#13;
  attr_reader :name&#13;
&#13;
  @@number_of_minstrels = 0&#13;
&#13;
  def initialize(name)&#13;
    @name = name&#13;
    @@number_of_minstrels += 1&#13;
  end&#13;
&#13;
  def sing(song_name)&#13;
    puts "Time to sing a song called: #{song_name}!"&#13;
    puts 'Tralala!'&#13;
  end&#13;
&#13;
  def self.number_of_minstrels&#13;
    @@number_of_minstrels&#13;
  end&#13;
end&#13;
</pre>&#13;
&#13;
        <p>Our class has an <code class="literal">attr_reader</code> for <code class="literal">:name</code> (meaning we can read the name, but not change it), as well as a <code class="literal">@@number_of_minstrels</code> class variable that keeps track of how many instances we’ve created and an <code class="literal">initialize</code> method that gives our minstrel a name and increases the <code class="literal">@@number_of_minstrels</code>.</p>&#13;
&#13;
        <p>It also has two methods: one, <code class="literal">sing</code>, is a method of minstrel instances and sings a little song, and the other, <code class="literal">self.number_of_minstrels</code>, is a method of the <code class="literal">Minstrel</code> class and tells us how many minstrels we’ve created so far.</p>&#13;
&#13;
        <p>Let’s see them in action!</p><a id="pro_id00272"/>&#13;
        <pre class="programlisting">&#13;
&gt;&gt; <span class="strong"><strong><span class="red">load 'minstrel_review_3.rb'</span></strong></span>&#13;
=&gt; true&#13;
&#13;
&gt;&gt; <span class="strong"><strong><span class="red">wherefore = Minstrel.new('Wherefore')</span></strong></span>&#13;
=&gt; #&lt;Minstrel:0x000001031eac68 @name="Wherefore"&gt;&#13;
&gt;&gt; <span class="strong"><strong><span class="red">Minstrel.number_of_minstrels</span></strong></span>&#13;
=&gt; 1&#13;
&#13;
wherefore.sing('A Tail of Two Foxes')&#13;
Time to sing a song called: A Tail of Two Foxes!&#13;
Tralala!&#13;
=&gt; nil&#13;
</pre>&#13;
&#13;
        <p>Voilà! We can create a new minstrel, call <code class="literal">Minstrel.number_of_minstrels</code> to see that we’ve created one, and then call our minstrel instance (<code class="literal">wherefore</code>)’s <code class="literal">sing</code> method to hear his ballad “A Tail of Two Foxes.”</p>&#13;
&#13;
        <p>Things are starting to get a bit suspenseful around here, so I’m gonna go grab a bag of popcorn—be right with you. In the meantime, go on ahead to see what the King, Scarlet, and Ruben find when they get back to the castle, and get ready for even more object-oriented Ruby magic!</p>&#13;
      </div>&#13;
    </div>&#13;
  </div>&#13;
</body></html>