<html><head></head><body>
		<section>&#13;
			<header>&#13;
				<h1 class="chapter"><span class="ChapterNumber"><span epub:type="pagebreak" id="Page_185" title="185"/>10</span><br/><span class="ChapterTitle">Creating Your Own Arduino Libraries </span></h1>&#13;
			</header>&#13;
			<p class="ChapterIntro">In this chapter you will</p>&#13;
			<ul>&#13;
				<li>Learn the components of an Arduino library</li>&#13;
				<li>Create a simple library for a repetitive task</li>&#13;
				<li>Learn how to install your library in the Arduino IDE</li>&#13;
				<li>Create a library that accepts values to perform a function</li>&#13;
				<li>Create a library that processes data from a sensor and returns values in an easy-to-use form</li>&#13;
			</ul>&#13;
			<p>&#13;
				Recall Project 22, described in <span class="xref" itemid="xref_target_Chapter 7">Chapter 7</span>, where you installed an Arduino library that included the functions needed to save data to an SD card. Using the library reduced the amount of time needed to write a sketch, as the library provides the functions related to the card module.</p>&#13;
			<p>In the future, as you write sketches to solve your own problems and perform your own tasks, you may find yourself repeatedly using certain functions that you have created. At that point, it will be sensible to create your own Arduino library, which you can easily install and use in your sketches.</p>&#13;
			<p>In this chapter, you will learn how to convert functions into an Arduino library. By following the examples presented here, you’ll learn what you need to know to make your own custom libraries. Let’s do this now.</p>&#13;
			<h2 id="h1-500587c10-0001"><span epub:type="pagebreak" id="Page_186" title="186"/>Creating Your First Arduino Library</h2>&#13;
			<p class="BodyFirst">For our first example, consider <a href="#listing10-1" id="listinganchor10-1">Listing 10-1</a>. It contains two functions, <code>blinkSlow()</code> and <code>blinkFast()</code>, which are used to blink the Arduino’s onboard LED at a slow or fast rate, respectively.</p>&#13;
			<pre><code>// Listing 10-1&#13;
void setup() &#13;
{ pinMode(13, OUTPUT); // using onboard LED&#13;
}&#13;
void blinkSlow()&#13;
{ for (int i = 0; i &lt; 5; i++) { digitalWrite(13, HIGH); delay(1000); digitalWrite(13, LOW); delay(1000); }&#13;
}&#13;
void blinkFast()&#13;
{ for (int i = 0; i &lt; 5; i++) { digitalWrite(13, HIGH); delay(250); digitalWrite(13, LOW); delay(250); }&#13;
}&#13;
void loop()&#13;
{ blinkSlow(); delay(1000); blinkFast(); delay(1000);&#13;
}</code></pre>&#13;
			<p class="CodeListingCaption"><a id="listing10-1">Listing 10-1</a>: Blinking the Arduino’s onboard LED</p>&#13;
			<p>&#13;
				Without a library, every time you wrote a new sketch and wanted to use the <code>blinkSlow()</code> and <code>blinkFast()</code><em> </em>functions, you would have to enter them manually. On the other hand, if you put the code for your functions in a library, from then on, you’ll be able to call the library using just one line of code at the start of your sketch.</p>&#13;
			<h3 id="h2-500587c10-0001"><span epub:type="pagebreak" id="Page_187" title="187"/>Anatomy of an Arduino Library</h3>&#13;
			<p class="BodyFirst">An Arduino library consists of three files, as well as some optional example sketches that demonstrate how the library could be used. The three requisite files for every Arduino library are these:</p>&#13;
			<ol class="none">&#13;
				<li><span class="RunInHead"><b><i>&lt;library&gt;.h</i></b></span>  The header file</li>&#13;
				<li><span class="RunInHead"><b><i>&lt;library&gt;.cpp</i></b></span>  The source file</li>&#13;
				<li><span class="RunInHead"><b><i>KEYWORDS.TXT</i></b></span>  The keyword definitions</li>&#13;
			</ol>&#13;
			<p>&#13;
				In the first two filenames, you’ll replace <em>&lt;library&gt;</em> with the actual name of your library. For our first example, we will call our Arduino library blinko. Thus, our two files will be <em>blinko.h</em> and <em>blinko.cpp</em>.</p>&#13;
			<h3 id="h2-500587c10-0002">The Header File</h3>&#13;
			<p class="BodyFirst">The <em>blinko.h</em> file is known as a <em>header file</em>, because it contains the definitions of functions, variables, and so on used inside the library. The header file for the blinko library is shown in <a href="#listing10-2" id="listinganchor10-2">Listing 10-2</a>.</p>&#13;
			<pre><code>// Listing 10-2&#13;
/*<span aria-label="annotation1" class="CodeAnnotationHang">1</span> blinko.h - Library for flashing an Arduino's onboard LED connected to D13&#13;
*/<span aria-label="annotation2" class="CodeAnnotationHang">2</span> #ifndef blinko_h&#13;
#define blinko_h<span aria-label="annotation3" class="CodeAnnotationHang">3</span> #include "Arduino.h" // gives library access to standard types and constants // of the Arduino language<span aria-label="annotation4" class="CodeAnnotationHang">4</span> class blinko // functions and variables used in the library&#13;
{ public: blinko();    void slow();  void fast();&#13;
};<span aria-label="annotation5" class="CodeAnnotationHang">5</span> #endif</code></pre>&#13;
			<p class="CodeListingCaption"><a id="listing10-2">Listing 10-2</a>: The blinko library header file</p>&#13;
			<p>&#13;
				The header file shares some similarities with a typical Arduino sketch, but there are also some differences. At <span aria-label="annotation1" class="CodeAnnotation">1</span>, there’s a useful comment about the purpose of the library. While such comments are not necessary, they should be included to make the library easier for others to use.</p>&#13;
			<p>&#13;
				At <span aria-label="annotation2" class="CodeAnnotation">2</span>, the code checks whether the library has been declared in the host sketch. At <span aria-label="annotation3" class="CodeAnnotation">3</span>, the standard Arduino library is included to allow our blinko library access to the standard Arduino sketch functions, types, and constants.</p>&#13;
			<p><span epub:type="pagebreak" id="Page_188" title="188"/>Then, at <span aria-label="annotation4" class="CodeAnnotation">4</span>, we create a class. You can think of a <em>class</em> as a collection in one spot of all the variables and functions required for the library, including the name of the library. Within the class, there can be public variables and functions, which can be accessed by the sketch that needs to use the library; there can also be private variables and functions, which can be used only from inside the class. Finally, each class has a <em>constructor</em> with the same name as the class, which is used to create an instance of the class. This may sound complex. However, after reviewing the examples in this chapter and making a few libraries of your own, you’ll be confident in these constructions.</p>&#13;
			<p>&#13;
				Inside our class, you can see we have the constructor for our library, <code>blinko()</code>, and two functions that will be in the library: <code>slow()</code> and <code>fast()</code>. They follow the <code>public:</code> statement, which means they can be used by anyone (“any member of the public”) who accesses the blinko library.</p>&#13;
			<p>&#13;
				Finally, at <span aria-label="annotation5" class="CodeAnnotation">5</span>, we end the header definition. By wrapping the header definition inside an <code>if</code> statement, we ensure that the header isn’t loaded twice.</p>&#13;
			<h3 id="h2-500587c10-0003">The Source File</h3>&#13;
			<p class="BodyFirst">Next, let’s take a look at the <em>blinko.cpp</em> file. The <em>.cpp</em> file is known as a <em>source file</em>, because it contains the code that will be run when the library is used. The source file for the blinko library is given in <a href="#listing10-3" id="listinganchor10-3">Listing 10-3</a>.</p>&#13;
			<pre><code>// Listing 10-3&#13;
/*<span aria-label="annotation1" class="CodeAnnotationHang">1</span> blinko.cpp - Library for flashing an Arduino's onboard LED connected to D13&#13;
*/<span aria-label="annotation2" class="CodeAnnotationHang">2</span> #include “Arduino.h” // gives library access to standard types and constants // of the Arduino language&#13;
#include "blinko.h"<span aria-label="annotation3" class="CodeAnnotationHang">3</span> blinko::blinko()     // things to do when library is activated&#13;
{&#13;
	pinMode(13, OUTPUT);&#13;
}<span aria-label="annotation4" class="CodeAnnotationHang">4</span> void blinko::slow()&#13;
{&#13;
	for (int i=0; i&lt;5; i++)&#13;
	{ 		digitalWrite(13, HIGH);&#13;
		delay(1000);&#13;
		digitalWrite(13, LOW);&#13;
		delay(1000); &#13;
	}&#13;
}<span aria-label="annotation4" class="CodeAnnotationHang">4</span> void blinko::fast()&#13;
{&#13;
	for (int i=0; i&lt;5; i++)&#13;
	{&#13;
		 digitalWrite(13, HIGH);<span epub:type="pagebreak" id="Page_189" title="189"/> 		 delay(250); 		 digitalWrite(13, LOW);&#13;
		 delay(250); &#13;
	}&#13;
}</code></pre>&#13;
			<p class="CodeListingCaption"><a id="listing10-3">Listing 10-3</a>: The blinko library source file</p>&#13;
			<p>&#13;
				The source file contains the functions we’ve written that we’ll want available to reuse. In addition, some new structural elements are required here. At <span aria-label="annotation2" class="CodeAnnotation">2</span>, we give our library access to both the standard Arduino functions, types, and constants and our own library header file.</p>&#13;
			<p>&#13;
				At <span aria-label="annotation3" class="CodeAnnotation">3</span> we have the definition of the constructor function. The constructor contains things that should happen when the library is used. In our example, we have set digital pin 13 as an output, as we are using the Arduino’s onboard LED.</p>&#13;
			<p>&#13;
				Starting at <span aria-label="annotation4" class="CodeAnnotation">4</span>, we list the functions we want to include in this library. They are just like the functions that you would create in a stand-alone sketch, with one important difference: their definition starts with the library class name and two colons. For example, instead of typing <code>void fast()</code>, you type <code>void blinko::fast()</code>.</p>&#13;
			<h3 id="h2-500587c10-0004">The KEYWORDS.TXT File</h3>&#13;
			<p class="BodyFirst">Finally, we need to create the <em>KEYWORDS.TXT </em>file. The Arduino IDE uses this file to determine the keywords in the library, then highlights those words in the IDE. <a href="#listing10-4" id="listinganchor10-4">Listing 10-4</a> is the <em>KEYWORDS.TXT</em> file for our blinko library.</p>&#13;
			<pre><code>// Listing 10-4&#13;
blinko		KEYWORD1&#13;
slow		KEYWORD2&#13;
fast		KEYWORD2</code></pre>&#13;
			<p class="CodeListingCaption"><a id="listing10-4">Listing 10-4</a>: The blinko library keywords file</p>&#13;
			<p>&#13;
				The first line is the name of the library and is referred to as <code>KEYWORD1</code>. The library’s functions are both called <code>KEYWORD2</code>. Note that the space between the keywords and their definitions must be created by pressing <span class="KeyCaps">tab</span>, not by pressing the spacebar.</p>&#13;
			<p>&#13;
				At this point, you have the three files needed for a working library. It’s a great idea to also include an example sketch so users can understand what the functions do. <a href="#listing10-5" id="listinganchor10-5">Listing 10-5</a> is our example sketch for the blinko library.</p>&#13;
			<pre><code>// Listing 10-5, blinkotest.ino<span aria-label="annotation1" class="CodeAnnotationHang">1</span> #include &lt;blinko.h&gt;<span aria-label="annotation2" class="CodeAnnotationHang">2</span> blinko ArduinoLED;&#13;
void setup() {&#13;
}&#13;
void loop()<span epub:type="pagebreak" id="Page_190" title="190"/>{<span aria-label="annotation3" class="CodeAnnotationHang">3</span>   ArduinoLED.slow();  // blink LED slowly, once every second delay(1000);<span aria-label="annotation4" class="CodeAnnotationHang">4</span>   ArduinoLED.fast();  // blink LED rapidly, four times per second delay(1000);&#13;
}</code></pre>&#13;
			<p class="CodeListingCaption"><a id="listing10-5">Listing 10-5</a>: An example sketch for our blinko library</p>&#13;
			<p>&#13;
				As you can see, the sketch is basic. It just shows the use of both the <code>slow()</code> and <code>fast()</code><em> </em>functions in our library. All the end user needs to do after installing the library is to include the library <span aria-label="annotation1" class="CodeAnnotation">1</span>, create an instance <span aria-label="annotation2" class="CodeAnnotation">2</span>, and then call either function when required as shown at <span aria-label="annotation3" class="CodeAnnotation">3</span> and <span aria-label="annotation4" class="CodeAnnotation">4</span>.</p>&#13;
			<h2 id="h1-500587c10-0002">Installing Your New Arduino Library</h2>&#13;
			<p class="BodyFirst">Now that you’ve created a new Arduino library, an easy way to store and distribute it is to make a ZIP file. Future users who obtain the ZIP file can easily install the library, as demonstrated earlier in <span class="xref" itemid="xref_target_Chapter 7">Chapter 7</span>.</p>&#13;
			<h3 id="h2-500587c10-0005">Creating a ZIP File Using Windows 7 and Later</h3>&#13;
			<p class="BodyFirst">To create a ZIP file with Windows, follow these instructions.</p>&#13;
			<p>&#13;
				First, place the three library files and the example sketch (stored in its own folder, as are all sketches) into one location. <a href="#figure10-1" id="figureanchor10-1">Figure 10-1</a> shows an example.</p>&#13;
			<figure>&#13;
				<img alt="f10001" src="image_fi/500587c10/f10001.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure10-1">Figure 10-1</a>: Our Arduino library files in one folder</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>&#13;
				Select all the files, right-click anywhere over the highlighted files, and select <b>Send To</b><span class="MenuArrow">▶</span><b>Compressed (Zipped) Folder</b>, as shown in <a href="#figure10-2" id="figureanchor10-2">Figure 10-2</a>.</p>&#13;
			<p>&#13;
				A new file will appear in the folder, with a <em>.zip</em> extension and name editing enabled. For our library, change the name to <em>blinko</em> and then press <span class="KeyCaps">enter</span>, as shown in <a href="#figure10-3" id="figureanchor10-3">Figure 10-3</a>.</p>&#13;
			<p>&#13;
				Now you can move on to “Installing Your New Library” on <span class="xref" itemid="xref_target_page 193">page 193</span>.</p>&#13;
				<span epub:type="pagebreak" id="Page_191" title="191"/>&#13;
				<figure>&#13;
				<img alt="f10002" src="image_fi/500587c10/f10002.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure10-2">Figure 10-2</a>: Compressing the library files</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<figure>&#13;
				<img alt="f10003" src="image_fi/500587c10/f10003.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure10-3">Figure 10-3</a>: Changing the name of the library ZIP file</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h3 id="h2-500587c10-0006"><span epub:type="pagebreak" id="Page_192" title="192"/>Creating a ZIP File Using Mac OS X or Later</h3>&#13;
			<p class="BodyFirst">To create a ZIP file with Mac OS X, gather the three library files and the example sketch (stored in its own folder, as are all sketches) into one location. <a href="#figure10-4" id="figureanchor10-4">Figure 10-4</a> shows an example.</p>&#13;
			<figure>&#13;
				<img alt="f10004" src="image_fi/500587c10/f10004.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure10-4">Figure 10-4</a>: Our Arduino library files</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>&#13;
				Select all the files, right-click anywhere over the files, and select <b>Compress 4 Items</b>, as shown in <a href="#figure10-5" id="figureanchor10-5">Figure 10-5</a>.</p>&#13;
			<figure>&#13;
				<img alt="f10005" src="image_fi/500587c10/f10005.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure10-5">Figure 10-5</a>: Compressing the library files</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p><span epub:type="pagebreak" id="Page_193" title="193"/>After a moment, a new file called <em>Archive.zip</em> will appear in the folder, as shown in <a href="#figure10-6" id="figureanchor10-6">Figure 10-6</a>.</p>&#13;
			<figure>&#13;
				<img alt="f10006" src="image_fi/500587c10/f10006.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure10-6">Figure 10-6</a>: The files have been compressed.</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>&#13;
				Click on the <em>Archive.zip</em> folder and change the name to <em>blinko.zip</em>, as shown in <a href="#figure10-7" id="figureanchor10-7">Figure 10-7</a>.</p>&#13;
			<figure>&#13;
				<img alt="f10007" src="image_fi/500587c10/f10007.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure10-7">Figure 10-7</a>: Our Arduino library installation ZIP file</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>You now have a library ZIP file that you can easily  distribute to others or install yourself.</p>&#13;
			<h3 id="h2-500587c10-0007">Installing Your New Library</h3>&#13;
			<p class="BodyFirst">At this point you can install your library using the ZIP file method detailed in “Downloading an Arduino Library as a ZIP File” on <span class="xref" itemid="xref_target_page 134">page 134</span> in <span class="xref" itemid="xref_target_Chapter 7">Chapter 7</span>. Once the file has been installed and you have restarted the Arduino IDE, select <b>Sketch</b><span class="MenuArrow">▶</span><b>Include Library</b> to see your library listed, as shown in <a href="#figure10-8" id="figureanchor10-8">Figure 10-8</a>.</p>&#13;
			<span epub:type="pagebreak" id="Page_194" title="194"/>&#13;
			<figure>&#13;
				<img alt="f10008" src="image_fi/500587c10/f10008.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure10-8">Figure 10-8</a>: Our Arduino library, now available in the IDE</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>&#13;
				Furthermore, you can now easily access the example sketch; select <b>File</b><span class="MenuArrow">▶</span><b>Examples</b><span class="MenuArrow">▶</span><b>blinko</b>, as shown in <a href="#figure10-9" id="figureanchor10-9">Figure 10-9</a>.</p>&#13;
			<figure>&#13;
				<img alt="f10009" src="image_fi/500587c10/f10009.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure10-9">Figure 10-9</a>: Our Arduino library example sketch is installed.</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h2 id="h1-500587c10-0003"><span epub:type="pagebreak" id="Page_195" title="195"/>Creating a Library That Accepts Values to Perform a Function</h2>&#13;
			<p class="BodyFirst">Now that you have the knowledge to create a basic Arduino library, you can move on to the next level: creating a library that can accept values and act on them. Once again, we will look an at example function within a sketch and convert it into a more useful library.</p>&#13;
			<p>&#13;
				Consider the sketch shown in <a href="#listing10-6" id="listinganchor10-6">Listing 10-6</a>. It uses the function <code>void blinkType()</code>, which tells the Arduino how many times to blink its onboard LED and the on/off period.</p>&#13;
			<pre><code>// Listing 10-6&#13;
void setup() { pinMode(13, OUTPUT); // use onboard LED&#13;
}&#13;
void blinkType(int blinks, int duration)&#13;
// blinks - number of times to blink the LED&#13;
// duration – blink duration in milliseconds&#13;
{ for (int i = 0; i &lt; blinks; i++) { digitalWrite(13, HIGH); delay(duration); digitalWrite(13, LOW); delay(duration); }&#13;
}&#13;
void loop()&#13;
{ // blink LED 10 times, with 250 ms duration blinkType(10, 250); delay(1000); // blink LED three times, with 1 second duration blinkType(3, 1000); delay(1000);&#13;
}</code></pre>&#13;
			<p class="CodeListingCaption"><a id="listing10-6">Listing 10-6</a>: Demonstration sketch for the <code>blinkType()</code> function</p>&#13;
			<p>&#13;
				As you can see, the function <code>void blinkType()</code><em> </em>accepts two values and then acts on them. The first value is the number of times to turn the onboard LED on and off, and the second value is the delay time in milliseconds for each blink.</p>&#13;
			<p>&#13;
				Let’s turn this function into an Arduino library named blinko2. <a href="#listing10-7" id="listinganchor10-7">Listing 10-7</a> shows the header file for this library.</p>&#13;
			<pre><code>// Listing 10-7&#13;
/* blinko2.h - Blinking the Arduino's onboard LED on D13 Accepts number of blinks and on/off delay&#13;
*/&#13;
#ifndef blinko2_h<span epub:type="pagebreak" id="Page_196" title="196"/>#define blinko2_h&#13;
#include "Arduino.h"&#13;
class blinko2&#13;
{ public: blinko2();    void blinkType(int blinks, int duration); <span aria-label="annotation1" class="CodeAnnotationHang">1</span>   private: int blinks; int duration;&#13;
};&#13;
#endif</code></pre>&#13;
			<p class="CodeListingCaption"><a id="listing10-7">Listing 10-7</a>: The blinko2 library header file</p>&#13;
			<p>&#13;
				The header file maintains the same structure as the header file for the original blinko library. However, there is a new section at <span aria-label="annotation1" class="CodeAnnotation">1</span> called <code>private</code>. The variables declared in the <code>private</code> section are for internal use within the library and cannot be used by the greater Arduino sketch. You can see these variables in use within the library source file shown in <a href="#listing10-8" id="listinganchor10-8">Listing 10-8</a>.</p>&#13;
			<pre><code>// Listing 10-8&#13;
/* blinko2.cpp - Blinking the Arduino's onboard LED on D13 Accepts number of blinks and on/off delay&#13;
*/&#13;
#include "Arduino.h" &#13;
#include "blinko2.h"&#13;
blinko2::blinko2() &#13;
{<span aria-label="annotation1" class="CodeAnnotationHang">1</span>   pinMode(13, OUTPUT);&#13;
}<span aria-label="annotation2" class="CodeAnnotationHang">2</span> void blinko2::blinkType(<span aria-label="annotation3" class="CodeAnnotation">3</span>int blinks, <span aria-label="annotation4" class="CodeAnnotation">4</span>int duration)&#13;
{ for (int i=0; i&lt;blinks; i++) { digitalWrite(13, HIGH); delay(duration); digitalWrite(13, LOW); delay(duration);   }&#13;
}</code></pre>&#13;
			<p class="CodeListingCaption"><a id="listing10-8">Listing 10-8</a>: The blinko2 library source file</p>&#13;
			<p><span epub:type="pagebreak" id="Page_197" title="197"/>The source file for blinko2 maintains the same structure as the source file for the original blinko library.</p>&#13;
			<p>&#13;
				We set digital pin 13 to an output at <span aria-label="annotation1" class="CodeAnnotation">1</span>. At <span aria-label="annotation2" class="CodeAnnotation">2</span>, we declare the function <code>blinkType()</code>, which accepts the number of times to blink at <span aria-label="annotation3" class="CodeAnnotation">3</span> and the delay time at <span aria-label="annotation4" class="CodeAnnotation">4</span>. You can see this in operation via the example sketch for our library in <a href="#listing10-9" id="listinganchor10-9">Listing 10-9</a>.</p>&#13;
			<pre><code>// Listing 10-9&#13;
#include &lt;blinko2.h&gt;&#13;
blinko2 ArduinoLED;&#13;
void setup() {}&#13;
void loop() &#13;
{ ArduinoLED.blinkType(3,250); &#13;
// blink LED three times, with a duration of 250 ms delay(1000); ArduinoLED.blinkType(10,1000); &#13;
// blink LED 10 times, with a duration of 1 second delay(1000);&#13;
}</code></pre>&#13;
			<p class="CodeListingCaption"><a id="listing10-9">Listing 10-9</a>: An example sketch for our blinko2 library</p>&#13;
			<p>&#13;
				Next, we need to create the keywords file for our new blinko2<em> </em>library. Don’t forget to use a tab and not spaces between the words. Here is our <em>KEYWORDS.TXT</em> file:</p>&#13;
			<pre><code>blinko2          KEYWORD1&#13;
blinkType        KEYWORD2</code></pre>&#13;
			<p>Now create your ZIP file and install the library using the methods described earlier in this chapter. Then open and run the blinko2 example sketch to experience how it works.</p>&#13;
			<h2 id="h1-500587c10-0004">Creating a Library That Processes and Displays Sensor Values</h2>&#13;
			<p class="BodyFirst">For our final example of an Arduino library, we’ll revisit the Analog Devices TMP36 temperature sensor used in several of our earlier projects. Our ArduinoTMP36 example library will take the raw value from the TMP36 and display the temperature in both Celsius and Fahrenheit via the Serial Monitor.</p>&#13;
			<p>&#13;
				First, connect your TMP36 to the Arduino by following the schematic shown in <a href="#figure10-10" id="figureanchor10-10">Figure 10-10</a>.</p>&#13;
				<span epub:type="pagebreak" id="Page_198" title="198"/>&#13;
				<figure>&#13;
				<img alt="f10010" src="image_fi/500587c10/f10010.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure10-10">Figure 10-10</a>: Schematic for use with the ArduinoTMP36 library</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p><a href="#listing10-10" id="listinganchor10-10">Listing 10-10</a> is a sketch that we wish to turn into a library. It uses two functions, <code>readC()</code> and <code>readF()</code>, to<em> </em>take the raw reading from the TMP36 sensor via analog pin 0, convert it to degrees Celsius and Fahrenheit, and return the results.</p>&#13;
			<pre><code>// Listing 10-10&#13;
// display temperature from TMP36 sensor in C and F &#13;
float temperature;&#13;
float readC()&#13;
{ float tempC; tempC = analogRead(0); tempC = tempC = (tempC * 5000) / 1024; tempC = tempC - 500; tempC = tempC / 10; return tempC;&#13;
}&#13;
float readF()&#13;
{ float tempC; float tempF; tempC = analogRead(0);<span epub:type="pagebreak" id="Page_199" title="199"/>  tempC = tempC = (tempC * 5000) / 1024; tempC = tempC - 500; tempC = tempC / 10; tempF = (tempC * 1.8) + 32; return tempF;&#13;
}&#13;
void setup()&#13;
{ Serial.begin(9600);&#13;
}&#13;
void loop()&#13;
{ Serial.print("Temperature in Celsius is: "); temperature = readC(); Serial.println(temperature); Serial.print("Temperature in Fahrenheit is: "); temperature = readF(); Serial.println(temperature); delay(1000);&#13;
}</code></pre>&#13;
			<p class="CodeListingCaption"><a id="listing10-10">Listing 10-10</a>: TMP36 demonstration sketch</p>&#13;
			<p>&#13;
				The functions for temperature conversion are ideal candidates for inclusion in a library, which we will call ArduinoTMP36. The header file is shown in <a href="#listing10-11" id="listinganchor10-11">Listing 10-11</a>.</p>&#13;
			<pre><code>// Listing 10-11<span aria-label="annotation1" class="CodeAnnotationHang">1</span> #ifndef ArduinoTMP36_h&#13;
#define ArduinoTMP36_h&#13;
#include "Arduino.h"&#13;
class ArduinoTMP36&#13;
{<span aria-label="annotation2" class="CodeAnnotationHang">2</span>   public: ArduinoTMP36(); float readC(); float readF();<span aria-label="annotation3" class="CodeAnnotationHang">3</span>   private: float tempC; float tempF;&#13;
};&#13;
#endif</code></pre>&#13;
			<p class="CodeListingCaption"><a id="listing10-11">Listing 10-11</a>: The ArduinoTMP36 library header file</p>&#13;
			<p>&#13;
				At this point, you probably recognize the structure of the header file. We set up the definitions at <span aria-label="annotation1" class="CodeAnnotation">1</span>. Inside the <code>class</code> at <span aria-label="annotation2" class="CodeAnnotation">2</span>, we declare the public items, which include the constructor and the <code>readC()</code> and <code>readF()</code> functions. We also declare the private items at <span aria-label="annotation3" class="CodeAnnotation">3</span>; these include the two variables used within the library.</p>&#13;
			<p><span epub:type="pagebreak" id="Page_200" title="200"/>Next we have the library source file, shown in <a href="#listing10-12" id="listinganchor10-12">Listing 10-12</a>.</p>&#13;
			<pre><code>// Listing 10-12&#13;
#include "Arduino.h" &#13;
#include "ArduinoTMP36.h"&#13;
ArduinoTMP36::ArduinoTMP36() &#13;
{&#13;
}&#13;
float ArduinoTMP36::readC()&#13;
{ float tempC; tempC = analogRead(0); tempC = tempC=(tempC*5000)/1024; tempC = tempC-500; tempC = tempC/10; return tempC;&#13;
}&#13;
float ArduinoTMP36::readF()&#13;
{ float tempC; float tempF; tempC = analogRead(0); tempC = tempC=(tempC*5000)/1024; tempC = tempC-500; tempC = tempC/10; tempF = (tempC*1.8)+32; return tempF;&#13;
}</code></pre>&#13;
			<p class="CodeListingCaption"><a id="listing10-12">Listing 10-12</a>: The ArduinoTMP36 library source file</p>&#13;
			<p>&#13;
				The source file contains the two functions used to calculate the temperatures. They are defined as <code>float</code><em> </em>because they return a floating-point value. The temperatures are determined using the same formulas as in Project 8 in <span class="xref" itemid="xref_target_Chapter 4">Chapter 4</span>.</p>&#13;
			<p>&#13;
				Finally, we need to create the keywords file for our new ArduinoTMP36 library. Don’t forget to use a tab and not spaces between the words. Our <em>KEYWORDS.TXT</em> file is shown here:</p>&#13;
			<pre><code>ArduinoTMP36             KEYWORD1&#13;
readC                    KEYWORD2&#13;
readF                    KEYWORD2</code></pre>&#13;
			<p>&#13;
				Now create your ZIP file and install the library using the methods described earlier in this chapter. Then open and run the ArduinoTMP36 example sketch, shown in <a href="#listing10-13" id="listinganchor10-13">Listing 10-13</a>.</p>&#13;
			<pre><code><span epub:type="pagebreak" id="Page_201" title="201"/>// Listing 10-13<span aria-label="annotation1" class="CodeAnnotationHang">1</span> #include &lt;ArduinoTMP36.h&gt;&#13;
ArduinoTMP36 thermometer;<span aria-label="annotation2" class="CodeAnnotationHang">2</span> float temperature;&#13;
void setup()&#13;
{ Serial.begin(9600);&#13;
}&#13;
void loop()&#13;
{ Serial.print("Temperature in Celsius is: ");<span aria-label="annotation3" class="CodeAnnotationHang">3</span>   temperature=thermometer.readC(); Serial.println(temperature); Serial.print("Temperature in Fahrenheit is: ");<span aria-label="annotation4" class="CodeAnnotationHang">4</span>   temperature=thermometer.readF(); Serial.println(temperature); delay(1000);&#13;
}</code></pre>&#13;
			<p class="CodeListingCaption"><a id="listing10-13">Listing 10-13</a>: An example sketch for the ArduinoTMP36 library</p>&#13;
			<p>&#13;
				Simply include the library and create the instance at <span aria-label="annotation1" class="CodeAnnotation">1</span>. Then declare a variable to accept the output from the library at <span aria-label="annotation2" class="CodeAnnotation">2</span>. After that, the temperature is requested and returned in Celsius and Fahrenheit at points <span aria-label="annotation3" class="CodeAnnotation">3</span> and <span aria-label="annotation4" class="CodeAnnotation">4</span>, respectively.</p>&#13;
			<p>&#13;
				Open the Serial Monitor window and set the data speed to 9,600 baud, and you should be presented with a scrolling updated list of the current temperature in Celsius and Fahrenheit, like that shown in <a href="#figure10-11" id="figureanchor10-11">Figure 10-11</a>.</p>&#13;
			<figure>&#13;
				<img alt="f10011" src="image_fi/500587c10/f10011.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure10-11">Figure 10-11</a>: Example of output from the ArduinoTMP36 library</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>Now you can appreciate how much time and sketch size is saved by using a library instead of including the functions every time you create a new sketch.</p>&#13;
			<h2 id="h1-500587c10-0005"><span epub:type="pagebreak" id="Page_202" title="202"/>Looking Ahead</h2>&#13;
			<p class="BodyFirst">Now that you have experience with writing Arduino libraries, you can create your own. This will help you to gain a deeper understanding of the libraries provided by other sources. You can also practice by creating libraries for the projects in this book you’ve already completed.</p>&#13;
			<p>In the next chapter, you will learn how to work with user input entered via numeric keypads, so turn the page to get started.</p>&#13;
		</section>&#13;
	</body></html>