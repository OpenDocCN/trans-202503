<html><head></head><body>
<h1 class="part" id="part03"><span epub:type="pagebreak" id="page_85"/><strong>PART 3</strong><br/><img alt="image" class="middle" src="../images/common-01.jpg"/><br/><span class="big"><strong>SERVOS</strong></span></h1>&#13;


<h2 class="h2a" id="ch10"><span epub:type="pagebreak" id="page_86"/>PROJECT 10: JOYSTICK-CONTROLLED LASER</h2>&#13;
<p class="h2sub"><strong><span class="green">IN THIS PROJECT WE CREATE A JOYSTICK-CONTROLLED LASER BY CONNECTING TWO SERVOS TO A JOYSTICK AND USING THIS SETUP AS A PAN-AND-TILT CONTROLLER FOR A LASER POINTER.</span></strong></p>&#13;
<div class="image2"><img alt="image" src="../images/f0086-01.jpg"/></div>&#13;
<div class="image2"><span epub:type="pagebreak" id="page_87"/><img alt="image" src="../images/f0087-01.jpg"/></div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="green"><strong>PARTS REQUIRED</strong></span></p>&#13;
<p class="bull">• Arduino</p>&#13;
<p class="bull">• Breadboard</p>&#13;
<p class="bull">• Jumper wires</p>&#13;
<p class="bull">• 2 Tower Pro SG90 9g servomotors</p>&#13;
<p class="bull">• Analog five-pin, two-axis joystick module</p>&#13;
<p class="bull">• Pan-and-tilt housing module</p>&#13;
</div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="green"><strong>LIBRARIES REQUIRED</strong></span></p>&#13;
<p class="bull">• Servo</p>&#13;
</div>&#13;
<h3 class="h3" id="ch10lev1sec01"><span epub:type="pagebreak" id="page_88"/><span class="green"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">Servos are small motors that can precisely angle their arms to positions between 0 and 180 degrees. In this project we’ll place the servos into a tilt-and-pan mount. The tilt-and-pan mount is a worthy investment, as it makes it much easier to attach the laser to the servo. Here we’re controlling a laser, but you could easily replace the laser with a webcam or another small device. We use two servos: one for left and right movement, and the other for up and down movement. As you might remember, servomotors have three wires, shown in <a href="ch10.xhtml#ch10fig1">Figure 10-1</a>: positive power (red), negative power or ground (black or brown), and signal (typically yellow, orange, or white).</p>&#13;
<p class="figcaption"><a id="ch10fig1"/><strong>FIGURE 10-1:</strong><br/>Servos have three wires.</p>&#13;
<div class="image"><img alt="image" src="../images/f10-01.jpg"/></div>&#13;
<p class="indent">Before we begin building, you need to know a little about how a joystick works. The joystick shown in <a href="ch10.xhtml#ch10fig2">Figure 10-2</a> is basically two potentiometers and a button that allow us to measure the movement of the stick in two dimensions.</p>&#13;
<p class="figcaption"><a id="ch10fig2"/><strong>FIGURE 10-2:</strong><br/>This joystick has two potentiometers and a button for measuring movement.</p>&#13;
<div class="image"><img alt="image" src="../images/f10-02.jpg"/></div>&#13;
<p class="indent">Potentiometers are variable resistors and act as sensors that provide us with a voltage that varies depending on the rotation of <span epub:type="pagebreak" id="page_89"/>the device around its shaft. So as you move the joystick around its center, its resistance—and therefore its output—varies. The outputs from the potentiometers are analog, so they can have a value only between 0 and 1,023 when read by the analog pin of the Arduino. This number sends a pulse to the Arduino, which in turn tells the servos how far to move. (See <a href="ch02.xhtml#ch02">Project 2</a> for more on potentiometers.)</p>&#13;
<p class="indent">A joystick typically has five pins: VRx (the x-axis signal), VRy (the y-axis signal), SW (a pushbutton we won’t be using in this project), and GND and +5V for power.</p>&#13;
<p class="indent">When the x-axis of the joystick is moved to the left or right, the corresponding servo will move in that direction; when the y-axis of the joystick is moved up or down, the other servo will move up or down.</p>&#13;
<h3 class="h3" id="ch10lev1sec02"><span class="green"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindenta">Connect both servos’ red wires to the + 5V rail, and their brown wires to GND on the breadboard.</p></li>&#13;
<li><p class="noindenta">Connect one of the servo’s yellow signal wires directly to Arduino pin 9, and the other servo’s signal wire directly to Arduino pin 10, as shown in the circuit diagram in <a href="ch10.xhtml#ch10fig4">Figure 10-4</a>.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-g" style="vertical-align: middle;"><p class="tablec"><strong>SERVOS</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-g" style="vertical-align: middle;"><p class="tablec"><span class="green">Red wires</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="green">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-g" style="vertical-align: middle;"><p class="tablec"><span class="green">Brown wires</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="green">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-g" style="vertical-align: middle;"><p class="tablec"><span class="green">Yellow wire 1</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="green">Pin 9</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-g" style="vertical-align: middle;"><p class="tablec"><span class="green">Yellow wire 2</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="green">Pin 10</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Connect the GND from the joystick module to the Arduino GND rail, and +5V to the Arduino +5V rail. Connect the VRx pin directly to Arduino A0, and the VRy pin directly to Arduino A1. Again, the SW switch connection is not used in this project.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-g" style="vertical-align: middle;"><p class="tablec"><strong>JOYSTICK</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-g" style="vertical-align: middle;"><p class="tablec"><span class="green">+5V</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="green">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-g" style="vertical-align: middle;"><p class="tablec"><span class="green">GND</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="green">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-g" style="vertical-align: middle;"><p class="tablec"><span class="green">VRx</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="green">A0</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-g" style="vertical-align: middle;"><p class="tablec"><span class="green">VRy</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="green">A1</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-g" style="vertical-align: middle;"><p class="tablec"><span class="green">SW</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="green">Not used</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta"><span epub:type="pagebreak" id="page_90"/>Connect the breadboard rails to Arduino GND and +5V, and then check that your setup matches that of <a href="ch10.xhtml#ch10fig3">Figure 10-3</a>.</p>&#13;
<p class="figcaption"><a id="ch10fig3"/><strong>FIGURE 10-3:</strong><br/>The circuit diagram for the joystick-controlled laser. Note that the joystick in this diagram is a different brand than the one used in the project, but the connections are the same, so the instructions in the project will work fine.</p>&#13;
<div class="image"><img alt="image" src="../images/f10-03.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch10lev1sec03"><span class="green"><strong>MOUNTING THE LASER</strong></span></h3>&#13;
<p class="noindent">For this project, I’ve attached the servos to a pan-and-tilt housing module; you should be able to find this housing or a similar one for a relatively reasonable price on eBay by searching for “Arduino pan-and-tilt servo kit.” You may have to assemble it yourself, but this is simple to do with the included instructions.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_91"/>Attach a laser diode to the top of the module; I recommend using a glue gun for a permanent fixture, but you can use tape if you want something more temporary. Now you can control the laser using the joystick. The servos will clip into the tilt-and-pan module as shown in <a href="ch10.xhtml#ch10fig5">Figure 10-5</a>.</p>&#13;
<p class="figcaption"><a id="ch10fig4"/><strong>FIGURE 10-4:</strong><br/>Clipping the servos into the pan-and-tilt module</p>&#13;
<div class="image"><img alt="image" src="../images/f10-04.jpg"/></div>&#13;
<p class="indent">Moving the joystick left and right will move the x-axis servo, and moving the joystick up and down will move the y-axis servo. The complete assembly is shown in Figure 10-6.</p>&#13;
<p class="figcaption"><a id="ch10fig5"/><strong>FIGURE 10-5:</strong><br/>The complete assembly</p>&#13;
<div class="image"><img alt="image" src="../images/f10-05.jpg"/></div>&#13;
<h3 class="h3" id="ch10lev1sec04"><span epub:type="pagebreak" id="page_92"/><span class="green"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">The sketch first calls on the Servo library and then defines the two servos as <code>tilt</code> and <code>pan</code>. The joystick x-axis is attached to Arduino pin A0 and the y-axis to Arduino A1, and these are our <code>INPUT</code>. The x- and y-axes are then set as variables for movement. The <code>tilt</code> servo is attached to Arduino pin 9 and <code>pan</code> is attached to Arduino pin 10, and these are our <code>OUTPUT</code>. The Arduino then reads the <code>INPUT</code> from the joystick and changes this voltage to <code>OUTPUT</code>, moving the servos according to which direction is chosen.</p>&#13;
<pre><span class="ash">// Used with kind permission from http://learn.explorelabs.com/</span><br/><span class="ash">// Creative Commons 4.0 Share Alike (CC by SA 4.0) license</span><br/><br/>#include &lt;<span class="orange1">Servo</span>.h&gt;<br/><span class="orange1">Servo</span> tilt, pan;  <span class="ash">// Create servo object</span><br/><span class="green2">int</span> joyX = A0;    <span class="ash">// Analog pin connected to x-axis servo</span><br/><span class="green2">int</span> joyY = A1;    <span class="ash">// Analog pin connected to y-axis servo</span><br/><span class="green2">int</span> x, y;         <span class="ash">// Variables to read values</span><br/><br/><span class="green2">void</span> <span class="green3">setup</span>() {<br/>  tilt.<span class="orange1">attach</span>(9); <span class="ash">// Attach tilt servo on pin 9 to the servo object</span><br/>  pan.<span class="orange1">attach</span>(10); <span class="ash">// Attach pan servo on pin 10 to the servo object</span><br/>}<br/><br/><span class="green2">void</span> <span class="green3">loop</span>() {<br/>  x = joyX; <span class="ash">// Read value of x-axis (between 0 and 1023)</span><br/>  y = joyY; <span class="ash">// Read value of y-axis (between 0 and 1023)</span><br/>  x = <span class="orange1">map</span>(<span class="orange1">analogRead</span>(joyX), 0, 1023, 900, 2100); <span class="ash">// Scale it to use</span><br/>                                                 <span class="ash">// with servo between</span><br/>                                                 <span class="ash">// 900 to 2100</span><br/>                                                 <span class="ash">// microseconds</span><br/>  y = <span class="orange1">map</span>(<span class="orange1">analogRead</span>(joyY), 0, 1023, 900, 2100);<br/>  tilt.<span class="orange1">write</span>(x); <span class="ash">// Set servo position according to scaled value</span><br/>  pan.<span class="orange1">write</span>(y);<br/>  <span class="orange1">delay</span>(15);     <span class="ash">// Wait for servos to get to new position</span><br/>}</pre>&#13;


<h2 class="h2a" id="ch11"><span epub:type="pagebreak" id="page_93"/>PROJECT 11: REMOTE CONTROL SERVO</h2>&#13;
<p class="h2sub"><strong><span class="green">IN THIS PROJECT, WE’LL USE THE ARDUINO TO EXAMINE AND DECODE SIGNALS FROM A REMOTE CONTROL, AND THEN USE THESE CODES TO CONTROL A SERVO.</span></strong></p>&#13;
<div class="image2"><img alt="image" src="../images/f0093-01.jpg"/></div>&#13;
<div class="image2"><span epub:type="pagebreak" id="page_94"/><img alt="image" src="../images/f0094-01.jpg"/></div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="green"><strong>PARTS REQUIRED</strong></span></p>&#13;
<p class="bull">• Arduino board</p>&#13;
<p class="bull">• Breadboard</p>&#13;
<p class="bull">• Jumper wires</p>&#13;
<p class="bull">• 38 kHz IR receiver</p>&#13;
<p class="bull">• Remote control</p>&#13;
<p class="bull">• 2 Tower Pro SG90 9g servomotors</p>&#13;
<p class="bull">• Pan-and-tilt housing module</p>&#13;
</div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="green"><strong>LIBRARIES REQUIRED</strong></span></p>&#13;
<p class="bull">• Servo</p>&#13;
<p class="bull">• IRremote</p>&#13;
</div>&#13;
<h3 class="h3" id="ch11lev1sec01"><span epub:type="pagebreak" id="page_95"/><span class="green"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">First we’ll decode the remote control using an IR receiver. An IR receiver has three pins: OUT, GND, and VCC (shown left to right in <a href="ch11.xhtml#ch11fig1">Figure 11-1</a>). Check the data sheet for the receiver you bought to make sure it matches this pin layout. In rare cases you might find that your receiver’s pin layout differs, but you should still be able to use the pinout to wire it up.</p>&#13;
<p class="figcaption"><a id="ch11fig1"/><strong>FIGURE 11-1:</strong><br/>IR receiver—from left to right, the pins are OUT, GND, and VCC</p>&#13;
<div class="image"><img alt="image" src="../images/f11-01.jpg"/></div>&#13;
<p class="indent">You will also need a remote control. You can use any kind of remote, including a TV remote, but it is best to use an old one that you no longer need. When you press a button on the remote, it sends out a digital value that is picked up by the receiver. This value is different for each button. We’ll decode the values for each button with the Arduino and then assign them to Arduino pins in the sketch to control the output—in this case, a servo.</p>&#13;
<p class="indent">By personalizing the sketch with the values you decode, you can connect certain buttons to certain instructions and use your remote to control the servos. If you already built the pan-and-tilt housing model from <a href="ch10.xhtml#ch10">Project 10</a>, you can reuse that here. Otherwise, flip to <a href="ch10.xhtml#ch10">Project 10</a> for instructions on setting it up.</p>&#13;
<p class="indent">We’ll assign a button to the directional movement of the servos in the tilt-and-pan housing, so in total four buttons will control all movement: left and right for the x-axis servo, and up and down for <span epub:type="pagebreak" id="page_96"/>the y-axis servo. Short button presses will move the servos in small increments, and extended presses will move the servo continuously until the maximum or minimum value is reached.</p>&#13;
<h3 class="h3" id="ch11lev1sec02"><span class="green"><strong>THE SETUP</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindenta">Download the IRremote library from <em><a href="http://www.nostarch.com/arduinohandbook/">http://www.nostarch.com/arduinohandbook/</a></em> and add it to your libraries folder, as shown in “<a href="ch00.xhtml#ch00lev2sec07">Libraries</a>” on <a href="ch00.xhtml#page_7">page 7</a>.</p></li>&#13;
<li><p class="noindenta">Insert the IR receiver into a breadboard. Connect the OUT pin on the receiver to Arduino pin 11, GND to Arduino GND, and VCC to Arduino +5V. Again, with some versions of the 38 kHz receiver, the pin order may differ from what’s shown here, so check the data sheet corresponding to your component.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-g" style="vertical-align: middle;"><p class="tablec"><strong>IR RECEIVER</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-g" style="vertical-align: middle;"><p class="tablec"><span class="green">OUT</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="green">Pin 11</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-g" style="vertical-align: middle;"><p class="tablec"><span class="green">GND</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="green">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-g" style="vertical-align: middle;"><p class="tablec"><span class="green">VCC</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="green">+5V</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Now upload and run the following code.</p>&#13;
<pre><span class="ash">/* Copyright 2009 Ken Shirriff</span><br/>   <span class="ash">Used with kind permission</span><br/>   <span class="ash">http://arcfn.com</span><br/><span class="ash">*/</span><br/><br/>#include &lt;IRremote.h&gt; <span class="ash">// Use library</span><br/><span class="green2">int</span> receiver = 11;    <span class="ash">// Pin connected to receiver</span><br/><br/><span class="orange1">IRrecv</span> irrecv(receiver);<br/><span class="orange1">decode_results</span> results;<br/><span class="green2">void</span> <span class="green3">setup</span>() {<br/>  <span class="orange1">Serial</span>.<span class="orange1">begin</span>(9600);  <span class="ash">// Show keypresses in IDE</span><br/>  irrecv.<span class="orange1">enableIRIn</span>(); <span class="ash">// Start up receiver</span><br/>}<br/><br/><span class="green2">void</span> <span class="green3">loop</span>() {<br/>  <span class="green3">if</span> (irrecv.<span class="orange1">decode</span>(&amp;results)) { <span class="ash">// If there's an input, decode value</span><br/>    <span class="orange1">Serial</span>.<span class="orange1">println</span>(results.value, <span class="green2">HEX</span>); <span class="ash">// Display button value</span><br/>                                        <span class="ash">// on Serial Monitor in</span><br/>                                        <span class="ash">// hexadecimal format</span><br/>    irrecv.<span class="orange1">resume</span>(); <span class="ash">// Receive next value</span><br/>  }<br/>}</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_97"/>The sketch first calls on the IRremote library, which reads from the IR receiver and sends the corresponding data to the Arduino. The IR receiver is assigned to pin 11 on the Arduino, and the sketch begins communicating with the Arduino IDE so that when a button is pressed the input is displayed in the Serial Monitor in real time. The sketch continues in a loop, looking for button presses, and shows the corresponding value to the IDE.</p></li>&#13;
<li><p class="noindenta">Open the Serial Monitor in your IDE.</p></li>&#13;
<li><p class="noindenta">Point your remote toward the receiver and try pressing different buttons. They will appear in the Serial Monitor decoded into letters and numbers in a format known as hexadecimal (HEX), as shown in <a href="ch11.xhtml#ch11fig2">Figure 11-2</a>. Try short, sharp presses to get the best results. If you press a button for too long, the Serial Monitor will show <em>F</em>s for as long as you hold the button.</p>&#13;
<p class="figcaption"><a id="ch11fig2"/><strong>FIGURE 11-2:</strong><br/>When a button on the remote is pressed, the HEX code for that button is displayed in the Arduino IDE Serial Monitor.</p>&#13;
<div class="image"><img alt="image" src="../images/f11-02.jpg"/></div>&#13;
<p class="indent">Write down the numbers that appear and the buttons they correspond to. You will need these numbers later.</p></li>&#13;
</ol>&#13;
<p class="indent">Now that we’ve decoded the button signals from the remote control, we can use them to control two servos.</p>&#13;
<h3 class="h3" id="ch11lev1sec03"><span class="green"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindenta">Using your breadboard setup from step 2 on <a href="ch11.xhtml#page_96">page 96</a>, with the receiver already connected, attach your servos to the Arduino by connecting the brown wire on each to GND, and the red wire to +5V. Then, connect the yellow control wire for the first servo to Arduino pin 10, and the yellow control wire for the second servo to Arduino pin 9.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-g" style="vertical-align: middle;"><p class="tablec"><span epub:type="pagebreak" id="page_98"/><strong>SERVOS</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-g" style="vertical-align: middle;"><p class="tablec"><span class="green">Red wires</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="green">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-g" style="vertical-align: middle;"><p class="tablec"><span class="green">Brown wires</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="green">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-g" style="vertical-align: middle;"><p class="tablec"><span class="green">Yellow wire (servo 1)</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="green">Pin 10</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-g" style="vertical-align: middle;"><p class="tablec"><span class="green">Yellow wire (servo 2)</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="green">Pin 9</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Remember to attach power to your breadboard.</p></li>&#13;
<li><p class="noindenta">Check that your setup matches the circuit diagram in <a href="ch11.xhtml#ch11fig3">Figure 11-3</a>, and then upload the code in “<a href="ch11.xhtml#ch11lev1sec04">The Sketch</a>” on <a href="ch11.xhtml#page_99">page 99</a>.</p>&#13;
<p class="figcaption"><a id="ch11fig3"/><strong>FIGURE 11-3:</strong><br/>The circuit diagram for the remote control servo</p>&#13;
<div class="image"><img alt="image" src="../images/f11-03.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch11lev1sec04"><span epub:type="pagebreak" id="page_99"/><span class="green"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">Make sure you use the values that you decoded in step 3 of “<a href="ch11.xhtml#ch11lev1sec02">The Setup</a>” on <a href="ch11.xhtml#page_96">page 96</a> in place of the values included here when completing the sketch. When you’re changing the value in the sketch to match your own codes, keep the 0x and add your HEX code after it. For example, for the first button I decoded, the HEX code is FFA05F, which looks like this in the sketch:</p>&#13;
<pre><span class="green2">unsigned long</span> Value1 = 0xFFA05F;</pre>&#13;
<p class="indent">In this project we’re controlling servos, but you could adapt the code slightly to remotely control anything that needs to be set to <code>HIGH</code>, such as an LED or piezo buzzer.</p>&#13;
<p class="indent">The sketch calls on the IRremote library to read from the receiver and the Servo library to move the motors. The first two buttons are assigned to the x-axis servo to move the angle to a maximum of 70 degrees for left pan or 160 degrees for right. The third and fourth buttons are assigned to the y-axis servo to control the up and down tilt movement.</p>&#13;
<p class="indent">If you want to adapt this to other output, change the code:</p>&#13;
<pre>servo.<span class="orange1">write</span></pre>&#13;
<p class="noindent">to:</p>&#13;
<pre><span class="orange1">digitalWrite</span>(pin, <span class="green2">HIGH</span>)</pre>&#13;
<p class="indent">Enter the sketch as follows:</p>&#13;
<pre><span class="ash">/* IR Library Copyright Ken Shirriff</span><br/>   <span class="ash">Used with kind permission</span><br/>   <span class="ash">http://arcfn.com</span><br/> <span class="ash">*/</span><br/><br/>#include &lt;<span class="orange1">Servo</span>.h&gt;    <span class="ash">// Include the Servo library</span><br/>#include &lt;IRremote.h&gt; <span class="ash">// Include the IRremote library</span><br/><br/><span class="green2">unsigned long</span> Value1 = 0xFFA05F; <span class="ash">// Change this to your value</span><br/><span class="green2">unsigned long</span> Value2 = 0xFF50AF; <span class="ash">// Change this to your value</span><br/><span class="green2">unsigned long</span> Value3 = 0xFF807F; <span class="ash">// Change this to your value</span><br/><span class="green2">unsigned long</span> Value4 = 0xFF609F; <span class="ash">// Change this to your value</span><br/><br/><span class="green2">int</span> RECV_PIN = 11;<br/><span class="orange1">IRrecv</span> irrecv(RECV_PIN);<br/><span class="orange1">decode_results</span> results;<br/><span epub:type="pagebreak" id="page_100"/><span class="orange1">Servo</span> servo1;<br/><span class="orange1">Servo</span> servo2;<br/><br/><span class="green2">void</span> <span class="green3">setup</span>() {         <span class="ash">// Set up routine</span><br/>  <span class="orange1">Serial</span>.<span class="orange1">begin</span>(9600);<br/>  irrecv.<span class="orange1">enableIRIn</span>(); <span class="ash">// Start the IR receiver</span><br/>  servo1.<span class="orange1">attach</span>(10);   <span class="ash">// Pin connected to servo 1</span><br/>  servo2.<span class="orange1">attach</span>(9);    <span class="ash">// Pin connected to servo 2</span><br/>}<br/><br/><span class="green2">void</span> <span class="green3">loop</span>() { <span class="ash">// Loop routine runs forever</span><br/>  <span class="green3">if</span> (irrecv.<span class="orange1">decode</span>(&amp;results)) {<br/>    <span class="orange1">Serial</span>.<span class="orange1">println</span>(results.value, <span class="green2">HEX</span>);<br/>    irrecv.<span class="orange1">resume</span>(); <span class="ash">// Receive the next value</span><br/>  }<br/>  <span class="green3">if</span> (results.value == Value1) { <span class="ash">// If remote code matches value 1,</span><br/>                                 <span class="ash">// then move the servo</span><br/>    servo1.<span class="orange1">write</span>(160);<br/>  }<br/>  <span class="green3">else if</span> (results.value == Value2) { <span class="ash">// If remote code matches</span><br/>                                      <span class="ash">// value 2, then move the</span><br/>                                      <span class="ash">// servo, and so on</span><br/>    servo1.<span class="orange1">write</span>(70);<br/>  }<br/>  <span class="green3">else if</span> (results.value == Value3) {<br/>    servo2.<span class="orange1">write</span>(70);<br/>  }<br/>  <span class="green3">else if</span> (results.value == Value4) {<br/>    servo2.<span class="orange1">write</span>(160);<br/>  }<br/>}</pre>&#13;
</body></html>