<html><head></head><body>
<h2 class="h2" id="ch17"><span epub:type="pagebreak" id="page_135"/>—17—<br/>A Binary Search Tree Trap</h2>&#13;
<p class="noindent">Less than a block from Cloaks and More, Frank spotted a woman tailing him. Even as irritation flashed through him, he had to admit that she was good. She kept to the other side of the road, always at least 30 feet back. More often than not, she relied on the reflections in the shop windows to watch him. And she wore a perfectly nondescript traveling cloak—a shade of forest green sported by over half the people on the street.</p>&#13;
<p class="indent">Frank stopped abruptly, dropped to one knee, and pretended to tie his shoe. It was the second oldest technique for identifying a tail, the first being to dash madly in a random direction and see who followed. Although arguably less effective than a mad dash, the fake-shoe-tying routine had the benefit of subtlety and, more importantly, involved no running.</p>&#13;
<p class="indent">The tail continued on past, stopping about 10 feet ahead to examine a stack of cabbages through a particularly well-polished shop window.</p>&#13;
<p class="indent">Frank stood and started back in the other direction. After half a block, he crossed to her side of the street, ignoring the angry shouts from a donkey cart driver, and started down a small alley. Once off the main road, he turned around and waited.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_136"/>The tail almost ran into him as she hurried around the corner.</p>&#13;
<p class="indent">“Hi,” said Frank. “Why are you following me?” He tried for a conversational, nonchalant tone—something he couldn’t pull off even under normal circumstances. It was at best a growl, though he did manage to avoid shouting.</p>&#13;
<p class="indent">Professional spies often devote considerable time to planning how they will react if discovered. They develop a portfolio of complex backstories for a range of scenarios, explaining away everything from following someone to being discovered in the royal palace with a listening device and a fake turtle. They dream of smooth recoveries and effortless lies. However, things rarely go so well in reality, and gasps of surprise are actually quite common. In this case, Frank had even been hoping for a moment of panic to exploit.</p>&#13;
<p class="indent">True to form, however, the tail remained professional. There was no panic. There was no gasp of surprise. The only indication that anything had gone wrong was the briefest flash of anger in her eyes right before she flung down a smoke bomb and vanished.</p>&#13;
<p class="indent">Even without the smoke bomb, the spy would have been too fast for Frank. By the time he grabbed for her, he could hear her footsteps pounding down the street. He cursed and plunged through the smoke after her.</p>&#13;
<p class="indent">Within half a block, Frank had resigned himself to yet another depth-first search. He had chased enough petty thieves through the city to know how it would go. The spy would likely turn off the main road soon, hoping to get out of sight. It wasn’t a bad strategy in general, but it wouldn’t work here. This part of the city had few side streets, and most of them were dead ends.</p>&#13;
<p class="indent">As he ran, he visualized the streets as a graph, with the intersections and dead ends as nodes where he would have to make decisions and the roads in between as the graph’s edges—paths that got him from one decision point to another.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_137"/><img src="../images/f0137-01.jpg" alt="image"/></div>&#13;
<p class="indent">Doing a quick calculation, he figured he had time to explore maybe five or six side streets before he fell too far behind and the trail went cold. Unfortunately, that was just one of the risks of using depth-first search for a chase.</p>&#13;
<p class="indent">The first two streets proved to be a waste of time. The closest thing he found to criminal activity was a pack of kids covering the wall with graffiti. Using a charred stick, they had written “Team recursion” and “Recursion 4eva.” He continued his search.</p>&#13;
<p class="indent">A few more dead ends later, Frank was contemplating giving up when he spotted a trail of footprints in the mud leading to an open sewer grate. He leaned against the wall and caught his breath. This had to be her escape route.</p>&#13;
<p class="indent">Frank peered into the dark hole but couldn’t see anything. He lowered himself through the sewer grate and dropped onto a wooden platform. He crouched low, making himself as small a target as possible, and scanned the dark room. The platform was bolted to a rough stone wall, overlooking a cavernous room that extended at least 50 feet down. The only light streamed in through the opening above, shining down like a giant spotlight on the distant floor. As he watched, the spy streaked through the oval of light and ran toward the opposite wall. She was well ahead of him now.</p>&#13;
<p class="indent">Frank surveyed his options. There were other platforms below him, about 20 feet apart and connected by iron ladders. When he noticed the small brass tag embedded in the floor, he swore vigorously. He was standing at the top of a binary search ladder.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_138"/><img src="../images/f0138-01.jpg" alt="image"/></div>&#13;
<p class="indent">Binary search ladders were originally designed by Alena Branche, an eccentric art gallery owner, as a way to organize paintings. They were effectively giant binary search trees—data structures designed to allow efficient searches. The structure is organized like a giant upside-down tree, with a single platform at the top, known technically as the <em>root node</em>. Branching down from each platform is a maximum of two ladders, each of which leads to a different <em>child node</em>—another platform one level below. The entire structure branches and branches as it descends, offering a variety of paths.</p>&#13;
<p class="indent">A fanatic about the tiniest details, Alena had originally used this structure to organize paintings by the number of grass blades depicted. She enforced a simple organizational scheme: when standing on any platform, you were guaranteed that all paintings below the left ladder (in the left <em>subtree</em>) would contain fewer blades of grass than the current platform’s picture. And all paintings below the right ladder (in the right <em>subtree</em>) would contain more. By starting at the top, you could even choose your path down so as to find a painting with a particular number of grass blades.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_139"/><img src="../images/f0139-01.jpg" alt="image"/></div>&#13;
<p class="indent">Unfortunately, these kinds of binary search ladders never really caught on in the art world, due to both their excessive size and the need for constant climbing, but they were quickly adopted and adapted by the criminal world. Binary search ladder traps, the dangerous implementation of Alena’s creation, had been developed by junior wizard Katia Ladderfell while she was working for the Vinettees. Instead of paintings, Katia placed a single numeric tag on each platform and created a numeric password that would allow safe passage through the tree. When designing a tree and placing the tags, she maintained the binary search tree property—the values in any node’s left subtree were always less than at the node itself, and the values in the right subtree were always greater. Only one path through this new weaponized binary search tree was safe, and that was the path that led to the password value at the bottom-most node. If you knew the password, you could descend the tree as though performing a search for that value. At each level, you could compare the password’s value to the value on the current platform and choose the left or right ladder accordingly. Thus, the Vinettees’ thugs were required to memorize only a single password instead of a series of ladder choices. This simplicity was essential given the quality of the organization’s help.</p>&#13;
<p class="indent">If you didn’t know the password and chose a wrong ladder, you triggered sometimes deadly and sometimes just emotionally scarring traps. Typical dangers included cursed ladders, poisonous spiders, falling rocks, dart guns, swinging blades, and in some cases magical <span epub:type="pagebreak" id="page_140"/>insults—where intruders would be demoralized by five levels of progressively nasty observations on the state of their appearance, odor, or general intelligence.</p>&#13;
<p class="indent">The last time Frank had faced one of the Vinettees’ binary search ladders, a snitch had given him the password—the number 10. This one number allowed Frank to sneak into the hideout undetected and catch three of the Vinettees by surprise. Only Rebecca had escaped.</p>&#13;
<p class="indent">If only he knew the password to this trap, he might still have a chance of catching the spy.</p>&#13;
<p class="indent">A series of ideas flickered through Frank’s mind in quick succession. First, why wouldn’t the Vinettees reuse passwords? Their thugs tended to be rather dim individuals. Frank doubted they could remember more than a few numbers. Second, there weren’t really any evil wizards around anymore, so this binary search ladder trap must have been constructed years ago. After the wizard Exponentious’s failed attempt to bring down the kingdom, the lesser evil wizards had either reformed or gone into hiding. In fact, Katia Ladderfell herself had fled town to start a coconut farm. Finally, Frank was extremely high up and his knees were starting to feel weak.</p>&#13;
<p class="indent">Frank eyed the tag on the root node platform on which he stood: 50. If he was correct and the Vinettees had reused the password, he needed to search down the ladders for 10. Since 10 is less than 50, he needed to go down the left subtree.</p>&#13;
<div class="image"><img src="../images/f0140-01.jpg" alt="image"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_141"/>Mumbling a string of preemptive curses, Frank moved toward the left-hand ladder and started down. The journey proved gratifyingly uneventful. No spiders. No swinging blades. Not even a single insult.</p>&#13;
<div class="image"><img src="../images/f0141-01.jpg" alt="image"/></div>&#13;
<p class="indent">On the next platform, Frank found a tag labeled 5. Since 10 is greater than 5, he knew the path was to the right this time. He jogged to the right-hand ladder, growing in confidence. It often paid to trust in others’ incompetence.</p>&#13;
<div class="image"><img src="../images/f0141-02.jpg" alt="image"/></div>&#13;
<p class="indent">The next platform sat one level, and 20 feet, above the ground. Frank noted that the tag read 25 and immediately went left.</p>&#13;
<p class="indent">He had descended halfway before he realized something was wrong. He heard a soft screech as the rung above his left foot started to move. He glanced down just in time to see it hit the bar <span epub:type="pagebreak" id="page_142"/>below, crunching his left foot between the rungs. He shouted in surprise. As he watched, the rung slid up and then down again, sending a fresh jolt of pain through his foot. The ladder was literally biting him. He could even feel ridges of metallic teeth start to poke out along each rung.</p>&#13;
<p class="indent">Making a split-second decision, he jumped clear before the ladder could start chomping at his fingers. He landed awkwardly on his twice-bitten foot, staggering a few steps before easing himself to the floor.</p>&#13;
<p class="indent">He swivelled around and glared at the tag at the bottom of the ladder. The tag clearly read 10. He had taken the correct path. Then he noticed a small chalk notation on the floor nearby. It read “Do not use. Password changed.” Frank promptly resumed his swearing.</p>&#13;
<div class="image"><img src="../images/f0142-01.jpg" alt="image"/></div>&#13;
<div class="sidebar">&#13;
<p class="sidebart"><span epub:type="pagebreak" id="page_143"/><strong>POLICE ALGORITHMS 101: BINARY SEARCH TREES</strong></p>&#13;
<p class="sbsub"><em><strong>Excerpt from Professor Drecker’s Lecture</strong></em></p>&#13;
<p class="noindent">A binary search tree is a data structure that organizes data similarly to how it would be accessed in an ordinary binary search. Each tree node stores a single value and can have up to two child nodes: a left child and a right child. The tree nodes are organized by the values they contain. The values of the data in the left node (and all its children) will be lower than the value of the current node. Similarly, the values of the data in the right node (and all its children) will be greater than the value of the current node.</p>&#13;
<div class="image"><img src="../images/f0143-01.jpg" alt="image"/></div>&#13;
<p class="indent">We can efficiently search the binary search tree by walking down from the topmost node—also called the <em>root node</em>. At each step, we determine whether to explore the left or right subtree by comparing the value at the current node with the target value. If the target value is less than the current value, the search progresses to the left:</p>&#13;
<div class="image"><img src="../images/f0143-02.jpg" alt="image"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_144"/>If the target value is greater than the current value, the search progresses to the right:</p>&#13;
<div class="image"><img src="../images/f0144-01.jpg" alt="image"/></div>&#13;
<p class="indent">The search ends when either the target value is found or we reach a dead end. In the latter case, we can definitively say that the target value is not in the tree.</p>&#13;
<p class="indent">We say that the binary search tree is perfectly balanced if every node in the tree has the same number of nodes in its left subtree as in its right subtree. In this case, the depth of the tree grows by one each time we approximately double the number of nodes in the tree.</p>&#13;
<p class="indent">The computational cost of a search is proportional to the depth of the target value in the tree. The deeper the tree, the more comparisons we have to perform.</p>&#13;
</div>&#13;
</body></html>