<html><head></head><body>
<h2 class="h2" id="ch05"><span epub:type="pagebreak" id="page_122"/><span class="num">5</span> A Color-Mixing Night-Light</h2>&#13;
<p class="noindent1"><span epub:type="pagebreak" id="page_123"/><span class="red">The wonderful thing about digital electronics and microcontrollers is that they are smart. They can read sensors and make decisions based on what those sensors tell them. <span class="underline">Sensors</span> are components that collect information about the environment around them and convert that into something a microcontroller can understand.</span></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_124"/>You can use sensors to make projects that react to all sorts of stimuli (like temperature, sound, and the proximity of an object), but in this project, we’ll start small with a night-light that reacts to changes in light level, shown in <a href="ch05.xhtml#ch05fig01">Figure 5-1</a>.</p>&#13;
<p class="figuret"><a id="ch05fig01"/><strong>FIGURE 5-1:</strong> Finished Night-Light project</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_1.jpg"/></div>&#13;
<h3 class="h3" id="ch05lev1sec1"><strong>MATERIALS TO GATHER</strong></h3>&#13;
<p class="noindent">This project uses a new kind of LED and a <em>photoresistor</em>, a sensor that changes resistance based on how much light it detects. We encourage you to be creative and design a custom shade, too, but if you don’t feel up to that challenge yet, fear not! This book’s resource files include a shade design you can start with. <a href="ch05.xhtml#ch05fig02">Figures 5-2</a> and <a href="ch05.xhtml#ch05fig03">5-3</a> show the parts and equipment you’ll need for this project.</p>&#13;
<h4 class="h4" id="ch05lev2sec1"><strong>Electronic Parts</strong></h4>&#13;
<div class="noter">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>The parts marked with an asterisk (*) do not come with the standard SparkFun Inventor’s Kit but are available in the separate add-on kit.</em></p>&#13;
</div>&#13;
<p class="bull">• One SparkFun RedBoard (DEV-13975), Arduino Uno (DEV-11021), or another Arduino-compatible board</p>&#13;
<p class="bull">• One USB Mini-B cable (CAB-11301 or your board’s USB cable; not shown)</p>&#13;
<p class="bull">• One solderless breadboard (PRT-12002)</p>&#13;
<p class="bull">• One mini breadboard (PRT-12043*; not shown)</p>&#13;
<p class="bull">• One RGB LED, common cathode (COM-09264)</p>&#13;
<p class="bull">• Three 330 Ω resistors (COM-08377, or COM-11507 for a pack of 20)</p>&#13;
<p class="bull">• One 10 kΩ resistor (COM-08374, or COM-11508 for a pack of 20)</p>&#13;
<p class="bull">• One photoresistor (SEN-09088)</p>&#13;
<p class="bull">• Male-to-male jumper wires (PRT-11026)</p>&#13;
<p class="bull"><span epub:type="pagebreak" id="page_125"/>• Short 4-inch male-to-male jumper wires (PRT-13870*)</p>&#13;
<p class="bull">• (Optional) Male-to-female jumper wires (PRT-09140*)</p>&#13;
<p class="bull">• (Optional) One 4 AA battery holder (PRT-09835*; not shown)</p>&#13;
<p class="figuret"><a id="ch05fig02"/><strong>FIGURE 5-2:</strong> Components for the Night-Light</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_2.jpg"/></div>&#13;
<h4 class="h4" id="ch05lev2sec2"><strong>Other Materials and Tools</strong></h4>&#13;
<p class="bull">• Craft knife</p>&#13;
<p class="bull">• Metal ruler</p>&#13;
<p class="bull">• Glue (hot glue gun or craft glue)</p>&#13;
<p class="bull">• One sheet of cardstock (not cardboard), about 8.5 × 11 inches</p>&#13;
<p class="bull">• One sheet of white or translucent vellum, or standard copy paper, about 8.5 × 11 inches</p>&#13;
<p class="bull">• Enclosure template (see <a href="ch05.xhtml#ch05fig20">Figure 5-20</a> on page <a href="ch05.xhtml#page_144">144</a>)</p>&#13;
<p class="figuret"><a id="ch05fig03"/><strong>FIGURE 5-3:</strong> Recommended building materials for the Night-Light</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_3.jpg"/></div>&#13;
<h3 class="h3" id="ch05lev1sec2"><span epub:type="pagebreak" id="page_126"/><strong>NEW COMPONENTS</strong></h3>&#13;
<p class="noindent">You’ll be using two new components in this project: an LED that has three colors integrated into a single package, and a photoresistor. Let’s take a look at how these components work.</p>&#13;
<h4 class="h4" id="ch05lev2sec3"><strong>The RGB LED</strong></h4>&#13;
<p class="noindent">If you’ve built any of the other projects in this book, then you already have experience with regular LEDs. The <em>red, green, blue (RGB)</em> LED shown in <a href="ch05.xhtml#ch05fig04">Figure 5-4</a> works very similarly. This LED is actually three LEDs in one package: one red, one green, and one blue. Each LED has its own positive (or anode) leg, but they all share a single negative (or cathode) leg, called the <em>common cathode</em>.</p>&#13;
<p class="indent">If you look closely at the LED in <a href="ch05.xhtml#ch05fig04">Figure 5-4</a>, you’ll notice that the legs are all different lengths. With regular LEDs, the short leg is the negative leg, but with the RGB LED, the longest leg is the negative leg. The circuit diagram for this component is usually drawn like <a href="ch05.xhtml#ch05fig05">Figure 5-5</a>. Notice that it shows three separate LEDs connected together, and they each share a single negative connection.</p>&#13;
<p class="figuret"><a id="ch05fig04"/><strong>FIGURE 5-4:</strong> An RGB LED with a common cathode leg</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_4.jpg"/></div>&#13;
<p class="figuret"><a id="ch05fig05"/><strong>FIGURE 5-5:</strong> Circuit diagram of an RGB LED</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_5.jpg"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_127"/>To figure out which positive leg is which color for this particular LED, orient the LED so that it looks like the one shown in <a href="ch05.xhtml#ch05fig05">Figure 5-5</a>. In this orientation, the leftmost leg is the red positive leg. The next leg (the longest one) is the shared negative leg, and the last two legs are the green and blue positive legs, respectively.</p>&#13;
<p class="indent">Keeping in mind which positive leg corresponds to which color, you can wire this LED into a circuit just like you would three separate LEDs. Just connect the positive leg(s) you want to use to power or to an Arduino output pin through a current-limiting resistor, and connect the common cathode to ground.</p>&#13;
<p class="indent">RGB LEDs are cool because you can use them to create a slew of colors. Red, green, and blue are the primary colors in the additive color scheme, and the LED can mix these colors to create light in other colors. (This is different from the <em>primary pigments</em>—red, blue, and yellow—which, as you might remember from grade-school art class, mix together in paints to create new colors.) The additive color wheel in <a href="ch05.xhtml#ch05fig06">Figure 5-6</a> shows how primary colors can combine to create any color in the rainbow.</p>&#13;
<p class="figuret"><a id="ch05fig06"/><strong>FIGURE 5-6:</strong> The additive color wheel</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_6.jpg"/></div>&#13;
<p class="indent">With your RGB LED, if you turn on the blue LED and the red LED together, you get magenta light. Combine the red and green LEDs, and you get yellow. If all the LEDs are on, you get white light. This concept is the foundation for how an LED TV or monitor works: each pixel on your screen is essentially an RGB LED.</p>&#13;
<h4 class="h4" id="ch05lev2sec4"><strong>The Photoresistor</strong></h4>&#13;
<p class="noindent">This Night-Light will turn on when it is in a dark room and turn off when the room is bright. That means the Night-Light needs to determine whether the room is dark. To do so, it uses a light sensor to monitor the light level of its surroundings. There are a number of different light sensors available, but we used the simple photoresistor <span epub:type="pagebreak" id="page_128"/>shown in <a href="ch05.xhtml#ch05fig07">Figure 5-7</a>. This component is sometimes also called a <em>light-dependent resistor (LDR)</em> or a <em>photocell</em>. Also, similar to many other types of sensors, a photoresistor is sometimes referred to as a <em>variable resistor sensor</em>.</p>&#13;
<p class="indent">The resistance of the photoresistor in this project varies from about 80 Ω to around 1,000,000 Ω (1 MΩ) depending on how much light it is exposed to. The photoresistor has a low resistance when exposed to bright light and a high resistance when it’s in the dark.</p>&#13;
<p class="figuret"><a id="ch05fig07"/><strong>FIGURE 5-7:</strong> A photoresistor</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_7.jpg"/></div>&#13;
<p class="indent">To use the photoresistor to measure brightness, you have to place it in a <em>voltage divider</em> circuit, like the one in <a href="ch05.xhtml#ch05fig08">Figure 5-8</a>. A voltage divider uses two resistors wired in <em>series</em> (that is, in line with each other) between a supply voltage (5 V) and ground to obtain a smaller voltage.</p>&#13;
<p class="figuret"><a id="ch05fig08"/><strong>FIGURE 5-8:</strong> Voltage divider circuit</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_8.jpg"/></div>&#13;
<p class="indent">The total voltage across these two resistors is 5 V, and the voltages across <em>R</em><sub>1</sub> and <em>R</em><sub>2</sub> depend on the ratio of the two resistors’ resistances. <em>V</em><sub>out</sub> will be some voltage between 5 V and 0 V, because the voltage is divided between the two resistors. The relationship between <em>V</em><sub>out</sub> and the resistor values <em>R</em><sub>1</sub> and <em>R</em><sub>2</sub> can be characterized by the following equation.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_129"/><img alt="Image" src="../images/129equ01.jpg"/></div>&#13;
<p class="indent">We know what you’re thinking: that looks like math! Well, it is, and math is an important part of electronics, but it doesn’t have to be complicated. We’ll take things slow to make sure everyone understands it as we go along. This little equation is especially helpful when you’re dealing with this photoresistor or any other type of resistive sensor. In the voltage divider circuit, if you replace <em>R</em><sub>1</sub> with the photoresistor, you get the circuit shown in <a href="ch05.xhtml#ch05fig09">Figure 5-9</a>.</p>&#13;
<p class="figuret"><a id="ch05fig09"/><strong>FIGURE 5-9:</strong> A voltage divider circuit with a photoresistor</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_9.jpg"/></div>&#13;
<p class="indent">The resistance of the photoresistor increases as the light around it gets dim. Now, look at the voltage divider equation. As resistance <em>R</em><sub>1</sub> increases, the denominator of the fraction increases, making the entire fraction smaller. That means <em>V</em><sub>out</sub> gets smaller as it gets darker.</p>&#13;
<p class="indent">With this circuit, you can accurately read the amount of light on the photoresistor by connecting <em>V</em><sub>out</sub> to an analog input pin on the left-hand side of the Arduino (the pins marked with an A). <em>Analog</em> signals are those that can vary across a range of values. Up to this point, you’ve only used the <em>digital</em> pins on the right-hand side of the Arduino board. Unlike a push button, which has only two states, the photoresistor can have a range of values based on the brightness of light and the voltage divider circuit. This is the difference between a digital and an analog signal.</p>&#13;
<p class="indent">That’s all you really need to know to use this voltage divider circuit, but if you want to practice the calculations, see “<a href="ch05.xhtml#ch05sb01">Show Me Some Math: Voltage Dividers</a>” on page <a href="ch05.xhtml#page_130">130</a>.</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch05sb01"><span epub:type="pagebreak" id="page_130"/><strong>SHOW ME SOME MATH: VOLTAGE DIVIDERS</strong></p>&#13;
<p class="noindent">Using a multimeter, you can measure the resistance of a photoresistor under different conditions. (For instructions on using a multimeter, see “<a href="app01.xhtml#app01lev1sec1">Measuring Electricity with a Multimeter</a>” on page <a href="app01.xhtml#page_298">298</a>.) When we shined a bright light from a flashlight or cell phone on the photoresistor, we measured a resistance of about 100 Ω. When we covered the photoresistor with our hands, we saw a resistance of about 200 kΩ. With the fixed resistor (<em>R</em><sub>2</sub>) set at 10 kΩ, we’d expect to see the following values from the voltage divider in those two situations:</p>&#13;
<div class="image"><img alt="Image" src="../images/130equ01.jpg"/></div>&#13;
<p class="indent">With an input voltage of 5 V, the voltage across the photoresistor varies from 0.24 V to 4.95 V through a range of light levels. We’ll show you how to use the Arduino to read these voltages in this chapter. Pretty cool, right? Math works!</p>&#13;
</div>&#13;
<h3 class="h3" id="ch05lev1sec3"><strong>BUILD THE NIGHT-LIGHT PROTOTYPE</strong></h3>&#13;
<p class="noindent">Let’s put the RGB LED and the voltage divider together to build the Night-Light circuit. You’ll start by building the voltage divider circuit with the photoresistor and then add the RGB LED. When you’re done, your breadboard should look like <a href="ch05.xhtml#ch05fig10">Figure 5-10</a>. We’ve also included a circuit diagram in <a href="ch05.xhtml#ch05fig11">Figure 5-11</a> for your reference.</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_131"/><a id="ch05fig10"/><strong>FIGURE 5-10:</strong> Completed prototype circuit</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_10.jpg"/></div>&#13;
<p class="figuret"><a id="ch05fig11"/><strong>FIGURE 5-11:</strong> Circuit diagram of completed prototype Night-Light circuit</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_11.jpg"/></div>&#13;
<h4 class="h4" id="ch05lev2sec5"><strong>Wire the Voltage Divider</strong></h4>&#13;
<p class="noindent">Find your photoresistor (it should look like the one in <a href="ch05.xhtml#ch05fig07">Figure 5-7</a>) and a 10 kΩ resistor. Recall that a 10 kΩ resistor has brown, black, and orange color bands, as shown in <a href="ch05.xhtml#ch05fig12">Figure 5-12</a>. See “<a href="app01.xhtml#app01lev1sec4">Resistors and Bands</a>” on page <a href="app01.xhtml#page_308">308</a> for details on how to determine the value of a resistor from its color bands.</p>&#13;
<p class="figuret"><a id="ch05fig12"/><strong>FIGURE 5-12:</strong> 10 kΩ resistor (brown-black-orange)</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_12.jpg"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_132"/>With your parts in hand, build the voltage divider circuit as shown in <a href="ch05.xhtml#ch05fig13">Figure 5-13</a>. It’s good practice to connect both power (5 V) and ground when setting up the breadboard for building circuits, so do that first. Find the ground rail (–) and the power rail (+) on the left side of your breadboard. Connect 5 V on the Arduino to the power rail, and connect GND on the Arduino to the ground rail.</p>&#13;
<p class="figuret"><a id="ch05fig13"/><strong>FIGURE 5-13:</strong> Completed voltage divider, using the photoresistor</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_13.jpg"/></div>&#13;
<p class="indent">Next, plug the photoresistor in near the bottom of the breadboard, with each leg in its own row. Plug one side of the 10 kΩ resistor into the same row as one of the photoresistor legs (connecting the two together), and plug the other side of the resistor into a row by itself. Add a wire to connect the 5 V power rail (+) to the photoresistor leg that isn’t connected to the resistor. Then, add another wire to connect the ground rail (–) to the resistor leg that’s in a row by itself.</p>&#13;
<p class="indent">Finally, connect the photoresistor to the Arduino by running a wire from the breadboard row that’s shared with both a leg from the resistor and a leg from the photoresistor to the Arduino analog input pin A0. This wire is often called the output voltage of the photoresistor, or the <em>signal wire</em>. The analog input pins, A0–A5, can all be used to measure a range of voltages.</p>&#13;
<p class="indent">Notice how the breadboard circuit looks a lot like the diagram in <a href="ch05.xhtml#ch05fig09">Figure 5-9</a>. This is one of the most basic sensor circuits used in Arduino projects. Many other analog sensors, like sensors for flex, temperature, and pressure, are variable resistors, too. To experiment with one of those later, just replace the photoresistor with that sensor.</p>&#13;
<h4 class="h4" id="ch05lev2sec6"><span epub:type="pagebreak" id="page_133"/><strong>Wire the RGB LED</strong></h4>&#13;
<p class="noindent">Remember the Stoplight circuit in <a href="ch02.xhtml#ch02">Project 2</a>? That project had three LEDs. The RGB LED basically squishes those three LEDs together. The RGB LED has four legs, and the longest leg is the common cathode (negative) leg. With your RGB LED oriented as in <a href="ch05.xhtml#ch05fig05">Figure 5-5</a>, find the red leg. Plug the RGB LED into the breadboard so that the red leg is at the top and the longest leg is the second one down, as shown in <a href="ch05.xhtml#ch05fig14">Figure 5-14</a>.</p>&#13;
<p class="figuret"><a id="ch05fig14"/><strong>FIGURE 5-14:</strong> Adding the RGB LED to the voltage divider circuit</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_14.jpg"/></div>&#13;
<p class="indent">The two halves of the breadboard are divided by a ditch that separates the rows. Plug the RGB LED into the right side, starting with the red pin in row 4.</p>&#13;
<p class="indent">Next, find three 330 Ω resistors; their color bands are orange-orange-brown. Use the three resistors to bridge the red, green, and blue pins across the ditch to open rows on the other side, as shown in <a href="ch05.xhtml#ch05fig14">Figure 5-14</a>. The resistors need to straddle the ditch so that the two ends of the resistors aren’t shorted together. Run a wire from the common cathode (negative) leg of the LED to the ground rail on the left side of the breadboard. Finally, connect the three pins of the RGB LED to the Arduino by running a wire from pin 11 on the Arduino to the resistor connected to the red pin on the breadboard, pin 10 on the Arduino to the resistor for the green pin on the breadboard, and pin 9 on the Arduino to the resistor for the blue pin on the breadboard. When you’re done, it should resemble the diagram in <a href="ch05.xhtml#ch05fig14">Figure 5-14</a>. Notice that the red, green, and blue wires correspond to the red, green, and blue positive legs on the LED.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_134"/>With the RGB LED hooked up, you can control each color like a separate LED, using pins 9, 10, and 11. Open up the Arduino IDE, and let’s play with this idea!</p>&#13;
<h3 class="h3" id="ch05lev1sec4"><strong>TEST THE NIGHT-LIGHT WITH BASIC COLOR MIXING</strong></h3>&#13;
<p class="noindent">You’ll tackle a few new concepts with this project, starting with how to mix colors using an RGB LED. The RGB LED is really three LEDs in one, and you need to treat it that way in your code. Create a new sketch, and replace the default code with the <span class="literal">setup()</span> and <span class="literal">loop()</span> functions in <a href="ch05.xhtml#ch05ex01">Listing 5-1</a>.</p>&#13;
<p class="ex-caption"><a id="ch05ex01"/><strong>LISTING 5-1:</strong> A simple code example to display cyan on the RGB LED</p>&#13;
<div class="pre">&#13;
<p class="programs">  <span class="green">void</span> <span class="green1">setup</span>()<br/>  {<br/><span class="ent">➊</span>   <span class="orange">pinMode</span>(11, <span class="green">OUTPUT</span>);    <span class="ash">//red</span><br/>    <span class="orange">pinMode</span>(10, <span class="green">OUTPUT</span>);    <span class="ash">//green</span><br/>    <span class="orange">pinMode</span>(9, <span class="green">OUTPUT</span>);     <span class="ash">//blue</span><br/>  }<br/><br/>  <span class="green">void</span> <span class="green1">loop</span>()<br/>  {<br/><span class="ent">➋</span>   <span class="orange">digitalWrite</span>(11, <span class="green">LOW</span>);  <span class="ash">//red</span><br/><span class="ent">➌</span>   <span class="orange">digitalWrite</span>(10, <span class="green">HIGH</span>); <span class="ash">//green</span><br/><span class="ent">➍</span>   <span class="orange">digitalWrite</span>(9, <span class="green">HIGH</span>);  <span class="ash">//blue</span><br/>  }</p>&#13;
</div>&#13;
<p class="indent">Each pin that controls the RGB LED needs its own <span class="literal">pinMode()</span> function to set that pin as an <span class="literal">OUTPUT</span> <span class="ent">➊</span>. Previous projects used the <span class="literal">digitalWrite()</span> function to turn LEDs on and off with individual pins, and you’re going to do the same with the RGB LED. Using the color wheel in <a href="ch05.xhtml#ch05fig06">Figure 5-6</a>, choose from any of the colors represented. We selected cyan, the combination of green and blue. To create cyan, you need to turn on the green <span class="ent">➌</span> and blue <span class="ent">➍</span> LEDs using the <span class="literal">digitalWrite()</span> function. To make sure that the red LED is off, the code also needs a third <span class="literal">digitalWrite()</span> function <span class="ent">➋</span>.</p>&#13;
<p class="indent">Upload this sketch to your Arduino, and if the circuit is wired up correctly and the code is correct, your RGB LED should glow with a soft cyan light. If it’s a different color or not lighting up at all, check your wiring and the orientation of the RGB LED.</p>&#13;
<p class="indent">Notice that even though you’re using the RGB LED to mix colors, your code is still pretty similar to the code from other LED projects in this book. Each LED is turned on by a separate digital pin using the <span class="literal">pinMode()</span> function. You’re just controlling the colors by using multiple <span class="literal">digitalWrite()</span> functions at the same time.</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart"><span epub:type="pagebreak" id="page_135"/><strong>TRY IT OUT: MIX MORE COLORS!</strong></p>&#13;
<p class="noindent">Try changing the color of the LED on your own, and this time, incorporate red into the color. Can you make magenta? What about yellow? What color do you get when you turn all three colors on? Use the color wheel as a reference.</p>&#13;
</div>&#13;
<h3 class="h3" id="ch05lev1sec5"><strong>PROGRAM THE NIGHT-LIGHT</strong></h3>&#13;
<p class="noindent">In the Night-Light circuit, the photoresistor is used as a light sensor. The photoresistor voltage divider is connected to analog input pin A0. Recall that the Arduino can be used to measure voltage on any of the analog input pins. You can have the Arduino read the sensor value from that pin using the <span class="literal">analogRead()</span> function. The <span class="literal">analogRead()</span> function reads the voltage applied to an analog input pin and returns a value between 0 and 1,023, scaled from a voltage range of 0 V to 5 V. For example, if you applied 2.5 V to A0, the <span class="literal">analogRead(A0)</span> function would return a value of about 512, or roughly half of 1,023.</p>&#13;
<p class="indent">As the amount of light hitting the photoresistor changes, its resistance changes, and because of the voltage divider circuit, the voltage on the analog input pin changes, too. Let’s see how to code this on the Arduino. To determine whether the Night-Light should be on or off, you want to read the voltage from the photoresistor and compare it against a value that indicates whether the room is dark or bright. You should already have the circuit wired up, with the RGB LED and the photoresistor hooked up to pin A0. <a href="ch05.xhtml#ch05ex02">Listing 5-2</a> shows the Arduino sketch in its entirety. You can either modify the sketch you made for <a href="ch05.xhtml#ch05ex01">Listing 5-1</a> to match it or just add this code to a brand-new sketch.</p>&#13;
<p class="ex-caption"><a id="ch05ex02"/><strong>LISTING 5-2:</strong> Complete Night-Light code</p>&#13;
<div class="pre">&#13;
<p class="programs">  <span class="green">int</span> calibrationValue;<br/>  <span class="green">int</span> lightValue;<br/><br/>  <span class="green">void</span> <span class="green1">setup</span>()<br/>  {<br/>    <span class="orange">pinMode</span>(9, <span class="green">OUTPUT</span>);<br/>    <span class="orange">pinMode</span>(10, <span class="green">OUTPUT</span>);<br/>    <span class="orange">pinMode</span>(11, <span class="green">OUTPUT</span>);<br/><span class="ent">➊</span>   calibrationValue = <span class="orange">analogRead</span>(A0);<br/>  }<br/><span epub:type="pagebreak" id="page_136"/><br/>  <span class="green">void</span> <span class="green1">loop</span>()<br/>  {<br/><span class="ent">➋</span>   lightValue = <span class="orange">analogRead</span>(A0);<br/>    <span class="green1">if</span>(lightValue &lt; calibrationValue - 50)<br/>    {<br/>      <span class="orange">digitalWrite</span>(11, <span class="green">LOW</span>);   <span class="ash">//red</span><br/>      <span class="orange">digitalWrite(1</span>0, <span class="green">HIGH</span>);  <span class="ash">//green</span><br/>      <span class="orange">digitalWrite(9</span>, <span class="green">HIGH</span>);   <span class="ash">//blue</span><br/>    }<br/><span class="ent">➌</span>   <span class="green1">else</span><br/>    {<br/>      <span class="orange">digitalWrite</span>(11, <span class="green">LOW</span>);   <span class="ash">//red</span><br/>      <span class="orange">digitalWrite</span>(10, <span class="green">LOW</span>);   <span class="ash">//green</span><br/>      <span class="orange">digitalWrite</span>(9, <span class="green">LOW</span>);    <span class="ash">//blue</span><br/>    }<br/>  }</p>&#13;
</div>&#13;
<p class="indent">Upload this to your Arduino board, and make sure the room you’re in is brightly lit. When you shade the photoresistor enough with your hand, the RGB LED should turn on with a cyan color. If it doesn’t work, try cupping your hands around the photoresistor or covering it with a book or magazine to make sure that it doesn’t sense any light. Now, if you remove your hand and expose the photoresistor to light, the RGB LED should return to being off. Pretty cool! Let’s look at how this works.</p>&#13;
<h4 class="h4" id="ch05lev2sec7"><strong>Prepare to Check the Light Level</strong></h4>&#13;
<p class="noindent">First, the sketch creates the <span class="literal">calibrationValue</span> and <span class="literal">lightValue</span> global variables without assigning values to them. Like the code in <a href="ch05.xhtml#ch05ex01">Listing 5-1</a>, the <span class="literal">setup()</span> function calls <span class="literal">pinMode()</span> once for each pin of the RGB LED, setting pins 9, 10, and 11 to <span class="literal">OUTPUT</span>. Next, the sketch takes a single initial calibration reading from the photoresistor <span class="ent">➊</span> and places it in the <span class="literal">calibrationValue</span> variable. This is the value the sketch will compare future measured light levels against to decide whether to turn the LED on or not.</p>&#13;
<p class="indent">Now, jump into the <span class="literal">loop()</span> function. The <span class="literal">loop()</span> function repeatedly reads the current light level and stores it in the <span class="literal">lightValue</span> <span class="ent">➋</span> variable. The value of <span class="literal">lightValue</span> will be updated every time the <span class="literal">loop()</span> function repeats.</p>&#13;
<h4 class="h4" id="ch05lev2sec8"><strong>Control the Night-Light Based on the Light Level</strong></h4>&#13;
<p class="noindent">With the initial light level stored in the <span class="literal">calibrationValue</span> variable and the current light level stored in the <span class="literal">lightValue</span> variable, the Arduino can compare the two and decide whether to turn the Night-Light on <span epub:type="pagebreak" id="page_137"/>or off. You can tell the Arduino to do this by using an <span class="literal">if()</span> statement, a structure that controls the flow of code execution in a sketch. It allows the Arduino to make a decision based on the truth of an <em>expression</em>, a mathematical statement that has one of only two outcomes: <span class="literal">true</span> or <span class="literal">false</span>. You can see the basic flow of an <span class="literal">if()</span> statement in <a href="ch05.xhtml#ch05fig15">Figure 5-15</a>.</p>&#13;
<p class="figuret"><a id="ch05fig15"/><strong>FIGURE 5-15:</strong> The structural flow of an <span class="literal">if()</span> statement</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_15.jpg"/></div>&#13;
<p class="indent">This sketch’s <span class="literal">if()</span> statement checks the expression <span class="literal">lightValue &lt; calibrationValue - 50</span>. The <span class="literal">&lt;</span> symbol means “less than,” so this statement reads, “Is <span class="literal">lightValue</span> less than <span class="literal">calibrationValue</span> minus 50?” If that expression is <span class="literal">true</span>, the sketch enacts the code inside the set of curly brackets just underneath the <span class="literal">if()</span> statement.</p>&#13;
<p class="indent">As the room gets darker, the voltage coming from the sensor circuit decreases. This expression checks if <span class="literal">lightValue</span> is significantly smaller than <span class="literal">calibrationValue</span>, which is <span class="literal">true</span> if the room has gotten darker. If it has, the sketch sets pins 9 and 10 <span class="literal">HIGH</span> and sets pin 11 <span class="literal">LOW</span> to turn the Night-Light on with a cyan color.</p>&#13;
<p class="indent">When the <span class="literal">if()</span> statement is <span class="literal">false</span>, the Arduino skips to the code that follows. This sketch includes an <span class="literal">else</span> <span class="ent">➌</span> statement, which gets executed only after an <span class="literal">if()</span> statement’s expression evaluates to <span class="literal">false</span>. Inside the <span class="literal">else</span> statement, the sketch turns off all three pins.</p>&#13;
<h4 class="h4" id="ch05lev2sec9"><strong>Prevent False Alarms</strong></h4>&#13;
<p class="noindent">If the sketch just needs to check whether the light level has changed, why subtract 50 from the <span class="literal">calibrationValue</span> variable in the expression? Checking <span class="literal">lightValue</span> against a number smaller than <span class="literal">calibrationValue</span> increases the tolerance on the sketch. If you <span epub:type="pagebreak" id="page_138"/>were to use the <span class="literal">lightValue &lt; calibrationValue</span> expression, your Night-Light would flicker on and off at the smallest changes in light (flip back to “<a href="ch04.xhtml#ch04sb02">Logical Comparison Operators</a>” on page <a href="ch04.xhtml#page_106">106</a> for more on the <span class="literal">&lt;</span> symbol). Subtracting 50 from the calibration value makes sure that the Night-Light turns on when the light level is more than 50 below the calibration (initial) measurement.</p>&#13;
<h4 class="h4" id="ch05lev2sec10"><strong>Recalibrate the Night-Light</strong></h4>&#13;
<p class="noindent">One last piece of useful information before you prettify your Night-Light is how to reset the calibration value to recalibrate for different light levels. The value of <span class="literal">calibrationValue</span> is set in the <span class="literal">setup()</span> function, so it runs only once. When your Arduino is powered, there are two different ways to restart your sketch. First, you can turn the Arduino off and on again, but that’s kind of annoying and unsophisticated. The second way is a little more elegant. As with <a href="ch04.xhtml#ch04">Project 4</a>, you can simply press the reset button shown in <a href="ch05.xhtml#ch05fig16">Figure 5-16</a> to restart your sketch. It works the same way as the reset button on a computer or game console. Every time you press that button, the calibration value for the Night-Light is reset.</p>&#13;
<p class="figuret"><a id="ch05fig16"/><strong>FIGURE 5-16:</strong> The reset button in all of its clicky glory</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_16.jpg"/></div>&#13;
<p class="indent">Each time you move your project into a new room or lighting situation, recalibrate your photoresistor by pressing the reset button. When you recalibrate your photoresistor, make sure that it’s reading the actual lighting conditions of your room and that you’re not accidentally shadowing it in any way.</p>&#13;
<h3 class="h3" id="ch05lev1sec6"><strong>CREATE MORE COLORS WITH ANALOGWRITE()</strong></h3>&#13;
<p class="noindent">You’re not restricted to just the colors you’ve seen so far with the RGB LED. By mixing gradations of those colors, you can make cerulean, orange, powder pink, or any of the other thousands of combinations. <span epub:type="pagebreak" id="page_139"/>But you can’t create these colors by just turning the different standard colors on an RGB LED on and off, so you need a way to turn red on just a bit and add a hint of blue and green to create, for example, pink.</p>&#13;
<h4 class="h4" id="ch05lev2sec11"><strong>Create Analog Signals with PWM</strong></h4>&#13;
<p class="noindent">To use the LED in this way, you need to use analog values rather than digital values. In the Electronics Primer, we talked about the difference between analog and digital (page <a href="ch00.xhtml#page_10">10</a>). A digital value can only be on or off, like a normal light switch. An analog signal has an infinite number of values, so it works on a scale, like a dimmer switch.</p>&#13;
<p class="indent">The problem is that the Arduino is a digital device, which means that it can only turn things on and off. To get it to output a value somewhere between on and off, you use a technique called <em>pulse width modulation (PWM)</em> to emulate an analog signal with digital values. The Arduino does this by turning a digital pin on and off extremely fast and then varying the relative amount of time the signal is <span class="literal">HIGH</span> (on) compared to the amount of time the signal is <span class="literal">LOW</span> (off) to create a signal that appears to be analog. The longer a pin is at a high value, the greater the analog value of the signal. This is sometimes also called varying the <em>duty cycle</em>. <a href="ch05.xhtml#ch05fig17">Figure 5-17</a> shows some duty cycles with varying pulse widths; the analog value of the pulse at 75 percent is higher than the value of the 25 percent duty cycle.</p>&#13;
<p class="figuret"><a id="ch05fig17"/><strong>FIGURE 5-17:</strong> Duty cycle signals showing different widths of the pulse</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_17.jpg"/></div>&#13;
<p class="indent">That’s great, but not all Arduino pins have the ability to use PWM. On a standard Arduino, only certain GPIO pins—that is, pins 3, 5, 6, 9, 10, and 11—are PWM compatible. These pins are noted with a tilde (~) on the board, highlighted in <a href="ch05.xhtml#ch05fig18">Figure 5-18</a>.</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_140"/><a id="ch05fig18"/><strong>FIGURE 5-18:</strong> PWM pins on the standard RedBoard</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_18.jpg"/></div>&#13;
<p class="indent">Anytime you want to control something with varying values, like the brightness of an LED, the speed of a motor, or the tone of a buzzer, you’ll need to use a PWM pin to fake an analog signal. Here, we’ll use it to control the brightness of each color of the RGB LED in order to mix the colors. For this project, you have the RGB LED red, green, and blue pins already hooked up to PWM pins 11, 10, and 9, respectively, so you don’t have to change any of your wiring, only your code.</p>&#13;
<h4 class="h4" id="ch05lev2sec12"><strong>Mix Colors with analogWrite()</strong></h4>&#13;
<p class="noindent">To utilize these PWM powers, you need to use the <span class="literal">analogWrite()</span> function, which writes a PWM value to a pin. The <span class="literal">analogWrite()</span> function accepts two parameters: the pin number that you want to control and a PWM value to write, which is always a range from 0 to 255. The value of <span class="literal">0</span> is completely off, and <span class="literal">255</span> is completely on. Let’s write a simple sketch that demonstrates the <span class="literal">analogWrite()</span> function.</p>&#13;
<div class="pre">&#13;
<p class="programs">  <span class="green">void</span> <span class="green1">setup</span>()<br/>  {<br/><span class="ent">➊</span>   <span class="orange">pinMode</span>(9, <span class="green">OUTPUT</span>);<br/>  }<br/><br/>  <span class="green">void</span> <span class="green1">loop</span>()<br/>  {<br/><span class="ent">➋</span>   <span class="orange">analogWrite</span>(9, 2);<br/>  }</p>&#13;
</div>&#13;
<p class="indent">First, as with any other pin, you need to specify how you’re going to use the GPIO pin using the <span class="literal">pinMode()</span> function. You pass the pin number, and, since the LED is an output, you pass <span class="literal">OUTPUT</span> as you have in past projects <span class="ent">➊</span>. To set a PWM value, you use the <span class="literal">analogWrite()</span> function to set an analog value between 0 and 255. In the example, <span epub:type="pagebreak" id="page_141"/>pin 9 (the blue anode of the RGB LED) is set to an analog value of <span class="literal">2</span> <span class="ent">➋</span>. Upload this sketch to your Arduino, and you should have a dim blue colored RGB LED. The <span class="literal">analogWrite()</span> value of 2 uses PWM to turn on this LED for about 0.7 percent or 2/255 of the time. Before moving on, try changing the PWM value and reuploading a few times to get a feel for the different values and their intensity.</p>&#13;
<p class="indent">Now that you have the hang of the <span class="literal">analogWrite()</span> function, try using it to mix colors. <a href="ch05.xhtml#ch05ex03">Listing 5-3</a> creates a blink pattern with different, more interesting colors than those used so far.</p>&#13;
<p class="ex-caption"><a id="ch05ex03"/><strong>LISTING 5-3:</strong> Multicolored blink</p>&#13;
<div class="pre">&#13;
<p class="programs">  <span class="green">void</span> <span class="green1">setup</span>()<br/>  {<br/><span class="ent">➊</span>   <span class="orange">pinMode</span>(11, <span class="green">OUTPUT</span>);   <span class="ash">//red</span><br/>    <span class="orange">pinMode</span>(10, <span class="green">OUTPUT</span>);   <span class="ash">//green</span><br/>    <span class="orange">pinMode</span>(9, <span class="green">OUTPUT</span>);    <span class="ash">//blue</span><br/>  }<br/><br/>  <span class="green">void</span> <span class="green1">loop</span>()<br/>  {<br/><span class="ent">➋</span>   <span class="orange">analogWrite</span>(11, 153);  <span class="ash">//dark orchid purple</span><br/>    <span class="orange">analogWrite</span>(10, 50);<br/>    <span class="orange">analogWrite</span>(9, 204);<br/>    <span class="orange">delay</span>(1000);<br/><span class="ent">➌</span>   <span class="orange">analogWrite</span>(11, 155);  <span class="ash">//pale cerulean</span><br/>    <span class="orange">analogWrite</span>(10, 196);<br/>    <span class="orange">analogWrite</span>(9, 226);<br/>    <span class="orange">delay</span>(1000);<br/><span class="ent">➍</span>   <span class="orange">analogWrite</span>(11, 255);  <span class="ash">//cadmium yellow</span><br/>    <span class="orange">analogWrite</span>(10, 246);<br/>    <span class="orange">analogWrite</span>(9, 0);<br/>    <span class="orange">delay</span>(1000);<br/>  }</p>&#13;
</div>&#13;
<p class="indent">First, add the other two color pins using the <span class="literal">pinMode()</span> function <span class="ent">➊</span>. Then, cycle through three different colors by setting different analog values to the three pins. This sets the brightness level of each specific color, changing how much of that color is added to the final mix.</p>&#13;
<p class="indent">The first color set creates a bluish purple <span class="ent">➋</span>, the second creates a dusty pale blue <span class="ent">➌</span>, and the final set creates a bright yellow <span class="ent">➍</span>. Play around with <span class="literal">analogWrite()</span> to create different colors.</p>&#13;
<h4 class="h4" id="ch05lev2sec13"><strong>Find RGB Values with Color Picker</strong></h4>&#13;
<p class="noindent">You created some pretty specific colors before, but it can be hard to predict which RGB values will give you certain colors. An easy way of <span epub:type="pagebreak" id="page_142"/>finding out is to use a color-picker tool on the web. There are plenty of them out there, but we recommend <em><a href="https://www.colorpicker.com/">https://www.colorpicker.com/</a></em>. This tool gives you the RGB values for colors you pick from a palette, as shown in <a href="ch05.xhtml#ch05fig19">Figure 5-19</a>.</p>&#13;
<p class="figuret"><a id="ch05fig19"/><strong>FIGURE 5-19:</strong> The color-selector tool from <em><a href="https://www.colorpicker.com/">https://www.colorpicker.com/</a></em>.</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_19.jpg"/></div>&#13;
<p class="indent">The three numbers you want to use are labeled R, G, B for the three colors Red, Green, and Blue. Ignore the top three H, S, B boxes; they refer to another common method for specifying colors called <em>HSB (hue, saturation, and brightness)</em>. This is a useful technique for many color mixing and graphic design applications, but it’s not as useful when you have direct control over the three colors red, green, and blue.</p>&#13;
<h4 class="h4" id="ch05lev2sec14"><strong>The Custom-Color Night-Light Code</strong></h4>&#13;
<p class="noindent">With the RGB knowledge in hand, now you can easily modify your Night-Light code to include your custom color by replacing your <span class="literal">digitalWrite()</span> function with <span class="literal">analogWrite()</span>. <a href="ch05.xhtml#ch05ex04">Listing 5-4</a> shows changes to the Night-Light code, with the color values set to the teal color we selected in <a href="ch05.xhtml#ch05fig19">Figure 5-19</a>.</p>&#13;
<p class="ex-caption"><a id="ch05ex04"/><strong>LISTING 5-4:</strong> Final Night-Light code with <span class="literal">analogWrite()</span> instead of <span class="literal">digitalWrite()</span> commands</p>&#13;
<div class="pre">&#13;
<p class="programs"><span class="ash1">int calibrationValue;</span><br/><span class="ash1">int lightValue;</span><br/><br/><span class="ash1">void setup()</span><br/><span class="ash1">{</span><br/>  <span class="ash1">pinMode(9, OUTPUT);</span><br/>  <span class="ash1">pinMode(10, OUTPUT);</span><br/>  <span class="ash1">pinMode(11, OUTPUT);</span><br/>  <span class="ash1">calibrationValue = analogRead(A0);</span><br/><span class="ash1">}</span><br/><span epub:type="pagebreak" id="page_143"/><br/><span class="ash1">void loop()</span><br/><span class="ash1">{</span><br/>  <span class="ash1">lightValue = analogRead(A0);</span><br/>  <span class="ash1">if(lightValue &lt; calibrationValue - 50)</span><br/>  <span class="ash1">{</span><br/>    <span class="orange">analogWrite</span>(11, 66);   <span class="ash">//red</span><br/>    <span class="orange">analogWrite(1</span>0, 166);  <span class="ash">//green</span><br/>    <span class="orange">analogWrite(9</span>, 199);   <span class="ash">//blue</span><br/>  <span class="ash1">}</span><br/>  <span class="ash1">else</span><br/>  <span class="ash1">{</span><br/>    <span class="orange">analogWrite</span>(11, 0);    <span class="ash">//red off</span><br/>    <span class="orange">analogWrite</span>(10, 0);    <span class="ash">//green off</span><br/>    <span class="orange">analogWrite</span>(9, 0);     <span class="ash">//blue off</span><br/>  <span class="ash1">}</span><br/><span class="ash1">}</span></p>&#13;
</div>&#13;
<p class="indent">With that, your Night-Light prototype is done! If you don’t like the teal we selected, use the color-selector tool to find a color you prefer, update your <span class="literal">analogWrite()</span> functions with its RGB value, and then re-upload your sketch before moving on. Visit <em><a href="http://99colors.net/color-names/">http://99colors.net/color-names/</a></em> if you want to browse through some fun color suggestions.</p>&#13;
<p class="indent">Now that you have the code working, it’s time to get creative and build the enclosure and lampshade.</p>&#13;
<h3 class="h3" id="ch05lev1sec7"><strong>BUILD THE NIGHT-LIGHT ENCLOSURE</strong></h3>&#13;
<p class="noindent">We suggest cardstock for this project’s enclosure rather than cardboard (as it produces cleaner edges and is easier to work with) and a vellum material or translucent paper for the shade. Let’s get building.</p>&#13;
<h4 class="h4" id="ch05lev2sec15"><strong>Cardstock Construction</strong></h4>&#13;
<p class="noindent">We’ll show you a basic Night-Light design to get you started, but we encourage you to get creative by customizing the design later. Or, if you’re feeling confident, you can design your own Night-Light enclosure from scratch without using our templates at all.</p>&#13;
<h5 class="h5" id="ch05lev3sec1"><strong>Cut Out the Parts</strong></h5>&#13;
<p class="noindent">This project has two templates: one for the structure of the Night-Light and one for the shade. The shade can be made from any material similar to printer paper in thickness, but we’ve found that a fully translucent material like vellum works best. If you have a printer, you can open the templates in <a href="ch05.xhtml#ch05fig20">Figure 5-20</a> from this book’s resource files and print them directly to your material to cut out.</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_144"/><a id="ch05fig20"/><strong>FIGURE 5-20:</strong> Enclosure templates for the Night-Light (not full size)</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_20.jpg"/></div>&#13;
<p class="indent">Note that the base of the Night-Light enclosure has a square cut out for access to wires. We also found it convenient to leave one of the four side panels off so that we could run the wires back to the larger breadboard more easily. We’ll leave it up to you whether to include that fourth panel.</p>&#13;
<p class="indent">Once your template pieces are copied onto your cardstock and translucent material, cut them out. We highly recommend a sharp craft knife and a metal ruler to get clean edges for your project, as shown in <a href="ch05.xhtml#ch05fig21">Figure 5-21</a>. Remember craft-knife safety: always pull the blade (don’t push), and make multiple passes.</p>&#13;
<p class="figuret"><a id="ch05fig21"/><strong>FIGURE 5-21:</strong> Cutting out templates from cardstock</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_21.jpg"/></div>&#13;
<h5 class="h5" id="ch05lev3sec2"><span epub:type="pagebreak" id="page_145"/><strong>Assemble the Parts</strong></h5>&#13;
<p class="noindent">Arrange all of your pieces in front of you. You should have six pieces for the structure and four pieces for the shade material, as shown in <a href="ch05.xhtml#ch05fig22">Figure 5-22</a>.</p>&#13;
<p class="figuret"><a id="ch05fig22"/><strong>FIGURE 5-22:</strong> Individual parts cut out and ready for assembly</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_22.jpg"/></div>&#13;
<p class="indent">First, pick up the base (the piece with the center cut out). Hold it flat in front of you and fold the left and top edges toward you to form a right angle. Fold the tab on the left edge inward and secure it to the top edge with a small amount of glue, as shown in <a href="ch05.xhtml#ch05fig23">Figure 5-23</a>. Repeat this for the other four corners of the base piece, and then use the same technique to assemble the top piece.</p>&#13;
<div class="noter">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>Depending on your card-stock thickness, you may want to lightly score the fold lines with your craft knife. This will result in sharper, cleaner corners.</em></p>&#13;
</div>&#13;
<p class="figuret"><a id="ch05fig23"/><strong>FIGURE 5-23:</strong> Assembling the base and top pieces</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_23.jpg"/></div>&#13;
<p class="indent">Next, fold each of the four side pieces down the middle lengthwise to form a nice 90-degree angle. There is a dotted line in the template to guide you. Once you have the top and base assembled and the sides folded, the six pieces should look like the ones in <a href="ch05.xhtml#ch05fig24">Figure 5-24</a>.</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_146"/><a id="ch05fig24"/><strong>FIGURE 5-24:</strong> Assembled pieces for the Night-Light enclosure</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_24.jpg"/></div>&#13;
<p class="indent">Finally, take each corner piece and glue it to the base, as shown in <a href="ch05.xhtml#ch05fig25">Figure 5-25</a>.</p>&#13;
<p class="figuret"><a id="ch05fig25"/><strong>FIGURE 5-25:</strong> Glue each corner piece to the base</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_25.jpg"/></div>&#13;
<p class="indent">When you’re finished gluing corners, you should have four standing corner support structures. We found it easier to glue the shades in place before gluing the top piece, so just add a small dab of glue on the inside edge of each support structure, and press the shades into place, as shown in <a href="ch05.xhtml#ch05fig26">Figure 5-26</a>. You may want to use only three shades, to allow access for wires.</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_147"/><a id="ch05fig26"/><strong>FIGURE 5-26:</strong> Before adding the top piece, glue the shades into place.</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_26.jpg"/></div>&#13;
<p class="indent">When you’ve added all the panels you want, add the top piece. Simply add a small dab of glue on each corner to secure the top piece in place, as shown in <a href="ch05.xhtml#ch05fig27">Figure 5-27</a>.</p>&#13;
<p class="figuret"><a id="ch05fig27"/><strong>FIGURE 5-27:</strong> Adding the final top piece</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_27.jpg"/></div>&#13;
<p class="indent">Now you should have a completed Night-Light enclosure like the one in <a href="ch05.xhtml#ch05fig28">Figure 5-28</a>!</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_148"/><a id="ch05fig28"/><strong>FIGURE 5-28:</strong> Final Night-Light enclosure</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_28.jpg"/></div>&#13;
<h4 class="h4" id="ch05lev2sec16"><strong>Put the Electronics Inside</strong></h4>&#13;
<p class="noindent">You have a couple of options for transferring the electronics into your new project: put the breadboard and the Arduino baseplate under the Night-Light, or move just the LED inside the Night-Light. We took the second approach.</p>&#13;
<p class="indent">First, unplug your Arduino from the computer, and then move the RGB LED onto a mini breadboard. The mini breadboard works the same way as its bigger cousin does; it just lacks power rails and is shorter. Add jumper wires to the mini breadboard to make the connection from the LED back to your original circuit, as shown in <a href="ch05.xhtml#ch05fig29">Figure 5-29</a>. Notice that each of the four legs of the RGB LED is in a separate row: one for the red leg, one for the ground leg (the longest), one for green, and one for blue.</p>&#13;
<p class="figuret"><a id="ch05fig29"/><strong>FIGURE 5-29:</strong> Using the mini breadboard to move the RGB LED inside the Night-Light</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_29.jpg"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_149"/>Now, connect the other end of each jumper wire to the breadboard row where the corresponding RGB LED leg used to be, as in <a href="ch05.xhtml#ch05fig30">Figure 5-30</a>.</p>&#13;
<p class="figuret"><a id="ch05fig30"/><strong>FIGURE 5-30:</strong> Connecting the mini breadboard back to the main circuit</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_30.jpg"/></div>&#13;
<p class="indent">If you left one of the sides open, simply run the wires out the back of the lamp enclosure, like we did in <a href="ch05.xhtml#ch05fig31">Figure 5-31</a>. Otherwise, carefully place your shade over the mini breadboard, and either tape your jumper wires to the table so the shade stays flat or make a couple of notches in the cardboard at the bottom of the enclosure for the wires to fit through.</p>&#13;
<p class="figuret"><a id="ch05fig31"/><strong>FIGURE 5-31:</strong> Placing the shade on top of the mini breadboard</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_31.jpg"/></div>&#13;
<h4 class="h4" id="ch05lev2sec17"><span epub:type="pagebreak" id="page_150"/><strong>Let It Glow!</strong></h4>&#13;
<p class="noindent">If you have the external battery pack, you can now put four AA batteries in, and plug the barrel jack into the Arduino. The board should still be programmed and running, so just turn off the lights. You should get a nice, softly glowing night-light, like ours in <a href="ch05.xhtml#ch05fig32">Figure 5-32</a>.</p>&#13;
<p class="figuret"><a id="ch05fig32"/><strong>FIGURE 5-32:</strong> Lights out! Our final glowing Night-Light project.</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_32.jpg"/></div>&#13;
<h3 class="h3" id="ch05lev1sec8"><strong>GOING FURTHER</strong></h3>&#13;
<p class="noindent">This project used a lot of new skills and knowledge, but it still has a load of potential for further hacking. There are plenty of things you can do in terms of both the design and the code as you build your skills with Arduino.</p>&#13;
<h4 class="h4" id="ch05lev2sec18"><strong>Hack</strong></h4>&#13;
<p class="noindent">One great sketch hack would be to have the colors change periodically when the Night-Light is on. For some hints, look back at your Stoplight project code. One method would be to add some simple blink code within the <span class="literal">if()</span> statement rather than just <span class="literal">digitalWrite()</span> functions and build a color animation.</p>&#13;
<p class="indent">You could also try adding different colors for different light readings using the <span class="literal">else if()</span> command rather than just <span class="literal">if()</span> or <span class="literal">else</span> on its own. The base structure of this method might look something like <a href="ch05.xhtml#ch05ex05">Listing 5-5</a>.</p>&#13;
<p class="ex-caption"><a id="ch05ex05"/><strong>LISTING 5-5:</strong> Three-stage Night-Light code example</p>&#13;
<div class="pre">&#13;
<p class="programs"><span class="green1">if</span> (lightValue &lt; calibrationValue - 200)<br/>{<br/>  <span class="ash">//do if it is completely dark</span><br/>  <span class="orange">digitalWrite</span>(11, <span class="green">HIGH</span>);<br/>  <span class="orange">digitalWrite</span>(10, <span class="green">LOW</span>);<br/>}<br/><span epub:type="pagebreak" id="page_151"/><span class="green1">else if</span> (lightValue &lt; calibrationValue - 50)<br/>{<br/>  <span class="ash">//do if it is a little dim</span><br/>  <span class="orange">digitalWrite</span>(11, <span class="green">LOW</span>);<br/>  <span class="orange">digitalWrite</span>(10, <span class="green">HIGH</span>);<br/>}<br/><span class="green1">else</span><br/>{<br/>  <span class="ash">//do if it is bright</span><br/>  <span class="orange">digitalWrite</span>(11, <span class="green">LOW</span>);<br/>  <span class="orange">digitalWrite</span>(10, <span class="green">LOW</span>);<br/>}</p>&#13;
</div>&#13;
<p class="indent">You can see the sketch uses <span class="literal">else</span> <span class="literal">if()</span> to set categories of light value. You would then need to set the color for each category.</p>&#13;
<h4 class="h4" id="ch05lev2sec19"><strong>Modify</strong></h4>&#13;
<p class="noindent">The design of your Night-Light is totally up to you, so you can create a whole new design if you want. There are a number of tools you can use to design an enclosure and then produce it through automated means, such as laser cutting with balsa wood, 3D printing with materials like ABS or HIPS plastics, or even CNC milling, routing, or machining. Computer-controlled manufacturing will produce superclean and accurate parts that will amount to a more refined product. We encourage you to explore these possibilities to create something more permanent and polished. If you don’t have access to these kinds of tools, try looking into local hacker or maker spaces in your city. Often they’ll have facilities and tools that you can work with.</p>&#13;
<p class="indent">We have included a few example templates and ideas of projects that you can build and adapt at <em><a href="https://www.nostarch.com/arduinoinventor/">https://www.nostarch.com/arduinoinventor/</a></em>. <a href="ch05.xhtml#ch05fig33">Figure 5-33</a> shows an example of how you can break up the lampshade design with some fun patterns.</p>&#13;
<p class="figuret"><a id="ch05fig33"/><strong>FIGURE 5-33:</strong> A fun design from our design templates.</p>&#13;
<div class="image"><img alt="Image" src="../images/fig5_33.jpg"/></div>&#13;
</body></html>