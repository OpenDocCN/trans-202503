<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" epub:prefix="z3998: http://www.daisy.org/z3998/2012/vocab/structure/#" lang="en" xml:lang="en">
  <head>
    <title>Project 11: Gas and Smoke Alarm</title>
    <link href="../styles/9781593278717.css" rel="stylesheet" type="text/css"/>
    <link href="../68851547a55f.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <div id="sbo-rt-content"><h2 class="h2" id="ch11"><span epub:type="pagebreak" id="page_145"/><strong>11<br/>Gas and Smoke Alarm</strong></h2>
<p class="noindent"><span class="violet">In this project, you’ll build a gas and smoke alarm using an MQ-2 gas and smoke sensor and a piezo buzzer. Every time the sensor detects gas or smoke in the atmosphere above a certain threshold, the buzzer will sound.</span></p>
<div class="image"><span epub:type="pagebreak" id="page_146"/><img src="../images/f0146-01.jpg" alt="image"/></div>
<p class="cap"><span class="violet"><strong>PARTS REQUIRED</strong></span></p>
<p class="cap1">Raspberry Pi</p>
<p class="cap1">Breadboard</p>
<p class="cap1">MQ-2 gas and smoke sensor</p>
<p class="cap1">MCP 3008 chip</p>
<p class="cap1">Piezo buzzer</p>
<p class="cap1">5 mm LED</p>
<p class="cap1">330 Ω resistor</p>
<p class="cap1">Pushbut ton</p>
<p class="cap1">Lighter</p>
<p class="cap1">Jumper wires</p>
<h3 class="h3" id="lev116"><span class="violet"><span epub:type="pagebreak" id="page_147"/><strong>INTRODUCING THE MQ-2 GAS AND SMOKE SENSOR</strong></span></h3>
<p class="noindent">The MQ-2 gas and smoke sensor is sensitive to smoke and the following flammable gases: propane, butane, methane, alcohol, and hydrogen. <a href="ch11.xhtml#ch11fig1">Figure 11-1</a> shows the sensor’s front and back views.</p>
<div class="image"><a id="ch11fig1"/><img src="../images/f0147-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 11-1:</strong> The MQ-2 gas and smoke sensor, front and back views</p>
<p class="indent">The MQ-2 has two ways of outputting gas levels. The first is to read the gas concentration in the atmosphere and output it as an analog signal from the analog output pin AO, where the higher the gas levels, the higher the output voltage.</p>
<p class="indent">The second is to set a certain threshold and then output a HIGH signal from the digital output pin DO if the gas levels are above that threshold, and a LOW signal if the gas levels are below that threshold. The MQ-2 has a potentiometer built into the back that you can adjust with a screwdriver to change this threshold.</p>
<p class="indent">The sensor also has a power LED in the back that indicates if the sensor is on, and a digital output LED that lights up when detected gas levels are above the set threshold.</p>
<p class="indent">You’ll be reading the analog signal, which provides a quantitative measure of the gas levels, allowing you to better define the threshold value above which you want the buzzer to warn you of higher gas levels. Remember that the Pi can read only digital signals, so to read the analog signals with the Pi, you’ll use an analog-to-digital converter module (MCP3008 chip), which was first introduced in <a href="ch03.xhtml#ch03">Project 3</a>.</p>
<h3 class="h3" id="lev117"><span epub:type="pagebreak" id="page_148"/><span class="violet"><strong>INTRODUCING THE PIEZO BUZZER</strong></span></h3>
<p class="noindent">The piezo buzzer sounds the alarm when it receives a digital signal from the Pi. The buzzer you’ll use, shown in <a href="ch11.xhtml#ch11fig2">Figure 11-2</a>, is about as simple as it comes.</p>
<div class="image"><a id="ch11fig2"/><img src="../images/f0148-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 11-2:</strong> Piezo buzzer</p>
<p class="indent">The buzzer’s case contains a disc that vibrates at a certain frequency when voltage is sent to it. Wiring the piezo buzzer is simple. All you need to do is connect one wire to your Pi’s GND pin and another to a GPIO pin.</p>
<h3 class="h3" id="lev118"><span class="violet"><strong>WIRING THE CIRCUIT</strong></span></h3>
<p class="noindent">To build the smoke and gas detector alarm circuit, you need to connect an LED and a pushbutton to the Pi; you should already know how to wire these from previous projects. You also need to connect the piezo buzzer and the MQ-2 sensor to the Pi—the latter will connect through the MCP3008 chip). Follow these instructions, using <a href="ch11.xhtml#ch11fig3">Figure 11-3</a> as a reference.</p>
<div class="image"><a id="ch11fig3"/><img src="../images/f0148-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 11-3:</strong> Smoke and gas detector circuit diagram</p>
<ol>
<li class="noindent"><p class="list"><span epub:type="pagebreak" id="page_149"/>Connect GND to the blue breadboard rail and 3.3 V to the red rail.</p></li>
<li class="noindent"><p class="list">Place the MCP3008 chip in the middle of the breadboard so that the legs run parallel on either side of the center divide, as shown in <a href="ch11.xhtml#ch11fig3">Figure 11-3</a>, and wire it according to the following table.</p>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_th-l"><p class="tab_th"><strong>MCP3008</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>CONNECT TO</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">1</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="violet">MQ-2 AO pin</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">9</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="violet">GND</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">10</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="violet">GPIO 8</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">11</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="violet">GPIO 10</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">12</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="violet">GPIO 9</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">13</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="violet">GPIO 11</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">14</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="violet">GND</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">15</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="violet">3.3 V</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">16</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="violet">3.3 V</span></p></td>
</tr>
</tbody>
</table>
<p class="indentv">Remember that when the half-circle on the MCP3008 is at the top, pin 1 is the top pin on the left side; see <a href="ch03.xhtml#lev41">“Analog-to-Digital Converters”</a> on <a href="ch03.xhtml#page_55">page 55</a> for a complete MCP3008 pinout.</p></li>
<li class="noindent"><p class="list">Place the MQ-2 gas and smoke sensor in the breadboard and wire it as indicated.</p>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_th-l"><p class="tab_th"><strong>MQ-2 SENSOR</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>CONNECT TO</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">VCC</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="violet">5 V</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">GND</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="violet">GND</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">DO</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="violet">No connection</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">AO</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="violet">MCP3008 pin 1</span></p></td>
</tr>
</tbody>
</table></li>
<li class="noindent"><p class="list">Insert an LED into the breadboard. Connect the positive lead to GPIO 17 through a 330 Ω resistor and connect the negative lead to the GND rail.</p></li>
<li class="noindent"><p class="list">Insert the pushbutton in the middle of the breadboard, with two leads on either side of the center divide. Connect the bottom-right lead to GND power rail and the bottom-left lead to GPIO 2, making sure both connected leads are on the same side of the divide.</p></li>
<li class="noindent"><p class="list">Insert the buzzer into the breadboard and connect the black wire to GND and the red wire to GPIO 27.</p></li>
</ol>
<p class="indent"><span epub:type="pagebreak" id="page_150"/>With your circuit wired up, it’s time to upload some code.</p>
<h3 class="h3" id="lev119"><span class="violet"><strong>WRITING THE SCRIPT</strong></span></h3>
<p class="noindent">Open <strong>Python 3 (IDLE)</strong> and go to <strong>File</strong> <span class="ent">▸</span> <strong>New File</strong> to create a new script. Copy the code in <a href="ch11.xhtml#ch11list1">Listing 11-1</a> to the Python Editor and save the script as <em>smoke_detector.py</em> inside the <em>Sensors</em> folder. (remember that you can download all the scripts at <em><a href="https://www.nostarch.com/RaspberryPiProject/">https://www.nostarch.com/RaspberryPiProject/</a></em>):</p>
<p class="listing" id="ch11list1"><strong>LISTING 11-1:</strong> The smoke and gas detector script</p>
<div class="box">
<p class="programs">  <span class="red1">#import necessary libraries</span><br/><span class="ent">➊</span> <span class="orange">from</span> gpiozero <span class="orange">import</span> LED, Button, Buzzer, MCP3008<br/>  <span class="orange">from</span> time <span class="orange">import</span> sleep<br/><br/><span class="ent">➋</span> led = LED(17)<br/>  button = Button(2)<br/>  buzzer = Buzzer(27)<br/>  gas_sensor = MCP3008(0)<br/><br/><span class="ent">➌</span> gas_sensor_status = <span class="orange">False</span><br/><br/><span class="ent">➍</span> threshold = 0.1<br/><br/><span class="ent">➎</span> <span class="orange">def</span> <span class="blue">arm_gas_sensor</span>():<br/>      <span class="orange">global</span> gas_sensor_status<br/>      <span class="orange">if</span> gas_sensor_status == <span class="orange">True</span>:<br/>          gas_sensor_status = <span class="orange">False</span><br/>          led.off()<br/>      <span class="orange">else</span>:<br/>          gas_sensor_status = <span class="orange">True</span><br/>          led.on()<br/><span class="ent">➏</span> button.when_pressed = arm_gas_sensor<br/><br/><span class="ent">➐</span> <span class="orange">while True</span>:<br/><span class="ent">➑</span>     <span class="red1">#print(gas_sensor.value)</span><br/>      <span class="red1">#check if the gas sensor is armed and</span><br/>      <span class="red1">#reached the threshold value</span><br/>      <span class="orange">if</span>(gas_sensor_status == <span class="orange">True</span> <span class="orange">and</span> gas_sensor.value &gt; threshold):<br/>          buzzer.beep()<br/>      <span class="orange">else</span>:<br/>          buzzer.off()<br/>      sleep(2)</p>
</div>
<p class="indent">First, you import the <span class="literal">LED</span>, <span class="literal">Button</span>, <span class="literal">Buzzer</span>, and <span class="literal">MCP3008</span> classes from the gpiozero library and the <span class="literal">sleep</span> function from the time library <span class="ent">➊</span>; then, you create <span class="literal">gpiozero</span> objects to refer to the LED, button, MCP3008 (MQ-2 gas sensor), and buzzer <span class="ent">➋</span>. Next, you create a <span class="literal">gas_sensor_status</span> variable that will indicate whether the smoke sensor is armed <span class="ent">➌</span>; the sensor is armed if this variable <span epub:type="pagebreak" id="page_151"/>is <span class="literal">True</span> and not armed if it’s <span class="literal">False</span>. You need to set a <span class="literal">threshold</span> value so that the buzzer beeps only when the gas levels are above this threshold <span class="ent">➍</span>. We’ll cover finding out your threshold value in a moment.</p>
<p class="indent">The <span class="literal">arm_gas_sensor()</span> function <span class="ent">➎</span> arms and disarms the sensor by switching the value in the <span class="literal">gas_sensor_status</span> variable to the opposite of whatever it currently holds, whether that’s <span class="literal">True</span> or <span class="literal">False</span>, when the function is called. At <span class="ent">➏</span>, you set the function to call when the pushbutton is pressed so that you can arm and disarm the sensor manually. You also set an LED to turn on when the sensor is armed; that way, you can visually identify its status.</p>
<p class="indent">The final block of code is a <span class="literal">while</span> loop <span class="ent">➐</span> that continuously checks whether the sensor is armed and whether the gas levels are above the threshold. If the sensor is armed and the gas levels are above the threshold value, the buzzer beeps via the <span class="literal">buzzer.beep()</span> function. The final <span class="literal">buzzer.off()</span> function stops the buzzer.</p>
<h4 class="h4" id="lev120"><span class="violet"><strong>Setting the Threshold Value</strong></span></h4>
<p class="noindent">To accurately set a safe gas-level threshold, you first need to calibrate your sensor to your environment. That means you need to measure your gas levels when there is no gas present, and then set your threshold to a value slightly above that. First, find out what the gas levels of your environment usually are:</p>
<ol>
<li class="noindent"><p class="list">Uncomment the line at <span class="ent">➑</span>, and then save and run the script.</p></li>
<li class="noindent"><p class="list">You should see the <span class="literal">gas_sensor</span> values displayed on the Python shell. Those are the values read when there’s no gas or smoke in the sensor’s range. Your <span class="literal">threshold</span> value should be slightly higher than this. For example, if your default value is <span class="literal">0.07</span>, we recommend setting your threshold to <span class="literal">0.1</span>, but it depends on your desired sensitivity level.</p></li>
<li class="noindent"><p class="list">Grab a lighter and press the trigger (without igniting the lighter). Hold the lighter next to the sensor to release some gas. The <span class="literal">gas_sensor</span> value displayed on the Python shell should increase. Your <span class="literal">threshold</span> value should be lower than the maximum value you got when exposing the sensor to gas.</p>
<div class="note">
<p class="notet"><span class="red"><strong>WARNING</strong></span></p>
<p class="notep"><em>Always be careful when using lighters and gas; don’t hold the gas trigger down for too long, and do not ignite the lighter when gas has been released into the air.</em></p>
</div></li>
<li class="noindent"><p class="list">With the values obtained from the last two steps, tune the <span class="literal">threshold</span> value <span class="ent">➍</span> somewhere between these two so that it’s neither too sensitive nor too unresponsive.</p></li>
<li class="noindent"><p class="list">Comment out the <span class="literal">print</span> statement <span class="ent">➑</span> and save the script.</p></li>
</ol>
<h4 class="h4" id="lev121"><span epub:type="pagebreak" id="page_152"/><span class="violet"><strong>Running the Script</strong></span></h4>
<p class="noindent">Press <strong>F5</strong> or go to <strong>Run</strong> <span class="ent">▸</span> <strong>Run Module</strong> to run the script. Press the pushbutton to arm the sensor. The red LED should light up. Then test it out by using a lighter to release some gas next to the sensor until the buzzer beeps.</p>
<div class="note">
<p class="notet"><span class="red"><strong>WARNING</strong></span></p>
<p class="notep"><em>This gas and smoke alarm should not be used to replace an off-the-shelf smoke detector.</em></p>
</div>
<p class="indent">Congratulations! You now have a gas and smoke detector alarm to monitor your house and warn you of fire!</p>
<h3 class="h3" id="lev122"><span class="violet"><strong>TAKING IT FURTHER</strong></span></h3>
<p class="noindent">The aim of this project was to show you how to read sensors that output analog signals. Now you can add features to this project. For example, you can edit the script to send an email when gas or smoke is above the threshold value, as we did in <a href="ch10.xhtml#ch10">Project 10</a>.</p>
</div>
  </body>
</html>
