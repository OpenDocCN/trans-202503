<html><head></head><body>
		<section>&#13;
			<header>&#13;
				<h1 class="chapter"><span class="ChapterNumber"><span epub:type="pagebreak" id="Page_315" title="315"/>17</span><br/><span class="ChapterTitle">Infrared Remote Control</span></h1>&#13;
			</header>&#13;
			<p class="ChapterIntro">In this chapter you will</p>&#13;
			<ul>&#13;
				<li>Create and test a simple infrared receiver</li>&#13;
				<li>Remotely control Arduino digital output pins</li>&#13;
				<li>&#13;
					Add a remote control system to the robot vehicle we created in <span class="xref" itemid="xref_target_Chapter 14">Chapter 14</span></li>&#13;
			</ul>&#13;
			<p>As you’ll see, with the addition of an inexpensive receiver module, your Arduino can receive the signals from an infrared remote and act upon them.</p>&#13;
			<h2 id="h1-500587c17-0001">What Is Infrared?</h2>&#13;
			<p class="BodyFirst">Many people use infrared remote controls in a variety of daily actions, and most don’t know how they work. Infrared (IR) signals are beams of light at a wavelength that cannot be seen by the naked eye. So when you look at the little LED poking out of a remote control and press a button, you won’t see the LED light up.</p>&#13;
			<p><span epub:type="pagebreak" id="Page_316" title="316"/>That’s because IR remote controls contain one or more special infrared light–generating LEDs that transmit the IR signals. When you press a button on the remote, the LED turns on and off repeatedly in a pattern that is unique for each button pressed. This signal is received by a special IR receiver on the device being controlled and converted to pulses of electrical current that are read as data by the receiver’s electronics. If you are curious about these patterns, you can view them by looking at the IR LED on a remote through the viewfinder of a phone camera or digital camera.</p>&#13;
			<h2 id="h1-500587c17-0002">Setting Up for Infrared</h2>&#13;
			<p class="BodyFirst">Before moving forward, we need to install the Arduino IRremote library, so visit <a class="LinkURL" href="https://github.com/z3t0/Arduino-IRremote/archive/master.zip">https://github.com/z3t0/Arduino-IRremote/archive/master.zip</a><em> </em>to download the required files and install them using the method described in <span class="xref" itemid="xref_target_Chapter 7">Chapter 7</span>.</p>&#13;
			<h3 id="h2-500587c17-0001">The IR Receiver</h3>&#13;
			<p class="BodyFirst">The next step is to set up the IR receiver and test that it is working. You can choose either an independent IR receiver (shown in <a href="#figure17-1" id="figureanchor17-1">Figure 17-1</a>) or a prewired module (shown in <a href="#figure17-2" id="figureanchor17-2">Figure 17-2</a>), whichever is easier for you.</p>&#13;
			<figure>&#13;
				<img alt="f17001" src="image_fi/500587c17/f17001.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure17-1">Figure 17-1</a>: An IR receiver</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<figure>&#13;
				<img alt="f17002" src="image_fi/500587c17/f17002.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure17-2">Figure 17-2</a>: A prewired IR receiver module</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>&#13;
				The independent IR receiver shown in <a href="#figure17-1">Figure 17-1</a> is a Vishay TSOP4138. The bottom leg of the receiver (as shown in the figure) connects to an Arduino digital pin, the center leg to GND, and the top leg to 5 V.</p>&#13;
			<p><a href="#figure17-2">Figure 17-2</a> shows a prewired IR module. Prewired receiver modules are available from PMD Way and other retailers. The benefit of using these modules is that they include connection wires and are labeled for easy reference.</p>&#13;
			<p>Regardless of your choice of module, in all of the following examples, you’ll connect D (the data line) to Arduino digital pin 2, VCC to 5 V, and GND to GND.</p>&#13;
			<h3 id="h2-500587c17-0002">The Remote Control</h3>&#13;
			<p class="BodyFirst">Finally, you will need a remote control. I’ve used a surplus Sony TV remote like the one shown in <a href="#figure17-3" id="figureanchor17-3">Figure 17-3</a>. If you don’t have access to a Sony remote, any inexpensive universal remote control can be used after you reset it to Sony codes. See the instructions included with your remote control to do this.</p>&#13;
			<span epub:type="pagebreak" id="Page_317" title="317"/>&#13;
			<figure>&#13;
				<img alt="f17003" src="image_fi/500587c17/f17003.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure17-3">Figure 17-3</a>: A typical Sony remote control</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h3 id="h2-500587c17-0003">A Test Sketch</h3>&#13;
			<p class="BodyFirst">Now let’s make sure that everything works. After connecting your IR receiver to the Arduino, enter and upload the sketch in <a href="#listing17-1" id="listinganchor17-1">Listing 17-1</a>.</p>&#13;
			<pre><code>// Listing 17-1<span aria-label="annotation1" class="CodeAnnotationHang">1</span> #include &lt;IRremote.h&gt;       // use the library <span aria-label="annotation2" class="CodeAnnotationHang">2</span> IRrecv irrecv(receiverpin); // create instance of irrecv<span aria-label="annotation3" class="CodeAnnotationHang">3</span> decode_results results; &#13;
int receiverpin = 2;        // pin 1 of IR receiver to Arduino digital pin 2&#13;
void setup()&#13;
{ Serial.begin(9600);  irrecv.enableIRIn();      // start the IR receiver&#13;
}&#13;
void loop() &#13;
{<span aria-label="annotation4" class="CodeAnnotationHang">4</span>   if (irrecv.decode(&amp;results))        // have we received an IR signal? { <span aria-label="annotation5" class="CodeAnnotationHang">5</span>     Serial.print(results.value, HEX); // display IR code in the Serial Monitor Serial.print(" "); irrecv.resume();                  // receive the next value }&#13;
}</code></pre>&#13;
			<p class="CodeListingCaption"><a id="listing17-1">Listing 17-1</a>: IR receiver test</p>&#13;
			<p>&#13;
				This sketch is relatively simple, because most of the work is done in the background by the IR library. At <span aria-label="annotation4" class="CodeAnnotation">4</span>, we check whether a signal has been received from the remote control. If so, it is displayed in the Serial Monitor in hexadecimal at <span aria-label="annotation5" class="CodeAnnotation">5</span>. The lines at <span aria-label="annotation1" class="CodeAnnotation">1</span>, <span aria-label="annotation2" class="CodeAnnotation">2</span>, and <span aria-label="annotation3" class="CodeAnnotation">3</span> activate the IR library and create an instance of the infrared library function to refer to in the rest of the sketch.</p>&#13;
			<h3 id="h2-500587c17-0004">Testing the Setup</h3>&#13;
			<p class="BodyFirst">Once you’ve uploaded the sketch, open the Serial Monitor, aim the remote at the receiver, and start pressing buttons. You should see codes <span epub:type="pagebreak" id="Page_318" title="318"/>for the buttons displayed in the Serial Monitor after each button press. For example, <a href="#figure17-4" id="figureanchor17-4">Figure 17-4</a> shows the results of pressing 1, 2, and 3, once each.</p>&#13;
			<figure>&#13;
				<img alt="f17004" src="image_fi/500587c17/f17004.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure17-4">Figure 17-4</a>: Results of pressing buttons after running the code in <a href="#listing17-1">Listing 17-1</a></p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p><a href="#table17-1" id="tableanchor17-1">Table 17-1</a> lists the codes from a basic Sony remote control that we’ll use in upcoming sketches. However, when running <a href="#listing17-1">Listing 17-1</a>, notice that each code number repeats three times. This is an idiosyncrasy of Sony IR systems, which send the code three times for each button press. You can ignore these repeats with some clever coding, but for now, let’s skip to remote controlling with the next project.</p>&#13;
			<figure>&#13;
				<figcaption class="TableTitle">&#13;
					<p><a id="table17-1">Table 17-1</a>: Example Sony IR codes</p>&#13;
				</figcaption>&#13;
				<table border="1" id="table-500587c17-0001">&#13;
					<thead>&#13;
						<tr>&#13;
							<td><b>Button</b></td>&#13;
							<td><b>Code</b></td>&#13;
							<td><b>Button</b></td>&#13;
							<td><b>Code</b></td>&#13;
						</tr>&#13;
					</thead>&#13;
					<tbody>&#13;
						<tr>&#13;
							<td>Power</td>&#13;
							<td>A90</td>&#13;
							<td>7</td>&#13;
							<td>610</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>Mute</td>&#13;
							<td>290</td>&#13;
							<td>8</td>&#13;
							<td>E10</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>1</td>&#13;
							<td>10</td>&#13;
							<td>9</td>&#13;
							<td>110</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>2</td>&#13;
							<td>810</td>&#13;
							<td>0</td>&#13;
							<td>910</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>3</td>&#13;
							<td>410</td>&#13;
							<td>Volume up</td>&#13;
							<td>490</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>4</td>&#13;
							<td>C10</td>&#13;
							<td>Volume down</td>&#13;
							<td>C90</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>5</td>&#13;
							<td>210</td>&#13;
							<td>Channel up</td>&#13;
							<td>90</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>6</td>&#13;
							<td>A10</td>&#13;
							<td>Channel down</td>&#13;
							<td>890</td>&#13;
						</tr>&#13;
					</tbody>&#13;
				</table>&#13;
			</figure>&#13;
			<h2 class="HeadProject" id="h1-500587c17-0003"><span>Project #50: Creating an IR Remote Control Arduino</span></h2>&#13;
			<p class="BodyFirst">This project will demonstrate how to control digital output pins using an IR remote control. You’ll control digital pins 3 through 7 with the matching numerical buttons 3 through 7 on a Sony remote control. When you press a button on the remote control, the matching digital output pin will change state to <code>HIGH</code> for 1 second and then return to <code>LOW</code>. You’ll be able to use this project as a base or guide to add remote control capabilities to your other projects.</p>&#13;
			<h3 id="h2-500587c17-0005"><span epub:type="pagebreak" id="Page_319" title="319"/>The Hardware</h3>&#13;
			<p class="BodyFirst">The following hardware is required for this project:</p>&#13;
			<ul>&#13;
				<li>Arduino and USB cable</li>&#13;
				<li>Five LEDs</li>&#13;
				<li>Five 560 Ω resistors</li>&#13;
				<li>Infrared receiver or module</li>&#13;
				<li>Solderless breadboard</li>&#13;
				<li>Various jumper wires</li>&#13;
			</ul>&#13;
			<h3 id="h2-500587c17-0006">The Schematic</h3>&#13;
			<p class="BodyFirst">The circuit consists of the infrared receiver with the output connected to digital pin 2 and five LEDs with current-limiting resistors connected to digital pins 3 to 7 inclusive, as shown in <a href="#figure17-5" id="figureanchor17-5">Figure 17-5</a>.</p>&#13;
			<figure>&#13;
				<img alt="f17005" src="image_fi/500587c17/f17005.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure17-5">Figure 17-5</a>: Schematic for Project 50</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h3 id="h2-500587c17-0007"><span epub:type="pagebreak" id="Page_320" title="320"/>The Sketch</h3>&#13;
			<p class="BodyFirst">Enter and upload the following sketch:</p>&#13;
			<pre><code>// Project 50 – Creating an IR Remote Control Arduino&#13;
#include &lt;IRremote.h&gt; &#13;
IRrecv irrecv(receiverpin); // create instance of irrecv&#13;
decode_results results;&#13;
int receiverpin = 2;        // pin 1 of IR receiver to Arduino digital pin 2&#13;
void setup()&#13;
{ irrecv.enableIRIn();      // start the receiver for (int z = 3 ; z &lt; 8 ; z++) // set up digital pins  { pinMode(z, OUTPUT); }&#13;
}<span aria-label="annotation1" class="CodeAnnotationHang">1</span> void translateIR() &#13;
// takes action based on IR code received&#13;
// uses Sony IR codes&#13;
{ switch(results.value) {<span aria-label="annotation2" class="CodeAnnotationHang">2</span>     case 0x410:  pinOn(3); break; // 3 case 0xC10:  pinOn(4); break; // 4 case 0x210:  pinOn(5); break; // 5 case 0xA10:  pinOn(6); break; // 6 case 0x610:  pinOn(7); break; // 7 }&#13;
}<span aria-label="annotation3" class="CodeAnnotationHang">3</span> void pinOn(int pin) // turns on digital pin "pin" for 1 second&#13;
{ digitalWrite(pin, HIGH); delay(1000); digitalWrite(pin, LOW);&#13;
}&#13;
void loop() &#13;
{<span aria-label="annotation4" class="CodeAnnotationHang">4</span>   if (irrecv.decode(&amp;results))    // have we received an IR signal? { translateIR();<span aria-label="annotation5" class="CodeAnnotationHang">5</span>     for (int z = 0 ; z &lt; 2 ; z++) // ignore the 2nd and 3rd repeated codes { irrecv.resume();            // receive the next value } }&#13;
}</code></pre>&#13;
			<p><span epub:type="pagebreak" id="Page_321" title="321"/>This sketch has three major parts. First, it waits for a signal from the remote at <span aria-label="annotation4" class="CodeAnnotation">4</span>. When a signal is received, the signal is tested in the function <code>translateIR()</code> at <span aria-label="annotation1" class="CodeAnnotation">1</span> to determine which button was pressed and what action to take.</p>&#13;
			<p>&#13;
				Notice at <span aria-label="annotation2" class="CodeAnnotation">2</span> that we compare the hexadecimal codes returned by the IR library. These are the codes returned by the test conducted in <a href="#listing17-1">Listing 17-1</a>. When the codes for buttons 3 through 7 are received, the function <code>pinOn()</code> at <span aria-label="annotation3" class="CodeAnnotation">3</span> is called, which turns on the matching digital pin for 1 second.</p>&#13;
			<p>&#13;
				As mentioned, Sony remotes send the code three times for each button press, so we use a small loop at <span aria-label="annotation5" class="CodeAnnotation">5</span> to ignore the second and third codes. Finally, note the addition of <code>0x</code> in front of the hexadecimal numbers used in the <code>case</code> statements at <span aria-label="annotation2" class="CodeAnnotation">2</span>.</p>&#13;
			<aside epub:type="sidebar">&#13;
				<div class="top hr">&#13;
					<hr/>&#13;
				</div>&#13;
				<section class="note">&#13;
					<h2><span class="NoteHead">NOTE</span></h2>&#13;
					<p>&#13;
							Hexadecimal numbers are base 16 and use the digits 0 through 9 and then A through F, before moving on to the next column. For example, decimal 10 in hexadecimal is A, decimal 15 in hexadecimal is F, decimal 16 is 10 in hexadecimal, and so on. When using a hexadecimal number in a sketch, preface it with <code>0x</code>.</p>&#13;
					<div class="bottom hr">&#13;
						<hr/>&#13;
					</div>&#13;
				</section>&#13;
			</aside>&#13;
			<h3 id="h2-500587c17-0008">Modifying the Sketch</h3>&#13;
			<p class="BodyFirst">You can expand the options or controls available for controlling your receiving device by testing more buttons. To do so, use <a href="#listing17-1">Listing 17-1</a> to determine which button creates which code and then add each new code to the <code>switch case</code> statement.</p>&#13;
			<h2 class="HeadProject" id="h1-500587c17-0004"><span>Project #51: Creating an IR Remote Control Robot Vehicle</span></h2>&#13;
			<p class="BodyFirst">To show you how to integrate an IR remote control into an existing project, we’ll add IR to the robot described in Project 39 in <span class="xref" itemid="xref_target_Chapter 14">Chapter 14</span>. In this project, instead of presetting the robot’s direction and distances, the sketch will show you how to control these actions with a simple Sony TV remote.</p>&#13;
			<h3 id="h2-500587c17-0009">The Hardware</h3>&#13;
			<p class="BodyFirst">The required hardware is the same as that required for the robot you built for Project 39, with the addition of the IR receiver module described earlier in this chapter. In the following sketch, the robot will respond to the buttons that you press on the remote control as follows: press 2 for forward, 8 for backward, 4 for rotate left, and 6 for rotate right.</p>&#13;
			<h3 id="h2-500587c17-0010">The Sketch</h3>&#13;
			<p class="BodyFirst">After reassembling your vehicle and adding the IR receiver, enter and upload the following sketch:</p>&#13;
			<pre><code>// Project 51 - Creating an IR Remote Control Robot Vehicle&#13;
int receiverpin = 2; // pin 1 of IR receiver to Arduino digital pin 11&#13;
#include &lt;IRremote.h&gt;&#13;
IRrecv irrecv(receiverpin); // create instance of irrecv<span epub:type="pagebreak" id="Page_322" title="322"/>decode_results results;&#13;
#include &lt;AFMotor.h&gt;&#13;
AF_DCMotor motor1(1); // set up instances of each motor&#13;
AF_DCMotor motor2(2);&#13;
AF_DCMotor motor3(3);&#13;
AF_DCMotor motor4(4);&#13;
void goForward(int speed, int duration)&#13;
{ motor1.setSpeed(speed); motor2.setSpeed(speed); motor3.setSpeed(speed); motor4.setSpeed(speed); motor1.run(FORWARD); motor2.run(FORWARD); motor3.run(FORWARD); motor4.run(FORWARD); delay(duration); motor1.run(RELEASE); motor2.run(RELEASE); motor3.run(RELEASE); motor4.run(RELEASE);&#13;
}&#13;
void goBackward(int speed, int duration)&#13;
{ motor1.setSpeed(speed); motor2.setSpeed(speed); motor3.setSpeed(speed); motor4.setSpeed(speed); motor1.run(BACKWARD); motor2.run(BACKWARD); motor3.run(BACKWARD); motor4.run(BACKWARD); delay(duration); motor1.run(RELEASE); motor2.run(RELEASE); motor3.run(RELEASE); motor4.run(RELEASE);&#13;
}&#13;
void rotateLeft(int speed, int duration)&#13;
{ motor1.setSpeed(speed); motor2.setSpeed(speed); motor3.setSpeed(speed); motor4.setSpeed(speed); motor1.run(FORWARD); motor2.run(BACKWARD); motor3.run(BACKWARD); motor4.run(FORWARD); delay(duration); motor1.run(RELEASE);<span epub:type="pagebreak" id="Page_323" title="323"/>  motor2.run(RELEASE); motor3.run(RELEASE); motor4.run(RELEASE);&#13;
}&#13;
void rotateRight(int speed, int duration)&#13;
{ motor1.setSpeed(speed); motor2.setSpeed(speed); motor3.setSpeed(speed); motor4.setSpeed(speed); motor1.run(BACKWARD); motor2.run(FORWARD); motor3.run(FORWARD); motor4.run(BACKWARD); delay(duration); motor1.run(RELEASE); motor2.run(RELEASE); motor3.run(RELEASE); motor4.run(RELEASE);&#13;
}&#13;
// translateIR takes action based on IR code received, uses Sony IR codes&#13;
void translateIR()&#13;
{ switch (results.value) { case 0x810: goForward(255, 250); break; // 2 case 0xC10: rotateLeft(255, 250); break; // 4 case 0xA10: rotateRight(255, 250); break; // 6 case 0xE10: goBackward(255, 250); break; // 8 }&#13;
}&#13;
void setup()&#13;
{ delay(5000); irrecv.enableIRIn();         // start IR receiver&#13;
}&#13;
void loop()&#13;
{ if (irrecv.decode(&amp;results)) // have we received an IR signal? { translateIR();<span epub:type="pagebreak" id="Page_324" title="324"/>    for (int z = 0 ; z &lt; 2 ; z++) // ignore the repeated codes { irrecv.resume();            // receive the next value } }&#13;
}</code></pre>&#13;
			<p>&#13;
				This sketch should look somewhat familiar to you. Basically, instead of lighting up LEDs on digital pins, it calls the motor control functions that were used in the robot vehicle from <span class="xref" itemid="xref_target_Chapter 14">Chapter 14</span>.</p>&#13;
			<h2 id="h1-500587c17-0005">Looking Ahead</h2>&#13;
			<p class="BodyFirst">Having worked through the projects in this chapter, you should understand how to send commands to your Arduino via an infrared remote control device. Using these skills and your knowledge from previous chapters, you now can replace physical forms of input such as buttons with a remote control.</p>&#13;
			<p>But the fun doesn’t stop here. In the next chapter, we’ll use an Arduino to harness something that, to the untrained eye, is fascinating and futuristic: radio frequency identification systems.</p>&#13;
		</section>&#13;
	</body></html>