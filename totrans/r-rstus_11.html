<html><head></head><body>
<div id="sbo-rt-content" class="calibre1"><section aria-labelledby="ch9" epub:type="chapter" role="doc-chapter">
<hgroup>
<h2 class="title" id="ch9">
<span class="tpt"><span aria-label=" Page 137. " epub:type="pagebreak" id="pg_137" role="doc-pagebreak" class="calibre2"/><span class="sans_dogma_ot_bold_b_">9</span></span>
<span class="ct"><span class="sans_dogma_ot_bold_b_">WEBSITES</span></span>
</h2>
</hgroup>
<figure class="opener"><img alt="" class="opener1" height="407" src="../images/chapter.jpg" width="407"/>
</figure>
<p class="cos">During the summer of 2020, Matt Herman’s family moved from Brooklyn to Westchester County, New York. It was still early in the COVID-19 pandemic, and Herman was shocked that the county published little data about infection rates. Vaccines weren’t yet available, and daily choices like whether to go to the park depended on access to good data.</p>
<p class="tx">At the time, Herman was deputy director of the ChildStat Data Unit in the Office of Research and Analytics at the New York City Administration for Children’s Services. This mouthful of a title meant he was skilled at working with data, enabling him to create the COVID resource he needed: the Westchester COVID-19 Tracking website.</p>
<p class="tx">Built entirely in R, this website uses charts, maps, tables, and text to summarize the latest COVID data for Westchester County. The website is no longer updated daily, but you can still view it at <i class="calibre4"><a href="https://westchester-covid.mattherman.info" class="calibre3">https://westchester-covid.mattherman.info</a></i>.</p>
<p class="tx"><span aria-label=" Page 138. " epub:type="pagebreak" id="pg_138" role="doc-pagebreak"/>To make this website, Herman wrote a set of R Markdown files and strung them together with the <span class="sans_thesansmonocd_w5regular_">distill</span> package. This chapter explains the basics of the package by walking through the creation of a simple website. You’ll learn how to produce different page layouts, navigation menus, and interactive graphics, then explore strategies for hosting your website.</p>
<section aria-labelledby="sec1" epub:type="division">
<h3 class="h1" id="sec1"><span id="h1-51"/><span class="sans_dogma_ot_bold_b_1">Creating a New distill Project</span></h3>
<p class="tni">A website is merely a collection of HTML files like the one you produced in <span class="xref"><a href="chapter8.xhtml" class="calibre3">Chapter 8</a></span> when you created a slideshow presentation. The <span class="sans_thesansmonocd_w5regular_">distill</span> package uses multiple R Markdown documents to create several HTML files, then connects them with a navigation menu and more.</p>
<p class="tx">To create a <span class="sans_thesansmonocd_w5regular_">distill</span> website, install the package using <span class="sans_thesansmonocd_w7bold_b_">install.packages ("distill")</span>. Then start a project in RStudio by navigating to <b class="calibre9">File</b><span class="menuarrow"></span><b class="calibre9">New Project</b><span class="menuarrow"></span><b class="calibre9">New Directory</b> and selecting <b class="calibre9">Distill Website</b> as the project type.</p>
<p class="tx">Specify the directory and subdirectory where your project will live on your computer, then give your website a title. Check the Configure for GitHub Pages option, which provides an easy way to post your website online (you’ll learn how it works in <span class="xref">“GitHub Hosting” on <a href="#pg_154" class="calibre3">page 154</a>)</span>. Select it if you’d like to use this deployment option.</p>
</section>
<section aria-labelledby="sec2" epub:type="division">
<h3 class="h1" id="sec2"><span id="h1-52"/><span class="sans_dogma_ot_bold_b_1">The Project Files</span></h3>
<p class="tni">You should now have a project with several files. In addition to the <i class="calibre4">covid-website.Rproj</i> file indicating that you’re working in an RStudio project, you should have two R Markdown documents, a <i class="calibre4">_site.yml</i> file, and a <i class="calibre4">docs</i> folder, where the rendered HTML files will go. Let’s take a look at these website files.</p>
<section aria-labelledby="sec3" epub:type="division">
<h4 class="h2" id="sec3"><span id="h2-65"/><span class="sans_futura_std_heavy_oblique_bi_">R Markdown Documents</span></h4>
<p class="tni">Each R Markdown file represents a page of the website. By default, <span class="sans_thesansmonocd_w5regular_">distill</span> creates a home page (<i class="calibre4">index.Rmd</i>) and an About page (<i class="calibre4">about.Rmd</i>) containing placeholder content. If you wanted to generate additional pages, you would simply add new R Markdown files, then list them in the <i class="calibre4">_site.yml</i> file discussed in the next section.</p>
<p class="tx">If you open the <i class="calibre4">index.Rmd</i> file, you’ll notice that the YAML contains two arguments, <span class="sans_thesansmonocd_w5regular_">description</span> and <span class="sans_thesansmonocd_w5regular_">site</span>, that didn’t appear in the R Markdown documents from previous chapters:</p>
<pre id="pre-159" class="calibre10"><code class="calibre11">---
title: "COVID Website"
description: |
  Welcome to the website. I hope you enjoy it!
site: distill::distill_website
---
</code></pre>
<p class="tx"><span aria-label=" Page 139. " epub:type="pagebreak" id="pg_139" role="doc-pagebreak"/>The <span class="sans_thesansmonocd_w5regular_">description</span> argument specifies the text that should go below the title of each page, as shown in <a href="chapter9.xhtml#fig9-1" class="calibre3">Figure 9-1</a>.</p>
<figure class="img"><img alt="" class="img1" height="373" id="fig9-1" src="../images/fig9-1.jpg" width="1391"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 9-1: The default website description</span></p></figcaption>
</figure>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">site: distill::distill_website</span> line identifies the root page of a <span class="sans_thesansmonocd_w5regular_">distill</span> website. This means that when you knit the document, R Markdown knows to create a website rather than an individual HTML file and that the website should display this page first. The other pages of the website don’t require this line. As long as they’re listed in the <i class="calibre4">_site.yml</i> file, they’ll be added to the site.</p>
<p class="tx">You’ll also notice the absence of an argument you’ve seen in other R Markdown documents: <span class="sans_thesansmonocd_w5regular_">output</span>, which specifies the output format R should use while knitting. The reason <span class="sans_thesansmonocd_w5regular_">output</span> is missing here is that you’ll specify the output for the entire website in the <i class="calibre4">_site.yml</i> file.</p>
</section>
<section aria-labelledby="sec4" epub:type="division">
<h4 class="h2" id="sec4"><span id="h2-66"/><span class="sans_futura_std_heavy_oblique_bi_">The _site.yml File</span></h4>
<p class="tni">The <i class="calibre4">_site.yml</i> file tells R which R Markdown documents make up the website, what the knitted files should look like, what the website should be called, and more. When you open it, you should see the following code:</p>
<pre id="pre-160" class="calibre10"><code class="calibre11">name: "covid-website"
title: "COVID Website"
description: |
  COVID Website
output_dir: "docs"
navbar:
  right:
    - text: "Home"
      href: index.xhtml
    - text: "About"
      href: about.xhtml
output: distill::distill_article
</code></pre>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">name</span> argument determines the URL for your website. By default, this should be the name of the directory where your <span class="sans_thesansmonocd_w5regular_">distill</span> project lives; in my case, that’s the <i class="calibre4">covid-website</i> directory. The <span class="sans_thesansmonocd_w5regular_">title</span> argument creates the title for the entire website and shows up in the top left of the navigation bar by default. The <span class="sans_thesansmonocd_w5regular_">description</span> argument provides what’s known as a <i class="calibre4">meta description</i>, which will show up as a couple of lines in Google search results to give users an overview of the website content.</p>
<p class="tx"><span aria-label=" Page 140. " epub:type="pagebreak" id="pg_140" role="doc-pagebreak"/>The <span class="sans_thesansmonocd_w5regular_">output_dir</span> argument determines where the rendered HTML files live when you generate the website. You should see the <i class="calibre4">docs</i> directory listed here. However, you can change the output directory to any folder you choose.</p>
<p class="tx">Next, the <span class="sans_thesansmonocd_w5regular_">navbar</span> section defines the website’s navigation. Here it appears on the right side of the header, but swapping the <span class="sans_thesansmonocd_w5regular_">right</span> parameter for <span class="sans_thesansmonocd_w5regular_">left</span> would switch its position. The navigation bar includes links to the site’s two pages, Home and About, as shown in <a href="chapter9.xhtml#fig9-2" class="calibre3">Figure 9-2</a>.</p>
<figure class="img"><img alt="" class="img1" height="373" id="fig9-2" src="../images/fig9-2.jpg" width="1391"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 9-2: The website navigation bar</span></p></figcaption>
</figure>
<p class="tx">Within the <span class="sans_thesansmonocd_w5regular_">navbar</span> code, the <span class="sans_thesansmonocd_w5regular_">text</span> argument specifies what text shows up in the menu. (Try, for example, changing About to <b class="calibre9">About This Website</b>, and then change it back.) The <span class="sans_thesansmonocd_w5regular_">href</span> argument determines which HTML file the text in the navigation bar links to. If you want to include additional pages on your menu, you’ll need to add both the <span class="sans_thesansmonocd_w5regular_">text</span> and <span class="sans_thesansmonocd_w5regular_">href</span> parameters.</p>
<p class="tx">Finally, the <span class="sans_thesansmonocd_w5regular_">output</span> argument specifies that all R Markdown documents should be rendered using the <span class="sans_thesansmonocd_w5regular_">distill_article</span> format. This format allows for layouts of different widths, <i class="calibre4">asides</i> (parenthetical items that live in a sidebar next to the main content), easily customizable CSS, and more.</p>
</section>
</section>
<section aria-labelledby="sec5" epub:type="division">
<h3 class="h1" id="sec5"><span id="h1-53"/><span class="sans_dogma_ot_bold_b_1">Building the Site</span></h3>
<p class="tni">We’ve explored the project’s files but haven’t yet used them to create the website. To do this, click <b class="calibre9">Build Website</b> in the Build tab of RStudio’s top-right pane. (You could also run <span class="sans_thesansmonocd_w5regular_">rmarkdown::render_site()</span> in the console or in an R script file.)</p>
<p class="tx">This should render all R Markdown documents and add the top navigation bar to them with the options specified in the <i class="calibre4">_site.yml</i> file. To find the rendered files, look in <i class="calibre4">docs</i> (or whatever output directory you specified). Open the <i class="calibre4">index.xhtml</i> file and you’ll find your website, which should look like <a href="chapter9.xhtml#fig9-3" class="calibre3">Figure 9-3</a>.<span aria-label=" Page 141. " epub:type="pagebreak" id="pg_141" role="doc-pagebreak"/></p>
<figure class="img"><img alt="" class="img1" height="358" id="fig9-3" src="../images/fig9-3.jpg" width="1391"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 9-3: The COVID website with default content</span></p></figcaption>
</figure>
<p class="tx">You can open any other HTML file as well to see its rendered version.</p>
</section>
<section aria-labelledby="sec6" epub:type="division">
<h3 class="h1" id="sec6"><span id="h1-54"/><span class="sans_dogma_ot_bold_b_1">Applying Custom CSS</span></h3>
<p class="tni">Websites made with <span class="sans_thesansmonocd_w5regular_">distill</span> tend to look similar, but you can change their design using custom CSS. The <span class="sans_thesansmonocd_w5regular_">distill</span> package even provides a function to simplify this process. Run <span class="sans_thesansmonocd_w7bold_b_">distill::create_theme()</span> in the console to create a file called <i class="calibre4">theme.css</i>, shown here:</p>
<pre id="pre-161" class="calibre10"><code class="calibre11">/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */

html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

<span aria-label=" Page 142. " epub:type="pagebreak" id="pg_142" role="doc-pagebreak"/>/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</code></pre>
<p class="tx">Within this file is a set of CSS variables that allow you to customize the design of your website. Most of them have names that clearly show their purpose, and you can alter their default values to whatever you’d like. For example, the following edits to the site’s header make the title and text size larger and change the background color to a light blue:</p>
<pre id="pre-162" class="calibre10"><code class="calibre11">.distill-site-header {
  --title-size:       <b class="calibre9">28px;</b>
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        <b class="calibre9">20px;</b>
<span aria-label=" Page 143. " epub:type="pagebreak" id="pg_143" role="doc-pagebreak"/>  --hover-color:      white;
  --bkgd-color:       <b class="calibre9">#6cabdd;</b>
}
</code></pre>
<p class="tx">Before you can see these changes, however, you need to add a line to the <i class="calibre4">_site.yml</i> file to tell <span class="sans_thesansmonocd_w5regular_">distill</span> to use this custom CSS when rendering:</p>
<pre id="pre-163" class="calibre10"><code class="calibre11">name: "covid-website"
title: "COVID Website"
description: |
  COVID Website
<b class="calibre9">theme: theme.css</b>
output_dir: "docs"
navbar:
<var class="calibre14">--snip--</var>
</code></pre>
<p class="tx">Now you can generate the site again, and you should see your changes reflected.</p>
<p class="tx">There are a lot of other CSS variables in <i class="calibre4">theme.css</i> that you can change to tweak the appearance of your website. Playing around with them and regenerating your site is a great way to figure out what each one does.</p>
<blockquote class="calibre13">
<p class="note"><span class="sans_dogma_ot_bold_b_2">NOTE</span></p>
</blockquote>
<p class="note-txt"><i class="calibre4">To learn more about customizing the look and feel of your website, check out the <span class="sans_thesansmonocd_w5regular_italic_i_">distill</span> websites made by others at</i> <span class="copyright_accent"><a href="https://distillery.rbind.io" class="calibre3">https://distillery.rbind.io</a></span><i class="calibre4">.</i></p>
</section>
<section aria-labelledby="sec7" epub:type="division">
<h3 class="h1" id="sec7"><span id="h1-55"/><span class="sans_dogma_ot_bold_b_1">Working with Website Content</span></h3>
<p class="tni">You can add content to a page on your website by creating Markdown text and code chunks in the page’s R Markdown document. For example, to highlight rates of COVID cases over time, you’ll replace the contents of <i class="calibre4">index.Rmd</i> with code that displays a table, a map, and a chart on the website’s home page. Here’s the start of the file:</p>
<pre id="pre-164" class="calibre10"><code class="calibre11">---
title: "COVID Website"
description: "Information about COVID rates in the United States over time"
site: distill::distill_website
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE)
```

```{r}
# Load packages

library(tidyverse)
library(janitor)
<span aria-label=" Page 144. " epub:type="pagebreak" id="pg_144" role="doc-pagebreak"/>library(tigris)
library(gt)
library(lubridate)
```
</code></pre>
<p class="tx">After the YAML and <span class="sans_thesansmonocd_w5regular_">setup</span> code chunk, this code loads several packages, most of which you’ve seen in previous chapters: the <span class="sans_thesansmonocd_w5regular_">tidyverse</span> for data import, manipulation, and plotting (with ggplot); <span class="sans_thesansmonocd_w5regular_">janitor</span> for its <span class="sans_thesansmonocd_w5regular_">clean_names()</span> function, which makes the variable names easier to work with; <span class="sans_thesansmonocd_w5regular_">tigris</span> to import geospatial data about states; <span class="sans_thesansmonocd_w5regular_">gt</span> for making nice tables; and <span class="sans_thesansmonocd_w5regular_">lubridate</span> to work with dates.</p>
<p class="tx">Next, to import and clean the data, add this new code chunk:</p>
<pre id="pre-165" class="calibre10"><code class="calibre11">```{r}
# Import data

us_states &lt;- states(
  cb = TRUE,
  resolution = "20m",
  progress_bar = FALSE
) %&gt;%
  shift_geometry() %&gt;%
  clean_names() %&gt;%
  select(geoid, name) %&gt;%
  rename(state = name) %&gt;%
  filter(state %in% state.name)

covid_data &lt;- read_csv("https://raw.githubusercontent.com/nytimes/covid-19-data/master/rolling-averages/us-states.csv") %&gt;%
  filter(state %in% state.name) %&gt;%
  mutate(geoid = str_remove(geoid, "USA-"))

last_day &lt;- covid_data %&gt;%  <span aria-label="annotation1" class="code_codeannotation">❶</span>
  slice_max(
    order_by = date,
    n = 1
  ) %&gt;%
  distinct(date) %&gt;%
  mutate(date_nice_format = str_glue("{month(date, label = TRUE, abbr = FALSE)} {day(date)},   {year(date)}")) %&gt;%
  pull(date_nice_format)
```
# COVID Death Rates as of `r last_day` <span aria-label="annotation2" class="code_codeannotation">❷</span>
</code></pre>
<p class="tx">This code uses the <span class="sans_thesansmonocd_w5regular_">slice_max()</span> function to get the latest date in the <span class="sans_thesansmonocd_w5regular_">covid_data</span> data frame. (Data was added until March 23, 2023, so that date is the most recent one.) From there, it uses <span class="sans_thesansmonocd_w5regular_">distinct()</span> to get a single observation of the most recent date (each date shows up multiple times in the <span class="sans_thesansmonocd_w5regular_">covid_data</span> data frame). The code then creates a <span class="sans_thesansmonocd_w5regular_">date_nice_format</span> variable using the <span class="sans_thesansmonocd_w5regular_">str_glue()</span> function to combine easy-to-read versions of the month, day, and year. Finally, the <span class="sans_thesansmonocd_w5regular_">pull()</span> function turns the data frame into <span aria-label=" Page 145. " epub:type="pagebreak" id="pg_145" role="doc-pagebreak"/>a single variable called <span class="sans_thesansmonocd_w5regular_">last_day</span> <span aria-label="annotation1" class="codeannotation">❶</span>, which is referenced later in a text section. Using inline R code, this header now displays the current date <span aria-label="annotation2" class="codeannotation">❷</span>.</p>
<p class="tx">Include the following code to make a table showing the death rates per 100,000 people in four states (using all states would create too large a table):</p>
<pre id="pre-166" class="calibre10"><code class="calibre11">```{r}
covid_data %&gt;%
  filter(state %in% c(
    "Alabama",
    "Alaska",
    "Arizona",
    "Arkansas"
  )) %&gt;%
  slice_max(
    order_by = date,
    n = 1
  ) %&gt;%
  select(state, deaths_avg_per_100k) %&gt;%
  arrange(state) %&gt;%
  set_names("State", "Death rate") %&gt;%
  gt() %&gt;%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_column_labels()
  )
```
</code></pre>
<p class="tx">This table resembles the code you saw in <span class="xref"><a href="chapter5.xhtml" class="calibre3">Chapter 5</a></span>. First, the <span class="sans_thesansmonocd_w5regular_">filter()</span> function filters the data down to four states, and the <span class="sans_thesansmonocd_w5regular_">slice_max()</span> function gets the latest date. The code then selects the relevant variables (<span class="sans_thesansmonocd_w5regular_">state</span> and <span class="sans_thesansmonocd_w5regular_">deaths_avg_per_100k</span>), arranges the data in alphabetical order by state, sets the variable names, and pipes this output into a table made with the <span class="sans_thesansmonocd_w5regular_">gt</span> package.</p>
<p class="tx">Add the following code, which uses techniques covered in <span class="xref"><a href="chapter4.xhtml" class="calibre3">Chapter 4</a></span>, to make a map of this data for all states:</p>
<pre id="pre-167" class="calibre10"><code class="calibre11">We can see this same death rate data for all states on a map.

```{r}
most_recent &lt;- us_states %&gt;%
  left_join(covid_data, by = "state") %&gt;%
  slice_max(order_by = date,
            n = 1)

most_recent %&gt;%
  ggplot(aes(fill = deaths_avg_per_100k)) +
  geom_sf() +
  scale_fill_viridis_c(option = "rocket") +
  labs(fill = "Deaths per\n100,000 people") +
  theme_void()
```
</code></pre>
<p class="tx"><span aria-label=" Page 146. " epub:type="pagebreak" id="pg_146" role="doc-pagebreak"/>This code creates a <span class="sans_thesansmonocd_w5regular_">most_recent</span> data frame by joining the <span class="sans_thesansmonocd_w5regular_">us_states</span> geospatial data with the <span class="sans_thesansmonocd_w5regular_">covid_data</span> data frame before filtering to include only the most recent date. Then, it uses <span class="sans_thesansmonocd_w5regular_">most_recent</span> to create a map that shows deaths per 100,000 people.</p>
<p class="tx">Finally, to make a chart that shows COVID death rates over time in the four states from the table, add the following:</p>
<pre id="pre-168" class="calibre10"><code class="calibre11"># COVID Death Rates Over Time

The following chart shows COVID death rates from the start of COVID in early
2020 until `r last_day`.

```{r}
covid_data %&gt;%
  filter(state %in% c(
    "Alabama",
    "Alaska",
    "Arizona",
    "Arkansas"
  )) %&gt;%
  ggplot(aes(
    x = date,
    y = deaths_avg_per_100k,
    group = state,
    fill = deaths_avg_per_100k
  )) +
  geom_col() +
  scale_fill_viridis_c(option = "rocket") +
  theme_minimal() +
  labs(title = "Deaths per 100,000 people over time") +
  theme(
    legend.position = "none",
    plot.title.position = "plot",
    plot.title = element_text(face = "bold"),
    panel.grid.minor = element_blank(),
    axis.title = element_blank()
  ) +
  facet_wrap(
    ~state,
    nrow = 2
  )
```
</code></pre>
<p class="tx">Using the <span class="sans_thesansmonocd_w5regular_">geom_col()</span> function, this code creates a faceted set of bar charts that show change over time by state (faceting was discussed in <span class="xref"><a href="chapter2.xhtml" class="calibre3">Chapter 2</a></span>). Finally, it applies the <span class="sans_thesansmonocd_w5regular_">rocket</span> color palette, applies <span class="sans_thesansmonocd_w5regular_">theme_minimal()</span>, and makes a few tweaks to that theme. <a href="chapter9.xhtml#fig9-4" class="calibre3">Figure 9-4</a> shows what the website’s home page looks like three years after the start of the pandemic.<span aria-label=" Page 147. " epub:type="pagebreak" id="pg_147" role="doc-pagebreak"/></p>
<figure class="img"><img alt="" class="img1" height="2000" id="fig9-4" src="../images/fig9-4.jpg" width="1248"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 9-4: The COVID website with a table, map, and chart</span></p></figcaption>
</figure>
<p class="tx"><span aria-label=" Page 148. " epub:type="pagebreak" id="pg_148" role="doc-pagebreak"/>Now that you have some content in place, you can tweak it. For example, because many states are quite small, especially in the Northeast, it’s a bit challenging to see them. Let’s look at how to make the entire map bigger.</p>
<section aria-labelledby="sec8" epub:type="division">
<h4 class="h2" id="sec8"><span id="h2-67"/><span class="sans_futura_std_heavy_oblique_bi_">Applying distill Layouts</span></h4>
<p class="tni">One nice feature of <span class="sans_thesansmonocd_w5regular_">distill</span> is that it includes four layouts you can apply to a code chunk to widen its output: <span class="sans_thesansmonocd_w5regular_">l-body-outset</span> (creates output that is a bit wider than the default), <span class="sans_thesansmonocd_w5regular_">l-page</span> (creates output that is wider still), <span class="sans_thesansmonocd_w5regular_">l-screen</span> (creates full-screen output), and <span class="sans_thesansmonocd_w5regular_">l-screen-inset</span> (creates full-screen output with a bit of a buffer).</p>
<p class="tx">Apply <span class="sans_thesansmonocd_w5regular_">l-screen-inset</span> to the map by modifying the first line of its code chunk as follows:</p>
<pre id="pre-169" class="calibre10"><code class="calibre11">```{r <b class="calibre9">layout = "l-screen-inset"</b>}
</code></pre>
<p class="tx">This makes the map wider and taller and, as a result, much easier to read.</p>
</section>
<section aria-labelledby="sec9" epub:type="division">
<h4 class="h2" id="sec9"><span id="h2-68"/><span class="sans_futura_std_heavy_oblique_bi_">Making the Content Interactive</span></h4>
<p class="tni">The content you’ve added to the website so far is all static; it has none of the interactivity typically seen in websites, which often use JavaScript to respond to user behavior. If you’re not proficient with HTML and JavaScript, you can use R packages like <span class="sans_thesansmonocd_w5regular_">distill</span>, <span class="sans_thesansmonocd_w5regular_">plotly</span>, and <span class="sans_thesansmonocd_w5regular_">DT</span>, which wrap JavaScript libraries, to add interactive elements like the graphics and maps Matt Herman uses on his Westchester County COVID website. <a href="chapter9.xhtml#fig9-5" class="calibre3">Figure 9-5</a>, for example, shows a tooltip that allows the user to see results for any single day.</p>
<figure class="img"><img alt="" class="img1" height="535" id="fig9-5" src="../images/fig9-5.jpg" width="1332"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 9-5: An interactive tooltip showing new COVID cases by day</span></p></figcaption>
</figure>
<p class="tx"><span aria-label=" Page 149. " epub:type="pagebreak" id="pg_149" role="doc-pagebreak"/>Using the <span class="sans_thesansmonocd_w5regular_">DT</span> package, Herman also makes interactive tables that allow the user to scroll through the data and sort the values by clicking any variable in the header, as shown in <a href="chapter9.xhtml#fig9-6" class="calibre3">Figure 9-6</a>.</p>
<figure class="img"><img alt="" class="img1" height="441" id="fig9-6" src="../images/fig9-6.jpg" width="1391"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 9-6: An interactive table made with the DT package</span></p></figcaption>
</figure>
<p class="tx">Next, you’ll add some interactivity to your COVID website, beginning with your table.</p>
<section aria-labelledby="sec10" epub:type="division">
<h5 class="h3" id="sec10"><span class="sans_dogma_ot_bold_b_1">Adding Pagination to a Table with reactable</span></h5>
<p class="tni">Remember how you included only four states in the table to keep it from getting too long? By creating an interactive table, you can avoid this limitation. The <span class="sans_thesansmonocd_w5regular_">reactable</span> package is a great option for interactive tables. First, install it with <span class="sans_thesansmonocd_w7bold_b_">install.packages("reactable")</span>. Then, swap out the <span class="sans_thesansmonocd_w5regular_">gt</span> package code you used to make your static table with the <span class="sans_thesansmonocd_w5regular_">reactable()</span> function to show all states:</p>
<pre id="pre-170" class="calibre10"><code class="calibre11">library(reactable)

covid_data %&gt;%
  slice_max(
    order_by = date,
    n = 1
  ) %&gt;%
  select(state, deaths_avg_per_100k) %&gt;%
  arrange(state) %&gt;%
  set_names("State", "Death rate") %&gt;%
  reactable()
</code></pre>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">reactable</span> package shows 10 rows by default and adds pagination, as shown in <a href="chapter9.xhtml#fig9-7" class="calibre3">Figure 9-7</a>.<span aria-label=" Page 150. " epub:type="pagebreak" id="pg_150" role="doc-pagebreak"/></p>
<figure class="img"><img alt="" class="img2" height="774" id="fig9-7" src="../images/fig9-7.jpg" width="816"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 9-7: An interactive table built with reactable</span></p></figcaption>
</figure>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">reactable()</span> function also enables sorting by default. Although you used the <span class="sans_thesansmonocd_w5regular_">arrange()</span> function in your code to sort the data by state name, users can click the “Death rate” column to sort values using that variable instead.</p>
</section>
<section aria-labelledby="sec11" epub:type="division">
<h5 class="h3" id="sec11"><span class="sans_dogma_ot_bold_b_1">Creating a Hovering Tooltip with plotly</span></h5>
<p class="tni">Now you’ll add some interactivity to the website’s chart using the <span class="sans_thesansmonocd_w5regular_">plotly</span> package. First, install <span class="sans_thesansmonocd_w5regular_">plotly</span> with <span class="sans_thesansmonocd_w7bold_b_">install.packages("plotly")</span>. Then, create a plot with ggplot and save it as an object. Pass the object to the <span class="sans_thesansmonocd_w5regular_">ggplotly()</span> function, which turns it into an interactive plot, and run the following code to apply <span class="sans_thesansmonocd_w5regular_">plotly</span> to the chart of COVID death rates over time:</p>
<pre id="pre-171" class="calibre10"><code class="calibre11"><b class="calibre9">library(plotly)</b>

<b class="calibre9">covid_chart &lt;- covid_data %&gt;%</b>
  filter(state %in% c(
    "Alabama",
    "Alaska",
    "Arizona",
    "Arkansas"
  )) %&gt;%
  ggplot(aes(
    x = date,
    y = deaths_avg_per_100k,
    group = state,
    fill = deaths_avg_per_100k
  )) +
  geom_col() +
  scale_fill_viridis_c(option = "rocket") +
  theme_minimal() +
  labs(title = "Deaths per 100,000 people over time") +
<span aria-label=" Page 151. " epub:type="pagebreak" id="pg_151" role="doc-pagebreak"/>  theme(
    legend.position = "none",
    plot.title.position = "plot",
    plot.title = element_text(face = "bold"),
    panel.grid.minor = element_blank(),
    axis.title = element_blank()
  ) +
  facet_wrap(
    ~state,
    nrow = 2
  )

<b class="calibre9">ggplotly(covid_chart)</b>
</code></pre>
<p class="tx">This is identical to the chart code shown earlier in this chapter, except that now you’re saving your chart as an object called <span class="sans_thesansmonocd_w5regular_">covid_chart</span> and then running <span class="sans_thesansmonocd_w5regular_">ggplotly(covid_chart)</span>. This code produces an interactive chart that shows the data for a particular day when a user mouses over it. But the tooltip that pops up, shown in <a href="chapter9.xhtml#fig9-8" class="calibre3">Figure 9-8</a>, is cluttered and overwhelming because the <span class="sans_thesansmonocd_w5regular_">ggplotly()</span> function shows all data by default.</p>
<figure class="img"><img alt="" class="img1" height="738" id="fig9-8" src="../images/fig9-8.jpg" width="1266"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 9-8: The plotly default produces a messy tooltip.</span></p></figcaption>
</figure>
<p class="tx">To make the tooltip more informative, create a single variable containing the data you want to display and tell <span class="sans_thesansmonocd_w5regular_">ggplotly()</span> to use it:</p>
<pre id="pre-172" class="calibre10"><code class="calibre11">covid_chart &lt;- covid_data %&gt;%
  filter(state %in% c(
    "Alabama",
    "Alaska",
    "Arizona",
    "Arkansas"
  )) %&gt;%
  mutate(date_nice_format = str_glue("{month(date, label = TRUE, abbr = FALSE)} {day(date)},   {year(date)}")) %&gt;%  <span aria-label="annotation1" class="code_codeannotation">❶</span>
<span aria-label=" Page 152. " epub:type="pagebreak" id="pg_152" role="doc-pagebreak"/>  mutate(tooltip_text = str_glue("{state}&lt;br&gt;{date_nice_format}&lt;br&gt;{deaths_avg_per_100k}   per 100,000 people")) %&gt;%  <span aria-label="annotation2" class="code_codeannotation">❷</span>
  ggplot(aes(
    x = date,
    y = deaths_avg_per_100k,
    group = state,
    text = tooltip_text, <span aria-label="annotation3" class="code_codeannotation">❸</span>
    fill = deaths_avg_per_100k
  )) +
  geom_col() +
  scale_fill_viridis_c(option = "rocket") +
  theme_minimal() +
  labs(title = "Deaths per 100,000 people over time") +
  theme(
    legend.position = "none",
    plot.title.position = "plot",
    plot.title = element_text(face = "bold"),
    panel.grid.minor = element_blank(),
    axis.title = element_blank()
  ) +
  facet_wrap(
    ~state,
    nrow = 2
  )

ggplotly(
  covid_chart,
  tooltip = "tooltip_text" <span aria-label="annotation4" class="code_codeannotation">❹</span>
)
</code></pre>
<p class="tx">This code begins by creating a <span class="sans_thesansmonocd_w5regular_">date_nice_format</span> variable that produces dates in the more readable format January 1, 2023, instead of 2023-01-01 <span aria-label="annotation1" class="codeannotation">❶</span>. This value is then combined with the state and death rate variables, and the result is saved as <span class="sans_thesansmonocd_w5regular_">tooltip_text</span> <span aria-label="annotation2" class="codeannotation">❷</span>. Next, the code adds a new aesthetic property in the <span class="sans_thesansmonocd_w5regular_">ggplot()</span> function <span aria-label="annotation3" class="codeannotation">❸</span>. This property doesn’t do anything until it’s passed to <span class="sans_thesansmonocd_w5regular_">ggplotly()</span><span aria-label="annotation4" class="codeannotation">❹</span>.</p>
<p class="tx"><a href="chapter9.xhtml#fig9-9" class="calibre3">Figure 9-9</a> shows what the new tooltip looks like: it displays the name of the state, a nicely formatted date, and that day’s death rate.<span aria-label=" Page 153. " epub:type="pagebreak" id="pg_153" role="doc-pagebreak"/></p>
<figure class="img"><img alt="" class="img1" height="707" id="fig9-9" src="../images/fig9-9.jpg" width="1214"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 9-9: Easy-to-read interactive tooltips on the COVID-19 death rate chart</span></p></figcaption>
</figure>
<p class="tx">Adding interactivity is a great way to take advantage of the website medium. Users who might feel overwhelmed looking at the static chart can explore the interactive version, mousing over areas to see a summary of the results on any single day.</p>
</section>
</section>
</section>
<section aria-labelledby="sec12" epub:type="division">
<h3 class="h1" id="sec12"><span id="h1-56"/><span class="sans_dogma_ot_bold_b_1">Hosting the Website</span></h3>
<p class="tni">Now that you’ve made a website, you need a way to share it. There are various ways to do this, ranging from simple to quite complex. The easiest solution is to compress the files in your <i class="calibre4">docs</i> folder (or whatever folder you put your rendered website in) and email your ZIP file to your recipients. They can unzip it and open the HTML files in their browser. This works fine if you know you won’t want to make changes to your website’s data or styles. But, as <span class="xref"><a href="chapter5.xhtml" class="calibre3">Chapter 5</a></span> discussed, most projects aren’t really one-time events.</p>
<section aria-labelledby="sec13" epub:type="division">
<h4 class="h2" id="sec13"><span id="h2-69"/><span class="sans_futura_std_heavy_oblique_bi_">Cloud Hosting</span></h4>
<p class="tni">A better approach is to put your entire <i class="calibre4">docs</i> folder in a place where others can see it. This could be an internal network, Dropbox, Google Drive, Box, or something similar. Hosting the files in the cloud this way is simple to implement and allows you to control who can see your website.</p>
<p class="tx">You can even automate the process of copying your <i class="calibre4">docs</i> folder to various online file-sharing sites using R packages: the <span class="sans_thesansmonocd_w5regular_">rdrop2</span> package works with Dropbox, <span class="sans_thesansmonocd_w5regular_">googledrive</span> works with Google Drive, and <span class="sans_thesansmonocd_w5regular_">boxr</span> works with Box. For example, code like the following would automatically upload the project to Dropbox:</p>
<pre id="pre-173" class="calibre10"><code class="calibre11">library(tidyverse)
library(rmarkdown)
library(fs)
library(rdrop2)

<span aria-label=" Page 154. " epub:type="pagebreak" id="pg_154" role="doc-pagebreak"/># Render the website
render_site()

# Upload to Dropbox
website_files &lt;- dir_ls(
  path = "docs",
  type = "file",
  recurse = TRUE
)

walk(website_files, drop_upload, path = "COVID Website")
</code></pre>
<p class="tx">This code, which I typically add to a separate file called <i class="calibre4">render.R</i>, renders the site, uses the <span class="sans_thesansmonocd_w5regular_">dir_ls()</span> function from the <span class="sans_thesansmonocd_w5regular_">fs</span> package to identify all files in the <i class="calibre4">docs</i> directory, and then uploads these files to Dropbox. Now you can run your entire file to generate and upload your website in one go.</p>
</section>
<section aria-labelledby="sec14" epub:type="division">
<h4 class="h2" id="sec14"><span id="h2-70"/><span class="sans_futura_std_heavy_oblique_bi_">GitHub Hosting</span></h4>
<p class="tni">A more complicated yet powerful alternative to cloud hosting is to use a static hosting service like GitHub Pages. Each time you <i class="calibre4">commit</i> (take a snapshot of) your code and <i class="calibre4">push</i> (sync) it to GitHub, this service deploys the website to a URL you’ve set up. Learning to use GitHub is an investment of time and effort (the self-published book <i class="calibre4">Happy Git and GitHub for the useR</i> by Jenny Bryan at <i class="calibre4"><a href="https://happygitwithr.com" class="calibre3">https://happygitwithr.com</a></i> is a great resource), but being able to host your website for free makes it worthwhile.</p>
<p class="tx">Here’s how GitHub Pages works. Most of the time, when you look at a file on GitHub, you see its underlying source code, so if you looked at an HTML file, you’d see only the HTML code. GitHub Pages, on the other hand, shows you the rendered HTML files. To host your website on GitHub Pages, you’ll need to first push your code to GitHub. Once you have a repository set up there, go to it, then go to the <b class="calibre9">Settings</b> tab, which should look like <a href="chapter9.xhtml#fig9-10" class="calibre3">Figure 9-10</a>.</p>
<figure class="img"><img alt="" class="img1" height="524" id="fig9-10" src="../images/fig9-10.jpg" width="1391"/>
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 9-10: Setting up GitHub Pages</span></p></figcaption>
</figure>
<p class="tx">Now choose how you want GitHub to deploy the raw HTML. The easiest approach is to keep the default source. To do so, select <b class="calibre9">Deploy</b> from a <span aria-label=" Page 155. " epub:type="pagebreak" id="pg_155" role="doc-pagebreak"/>branch and then select your default branch (usually <i class="calibre4">main</i> or <i class="calibre4">master</i>). Next, select the directory containing the HTML files you want to be rendered. If you configured your website for GitHub Pages at the beginning of this chapter, the files should be in <i class="calibre4">docs</i>. Click <b class="calibre9">Save</b> and wait a few minutes, and GitHub should show the URL where your website now lives.</p>
<p class="tx">The best part about hosting your website on GitHub Pages is that any time you update your code or data, the website will update as well. R Markdown, <span class="sans_thesansmonocd_w5regular_">distill</span>, and GitHub Pages make building and maintaining websites a snap.</p>
</section>
</section>
<section aria-labelledby="sec15" epub:type="division">
<h3 class="h1" id="sec15"><span id="h1-57"/><span class="sans_dogma_ot_bold_b_1">Summary</span></h3>
<p class="tni">In this chapter, you learned to use the <span class="sans_thesansmonocd_w5regular_">distill</span> package to make websites in R. This package provides a simple way to get a website up and running with the tool you’re already using for working with data. You’ve seen how to:</p>
<ul class="ul">
<li class="listbulletfirst">Create new pages and add them to your top navigation bar</li>
<li class="listbullet">Customize the look and feel of your website with tweaks to the CSS</li>
<li class="listbullet">Use wider layouts to make content fit better on individual pages</li>
<li class="listbullet">Convert static data visualization and tables into interactive versions</li>
<li class="listbulletlast">Use GitHub Pages to host an always-up-to-date version of your website</li>
</ul>
<p class="tx">Matt Herman has continued building websites with R. He and his colleagues at the Council of State Governments Justice Center have made a great website using Quarto, the language-agnostic version of R Markdown. This website, found at <i class="calibre4"><a href="https://projects.csgjusticecenter.org/tools-for-states-to-address-crime/" class="calibre3">https://projects.csgjusticecenter.org/tools-for-states-to-address-crime/</a></i>, highlights crime trends throughout the United States using many of the same techniques you saw in this chapter.</p>
<p class="tx">Whether you prefer <span class="sans_thesansmonocd_w5regular_">distill</span> or Quarto, using R is a quick way to develop complex websites without having to be a sophisticated frontend web developer. The websites look good and communicate well. They are one more example of how R can help you efficiently share your work with the world.</p>
</section>
<section aria-labelledby="sec16" epub:type="division">
<h3 class="h1" id="sec16"><span id="h1-58"/><span class="sans_dogma_ot_bold_b_1">Additional Resources</span></h3>
<ul class="ul">
<li class="listbullet">The Distillery, “Welcome to the Distillery!,” accessed November 30, 2023, <i class="calibre4"><a href="https://distillery.rbind.io" class="calibre3">https://distillery.rbind.io</a></i>.</li>
<li class="listbullet">Thomas Mock, “Building a Blog with distill,” <i class="calibre4">The MockUp</i>, August 1, 2020, <i class="calibre4"><a href="https://themockup.blog/posts/2020-08-01-building-a-blog-with-distill/" class="calibre3">https://themockup.blog/posts/2020-08-01-building-a-blog-with-distill/</a></i>.</li>
</ul>
</section>
</section>
</div></body></html>