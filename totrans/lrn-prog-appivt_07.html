<html><head></head><body>
<h2 class="h2" id="ch07"><span epub:type="pagebreak" id="page_125"/><strong><span class="big">7</span><br/>MULTIPLICATION STATION II: REUSING CODE WITH PROCEDURES</strong></h2>
<div class="imagel"><img alt="Image" src="../images/common.jpg"/></div>
<p class="noindent">Sometimes you’ll want to reuse a section of code to complete a specific task you’ve completed before. In these situations, you can define or create a <em>procedure</em> that includes those lines of code, and then give that procedure a unique name.</p>
<p class="indent">This way, whenever you want to execute that task, you can call the procedure by name instead of writing the same lines of code over and over again. This also means that when you have to correct something in that code, you only have to fix the code inside the procedure once.</p>
<p class="indent">In this chapter, you’ll learn how to create procedures in App Inventor and use them to make the “Multiplication Station II” app. As you’ll see, procedures not only help you avoid repeating the same code, they also make long and complicated code more organized and easier to read.</p>
<h3 class="h3" id="ch00lev1sec46"><span epub:type="pagebreak" id="page_126"/><strong>PROCEDURES CAN TAKE PARAMETERS</strong></h3>
<p class="noindent">Let’s use a simple example to see how procedures work. Say you’ve written code that calculates how many days there are until someone’s birthday. You can use those lines of code to create a procedure and give it a name like <span class="literal">BdayCountDown</span>. Now, whenever you need to count down to someone’s birthday, all you have to do is <em>call</em> the <span class="literal">BdayCountDown</span> procedure. Pretty handy!</p>
<p class="indent">Like the built-in methods we’ve used in some of our apps, a procedure might require <em>parameters</em> that you’ll have to declare and name when defining the procedure itself. In the birthday example, the <span class="literal">BdayCountDown</span> procedure would take a person’s birth month and day as parameters to calculate the result. This means that when calling <span class="literal">BdayCountDown</span>, you’ll need to provide the <em>arguments</em> that the procedure needs to complete that task. In this case, the procedure would take numbers (for the date of birth) as its arguments.</p>
<p class="indent">Since the arguments passed into the procedure at each call may be different, a procedure might produce a different result every time you call it. This makes sense in the birthday example, too: since most people have different birthdays, the procedure would return different values.</p>
<h3 class="h3" id="ch00lev1sec47"><strong>CREATING YOUR OWN PROCEDURE</strong></h3>
<p class="noindent">You’ve already used several of App Inventor’s built-in procedures, both with and without parameters. For instance, in “Hi, World!” in <a href="ch01.xhtml#ch01">Chapter 1</a>, you used the call to the built-in <span class="literal">SpeechRecognizer.GetText</span> method to convert spoken messages to text. And in <a href="ch03.xhtml#ch03">Chapter 3</a>’s “Fruit Loot” app, you moved the <span class="literal">ImageSprite</span>s around the <span class="literal">Canvas</span> using the <span class="literal">ImageSprite.Move</span> method call, which required x- and y-coordinates as parameters.</p>
<p class="indent">In addition to built-in methods, App Inventor provides blocks that let you create your own procedures, which can return results or not and can have numerous parameters or none at all. Once you create a procedure with its own unique name, App Inventor creates a block just for that procedure that you can use to call it, complete with sockets to plug in any parameter arguments. You’ll find the call block in the Procedures blocks drawer.</p>
<p class="indent">Let’s try creating our own procedures to change the code in some of the apps we’ve already made. We’ll refactor the code in “Fruit Loot” so that we don’t repeat the same blocks in the three <span class="literal">EdgeReached</span> event handlers that tell the app what to do after each fruit <span class="literal">ImageSprite</span> reaches the edge of the <span class="literal">Canvas</span>.</p>
<p class="indent">The following code shows the <span class="literal">EdgeReached</span> event handlers we coded in <a href="ch03.xhtml#ch03">Chapter 3</a>.</p>
<p class="indent">As you can see, we duplicated blocks to create the three separate <span class="literal">EdgeReached</span> event handlers for <span class="literal">FruitSprite1</span>, <span class="literal">FruitSprite2</span>, and <span class="literal">FruitSprite3</span>. In each copy, we changed only the few blocks that set the <span class="literal">ImageSprite</span>’s <span class="literal">X</span> property to make sure that the fruit <span class="literal">ImageSprite</span>s never collide with each other as they fall down the <span class="literal">Canvas</span>.</p>
<div class="image"><span epub:type="pagebreak" id="page_127"/><img alt="Image" src="../images/f0127-01.jpg"/></div>
<p class="indent">Now compare this with the following code, which shows a <span class="literal">backToTop</span> procedure that completes the same tasks, but uses a lot fewer blocks if we call it within the event handlers for all three fruit <span class="literal">ImageSprite</span>s.</p>
<div class="image"><img alt="Image" src="../images/f0127-02.jpg"/></div>
<p class="indent"><span epub:type="pagebreak" id="page_128"/>To create the <span class="literal">backToTop</span> procedure, we’ll need to define the parameters <span class="literal">sprite</span> and <span class="literal">X</span>, which are the two pieces of information that may change each time the procedure is called—the <span class="literal">ImageSprite</span> to adjust and the x-coordinate for the point at the top of the screen where we want to move that <span class="literal">ImageSprite</span>.</p>
<h4 class="h4" id="ch00lev2sec46"><strong>DEFINING THE PARAMETERS</strong></h4>
<p class="noindent">Log into App Inventor, and open your “Fruit Loot” app by selecting <strong>Projects</strong> <span class="ent">▸</span> <strong>My Projects</strong> and choosing the “Fruit Loot” app from your list of projects.</p>
<p class="indent">Go to the Blocks Editor and click the <strong>Procedures</strong> blocks drawer in the Blocks pane. Drag the <span class="codestrong">to procedure do</span> block to the Viewer, click <span class="codestrong">procedure</span>, and rename it by entering <span class="codestrong">backToTop</span>.</p>
<p class="indent">Then click the blue mutator icon to the left of the words <span class="literal">to backToTop</span>, drag two <span class="codestrong">input:x</span> blocks to the <span class="codestrong">inputs</span> block in the dialog that opens, and rename them <span class="codestrong">input:sprite</span> and <span class="codestrong">input:X</span>. Your inputs should look like <a href="ch07.xhtml#ch7fig1">Figure 7-1</a>. Once the mutator dialog closes, you also should see the parameters <span class="literal">sprite</span> and <span class="literal">X</span> listed to the right of the words <span class="literal">to backToTop</span> in the <span class="literal">to backToTop</span> block, as shown in the previous code.</p>
<div class="image" id="ch7fig1"><img alt="Image" src="../images/07fig01.jpg"/></div>
<p class="figcap"><em>Figure 7-1: The blocks that add the parameters for the <span class="literal">backToTop</span> procedure</em></p>
<p class="indent">Now we can program <span class="literal">backToTop</span> so that it can have the app execute the exact same commands that we coded in each of the original <span class="literal">EdgeReached</span> handlers. But instead of using blocks for a specific <span class="literal">ImageSprite</span>, we’ll use the generic Any <span class="literal">ImageSprite</span> setter blocks. That way, each time we call the procedure, the setter blocks will make changes to the <span class="literal">ImageSprite</span> referred to in the procedure’s <span class="literal">sprite</span> parameter, which will be the <span class="literal">ImageSprite</span> that hit the edge.</p>
<p class="indent">To add the setter blocks, click the plus sign to the left of the Any Component category listing at the bottom of the Blocks pane and then click the <strong>Any ImageSprite</strong> drawer, drag the <span class="codestrong">setImageSprite.Enabled</span> block to the Viewer, and make three copies of it. You should now have four copies of the <span class="literal">set ImageSprite.Enabled</span> block on the Viewer. You’ll use these to set the <span class="literal">ImageSprite</span>’s <span class="literal">Y</span>, <span class="literal">X</span>, <span class="literal">Picture</span>, and <span class="literal">Visible</span> properties as shown earlier.</p>
<h5 class="h5" id="ch00lev3sec87"><strong>Setting the ImageSprite’s Y and X Properties</strong></h5>
<p class="noindent">We’ll start by setting the given <span class="literal">ImageSprite</span>’s <span class="literal">Y</span> and <span class="literal">X</span> properties to make the <span class="literal">ImageSprite</span> return to a random spot at the top of the screen before dropping again.</p>
<div class="image"><span epub:type="pagebreak" id="page_129"/><img alt="Image" src="../images/f0129-01.jpg"/></div>
<p class="indent">These blocks first take the <span class="literal">Y</span> property of the <span class="literal">ImageSprite</span> that is given as the argument for the <span class="literal">sprite</span> parameter in the <span class="literal">backToTop</span> procedure call (the <span class="literal">ImageSprite</span> that dropped and hit the edge) and set it to <span class="literal">0</span>. This moves the <span class="literal">ImageSprite</span> back up to the top of the screen. Drag the first copy of the <span class="codestrong">setImageSprite.Enabled</span> block <span class="ent">➊</span> inside the <span class="codestrong">to backToTop</span> procedure block next to the word <span class="literal">do</span>, click the drop-down arrow to the right of the word <span class="literal">Enabled</span>, and replace <span class="codestrong">Enabled</span> by selecting <span class="codestrong">Y</span>. Then mouse over the procedure’s <span class="codestrong">sprite</span> parameter and drag its <span class="codestrong">get sprite</span> block <span class="ent">➋</span> into the <span class="codestrong">setImageSprite.Y</span> block’s first socket. Drag the number <span class="codestrong">0</span> block <span class="ent">➌</span> from the <span class="codestrong">Y</span> property setter block in the original <span class="codestrong">FruitSprite1 EdgeReached</span> handler into the second socket.</p>
<p class="indent">Now, we’ll add blocks that set the given <span class="literal">ImageSprite</span>’s <span class="literal">X</span> property to the given random <span class="literal">X</span> value, which moves the <span class="literal">ImageSprite</span> to a random spot at the top of the screen. To do this, drag the second <span class="codestrong">setImageSprite.Enabled</span> block <span class="ent">➍</span> into the procedure block under the <span class="codestrong">setImageSprite.Y</span> block, and replace <span class="codestrong">Enabled</span> by selecting <span class="codestrong">X</span> in the drop-down. Drag another <span class="codestrong">get sprite</span> block <span class="ent">➎</span> into the <span class="codestrong">setImageSprite.X</span> block’s first socket, mouse over the procedure’s <span class="codestrong">X</span> parameter, and drag its <span class="codestrong">get X</span> block <span class="ent">➏</span> into the second socket.</p>
<h5 class="h5" id="ch00lev3sec88"><strong>Setting the ImageSprite’s Picture and Visible Properties and Adding to fruitsDropped</strong></h5>
<p class="noindent">Next, we’ll add blocks that set the given <span class="literal">ImageSprite</span>’s new <span class="literal">Picture</span> and <span class="literal">Visible</span> properties and increment the value of the <span class="literal">fruitsDropped</span> variable.</p>
<div class="image"><img alt="Image" src="../images/f0129-02.jpg"/></div>
<p class="indent">First, we’ll place the blocks that set the given <span class="literal">ImageSprite</span>’s <span class="literal">Picture</span> property randomly to <em>1.png</em>, <em>2.png</em>, or <em>3.png</em>, each of which is a picture of a different piece of fruit. This ensures that players won’t know whether an apple, lemon, or orange will drop next. To do this, drag the third <span class="codestrong">setImageSprite.Enabled</span> block <span class="ent">➊</span> into the procedure block under the <span class="codestrong">setImageSprite.X</span> block, and replace <span class="codestrong">Enabled</span> by selecting <span class="codestrong">Picture</span> in the drop-down. Drag another <span class="codestrong">get sprite</span> block <span class="ent">➋</span> into its first socket, and drag the <span class="codestrong">join</span> block <span class="ent">➌</span> from the <span class="literal">Picture</span> setter block in the original <span class="literal">EdgeReached</span> handler into the second socket.</p>
<p class="indent">Then, we’ll add another set of blocks to make the given <span class="literal">ImageSprite</span> visible in case it hit the picker earlier and disappeared. Drag the fourth <span class="codestrong">setImageSprite.Enabled</span> block <span class="ent">➍</span> into the procedure block under the <span class="codestrong">setImageSprite.Picture</span> <span epub:type="pagebreak" id="page_130"/>block, and replace <span class="codestrong">Enabled</span> by selecting <span class="codestrong">Visible</span> in the drop-down menu. Drag another <span class="codestrong">get sprite</span> block <span class="ent">➎</span> into its first socket, and drag the <span class="codestrong">true</span> block <span class="ent">➏</span> from the <span class="literal">Visible</span> setter block in the original <span class="literal">EdgeReached</span> handler into the second socket.</p>
<p class="indent">Finally, to complete the <span class="literal">backToTop</span> procedure, we’ll add blocks that increment the value of the <span class="literal">fruitsDropped</span> variable by 1 when the procedure is called. This will enable us to keep track of the total number of pieces of fruit dropped in the game. To do this, drag the <span class="codestrong">set global fruitsDropped</span> blocks <span class="ent">➐</span> from the original <span class="literal">EdgeReached</span> handler into the procedure block under the <span class="literal">setImageSprite.Visible</span> block.</p>
<h4 class="h4" id="ch00lev2sec47"><strong>CALLING THE PROCEDURE</strong></h4>
<p class="noindent">With this procedure in place, we no longer need to add the five setter blocks to each <span class="literal">EdgeReached</span> event handler.</p>
<div class="image"><img alt="Image" src="../images/f0130-01.jpg"/></div>
<p class="indent">We can handle the <span class="literal">EdgeReached</span> event for each fruit <span class="literal">ImageSprite</span> simply by snapping the <span class="literal">call backToTop</span> block <span class="ent">➊</span> from the Procedures drawer inside each <span class="literal">ImageSprite</span>’s <span class="literal">EdgeReached</span> event handler.</p>
<p class="indent">We can then click the <span class="codestrong">ImageSprite</span> in the Blocks pane; drag the very last block, its getter block <span class="ent">➋</span>, into the <span class="codestrong">call backToTop sprite</span> socket to provide the argument for the <span class="literal">sprite</span> parameter; and drag the random integer blocks <span class="ent">➌</span> from the <span class="codestrong">X</span> setter block in its original <span class="literal">EdgeReached</span> handler into the <span class="codestrong">call backToTop X</span> socket to provide the argument for the <span class="literal">X</span> parameter. Once you add the call block to the <span class="literal">EdgeReached</span> handler for each <span class="literal">ImageSprite</span> and fill the parameter sockets as described, be sure to delete the five original setter blocks from all three <span class="literal">EdgeReached</span> event handlers.</p>
<p class="indent">Now we can use the <span class="literal">backToTop</span> procedure not just in the “Fruit Loot” game, but in any other similar game. Since we’ve created this procedure here, we never have to figure out again how to keep moving randomly dropping, non-colliding images back to the top of a screen to drop again, whether they’re images of balls, birds, or anything else.</p>
<div class="note">
<p class="notet"><span class="noteh1"><strong>NOTE</strong></span></p>
<p class="notep"><em>You can transfer a procedure, or any other block, from one app project to another by right-clicking on the blocks and selecting Add to Backpack. This action adds a copy of the blocks to the backpack located at the top right of the Viewer in the Blocks Editor window. To take blocks out of the backpack, click the backpack and drag the blocks to the Viewer.</em></p>
</div>
<h3 class="h3" id="ch00lev1sec48"><span epub:type="pagebreak" id="page_131"/><strong>BUILDING THE “MULTIPLICATION STATION II” APP</strong></h3>
<p class="noindent">Let’s define another multiparameter procedure to build on the original “Multiplication Station” app from <a href="ch04.xhtml#ch04">Chapter 4</a>. When we’re done, users should be able to select from two difficulty levels of multiplication problems. We’ll also rework the user interface of the app’s welcome screen, create new global list variables to present choices, and include an <span class="literal">if then</span> block to tell the app what to display when a user selects each level of practice problems.</p>
<p class="indent">To get started, open your original “Multiplication Station” app by selecting <strong>Projects</strong> <span class="ent">▸</span> <strong>My Projects</strong>, as shown in <a href="ch07.xhtml#ch7fig2">Figure 7-2</a>, and choosing the “Multiplication Station” app from your list of projects.</p>
<div class="image" id="ch7fig2"><img alt="Image" src="../images/07fig02.jpg"/></div>
<p class="figcap"><em>Figure 7-2: The Projects menu where you open and save projects</em></p>
<p class="indent">Once “Multiplication Station” opens, select <strong>Projects</strong> <span class="ent">▸</span> <strong>Save project as…</strong> and rename the project by entering <span class="codestrong">MultiplicationStationII</span> without any spaces, and then click <strong>OK</strong>.</p>
<h4 class="h4" id="ch00lev2sec48"><strong>DECOMPOSING “MULTIPLICATION STATION II”</strong></h4>
<p class="noindent">We want to change the original “Multiplication Station” app so that when users open the app, they can choose level 1 (easier) or level 2 (more challenging) problems to practice and will have more time to solve level 2 problems.</p>
<p class="indent">We can decompose the new action for “Multiplication Station II” into three steps:</p>
<ol>
<li><p class="noindent">When the user opens the app, play a welcome message. Display the <span class="literal">ListPicker</span> for the user to click to choose a practice level.</p></li>
<li><p class="noindent">After the user clicks the <span class="literal">ListPicker</span> to choose a practice level, play another message stating the number of seconds available to answer each problem. Open and pass the selected problem level to the practice screen.</p></li>
<li><p class="noindent">When the <span class="literal">Clock</span>’s timer fires, display a random multiplication problem at the correct time interval for the selected problem level.</p></li>
</ol>
<p class="indent"><span epub:type="pagebreak" id="page_132"/>You’ll need the following new components:</p>
<ul>
<li><p class="noindent"><span class="codestrong">ListPicker</span> for the user to click to select problem level and open the practice screen (this replaces the original start button on the welcome screen)</p></li>
<li><p class="noindent">Procedure to display problems and set the <span class="literal">Clock</span> timer interval according to the selected problem level</p></li>
<li><p class="noindent">Variable (2) to store problem level and timer interval</p></li>
</ul>
<h4 class="h4" id="ch00lev2sec49"><strong>LAYING OUT “MULTIPLICATION STATION II” IN THE DESIGNER</strong></h4>
<p class="noindent">Right now, the welcome screen gives users only one option—to click the start button and start practicing. To allow users to first choose the level of multiplication problems, all we have to do is remove <span class="literal">Button1</span> from the welcome screen and replace it with a <span class="literal">ListPicker</span>. Once we adjust the <span class="literal">ListPicker</span>’s properties to make it look similar to <span class="literal">Button1</span>, the new welcome screen should look something like <a href="ch07.xhtml#ch7fig3">Figure 7-3</a>.</p>
<div class="image" id="ch7fig3"><img alt="Image" src="../images/07fig03.jpg"/></div>
<p class="figcap"><em>Figure 7-3: The Viewer, Component, and Media panes showing the <span class="literal">Screen1</span> layout for “Multiplication Station II”</em></p>
<p class="indent">To make these changes, first go to the Designer for <span class="literal">Screen1</span>. Click <span class="codestrong">Button1</span> in the Components pane, and click <strong>Delete</strong> and then <strong>Delete</strong> again in the dialog that opens.</p>
<p class="indent"><span epub:type="pagebreak" id="page_133"/>Now drag a <span class="codestrong">ListPicker</span> from the User Interface drawer and place it on the Viewer where you just deleted <span class="literal">Button1</span>. Adjust the <span class="literal">ListPicker</span>’s properties so that it looks like <span class="literal">Button1</span>. In the Properties pane, change the background color to black by clicking <strong>Default</strong> under <span class="codestrong">BackgroundColor</span> and then clicking <strong>Black</strong> when the color list dialog opens. Make its text bold by clicking the checkbox under <span class="codestrong">FontBold</span>, and change its shape by clicking the drop-down arrow under <strong>Shape</strong> and selecting <strong>rounded</strong>.</p>
<p class="indent">Next, enter <span class="codestrong">Choose Your Level</span> in the text box under <strong>Text</strong> so users know to click the <span class="literal">ListPicker</span> to choose their problem level. Then, center the text by clicking the drop-down arrow under <span class="codestrong">TextAlignment</span> and selecting <strong>center: 1</strong>, and make the text white by clicking <strong>Default</strong> under <span class="codestrong">TextColor</span> and then clicking <strong>White</strong> when the color list dialog opens. <span class="literal">Screen1</span> should now look like <a href="ch07.xhtml#ch7fig3">Figure 7-3</a> in the Viewer.</p>
<h3 class="h3" id="ch00lev1sec49"><strong>PROGRAMMING “MULTIPLICATION STATION II”</strong></h3>
<p class="noindent">Now let’s program the new features for “Multiplication Station II” following the steps outlined earlier. To show the correct problems for the selected problem level, we’ll create two new list variables and a procedure with parameters. We’ll add an <span class="literal">if then</span> block to the procedure so that the app will know whether to display problems for level 1 or level 2 at each <span class="literal">Clock</span> timer interval.</p>
<p class="indent">We’ll also program two new event handlers so that the app will know what to do before and after the user selects a level with the <span class="literal">ListPicker</span>. To begin programming, click the <strong>Blocks</strong> button to switch to the Blocks Editor and make sure you’re on <span class="literal">Screen1</span>.</p>
<h4 class="h4" id="ch00lev2sec50"><strong>STEP 1: SETTING PROBLEM LEVEL CHOICES AND PLAYING THE NEW WELCOME MESSAGE</strong></h4>
<p class="noindent">As soon as the screen opens, we want to display the <span class="literal">ListPicker</span> with the problem level options for the user to select. We’ll prompt the user to select a practice problem level by playing the app’s welcome message.</p>
<h5 class="h5" id="ch00lev3sec89"><strong>Creating the Global level and seconds List Variables</strong></h5>
<p class="noindent">We’ll use two global list variables in this step: <span class="literal">level</span>, which stores the two problem level choices for <span class="literal">ListPicker1</span>, and <span class="literal">seconds</span>, which holds the number of seconds available to solve problems in each level. Create the two lists with the blocks shown here.</p>
<div class="image"><img alt="Image" src="../images/f0133-01.jpg"/></div>
<p class="indent">To create each variable, click the <strong>Variables</strong> block drawer and drag an <span class="codestrong">initialize global name</span> block <span class="ent">➊</span> to the Viewer, click <span class="codestrong">name</span>, and replace it with <span epub:type="pagebreak" id="page_134"/>the variable name (in this case, <span class="codestrong">level</span> and <span class="codestrong">seconds</span>). Then drag a <span class="codestrong">make a list</span> block <span class="ent">➋</span> from the Lists drawer and snap it to the right side of the <span class="codestrong">initialize global</span> block. Finally, drag two <span class="codestrong">0</span> number blocks <span class="ent">➌</span> from the Math drawer and snap them into the sockets of the <span class="codestrong">make a list</span> block. Then, replace the <span class="codestrong">0</span> in each number block with <span class="codestrong">1</span> and <span class="codestrong">2</span> in <span class="codestrong">level</span> for the two possible problem levels and <span class="codestrong">5</span> and <span class="codestrong">10</span> in <span class="codestrong">seconds</span> for the number of seconds available for each level.</p>
<p class="indent">The items we’ve placed in the same index position in the two variables correspond to each other. This means that we can see how many seconds are available to solve problems for each level by looking at the items that are placed in the same position in the <span class="literal">level</span> and <span class="literal">seconds</span> variables. Here you can see that there are 5 seconds available for level 1 problems, and 10 seconds available for level 2.</p>
<h5 class="h5" id="ch00lev3sec90"><strong>Programming the Welcome Screen Event Handlers</strong></h5>
<p class="noindent">Now we can start coding the app’s response to the two events in this step: the <span class="literal">ListPicker BeforePicking</span> and the <span class="literal">ScreenInitialize</span> events. This is where we want to set the problem level choices for the <span class="literal">ListPicker</span> and play the welcome message.</p>
<div class="image"><img alt="Image" src="../images/f0134-01.jpg"/></div>
<p class="indent">Having created <span class="literal">level</span>, we have the data we need to set <span class="literal">ListPicker1</span>’s choices. Before the user selects from <span class="literal">ListPicker1</span>, we need to set those choices to the items in the <span class="literal">level</span> list so users can choose between level 1 and level 2. We’ll program this action with the <span class="literal">ListPicker BeforePicking</span> event handler.</p>
<p class="indent">In the Blocks pane, click <span class="codestrong">ListPicker1</span> and drag the <span class="codestrong">whenListPicker1.BeforePicking</span> event handler block <span class="ent">➊</span> to the Viewer. Then, click <span class="codestrong">ListPicker1</span> again and drag its <span class="codestrong">setListPicker.Elementsto</span> block <span class="ent">➋</span> into the <span class="codestrong">whenListPicker1.BeforePicking</span> block next to the word <span class="literal">do</span>. Next, in the Blocks pane, click the <strong>Variables</strong> blocks drawer, drag the <span class="codestrong">get global level</span> block <span class="ent">➌</span> in, and snap it to the right of the <span class="codestrong">setListPicker1.Elementsto</span> block. These three blocks create the <span class="literal">BeforePicking</span> event handler, which sets the problem level choices that the user will see when clicking <span class="literal">ListPicker1</span>.</p>
<p class="indent">Finally, for the <span class="literal">whenScreen1.Initialize</span> event handler, which we already dragged to the Viewer for the original “Multiplication Station” app, we can leave all blocks the same, except for the string block that holds the argument for the <span class="literal">message</span> parameter of the <span class="literal">callTextToSpeech1.Speak</span> block. In that string block <span class="ent">➍</span>, change the text to read <span class="codestrong">Welcome to Multiplication Station! Choose your problem level to begin practicing.</span> so users will hear that message when the app opens.</p>
<p class="indent">Live-test these event handlers with a device. When your “Multiplication Station II” app opens on your device, you should hear the welcome message. <span epub:type="pagebreak" id="page_135"/>You also should see the Choose Your Level button on the screen, and when you click it, you should see the two choices, 1 and 2. Right now, if you try to select either choice, nothing should happen. We’ll program that <span class="literal">AfterPicking</span> action next.</p>
<p class="indent">If the app’s not working as described, debug and make sure you’ve created and placed your blocks correctly. When everything’s working, leave the app open on your device to keep live-testing.</p>
<h4 class="h4" id="ch00lev2sec51"><strong>STEP 2: STATING THE NUMBER OF SECONDS FOR EACH PROBLEM AND OPENING THE PRACTICE SCREEN</strong></h4>
<p class="noindent">Let’s use the <span class="literal">ListPicker AfterPicking</span> event to tell users how many seconds they have to answer each problem, depending on the level they selected. Then we’ll program the app to open the practice screen and transfer the value of the selected problem level to that screen. Here are the blocks that direct this action.</p>
<div class="image"><img alt="Image" src="../images/f0135-01.jpg"/></div>
<p class="indent">Let’s first program the app to speak after the user chooses a problem level.</p>
<h5 class="h5" id="ch00lev3sec91"><strong>Telling the User the Time Limit</strong></h5>
<p class="noindent">In the Blocks pane, click <span class="codestrong">ListPicker1</span> and drag the <span class="codestrong">whenListPicker1.AfterPicking</span> event handler block <span class="ent">➊</span> to the Viewer. Then, click <span class="codestrong">TextToSpeech1</span> and drag its <span class="codestrong">callTexttoSpeech1.Speak</span> block <span class="ent">➋</span> into the <span class="codestrong">whenListPicker1.AfterPicking</span> block next to the word <span class="literal">do</span>.</p>
<p class="indent">Next, to provide the argument for the <span class="literal">callTexttoSpeech1.Speak</span> block’s <span class="literal">message</span> parameter so the app will know what to say, drag a <span class="codestrong">join</span> block <span class="ent">➌</span> from the Text blocks drawer to the Viewer. Then add another string input to the <span class="codestrong">join</span> block and snap it to the right of the <span class="codestrong">callTexttoSpeech1.Speak</span> block next to the word <span class="literal">message</span>. This lets us join three strings together to form the <span class="literal">message</span> for <span class="literal">TextToSpeech1</span>. If the user selected problem level 1, we fill the <span class="literal">join</span> block’s inputs to set the <span class="literal">message</span> to <span class="codestrong">You will have 5 seconds to answer each problem.</span>, and if the user selected problem level 2, we set the <span class="literal">message</span> to <span class="codestrong">You will have 10 seconds to answer each problem.</span></p>
<p class="indent">To fill the <span class="literal">join</span> block’s top and bottom inputs, drag in two empty string blocks from the Text blocks drawer, click their text areas, and enter <span class="codestrong">You will have</span> (with a space after the word <span class="literal">have</span>) in the top string block <span class="ent">➍</span> and <span class="codestrong">seconds to answer each problem</span> (with a space before the word <span class="literal">seconds</span>) in the bottom <span class="ent">➎</span>.</p>
<p class="indent"><span epub:type="pagebreak" id="page_136"/>Then, for the <span class="literal">join</span> block’s middle input, we need to add the number of seconds the user will have to answer each problem. We’ll get that value by directing the app to select the item from the <span class="literal">seconds</span> list that holds the same index position as the user’s <span class="literal">ListPicker</span> selection in the <span class="literal">level</span> list.</p>
<p class="indent">To program this, drag in a <span class="codestrong">select list item</span> block <span class="ent">➏</span> from the List blocks drawer and snap it into the <span class="codestrong">join</span> block’s middle input. Then, identify the list from which we want the app to select the item by clicking the <strong>Variables</strong> blocks drawer and dragging the <span class="codestrong">get global seconds</span> block <span class="ent">➐</span> into the <span class="codestrong">select list item</span> block’s <span class="codestrong">list</span> socket. Finally, identify the index position of the item selected from the <span class="literal">seconds</span> list by clicking <span class="codestrong">ListPicker1</span> and dragging the <span class="codestrong">ListPicker1.SelectionIndex</span> block <span class="ent">➑</span> into the <span class="codestrong">select list item</span> block’s <span class="codestrong">index</span> socket.</p>
<h5 class="h5" id="ch00lev3sec92"><strong>Moving to the Practice Screen</strong></h5>
<p class="noindent">Once the user selects a problem level, we’ll open <span class="literal">Screen2</span>, the practice screen, and pass the value the user selected in the <span class="literal">ListPicker</span> to that screen.</p>
<div class="image"><img alt="Image" src="../images/f0136-01.jpg"/></div>
<p class="indent">In the Blocks pane, click the <strong>Control</strong> blocks drawer, drag in the <span class="codestrong">open another screen with start value</span> block <span class="ent">➊</span>, and snap it inside the <span class="codestrong">whenListPicker1.AfterPicking</span> block under the <span class="literal">callTexttoSpeech1.Speak</span> block.</p>
<p class="indent">This <span class="literal">open another screen with start value</span> block requires us to provide a <span class="literal">screenName</span>, the name of the screen we want to open (<span class="literal">Screen2</span>), and the <span class="literal">startValue</span> to pass to <span class="literal">Screen2</span> (the problem level the user selected in <span class="literal">ListPicker1</span>). To provide these values, in the Blocks pane, click the <strong>Text</strong> blocks drawer, drag in another empty string block <span class="ent">➋</span>, and snap it into the <span class="literal">screenName</span> socket. Enter <span class="codestrong">Screen2</span> inside the empty string block to provide the name of the screen we want to open.</p>
<p class="indent">Then, to identify the start value we want to pass to <span class="literal">Screen2</span>, click <span class="codestrong">ListPicker1</span>, drag in its <span class="codestrong">ListPicker1.Selection</span> block <span class="ent">➌</span>, and snap it into the <span class="literal">startValue</span> socket.</p>
<p class="indent">Test to see how these blocks work. Once you open the app, you should hear the welcome message and see the Choose Your Level button. Once you click the button, you should see the numbers 1 and 2 as your choices. When you click the number 1, you should hear the app say you have 5 seconds to answer each problem, and when you click 2, it should say you have 10 seconds. Then the app should take you to the practice screen.</p>
<p class="indent">Let’s wait to test whether the app properly transfers the start value to the practice screen until after we program the next step. Make sure everything else you’ve programmed in the app is working as described, and leave it open on your phone for more live-testing.</p>
<h4 class="h4" id="ch00lev2sec52"><span epub:type="pagebreak" id="page_137"/><strong>STEP 3: DISPLAYING THE PRACTICE PROBLEMS</strong></h4>
<p class="noindent">Just like the original “Multiplication Station” app, this app displays multiplication problems by joining one random integer (the value of global variable <span class="literal">a</span>), the multiplication operator (<span class="literal">×</span>), and another random integer (the value of global variable <span class="literal">b</span>). The app also gives users a set time interval to answer each problem. In this step, we’ll create the <span class="literal">setLevel</span> procedure that sets the values of <span class="literal">a</span> and <span class="literal">b</span> and the <span class="literal">Clock</span> timer interval value in each procedure call, depending on the problem level the user selected.</p>
<p class="indent">We’ll make the <span class="literal">setLevel</span> procedure require arguments for five parameters: <span class="literal">a1</span>, <span class="literal">a2</span>, <span class="literal">b1</span>, <span class="literal">b2</span>, and <span class="literal">interval</span>. Parameters <span class="literal">a1</span> and <span class="literal">a2</span> set the random integer range for global variable <span class="literal">a</span>, the first random number in each multiplication problem, and parameters <span class="literal">b1</span> and <span class="literal">b2</span> set the random integer range for global variable <span class="literal">b</span>, the second random number. The <span class="literal">interval</span> parameter holds the time interval in milliseconds. Once <span class="literal">setLevel</span> receives these arguments in a procedure call, it sets global variable <span class="literal">a</span> to a random number ranging from <span class="literal">a1</span> to <span class="literal">a2</span>, sets global variable <span class="literal">b</span> to a random number ranging from <span class="literal">b1</span> to <span class="literal">b2</span>, and sets the <span class="literal">Clock</span> timer interval to <span class="literal">interval</span>.</p>
<p class="indent">Here’s what the <span class="literal">setLevel</span> procedure looks like.</p>
<div class="image"><img alt="Image" src="../images/f0137-01.jpg"/></div>
<p class="indent">We’ll call <span class="literal">setLevel</span> inside an <span class="literal">if then</span> block to place the correct numbers in the multiplication problems and give the user the right amount of practice time based on the selected problem level.</p>
<h5 class="h5" id="ch00lev3sec93"><strong>Creating the setLevel Procedure</strong></h5>
<p class="noindent">To make <span class="literal">setLevel</span>, click the <strong>Procedures</strong> block drawer in the <span class="literal">Screen2</span> Blocks pane, drag a <span class="codestrong">to procedure do</span> block <span class="ent">➊</span> to the Viewer, and click <span class="codestrong">procedure</span> to rename it by entering <span class="codestrong">setLevel</span>. This procedure block, like the global variables, will stand alone outside of all event handlers, allowing us to call the procedure within each event handler if we need to.</p>
<p class="indent">Next, list the required procedure parameters by clicking the blue mutator icon to the left of the words <span class="literal">to setLevel</span> and dragging five <span class="codestrong">input:x</span> blocks to the <span class="codestrong">inputs</span> block in the dialog that opens. Rename them <span class="codestrong">input:a1</span>, <span class="codestrong">input:a2</span>, <span class="codestrong">input:b1</span>, <span class="codestrong">input:b2</span>, and <span class="codestrong">input:interval</span>.</p>
<p class="indent">Now let’s program the action <span class="literal">setLevel</span> will perform. We’ll start with the blocks that set global variable <span class="literal">a</span> to a random number ranging from the argument provided for <span class="literal">a1</span> to the argument provided for <span class="literal">a2</span>. Click the <strong>Variables</strong> blocks drawer and drag a <span class="codestrong">set global a</span> block <span class="ent">➋</span> into the <span class="codestrong">to setLevel</span> block next to the word <span class="literal">do</span>. Then drag a <span class="codestrong">random integer</span> block <span class="ent">➌</span> from the Math drawer and snap it to the right of the <span class="codestrong">set global a</span> block. Fill the <span class="codestrong">random integer</span> block’s first socket by mousing over the procedure’s <span class="codestrong">a1</span> parameter and dragging in a <span class="codestrong">get a1</span> <span epub:type="pagebreak" id="page_138"/>block <span class="ent">➍</span>, and fill its second socket by mousing over the <span class="codestrong">a2</span> parameter and dragging in a <span class="codestrong">get a2</span> block <span class="ent">➎</span>.</p>
<p class="indent">To set global variable <span class="codestrong">b</span> to a random number ranging from <span class="codestrong">b1</span> to <span class="codestrong">b2</span>, simply repeat the process above for global variable <span class="codestrong">b</span> by copying the blocks at <span class="ent">➋</span> through <span class="ent">➎</span>, and snapping the copy under the <span class="codestrong">set global a</span> block. Use the drop-down arrows to change <span class="codestrong">global a</span> to <span class="codestrong">global b</span>, <span class="codestrong">a1</span> to <span class="codestrong">b1</span>, and <span class="codestrong">a2</span> to <span class="codestrong">b2</span>.</p>
<p class="indent">Finally, to complete the <span class="literal">setLevel</span> procedure, we’ll set the <span class="literal">Clock</span>’s <span class="literal">TimerInterval</span> to the argument provided for <span class="literal">interval</span> in the procedure call. Click <span class="codestrong">Clock1</span> in the Blocks pane and drag its <span class="codestrong">setClock1.TimerIntervalto</span> block <span class="ent">➏</span> into the <span class="codestrong">to setLevel</span> block under the <span class="codestrong">set global b</span> block. Then mouse over the procedure’s <span class="codestrong">interval</span> parameter and snap its <span class="codestrong">get interval</span> block <span class="ent">➐</span> to the right of the <span class="codestrong">setClock1.TimerIntervalto</span> block.</p>
<h5 class="h5" id="ch00lev3sec94"><strong>Calling setLevel</strong></h5>
<p class="noindent">We can now call <span class="literal">setLevel</span> in the <span class="literal">ClockTimer</span> event handler so that the app displays the correct problems for each level at the right time. The following code shows how we’ll call <span class="literal">setLevel</span> in a new <span class="literal">if then else</span> block within the <span class="literal">whenClock1.Timer</span> block, providing one set of arguments for the required parameters if the start value passed in from <span class="literal">Screen1</span> equals <span class="literal">1</span> and another set of arguments if it doesn’t.</p>
<div class="image"><img alt="Image" src="../images/f0138-01.jpg"/></div>
<p class="indent">Here, we change the original “Multiplication Station” app’s <span class="literal">whenClock1.Timer</span> event handler block by replacing the global variable <span class="literal">a</span> and global variable <span class="literal">b</span> setter blocks at the top with an <span class="literal">if then else</span> block. Delete the two setters, drag an <span class="codestrong">if then</span> block <span class="ent">➊</span> to the Viewer from the Control blocks drawer, click the blue mutator icon to add an <span class="codestrong">else</span> input, and snap the <span class="codestrong">if then else</span> block inside the <span class="codestrong">whenClock1.Timer</span> block next to the word <span class="literal">do</span>.</p>
<p class="indent">Now we’ll add blocks to test whether the start value passed in from <span class="literal">Screen1</span> equals <span class="literal">1</span>, which means that the user selected problem level 1 in the <span class="literal">ListPicker</span> on <span class="literal">Screen1</span>. Drag an <span class="codestrong">=</span> comparison block <span class="ent">➋</span> from the Math drawer and snap it into the <span class="codestrong">if then else</span> block’s <span class="codestrong">if</span> socket. Fill the <span class="codestrong">=</span> comparison block’s left operand socket with a <span class="codestrong">get start value</span> block <span class="ent">➌</span> from the Control drawer and its right operand socket with a <span class="codestrong">1</span> number block <span class="ent">➍</span>.</p>
<p class="indent"><span epub:type="pagebreak" id="page_139"/>The next blocks tell the app how to respond to the answer to that test condition, which is whether the start value equals <span class="literal">1</span>. If the answer is yes, we want the app to set the correct problems and time interval for level 1 problems. If the answer is no, we want the app to set the correct problems and time interval for level 2 problems. In each instance, we’ll direct the action with a call to the <span class="literal">setLevel</span> procedure.</p>
<p class="indent">To add the blocks for these procedure calls, click the <strong>Procedures</strong> drawer, drag one <span class="codestrong">call setLevel</span> block <span class="ent">➎</span>, and snap it into the <span class="codestrong">if then else</span> block’s <span class="codestrong">then</span> socket. Then drag another <span class="codestrong">call setLevel</span> block <span class="ent">➏</span> and snap it into the <span class="codestrong">if then else</span> block’s <span class="codestrong">else</span> socket. Next, fill the parameter arguments for each call block with the values shown in <a href="ch07.xhtml#ch07tab1">Table 7-1</a>.</p>
<p class="tabcap" id="ch07tab1"><strong>Table 7-1:</strong> Setting Parameters for Calls to <span class="literal">setLevel</span></p>
<table class="all">
<colgroup>
<col style="width:50%"/>
<col style="width:10%"/>
<col style="width:10%"/>
<col style="width:10%"/>
<col style="width:10%"/>
<col style="width:10%"/>
</colgroup>
<thead>
<tr>
<td class="table-h" style="vertical-align: top;"><p class="tab_th"><span class="codestrong">if then else</span> <strong>block socket</strong></p></td>
<td class="table-h" style="vertical-align: top;"><p class="tab_th"><span class="codestrong">a1</span></p></td>
<td class="table-h" style="vertical-align: top;"><p class="tab_th"><span class="codestrong">a2</span></p></td>
<td class="table-h" style="vertical-align: top;"><p class="tab_th"><span class="codestrong">b1</span></p></td>
<td class="table-h" style="vertical-align: top;"><p class="tab_th"><span class="codestrong">b2</span></p></td>
<td class="table-h" style="vertical-align: top;"><p class="tab_th"><span class="codestrong">interval</span></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;"><p class="taba"><span class="literal">then</span></p></td>
<td style="vertical-align: top;"><p class="taba"><span class="literal">1</span></p></td>
<td style="vertical-align: top;"><p class="taba"><span class="literal">12</span></p></td>
<td style="vertical-align: top;"><p class="taba"><span class="literal">1</span></p></td>
<td style="vertical-align: top;"><p class="taba"><span class="literal">12</span></p></td>
<td style="vertical-align: top;"><p class="taba"><span class="literal">5000</span></p></td>
</tr>
<tr>
<td class="table-ba" style="vertical-align: top;"><p class="taba"><span class="literal">else</span></p></td>
<td class="table-ba" style="vertical-align: top;"><p class="taba"><span class="literal">13</span></p></td>
<td class="table-ba" style="vertical-align: top;"><p class="taba"><span class="literal">99</span></p></td>
<td class="table-ba" style="vertical-align: top;"><p class="taba"><span class="literal">10</span></p></td>
<td class="table-ba" style="vertical-align: top;"><p class="taba"><span class="literal">99</span></p></td>
<td class="table-ba" style="vertical-align: top;"><p class="taba"><span class="literal">10000</span></p></td>
</tr>
</tbody>
</table>
<p class="indent">Each time the <span class="literal">Clock</span> timer fires, if the start value passed from the welcome screen equals <span class="literal">1</span> (<span class="literal">then</span>, user chose problem level 1), the app calls the <span class="literal">setLevel</span> procedure to set global variable <span class="literal">a</span> to a random number ranging from 1 to 12, set global variable <span class="literal">b</span> to a random number ranging from 1 to 12, and set the <span class="literal">Clock</span> timer interval to 5 seconds.</p>
<p class="indent">If the start value passed from the welcome screen doesn’t equal <span class="literal">1</span> (<span class="literal">else</span>, user chose level 2), the app calls <span class="literal">setLevel</span> to set global variable <span class="literal">a</span> to a random number ranging from 13 to 99, set global variable <span class="literal">b</span> to a random number ranging from 10 to 99, and set the <span class="literal">Clock</span> timer interval to 10 seconds.</p>
<p class="indent">Now let’s switch to <span class="literal">Screen1</span> and test the completed app! When the welcome screen opens in your device, you should see the <span class="literal">ListPicker</span> and hear the welcome message. When you click Choose Your Level and make a selection, the app should tell you how many seconds you have to answer each problem. The practice screen should also open, and, if you chose level 1, problems should appear every 5 seconds, or, if you chose level 2, problems should appear every 10 seconds. Also, the problems should include numbers from the range expected for the selected problem level.</p>
<p class="indent">If any part of the app isn’t working as planned, debug and try again. If you placed your blocks correctly, the app should work as expected, and you’ve successfully created “Multiplication Station II”!</p>
<h3 class="h3" id="ch00lev1sec50"><strong>SUMMARY</strong></h3>
<p class="noindent">In this chapter, you built the “Multiplication Station II” app, which builds on the original “Multiplication Station” app you created in <a href="ch04.xhtml#ch04">Chapter 4</a> to let users choose the difficulty level of the problems and pass that choice from one screen to the next. Instead of having to use the same code blocks over <span epub:type="pagebreak" id="page_140"/>and over again, you learned how to use a procedure to reuse the code that sets the problems and time limit. You also worked more with lists, <span class="literal">if then</span>, and relational operator blocks to control app flow.</p>
<p class="indent">In the next chapter, you’ll learn how to create apps that let users draw on the screen and drag images around. You’ll create the “Virtual Shades” app, where a user can take a selfie, “try on” a variety of sunglasses by dragging them into place over the picture, and draw and type on the picture with different-colored “ink.”</p>
<h3 class="h3" id="ch00lev1sec51"><strong>ON YOUR OWN</strong></h3>
<p class="noindent">When you’re ready for a challenge, save new versions of your previous apps, and try these exercises. You can find solutions online at <em><a href="https://nostarch.com/programwithappinventor/">https://nostarch.com/programwithappinventor/</a></em>.</p>
<ol>
<li><p class="noindent">In “Multiplication Station II,” try adding a pause button to the practice screen so users can temporarily stop practicing when they need to. Write and call a procedure as part of this extension.</p></li>
<li><p class="noindent">Write and call a procedure that changes the code you wrote in <a href="ch04.xhtml#ch04">Chapter 4</a> to allow users to choose to practice multiplication or division problems.</p></li>
</ol>
</body></html>