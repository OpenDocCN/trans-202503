<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;Device Nodes, Live Switches, and the Internet"><div class="titlepage"><div><div><h1 class="title"><a id="device_nodescomma_live_switchescomma_and"/>Chapter 7. Device Nodes, Live Switches, and the Internet</h1></div></div></div><p><a id="iddle1188" class="indexterm"/><a id="iddle1276" class="indexterm"/>In this chapter, I’ll demonstrate how GNS3 device nodes are used with Cisco IOS routers. GNS3 provides a Hub node and various Switch nodes, including an Ethernet switch, EtherSwitch router, ATM switch, and Frame Relay switch. In addition, we’ll take a look at how to create your own Frame Relay switch using a Cisco IOS router.</p><p>We’ll also explore a very powerful feature known as a <span class="emphasis"><em>Cloud node</em></span>. A Cloud node is used to expand your networks beyond the GNS3 program. With Cloud nodes, you’ll soon be able to connect your GNS3 projects to live Cisco switches and access the Internet using GNS3 routers.</p><div class="sect1" title="Built-in Device Nodes"><div class="titlepage"><div><div><h1 class="title"><a id="built-in_device_nodes"/>Built-in Device Nodes</h1></div></div></div><p><a id="iddle1082" class="indexterm"/><a id="iddle1268" class="indexterm"/><a id="iddle1275" class="indexterm"/><a id="iddle1875" class="indexterm"/>Built-in device nodes <span class="emphasis"><em>simulate</em></span> the features of a specific device type (like a switch). They’re easy to configure and can be useful if you need to save time and PC resources or if you just want to get something done without knowing all the details of the underlying technology.</p><p>If you create a topology that uses VLANs, you can drag a GNS3 Ethernet switch node to your workspace and use a simple menu to quickly create VLANs or VLAN trunks. Of course, if you’re studying for a Cisco exam that involves switching, you need to know how to configure actual Cisco IOS switches.</p></div><div class="sect1" title="Node Configurator"><div class="titlepage"><div><div><h1 class="title"><a id="node_configurator"/>Node Configurator</h1></div></div></div><p>By now, you already know that the Node configurator can be used to configure the features of a single device node, but it can also be used to modify multiple devices at the same time. As your projects grow and you use more devices, this feature can save you a lot of time.</p><p>To open multiple devices at the same time, use your mouse to select those devices in your workspace, and then right-click any device and choose <span class="strong"><strong>Configure</strong></span>. The selected devices display in the Node configurator, as shown in <a class="xref" href="ch07.html#modifying_multiple_devices_using_the_nod" title="Figure 7-1. Modifying multiple devices using the Node configurator">Figure 7-1</a>.</p><div class="figure"><a id="modifying_multiple_devices_using_the_nod"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00075"/><img src="httpatomoreillycomsourcenostarchimages2209019.png.jpg" alt="Modifying multiple devices using the Node configurator"/></div></div><p class="title">Figure 7-1. Modifying multiple devices using the Node configurator</p></div><p>To configure a single device, select that device from the column on the left. Configure each device and click <span class="strong"><strong>Apply</strong></span>. When you’re finished configuring all the devices, click <span class="strong"><strong>OK</strong></span> to complete the process.</p><p><a id="iddle1272" class="indexterm"/><a id="iddle1357" class="indexterm"/><a id="iddle1880" class="indexterm"/>To modify multiple devices, use the <span class="smaller">SHIFT</span> key to select several at once from the column on the left and then configure them in the same manner as you would a single device. Let’s say you have ten 7200 series routers and you want to add the same network module to slot 0 on all 10 routers. Use the <span class="smaller">SHIFT</span> key to select all the routers, add the module to slot 0, and then click <span class="strong"><strong>Apply</strong></span> and <span class="strong"><strong>OK</strong></span> to make the change to all 10 devices.</p><p>You can also select an entire group of routers by clicking their group name. In the previous figure, you could configure R1, R2, and R3 at the same time by selecting the group name <span class="emphasis"><em>Router c3725 group</em></span> ➊.</p></div><div class="sect1" title="Ethernet Hub"><div class="titlepage"><div><div><h1 class="title"><a id="ethernet_hub"/>Ethernet Hub</h1></div></div></div><p>GNS3 provides an Ethernet hub (see <a class="xref" href="ch07.html#ethernet_hub_node_configurator" title="Figure 7-2. Ethernet hub Node configurator">Figure 7-2</a>) as a tool that networking instructors can use to teach students about the perils of Ethernet loops, excessive broadcasts, and multiport repeating.</p><div class="figure"><a id="ethernet_hub_node_configurator"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00076"/><img src="httpatomoreillycomsourcenostarchimages2209021.png.jpg" alt="Ethernet hub Node configurator"/></div></div><p class="title">Figure 7-2. Ethernet hub Node configurator</p></div><p>As a general rule, you should stick with GNS3 switches and avoid including hubs in your projects. But if you do need to use an Ethernet hub, you can change the number of available Ethernet ports by pulling up the Node configurator and selecting your hub from the list on the left. The default value is eight ports, so if you want a different amount, enter that number in the Settings field on the right.</p></div><div class="sect1" title="EtherSwitch Router"><div class="titlepage"><div><div><h1 class="title"><a id="etherswitch_router"/>EtherSwitch Router</h1></div></div></div><p><a id="iddle1273" class="indexterm"/><a id="iddle1364" class="indexterm"/><a id="iddle1882" class="indexterm"/><a id="iddle2074" class="indexterm"/><a id="iddle2183" class="indexterm"/>GNS3 provides two types of Dynamips switches, the Ethernet switch node and the EtherSwitch router. I discussed the Ethernet switch node in <a class="xref" href="ch04.html" title="Chapter 4. Creating and Managing Projects">Chapter 4</a>, so I’ll only cover the EtherSwitch router here.</p><p>An <span class="emphasis"><em>EtherSwitch router</em></span> is not a simulated device like an Ethernet hub or Ethernet switch node. Instead, it’s a Dynamips router running Cisco IOS that’s been configured with a 16-port switch module (NM-16ESW). This is the same switch module that can be installed on an actual Cisco router, and it has the same features and limitations (see <a class="xref" href="apc.html" title="Appendix C. NM-16ESW and IOU L2 Limitations">Appendix C</a> for details). Although the switch module has limited functionality, it’s perfectly suited for CCNA and many CCNP studies. For more advanced switching features, you need to integrate real switches into your GNS3 projects or use Cisco IOU switches.</p><div class="note" title="Note"><h3 class="title"><a id="ch07note01"/>Note</h3><p><span class="emphasis"><em>The EtherSwitch router requires that you configure a c3745 router with an IOS.</em></span></p></div><p>To add additional switch ports to your EtherSwitch router, right-click the switch icon and select <span class="strong"><strong>Configure</strong></span>, as shown in <a class="xref" href="ch07.html#etherswitch_router_node_configurator" title="Figure 7-3. EtherSwitch router Node configurator">Figure 7-3</a>.</p><p>The EtherSwitch router allows you to add additional switch modules. Adding another NM-16ESW module in slot 2 increases the number of switch ports to 32.</p><div class="figure"><a id="etherswitch_router_node_configurator"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00077"/><img src="httpatomoreillycomsourcenostarchimages2209023.png.jpg" alt="EtherSwitch router Node configurator"/></div></div><p class="title">Figure 7-3. EtherSwitch router Node configurator</p></div></div><div class="sect1" title="Frame Relay Switch"><div class="titlepage"><div><div><h1 class="title"><a id="frame_relay_switch"/>Frame Relay Switch</h1></div></div></div><p><a id="iddle1255" class="indexterm"/><a id="iddle1274" class="indexterm"/><a id="iddle1304" class="indexterm"/><a id="iddle1380" class="indexterm"/><a id="iddle1883" class="indexterm"/><a id="iddle1949" class="indexterm"/><a id="iddle2001" class="indexterm"/><a id="iddle2185" class="indexterm"/>GNS3 provides a simple <span class="emphasis"><em>Frame Relay switch node</em></span>, capable of emulating the basics of a generic Frame Relay switch. The nice thing about the GNS3 Frame Relay switch node is that it requires very little configuration. The downside is that it can sometimes be unstable.</p><div class="warning" title="Warning"><h3 class="title"><a id="ch07note02"/>Warning</h3><p><span class="emphasis"><em>The GNS3 Frame Relay switch node only supports the ANSI LMI type, and</em></span> Cisco <span class="emphasis"><em>is the default LMI type on Cisco IOS. You must use the command <code class="literal">frame-relay lmi-type ansi</code> on your router interfaces. Otherwise your frame cloud will not work. You can verify your LMI type using the <code class="literal">show frame-relay lmi</code> command (after configuring Frame Relay encapsulation).</em></span></p></div><p>In Frame Relay, <a class="firstterm" href="apd.html#gloss01_018"><em class="firstterm">data link connection identifiers (DLCIs)</em></a> are used to assign frames to a <a class="firstterm" href="apd.html#gloss01_049"><em class="firstterm">permanent virtual circuit (PVC)</em></a> using serial port connections. To configure DLCI to serial port mappings, right-click the Frame Relay switch icon and open the Node configurator. Use the Source and Destination fields to create a mapping and click <span class="strong"><strong>Add</strong></span>. When you’re finished, click <span class="strong"><strong>Apply</strong></span> and <span class="strong"><strong>OK</strong></span> to complete the configuration.</p><p>The example configuration in <a class="xref" href="ch07.html#frame_relay_switch_node_configurator" title="Figure 7-4. Frame Relay switch Node configurator">Figure 7-4</a> will be used later to create a simple Frame Relay network. In the Mapping panel on the right, notice that FR1 is configured using two serial ports. Each serial port is used to link the Frame Relay switch to a router in your GNS3 project.</p><div class="figure"><a id="frame_relay_switch_node_configurator"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00078"/><img src="httpatomoreillycomsourcenostarchimages2209025.png.jpg" alt="Frame Relay switch Node configurator"/></div></div><p class="title">Figure 7-4. Frame Relay switch Node configurator</p></div><p><a id="iddle1464" class="indexterm"/>Port 1 has been assigned two DLCI numbers (100 and 200). Each DLCI on port 1 is mapped to a DLCI number on another serial port, and each mapping forms a Frame Relay PVC. Mapping is read from left to right, so in the first row, port 1 DLCI 100 is mapped to port 2 DLCI 101, and in the second row, port 1 DLCI 200 is mapped to port 3 DLCI 201. We’ll use these mappings to configure a simple Frame Relay network.</p><div class="sect2" title="Simple Frame Relay Hub and Spoke Configuration"><div class="titlepage"><div><div><h2 class="title"><a id="simple_frame_relay_hub_and_spoke_configu"/>Simple Frame Relay Hub and Spoke Configuration</h2></div></div></div><p>There are several ways to configure a Frame Relay network, and understanding DLCI to serial port mapping is critical for understanding and configuring any of them. To better understand the mapping relationship, let’s configure a simple network using the previously discussed DLCI to serial port mappings. I won’t go into a lot of theory, but I’ll explain enough to get you started.</p><p>We’ll create our sample network using the topology in <a class="xref" href="ch07.html#sample_hub_and_spoke_frame_relay_network" title="Figure 7-5. Sample hub and spoke Frame Relay network">Figure 7-5</a>. The network is divided into two subnets, 10.10.10.0 and 10.10.10.32, using the subnet mask 255.255.255.224.</p><div class="figure"><a id="sample_hub_and_spoke_frame_relay_network"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00079"/><img src="httpatomoreillycomsourcenostarchimages2209027.png.jpg" alt="Sample hub and spoke Frame Relay network"/></div></div><p class="title">Figure 7-5. Sample hub and spoke Frame Relay network</p></div><p>This simple network is an example of a Frame Relay hub and spoke topology and should give you a good idea of how DLCI mappings work in a Frame Relay network. Router R2 will be on the 10.10.10.0 subnet, and router R3 will be on the 10.10.10.32 subnet. Router R1 is the hub in our hub and spoke topology. It will be connected to both subnets and will forward packets between them through the Frame Relay switch. This configuration will allow router R2 to ping router R3 and vice versa.</p><p>To create the project, add a Frame Relay switch node to your workspace and set it up the way we did in <a class="xref" href="ch07.html#frame_relay_switch_node_configurator" title="Figure 7-4. Frame Relay switch Node configurator">Figure 7-4</a>. Add three routers and configure each of them with a serial interface card such as a WIC or NM-4T. Link the routers to the FR1 switch as shown. Be sure R1 is connected to Port 1 on FR1, R2 is connected to Port 2, and R3 is connected to Port 3. After linking the devices and configuring the Port:DLCI mapping on the FR1 switch, configure the hub router R1, as shown in the following code.</p><a id="pro_id00074"/><pre class="programlisting">  R1(config)# <span class="strong"><strong>interface Serial0/0</strong></span>
➊ R1(config-if)# <span class="strong"><strong>encapsulation frame-relay</strong></span>
➋ R1(config-if)# <span class="strong"><strong>frame-relay lmi-type ansi</strong></span>
➌ R1(config-if)# <span class="strong"><strong>clock rate 64000</strong></span>
  R1(config-if)# <span class="strong"><strong>no shutdown</strong></span>
  R1(config-if)# <span class="strong"><strong>no ip address</strong></span></pre><p>On the serial interface, enable Frame Relay encapsulation ➊, and set the LMI type to ANSI ➋. Although not required for GNS3, I’ve also set the clock rate ➌ because, depending on your IOS, the command may be required on an actual Frame Relay switch.</p><p>Next, configure point-to-point interfaces and DLCIs.</p><a id="pro_id00075"/><pre class="programlisting">➊ R1(config-if)# <span class="strong"><strong>interface Serial0/0.100 point-to-point</strong></span>
➋ R1(config-subif)# <span class="strong"><strong>frame-relay interface-dlci 100</strong></span>
➌ R1(config-subif)# <span class="strong"><strong>ip address 10.10.10.1 255.255.255.224</strong></span>
➍ R1(config-subif)# <span class="strong"><strong>interface Serial0/0.200 point-to-point</strong></span>
➎ R1(config-subif)# <span class="strong"><strong>frame-relay interface-dlci 200</strong></span>
➏ R1(config-subif)# <span class="strong"><strong>ip address 10.10.10.33 255.255.255.224</strong></span></pre><p>Configure a point-to-point subinterface ➊ on serial interface <code class="literal">Serial0/0.100</code> using DLCI 100 ➋ and assign the interface an IP address from the first subnet ➌ (10.10.10.0/27).</p><p>Complete the configuration by adding a second point-to-point sub interface ➍ in the same manner, but use DLCI 200 ➎, and assign the interface an IP addresses from the second subnet ➏ (10.10.10.32/27). In this example, I’ll use the first valid address from the subnet, which is 10.10.10.33.</p><div class="note" title="Note"><h3 class="title"><a id="ch07note03"/>Note</h3><p><span class="emphasis"><em>It’s considered a Cisco best practice to use the DLCI number for your subinterface number. <code class="literal">Serial0/0.100</code> is an example of a subinterface for DLCI 100.</em></span></p></div><p>The following listing contains all of the commands you need to configure router R2.</p><a id="pro_id00076"/><pre class="programlisting">  R2(config)# <span class="strong"><strong>interface Serial0/0</strong></span>
➊ R2(config-if)# <span class="strong"><strong>encapsulation frame-relay</strong></span>
➋ R2(config-if)# <span class="strong"><strong>frame-relay lmi-type ansi</strong></span>
➌ R2(config-if)# <span class="strong"><strong>clock rate 64000</strong></span>
  R2(config-if)# <span class="strong"><strong>no shutdown</strong></span>
  R2(config-if)# <span class="strong"><strong>no ip address</strong></span>
➍ R2(config-if)# <span class="strong"><strong>interface Serial0/0.101 point-to-point</strong></span>
➎ R2(config-subif)# <span class="strong"><strong>frame-relay interface-dlci 101</strong></span>
➏ R2(config-fr-dlci)# <span class="strong"><strong>ip address 10.10.10.2 255.255.255.224</strong></span>
  R2(config-subif)# <span class="strong"><strong>exit</strong></span>
➐ R2(config)# <span class="strong"><strong>ip route 0.0.0.0 0.0.0.0 10.10.10.1</strong></span></pre><p>To configure R2, go under the serial interface and enable Frame Relay encapsulation ➊, then set the LMI type to ANSI ➋, set the clock rate ➌, and bring up the interface. Configure a point-to-point subinterface ➍ using <a id="iddle2139" class="indexterm"/>DLCI 101 ➎ and assign the subinterface an IP address from the first subnet ➏ (10.10.10.0 /27 in this example). Lastly, set the router’s default gateway using the IP address configured under interface DLCI 100 of router R1 ➐ (IP address 10.10.10.1). Because R1 is the hub of our Frame Relay hub and spoke topology, it’s used as the default gateway for our two subnets so that data can be routed between routers R2 and R3.</p><p>Finally, add a configuration to router R3 to complete the project.</p><a id="pro_id00077"/><pre class="programlisting">  R3(config)# <span class="strong"><strong>interface Serial0/0</strong></span>
  R3(config-if)# <span class="strong"><strong>encapsulation frame-relay</strong></span>
  R3(config-if)# <span class="strong"><strong>frame-relay lmi-type ansi</strong></span>
  R3(config-if)# <span class="strong"><strong>clock rate 64000</strong></span>
  R3(config-if)# <span class="strong"><strong>no shutdown</strong></span>
  R3(config-if)# <span class="strong"><strong>no ip address</strong></span>
  R3(config-if)# <span class="strong"><strong>interface Serial0/0.201 point-to-point</strong></span>
➊ R3(config-subif)# <span class="strong"><strong>frame-relay interface-dlci 201</strong></span>
➋ R3(config-fr-dlci)# <span class="strong"><strong>ip address 10.10.10.34 255.255.255.224</strong></span>
  R3(config-subif)# <span class="strong"><strong>exit</strong></span>
➌ R3(config)# <span class="strong"><strong>ip route 0.0.0.0 0.0.0.0 10.10.10.33</strong></span></pre><p>Router R3 is configured in nearly the same way as R2, but it uses DLCI 201 ➊ and an IP address ➋ from the second subnet. Also, you need to set the default gateway using the IP address configured under interface DLCI 200 of router R1 ➌ (IP address 10.10.10.33).</p><p>That’s it! All three routers should now be able to ping each other. In a nutshell, each router encapsulates data frames and identifies them with a Frame Relay DLCI number as they leave their serial interfaces. When the Frame Relay switch receives data from a router, the data frames are forwarded to other routers through the switch based on the DLCI to serial port mapping. Because R1 is configured as a Frame Relay hub and knows about both subnets, it can forward data between the two subnets using the two PVCs. In this example, one PVC is made up of DLCI 100 mapped to DLCI 101, and the other is made up of DLCI 200 mapped to DLCI 201.</p><p>To verify that your Frame Relay circuit is active, enter the command <code class="literal">show frame-relay pvc</code> on each of your routers.</p><a id="pro_id00078"/><pre class="programlisting">R1# <span class="strong"><strong>show frame-relay pvc</strong></span>

PVC Statistics for interface Serial0/0 (Frame Relay DTE)

             Active      Inactive      Deleted       Static
Local         ➊ 2             0            0            0
Switched        0             0            0            0
Unused          0             0            0            0</pre><p>If you’ve set everything up correctly, your PVCs should be displayed under <code class="literal">Active</code> ➊.</p></div><div class="sect2" title="Creating a Frame Relay Switch Using IOS"><div class="titlepage"><div><div><h2 class="title"><a id="creating_a_frame_relay_switch_using_ios"/>Creating a Frame Relay Switch Using IOS</h2></div></div></div><p><a id="iddle1179" class="indexterm"/><a id="iddle1256" class="indexterm"/><a id="iddle1305" class="indexterm"/><a id="iddle1346" class="indexterm"/><a id="iddle1381" class="indexterm"/><a id="iddle1382" class="indexterm"/><a id="iddle1383" class="indexterm"/><a id="iddle1588" class="indexterm"/>As handy as the Frame Relay switch node is, sometimes you might need to create your own Frame Relay switch using an IOS router. Maybe you want to use a different LMI type (like Cisco or q933a), or perhaps your studies require knowing the details of an actual Cisco Frame Relay switch. In any case, an IOS switch is fairly easy to set up.</p><p>The following listing creates an IOS Frame Relay switch using DLCI mappings identical to the GNS3 Frame Relay switch node you configured earlier. It may look intimidating at first glance, but it’s not; you just need to understand how Frame Relay <code class="literal">connect</code> commands are used to configure the DLCI to serial port mappings.</p><a id="pro_id00079"/><pre class="programlisting">➊ FRSW(config)# <span class="strong"><strong>frame-relay switching</strong></span>
  FRSW(config)# <span class="strong"><strong>interface Serial0/0</strong></span>
  FRSW(config-if)# <span class="strong"><strong>description Serial connection to Router R1 (Hub)</strong></span>
  FRSW(config-if)# <span class="strong"><strong>no shutdown</strong></span>
  FRSW(config-if)# <span class="strong"><strong>no ip address</strong></span>
➋ FRSW(config-if)# <span class="strong"><strong>encapsulation frame-relay</strong></span>
➌ FRSW(config-if)# <span class="strong"><strong>clock rate 64000</strong></span>
➍ FRSW(config-if)# <span class="strong"><strong>frame-relay lmi-type ansi</strong></span>
➎ FRSW(config-if)# <span class="strong"><strong>frame-relay intf-type dce</strong></span>
  FRSW(config-if)# <span class="strong"><strong>interface Serial0/1</strong></span>
  FRSW(config-if)# <span class="strong"><strong>description Serial connection to Router R2 (Spoke)</strong></span>
  FRSW(config-if)# <span class="strong"><strong>no shutdown</strong></span>
  FRSW(config-if)# <span class="strong"><strong>no ip address</strong></span>
  FRSW(config-if)# <span class="strong"><strong>encapsulation frame-relay</strong></span>
  FRSW(config-if)# <span class="strong"><strong>clock rate 64000</strong></span>
  FRSW(config-if)# <span class="strong"><strong>frame-relay lmi-type ansi</strong></span>
  FRSW(config-if)# <span class="strong"><strong>frame-relay intf-type dce</strong></span>
  FRSW(config-if)# <span class="strong"><strong>interface Serial0/2</strong></span>
  FRSW(config-if)# <span class="strong"><strong>description Serial connection to Router R3 (Spoke)</strong></span>
  FRSW(config-if)# <span class="strong"><strong>no shutdown</strong></span>
  FRSW(config-if)# <span class="strong"><strong>no ip address</strong></span>
  FRSW(config-if)# <span class="strong"><strong>encapsulation frame-relay</strong></span>
  FRSW(config-if)# <span class="strong"><strong>clock rate 64000</strong></span>
  FRSW(config-if)# <span class="strong"><strong>frame-relay lmi-type ansi</strong></span>
  FRSW(config-if)# <span class="strong"><strong>frame-relay intf-type dce</strong></span>
  FRSW(config-if)# <span class="strong"><strong>exit</strong></span>
➏ FRSW(config)# <span class="strong"><strong>connect PVC1 Serial0/0 100 Serial0/1 101</strong></span>
➐ FRSW(config)# <span class="strong"><strong>connect PVC2 Serial0/0 200 Serial0/2 201</strong></span></pre><p>When configuring a Frame Relay switch, you must first enable Frame Relay switching with the <code class="literal">frame-relay switching</code> command ➊. You’ll also configure Frame Relay encapsulation on each serial interface with the <code class="literal">encapsulation frame-relay</code> command ➋. Then, use the <code class="literal">clock rate</code> command ➌ to set up clocking, choose an LMI type with <code class="literal">frame-relay lmi-type</code> ➍, and set the interface type to DCE using the <code class="literal">frame-relay intf-type dce</code> command ➎. After bringing up the interfaces, you’re ready to define your PVCs.</p><div class="note" title="Note"><h3 class="title"><a id="ch07note04"/>Note</h3><p><span class="emphasis"><em>On some IOS versions, the <code class="literal">clock rate</code> command may need to be entered as <code class="literal">clockrate</code>.</em></span></p></div><p><a id="iddle1055" class="indexterm"/><a id="iddle1267" class="indexterm"/><a id="iddle1950" class="indexterm"/><a id="iddle2002" class="indexterm"/><a id="iddle2179" class="indexterm"/>DLCI to port mapping is configured using <code class="literal">connect</code> <span class="emphasis"><em><code class="literal">connection-name interface dlci interface dlci</code></em></span> commands. The last two commands in this configuration define a connection mapping between two Frame Relay PVCs. The command <code class="literal">connect PVC1 Serial0/0 100 Serial0/1 101</code> ➏ defines a PVC between routers R1 and R2 and is used for creating our first subnet. The source interface is Serial0/0 and the source DCLI is 100. The PVC is completed using interface Serial0/1, and DLCI 101 configured on router R2.</p><p>The command <code class="literal">connect PVC2 Serial0/0 200 Serial0/2 201</code> ➐ uses the same syntax to create a second PVC between routers R1 and R3 (used for the second subnet).</p><p>That’s all there is to creating your own Frame Relay switch. When configuring a Frame Relay switch with Cisco IOS, the LMI type can be set to <code class="literal">cisco</code>, <code class="literal">ansi</code>, or <code class="literal">q933a</code>, but you must be consistent on all routers participating in the Frame Relay network.</p></div></div><div class="sect1" title="ATM Switch"><div class="titlepage"><div><div><h1 class="title"><a id="atm_switch"/>ATM Switch</h1></div></div></div><p>GNS3 provides an easy way to configure an <a class="firstterm" href="apd.html#gloss01_007"><em class="firstterm">Asynchronous Transfer Mode (ATM)</em></a> switch. ATM is similar to Frame Relay in that it’s a layer 2 protocol that maps physical ports to logical circuits.</p><p>To configure a VPI/VCI to port mapping, right-click the ATM switch icon and select <span class="strong"><strong>Configure</strong></span>, as shown in <a class="xref" href="ch07.html#node_configurator-id00016" title="Figure 7-6. Node configurator">Figure 7-6</a>. Here, I’ve configured a simple virtual circuit using two ports on the ATM1 switch node.</p><div class="figure"><a id="node_configurator-id00016"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00080"/><img src="httpatomoreillycomsourcenostarchimages2209029.png.jpg" alt="Node configurator"/></div></div><p class="title">Figure 7-6. Node configurator</p></div><p><a id="iddle1966" class="indexterm"/><a id="iddle2133" class="indexterm"/>Use the Source and Destination fields to create your port mapping, and then click <span class="strong"><strong>Add</strong></span>. When you’re finished with all the port mapping, click <span class="strong"><strong>Apply</strong></span> and <span class="strong"><strong>OK</strong></span> to complete the configuration.</p><p>Now let’s run through a quick example of creating a simple point-to-point WAN connection using an ATM switch. Start by creating the topology shown in <a class="xref" href="ch07.html#sample_atm_network" title="Figure 7-7. Sample ATM network">Figure 7-7</a>.</p><div class="figure"><a id="sample_atm_network"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00081"/><img src="httpatomoreillycomsourcenostarchimages2209031.png.jpg" alt="Sample ATM network"/></div></div><p class="title">Figure 7-7. Sample ATM network</p></div><p>Add an ATM switch to your workspace and configure it using the information from <a class="xref" href="ch07.html#node_configurator-id00016" title="Figure 7-6. Node configurator">Figure 7-6</a>. Next, add two routers and create a link between each router and the switch. You need to use <span class="emphasis"><em>7200 series routers</em></span> that are each configured with an <span class="emphasis"><em>ATM port adapter</em></span> (PA-A1) in slot 1. Create a link from <span class="emphasis"><em>a1/0</em></span> on each router to the ATM switch, as shown in <a class="xref" href="ch07.html#sample_atm_network" title="Figure 7-7. Sample ATM network">Figure 7-7</a>, and then enter the following commands to configure ATM on router R1.</p><a id="pro_id00080"/><pre class="programlisting">R1(config)# <span class="strong"><strong>interface ATM1/0</strong></span>
R1(config)# <span class="strong"><strong>no shutdown</strong></span>
R1(config)# <span class="strong"><strong>interface ATM1/0.100 point-to-point</strong></span>
R1(config-subif)# <span class="strong"><strong>ip address 10.10.10.1 255.255.255.252</strong></span>
R1(config-subif)# <span class="strong"><strong>pvc 25/100</strong></span>
R1(config-if-atm-vc)# <span class="strong"><strong>protocol ip 10.10.10.2 broadcast</strong></span>
R1(config-if-atm-vc)# <span class="strong"><strong>encapsulation aal5snap</strong></span></pre><p>Next, apply a similar configuration to router R2.</p><a id="pro_id00081"/><pre class="programlisting">R2(config)# <span class="strong"><strong>interface ATM1/0</strong></span>
R2(config)# <span class="strong"><strong>no shutdown</strong></span>
R2(config)# <span class="strong"><strong>interface ATM1/0.200 point-to-point</strong></span>
R2(config-subif)# <span class="strong"><strong>ip address 10.10.10.2 255.255.255.252</strong></span>
R2(config-subif)# <span class="strong"><strong>pvc 25/200</strong></span>
R2(config-if-atm-vc)# <span class="strong"><strong>protocol ip 10.10.10.1 broadcast</strong></span>
R2(config-if-atm-vc)# <span class="strong"><strong>encapsulation aal5snap</strong></span></pre><p>To verify that your ATM circuit is up, enter the <code class="literal">show atm pvc</code> command.</p><a id="pro_id00082"/><pre class="programlisting">R1# <span class="strong"><strong>show atm pvc</strong></span></pre><p>If the PVC status displays <code class="literal">UP</code>, then the two routers should now be able to ping each other.</p></div><div class="sect1" title="Cloud Nodes"><div class="titlepage"><div><div><h1 class="title"><a id="cloud_nodes"/>Cloud Nodes</h1></div></div></div><p><a id="iddle1187" class="indexterm"/><a id="iddle1269" class="indexterm"/><a id="iddle1846" class="indexterm"/><a id="iddle1864" class="indexterm"/><a id="iddle1877" class="indexterm"/><a id="iddle2279" class="indexterm"/>The Cloud node is a highly configurable device node that doesn’t simulate a particular piece of hardware. Instead, it provides a wide range of <a class="firstterm" href="apd.html#gloss01_042"><em class="firstterm">Network Input/Output (NIO)</em></a> connection options that allow GNS3 virtual devices to communicate with other programs or real hardware, like your PC’s Ethernet adapter.</p><p>You connect to a Cloud node by creating a standard link from a GNS3 device (like a router) to the Cloud. Once this is done, any data leaving a virtual interface passes through the Cloud node’s NIO connection to a destination outside GNS3, like a physical Ethernet adapter. Keep in mind that throughput limitations presented in GNS3 also apply to the virtual interface connected to the Cloud mode, meaning those limitations will affect your overall performance.</p><p>To configure an NIO connection (shown in <a class="xref" href="ch07.html#cloud_node_configurator" title="Figure 7-8. Cloud Node configurator">Figure 7-8</a>), right-click the Cloud icon and select <span class="strong"><strong>Configure</strong></span>.</p><div class="figure"><a id="cloud_node_configurator"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00082"/><img src="httpatomoreillycomsourcenostarchimages2209033.png.jpg" alt="Cloud Node configurator"/></div></div><p class="title">Figure 7-8. Cloud Node configurator</p></div><p>The Node configurator provides six connection options:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p title="NIO Ethernet"><span class="title"><strong><span class="strong"><strong>NIO Ethernet</strong></span></strong></span>. Creates a connection to one or more physical or logical interfaces in your PC. The NIO Ethernet configuration lets you set up both a generic NIO and a Linux-only NIO.</p></li><li class="listitem"><p title="NIO UDP"><span class="title"><strong><span class="strong"><strong>NIO UDP</strong></span></strong></span>. Creates a UDP socket in order to form a link between GNS3 and other programs.</p></li><li class="listitem"><p title="NIO TAP"><span class="title"><strong><span class="strong"><strong>NIO TAP</strong></span></strong></span>. <a id="iddle1271" class="indexterm"/><a id="iddle1279" class="indexterm"/><a id="iddle1325" class="indexterm"/><a id="iddle1747" class="indexterm"/><a id="iddle1893" class="indexterm"/><a id="iddle1914" class="indexterm"/><a id="iddle1945" class="indexterm"/><a id="iddle1953" class="indexterm"/><a id="iddle1954" class="indexterm"/><a id="iddle2202" class="indexterm"/><a id="iddle2282" class="indexterm"/><a id="iddle2318" class="indexterm"/>Creates a connection to a virtual TAP interface. TAP interfaces are often bridged to physical interfaces in your PC.</p></li><li class="listitem"><p title="NIO UNIX"><span class="title"><strong><span class="strong"><strong>NIO UNIX</strong></span></strong></span>. Creates a UNIX Socket connection between GNS3 and some other application.</p></li><li class="listitem"><p title="NIO VDE"><span class="title"><strong><span class="strong"><strong>NIO VDE</strong></span></strong></span>. Creates a link between GNS3 and a Virtual Distributed Ethernet device.</p></li><li class="listitem"><p title="NIO NULL"><span class="title"><strong><span class="strong"><strong>NIO NULL</strong></span></strong></span>. Creates a link between GNS3 and a NULL device to form a dummy link.</p></li><li class="listitem"><p title="Misc."><span class="title"><strong><span class="strong"><strong>Misc.</strong></span></strong></span> Allows you to rename a Cloud node.</p></li></ul></div><p>To configure a connection, select the NIO connection type, choose the options you want, and select <span class="strong"><strong>Add</strong></span>. You can configure more than one connection per Cloud node, allowing you to link multiple GNS3 devices, just as you can use multiple interfaces on a GNS3 switch or router.</p><p>On Linux systems, you may want to use a generic NIO connection, which may work more reliably than a Linux-specific NIO. One reason is that the Linux-specific NIO may strip incoming VLAN tags. If you’re having difficulty with a connection on Linux, try both to see which works better.</p></div><div class="sect1" title="Connecting GNS3 Devices to Physical Hardware"><div class="titlepage"><div><div><h1 class="title"><a id="connecting_gns3_devices_to_physical_hard"/>Connecting GNS3 Devices to Physical Hardware</h1></div></div></div><p>The ability to connect projects to physical hardware is what transforms GNS3 from a diamond in the rough to the Great Star of Africa. Using the Cloud node, you can establish trunk links with live Cisco switches and even access the Internet from your GNS3 devices. This gives GNS3 nearly limitless networking possibilities. Connecting GNS3 to real devices is easier on some systems than others, but it should work on all major operating systems.</p><div class="sect2" title="Dynamips Permissions"><div class="titlepage"><div><div><h2 class="title"><a id="dynamips_permissions"/>Dynamips Permissions</h2></div></div></div><p>Before connecting GNS3 devices to a physical Ethernet adapter, you may need to make a few changes on your PC. If your Cloud node is configured using NIO Ethernet on a Windows system, you should run GNS3 using administrator privileges by right-clicking the GNS3 icon and selecting <span class="strong"><strong>Run as Administrator</strong></span>. To make this option permanent, right-click the GNS3 icon and choose <span class="strong"><strong>Properties</strong></span>. Select the Compatibility tab and place a check next to <span class="strong"><strong>Run this program as an administrator</strong></span>.</p><p>On Unix-based systems, you need to elevate the permissions of Dynamips before using NIO Ethernet or NIO TAP connections. If you skip this step, you’ll have to run GNS3 using the root account. Otherwise, NIO connections will fail and GNS3 will display an error message in the GNS3 Console window.</p><p>To set the correct Dynamips permissions on OS X, use the following commands:</p><a id="pro_id00083"/><pre class="programlisting">$ <span class="strong"><strong>sudo chown root /Applications/GNS3.app/Contents/Resources/dynamips*</strong></span>
$ <span class="strong"><strong>sudo chmod 4755 /Applications/GNS3.app/Contents/Resources/dynamips*</strong></span></pre><p><a id="iddle1076" class="indexterm"/><a id="iddle1077" class="indexterm"/><a id="iddle1352" class="indexterm"/><a id="iddle1735" class="indexterm"/><a id="iddle1767" class="indexterm"/><a id="iddle1794" class="indexterm"/><a id="iddle1814" class="indexterm"/><a id="iddle2129" class="indexterm"/><a id="iddle2320" class="indexterm"/>Setting permissions on most Linux distributions works the same way; just replace the file path with the correct location for your <code class="literal">dynamips</code> file, as shown in the following code. If you’re running a Debian-based Linux system like Ubuntu, use the <code class="literal">setcap</code> command instead because it’s more secure.</p><a id="pro_id00084"/><pre class="programlisting">$ <span class="strong"><strong>sudo apt-get install libcap2</strong></span>
$ <span class="strong"><strong>sudo setcap cap_net_raw,cap_net_admin+eip /usr/local/bin/dynamips*</strong></span></pre><p>After changing the Dynamips permissions, you can run GNS3 as a regular user, but Dynamips will be treated as though it’s being run by the root account.</p></div><div class="sect2" title="Preparing Your PC for a Bridge"><div class="titlepage"><div><div><h2 class="title"><a id="preparing_your_pc_for_a_bridge"/>Preparing Your PC for a Bridge</h2></div></div></div><p>Some operating systems don’t allow GNS3 to communicate directly with your PC’s Ethernet hardware, and Wi-Fi adapters usually don’t work, either. Before using GNS3 with an Ethernet adapter on those systems, you might need to install additional software to make it work.</p><p>A common solution is to install a virtual interface driver and use a bridge to associate it with your PC’s physical Ethernet adapter. GNS3 then passes network data to the virtual interface, which hands it off to the physical Ethernet interface via the bridge. On Unix-based systems, virtual interfaces are often provided using TUN/TAP drivers. On Windows, you’ll use a loopback adapter that’s bridged to your physical Ethernet adapter.</p><p>Even if your PC’s Ethernet hardware works directly with GNS3, the following methods are recommended and predictable ways to connect GNS3 to the outside world.</p></div><div class="sect2" title="Using a Loopback Adapter on Windows"><div class="titlepage"><div><div><h2 class="title"><a id="using_a_loopback_adapter_on_windows"/>Using a Loopback Adapter on Windows</h2></div></div></div><p>In Windows, a <span class="emphasis"><em>loopback adapter driver</em></span> provides a virtual network interface that can be bridged to a physical Ethernet adapter in your PC. To add a loopback adapter to Windows, go to <span class="strong"><strong>Control Panel</strong></span> ▸ <span class="strong"><strong>Device Manager</strong></span>. Right-click your computer name from the list, and select <span class="strong"><strong>Add legacy hardware</strong></span>. Click <span class="strong"><strong>Next</strong></span>, select <span class="strong"><strong>Install the hardware that I manually select from a list (Advanced)</strong></span>, and click <span class="strong"><strong>Next</strong></span> again. Choose <span class="strong"><strong>Network Adapters</strong></span> from the list and click <span class="strong"><strong>Next</strong></span>. From the Add Hardware wizard, shown in <a class="xref" href="ch07.html#selecting_the_microsoft_loopback_adapter" title="Figure 7-9. Selecting the Microsoft Loopback Adapter">Figure 7-9</a>, select <span class="strong"><strong>Microsoft</strong></span> under Manufacturer, and then scroll down and select the Network Adapter named <span class="strong"><strong>Microsoft Loopback Adapter</strong></span>. Click <span class="strong"><strong>Next</strong></span> and <span class="strong"><strong>Finish</strong></span> to complete the installation. You must reboot Windows after installing the Microsoft Loopback Adapter.</p><p>The Microsoft loopback adapter can also be installed by running the <code class="literal">loopback-manager.cmd</code> command from your GNS3 installation directory.</p><p>To create a bridge between the loopback adapter and Ethernet adapter, go to <span class="strong"><strong>Control Panel</strong></span> ▸ <span class="strong"><strong>Network and Sharing Center</strong></span> and choose <span class="strong"><strong>Change Adapter Settings</strong></span>. Select the two adapters and right-click to bring up the menu shown in <a class="xref" href="ch07.html#creating_a_bridge_using_a_microsoft_loop" title="Figure 7-10. Creating a bridge using a Microsoft Loopback Adapter and an Ethernet adapter">Figure 7-10</a>. Select <span class="strong"><strong>Bridge connections</strong></span> to create the bridge interface between the two adapters. When you’re finished, restart Windows to allow the changes to take effect.</p><div class="figure"><a id="selecting_the_microsoft_loopback_adapter"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00083"/><img src="httpatomoreillycomsourcenostarchimages2209035.png.jpg" alt="Selecting the Microsoft Loopback Adapter"/></div></div><p class="title">Figure 7-9. Selecting the Microsoft Loopback Adapter</p></div><div class="figure"><a id="creating_a_bridge_using_a_microsoft_loop"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00084"/><img src="httpatomoreillycomsourcenostarchimages2209037.png.jpg" alt="Creating a bridge using a Microsoft Loopback Adapter and an Ethernet adapter"/></div></div><p class="title">Figure 7-10. Creating a bridge using a Microsoft Loopback Adapter and an Ethernet adapter</p></div><p><a id="iddle1185" class="indexterm"/>To allow GNS3 to use your physical Ethernet adapter on a Windows system, you’ll need to configure a Cloud node with the loopback adapter (see <a class="xref" href="ch07.html#connecting_gns3_devices_to_physical_hard" title="Connecting GNS3 Devices to Physical Hardware">Connecting GNS3 Devices to Physical Hardware</a>). It’s a good idea to rename your loopback adapter, so it can be clearly identified within GNS3. In this example, I recommend changing <span class="emphasis"><em>Local Area Connection 2</em></span> to <span class="emphasis"><em>Loopback</em></span>.</p></div><div class="sect2" title="TUN/TAP Drivers on OS X"><div class="titlepage"><div><div><h2 class="title"><a id="tunsolidustap_drivers_on_os_x"/>TUN/TAP Drivers on OS X</h2></div></div></div><p><a id="iddle1488" class="indexterm"/><a id="iddle1536" class="indexterm"/><a id="iddle1827" class="indexterm"/><a id="iddle1918" class="indexterm"/><a id="iddle2203" class="indexterm"/><a id="iddle2260" class="indexterm"/><a id="iddle2321" class="indexterm"/>If you’re using OS X, you need to install a virtual interface driver before GNS3 can access a physical Ethernet Interface. To install TUN/TAP drivers on OS X, download the driver software for your version of OS X from SourceForge (<span class="emphasis"><em><a class="ulink" href="http://tuntaposx.sourceforge.net/">http://tuntaposx.sourceforge.net/</a></em></span>), run the installer, and follow the instructions.</p><p>The drivers should be installed under <span class="emphasis"><em>/Library/Extensions</em></span> and should load automatically when you restart your system. To manually load the driver, change to the <span class="emphasis"><em>/Library/Extensions</em></span> directory and enter the following:</p><a id="pro_id00085"/><pre class="programlisting">$ <span class="strong"><strong>sudo kextload tap.kext</strong></span></pre><p>Before launching GNS3, enter the following command to set permissions on your TAP interfaces. You’ll have to enter the command each time you reboot your Mac.</p><a id="pro_id00086"/><pre class="programlisting">$ <span class="strong"><strong>sudo chown $(id -un):$(id -gn) /dev/tap*</strong></span></pre><p>To activate a TAP interface and bridge it to a physical Ethernet port in your PC, you must enter the following commands <span class="emphasis"><em>after</em></span> you add a Cloud and attach a router to the nio_tap interface, configured using <span class="emphasis"><em>/dev/tap0</em></span>. If you enter the commands beforehand, they will fail and your bridge won’t work. You will have to enter these commands every time you load a project that includes a cloud node.</p><a id="pro_id00087"/><pre class="programlisting">$ <span class="strong"><strong>sudo ifconfig bridge0 create</strong></span>
$ <span class="strong"><strong>sudo ifconfig bridge0 addm en0</strong></span>
$ <span class="strong"><strong>sudo ifconfig bridge0 addm tap0 up</strong></span></pre><p>After entering the commands from a terminal, OS X should bridge the tap0 interface to the physical Ethernet interface in your Mac, which is en0 in this example. You should use the <code class="literal">ifconfig</code> command to verify the name of your Mac’s Ethernet interface and then replace en0 with that name.</p><div class="note" title="Note"><h3 class="title"><a id="ch07note05"/>Note</h3><p><span class="emphasis"><em>If you change the maximum transmission unit (MTU) size of an interface, you may see the error “ifconfig: BRDGADD tap0: Invalid argument” when you go to create the bridge. In this case, you need to make sure that the MTU size of your physical interface matches the MTU size of the TAP interface.</em></span></p></div><p>I recommend adding an annotation to your project that includes these commands as a reminder to create the bridge when you open a project. Then, after opening the project you can copy the annotation and paste it into a terminal window to save time. Don’t forget to enter those commands <span class="emphasis"><em>every time you open a project</em></span> that bridges Ethernet to a TAP interface, or it won’t work.</p></div><div class="sect2" title="TUN/TAP Drivers on Ubuntu Linux"><div class="titlepage"><div><div><h2 class="title"><a id="tunsolidustap_drivers_on_ubuntu_linux"/>TUN/TAP Drivers on Ubuntu Linux</h2></div></div></div><p><a id="iddle1005" class="indexterm"/><a id="iddle1360" class="indexterm"/><a id="iddle1365" class="indexterm"/><a id="iddle1537" class="indexterm"/><a id="iddle1751" class="indexterm"/><a id="iddle1757" class="indexterm"/><a id="iddle1759" class="indexterm"/><a id="iddle2184" class="indexterm"/><a id="iddle2275" class="indexterm"/>On Linux, you should be able to connect a Cloud node directly to your Ethernet interface using the NIO Ethernet tab under the Cloud configurator, but if you find that you need TUN/TAP drivers for Ubuntu, update your package manager and enter the following command to install the package.</p><a id="pro_id00088"/><pre class="programlisting">$ <span class="strong"><strong>sudo apt-get install uml-utilities</strong></span></pre><p>If you’re running some other version of Linux, you may have to install a different package, but this package should work on most Debian-based distributions.</p></div></div><div class="sect1" title="Connecting to Live Switches"><div class="titlepage"><div><div><h1 class="title"><a id="connecting_to_live_switches"/>Connecting to Live Switches</h1></div></div></div><p>GNS3 is great software, but it has some limitations. For example, the NM-16ESW switch module doesn’t include all the advanced features of an actual layer 2 or layer 3 switch. If you want to work with advanced switching, you have to use additional software like Cisco IOU or use physical Cisco switches. If you’re creating CCNA labs, then one live Cisco switch might be enough, but if you’re creating CCNP or CCIE labs, you’ll probably use multiple live switches. Often the goal is to have a GNS3 router connected to each external switch. This is tricky because most PCs have only one Ethernet adapter. Fortunately, GNS3 and IOS have this sorted out. Your options are to trunk VLANs to the switch over a single Ethernet adapter in your PC or to install multiple Ethernet adapters in your PC.</p><p>In this section, I’ll cover two ways to connect GNS3 devices to live Cisco switches.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p title="Standard 802.1Q Trunk"><span class="title"><strong><span class="strong"><strong>Standard 802.1Q Trunk</strong></span></strong></span>. This method uses a standard 802.1Q trunk to allow GNS3 devices to communicate with a live Cisco switch via your PC’s Ethernet adapter.</p></li><li class="listitem"><p title="Breakout Switch"><span class="title"><strong><span class="strong"><strong>Breakout Switch</strong></span></strong></span>. This method uses a specially configured Ethernet switch called a breakout switch to allow GNS3 devices to connect to multiple live switches using only a single Ethernet adapter in your PC. To create a breakout switch, you must have a second physical Ethernet switch on hand to use as the breakout switch.</p></li></ul></div><p>The option you choose depends on how many switches you own, your PC’s operating system, and what Ethernet adapters are already installed in your PC. Let’s start by looking at how an 802.1Q trunk works to reach a Cisco switch.</p><div class="sect2" title="Configuring a Standard 802.1Q Trunk"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_a_standard_802dot1q_trunk"/>Configuring a Standard 802.1Q Trunk</h2></div></div></div><p>In my opinion, an 802.1Q trunk is the best way to attach live switches to your GNS3 projects. The advantages of a standard 802.1Q trunk are that it is easy to set up and works the same as connecting a switch to a physical network. The disadvantage is that your PC operating system or your PC’s <a id="iddle1183" class="indexterm"/><a id="iddle2197" class="indexterm"/><a id="iddle2377" class="indexterm"/>Ethernet drivers might not support it. Often they strip the 802.1Q tags from packets coming from the switch into your PC. Without the proper tags, GNS3 has no way of knowing which VLANs your packets belong to and in turn doesn’t know where to forward the packets, which breaks your network.</p><p>If you poke around the Internet, you’ll find all sorts of creative solutions that people have come up with to circumvent this problem, but they are generally platform-specific and vary from machine to machine.</p><div class="note" title="Note"><h3 class="title"><a id="ch07note06"/>Note</h3><p><span class="emphasis"><em>One way to prevent tag stripping on OS X and Linux is to use a USB Ethernet adapter that supports 802.1Q tagging and jumbo frames. One such adapter that works well is the StartTech USB31000SW adapter, but any adapter that uses the ASIX AX88772A chipset should work.</em></span></p></div><p>In this example, you’ll place either an EtherSwitch router or Ethernet switch node in your workspace and configure it with the 802.1Q trunking protocol. Next, you’ll add a Cloud node to your workspace and configure it using an NIO interface, and link it to the GNS3 switch. The Cloud node can either be directly connected, or bridged, to your PC’s Ethernet adapter (depending on your OS). You’ll then plug an Ethernet cable from your PC’s Ethernet adapter into a port on the live Cisco switch. The switch port you choose also needs to be configured with 802.1Q trunking. After both the GNS3 switch and physical switch have been configured, you should be able to route GNS3-generated VLAN packets through the trunk to the live switch.</p><p>In this section, we’ll create a simple project that connects our GNS3 network to a live c3550 switch using two VLANs (10 and 20). Begin by creating the topology shown in <a class="xref" href="ch07.html#sample_topology_using_a_standard_dot1q_t" title="Figure 7-11. Sample topology using a standard dot1q trunk to live switch">Figure 7-11</a>. When configuring the Cloud node, choose your PC’s Ethernet adapter name, found under the NIO Ethernet tab.</p><div class="figure"><a id="sample_topology_using_a_standard_dot1q_t"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00085"/><img src="httpatomoreillycomsourcenostarchimages2209039.png.jpg" alt="Sample topology using a standard dot1q trunk to live switch"/></div></div><p class="title">Figure 7-11. Sample topology using a standard dot1q trunk to live switch</p></div><p>To configure VLANs and an 802.1Q trunk using the <span class="emphasis"><em>EtherSwitch router</em></span>, open a console on ESW1 and enter the following commands:</p><a id="pro_id00089"/><pre class="programlisting">  ESW1# <span class="strong"><strong>vlan database</strong></span>
➊ ESW1(vlan)# <span class="strong"><strong>vlan 10</strong></span>
➋ ESW1(vlan)# <span class="strong"><strong>vlan 20</strong></span>
  ESW1(vlan)# <span class="strong"><strong>apply</strong></span>
  ESW1(vlan)# <span class="strong"><strong>exit</strong></span>
  ESW1# <span class="strong"><strong>configure terminal</strong></span>
  ESW1(config)# <span class="strong"><strong>int f1/15</strong></span>
➌ ESW1(config-if)# <span class="strong"><strong>switchport mode trunk</strong></span>
➍ ESW1(config-if)# <span class="strong"><strong>switchport trunk encapsulation dot1q</strong></span>
  ESW1(config-if)# <span class="strong"><strong>int f1/0</strong></span>
  ESW1(config-if)# <span class="strong"><strong>switchport mode access</strong></span>
➎ ESW1(config-if)# <span class="strong"><strong>switchport access vlan 10</strong></span>
  ESW1(config-if)# <span class="strong"><strong>int f1/1</strong></span>
  ESW1(config-if)# <span class="strong"><strong>switchport mode access</strong></span>
➏ ESW1(config-if)# <span class="strong"><strong>switchport access vlan 20</strong></span></pre><p><a id="iddle2376" class="indexterm"/>The previous commands create VLAN 10 ➊ and 20 ➋ on the switch, configure a trunk port ➌ using the dot1q protocol ➍, and assign access ports to VLAN 10 ➎ (for router R2) and VLAN 20 ➏ (for router R3).</p><p>If instead you choose to use an Ethernet switch node, configure one port as an 802.1Q trunk and the others as VLAN access ports, as shown in <a class="xref" href="ch07.html#ethernet_switch_node_configured_with_a_d" title="Figure 7-12. Ethernet switch node configured with a dot1q trunk port">Figure 7-12</a>.</p><div class="figure"><a id="ethernet_switch_node_configured_with_a_d"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00086"/><img src="httpatomoreillycomsourcenostarchimages2209041.png.jpg" alt="Ethernet switch node configured with a dot1q trunk port"/></div></div><p class="title">Figure 7-12. Ethernet switch node configured with a dot1q trunk port</p></div><p>Ports 1 and 2 are configured as access ports using VLAN 10 ➊ and 20 ➋, and port 3 is the dot1q trunk port ➌ that’s connected to the Cloud node.</p><p>Next, log on to your live Cisco switch and create the same VLANs. Then, configure the 802.1Q trunk port and cable it to your PC’s Ethernet adapter. The following listing is an example of how to configure a c3550 switch, using commands you’ve seen throughout the chapter.</p><a id="pro_id00090"/><pre class="programlisting">c3550# <span class="strong"><strong>configure-terminal</strong></span>
c3550(config)# <span class="strong"><strong>ip routing</strong></span>
c3550(config)# <span class="strong"><strong>interface vlan 10</strong></span>
c3550(config-vlan)# <span class="strong"><strong>ip address 10.1.1.1</strong></span>
c3550(config-vlan)# <span class="strong"><strong>interface vlan 20</strong></span>
c3550(config-vlan)# <span class="strong"><strong>ip address 20.1.1.1</strong></span>
c3550(config-vlan)# <span class="strong"><strong>exit</strong></span>
c3550(config)# <span class="strong"><strong>Interface f0/1</strong></span>
c3550(config-if)# <span class="strong"><strong>switchport trunk encapsulation dot1q</strong></span>
c3550(config-if)# <span class="strong"><strong>switch port mode trunk</strong></span>
c3550(config-if)# <span class="strong"><strong>switchport trunk allowed vlan all</strong></span>
c3550(config-if)# <span class="strong"><strong>speed 100</strong></span>
c3550(config-if)# <span class="strong"><strong>duplex full</strong></span></pre><p><a id="iddle1072" class="indexterm"/><a id="iddle1266" class="indexterm"/><a id="iddle1725" class="indexterm"/><a id="iddle1755" class="indexterm"/><a id="iddle2178" class="indexterm"/><a id="iddle2325" class="indexterm"/><a id="iddle2375" class="indexterm"/>To complete the project, configure routers R2 and R3. Log on to router R2 and configure an IP address and default gateway for VLAN 10.</p><a id="pro_id00091"/><pre class="programlisting">R2(config)# <span class="strong"><strong>interface f0/0</strong></span>
R2(config-if)# <span class="strong"><strong>description Using VLAN 10</strong></span>
R2(config-if)# <span class="strong"><strong>ip address 10.1.1.2 255.255.255.0</strong></span>
R2(config-if)# <span class="strong"><strong>no shutdown</strong></span>
R2(config-if)# <span class="strong"><strong>exit</strong></span>
R2(config)# <span class="strong"><strong>ip route 0.0.0.0 0.0.0.0 10.1.1.1</strong></span></pre><p>Now, log on to router R3 and configure an IP address and default gateway for VLAN 20.</p><a id="pro_id00092"/><pre class="programlisting">R3(config)# <span class="strong"><strong>interface f0/0</strong></span>
R3(config-if)# <span class="strong"><strong>description Using VLAN 20</strong></span>
R3(config-if)# <span class="strong"><strong>ip address 20.1.1.2 255.255.255.0</strong></span>
R3(config-if)# <span class="strong"><strong>no shutdown</strong></span>
R3(config-if)# <span class="strong"><strong>exit</strong></span>
R3(config)# <span class="strong"><strong>ip route 0.0.0.0 0.0.0.0 20.1.1.1</strong></span></pre><p>Test VLAN routing through the switch by entering a <code class="literal">ping</code> command from one VLAN to another.</p><a id="pro_id00093"/><pre class="programlisting">R3# <span class="strong"><strong>ping 10.1.1.2</strong></span>
!!!!!</pre><p>When you’re finished with the project, you can further verify the configuration using tools like CDP or Wireshark.</p></div><div class="sect2" title="Creating the Elusive Breakout Switch"><div class="titlepage"><div><div><h2 class="title"><a id="creating_the_elusive_breakout_switch"/>Creating the Elusive Breakout Switch</h2></div></div></div><p>A <span class="emphasis"><em>breakout switch</em></span> is another way to connect real switches to GNS3 projects, and it’s common to set one up using Ubuntu Linux. Although a breakout switch does work on other systems, it’s easiest to set up on Linux. As mentioned earlier, other operating systems like Windows and OS X might remove VLAN information from the packets. For this reason, it’s best to install Ubuntu on real hardware if you plan to create a breakout switch. <a id="iddle1071" class="indexterm"/><a id="iddle1822" class="indexterm"/><a id="iddle2198" class="indexterm"/>If you use a virtual machine, your underlying host OS may strip the VLAN tags, and the breakout switch won’t work. You can sometimes get around this by using a USB Ethernet adapter, like the StartTech USB31000SW mentioned in <a class="xref" href="ch07.html#configuring_a_standard_802dot1q_trunk" title="Configuring a Standard 802.1Q Trunk">Configuring a Standard 802.1Q Trunk</a>.</p><p>This switching method requires a minimum of two real Cisco switches; one is the breakout switch, and the other is one or more live Cisco switches that are used in your GNS3 project. The breakout switch is used to fool the live Cisco switches into thinking that each of your GNS3 routers is <span class="emphasis"><em>directly connected</em></span> to a live switch with an Ethernet cable. In reality, only one Ethernet adapter is used in your PC to connect all your GNS3 routers to the live switches, and that adapter is connected to the breakout switch. The breakout switch is then configured to <span class="emphasis"><em>break out all the VLANs</em></span> into individual interfaces that you plug into other live Cisco switches using Ethernet cables (one per VLAN). I call these <span class="emphasis"><em>breakout cables</em></span>. <a class="xref" href="ch07.html#physical_layout_using_a_breakout_switch" title="Figure 7-13. Physical layout using a breakout switch and live Cisco switches">Figure 7-13</a> shows the physical layout of your PC and switches.</p><div class="figure"><a id="physical_layout_using_a_breakout_switch"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00087"/><img src="httpatomoreillycomsourcenostarchimages2209043.png" alt="Physical layout using a breakout switch and live Cisco switches"/></div></div><p class="title">Figure 7-13. Physical layout using a breakout switch and live Cisco switches</p></div><p>Here’s the flyby view of how it works. Breakout VLANs are configured on your Linux Ethernet adapter using the <code class="literal">vlan</code> package, and an 802.1Q trunk is configured on the breakout switch. In GNS3, you’ll add one or more Cloud nodes that are configured with the Linux breakout VLANs using NIO Ethernet interfaces. In your GNS3 project, a router is connected to each of the Cloud node’s VLAN interfaces (one router per interface). Packets leaving the routers go into the Cloud node, where Linux tags them with a VLAN ID and passes them to the breakout switch using your PC’s Ethernet adapter. The breakout switch receives the packets on a standard 802.1Q trunk port. From there, the breakout switch uses the VLAN IDs to identify and transparently pass the packets to one (or more) live Cisco switches. What makes this so ingenious is that each GNS3 router has a separate Ethernet cable that is connected to a port on the live Cisco switch, even though your PC has only a single Ethernet adapter.</p><p>Breakout switches are fairly straightforward to set up on Linux. Start by updating your package manager and installing VLAN support on your Ubuntu system.</p><a id="pro_id00094"/><pre class="programlisting">$ <span class="strong"><strong>sudo apt-get install vlan</strong></span></pre><p>Now, enable the <code class="literal">8021q</code> Linux module using the <code class="literal">modprobe</code> command.</p><a id="pro_id00095"/><pre class="programlisting">$ <span class="strong"><strong>sudo modprobe 8021q</strong></span></pre><p><a id="iddle1006" class="indexterm"/><a id="iddle1711" class="indexterm"/><a id="iddle2295" class="indexterm"/>Next, increase the MTU frame size on the Ethernet interface, and create your breakout VLANs using the <code class="literal">vconfig</code> command. Be sure to substitute <span class="emphasis"><em><code class="literal">eth0</code></em></span> with the name of your interface.</p><a id="pro_id00096"/><pre class="programlisting">➊ $ <span class="strong"><strong>sudo ifconfig eth0 mtu 1546</strong></span>
➋ $ <span class="strong"><strong>sudo vconfig add eth0 10</strong></span>
➌ $ <span class="strong"><strong>sudo vconfig add eth0 20</strong></span></pre><div class="note" title="Note"><h3 class="title"><a id="ch07note07"/>Note</h3><p><span class="emphasis"><em>Your Ethernet adapter must support frame sizes above the standard maximum of 1500 bytes.</em></span></p></div><p>The increased frame size ➊ makes room for the additional VLAN tags. Create one breakout VLAN for each router in your project. In the previous listing, I created two breakout VLANs (10 ➋ and 20 ➌) on my Linux PC’s <span class="emphasis"><em><code class="literal">eth0</code></em></span> interface.</p><div class="note" title="Note"><h3 class="title"><a id="ch07note08"/>Note</h3><p><span class="emphasis"><em>Don’t confuse breakout VLANs with VLANs you create in your GNS3 projects. It’s important to understand that breakout VLANs should be used only by Linux and the breakout switch—they are not to be used in your GNS3 project or live Cisco switches.</em></span></p></div><p>Start configuring the breakout switch by increasing the system-wide MTU size. After the command is entered, you must reload the switch for the change to take effect.</p><a id="pro_id00097"/><pre class="programlisting">Breakout(config)# <span class="strong"><strong>system mtu 1546</strong></span></pre><p>After the switch reboots, log on and configure an 802.1Q trunk link as follows:</p><a id="pro_id00098"/><pre class="programlisting">  Breakout# <span class="strong"><strong>configure terminal</strong></span>
  Breakout(config)# <span class="strong"><strong>interface FastEthernet 0/1</strong></span>
➊ Breakout(config-if)# <span class="strong"><strong>switchport trunk encapsulation dot1q</strong></span>
➋ Breakout(config-if)# <span class="strong"><strong>switchport mode trunk</strong></span>
➌ Breakout(config-if)# <span class="strong"><strong>switchport trunk allowed vlan all</strong></span></pre><p>The interface you configure as the trunk is then connected to your PC’s physical Ethernet adapter using an Ethernet cable. As shown here, dot1q encapsulation ➊ is configured on the trunk port ➋, and all VLANs ➌ are allowed through the trunk.</p><p>Next, go under each interface that you plan to connect to a live switch, and configure a breakout VLAN and a dot1q tunnel for each VLAN, as shown in the following listing:</p><a id="pro_id00099"/><pre class="programlisting">  Breakout(config)# <span class="strong"><strong>vlan 10</strong></span>
  Breakout(config-vlan)# <span class="strong"><strong>vlan 20</strong></span>
  Breakout(config-vlan)# <span class="strong"><strong>exit</strong></span>
  Breakout(config)# <span class="strong"><strong>interface FastEthernet 0/2</strong></span>
  Breakout(config-if)# <span class="strong"><strong>description GNS3 R1 Physical Uplink to Live Switch SW1</strong></span>
➊ Breakout(config-if)# <span class="strong"><strong>switchport access vlan 10</strong></span>
➋ Breakout(config-if)# <span class="strong"><strong>switchport mode dot1q-tunnel</strong></span>
➌ Breakout(config-if)# <span class="strong"><strong>l2protocol-tunnel cdp</strong></span>
  Breakout(config-if)# <span class="strong"><strong>interface FastEthernet 0/3</strong></span>
  Breakout(config-if)# <span class="strong"><strong>description GNS3 R2 Physical Uplink to Live Switch SW2</strong></span>
➍ Breakout(config-if)# <span class="strong"><strong>switchport access vlan 20</strong></span>
  Breakout(config-if)# <span class="strong"><strong>switchport mode dot1q-tunnel</strong></span>
  Breakout(config-if)# <span class="strong"><strong>l2protocol-tunnel cdp</strong></span></pre><p><a id="iddle1104" class="indexterm"/><a id="iddle1139" class="indexterm"/><a id="iddle1165" class="indexterm"/><a id="iddle2182" class="indexterm"/><a id="iddle2259" class="indexterm"/>Here, our breakout switch’s FastEthernet 0/2 interface is configured for VLAN 10 ➊, dot1q tunneling ➋, and Cisco discovery protocol tunneling ➌. FastEthernet 0/3 is configured the same way, but for VLAN 20 ➍. These are the interfaces used to connect GNS3 routers to your live Cisco switches.</p><p>We already know that Cisco Discovery Protocol (CDP) is used to share and gather information with directly connected Cisco equipment, often called <span class="emphasis"><em>neighbors</em></span>. However, our live Cisco switch is not directly connected to GNS3; instead, it’s connected to the breakout switch. In this instance, the only way to use CDP is by tunneling the protocol through the breakout switch to a live Cisco switch with the <code class="literal">l2protocol-tunnel cdp</code> command. (You can also tunnel STP and VTP.) This is where things get tricky because CDP tunneling does not work on all switches. If you need to use CDP, be sure to choose a breakout switch that fully supports CDP tunneling. <a class="xref" href="ch07.html#common_cisco_switches_and_their_cdp_tunn" title="Table 7-1. Common Cisco Switches and Their CDP Tunneling Compatibility">Table 7-1</a> lists a few common Cisco switches and their CDP tunneling capabilities.</p><div class="table"><a id="common_cisco_switches_and_their_cdp_tunn"/><p class="title">Table 7-1. Common Cisco Switches and Their CDP Tunneling Compatibility</p><div class="table-contents"><table summary="Common Cisco Switches and Their CDP Tunneling Compatibility" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Switch</p></th><th style="border-bottom: 0.5pt solid ; " valign="top"><p>CDP tunneling compatibility</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Cisco 2950</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>CDP will not work in either direction. Layer 2 tunneling is not supported on this switch.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Cisco 3550</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>CDP works only in one direction. Neighbors cannot be seen on the switches regardless of the IOS version.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Cisco 3560</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>CDP works only in one direction. Neighbors cannot be seen on the switches regardless of the IOS version.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Cisco 3750</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Bidirectional CDP and fully functional (layer 2 and layer 3) using IP Services image. IP Base image does not support tunneling.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " valign="top"><p>Cisco 4948</p></td><td style="" valign="top"><p>Bidirectional CDP and fully functional (layer 2 and layer 3) using a minimum IP Services image.</p></td></tr></tbody></table></div></div><p>The Cisco 3750 switch works well, both as a breakout switch and for tunneling CDP, but it’s not the cheapest switch available. If you don’t have the cash to spring for this model, you can choose a cheaper model that should work as a breakout switch, but you won’t have complete transparency in your GNS3 project.</p><p>Before continuing, be sure that Fa0/1 on the breakout switch is connected to your PC’s Ethernet port, and that Fa0/2 and Fa0/3 are connected <a id="iddle1184" class="indexterm"/>to Ethernet ports on your live project switches. After checking those connections, start GNS3 and configure a Cloud node using the Linux VLANs you created previously, as shown in <a class="xref" href="ch07.html#configuring_a_cloud_node_using_linux_vla" title="Figure 7-14. Configuring a Cloud node using Linux VLANs">Figure 7-14</a>.</p><div class="figure"><a id="configuring_a_cloud_node_using_linux_vla"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00088"/><img src="httpatomoreillycomsourcenostarchimages2209045.png.jpg" alt="Configuring a Cloud node using Linux VLANs"/></div></div><p class="title">Figure 7-14. Configuring a Cloud node using Linux VLANs</p></div><div class="note" title="Note"><h3 class="title"><a id="ch07note09"/>Note</h3><p><span class="emphasis"><em>Even though you’re using Linux, it’s important to use the Generic Ethernet NIO and not the Linux Ethernet NIO. Otherwise, VLAN tagging may not work.</em></span></p></div><p>When you’re finished adding breakout VLANs to the Cloud node, add a couple of routers to your workspace and create a link from each router to a breakout VLAN on the Cloud node. In <a class="xref" href="ch07.html#virtual_routers_connected_to_linux_vlans" title="Figure 7-15. Virtual routers connected to Linux VLANs using a Cloud node">Figure 7-15</a>, router R1 (F0/0) is linked to VLAN 10 in the Cloud using <span class="emphasis"><em>nio_gen_eth:eth0.10</em></span>, and R2 (F0/0) is linked to VLAN 20 using <span class="emphasis"><em>nio_gen_eth:eth0.20</em></span>.</p><div class="figure"><a id="virtual_routers_connected_to_linux_vlans"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00089"/><img src="httpatomoreillycomsourcenostarchimages2209047.png.jpg" alt="Virtual routers connected to Linux VLANs using a Cloud node"/></div></div><p class="title">Figure 7-15. Virtual routers connected to Linux VLANs using a Cloud node</p></div><p>Because the breakout switch is only used to split VLANs into multiple physical ports, it requires no further configuration. In this example, router R1 is now linked to any live switch plugged into breakout switchport f0/2, and R2 should be linked to any live switch plugged into port f0/3.</p><div class="note" title="Note"><h3 class="title"><a id="ch07note10"/>Note</h3><p><a id="iddle1073" class="indexterm"/><a id="iddle1354" class="indexterm"/><a id="iddle1359" class="indexterm"/><a id="iddle1756" class="indexterm"/><a id="iddle1826" class="indexterm"/><span class="emphasis"><em>If you create large projects using many VLANs, you may want to assign only one Linux VLAN interface per Cloud node to help clarify the layout in your workspace.</em></span></p></div><p>Your GNS3 routers should now be able to communicate with one or more real Cisco switches.</p></div><div class="sect2" title="Optional Breakout Switch Configuration"><div class="titlepage"><div><div><h2 class="title"><a id="optional_breakout_switch_configuration"/>Optional Breakout Switch Configuration</h2></div></div></div><p>If you’re running Windows or OS X, you may be able to use a GNS3 Switch node to link your project to a breakout switch, as shown in <a class="xref" href="ch07.html#breakout_switch_configuration_using_an_e" title="Figure 7-16. Breakout switch configuration using an Ethernet switch node">Figure 7-16</a>. In this setup, the breakout switch is configured in the same way as previously, but you’ll need to make some tweaks to your PC. The Ethernet switch node connects to a Cloud node using an NIO interface configured with a loop-back adapter on Windows or a TAP interface on OS X. The virtual adapter is bridged to your PC’s physical Ethernet adapter. This allows Cloud 1 to connect to the breakout switch using your PC’s Ethernet adapter.</p><div class="figure"><a id="breakout_switch_configuration_using_an_e"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00090"/><img src="httpatomoreillycomsourcenostarchimages2209049.png.jpg" alt="Breakout switch configuration using an Ethernet switch node"/></div></div><p class="title">Figure 7-16. Breakout switch configuration using an Ethernet switch node</p></div><p>For the breakout switch to work, you should increase the MTU size on your PC’s physical Ethernet adapter, but not all adapters support this feature.</p><p>If you’re a OS X user, the MTU size must be increased on both your physical adapter and virtual adapter. To increase the MTU size from the command line, use the following example:</p><a id="pro_id00100"/><pre class="programlisting">$ <span class="strong"><strong>sudo ifconfig en0 mtu 1546</strong></span>
$ <span class="strong"><strong>sudo ifconfig tap0 mtu 1546</strong></span></pre><div class="note" title="Note"><h3 class="title"><a id="ch07note11"/>Note</h3><p><span class="emphasis"><em>On OS X, configure the virtual and physical adapter using the same MTU size, or the bridge creation will fail.</em></span></p></div><p>You may have to check your Ethernet adapter documentation to configure your adapter on Windows. On many adapters, however, the MTU setting can be found under the Advanced properties of the adapter, as shown in <a class="xref" href="ch07.html#setting_the_jumbo_packet_size_on_windows" title="Figure 7-17. Setting the Jumbo Packet size on Windows">Figure 7-17</a>. In this example the <code class="literal">Jumbo Packet</code> value is set to 9014 bytes on an Intel PRO/1000 MT card.</p><div class="figure"><a id="setting_the_jumbo_packet_size_on_windows"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00091"/><img src="httpatomoreillycomsourcenostarchimages2209051.png.jpg" alt="Setting the Jumbo Packet size on Windows"/></div></div><p class="title">Figure 7-17. Setting the Jumbo Packet size on Windows</p></div><p><a id="iddle1881" class="indexterm"/>Next, bring up the Node configurator for the Ethernet switch node to define VLANs and the dot1q trunk port, as shown in <a class="xref" href="ch07.html#ethernet_switch_node_configured_for_brea" title="Figure 7-18. Ethernet switch node configured for breakout switch">Figure 7-18</a>.</p><div class="figure"><a id="ethernet_switch_node_configured_for_brea"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00092"/><img src="httpatomoreillycomsourcenostarchimages2209053.png.jpg" alt="Ethernet switch node configured for breakout switch"/></div></div><p class="title">Figure 7-18. Ethernet switch node configured for breakout switch</p></div><p>In this example, R1 is connected to access Port 1 (VLAN 10), R2 is connected to access Port 2 (VLAN 20), and Port 3 is the dot1q trunk to the breakout switch. After everything is configured in GNS3, you can log on and configure the breakout switch with VLANs and dot1q tunneling as previously described.</p></div><div class="sect2" title="Using Multiple Adapters in Your PC"><div class="titlepage"><div><div><h2 class="title"><a id="using_multiple_adapters_in_your_pc"/>Using Multiple Adapters in Your PC</h2></div></div></div><p><a id="iddle1015" class="indexterm"/><a id="iddle1760" class="indexterm"/><a id="iddle1829" class="indexterm"/><a id="iddle2189" class="indexterm"/>Instead of using an 802.1Q trunk or a breakout switch, you could use one physical Ethernet interface for each router in GNS3. If you have a laptop, you could use a USB hub and connect multiple USB Ethernet adapters to your PC; with a desktop, you could use the USB hub method or purchase a multiport Ethernet card. <a class="xref" href="ch07.html#physical_layout_using_multiple_adapters" title="Figure 7-19. Physical layout using multiple adapters in a PC">Figure 7-19</a> shows the physical layout of the design.</p><div class="figure"><a id="physical_layout_using_multiple_adapters"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00093"/><img src="httpatomoreillycomsourcenostarchimages2209055.png" alt="Physical layout using multiple adapters in a PC"/></div></div><p class="title">Figure 7-19. Physical layout using multiple adapters in a PC</p></div><p>Connect each Ethernet adapter in your PC to a physical port on a live Cisco switch. Log on to each switch and configure an access port using the <code class="literal">switchport mode access</code> command. Then, assign a unique VLAN number to the port by entering <code class="literal">switchport access vlan {vlan number}</code>, as in the following listings.</p><p>Start with the first switch (c3550_sw1):</p><a id="pro_id00101"/><pre class="programlisting">c3550_sw1(config)# <span class="strong"><strong>interface f0/1</strong></span>
c3550_sw1(config-if)# <span class="strong"><strong>description VLAN used for PC Ethernet Adapter 1</strong></span>
c3550_sw1(config-if)# <span class="strong"><strong>switchport mode access</strong></span>
c3550_sw1(config-if)# <span class="strong"><strong>switchport access vlan 10</strong></span></pre><p>Next, configure switch two (c3550_sw2):</p><a id="pro_id00102"/><pre class="programlisting">c3550_sw2(config)# <span class="strong"><strong>interface f0/1</strong></span>
c3550_sw2(config-if)# <span class="strong"><strong>description VLAN used for PC Ethernet Adapter 2</strong></span>
c3550_sw2(config-if)# <span class="strong"><strong>switchport mode access</strong></span>
c3550_sw2(config-if)# <span class="strong"><strong>switchport access vlan 20</strong></span></pre><p>To connect GNS3 devices to the switches, add a Cloud node to your workspace and assign one NIO Ethernet interface for each Ethernet adapter in your PC. Connect your GNS3 routers to each NIO interface using one router per interface.</p><div class="note" title="Note"><h3 class="title"><a id="ch07note12"/>Note</h3><p><span class="emphasis"><em>OS X users will have to create a unique bridge interface for each adapter and bridge each Ethernet interface to a unique TAP interface. OS X supports up to 16 TAP devices (tap0 through tap15).</em></span></p></div><p>After all the devices in your project have been configured, your GNS3 devices should be able to communicate with the live Cisco switches. Further configuration is required on the switches to enable routing between GNS3 routers and is determined by the switch block design you create.</p><p>Now let’s take a look at connecting GNS3 to the Internet.</p></div></div><div class="sect1" title="Connecting GNS3 Devices to the Internet"><div class="titlepage"><div><div><h1 class="title"><a id="connecting_gns3_devices_to_the_internet"/>Connecting GNS3 Devices to the Internet</h1></div></div></div><p><a id="iddle1186" class="indexterm"/><a id="iddle1270" class="indexterm"/><a id="iddle1278" class="indexterm"/><a id="iddle1353" class="indexterm"/><a id="iddle1466" class="indexterm"/><a id="iddle1553" class="indexterm"/><a id="iddle1555" class="indexterm"/><a id="iddle1733" class="indexterm"/><a id="iddle1768" class="indexterm"/><a id="iddle1795" class="indexterm"/><a id="iddle1804" class="indexterm"/><a id="iddle2264" class="indexterm"/>To connect GNS3 devices to the Internet, you need to use an Ethernet adapter in your PC. Wireless network adapters are not supported if you use them directly, though one may work if bridged to a loopback adapter or TAP interface (but don’t count on it). Make the GNS3 to Ethernet connection the same way that you connect to a physical switch: add a Cloud node to your project and configure it with either an NIO TAP or NIO Ethernet interface.</p><div class="sect2" title="Configuring Windows"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_windows"/>Configuring Windows</h2></div></div></div><p>On Windows systems, create a bridge using a loopback adapter and your PC’s physical Ethernet adapter. Then, in GNS3, use a Cloud node configured using NIO Ethernet and select the loopback adapter. Because the loopback adapter is bridged to the physical Ethernet adapter, you can use the Cloud to connect to networks outside GNS3—including the Internet.</p><p>On Windows 8.<span class="emphasis"><em>x</em></span>, install a loopback adapter, but do not add it to a bridge. Instead, configure Internet Connection Sharing (ICS) on your physical interface (Ethernet or Wi-Fi). To do so, right-click the <span class="strong"><strong>Start</strong></span> button and select <span class="strong"><strong>Network Connections</strong></span>. Next, right-click your physical Interface and select <span class="strong"><strong>Properties</strong></span>. Select the <span class="strong"><strong>Sharing</strong></span> tab, and check the <span class="strong"><strong>Allow other network users to connect through this computer’s Internet connection</strong></span> option. Lastly, select your loopback adapter from the Home Networking Connection drop-down menu, and click <span class="strong"><strong>OK</strong></span>.</p></div><div class="sect2" title="Configuring Unix-Based Systems"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_unix-based_systems"/>Configuring Unix-Based Systems</h2></div></div></div><p>On Ubuntu Linux, create an NIO Ethernet connection using your PC’s Ethernet interface. On OS X and some Linux systems, use an NIO TAP connection configured with <span class="emphasis"><em>/dev/tap0</em></span> and bridge the TAP interface to your PC’s Ethernet interface.</p></div><div class="sect2" title="Creating a Simple Network"><div class="titlepage"><div><div><h2 class="title"><a id="creating_a_simple_network"/>Creating a Simple Network</h2></div></div></div><p>Create a project by adding a router and a Cloud node to your workspace and adding a link from the router to the Cloud. In <a class="xref" href="ch07.html#connecting_to_a_cloud_using_a_windows_lo" title="Figure 7-20. Connecting to a Cloud using a Windows loopback adapter">Figure 7-20</a>, the Cloud is configured using the Windows loopback adapter, named <code class="literal">Local Area Connection 2</code>.</p><div class="figure"><a id="connecting_to_a_cloud_using_a_windows_lo"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00094"/><img src="httpatomoreillycomsourcenostarchimages2209057.png.jpg" alt="Connecting to a Cloud using a Windows loopback adapter"/></div></div><p class="title">Figure 7-20. Connecting to a Cloud using a Windows loopback adapter</p></div><p><a id="iddle1074" class="indexterm"/><a id="iddle1227" class="indexterm"/><a id="iddle1758" class="indexterm"/><a id="iddle1836" class="indexterm"/><a id="iddle1842" class="indexterm"/><a id="iddle2216" class="indexterm"/>To test Internet connectivity, attach an Ethernet cable from your PC to an Internet device, like a cable modem, and configure an IP address on your GNS3 router. If you use DHCP to assign an IP address as I did here, you may have to wait a moment for the router to receive an IP address before you can test connectivity.</p><a id="pro_id00103"/><pre class="programlisting">R1(config)# <span class="strong"><strong>ip domain-lookup</strong></span>
R1(config)# <span class="strong"><strong>ip name-server 8.8.8.8</strong></span>
R1(config)# <span class="strong"><strong>interface f0/0</strong></span>
R1(config)# <span class="strong"><strong>no shutdown</strong></span>
R1(config-if)# <span class="strong"><strong>ip address dhcp</strong></span>

*Mar 1 00:01:08.875: %DHCP-6-ADDRESS_ASSIGN: Interface FastEthernet0/0 assigned
DHCP address 192.168.1.101, mask 255.255.255.0, hostname R1</pre><p>After your router has obtained an IP address, you should be able to ping a host on the Internet. Try to ping <span class="emphasis"><em><a class="ulink" href="http://www.gns3.net">www.gns3.net</a></em></span>! You’re not limited to using a router to connect to the Internet; you can also use an ASA device, Juniper router, or any other device that supports TCP/IP.</p><div class="note" title="Note"><h3 class="title"><a id="ch07note13"/>Note</h3><p><span class="emphasis"><em>If you have other devices behind router R1, you need to configure NAT on R1 before they can route to the Internet. For more information, visit Cisco’s website</em></span> (<a class="ulink" href="http://www.cisco.com/en/US/tech/tk648/tk361/technologies_tech_note09186a0080094e77.shtml#topic6">http://www.cisco.com/en/US/tech/tk648/tk361/technologies_tech_note09186a0080094e77.shtml#topic6</a>).</p></div></div></div><div class="sect1" title="Final Thoughts"><div class="titlepage"><div><div><h1 class="title"><a id="final_thoughts-id00017"/>Final Thoughts</h1></div></div></div><p>In this chapter, we looked at configuring GNS3 device nodes and integrating them into your projects using Cisco IOS. They’re simple to set up and well suited for large projects because they greatly reduce the load on your PC. Compared to Dynamips devices, GNS3 device nodes use almost no PC resources.</p><p>Connecting a GNS3 device to a live Cisco switch is tricky. If you choose to create a standard 802.1Q trunk to connect with a live switch, you can use either an EtherSwitch router or an Ethernet switch node, but your PC operating system and Ethernet adapter drivers must both support 802.1Q tagging. Without the proper VLAN tags, trunking won’t work.</p><p>If you have an extra IOS switch, you can create a breakout switch, which is a very reliable way to integrate multiple real Cisco switches into your GNS3 projects. A breakout switch works most reliably on Linux systems but can also be configured using Windows and OS X.</p><p>In the next chapter, we’ll look at some more advanced features including Cisco, ASA, and IDS/IPS.</p></div></div></body></html>