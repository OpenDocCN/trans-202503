<html><head></head><body><div id="sbo-rt-content"><h2 class="h2" id="ch07"><span epub:type="pagebreak" id="page_195"/><span class="big">7</span><br/>THE ABCS OF ABCS</h2>&#13;
<div class="image1"><img src="Images/common01.jpg" alt="Image" width="189" height="189"/></div>&#13;
<p class="noindent">ABC (<em><a href="https://esolangs.org/wiki/ABC">https://esolangs.org/wiki/ABC</a></em>) was created by a programmer known as “Orange,” an esolang fan with several entries in the esolangs wiki. Some are jokes, others more serious, and then there’s ABC. I selected ABC because of its simplicity. Think of it as a starting point: something that is, but begs to be more. This chapter takes ABC from its unadorned description to a vanilla Python implementation, ultimately evolving it into something more via extensions to the language. This will be a warm-up for the esolangs that follow.</p>&#13;
<p class="indent">Specifically, we’ll present and implement ABC as originally described. Then, we’ll morph ABC into the cleverly named ABC2. We follow ABC2 and its implementation with some examples that help us think in this new language. As always, we’ll end with a discussion of the languages.</p>&#13;
<h3 class="h3" id="lev1sec53"><span epub:type="pagebreak" id="page_196"/><strong>ABC</strong></h3>&#13;
<p class="noindent">Let’s start slowly. In this section, we’ll discuss what the ABC language entails, then we’ll implement it in Python. It won’t take much. After that, we’ll test the implementation with some existing ABC examples.</p>&#13;
<h4 class="h4" id="lev2sec54"><strong><em>The Language</em></strong></h4>&#13;
<p class="noindent">The esolang wiki description of ABC is</p>&#13;
<pre>a - Increment the accumulator&#13;
b - Decrement the accumulator&#13;
c - Output the accumulator&#13;
&#13;
d - Invert accumulator&#13;
r - Set accumulator to a random number between 0 and &#13;
    accumulator&#13;
n - Set accumulator to 0&#13;
&#13;
$ - Toggle ASCII output mode.  When on, the c &#13;
    instruction prints the accumulator as an ASCII &#13;
    character.&#13;
l - Loop back to the beginning of the program.  &#13;
    Accumulator and ASCII mode does not reset.&#13;
; - Debug.  Prints out accumulator as a number and &#13;
    ASCII character.&#13;
&#13;
Unknown instructions are treated as NOPs.</pre>&#13;
<p class="indent">That’s all there is; there isn’t any more. However, that’s all we need. The description tells us ABC uses an accumulator that can be incremented by one, decremented by one, or inverted (negated).</p>&#13;
<p class="indent">There isn’t much here, but that’s the charm of it—what can we do with something so simple?</p>&#13;
<h4 class="h4" id="lev2sec55"><strong><em>An ABC Implementation</em></strong></h4>&#13;
<p class="noindent">Implementing ABC shouldn’t take too much effort on our part. The esolang wiki has an implementation in Java, but we’ll use Python.</p>&#13;
<p class="indent"><a href="ch07.xhtml#ch07list1">Listing 7-1</a> is the complete source code to our ABC implementation (see <em>ABC.py</em>).</p>&#13;
<pre>   import sys &#13;
   import random&#13;
<span class="ent">➊</span> t=open(sys.argv[1]).read()&#13;
   tokens=["a","b","c","d","r","n","$","l",";"]&#13;
   prog=""<span epub:type="pagebreak" id="page_197"/>&#13;
   for c in t:&#13;
  <span class="ent">➋</span> if (c in tokens): prog+=c&#13;
   mode=False; A=0; k=0 &#13;
<span class="ent">➌</span> while (k&lt;len(prog)):&#13;
     t=prog[k]&#13;
     if   (t=="a"): A+=1&#13;
     elif (t=="b"): A-=1&#13;
     elif (t=="c"): &#13;
       if (mode):   print("%s"%chr(A),end="")&#13;
       else:        print("%d"%A,end="")&#13;
     elif (t=="d"): A=-A&#13;
     elif (t=="r"): A=int(random.random()*A)&#13;
     elif (t=="n"): A=0 &#13;
     elif (t=="$"): mode=not mode&#13;
     elif (t=="l"): k=-1&#13;
     elif (t==";"): print("{%d:(%d,%x,'%s')}"%(k,A,A,chr(A)),end="")&#13;
     else:          pass&#13;
     k+=1&#13;
   print()</pre>&#13;
<p class="caption" id="ch07list1"><em>Listing 7-1: A Python implementation of ABC</em></p>&#13;
<p class="indent">Python isn’t normally written so compactly, but we’re implementing a tiny language, so a tiny implementation seems appropriate. We’ll admit one slight deviation from the language description. The <span class="literal">r</span> command should set the accumulator (<span class="literal">A</span>) to a random value in [0, <em>A</em>]. Instead, our implementation uses [0, <em>A</em>), which is closer to how pseudorandom generators are typically used—the upper limit is not usually included in the range. The effect on example code is minimal.</p>&#13;
<p class="indent">ABC reads a source code file from the command line <span class="ent">➊</span>, keeping only characters representing ABC commands <span class="ent">➋</span>. This means text that isn’t a valid ABC command is fair game for comments. Channeling our inner COBOL, we adopt the convention of using uppercase letters with minimal punctuation for comments.</p>&#13;
<p class="indent">We store the program in the variable <span class="literal">prog</span>. Program state is set to the defaults of number output (<span class="literal">mode==False</span>), accumulator of zero (<span class="literal">A=0</span>), and program counter zero (<span class="literal">k=0</span>).</p>&#13;
<p class="indent">The main body of ABC now runs: a <span class="literal">while</span> loop with a nested <span class="literal">if</span> asking whether the current instruction (<span class="literal">t</span>) matches a command or not <span class="ent">➌</span>. The program ends when all commands have been executed. By design, the <span class="literal">l</span> command causes an infinite loop, as there is no exit command.</p>&#13;
<h4 class="h4" id="lev2sec56"><strong><em>Testing ABC</em></strong></h4>&#13;
<p class="noindent">The esolang wiki page for ABC includes several example programs. Let’s use them to test the implementation. The simplest one counts forever: <span class="literal">acl</span>.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_198"/>With comments, it looks like this:</p>&#13;
<pre>COUNT FOREVER&#13;
a  INCREMENT ACCUMULATOR&#13;
c  PRINT THE ACCUMULATOR AS A NUMBER&#13;
l  START AGAIN FROM THE BEGINNING</pre>&#13;
<p class="indent">Other examples include <em>1337.abc</em></p>&#13;
<pre>acaaccaaaac</pre>&#13;
<p class="noindent">which prints <span class="literal">1337</span> (leetspeak). The program increments <span class="literal">A</span> to print <span class="literal">1</span>, then two more times to print <span class="literal">3</span> twice, and finally four more times to print <span class="literal">7</span>. Simple.</p>&#13;
<p class="indent">We also have <em>dice.abc</em></p>&#13;
<pre>aaaaaarac</pre>&#13;
<p class="noindent">which rolls a standard die. The program increments until <em>A</em> = 6, then replaces it with a random integer in [0, 6). A final increment sets <em>A</em> ∈ [1, 7) before printing it. Note that <em>dice.abc</em> has an extra <span class="literal">a</span> before the <span class="literal">r</span> to accommodate our change in how <span class="literal">r</span> works.</p>&#13;
<p class="indent">The examples also include <em>hello.abc</em></p>&#13;
<pre>$aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#13;
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacaaaaaa&#13;
aaaaaaaaaaaaaaaaaaaaaaacaaaaaaaccaaacnaa&#13;
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#13;
aacbbbbbbbbbbbbcaaaaaaaaaaaaaaaaaaaaaaaa&#13;
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacaaaaaaaa&#13;
aaaaaaaaaaaaaaaacaaacbbbbbbcbbbbbbbbcnaa&#13;
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaac</pre>&#13;
<p class="noindent">which prints “Hello, world!” by setting ASCII output mode, then incrementing, decrementing, and starting from 0 to get the accumulator to hold the necessary ASCII codes for each letter. Note that the accumulator isn’t reset for each character, but rather uses an offset from the last character’s code. It’s as easy as ABC.</p>&#13;
<p class="indent">The final example program, <em>phone.abc</em>, prints a randomly generated US-style telephone number:</p>&#13;
<pre>ac                  COUNTRY CODE&#13;
naaaaaaaaaradc      THREE DIGIT AREA CODE&#13;
naaaaaaaaaarc&#13;
naaaaaaaaaarc&#13;
naaaaaaaaaradc      THREE DIGIT EXCHANGE&#13;
naaaaaaaaaarc&#13;
naaaaaaaaaarc&#13;
naaaaaaaaaradc      FOUR DIGIT SUBSCRIBER<span epub:type="pagebreak" id="page_199"/>&#13;
naaaaaaaaaarc       NUMBER&#13;
naaaaaaaaaarc&#13;
naaaaaaaaaarc</pre>&#13;
<p class="noindent">The clever trick in this program is to add <span class="literal">d</span> to make the accumulator negative before printing it, thereby adding the dash between the parts of the number: <span class="literal">1-883-386-3219</span>.</p>&#13;
<p class="indent">With that, ABC and its examples are finished. As mentioned, ABC begs to be more. Spend a lot of time with esolangs and you’ll eventually get the itch to work on your own, and see how to take what exists and modify and enhance it. If you have that itch, scratch it; creativity is asking you to dance.</p>&#13;
<p class="indent">Let’s have some fun rebuilding ABC. We’ll maintain compatibility with what it is now, but we can add more.</p>&#13;
<h3 class="h3" id="lev1sec54"><strong>ABC2</strong></h3>&#13;
<p class="noindent">After much deliberation and several focus groups, the name we’ve selected for ABC’s successor is ABC2. There is precedent: Modula became Modula-2 (and Modula-3), Oberon became Oberon-2, and so on. What should be done to ABC to make it ABC2? Existing ABC programs should run without modification, meaning that ABC2 is backward compatible. Of course, most anything could be done, but in the next section, we’ll describe what we did and then follow with the updated Python implementation.</p>&#13;
<h4 class="h4" id="lev2sec57"><strong><em>The Extensions</em></strong></h4>&#13;
<p class="noindent">Extending ABC is fun. Here’s what turned ABC into ABC2:</p>&#13;
<ul>&#13;
<li class="noindent">An interactive mode if no program is supplied at the command line</li>&#13;
<li class="noindent">A second accumulator, <span class="literal">B</span>, and a command to toggle between <span class="literal">A</span> and <span class="literal">B</span> ( <span class="literal">^</span> )</li>&#13;
<li class="noindent">A stack with arithmetic commands</li>&#13;
<li class="noindent">A command to exchange the top stack value and the active accumulator (<span class="literal">x</span>) as well as push (<span class="literal">!</span>) and pop (<span class="literal">@</span>) the stack</li>&#13;
<li class="noindent">A primitive conditional command (<span class="literal">?</span>) with <span class="literal">&lt;</span>, <span class="literal">&gt;</span>, and <span class="literal">=</span> commands</li>&#13;
<li class="noindent">A command to halt a program (<span class="literal">q</span>)</li>&#13;
<li class="noindent">A command to get a character from the user (<span class="literal">k</span>)</li>&#13;
<li class="noindent">A branch command (<span class="literal">g</span>)</li>&#13;
<li class="noindent">A command to toggle adding newline to output (<span class="literal">e</span>)</li>&#13;
</ul>&#13;
<p class="indent">We’ll discuss these changes and their effect on what ABC was and became in the final section of this chapter. For now, let’s turn our attention to the implementation.</p>&#13;
<h4 class="h4" id="lev2sec58"><span epub:type="pagebreak" id="page_200"/><strong><em>An ABC2 Implementation</em></strong></h4>&#13;
<p class="noindent">ABC2 is in the file <em>ABC2.py</em>. It isn’t as compact as <em>ABC.py</em>, but follows standard Python conventions. The structure of the interpreter remains the same: process each character in <span class="literal">prog</span> as a command until all have been processed. Some modification is necessary to allow a purely interactive mode. We’ll present the code in pieces, starting with <a href="ch07.xhtml#ch07list2">Listing 7-2</a>, which shows the code to parse the command line:</p>&#13;
<pre>    if (len(sys.argv)==2):&#13;
        interactive = False&#13;
        t = open(sys.argv[1]).read()&#13;
        tokens = [&#13;
            "a","b","c","d","r","n","$","l",";",&#13;
            "e","&gt;","&lt;","g","+","-","*","/","x",&#13;
            "q","%","=","?","!","@","k","^",&#13;
        ]&#13;
        prog = ""&#13;
        for c in t:&#13;
            if (c in tokens):&#13;
                prog += c&#13;
    else:&#13;
        interactive = True</pre>&#13;
<p class="caption" id="ch07list2"><em>Listing 7-2: Parsing program text in ABC2</em></p>&#13;
<p class="noindent">The <span class="literal">if</span> loads and parses a program, keeping only actual command characters, or sets the <span class="literal">interactive</span> flag.</p>&#13;
<p class="indent">Next comes the default state and the modified main loop (<a href="ch07.xhtml#ch07list3">Listing 7-3</a>).</p>&#13;
<pre>A = [0,0]&#13;
I = mode = cr = k = 0&#13;
stack = []&#13;
ops = ["+","-","*","/","%","&lt;","&gt;","="]&#13;
while (True):&#13;
    if (interactive):&#13;
        prog = input(": ")&#13;
        k = 0&#13;
    while (k &lt; len(prog)):&#13;
        t = prog[k]&#13;
        # ... execute command in t ...&#13;
        k += 1&#13;
    if (not interactive):&#13;
        print()&#13;
        quit()</pre>&#13;
<p class="caption" id="ch07list3"><em>Listing 7-3: The ABC2 state and main loop</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_201"/>The single accumulator is now a pair of accumulators, both initially zero (<span class="literal">A</span>). The value of <span class="literal">I</span> toggles between them. Output defaults to numbers (<span class="literal">mode=0</span>) and no newline (<span class="literal">cr=0</span>). The <span class="literal">stack</span> is a standard Python list. We’ll use the seldom seen <span class="literal">pop</span> method. All stack operations are in <span class="literal">ops</span>.</p>&#13;
<p class="indent">Next, two loops begin. The outer <span class="literal">while</span> loop runs forever. If interactive, <span class="literal">prog</span> is set to whatever sequence of commands the user enters. Note that the state is not reset, so whatever state is active when the entered commands are complete is still present for the next set. The second <span class="literal">while</span> loop is the same as in ABC proper: get the character of the command and evaluate it. When the program ends, if not in interactive mode, exit.</p>&#13;
<p class="indent">In the actual implementation, the second <span class="literal">while</span> loop contains a rather lengthy compound <span class="literal">if</span> statement to execute the command (<a href="ch07.xhtml#ch07list4">Listing 7-4</a>):</p>&#13;
<pre>if (t == "a"):&#13;
    A[I] += 1&#13;
elif (t == "b"):&#13;
    A[I] -= 1&#13;
elif (t == "c"):&#13;
    if (mode):&#13;
        print("%s" % chr(A[I]), end="", flush=True)&#13;
    else:&#13;
        print("%d" % A[I], end="", flush=True)&#13;
    if (cr):&#13;
        print()&#13;
elif (t == "d"):&#13;
    A[I] = -A[I]&#13;
elif (t == "r"):&#13;
    A[I] = int(random.random()*A[I])&#13;
elif (t == "n"):&#13;
    A[I] = 0&#13;
<span class="codeitalic1">--snip--</span></pre>&#13;
<p class="caption" id="ch07list4"><em>Listing 7-4: Executing ABC2 commands</em></p>&#13;
<p class="indent">A conceptually more elegant implementation would make ABC2 a class and use a dictionary of methods associated with each command in a small loop. Readers are invited to build such an implementation and share it. However, for pedagogical purposes, building on the existing ABC <span class="literal">if</span> statement approach seems easier to follow, even if it’s less creative.</p>&#13;
<p class="indent">ABC2 is backward compatible with ABC, so we’ll only describe the extensions. All previous commands operate as before, with <span class="literal">A</span> replaced by <span class="literal">A[I]</span> to use the active accumulator. Most of the extended commands require no more than one or two lines of code (see <a href="ch07.xhtml#ch07tab1">Table 7-1</a>).</p>&#13;
<p class="tabcap" id="ch07tab1"><span epub:type="pagebreak" id="page_202"/><strong>Table 7-1:</strong> Python Code for the Extended ABC2 Commands</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:30%"/>&#13;
<col style="width:70%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Command</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Implementation</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">^</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">I ^= 1</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">k</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">A[I] = ord(getch())</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">q</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">quit()</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">e</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">cr ^= 1</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">!</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">stack.append(A[I])</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">@</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">A[I].stack.pop()</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">g</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">k = k + stack.pop() - 1</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">?</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">if (not stack.pop()):</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"/></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"> <span class="literal">   k += 1</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">x</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">v = stack.pop()</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"/></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">stack.append(A[I])</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"/></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">A[I] = v</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><em>stack ops</em></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">if (t == "="):</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"/></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"> <span class="literal">    t = "=="</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"/></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">v=eval("%d %s %d" % (stack[-2],t,stack[-1]))</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"/></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">if (type(v) is bool):</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"/></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"> <span class="literal">    v = 1 if (v) else 0</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"/></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">stack.pop(); stack.pop()</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"/></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">stack.append(int(v))</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">There is no need to walk through each of the little code snippets in <a href="ch07.xhtml#ch07tab1">Table 7-1</a>, as most are self-explanatory. Note that sanity checks for things like popping the stack are not in <a href="ch07.xhtml#ch07tab1">Table 7-1</a>; however, they are in <em>ABC2.py</em>, so please read through the full source code.</p>&#13;
<p class="indent">There is one piece of code in <a href="ch07.xhtml#ch07tab1">Table 7-1</a> we should discuss. The <span class="literal">k</span> command calls a function, <span class="literal">getch</span>, which returns a keypress without waiting for the user to press ENTER. This is not a standard Python function. The top portion of <em>ABC2.py</em> implements <span class="literal">getch</span> for Linux, macOS, and Windows.</p>&#13;
<p class="indent">Both the <span class="literal">$</span> and <span class="literal">^</span> commands make use of an operator that might be unfamiliar to some: <span class="literal">^</span> (exclusive-OR or XOR). Exclusive-OR is a logical operation with the truth table</p>&#13;
<table class="all5a">&#13;
<colgroup>&#13;
<col style="width:30%"/>&#13;
<col style="width:30%"/>&#13;
<col style="width:40%"/>&#13;
</colgroup>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table_normal_right1"><p class="taba"><span class="literal">A</span></p></td>&#13;
<td style="vertical-align: top;" class="table_normal_right"><p class="taba"><span class="literal">B</span></p></td>&#13;
<td style="vertical-align: top;" class="table_normal_right"><p class="taba"><span class="literal">A^B</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table_normal_right1"><p class="taba"><span class="literal">0</span></p></td>&#13;
<td style="vertical-align: top;" class="table_normal_right"><p class="taba"><span class="literal">0</span></p></td>&#13;
<td style="vertical-align: top;" class="table_normal_right"><p class="taba"><span class="literal">0</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table_normal_right1"><p class="taba"><span class="literal">0</span></p></td>&#13;
<td style="vertical-align: top;" class="table_normal_right"><p class="taba"><span class="literal">1</span></p></td>&#13;
<td style="vertical-align: top;" class="table_normal_right"><p class="taba"><span class="literal">1</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table_normal_right1"><p class="taba"><span class="literal">1</span></p></td>&#13;
<td style="vertical-align: top;" class="table_normal_right"><p class="taba"><span class="literal">0</span></p></td>&#13;
<td style="vertical-align: top;" class="table_normal_right"><p class="taba"><span class="literal">1</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table_normal_right1"><p class="taba"><span class="literal">1</span></p></td>&#13;
<td style="vertical-align: top;" class="table_normal_right"><p class="taba"><span class="literal">1</span></p></td>&#13;
<td style="vertical-align: top;" class="table_normal_right"><p class="taba"><span class="literal">0</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="noindent">which states that the output of XOR is 1 when either of the inputs, but not both, is 1. This behavior makes toggling straightforward because <span class="literal">0^1 = 1</span> and <span class="literal">1^1 = 0</span>, meaning XORing a 0 or 1 with 1 results in 1 or 0, thereby flipping its state. As with other Python operators, <span class="literal">I ^= 1</span> is shorthand for <span class="literal">I = I^1</span>.</p>&#13;
<p class="indent">Our implementation is complete. Now, let’s see what ABC2 can do.</p>&#13;
<h3 class="h3" id="lev1sec55"><span epub:type="pagebreak" id="page_203"/><strong>ABC2 in Action</strong></h3>&#13;
<p class="noindent">After surviving Forth, ABC2 will seem straightforward. Let’s begin with the simplest of examples: adding two numbers. This is something ABC cannot do easily: you have to count up to the first value with <span class="literal">a</span>s and then use more <span class="literal">a</span>s to add a positive number before printing the result. ABC2 makes this a little easier. Consider <em>add.abc2</em>.</p>&#13;
<pre>ADD TWO NUMBERS AND DISPLAY THE RESULT&#13;
e             NEWLINE MODE&#13;
aaaaaaaaaa!   10 TO STACK&#13;
bbb!          7 TO STACK&#13;
+@c           ADD STACK, PULL TO A AND PRINT</pre>&#13;
<p class="noindent">The comments clarify the actions, but the gist is to set newline mode to print one number per line of output, count up to 10, and push the accumulator on the stack. As the accumulator is already at 10, and pushing to the stack does not alter it, we count down to 7 and push that to the stack.</p>&#13;
<p class="indent">The last line calls <span class="literal">+</span> to put 10 + 7 = 17 on the stack before popping it off the stack to the accumulator to print with <span class="literal">c</span>. Note that only values in the accumulators, <span class="literal">A</span> and <span class="literal">B</span>, can be printed. There is no “print the top stack" item as in Forth. To run <em>add.abc2</em>, use</p>&#13;
<pre>&gt; <span class="codestrong1">python3 ABC2.py add.abc2</span></pre>&#13;
<p class="indent">Well, that was easy enough. Let’s try something similar using interactive mode. Launch ABC2 (<span class="codestrong">python3 ABC2.py</span>), but don’t supply a filename. Then, enter the sequence of statements in <a href="ch07.xhtml#ch07list5">Listing 7-5</a>.</p>&#13;
<pre>: <span class="codestrong1">aaaaa;</span>&#13;
{5:0: (5,'')(0,'')} &lt;0&gt;: &#13;
: <span class="codestrong1">!;</span>&#13;
{1:0: (5,'')(0,'')} &lt;1&gt;: 5 &#13;
: <span class="codestrong1">!;*;</span>&#13;
{1:0: (5,'')(0,'')} &lt;2&gt;: 5 5 &#13;
{3:0: (5,'')(0,'')} &lt;1&gt;: 25 &#13;
: <span class="codestrong1">@ec;</span>&#13;
25&#13;
{3:0: (25,'')(0,'')} &lt;0&gt;:&#13;
: <span class="codestrong1">q</span></pre>&#13;
<p class="caption" id="ch07list5"><em>Listing 7-5: An interactive ABC2 session</em></p>&#13;
<p class="indent"><a href="ch07.xhtml#ch07list5">Listing 7-5</a> might look like random noise at first, but there’s a method to the madness. Let’s walk through it. ABC2’s interactive prompt is a colon (<span class="literal">:</span>). The first line shows five <span class="literal">a</span>s followed by a semicolon (<span class="literal">;</span>). We know <span class="literal">a</span>; it adds 1 <span epub:type="pagebreak" id="page_204"/>to the accumulator, so the accumulator now holds the number 5. The <span class="literal">;</span> is the “debug” command from ABC. That’s what produces the second line, <span class="literal">{5:0: (5,</span>''<span class="literal">)(0,</span>''<span class="literal">)}</span>.</p>&#13;
<p class="indent">There are four parts to the debug line. The first part shows the current program counter, which is the instruction number followed by a colon and a 0 or 1. In this case, the program counter is 5, as the <span class="literal">;</span> is the sixth instruction entered (always count from 0). The next bit, <span class="literal">0:</span>, tells us A is the current accumulator, <span class="literal">A[0]</span> in <em>ABC2.py</em>.</p>&#13;
<p class="indent">Next come two sets of parentheses. These are the current numeric value and value as a character for the two accumulators, A and B. In this case, A is 5, and B is its default of 0. Characters are shown if the accumulator is in [32,127], which excludes 5 and 0, so no characters are shown.</p>&#13;
<p class="indent">After the closing brace comes the stack. The number of items on the stack comes first. In this case it’s <span class="literal">&lt;0&gt;</span>, as the stack is empty. Any items on the stack follow.</p>&#13;
<p class="indent">The next set of commands entered, <span class="literal">!;</span>, store A on the stack and print the debug information again. This time we see <span class="literal">&lt;1&gt;: 5</span> telling us that there is one item on the stack, a 5.</p>&#13;
<p class="indent">The following commands push A on the stack a second time, call debug, multiply the top two stack items, and call debug again, leaving 25 on the stack. Lastly, <span class="literal">@ec;</span> pops the stack, sets A to 25, moves to newline mode, and prints <span class="literal">A</span>. The <span class="literal">q</span> command exits ABC2. If you venture to try your hand at ABC2 code, and I strongly suggest you do, you’ll find the interactive mode useful during program development.</p>&#13;
<p class="indent">Let’s walk through three more ABC2 examples. Each example explores an additional capability of ABC2, culminating in a final program that serves as a tribute to an underappreciated early computing pioneer.</p>&#13;
<h4 class="h4" id="lev2sec59"><strong><em>HELLO WORLD!</em></strong></h4>&#13;
<p class="noindent">The Hello World Collection website lists versions of “Hello, world!” in more than 600 different programming languages (<em><a href="http://helloworldcollection.de/">http://helloworldcollection.de/</a></em>). It’s become almost a moral obligation for every language capable of printing “Hello, world!” to do so at some point. Therefore, we’ll be good citizens and do our duty.</p>&#13;
<p class="indent">The file <em>hello.abc2</em> contains the obligatory, and slightly grammatically incorrect, ABC2 version of “Hello, world!” Running <em>hello.abc2</em> produces</p>&#13;
<pre>HELLO WORLD!</pre>&#13;
<p class="indent">The ABC version incremented and decremented the accumulator to arrive at the necessary ASCII code for each character. ABC2 has a stack, which, as we learned in <a href="ch04.xhtml#ch04">Chapter 4</a>, is a LIFO data structure; the last thing in is the first thing out. Let’s use the stack to store the characters we want to output, pushing them in reverse order so they print correctly when popped off the stack. Moreover, the stack supports arithmetic, so we don’t need to count up to the values we want. We can take shortcuts to reach the necessary ASCII codes more quickly.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_205"/><a href="ch07.xhtml#ch07list6">Listing 7-6</a> gives us the code.</p>&#13;
<pre>HELLO WORLD&#13;
aaa!aaaaaaaa!*@!!!+@aa!&#13;
@!aaaaaaaa!@!aaaaaa!&#13;
@!bbb!@!aaaaaaaa!&#13;
naaaa!aaaa!*@!!!+&#13;
@aaaaaaaaaaaaaaa!&#13;
@!bbb!!bbbbbbb!aaa!&#13;
$@c@c@c@c@c@c@c@c@c@c@ce@c</pre>&#13;
<p class="caption" id="ch07list6"><em>Listing 7-6: “Hello, world!” in ABC2</em></p>&#13;
<p class="indent">The first line is, of course, the comment. Let’s parse the first line after the comment <span class="literal">aaa!aaaaaaaa!*@!!!+@aa!</span>:</p>&#13;
<pre>aaa!       |  3&#13;
aaaaaaaa!  |  3 11&#13;
*          | 33&#13;
@!!!       | 33 33 33&#13;
+          | 33 66&#13;
@aa!       | 33 68</pre>&#13;
<p class="indent">Each line shows the ABC2 commands on the left and the state of the stack afterward. Look at the last line. The stack contains 33 and 68, the ASCII codes for <span class="literal">!</span> and <span class="literal">D</span>, respectively, which are the final two characters to output. The program builds the output string on the stack in reverse order.</p>&#13;
<p class="indent">The remainder over <span class="literal">HELLO WORLD!</span> is similarly placed on the stack. When the second to last line of <a href="ch07.xhtml#ch07list6">Listing 7-6</a> is complete, the stack contains</p>&#13;
<pre>33 68 76 82 79 87 32 79 76 76 69 72</pre>&#13;
<p class="noindent">which the final line of <a href="ch07.xhtml#ch07list6">Listing 7-6</a> outputs by enabling character mode (<span class="literal">$</span>) and repeatedly popping the stack and printing (<span class="literal">@c</span>). Before the final character is output, <span class="literal">e</span> turns on newline mode.</p>&#13;
<p class="indent">Now, let’s do some math with ABC2.</p>&#13;
<h4 class="h4" id="lev2sec60"><strong><em>A Slice of Pi</em></strong></h4>&#13;
<p class="noindent">I’m writing this section on March 14th, which, using American-style dates, is 3/14—Pi Day. Therefore, in honor of everyone’s favorite mathematical constant, our next example uses ABC2 to estimate the value of <em>π</em> = 3<em>.</em>14159<em>…</em> using nothing more than random integers.</p>&#13;
<p class="indent">The area of a circle is <em>A</em><sub>circle</sub> = <em>πr</em><sup>2</sup>, where <em>r</em> is the radius, the distance from the center to the edge. If we set <em>r</em> = 1, the area of the resulting circle is <em>A</em><sub>circle</sub> = <em>π</em>(1)<sup>2</sup> = <em>π</em>. A circle of radius 1 has a diameter of 2. If this circle is centered at the origin, the diameter goes from <em>–</em>1 to +1. Now imagine a square with a side length of 2 set over the circle. The square is <em>circumscribed</em> over the circle (see <a href="ch07.xhtml#ch07fig1">Figure 7-1</a>).</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_206"/><img id="ch07fig1" src="Images/07fig01.jpg" alt="Image" width="324" height="327"/></div>&#13;
<p class="figcap"><em>Figure 7-1: A square circumscribed over a circle of radius 1</em></p>&#13;
<p class="indent">We’ll get to the dots in <a href="ch07.xhtml#ch07fig1">Figure 7-1</a> momentarily. For now, just consider the relationship between the square and the circle. If the square’s side is 2, its area is <em>A</em><sub>square</sub> = <em>s</em><sup>2</sup> = (2)<sup>2</sup> = 4.</p>&#13;
<p class="indent">The ratio between the areas of the circle and the square is <em>A</em><sub>circle</sub>/<em>A</em><sub>square</sub> = <em>π</em>/4. This ratio remains even if we only consider the first quadrant, that is, one quarter of the shapes (where the dots are in <a href="ch07.xhtml#ch07fig1">Figure 7-1</a>). The area of the circle in quadrant one is one quarter of <em>π</em>, that is, <em>π</em>/4, and the area of the square in quadrant one is 4/4 = 1, meaning the ratio between the two is <em>π</em>/4/1 = <em>π</em>/4.</p>&#13;
<p class="indent">Okay, so what? Well, if we had an estimate of the area of the circle and the square in quadrant one, we’d be able to divide the two and expect that it matches <em>π</em>/4. Here’s where the dots in <a href="ch07.xhtml#ch07fig1">Figure 7-1</a> come into the picture. They represent random points in the range [0,1) in both <em>x</em> and <em>y</em>. What if we generate many of these random points? In a sense, the points will slowly fill in the area of both the circle and the square. If we count how many land within the circle and divide by those that land within the square, which is all of them because we are using [0, 1), we’ll have an estimate of the ratio between the circle and the square, which, as we just saw, is <em>π</em>/4. Therefore, if multiplied by 4, this ratio should give us an estimate of <em>π</em>, which is exactly what we want.</p>&#13;
<p class="indent">Great! Let’s select random values in the range [0,1) and start counting how many land within the circle. How do we know if the point is within the circle? That’s straightforward. It’s really an application of the Pythagorean theorem: <em>c</em><sup>2</sup> = <em>a</em><sup>2</sup> + <em>b</em><sup>2</sup>, where <em>a</em> is <em>x</em> and <em>b</em> is <em>y</em>. The circle is centered at the origin and has a radius of 1. If <em>x</em><sup>2</sup> + <em>y</em><sup>2</sup>—the distance from the origin to the randomly selected point—is less than the radius squared, then the point is within the circle. For the circle, <em>r</em><sup>2</sup> = 1, so the point is within the circle if its distance from the origin is less than 1.</p>&#13;
<p class="indent">We need two counters. The first counts every randomly generated point because [0,1) covers the entire area of the square in quadrant one. This means that every point lands within the square so no test is needed. We’ll <span epub:type="pagebreak" id="page_207"/>call this counter <span class="literal">S</span>. The second counter is for all the points that land within the circle, (<em>x</em>, <em>y</em>), where <em>x</em><sup>2</sup> + <em>y</em><sup>2</sup> &lt; 1. We’ll call this counter <span class="literal">C</span>.</p>&#13;
<p class="indent">Here’s the algorithm we want to code:</p>&#13;
<pre>S = C = 0&#13;
Loop forever:&#13;
    x = [0,1)&#13;
    y = [0,1)&#13;
    S = S + 1&#13;
    if (x*x + y*y &lt; 1):&#13;
        C = C + 1&#13;
    print 4*C/S</pre>&#13;
<p class="noindent">On every pass through the loop, the code selects a new (<em>x</em>, <em>y</em>) point, increments <span class="literal">S</span>, and if the point is within the circle, increments <span class="literal">C</span>. The ratio, then, will approach <em>π</em>/4, which when multiplied by 4 is an estimate for <em>π</em>.</p>&#13;
<p class="indent">Of course, you’ve likely already noticed the problem. ABC2 works with integers only. The algorithm expects floating-point numbers. Are we stymied? No, we’re not. We want a ratio of two areas, one for the circle and one for the square. We aren’t really restricted to the range [0,1). What if we use integers and select points in the range [0,1,000,000,000)? ABC2 has no difficulty working with integers in that range. If we scale the <em>x</em> and <em>y</em> by one billion, then the limit we check scales by the square of that. So instead of checking if <em>x</em><sup>2</sup> + <em>y</em><sup>2</sup> &lt; 1, we check if <em>x</em><sup>2</sup> + <em>y</em><sup>2</sup> &lt; 10<sup>18</sup>, one billion squared. Again, ABC2, thanks to our Python implementation, has no difficulty with an integer like 10<sup>18</sup>.</p>&#13;
<p class="indent">Therefore, our algorithm remains the same, and only the limits on the random numbers and the distance from the origin change. However, our output must change as well. We won’t calculate <span class="literal">4*C/S</span>, but instead display <span class="literal">C/S</span> <em>as a fraction</em>. That is, literally as <span class="literal">C</span> followed by a <span class="literal">/</span> and then <span class="literal">S</span>. At any point, we can take an output value, dump it in a calculator to get the actual floating-point ratio, and multiply by 4 to get the current estimate of <em>π</em>.</p>&#13;
<p class="indent">The code we need is in <a href="ch07.xhtml#ch07list7">Listing 7-7</a> and <em>pi.abc2</em>.</p>&#13;
<pre>!                                        PUT A ON STACK&#13;
naaaaaaaaaa!!*@!!*@!!*naaaaaaaaaa!*@     A IS 1 BILLION&#13;
r!!*                                     X SQUARED&#13;
naaaaaaaaaa!!*@!!*@!!*naaaaaaaaaa!*@     A IS 1 BILLION&#13;
r!!*                                     Y SQUARED&#13;
+                                        XX PLUS YY&#13;
naaaaaaaaaa!!*@!!*@!!*naaaaaaaaaa!*@!!*  10 TO THE 18TH&#13;
&lt;+                                       INC C IF LESS THAN&#13;
^a^                                      INC S&#13;
@!c                                      PRINT C&#13;
naaaaaaaaaa!!+@!!+@aaaaaaa$c$            PRINT SLASH&#13;
^ece^                                    PRINT S&#13;
@l                                       LOOP</pre>&#13;
<p class="caption" id="ch07list7"><em>Listing 7-7: Estimating <span class="codeitalic1">π</span> with random numbers</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_208"/>We’ll use accumulator B to hold <span class="literal">S</span> and the stack to hold <span class="literal">C</span>. When the program starts, accumulators A and B are both zero. So we push A on the stack to initialize the counter.</p>&#13;
<p class="indent">We’ll use <span class="literal">r</span> to select a random integer in [0, 10<sup>9</sup>), so we need to make A one billion. That’s what the second line of <a href="ch07.xhtml#ch07list7">Listing 7-7</a> does. First A is 10, then after squaring by pushing it on the stack twice, A is 100. Then 100 × 100 = 10,000 and 10,000 × 10,000 = 100,000,000 on the stack. A final multiplication by 10 sets A to one billion. That was the painful part. Selecting a random value and squaring it is <span class="literal">r!!*</span> to select the value, push it on the stack twice, then multiply. The stack now contains <span class="literal">( C x*x -- )</span>. The next two lines of <a href="ch07.xhtml#ch07list7">Listing 7-7</a> repeat the previous two to get <em>y</em><sup>2</sup> on the stack so <span class="literal">+</span> can add them together.</p>&#13;
<p class="indent">The stack now contains <span class="literal">C</span> followed by the square of the distance of the random point, (<em>x</em>, <em>y</em>), from the origin. We must increment <span class="literal">C</span> if this distance is less than 10<sup>18</sup>, so we use an approach similar to setting A to one billion to get 10<sup>18</sup> on the stack. The stack is now <span class="literal">(C x*x+y*y 10**18 -- )</span>.</p>&#13;
<p class="indent">The less-than command, <span class="literal">&lt;</span>, performs the comparison and leaves 0 or 1 on the stack. This is particularly convenient. If the comparison is false, that is, the distance isn’t less than 10<sup>18</sup>, we get 0; otherwise, we get 1, so the stack is <span class="literal">( C 0|1 -- )</span>. Either way, adding this result to <span class="literal">C</span> works. If the comparison is true, the 1 is on the stack, which increments <span class="literal">C</span> for us. Otherwise, there’s no harm in adding 0 to <span class="literal">C</span>. Because of this happy arrangement, the only branching necessary is the loop at the end of the program to generate the next point.</p>&#13;
<p class="indent">We’ve incremented <span class="literal">C</span>, if necessary, but we still need to increment <span class="literal">S</span>. As it’s in accumulator B, incrementing is particularly easy: switch to accumulator B, increment with <span class="literal">a</span>, and then switch back to accumulator A with <span class="literal">^a^</span> .</p>&#13;
<p class="indent">We’re ready to display our current estimate for <em>π</em>/4. First, we print <span class="literal">C</span> and return it to the stack so it isn’t lost (<span class="literal">@!c</span>). Then, we set A to 47, the ASCII code for a slash, and display it with <span class="literal">$c$</span>. Lastly, we switch to accumulator B, toggle newline mode with <span class="literal">e</span>, and print <span class="literal">S</span>, remembering to turn off newline mode and toggle back to accumulator A.</p>&#13;
<p class="indent">The first instruction is <span class="literal">!</span> to store A on the stack, meaning store <span class="literal">C</span>. Just before we loop, we pull <span class="literal">C</span> off the stack with <span class="literal">@</span> and then loop with <span class="literal">l</span>.</p>&#13;
<p class="indent">The program runs forever, generating ever better estimates of <em>π</em>/4. Let’s see how well it does. For one run of the program, the first few iterations output are</p>&#13;
<pre>  1/1,   2/2,   3/3,   4/4,   5/5,   &#13;
  5/6,   6/7,   7/8,   8/9,  9/10, &#13;
10/11, 11/12, 11/13, 12/14, 13/15, &#13;
14/16, 15/17, 16/18, 17/19, 18/20, &#13;
19/21</pre>&#13;
<p class="noindent">with the last iteration giving an estimate of <em>π</em> ≈ 4(19)/21 = 3<em>.</em>6190476. Not too good, but the program’s just started. The output a second or two later <span epub:type="pagebreak" id="page_209"/>was <em>π</em> ≈ 4(992)/1280 = 3<em>.</em>1, so it’s heading in the right direction. After about 15 seconds, the estimate was <em>π</em> ≈ 4(44893)/57153 = 3<em>.</em>1419523, which is definitely in the ballpark.</p>&#13;
<p class="indent">How quickly does the output approach <em>π</em>? If we capture the program’s output and plot the estimate of <em>π</em> as a function of the iteration number, we arrive at <a href="ch07.xhtml#ch07fig2">Figure 7-2</a>, which shows the convergence as iterations proceed. After some 100,000 iterations, the estimate was 3.1416803, which is accurate to nearly four decimals.</p>&#13;
<div class="image"><img id="ch07fig2" src="Images/07fig02.jpg" alt="Image" width="678" height="386"/></div>&#13;
<p class="figcap"><em>Figure 7-2: The estimate of <em>π</em> as a function of iteration number</em></p>&#13;
<p class="indent"><a href="ch07.xhtml#ch07fig2">Figure 7-2</a> shows that many iterations are necessary to get close to <em>π</em>—around 25,000 or so. This isn’t too surprising, as we’re trying to replace an actual area with a collection of random points. You might feel a little unsettled as a point has no area, so how can a collection of them have an area? I think of it this way: imagine that infinite space is actually discrete. In that sense, an area is a collection of (extremely) tiny cells (think pixels) where the random points fill in an ever-increasing set of cells. The difference here is that a cell <em>does</em> have an area, even if a tiny one, and all of the cells together tile the circle and square. From that point of view, we randomly fill cell after cell to arrive at a better and better estimate of the actual circle and square areas. We would expect over time to get a better and better estimate of <em>π</em>/4, and ultimately <em>π</em>.</p>&#13;
<p class="indent">I hope you enjoyed this little Pi Day example. It’s nice that ABC2, for all its simplicity, can do something like this and that the logical operators for ABC2 happened to give exactly the right value in the right place (that is, on the stack above <span class="literal">C</span>) so no painful looping construct was necessary.</p>&#13;
<p class="indent">Now, let’s develop our version of an early computing machine, and learn a bit about its remarkable, though largely unknown, inventor.</p>&#13;
<h4 class="h4" id="lev2sec61"><span epub:type="pagebreak" id="page_210"/><strong><em>The Electromechanical Arithmometer</em></strong></h4>&#13;
<p class="noindent">You’ve likely never heard of Leonardo Torres y Quevedo (sometimes written as Leonardo Torres Quevedo). Before I started writing my first book, I had never heard of him, either. If you have heard of him, fantastic.</p>&#13;
<p class="indent">Torres Quevedo was a Spanish inventor born in the mid-19th century. His many accomplishments include cable cars, dirigibles, an early form of remote control, a working chess-playing automaton, and, of most interest to us, the electromechanical arithmometer. An arithmometer is a 19th-century mechanical calculator. Torres Quevedo’s version, presented in Paris in 1920 (see <a href="ch07.xhtml#ch07fig3">Figure 7-3</a>), was electronic and mechanical.</p>&#13;
<div class="image"><img id="ch07fig3" src="Images/07fig03.jpg" alt="Image" width="590" height="416"/></div>&#13;
<p class="figcap"><em>Figure 7-3: The electromechanical arithmometer circa 1920. Image used with the kind permission of Francisco A. González Redondo, Universidad Complutense, Madrid.</em></p>&#13;
<p class="indent">On the right of <a href="ch07.xhtml#ch07fig3">Figure 7-3</a> is a typewriter. This was the keyboard used by the operator. The operator put paper in the typewriter and proceeded to type an expression such as <span class="literal">123 × 321 =</span> to which the machine would respond by typing <span class="literal">39483</span> on the same line before advancing the paper to the next line. Recall that this was 1920, well before the first true electronic computers and before the pioneering work of Konrad Zuse. Torres Quevedo showed the electromechanical arithmometer and then put it aside. It was never marketed.</p>&#13;
<p class="indent">We’ll get back to <a href="ch07.xhtml#ch07fig3">Figure 7-3</a> in a little bit, but, as this is a book on programming languages, it seems fitting to point out that not only did Torres Quevedo build such an impressive machine, he also, even earlier, worked through what it means to implement floating-point arithmetic in a machine-friendly way. In his 1914 work “Essays on Automatics,” he writes that numbers should be stored as <em>n</em> × 10<sup><em>m</em></sup>, which is how we store floating-point numbers now: <em>n</em> × 2<sup><em>m</em></sup>. A problem with floating-point is that numbers in scientific <span epub:type="pagebreak" id="page_211"/>notation are not unique: 3<em>.</em>1415 × 10<sup>0</sup> = 0<em>.</em>31415 × 10<sup>1</sup> = 31<em>.</em>415 × 10<sup><em>–</em>1</sup>. Torres Quevedo understood this, so he proposed the following rules to store numbers in a consistent way for a machine to process:</p>&#13;
<ol>&#13;
<li class="noindent"><em>n</em> will always be the same number of digits (six, for example).</li>&#13;
<li class="noindent">The first digit of <em>n</em> will be in the order of tenths, the second in  hundredths, and so on.</li>&#13;
<li class="noindent">One will write each quantity in the form: <em>n;m</em>.</li>&#13;
</ol>&#13;
<p class="indent">Modern computers store floating-point numbers with a fixed size <em>n</em>; for example, 52 bits for a C <span class="literal">double</span> (really 53 bits; a leading 1 is implied as the integer part of the significand, 1<em>.b</em><sub>51</sub> <em>b</em><sub>50</sub><em>…</em><em>b</em><sub>0</sub>). It’s clear that Torres Quevedo was thinking in base-10, but the idea of fixing the significand size was key. Zuse, mentioned above, was likely the first to implement floating-point numbers in computers in base-2, much as we do now—see the IEEE 754 standard.</p>&#13;
<p class="indent">One last observation on Torres Quevedo’s floating-point format before we get back to the electromechanical arithmometer. Notice that he suggests, again in 1914, that floating-point numbers be written as <em>n;m</em>. So using his rules, he would write <em>π</em> as 0.314159;1, meaning 0<em>.</em>314159 × 10<sup>1</sup> = 3<em>.</em>14159. This is very close to how floating-point numbers are entered today: 0.314159e1. The only difference is using a semicolon (;) for <em>e</em>.</p>&#13;
<p class="indent">Okay, this is all very interesting, but what does it have to do with ABC2? One feature of ABC2 we have yet to explore is the <span class="literal">k</span> command, the command that reads a character from the keyboard and places its character code in the current accumulator. Let’s use this command to mimic Torres Quevedo’s arithmometer. We’ll restrict ourselves to multiplication only.</p>&#13;
<p class="indent">The code we’ll work with is in <em>multiply.abc2</em>. This is the most complex ABC2 program we’ll consider. Not only does it use <span class="literal">k</span> for input, it also uses <span class="literal">?</span>, the only conditional command available in ABC2.</p>&#13;
<p class="indent">Let’s begin with an outline of what we want to accomplish. Leonardo’s arithmometer let the user type a number, an operation, and a second number. We’re fixing the operation, multiplication, so what we need from the user are two numbers—specifically, two three-digit numbers—though the leading digits might be zero. The <span class="literal">k</span> instruction gets one character from the keyboard, so how will we turn characters into numbers?</p>&#13;
<p class="indent">The first thing to notice is that the ASCII code for zero is 48. The ASCII codes for the digits follow in order, meaning that 49 is one, 50 is two, and so on. Therefore, if the user presses 3, the accumulator will contain 51. Subtracting 48 from 51 leaves 3. To convert the ASCII code for a digit into the digit itself we would subtract 48. We now know how to get single digits. But what about a three-digit number?</p>&#13;
<p class="indent">We have a three-digit number, 451. In grade school, you likely learned how to write numbers in expanded form as</p>&#13;
<p class="equationc">451 = 400 + 50 + 1</p>&#13;
<p class="noindent"><span epub:type="pagebreak" id="page_212"/>but there’s another way to expand a number:</p>&#13;
<table class="all5">&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">451</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">= (((4 × 10) + 5) × 10) + 1</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td/>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">= ((40 + 5) × 10) + 1</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td/>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">= (45 × 10) + 1</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td/>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">= 450 + 1</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td/>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">= 451</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="noindent">Expanding a number this way points us toward an algorithm for entering three digits and converting them to a three-digit number:</p>&#13;
<ol>&#13;
<li class="noindent">Get the first digit, multiply by 10, and store it on the stack.</li>&#13;
<li class="noindent">Get the second digit and add it to the number on the stack.</li>&#13;
<li class="noindent">Multiply the number on the stack by 10.</li>&#13;
<li class="noindent">Get the third digit and add it to the number on the stack.</li>&#13;
</ol>&#13;
<p class="indent">When these steps are complete, the stack contains the three-digit number the user entered character by character. Let’s follow the steps and see if they work.</p>&#13;
<pre>User enters 4,  stack: 4&#13;
Multiply by 10, stack: 40&#13;
User enters 5,  stack: 40 5&#13;
Add,            stack: 45&#13;
Multiply by 10, stack: 450&#13;
User enters 1,  stack: 450 1&#13;
Add,            stack: 451</pre>&#13;
<p class="indent">The steps work. The user entered 4, 5, and 1, and the stack holds the number 451. When implemented in ABC2, there is one additional step: after the user enters the digit, we must subtract 48 to convert the character code to the digit value.</p>&#13;
<p class="indent">We know how to get a number from the user. To implement the “arithmometer,” we must get two numbers from the user, each on the stack, and multiply.</p>&#13;
<p class="indent"><a href="ch07.xhtml#ch07list8">Listing 7-8</a> shows all of <em>multiply.abc2</em>.</p>&#13;
<pre>ENTER TWO THREE DIGIT NUMBERS AND MULTIPLY THEM&#13;
QUIT IF THE FIRST CHARACTER OF THE FIRST NUMBER IS ESC&#13;
&#13;
^naaaaa!aaaaa!*@bb  B IS 48&#13;
^k!!                FIRST KEYPRESS&#13;
naaa!aaaaaa!*=?q    QUIT IF ESC PRESSED&#13;
@!$c$^!^-           FIRST DIGIT&#13;
naa!aaa!**          TIMES TEN&#13;
k$c$!^!^-+          SECOND DIGIT&#13;
naa!aaa!**          TIMES TEN&#13;
k$c$!^!^-+          THIRD DIGIT<span epub:type="pagebreak" id="page_213"/>&#13;
naaaa!aaaa!*@$c     SPACE&#13;
aaaaaaaaaac         TIMES&#13;
bbbbbbbbbbc$        SPACE&#13;
k$c$!^!^-           FIRST DIGIT&#13;
naa!aaa!**          TIMES TEN&#13;
k$c$!^!^-+          SECOND DIGIT&#13;
naa!aaa!**          TIMES TEN&#13;
k$c$!^!^-+          THIRD DIGIT&#13;
naaaa!aaaa!*@$c     SPACE&#13;
!!+@bbbc            EQUALS&#13;
naaaa!aaaa!*@c$     SPACE&#13;
*@ecel              PRODUCT AND LOOP</pre>&#13;
<p class="caption" id="ch07list8"><em>Listing 7-8: Multiplying pairs of numbers</em></p>&#13;
<p class="indent">The first line has the comment <span class="literal">B IS 48</span>. This line switches to accumulator B ( <span class="literal">^</span> ) and makes sure it is 0, which is necessary because we loop. It then increments to 5, pushes it on the stack, and increments five more times to push 10 on the stack. Multiplying leaves 50 on the stack, which is popped off the stack to accumulator B (<span class="literal">@</span>) and finally decremented twice to leave B equal to 48. This is the constant we need to subtract from the digit ASCII codes the user will enter. For this program, we use B as a constant. When needed, we switch to accumulator B, push its value on the stack, and then immediately switch back to accumulator A.</p>&#13;
<p class="indent">The next line is <span class="literal">FIRST KEYPRESS</span>, <span class="literal">^ k!!</span>. The <span class="literal">^</span> statement toggles back to accumulator A. We read a character from the keyboard (<span class="literal">k</span>) and push it on the stack twice with <span class="literal">!!</span>. We push it twice because program will loop to ask the user for pairs of numbers repeatedly. For the first digit, if the user presses ESC (ASCII 27), we want to exit the program instead. We push the first digit twice, once to use in calculating the number as we did above, and a second time to compare the key to ESC.</p>&#13;
<p class="indent">The <span class="literal">QUIT IF ESC PRESSED</span> line checks if the top stack value is 27. First, we set A to 27 with <span class="literal">naaa!aaaaaa!*</span>. We increment A to 3 and push it onto the stack, and then increment six more times to 9 and push it onto the stack and multiply the two numbers to leave 27 on the stack with the ASCII code of the character the user entered immediately below it. Executing <span class="literal">=</span> checks if the top two stack items are equal. While <span class="literal">?</span> pops the stack, if the top stack value is true (not 0), the program executes the command immediately after <span class="literal">?</span>. Otherwise, it skips the next command and execution continues with the following command. In this case, the next command is <span class="literal">q</span>, quit, so if the key the user pressed was ESC, the <span class="literal">=</span> left true on the stack for <span class="literal">?</span> to pick up and, because it’s true, execute <span class="literal">q</span> to end the program.</p>&#13;
<p class="indent">We’ve checked whether the first key is ESC, but we have not yet displayed the key nor subtracted 48 to get its digit value. It’s currently on the stack, so we load it back into accumulator A with <span class="literal">@!</span>: <span class="literal">@</span> to pull it from the stack into accumulator A and <span class="literal">!</span> to push it back to the stack because we need it there as well. Next, <span class="literal">$c$</span> prints the character by switching to character mode, printing with <span class="literal">c</span>, and switching back to number mode.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_214"/>To subtract 48, we use <span class="literal">^ ! ^ -</span>. This pattern repeats throughout the program every time we need to subtract 48. It switches to accumulator B, pushes B on the stack, switches back to accumulator A, and subtracts. The stack now contains the digit value, which must be multiplied by 10 via <span class="literal">naa!aaa!**</span>, which puts 2 and then 5 on the stack, multiplies them to get 10, and finally multiplies the digit value by 10. This pattern also repeats whenever a digit value must be multiplied by 10.</p>&#13;
<p class="indent">The first digit is a special case because we need to check for ESC. The remaining five digits are essentially the same: <span class="literal">k$c$!^!^-+</span> to get the digit, display it, push it, push 48, subtract, and then add the digit value to the value already on the stack. If necessary, this pattern is followed by the multiply-by-10 pattern.</p>&#13;
<p class="indent">The other lines in <a href="ch07.xhtml#ch07list8">Listing 7-8</a> handle necessary text output. The final line is <span class="literal">*@ecel</span>. The stack now contains the two numbers the user entered, so <span class="literal">*</span> multiplies them and <span class="literal">@</span> pulls the result into accumulator A for display with <span class="literal">ec</span>, where <span class="literal">e</span> turns on newline mode. To go back and get another pair of numbers, we first turn off newline mode and then loop <span class="literal">l</span>.</p>&#13;
<p class="indent">The description above is necessarily dense. Do review the code to see what it does and try some of the patterns in interactive mode as well. Let’s see what the output of <em>multiply.abc2</em> looks like; however, naturally, in print you won’t see the flow.</p>&#13;
<pre><span class="codestrong1">123</span> * <span class="codestrong1">321</span> = 39483&#13;
<span class="codestrong1">451</span> * <span class="codestrong1">359</span> = 161909&#13;
<span class="codestrong1">999</span> * <span class="codestrong1">999</span> = 998001&#13;
<span class="codestrong1">002</span> * <span class="codestrong1">003</span> = 6</pre>&#13;
<p class="noindent">Although not as impressive as Torres Quevedo’s electromechanical arithmometer, we might argue there’s at least some utility to a little program like this. As an exercise, extend <em>multiply.abc2</em> to accept four-digit numbers. Note that there is no check to ensure that the key pressed is actually a valid digit. The program is happy with any keypress; however, the results will not be meaningful in that case.</p>&#13;
<p class="indent">Let’s bid Torres Quevedo a fond farewell and conclude our ABC2 adventure with a short discussion.</p>&#13;
<h3 class="h3" id="lev1sec56"><strong>Discussion</strong></h3>&#13;
<p class="noindent">This chapter began with the esolang wiki description of ABC and our Python implementation. It is abundantly clear that as a programming language, ABC isn’t even remotely Turing complete. Nor was it meant to be; it was just a cute idea for something capable of simple tasks. We then extended ABC to create ABC2. Is ABC2 Turing complete? No, it isn’t. There are only two memory locations and a stack that cannot be accessed cell-by-cell like an array.</p>&#13;
<p class="indent">What might make ABC2 Turing complete? One might imagine ABC3, with the stack and, instead of two accumulators, an “infinite” set of accumulators accessible by index. In other words, an array. That scenario would use <span epub:type="pagebreak" id="page_215"/>the stack much like the arithmetic logic unit of a CPU and the accumulators as memory. I suspect such a language might be Turing complete. I might make it as it wouldn’t be difficult. Better still, you make it, and if you feel like sharing, send it to me and I’ll put it on the book’s GitHub site.</p>&#13;
<p class="indent">ABC2’s stack is limited because there are no intrinsic commands to manipulate it like DUP, SWAP, ROT, and OVER in Forth. Or is that really the case?</p>&#13;
<p class="indent">ABC2 does not have stack manipulation commands, but we can create patterns that function like stack words, provided we don’t need to preserve the contents of the accumulators.</p>&#13;
<p class="indent">For example, these ABC2 patterns act like the given Forth word:</p>&#13;
<pre>@!!         DUP&#13;
@x!         SWAP&#13;
@           DROP&#13;
@^@x!^x!    ROT&#13;
^@^@!^!^!   OVER</pre>&#13;
<p class="noindent">Run ABC2 in interactive mode and give them a try. Use <span class="literal">;</span> to show the stack.</p>&#13;
<p class="indent">The ABC2 examples in this chapter showed repeating patterns of code. This happens in all languages—think of the design patterns often used in software development. The <em>multiply.abc2</em> example, in particular, used several repeating patterns of code to push a constant on the stack, get a digit from the user, and multiply by 10. As each command in ABC2 is itself a single character, the patterns become words. Space is not an ABC2 command, meaning we could write code with the patterns as words, words that, with time, “experienced” ABC2 coders (keep your eye on the Help Wanted ads) would learn to recognize.</p>&#13;
<p class="indent">For example, one pattern in <em>multiply.abc2</em> is <span class="literal">k$c$!^!^-+</span>, which gets a character and adds its digit value to the number already on the stack. This pattern (a sentence?) could be written as <span class="literal">k $c$ ! ^!^ - +</span> to separate the commands into words with meaning. Another pattern stored a constant in accumulator B. In one instance, the constant was <em>–</em>7 to use with <span class="literal">g</span> for branching in a loop. The other was 48, which is the number we needed to subtract from the ASCII character code for a digit. Using accumulator B as a constant argues in favor of a language like ABC3, where we’d have as many variables as we need.</p>&#13;
<p class="indent">In the end, ABC and ABC2 are toy languages, as esolangs often are. They are fun to think about, fun to implement, and fun to experiment with. They also help us appreciate the careful thought that went into designing the programming languages we use daily.</p>&#13;
<h3 class="h3" id="lev1sec57"><strong>Summary</strong></h3>&#13;
<p class="noindent">This chapter introduced an exceedingly simple esolang called ABC. We took its language description, all that implementors generally have to work with, and built a Python implementation. We quickly understood the language’s <span epub:type="pagebreak" id="page_216"/>limitations and extended it to make ABC2, a language with more capabilities that maintained backward compatibility with the original ABC.</p>&#13;
<p class="indent">We developed a few examples in ABC2 and had some fun with them. We learned how to estimate the value of <em>π</em> by using random numbers. We then paid tribute to an early computer pioneer, Leonardo Torres y Quevedo, with a program mimicking his electromechanical arithmometer from 1920. During that exercise, we learned that ABC2 lends itself to coding patterns we might call words (with apologies to Forth), and that ABC2 programs could be written as a series of words, that is, sentences.</p>&#13;
<p class="indent">ABC and ABC2 were perfect introductions to our esolang exploration. Let’s move on now to FRACTRAN, perhaps the most intellectually interesting esolang we’ll encounter.</p>&#13;
</div></body></html>