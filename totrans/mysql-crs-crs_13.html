<html><head></head><body>
<div id="book-content">
<div id="sbo-rt-content"><section>
<header>
<h1 class="chapter">
<span class="ChapterNumber"><span epub:type="pagebreak" title="159" id="Page_159"/><a class="XrefDestination" id="10"/><span class="XrefDestination" id="xref-503007c10-001"/>10</span><br/>
<span class="ChapterTitle"><a class="XrefDestination" id="CreatingViews"/><span class="XrefDestination" id="xref-503007c10-002"/>Creating Views</span></h1>
</header>
<figure class="opener">
<img src="image_fi/book_art/chapterart.png" alt="" width="200" height="200"/>
</figure>
<p class="ChapterIntro">In this chapter, you’ll learn how to create and use views. <em>Views</em> are virtual tables based on the output of a query you write to customize the display of your result set. Each time you select from a view, MySQL reruns the query that you defined the view with, returning the latest results as a table-like structure with rows and columns.</p>
<p>Views are useful in situations where you want to simplify a complex query or hide sensitive or irrelevant data.</p>
<h2 id="h1-503007c10-0001"><a class="XrefDestination" id="CreatingaNewView"/><span class="XrefDestination" id="xref-503007c10-003"/>Creating a New View</h2>
<p class="BodyFirst">You create a view using the <code>create view</code> syntax. Let’s look at an example with the following <code>course</code> table:</p>
<pre><code>course_name                              course_level
---------------------------------------  ------------
Introduction to Python                   beginner
<span epub:type="pagebreak" title="160" id="Page_160"/>Introduction to HTML                     beginner
React Full-Stack Web Development         advanced
Object-Oriented Design Patterns in Java  advanced
Practical Linux Administration           advanced
Learn JavaScript                         beginner
Advanced Hardware Security               advanced</code></pre>
<p>Here you create a view named <code>v_course_beginner</code> that selects all columns with a <code>course_level</code> of <code>beginner</code> from the <code>course</code> table:</p>
<pre><code>create view v_course_beginner as
select *
from   course
where  level = 'beginner';</code></pre>
<p>Running this statement creates the view and saves it in your MySQL database. Now you can query the <code>v_course_beginner</code> view at any time, like so:</p>
<pre><code>select * from v_course_beginner;</code></pre>
<p>The results are:</p>
<pre><code>course_name             course_level
----------------------  ------------
Introduction to Python  beginner
Introduction to HTML    beginner
Learn JavaScript        beginner</code></pre>
<p>Since you defined the view by selecting <code>*</code> (the wildcard character) from the <code>course</code> table, it has the same column names as the table.</p>
<p>The <code>v_course_beginner</code> view should be used by beginner students, so you selected only courses from the table with a <code>course_level</code> of <code>beginner</code>, hiding the advanced courses.</p>
<p>Now create a second view for advanced students that includes just advanced courses:</p>
<pre><code>create view v_course_advanced as
select *
from   courses
where  level = 'advanced';</code></pre>
<p>Selecting from the <code>v_course_advanced</code> view displays the advanced courses:</p>
<pre><code>select * from v_course_advanced;</code></pre>
<p>The results are:</p>
<pre><code>course_name                              course_level
---------------------------------------  ------------
React Full-Stack Web Development         advanced
Object-Oriented Design Patterns in Java  advanced
Practical Linux Administration           advanced
Advanced Hardware Security               advanced</code></pre>
<p><span epub:type="pagebreak" title="161" id="Page_161"/>When you defined the <code>v_course_advanced</code> view, you provided MySQL with a query that selects data from the <code>course</code> table. MySQL runs this query each time the view is used, meaning that the view is always up to date with the latest rows from the <code>course</code> table. In this example, any new advanced courses added to the <code>course</code> table will be shown each time you select from the <code>v_course_advanced</code> view.</p>
<p>This approach allows you to maintain your courses in the <code>course</code> table and provide different views of the data to beginner and advanced students.</p>
<h2 id="h1-503007c10-0002"><a class="XrefDestination" id="UsingViewstoHideColumnValues"/><span class="XrefDestination" id="xref-503007c10-004"/>Using Views to Hide Column Values</h2>
<p class="BodyFirst">In the <code>course</code> table example, you created views that displayed certain rows from the table and hid others. You can also create views that display different <em>columns</em>.</p>
<p>Let’s look at an example of using views to hide sensitive column data. You have two tables, <code>company</code> and <code>complaint</code>, that help track complaints for local companies.</p>
<p>The <code>company</code> table is as follows:</p>
<pre><code>company_id  company_name          owner          owner_phone_number
----------  --------------------  -------------  ------------------
1           Cattywampus Cellular  Sam Shady         784-785-1245
2           Wooden Nickel Bank    Oscar Opossum     719-997-4545
3           Pitiful Pawn Shop     Frank Fishy       917-185-7911</code></pre>
<p>And here’s the <code>complaint</code> table:</p>
<pre><code>complaint_id  company_id  complaint_desc
------------  ----------  ------------------------------
1                 1       Phone doesn't work
2                 1       Wi-Fi is on the blink
3                 1       Customer service is bad
4                 2       Bank closes too early
5                 3       My iguana died
6                 3       Police confiscated my purchase</code></pre>
<p>You’ll start by writing a query to select information about each company and a count of its received complaints:</p>
<pre><code>select   a.company_name,
         a.owner,
         a.owner_phone_number,
         count(*)
from     company a
join     complaint b
on       a.company_id = b.company_id
group by a.company_name,
         a.owner,
         a.owner_phone_number;</code></pre>
<p><span epub:type="pagebreak" title="162" id="Page_162"/>The results are:</p>
<pre><code>company_name         owner          owner_phone_number  count(*)
-------------------- -------------  ------------------  --------
Cattywampus Cellular Sam Shady         784-785-1245         3
Wooden Nickel Bank   Oscar Opossum     719-997-4545         1
Pitiful Pawn Shop    Frank Fishy       917-185-7911         2</code></pre>
<p>To display the results of this query in a view called <code>v_complaint</code>, simply add the <code>create view</code> syntax as the first line of the original query:</p>
<pre><code><b>create view v_complaint as</b>
select   a.company_name,
         a.owner,
         a.owner_phone_number,
         count(*)
from     company a
join     complaint b
on       a.company_id = b.company_id
group by a.company_name,
         a.owner,
         a.owner_phone_number;</code></pre>
<p>Now, the next time you want to get a list of companies with a count of complaints, you can simply type <code>select * from v_complaint</code> instead of rewriting the entire query.</p>
<p>Next, you’ll create another view that hides the owner information. You’ll name the view <code>v_complaint_public</code>, and you’ll let all users of your database access the view. This view will show the company name and number of complaints, but not the owner’s name or phone number:</p>
<pre><code>create view v_complaint_public as
select   a.company_name,
         count(*)
from     company a
join     complaint b
on       a.company_id = b.company_id
group by a.company_name;</code></pre>
<p>You can query the view like so:</p>
<pre><code>select * from v_complaint_public;</code></pre>
<p>The results are:</p>
<pre><code>company_name         count(*)
-------------------- --------
Cattywampus Cellular    3
Wooden Nickel Bank      1
Pitiful Pawn Shop       2</code></pre>
<p><span epub:type="pagebreak" title="163" id="Page_163"/>This is an example of using a view to hide data stored in columns. While the owners’ contact information is in your database, you are withholding it by not selecting those columns in your <code>v_complaint_public</code> view.</p>
<p>Once you’ve created your views, you can use them as if they were tables. For example, you can join views to tables, join views to other views, and use views in subqueries.</p>
<h2 id="h1-503007c10-0003"><a class="XrefDestination" id="Inserting,Updating,andDeletingfromViews"/><span class="XrefDestination" id="xref-503007c10-005"/>Inserting, Updating, and Deleting from Views</h2>
<p class="BodyFirst">In <a class="xref" href="c09.xhtml">Chapter 9</a> you learned how to insert, update, and delete rows from tables. In some cases, it’s also possible to modify rows using a view. For example, the <code>v_course_beginner</code> view is based on the <code>course</code> table. You can update that view using the following <code>update</code> statement:</p>
<pre><code>update  v_course_beginner
set     course_name = 'Introduction to Python 3.1'
where   course_name = 'Introduction to Python';</code></pre>
<p>This <code>update</code> statement updates the <code>course_name</code> column in the <code>v_course_beginner</code> view’s underlying <code>course</code> table. MySQL is able to perform the update because the view and the table are so similar; for every row in the <code>v_course_beginner</code> view, there is one row in the <code>course</code> table.</p>
<p>Now, try to update the <code>v_complaint</code> view with a similar query:</p>
<pre><code>update  v_complaint
set     owner_phone_number = '578-982-1277'
where   owner = 'Sam Shady';</code></pre>
<p>You receive the following error message:</p>
<pre><code>Error Code: 1288. The target table v_complaint of the UPDATE is not updatable</code></pre>
<p>MySQL doesn’t allow you to update the <code>v_complaint</code> view, because it was created using multiple tables and the <code>count()</code> aggregate function. It’s a more complex view than the <code>v_course_beginner</code> view. The rules about which views allow rows to be updated, inserted, or deleted are fairly complicated. For this reason, I recommend changing data directly from tables and avoiding using views for this purpose.</p>
<h2 id="h1-503007c10-0004"><a class="XrefDestination" id="DroppingaView"/><span class="XrefDestination" id="xref-503007c10-006"/>Dropping a View</h2>
<p class="BodyFirst">To remove a view, use the <code>drop view</code> command:</p>
<pre><code>drop view v_course_advanced;</code></pre>
<p>While the view is removed from the database, the underlying table still exists.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="boxcustom1">
<h2><span epub:type="pagebreak" title="164" id="Page_164"/>Try it Yourself</h2>
<p class="BoxBodyFirst">The <code>corporate</code> database contains the following <code>employee</code> table:</p>
<pre><code>employee_name    department  position    home_address        date_of_birth
---------------  ----------  ----------  -----------------   -------------
Sidney Crumple   accounting  Accountant  123 Credit Road        1997-01-04
Al Ledger        accounting  Bookkeeper  2 Revenue Street       2002-11-22
Bean Counter     accounting  Manager     8 Bond Street          1996-04-29
Lois Crumple     accounting  Accountant  123 Debit Lane         2000-08-27
Lola Hardsell    sales       Sales Rep   66 Hawker Street       2000-07-09
Bob Closer       sales       Sales Rep   73 Peddler Way         1999-02-16</code></pre>
<p class="BoxListNumberCustom1"><b>10-1.</b>	Create a view called <code>v_employee_accounting</code> that has all employees in accounting.</p>
<p class="BoxListNumberCustom1"><b>10-2.</b>	Create a view called <code>v_employee_sales</code> that has all employees in sales.</p>
<p class="BoxListNumberCustom1"><b>10-3.</b>	Create a view called <code>v_employee_private</code> that has all employees in all departments. Hide the <code>home_address </code>and <code>date_of_birth</code> columns. Create three queries that <code>select * from</code> each view. Do they return what you expect?</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-503007c10-0005"><a class="XrefDestination" id="IndexesandViews"/><span class="XrefDestination" id="xref-503007c10-008"/>Indexes and Views</h2>
<p class="BodyFirst">You can’t add indexes to views to speed up your queries, but MySQL can use any indexes on the underlying tables. For example, the following query</p>
<pre><code>select  *
from    v_complaint
where   company_name like 'Cattywampus%';</code></pre>
<p class="BodyContinued">can take advantage of an index on the <code>company_name</code> column of the <code>company</code> table, since the <code>v_complaint</code> view is built on the <code>company</code> table.</p>
<h2 id="h1-503007c10-0006"><a class="XrefDestination" id="Summary"/><span class="XrefDestination" id="xref-503007c10-009"/>Summary</h2>
<p class="BodyFirst">In this chapter, you saw how to use views to provide a custom representation of your data. In the next chapter, you’ll learn how to write functions and procedures and add logic to them to perform certain tasks based on your data values.</p>
</section>
</div>
</div>
</body></html>