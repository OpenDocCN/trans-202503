<html><head></head><body>
<h2 class="h2" id="ch13"><span id="page_191"></span>
 <span class="big">13</span>
</h2>
<h2 class="h2a">
<strong>GETTING BIRTHDAY NOTIFICATIONS</strong>
</h2>
<div class="image1"><img src="Image00001.jpg" />
</div>
<p class="noindent">Now let’s finish BirthdayTracker by adding <em>local notifications</em>
 . A local notification is an alert that is sent to your phone from an app, even when the app isn’t running. The BirthdayTracker app will use a local notification to alert the user when they should wish a friend a happy birthday.</p>
<h3 class="h3" id="ch13lev1sec1">
<strong>THE USER NOTIFICATIONS FRAMEWORK</strong>
</h3>
<p class="noindent">Just as you used Apple’s Core Data framework to save birthdays on your phone in a database, you’ll use Apple’s User Notifications framework to send notifications to the user. Using this framework is easy! You just need to add an <span class="code">import</span>
 statement at the top of any class that deals with user notifications, like this:</p>
<div class="box">
<pre>
<span class="pink">import</span>
 UserNotifications</pre>
</div>
<p class="indent"><span id="page_192"></span>
 We’ll use the framework in three files—<em>AddBirthdayViewController.swift, AppDelegate.swift,</em>
 and <em>BirthdaysTableViewController.swift</em>
 —so add <span class="code">import UserNotifications</span>
 to each of them, below the other <span class="code">import</span>
 statements.</p>
<h4 class="h4" id="ch13lev2sec1">
<strong>REGISTERING FOR LOCAL NOTIFICATIONS</strong>
</h4>
<p class="noindent">Next, you need to have your app ask the user for permission to send notifications when it’s someone’s birthday. If you don’t have permission for notifications, they won’t be sent. You can get permission by having your app request authorization for notifications in your application delegate. This needs to be done as soon as the app starts, which is when it finishes launching. Luckily, there is a method in the <span class="code">AppDelegate</span>
 class called <span class="code">application(_:didFinishLaunchingWithOptions:)</span>
 that we can use to do this.</p>
<p class="indent">First, make sure that you added the line <span class="code">import UserNotifications</span>
 at the top of your <em>AppDelegate.swift</em>
 file. Next, add the following lines in <span class="code">application(_:didFinishLaunchingWithOptions:)</span>
 to request permission to send local notifications.</p>
<p class="noindent1">
<em>AppDelegate.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">func application(_ application: UIApplication, didFinishLaunchingWithOptions</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
  <span class="ent">➋</span>
 center.<span class="blue">requestAuthorization</span>
 (options: <span class="ent">➌</span>
 [.<span class="violet">alert</span>
 , .<span class="violet">sound</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
        completionHandler: <span class="ent">➍</span>
 { (granted, error) <span class="pink">in</span>
<br />
<br />
      <span class="ent">➎</span>
 <span class="pink">if</span>
 granted {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications granted!"</span>
 )<br />
        } <span class="pink">else</span>
 {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications denied."</span>
 )<br />
        }<br />
    })<br />
<br />
    <span class="ash">return true</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 gets the current <span class="code">UNUserNotificationCenter</span>
 and stores it in a constant called <span class="code">center</span>
 . The <em>notification center</em>
 is used to schedule and manage the notifications that you send from your app. In this chapter, we’ll use three methods from the <span class="code">UNUserNotificationCenter</span>
 class:</p>
<p class="hang">
<span class="code">
<span class="codestrong">requestAuthorization(options:completionHandler:)</span>
</span>
 asks the user for permission to send notifications.</p>
<p class="hang">
<span class="code">
<span class="codestrong">add(_:withCompletionHandler:)</span>
</span>
 requests to add a new notification to send to the user.</p>
<p class="hang">
<span class="code">
<span class="codestrong">removePendingNotificationRequests(withIdentifiers:)</span>
</span>
 removes an existing notification.</p>
<p class="indent">We use the first of these methods at <span class="ent">➋</span>
 to ask the user to grant permission for the app to send notifications. We’ll use the other two methods later in this chapter.</p>
<p class="indent"><span id="page_193"></span>
 The method <span class="code">requestAuthorization(options:completionHandler:)</span>
 takes two parameters: <span class="code">options</span>
 and <span class="code">completionHandler</span>
 . In the <span class="code">options</span>
 parameter, you pass in an array of the <span class="code">UNAuthorizationOptions</span>
 that you want to be available on your notifications. There are four types of <span class="code">UNAuthorizationOptions</span>
 that you can use for your notifications: <span class="code">badge</span>
 , <span class="code">sound</span>
 , <span class="code">alert</span>
 , and <span class="code">carPlay</span>
 . The <span class="code">badge</span>
 option adds a badge on your app icon so the user can quickly see when there’s something new in your app. This is typically a number indicating how many new or waiting notifications are in the app. The <span class="code">sound</span>
 option adds a sound to be played when your notification is sent to the phone. The <span class="code">alert</span>
 option displays a notification as either an alert that pops up in the middle of the screen or a banner that comes in at the top of the screen. You, the app developer, don’t get to decide how the notification will appear or if the user will turn on the sound for their notifications. This is something that the user controls in their Settings app. The fourth option, <span class="code">carPlay</span>
 , allows notifications on a CarPlay-enabled device in a car.</p>
<div class="image"><img src="Image00259.jpg" />
</div>
<p class="indent">We want to display the notifications as alerts for the user and play a sound when each notification comes in, so we pass in <span class="code">[.alert, .sound]</span>
 for our options <span class="ent">➌</span>
 . The <span class="code">completionHandler</span>
 parameter is a closure that is passed in and called after the user either grants or denies permission for the app to send notifications. The <span class="code">completionHandler</span>
 closure has two parameters, <span class="code">granted</span>
 and <span class="code">error</span>
 <span class="ent">➍</span>
 . The <span class="code">granted</span>
 parameter is a Boolean value that lets you know if permission was granted (in which case it would be <span class="code">true</span>
 ) or denied (<span class="code">false</span>
 ). We’re not going to change the behavior of our app if the user refuses to let us send notifications, but we’ll print a statement in the console <span class="ent">➎</span>
 so you can see if permission was granted or denied when you test the app. The second parameter, <span class="code">error</span>
 , is the <span class="code">Error</span>
 class type and lets you know if there was an error of some sort.</p>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<h2 class="h2a">
<strong>GETTING BIRTHDAY NOTIFICATIONS</strong>
</h2>
<div class="image1"><img src="Image00001.jpg" />
</div>
<p class="noindent">Now let’s finish BirthdayTracker by adding <em>local notifications</em>
 . A local notification is an alert that is sent to your phone from an app, even when the app isn’t running. The BirthdayTracker app will use a local notification to alert the user when they should wish a friend a happy birthday.</p>
<h3 class="h3" id="ch13lev1sec1">
<strong>THE USER NOTIFICATIONS FRAMEWORK</strong>
</h3>
<p class="noindent">Just as you used Apple’s Core Data framework to save birthdays on your phone in a database, you’ll use Apple’s User Notifications framework to send notifications to the user. Using this framework is easy! You just need to add an <span class="code">import</span>
 statement at the top of any class that deals with user notifications, like this:</p>
<div class="box">
<pre>
<span class="pink">import</span>
 UserNotifications</pre>
</div>
<p class="indent"><span id="page_192"></span>
 We’ll use the framework in three files—<em>AddBirthdayViewController.swift, AppDelegate.swift,</em>
 and <em>BirthdaysTableViewController.swift</em>
 —so add <span class="code">import UserNotifications</span>
 to each of them, below the other <span class="code">import</span>
 statements.</p>
<h4 class="h4" id="ch13lev2sec1">
<strong>REGISTERING FOR LOCAL NOTIFICATIONS</strong>
</h4>
<p class="noindent">Next, you need to have your app ask the user for permission to send notifications when it’s someone’s birthday. If you don’t have permission for notifications, they won’t be sent. You can get permission by having your app request authorization for notifications in your application delegate. This needs to be done as soon as the app starts, which is when it finishes launching. Luckily, there is a method in the <span class="code">AppDelegate</span>
 class called <span class="code">application(_:didFinishLaunchingWithOptions:)</span>
 that we can use to do this.</p>
<p class="indent">First, make sure that you added the line <span class="code">import UserNotifications</span>
 at the top of your <em>AppDelegate.swift</em>
 file. Next, add the following lines in <span class="code">application(_:didFinishLaunchingWithOptions:)</span>
 to request permission to send local notifications.</p>
<p class="noindent1">
<em>AppDelegate.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">func application(_ application: UIApplication, didFinishLaunchingWithOptions</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
  <span class="ent">➋</span>
 center.<span class="blue">requestAuthorization</span>
 (options: <span class="ent">➌</span>
 [.<span class="violet">alert</span>
 , .<span class="violet">sound</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
        completionHandler: <span class="ent">➍</span>
 { (granted, error) <span class="pink">in</span>
<br />
<br />
      <span class="ent">➎</span>
 <span class="pink">if</span>
 granted {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications granted!"</span>
 )<br />
        } <span class="pink">else</span>
 {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications denied."</span>
 )<br />
        }<br />
    })<br />
<br />
    <span class="ash">return true</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 gets the current <span class="code">UNUserNotificationCenter</span>
 and stores it in a constant called <span class="code">center</span>
 . The <em>notification center</em>
 is used to schedule and manage the notifications that you send from your app. In this chapter, we’ll use three methods from the <span class="code">UNUserNotificationCenter</span>
 class:</p>
<p class="hang">
<span class="code">
<span class="codestrong">requestAuthorization(options:completionHandler:)</span>
</span>
 asks the user for permission to send notifications.</p>
<p class="hang">
<span class="code">
<span class="codestrong">add(_:withCompletionHandler:)</span>
</span>
 requests to add a new notification to send to the user.</p>
<p class="hang">
<span class="code">
<span class="codestrong">removePendingNotificationRequests(withIdentifiers:)</span>
</span>
 removes an existing notification.</p>
<p class="indent">We use the first of these methods at <span class="ent">➋</span>
 to ask the user to grant permission for the app to send notifications. We’ll use the other two methods later in this chapter.</p>
<p class="indent"><span id="page_193"></span>
 The method <span class="code">requestAuthorization(options:completionHandler:)</span>
 takes two parameters: <span class="code">options</span>
 and <span class="code">completionHandler</span>
 . In the <span class="code">options</span>
 parameter, you pass in an array of the <span class="code">UNAuthorizationOptions</span>
 that you want to be available on your notifications. There are four types of <span class="code">UNAuthorizationOptions</span>
 that you can use for your notifications: <span class="code">badge</span>
 , <span class="code">sound</span>
 , <span class="code">alert</span>
 , and <span class="code">carPlay</span>
 . The <span class="code">badge</span>
 option adds a badge on your app icon so the user can quickly see when there’s something new in your app. This is typically a number indicating how many new or waiting notifications are in the app. The <span class="code">sound</span>
 option adds a sound to be played when your notification is sent to the phone. The <span class="code">alert</span>
 option displays a notification as either an alert that pops up in the middle of the screen or a banner that comes in at the top of the screen. You, the app developer, don’t get to decide how the notification will appear or if the user will turn on the sound for their notifications. This is something that the user controls in their Settings app. The fourth option, <span class="code">carPlay</span>
 , allows notifications on a CarPlay-enabled device in a car.</p>
<div class="image"><img src="Image00259.jpg" />
</div>
<p class="indent">We want to display the notifications as alerts for the user and play a sound when each notification comes in, so we pass in <span class="code">[.alert, .sound]</span>
 for our options <span class="ent">➌</span>
 . The <span class="code">completionHandler</span>
 parameter is a closure that is passed in and called after the user either grants or denies permission for the app to send notifications. The <span class="code">completionHandler</span>
 closure has two parameters, <span class="code">granted</span>
 and <span class="code">error</span>
 <span class="ent">➍</span>
 . The <span class="code">granted</span>
 parameter is a Boolean value that lets you know if permission was granted (in which case it would be <span class="code">true</span>
 ) or denied (<span class="code">false</span>
 ). We’re not going to change the behavior of our app if the user refuses to let us send notifications, but we’ll print a statement in the console <span class="ent">➎</span>
 so you can see if permission was granted or denied when you test the app. The second parameter, <span class="code">error</span>
 , is the <span class="code">Error</span>
 class type and lets you know if there was an error of some sort.</p>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<div class="image1"><img src="Image00001.jpg" />
</div>
<p class="noindent">Now let’s finish BirthdayTracker by adding <em>local notifications</em>
 . A local notification is an alert that is sent to your phone from an app, even when the app isn’t running. The BirthdayTracker app will use a local notification to alert the user when they should wish a friend a happy birthday.</p>
<h3 class="h3" id="ch13lev1sec1">
<strong>THE USER NOTIFICATIONS FRAMEWORK</strong>
</h3>
<p class="noindent">Just as you used Apple’s Core Data framework to save birthdays on your phone in a database, you’ll use Apple’s User Notifications framework to send notifications to the user. Using this framework is easy! You just need to add an <span class="code">import</span>
 statement at the top of any class that deals with user notifications, like this:</p>
<div class="box">
<pre>
<span class="pink">import</span>
 UserNotifications</pre>
</div>
<p class="indent"><span id="page_192"></span>
 We’ll use the framework in three files—<em>AddBirthdayViewController.swift, AppDelegate.swift,</em>
 and <em>BirthdaysTableViewController.swift</em>
 —so add <span class="code">import UserNotifications</span>
 to each of them, below the other <span class="code">import</span>
 statements.</p>
<h4 class="h4" id="ch13lev2sec1">
<strong>REGISTERING FOR LOCAL NOTIFICATIONS</strong>
</h4>
<p class="noindent">Next, you need to have your app ask the user for permission to send notifications when it’s someone’s birthday. If you don’t have permission for notifications, they won’t be sent. You can get permission by having your app request authorization for notifications in your application delegate. This needs to be done as soon as the app starts, which is when it finishes launching. Luckily, there is a method in the <span class="code">AppDelegate</span>
 class called <span class="code">application(_:didFinishLaunchingWithOptions:)</span>
 that we can use to do this.</p>
<p class="indent">First, make sure that you added the line <span class="code">import UserNotifications</span>
 at the top of your <em>AppDelegate.swift</em>
 file. Next, add the following lines in <span class="code">application(_:didFinishLaunchingWithOptions:)</span>
 to request permission to send local notifications.</p>
<p class="noindent1">
<em>AppDelegate.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">func application(_ application: UIApplication, didFinishLaunchingWithOptions</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
  <span class="ent">➋</span>
 center.<span class="blue">requestAuthorization</span>
 (options: <span class="ent">➌</span>
 [.<span class="violet">alert</span>
 , .<span class="violet">sound</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
        completionHandler: <span class="ent">➍</span>
 { (granted, error) <span class="pink">in</span>
<br />
<br />
      <span class="ent">➎</span>
 <span class="pink">if</span>
 granted {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications granted!"</span>
 )<br />
        } <span class="pink">else</span>
 {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications denied."</span>
 )<br />
        }<br />
    })<br />
<br />
    <span class="ash">return true</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 gets the current <span class="code">UNUserNotificationCenter</span>
 and stores it in a constant called <span class="code">center</span>
 . The <em>notification center</em>
 is used to schedule and manage the notifications that you send from your app. In this chapter, we’ll use three methods from the <span class="code">UNUserNotificationCenter</span>
 class:</p>
<p class="hang">
<span class="code">
<span class="codestrong">requestAuthorization(options:completionHandler:)</span>
</span>
 asks the user for permission to send notifications.</p>
<p class="hang">
<span class="code">
<span class="codestrong">add(_:withCompletionHandler:)</span>
</span>
 requests to add a new notification to send to the user.</p>
<p class="hang">
<span class="code">
<span class="codestrong">removePendingNotificationRequests(withIdentifiers:)</span>
</span>
 removes an existing notification.</p>
<p class="indent">We use the first of these methods at <span class="ent">➋</span>
 to ask the user to grant permission for the app to send notifications. We’ll use the other two methods later in this chapter.</p>
<p class="indent"><span id="page_193"></span>
 The method <span class="code">requestAuthorization(options:completionHandler:)</span>
 takes two parameters: <span class="code">options</span>
 and <span class="code">completionHandler</span>
 . In the <span class="code">options</span>
 parameter, you pass in an array of the <span class="code">UNAuthorizationOptions</span>
 that you want to be available on your notifications. There are four types of <span class="code">UNAuthorizationOptions</span>
 that you can use for your notifications: <span class="code">badge</span>
 , <span class="code">sound</span>
 , <span class="code">alert</span>
 , and <span class="code">carPlay</span>
 . The <span class="code">badge</span>
 option adds a badge on your app icon so the user can quickly see when there’s something new in your app. This is typically a number indicating how many new or waiting notifications are in the app. The <span class="code">sound</span>
 option adds a sound to be played when your notification is sent to the phone. The <span class="code">alert</span>
 option displays a notification as either an alert that pops up in the middle of the screen or a banner that comes in at the top of the screen. You, the app developer, don’t get to decide how the notification will appear or if the user will turn on the sound for their notifications. This is something that the user controls in their Settings app. The fourth option, <span class="code">carPlay</span>
 , allows notifications on a CarPlay-enabled device in a car.</p>
<div class="image"><img src="Image00259.jpg" />
</div>
<p class="indent">We want to display the notifications as alerts for the user and play a sound when each notification comes in, so we pass in <span class="code">[.alert, .sound]</span>
 for our options <span class="ent">➌</span>
 . The <span class="code">completionHandler</span>
 parameter is a closure that is passed in and called after the user either grants or denies permission for the app to send notifications. The <span class="code">completionHandler</span>
 closure has two parameters, <span class="code">granted</span>
 and <span class="code">error</span>
 <span class="ent">➍</span>
 . The <span class="code">granted</span>
 parameter is a Boolean value that lets you know if permission was granted (in which case it would be <span class="code">true</span>
 ) or denied (<span class="code">false</span>
 ). We’re not going to change the behavior of our app if the user refuses to let us send notifications, but we’ll print a statement in the console <span class="ent">➎</span>
 so you can see if permission was granted or denied when you test the app. The second parameter, <span class="code">error</span>
 , is the <span class="code">Error</span>
 class type and lets you know if there was an error of some sort.</p>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="noindent">Now let’s finish BirthdayTracker by adding <em>local notifications</em>
 . A local notification is an alert that is sent to your phone from an app, even when the app isn’t running. The BirthdayTracker app will use a local notification to alert the user when they should wish a friend a happy birthday.</p>
<h3 class="h3" id="ch13lev1sec1">
<strong>THE USER NOTIFICATIONS FRAMEWORK</strong>
</h3>
<p class="noindent">Just as you used Apple’s Core Data framework to save birthdays on your phone in a database, you’ll use Apple’s User Notifications framework to send notifications to the user. Using this framework is easy! You just need to add an <span class="code">import</span>
 statement at the top of any class that deals with user notifications, like this:</p>
<div class="box">
<pre>
<span class="pink">import</span>
 UserNotifications</pre>
</div>
<p class="indent"><span id="page_192"></span>
 We’ll use the framework in three files—<em>AddBirthdayViewController.swift, AppDelegate.swift,</em>
 and <em>BirthdaysTableViewController.swift</em>
 —so add <span class="code">import UserNotifications</span>
 to each of them, below the other <span class="code">import</span>
 statements.</p>
<h4 class="h4" id="ch13lev2sec1">
<strong>REGISTERING FOR LOCAL NOTIFICATIONS</strong>
</h4>
<p class="noindent">Next, you need to have your app ask the user for permission to send notifications when it’s someone’s birthday. If you don’t have permission for notifications, they won’t be sent. You can get permission by having your app request authorization for notifications in your application delegate. This needs to be done as soon as the app starts, which is when it finishes launching. Luckily, there is a method in the <span class="code">AppDelegate</span>
 class called <span class="code">application(_:didFinishLaunchingWithOptions:)</span>
 that we can use to do this.</p>
<p class="indent">First, make sure that you added the line <span class="code">import UserNotifications</span>
 at the top of your <em>AppDelegate.swift</em>
 file. Next, add the following lines in <span class="code">application(_:didFinishLaunchingWithOptions:)</span>
 to request permission to send local notifications.</p>
<p class="noindent1">
<em>AppDelegate.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">func application(_ application: UIApplication, didFinishLaunchingWithOptions</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
  <span class="ent">➋</span>
 center.<span class="blue">requestAuthorization</span>
 (options: <span class="ent">➌</span>
 [.<span class="violet">alert</span>
 , .<span class="violet">sound</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
        completionHandler: <span class="ent">➍</span>
 { (granted, error) <span class="pink">in</span>
<br />
<br />
      <span class="ent">➎</span>
 <span class="pink">if</span>
 granted {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications granted!"</span>
 )<br />
        } <span class="pink">else</span>
 {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications denied."</span>
 )<br />
        }<br />
    })<br />
<br />
    <span class="ash">return true</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 gets the current <span class="code">UNUserNotificationCenter</span>
 and stores it in a constant called <span class="code">center</span>
 . The <em>notification center</em>
 is used to schedule and manage the notifications that you send from your app. In this chapter, we’ll use three methods from the <span class="code">UNUserNotificationCenter</span>
 class:</p>
<p class="hang">
<span class="code">
<span class="codestrong">requestAuthorization(options:completionHandler:)</span>
</span>
 asks the user for permission to send notifications.</p>
<p class="hang">
<span class="code">
<span class="codestrong">add(_:withCompletionHandler:)</span>
</span>
 requests to add a new notification to send to the user.</p>
<p class="hang">
<span class="code">
<span class="codestrong">removePendingNotificationRequests(withIdentifiers:)</span>
</span>
 removes an existing notification.</p>
<p class="indent">We use the first of these methods at <span class="ent">➋</span>
 to ask the user to grant permission for the app to send notifications. We’ll use the other two methods later in this chapter.</p>
<p class="indent"><span id="page_193"></span>
 The method <span class="code">requestAuthorization(options:completionHandler:)</span>
 takes two parameters: <span class="code">options</span>
 and <span class="code">completionHandler</span>
 . In the <span class="code">options</span>
 parameter, you pass in an array of the <span class="code">UNAuthorizationOptions</span>
 that you want to be available on your notifications. There are four types of <span class="code">UNAuthorizationOptions</span>
 that you can use for your notifications: <span class="code">badge</span>
 , <span class="code">sound</span>
 , <span class="code">alert</span>
 , and <span class="code">carPlay</span>
 . The <span class="code">badge</span>
 option adds a badge on your app icon so the user can quickly see when there’s something new in your app. This is typically a number indicating how many new or waiting notifications are in the app. The <span class="code">sound</span>
 option adds a sound to be played when your notification is sent to the phone. The <span class="code">alert</span>
 option displays a notification as either an alert that pops up in the middle of the screen or a banner that comes in at the top of the screen. You, the app developer, don’t get to decide how the notification will appear or if the user will turn on the sound for their notifications. This is something that the user controls in their Settings app. The fourth option, <span class="code">carPlay</span>
 , allows notifications on a CarPlay-enabled device in a car.</p>
<div class="image"><img src="Image00259.jpg" />
</div>
<p class="indent">We want to display the notifications as alerts for the user and play a sound when each notification comes in, so we pass in <span class="code">[.alert, .sound]</span>
 for our options <span class="ent">➌</span>
 . The <span class="code">completionHandler</span>
 parameter is a closure that is passed in and called after the user either grants or denies permission for the app to send notifications. The <span class="code">completionHandler</span>
 closure has two parameters, <span class="code">granted</span>
 and <span class="code">error</span>
 <span class="ent">➍</span>
 . The <span class="code">granted</span>
 parameter is a Boolean value that lets you know if permission was granted (in which case it would be <span class="code">true</span>
 ) or denied (<span class="code">false</span>
 ). We’re not going to change the behavior of our app if the user refuses to let us send notifications, but we’ll print a statement in the console <span class="ent">➎</span>
 so you can see if permission was granted or denied when you test the app. The second parameter, <span class="code">error</span>
 , is the <span class="code">Error</span>
 class type and lets you know if there was an error of some sort.</p>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<h3 class="h3" id="ch13lev1sec1">
<strong>THE USER NOTIFICATIONS FRAMEWORK</strong>
</h3>
<p class="noindent">Just as you used Apple’s Core Data framework to save birthdays on your phone in a database, you’ll use Apple’s User Notifications framework to send notifications to the user. Using this framework is easy! You just need to add an <span class="code">import</span>
 statement at the top of any class that deals with user notifications, like this:</p>
<div class="box">
<pre>
<span class="pink">import</span>
 UserNotifications</pre>
</div>
<p class="indent"><span id="page_192"></span>
 We’ll use the framework in three files—<em>AddBirthdayViewController.swift, AppDelegate.swift,</em>
 and <em>BirthdaysTableViewController.swift</em>
 —so add <span class="code">import UserNotifications</span>
 to each of them, below the other <span class="code">import</span>
 statements.</p>
<h4 class="h4" id="ch13lev2sec1">
<strong>REGISTERING FOR LOCAL NOTIFICATIONS</strong>
</h4>
<p class="noindent">Next, you need to have your app ask the user for permission to send notifications when it’s someone’s birthday. If you don’t have permission for notifications, they won’t be sent. You can get permission by having your app request authorization for notifications in your application delegate. This needs to be done as soon as the app starts, which is when it finishes launching. Luckily, there is a method in the <span class="code">AppDelegate</span>
 class called <span class="code">application(_:didFinishLaunchingWithOptions:)</span>
 that we can use to do this.</p>
<p class="indent">First, make sure that you added the line <span class="code">import UserNotifications</span>
 at the top of your <em>AppDelegate.swift</em>
 file. Next, add the following lines in <span class="code">application(_:didFinishLaunchingWithOptions:)</span>
 to request permission to send local notifications.</p>
<p class="noindent1">
<em>AppDelegate.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">func application(_ application: UIApplication, didFinishLaunchingWithOptions</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
  <span class="ent">➋</span>
 center.<span class="blue">requestAuthorization</span>
 (options: <span class="ent">➌</span>
 [.<span class="violet">alert</span>
 , .<span class="violet">sound</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
        completionHandler: <span class="ent">➍</span>
 { (granted, error) <span class="pink">in</span>
<br />
<br />
      <span class="ent">➎</span>
 <span class="pink">if</span>
 granted {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications granted!"</span>
 )<br />
        } <span class="pink">else</span>
 {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications denied."</span>
 )<br />
        }<br />
    })<br />
<br />
    <span class="ash">return true</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 gets the current <span class="code">UNUserNotificationCenter</span>
 and stores it in a constant called <span class="code">center</span>
 . The <em>notification center</em>
 is used to schedule and manage the notifications that you send from your app. In this chapter, we’ll use three methods from the <span class="code">UNUserNotificationCenter</span>
 class:</p>
<p class="hang">
<span class="code">
<span class="codestrong">requestAuthorization(options:completionHandler:)</span>
</span>
 asks the user for permission to send notifications.</p>
<p class="hang">
<span class="code">
<span class="codestrong">add(_:withCompletionHandler:)</span>
</span>
 requests to add a new notification to send to the user.</p>
<p class="hang">
<span class="code">
<span class="codestrong">removePendingNotificationRequests(withIdentifiers:)</span>
</span>
 removes an existing notification.</p>
<p class="indent">We use the first of these methods at <span class="ent">➋</span>
 to ask the user to grant permission for the app to send notifications. We’ll use the other two methods later in this chapter.</p>
<p class="indent"><span id="page_193"></span>
 The method <span class="code">requestAuthorization(options:completionHandler:)</span>
 takes two parameters: <span class="code">options</span>
 and <span class="code">completionHandler</span>
 . In the <span class="code">options</span>
 parameter, you pass in an array of the <span class="code">UNAuthorizationOptions</span>
 that you want to be available on your notifications. There are four types of <span class="code">UNAuthorizationOptions</span>
 that you can use for your notifications: <span class="code">badge</span>
 , <span class="code">sound</span>
 , <span class="code">alert</span>
 , and <span class="code">carPlay</span>
 . The <span class="code">badge</span>
 option adds a badge on your app icon so the user can quickly see when there’s something new in your app. This is typically a number indicating how many new or waiting notifications are in the app. The <span class="code">sound</span>
 option adds a sound to be played when your notification is sent to the phone. The <span class="code">alert</span>
 option displays a notification as either an alert that pops up in the middle of the screen or a banner that comes in at the top of the screen. You, the app developer, don’t get to decide how the notification will appear or if the user will turn on the sound for their notifications. This is something that the user controls in their Settings app. The fourth option, <span class="code">carPlay</span>
 , allows notifications on a CarPlay-enabled device in a car.</p>
<div class="image"><img src="Image00259.jpg" />
</div>
<p class="indent">We want to display the notifications as alerts for the user and play a sound when each notification comes in, so we pass in <span class="code">[.alert, .sound]</span>
 for our options <span class="ent">➌</span>
 . The <span class="code">completionHandler</span>
 parameter is a closure that is passed in and called after the user either grants or denies permission for the app to send notifications. The <span class="code">completionHandler</span>
 closure has two parameters, <span class="code">granted</span>
 and <span class="code">error</span>
 <span class="ent">➍</span>
 . The <span class="code">granted</span>
 parameter is a Boolean value that lets you know if permission was granted (in which case it would be <span class="code">true</span>
 ) or denied (<span class="code">false</span>
 ). We’re not going to change the behavior of our app if the user refuses to let us send notifications, but we’ll print a statement in the console <span class="ent">➎</span>
 so you can see if permission was granted or denied when you test the app. The second parameter, <span class="code">error</span>
 , is the <span class="code">Error</span>
 class type and lets you know if there was an error of some sort.</p>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="noindent">Just as you used Apple’s Core Data framework to save birthdays on your phone in a database, you’ll use Apple’s User Notifications framework to send notifications to the user. Using this framework is easy! You just need to add an <span class="code">import</span>
 statement at the top of any class that deals with user notifications, like this:</p>
<div class="box">
<pre>
<span class="pink">import</span>
 UserNotifications</pre>
</div>
<p class="indent"><span id="page_192"></span>
 We’ll use the framework in three files—<em>AddBirthdayViewController.swift, AppDelegate.swift,</em>
 and <em>BirthdaysTableViewController.swift</em>
 —so add <span class="code">import UserNotifications</span>
 to each of them, below the other <span class="code">import</span>
 statements.</p>
<h4 class="h4" id="ch13lev2sec1">
<strong>REGISTERING FOR LOCAL NOTIFICATIONS</strong>
</h4>
<p class="noindent">Next, you need to have your app ask the user for permission to send notifications when it’s someone’s birthday. If you don’t have permission for notifications, they won’t be sent. You can get permission by having your app request authorization for notifications in your application delegate. This needs to be done as soon as the app starts, which is when it finishes launching. Luckily, there is a method in the <span class="code">AppDelegate</span>
 class called <span class="code">application(_:didFinishLaunchingWithOptions:)</span>
 that we can use to do this.</p>
<p class="indent">First, make sure that you added the line <span class="code">import UserNotifications</span>
 at the top of your <em>AppDelegate.swift</em>
 file. Next, add the following lines in <span class="code">application(_:didFinishLaunchingWithOptions:)</span>
 to request permission to send local notifications.</p>
<p class="noindent1">
<em>AppDelegate.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">func application(_ application: UIApplication, didFinishLaunchingWithOptions</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
  <span class="ent">➋</span>
 center.<span class="blue">requestAuthorization</span>
 (options: <span class="ent">➌</span>
 [.<span class="violet">alert</span>
 , .<span class="violet">sound</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
        completionHandler: <span class="ent">➍</span>
 { (granted, error) <span class="pink">in</span>
<br />
<br />
      <span class="ent">➎</span>
 <span class="pink">if</span>
 granted {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications granted!"</span>
 )<br />
        } <span class="pink">else</span>
 {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications denied."</span>
 )<br />
        }<br />
    })<br />
<br />
    <span class="ash">return true</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 gets the current <span class="code">UNUserNotificationCenter</span>
 and stores it in a constant called <span class="code">center</span>
 . The <em>notification center</em>
 is used to schedule and manage the notifications that you send from your app. In this chapter, we’ll use three methods from the <span class="code">UNUserNotificationCenter</span>
 class:</p>
<p class="hang">
<span class="code">
<span class="codestrong">requestAuthorization(options:completionHandler:)</span>
</span>
 asks the user for permission to send notifications.</p>
<p class="hang">
<span class="code">
<span class="codestrong">add(_:withCompletionHandler:)</span>
</span>
 requests to add a new notification to send to the user.</p>
<p class="hang">
<span class="code">
<span class="codestrong">removePendingNotificationRequests(withIdentifiers:)</span>
</span>
 removes an existing notification.</p>
<p class="indent">We use the first of these methods at <span class="ent">➋</span>
 to ask the user to grant permission for the app to send notifications. We’ll use the other two methods later in this chapter.</p>
<p class="indent"><span id="page_193"></span>
 The method <span class="code">requestAuthorization(options:completionHandler:)</span>
 takes two parameters: <span class="code">options</span>
 and <span class="code">completionHandler</span>
 . In the <span class="code">options</span>
 parameter, you pass in an array of the <span class="code">UNAuthorizationOptions</span>
 that you want to be available on your notifications. There are four types of <span class="code">UNAuthorizationOptions</span>
 that you can use for your notifications: <span class="code">badge</span>
 , <span class="code">sound</span>
 , <span class="code">alert</span>
 , and <span class="code">carPlay</span>
 . The <span class="code">badge</span>
 option adds a badge on your app icon so the user can quickly see when there’s something new in your app. This is typically a number indicating how many new or waiting notifications are in the app. The <span class="code">sound</span>
 option adds a sound to be played when your notification is sent to the phone. The <span class="code">alert</span>
 option displays a notification as either an alert that pops up in the middle of the screen or a banner that comes in at the top of the screen. You, the app developer, don’t get to decide how the notification will appear or if the user will turn on the sound for their notifications. This is something that the user controls in their Settings app. The fourth option, <span class="code">carPlay</span>
 , allows notifications on a CarPlay-enabled device in a car.</p>
<div class="image"><img src="Image00259.jpg" />
</div>
<p class="indent">We want to display the notifications as alerts for the user and play a sound when each notification comes in, so we pass in <span class="code">[.alert, .sound]</span>
 for our options <span class="ent">➌</span>
 . The <span class="code">completionHandler</span>
 parameter is a closure that is passed in and called after the user either grants or denies permission for the app to send notifications. The <span class="code">completionHandler</span>
 closure has two parameters, <span class="code">granted</span>
 and <span class="code">error</span>
 <span class="ent">➍</span>
 . The <span class="code">granted</span>
 parameter is a Boolean value that lets you know if permission was granted (in which case it would be <span class="code">true</span>
 ) or denied (<span class="code">false</span>
 ). We’re not going to change the behavior of our app if the user refuses to let us send notifications, but we’ll print a statement in the console <span class="ent">➎</span>
 so you can see if permission was granted or denied when you test the app. The second parameter, <span class="code">error</span>
 , is the <span class="code">Error</span>
 class type and lets you know if there was an error of some sort.</p>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<div class="box">
<pre>
<span class="pink">import</span>
 UserNotifications</pre>
</div>
<p class="indent"><span id="page_192"></span>
 We’ll use the framework in three files—<em>AddBirthdayViewController.swift, AppDelegate.swift,</em>
 and <em>BirthdaysTableViewController.swift</em>
 —so add <span class="code">import UserNotifications</span>
 to each of them, below the other <span class="code">import</span>
 statements.</p>
<h4 class="h4" id="ch13lev2sec1">
<strong>REGISTERING FOR LOCAL NOTIFICATIONS</strong>
</h4>
<p class="noindent">Next, you need to have your app ask the user for permission to send notifications when it’s someone’s birthday. If you don’t have permission for notifications, they won’t be sent. You can get permission by having your app request authorization for notifications in your application delegate. This needs to be done as soon as the app starts, which is when it finishes launching. Luckily, there is a method in the <span class="code">AppDelegate</span>
 class called <span class="code">application(_:didFinishLaunchingWithOptions:)</span>
 that we can use to do this.</p>
<p class="indent">First, make sure that you added the line <span class="code">import UserNotifications</span>
 at the top of your <em>AppDelegate.swift</em>
 file. Next, add the following lines in <span class="code">application(_:didFinishLaunchingWithOptions:)</span>
 to request permission to send local notifications.</p>
<p class="noindent1">
<em>AppDelegate.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">func application(_ application: UIApplication, didFinishLaunchingWithOptions</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
  <span class="ent">➋</span>
 center.<span class="blue">requestAuthorization</span>
 (options: <span class="ent">➌</span>
 [.<span class="violet">alert</span>
 , .<span class="violet">sound</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
        completionHandler: <span class="ent">➍</span>
 { (granted, error) <span class="pink">in</span>
<br />
<br />
      <span class="ent">➎</span>
 <span class="pink">if</span>
 granted {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications granted!"</span>
 )<br />
        } <span class="pink">else</span>
 {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications denied."</span>
 )<br />
        }<br />
    })<br />
<br />
    <span class="ash">return true</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 gets the current <span class="code">UNUserNotificationCenter</span>
 and stores it in a constant called <span class="code">center</span>
 . The <em>notification center</em>
 is used to schedule and manage the notifications that you send from your app. In this chapter, we’ll use three methods from the <span class="code">UNUserNotificationCenter</span>
 class:</p>
<p class="hang">
<span class="code">
<span class="codestrong">requestAuthorization(options:completionHandler:)</span>
</span>
 asks the user for permission to send notifications.</p>
<p class="hang">
<span class="code">
<span class="codestrong">add(_:withCompletionHandler:)</span>
</span>
 requests to add a new notification to send to the user.</p>
<p class="hang">
<span class="code">
<span class="codestrong">removePendingNotificationRequests(withIdentifiers:)</span>
</span>
 removes an existing notification.</p>
<p class="indent">We use the first of these methods at <span class="ent">➋</span>
 to ask the user to grant permission for the app to send notifications. We’ll use the other two methods later in this chapter.</p>
<p class="indent"><span id="page_193"></span>
 The method <span class="code">requestAuthorization(options:completionHandler:)</span>
 takes two parameters: <span class="code">options</span>
 and <span class="code">completionHandler</span>
 . In the <span class="code">options</span>
 parameter, you pass in an array of the <span class="code">UNAuthorizationOptions</span>
 that you want to be available on your notifications. There are four types of <span class="code">UNAuthorizationOptions</span>
 that you can use for your notifications: <span class="code">badge</span>
 , <span class="code">sound</span>
 , <span class="code">alert</span>
 , and <span class="code">carPlay</span>
 . The <span class="code">badge</span>
 option adds a badge on your app icon so the user can quickly see when there’s something new in your app. This is typically a number indicating how many new or waiting notifications are in the app. The <span class="code">sound</span>
 option adds a sound to be played when your notification is sent to the phone. The <span class="code">alert</span>
 option displays a notification as either an alert that pops up in the middle of the screen or a banner that comes in at the top of the screen. You, the app developer, don’t get to decide how the notification will appear or if the user will turn on the sound for their notifications. This is something that the user controls in their Settings app. The fourth option, <span class="code">carPlay</span>
 , allows notifications on a CarPlay-enabled device in a car.</p>
<div class="image"><img src="Image00259.jpg" />
</div>
<p class="indent">We want to display the notifications as alerts for the user and play a sound when each notification comes in, so we pass in <span class="code">[.alert, .sound]</span>
 for our options <span class="ent">➌</span>
 . The <span class="code">completionHandler</span>
 parameter is a closure that is passed in and called after the user either grants or denies permission for the app to send notifications. The <span class="code">completionHandler</span>
 closure has two parameters, <span class="code">granted</span>
 and <span class="code">error</span>
 <span class="ent">➍</span>
 . The <span class="code">granted</span>
 parameter is a Boolean value that lets you know if permission was granted (in which case it would be <span class="code">true</span>
 ) or denied (<span class="code">false</span>
 ). We’re not going to change the behavior of our app if the user refuses to let us send notifications, but we’ll print a statement in the console <span class="ent">➎</span>
 so you can see if permission was granted or denied when you test the app. The second parameter, <span class="code">error</span>
 , is the <span class="code">Error</span>
 class type and lets you know if there was an error of some sort.</p>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent"><span id="page_192"></span>
 We’ll use the framework in three files—<em>AddBirthdayViewController.swift, AppDelegate.swift,</em>
 and <em>BirthdaysTableViewController.swift</em>
 —so add <span class="code">import UserNotifications</span>
 to each of them, below the other <span class="code">import</span>
 statements.</p>
<h4 class="h4" id="ch13lev2sec1">
<strong>REGISTERING FOR LOCAL NOTIFICATIONS</strong>
</h4>
<p class="noindent">Next, you need to have your app ask the user for permission to send notifications when it’s someone’s birthday. If you don’t have permission for notifications, they won’t be sent. You can get permission by having your app request authorization for notifications in your application delegate. This needs to be done as soon as the app starts, which is when it finishes launching. Luckily, there is a method in the <span class="code">AppDelegate</span>
 class called <span class="code">application(_:didFinishLaunchingWithOptions:)</span>
 that we can use to do this.</p>
<p class="indent">First, make sure that you added the line <span class="code">import UserNotifications</span>
 at the top of your <em>AppDelegate.swift</em>
 file. Next, add the following lines in <span class="code">application(_:didFinishLaunchingWithOptions:)</span>
 to request permission to send local notifications.</p>
<p class="noindent1">
<em>AppDelegate.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">func application(_ application: UIApplication, didFinishLaunchingWithOptions</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
  <span class="ent">➋</span>
 center.<span class="blue">requestAuthorization</span>
 (options: <span class="ent">➌</span>
 [.<span class="violet">alert</span>
 , .<span class="violet">sound</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
        completionHandler: <span class="ent">➍</span>
 { (granted, error) <span class="pink">in</span>
<br />
<br />
      <span class="ent">➎</span>
 <span class="pink">if</span>
 granted {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications granted!"</span>
 )<br />
        } <span class="pink">else</span>
 {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications denied."</span>
 )<br />
        }<br />
    })<br />
<br />
    <span class="ash">return true</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 gets the current <span class="code">UNUserNotificationCenter</span>
 and stores it in a constant called <span class="code">center</span>
 . The <em>notification center</em>
 is used to schedule and manage the notifications that you send from your app. In this chapter, we’ll use three methods from the <span class="code">UNUserNotificationCenter</span>
 class:</p>
<p class="hang">
<span class="code">
<span class="codestrong">requestAuthorization(options:completionHandler:)</span>
</span>
 asks the user for permission to send notifications.</p>
<p class="hang">
<span class="code">
<span class="codestrong">add(_:withCompletionHandler:)</span>
</span>
 requests to add a new notification to send to the user.</p>
<p class="hang">
<span class="code">
<span class="codestrong">removePendingNotificationRequests(withIdentifiers:)</span>
</span>
 removes an existing notification.</p>
<p class="indent">We use the first of these methods at <span class="ent">➋</span>
 to ask the user to grant permission for the app to send notifications. We’ll use the other two methods later in this chapter.</p>
<p class="indent"><span id="page_193"></span>
 The method <span class="code">requestAuthorization(options:completionHandler:)</span>
 takes two parameters: <span class="code">options</span>
 and <span class="code">completionHandler</span>
 . In the <span class="code">options</span>
 parameter, you pass in an array of the <span class="code">UNAuthorizationOptions</span>
 that you want to be available on your notifications. There are four types of <span class="code">UNAuthorizationOptions</span>
 that you can use for your notifications: <span class="code">badge</span>
 , <span class="code">sound</span>
 , <span class="code">alert</span>
 , and <span class="code">carPlay</span>
 . The <span class="code">badge</span>
 option adds a badge on your app icon so the user can quickly see when there’s something new in your app. This is typically a number indicating how many new or waiting notifications are in the app. The <span class="code">sound</span>
 option adds a sound to be played when your notification is sent to the phone. The <span class="code">alert</span>
 option displays a notification as either an alert that pops up in the middle of the screen or a banner that comes in at the top of the screen. You, the app developer, don’t get to decide how the notification will appear or if the user will turn on the sound for their notifications. This is something that the user controls in their Settings app. The fourth option, <span class="code">carPlay</span>
 , allows notifications on a CarPlay-enabled device in a car.</p>
<div class="image"><img src="Image00259.jpg" />
</div>
<p class="indent">We want to display the notifications as alerts for the user and play a sound when each notification comes in, so we pass in <span class="code">[.alert, .sound]</span>
 for our options <span class="ent">➌</span>
 . The <span class="code">completionHandler</span>
 parameter is a closure that is passed in and called after the user either grants or denies permission for the app to send notifications. The <span class="code">completionHandler</span>
 closure has two parameters, <span class="code">granted</span>
 and <span class="code">error</span>
 <span class="ent">➍</span>
 . The <span class="code">granted</span>
 parameter is a Boolean value that lets you know if permission was granted (in which case it would be <span class="code">true</span>
 ) or denied (<span class="code">false</span>
 ). We’re not going to change the behavior of our app if the user refuses to let us send notifications, but we’ll print a statement in the console <span class="ent">➎</span>
 so you can see if permission was granted or denied when you test the app. The second parameter, <span class="code">error</span>
 , is the <span class="code">Error</span>
 class type and lets you know if there was an error of some sort.</p>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<h4 class="h4" id="ch13lev2sec1">
<strong>REGISTERING FOR LOCAL NOTIFICATIONS</strong>
</h4>
<p class="noindent">Next, you need to have your app ask the user for permission to send notifications when it’s someone’s birthday. If you don’t have permission for notifications, they won’t be sent. You can get permission by having your app request authorization for notifications in your application delegate. This needs to be done as soon as the app starts, which is when it finishes launching. Luckily, there is a method in the <span class="code">AppDelegate</span>
 class called <span class="code">application(_:didFinishLaunchingWithOptions:)</span>
 that we can use to do this.</p>
<p class="indent">First, make sure that you added the line <span class="code">import UserNotifications</span>
 at the top of your <em>AppDelegate.swift</em>
 file. Next, add the following lines in <span class="code">application(_:didFinishLaunchingWithOptions:)</span>
 to request permission to send local notifications.</p>
<p class="noindent1">
<em>AppDelegate.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">func application(_ application: UIApplication, didFinishLaunchingWithOptions</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
  <span class="ent">➋</span>
 center.<span class="blue">requestAuthorization</span>
 (options: <span class="ent">➌</span>
 [.<span class="violet">alert</span>
 , .<span class="violet">sound</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
        completionHandler: <span class="ent">➍</span>
 { (granted, error) <span class="pink">in</span>
<br />
<br />
      <span class="ent">➎</span>
 <span class="pink">if</span>
 granted {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications granted!"</span>
 )<br />
        } <span class="pink">else</span>
 {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications denied."</span>
 )<br />
        }<br />
    })<br />
<br />
    <span class="ash">return true</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 gets the current <span class="code">UNUserNotificationCenter</span>
 and stores it in a constant called <span class="code">center</span>
 . The <em>notification center</em>
 is used to schedule and manage the notifications that you send from your app. In this chapter, we’ll use three methods from the <span class="code">UNUserNotificationCenter</span>
 class:</p>
<p class="hang">
<span class="code">
<span class="codestrong">requestAuthorization(options:completionHandler:)</span>
</span>
 asks the user for permission to send notifications.</p>
<p class="hang">
<span class="code">
<span class="codestrong">add(_:withCompletionHandler:)</span>
</span>
 requests to add a new notification to send to the user.</p>
<p class="hang">
<span class="code">
<span class="codestrong">removePendingNotificationRequests(withIdentifiers:)</span>
</span>
 removes an existing notification.</p>
<p class="indent">We use the first of these methods at <span class="ent">➋</span>
 to ask the user to grant permission for the app to send notifications. We’ll use the other two methods later in this chapter.</p>
<p class="indent"><span id="page_193"></span>
 The method <span class="code">requestAuthorization(options:completionHandler:)</span>
 takes two parameters: <span class="code">options</span>
 and <span class="code">completionHandler</span>
 . In the <span class="code">options</span>
 parameter, you pass in an array of the <span class="code">UNAuthorizationOptions</span>
 that you want to be available on your notifications. There are four types of <span class="code">UNAuthorizationOptions</span>
 that you can use for your notifications: <span class="code">badge</span>
 , <span class="code">sound</span>
 , <span class="code">alert</span>
 , and <span class="code">carPlay</span>
 . The <span class="code">badge</span>
 option adds a badge on your app icon so the user can quickly see when there’s something new in your app. This is typically a number indicating how many new or waiting notifications are in the app. The <span class="code">sound</span>
 option adds a sound to be played when your notification is sent to the phone. The <span class="code">alert</span>
 option displays a notification as either an alert that pops up in the middle of the screen or a banner that comes in at the top of the screen. You, the app developer, don’t get to decide how the notification will appear or if the user will turn on the sound for their notifications. This is something that the user controls in their Settings app. The fourth option, <span class="code">carPlay</span>
 , allows notifications on a CarPlay-enabled device in a car.</p>
<div class="image"><img src="Image00259.jpg" />
</div>
<p class="indent">We want to display the notifications as alerts for the user and play a sound when each notification comes in, so we pass in <span class="code">[.alert, .sound]</span>
 for our options <span class="ent">➌</span>
 . The <span class="code">completionHandler</span>
 parameter is a closure that is passed in and called after the user either grants or denies permission for the app to send notifications. The <span class="code">completionHandler</span>
 closure has two parameters, <span class="code">granted</span>
 and <span class="code">error</span>
 <span class="ent">➍</span>
 . The <span class="code">granted</span>
 parameter is a Boolean value that lets you know if permission was granted (in which case it would be <span class="code">true</span>
 ) or denied (<span class="code">false</span>
 ). We’re not going to change the behavior of our app if the user refuses to let us send notifications, but we’ll print a statement in the console <span class="ent">➎</span>
 so you can see if permission was granted or denied when you test the app. The second parameter, <span class="code">error</span>
 , is the <span class="code">Error</span>
 class type and lets you know if there was an error of some sort.</p>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="noindent">Next, you need to have your app ask the user for permission to send notifications when it’s someone’s birthday. If you don’t have permission for notifications, they won’t be sent. You can get permission by having your app request authorization for notifications in your application delegate. This needs to be done as soon as the app starts, which is when it finishes launching. Luckily, there is a method in the <span class="code">AppDelegate</span>
 class called <span class="code">application(_:didFinishLaunchingWithOptions:)</span>
 that we can use to do this.</p>
<p class="indent">First, make sure that you added the line <span class="code">import UserNotifications</span>
 at the top of your <em>AppDelegate.swift</em>
 file. Next, add the following lines in <span class="code">application(_:didFinishLaunchingWithOptions:)</span>
 to request permission to send local notifications.</p>
<p class="noindent1">
<em>AppDelegate.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">func application(_ application: UIApplication, didFinishLaunchingWithOptions</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
  <span class="ent">➋</span>
 center.<span class="blue">requestAuthorization</span>
 (options: <span class="ent">➌</span>
 [.<span class="violet">alert</span>
 , .<span class="violet">sound</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
        completionHandler: <span class="ent">➍</span>
 { (granted, error) <span class="pink">in</span>
<br />
<br />
      <span class="ent">➎</span>
 <span class="pink">if</span>
 granted {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications granted!"</span>
 )<br />
        } <span class="pink">else</span>
 {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications denied."</span>
 )<br />
        }<br />
    })<br />
<br />
    <span class="ash">return true</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 gets the current <span class="code">UNUserNotificationCenter</span>
 and stores it in a constant called <span class="code">center</span>
 . The <em>notification center</em>
 is used to schedule and manage the notifications that you send from your app. In this chapter, we’ll use three methods from the <span class="code">UNUserNotificationCenter</span>
 class:</p>
<p class="hang">
<span class="code">
<span class="codestrong">requestAuthorization(options:completionHandler:)</span>
</span>
 asks the user for permission to send notifications.</p>
<p class="hang">
<span class="code">
<span class="codestrong">add(_:withCompletionHandler:)</span>
</span>
 requests to add a new notification to send to the user.</p>
<p class="hang">
<span class="code">
<span class="codestrong">removePendingNotificationRequests(withIdentifiers:)</span>
</span>
 removes an existing notification.</p>
<p class="indent">We use the first of these methods at <span class="ent">➋</span>
 to ask the user to grant permission for the app to send notifications. We’ll use the other two methods later in this chapter.</p>
<p class="indent"><span id="page_193"></span>
 The method <span class="code">requestAuthorization(options:completionHandler:)</span>
 takes two parameters: <span class="code">options</span>
 and <span class="code">completionHandler</span>
 . In the <span class="code">options</span>
 parameter, you pass in an array of the <span class="code">UNAuthorizationOptions</span>
 that you want to be available on your notifications. There are four types of <span class="code">UNAuthorizationOptions</span>
 that you can use for your notifications: <span class="code">badge</span>
 , <span class="code">sound</span>
 , <span class="code">alert</span>
 , and <span class="code">carPlay</span>
 . The <span class="code">badge</span>
 option adds a badge on your app icon so the user can quickly see when there’s something new in your app. This is typically a number indicating how many new or waiting notifications are in the app. The <span class="code">sound</span>
 option adds a sound to be played when your notification is sent to the phone. The <span class="code">alert</span>
 option displays a notification as either an alert that pops up in the middle of the screen or a banner that comes in at the top of the screen. You, the app developer, don’t get to decide how the notification will appear or if the user will turn on the sound for their notifications. This is something that the user controls in their Settings app. The fourth option, <span class="code">carPlay</span>
 , allows notifications on a CarPlay-enabled device in a car.</p>
<div class="image"><img src="Image00259.jpg" />
</div>
<p class="indent">We want to display the notifications as alerts for the user and play a sound when each notification comes in, so we pass in <span class="code">[.alert, .sound]</span>
 for our options <span class="ent">➌</span>
 . The <span class="code">completionHandler</span>
 parameter is a closure that is passed in and called after the user either grants or denies permission for the app to send notifications. The <span class="code">completionHandler</span>
 closure has two parameters, <span class="code">granted</span>
 and <span class="code">error</span>
 <span class="ent">➍</span>
 . The <span class="code">granted</span>
 parameter is a Boolean value that lets you know if permission was granted (in which case it would be <span class="code">true</span>
 ) or denied (<span class="code">false</span>
 ). We’re not going to change the behavior of our app if the user refuses to let us send notifications, but we’ll print a statement in the console <span class="ent">➎</span>
 so you can see if permission was granted or denied when you test the app. The second parameter, <span class="code">error</span>
 , is the <span class="code">Error</span>
 class type and lets you know if there was an error of some sort.</p>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent">First, make sure that you added the line <span class="code">import UserNotifications</span>
 at the top of your <em>AppDelegate.swift</em>
 file. Next, add the following lines in <span class="code">application(_:didFinishLaunchingWithOptions:)</span>
 to request permission to send local notifications.</p>
<p class="noindent1">
<em>AppDelegate.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">func application(_ application: UIApplication, didFinishLaunchingWithOptions</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
  <span class="ent">➋</span>
 center.<span class="blue">requestAuthorization</span>
 (options: <span class="ent">➌</span>
 [.<span class="violet">alert</span>
 , .<span class="violet">sound</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
        completionHandler: <span class="ent">➍</span>
 { (granted, error) <span class="pink">in</span>
<br />
<br />
      <span class="ent">➎</span>
 <span class="pink">if</span>
 granted {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications granted!"</span>
 )<br />
        } <span class="pink">else</span>
 {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications denied."</span>
 )<br />
        }<br />
    })<br />
<br />
    <span class="ash">return true</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 gets the current <span class="code">UNUserNotificationCenter</span>
 and stores it in a constant called <span class="code">center</span>
 . The <em>notification center</em>
 is used to schedule and manage the notifications that you send from your app. In this chapter, we’ll use three methods from the <span class="code">UNUserNotificationCenter</span>
 class:</p>
<p class="hang">
<span class="code">
<span class="codestrong">requestAuthorization(options:completionHandler:)</span>
</span>
 asks the user for permission to send notifications.</p>
<p class="hang">
<span class="code">
<span class="codestrong">add(_:withCompletionHandler:)</span>
</span>
 requests to add a new notification to send to the user.</p>
<p class="hang">
<span class="code">
<span class="codestrong">removePendingNotificationRequests(withIdentifiers:)</span>
</span>
 removes an existing notification.</p>
<p class="indent">We use the first of these methods at <span class="ent">➋</span>
 to ask the user to grant permission for the app to send notifications. We’ll use the other two methods later in this chapter.</p>
<p class="indent"><span id="page_193"></span>
 The method <span class="code">requestAuthorization(options:completionHandler:)</span>
 takes two parameters: <span class="code">options</span>
 and <span class="code">completionHandler</span>
 . In the <span class="code">options</span>
 parameter, you pass in an array of the <span class="code">UNAuthorizationOptions</span>
 that you want to be available on your notifications. There are four types of <span class="code">UNAuthorizationOptions</span>
 that you can use for your notifications: <span class="code">badge</span>
 , <span class="code">sound</span>
 , <span class="code">alert</span>
 , and <span class="code">carPlay</span>
 . The <span class="code">badge</span>
 option adds a badge on your app icon so the user can quickly see when there’s something new in your app. This is typically a number indicating how many new or waiting notifications are in the app. The <span class="code">sound</span>
 option adds a sound to be played when your notification is sent to the phone. The <span class="code">alert</span>
 option displays a notification as either an alert that pops up in the middle of the screen or a banner that comes in at the top of the screen. You, the app developer, don’t get to decide how the notification will appear or if the user will turn on the sound for their notifications. This is something that the user controls in their Settings app. The fourth option, <span class="code">carPlay</span>
 , allows notifications on a CarPlay-enabled device in a car.</p>
<div class="image"><img src="Image00259.jpg" />
</div>
<p class="indent">We want to display the notifications as alerts for the user and play a sound when each notification comes in, so we pass in <span class="code">[.alert, .sound]</span>
 for our options <span class="ent">➌</span>
 . The <span class="code">completionHandler</span>
 parameter is a closure that is passed in and called after the user either grants or denies permission for the app to send notifications. The <span class="code">completionHandler</span>
 closure has two parameters, <span class="code">granted</span>
 and <span class="code">error</span>
 <span class="ent">➍</span>
 . The <span class="code">granted</span>
 parameter is a Boolean value that lets you know if permission was granted (in which case it would be <span class="code">true</span>
 ) or denied (<span class="code">false</span>
 ). We’re not going to change the behavior of our app if the user refuses to let us send notifications, but we’ll print a statement in the console <span class="ent">➎</span>
 so you can see if permission was granted or denied when you test the app. The second parameter, <span class="code">error</span>
 , is the <span class="code">Error</span>
 class type and lets you know if there was an error of some sort.</p>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="noindent1">
<em>AppDelegate.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">func application(_ application: UIApplication, didFinishLaunchingWithOptions</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
  <span class="ent">➋</span>
 center.<span class="blue">requestAuthorization</span>
 (options: <span class="ent">➌</span>
 [.<span class="violet">alert</span>
 , .<span class="violet">sound</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
        completionHandler: <span class="ent">➍</span>
 { (granted, error) <span class="pink">in</span>
<br />
<br />
      <span class="ent">➎</span>
 <span class="pink">if</span>
 granted {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications granted!"</span>
 )<br />
        } <span class="pink">else</span>
 {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications denied."</span>
 )<br />
        }<br />
    })<br />
<br />
    <span class="ash">return true</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 gets the current <span class="code">UNUserNotificationCenter</span>
 and stores it in a constant called <span class="code">center</span>
 . The <em>notification center</em>
 is used to schedule and manage the notifications that you send from your app. In this chapter, we’ll use three methods from the <span class="code">UNUserNotificationCenter</span>
 class:</p>
<p class="hang">
<span class="code">
<span class="codestrong">requestAuthorization(options:completionHandler:)</span>
</span>
 asks the user for permission to send notifications.</p>
<p class="hang">
<span class="code">
<span class="codestrong">add(_:withCompletionHandler:)</span>
</span>
 requests to add a new notification to send to the user.</p>
<p class="hang">
<span class="code">
<span class="codestrong">removePendingNotificationRequests(withIdentifiers:)</span>
</span>
 removes an existing notification.</p>
<p class="indent">We use the first of these methods at <span class="ent">➋</span>
 to ask the user to grant permission for the app to send notifications. We’ll use the other two methods later in this chapter.</p>
<p class="indent"><span id="page_193"></span>
 The method <span class="code">requestAuthorization(options:completionHandler:)</span>
 takes two parameters: <span class="code">options</span>
 and <span class="code">completionHandler</span>
 . In the <span class="code">options</span>
 parameter, you pass in an array of the <span class="code">UNAuthorizationOptions</span>
 that you want to be available on your notifications. There are four types of <span class="code">UNAuthorizationOptions</span>
 that you can use for your notifications: <span class="code">badge</span>
 , <span class="code">sound</span>
 , <span class="code">alert</span>
 , and <span class="code">carPlay</span>
 . The <span class="code">badge</span>
 option adds a badge on your app icon so the user can quickly see when there’s something new in your app. This is typically a number indicating how many new or waiting notifications are in the app. The <span class="code">sound</span>
 option adds a sound to be played when your notification is sent to the phone. The <span class="code">alert</span>
 option displays a notification as either an alert that pops up in the middle of the screen or a banner that comes in at the top of the screen. You, the app developer, don’t get to decide how the notification will appear or if the user will turn on the sound for their notifications. This is something that the user controls in their Settings app. The fourth option, <span class="code">carPlay</span>
 , allows notifications on a CarPlay-enabled device in a car.</p>
<div class="image"><img src="Image00259.jpg" />
</div>
<p class="indent">We want to display the notifications as alerts for the user and play a sound when each notification comes in, so we pass in <span class="code">[.alert, .sound]</span>
 for our options <span class="ent">➌</span>
 . The <span class="code">completionHandler</span>
 parameter is a closure that is passed in and called after the user either grants or denies permission for the app to send notifications. The <span class="code">completionHandler</span>
 closure has two parameters, <span class="code">granted</span>
 and <span class="code">error</span>
 <span class="ent">➍</span>
 . The <span class="code">granted</span>
 parameter is a Boolean value that lets you know if permission was granted (in which case it would be <span class="code">true</span>
 ) or denied (<span class="code">false</span>
 ). We’re not going to change the behavior of our app if the user refuses to let us send notifications, but we’ll print a statement in the console <span class="ent">➎</span>
 so you can see if permission was granted or denied when you test the app. The second parameter, <span class="code">error</span>
 , is the <span class="code">Error</span>
 class type and lets you know if there was an error of some sort.</p>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<div class="box">
<pre>
<span class="ash">func application(_ application: UIApplication, didFinishLaunchingWithOptions</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
  <span class="ent">➋</span>
 center.<span class="blue">requestAuthorization</span>
 (options: <span class="ent">➌</span>
 [.<span class="violet">alert</span>
 , .<span class="violet">sound</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
        completionHandler: <span class="ent">➍</span>
 { (granted, error) <span class="pink">in</span>
<br />
<br />
      <span class="ent">➎</span>
 <span class="pink">if</span>
 granted {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications granted!"</span>
 )<br />
        } <span class="pink">else</span>
 {<br />
            <span class="blue">print</span>
 (<span class="red">"Permission for notifications denied."</span>
 )<br />
        }<br />
    })<br />
<br />
    <span class="ash">return true</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 gets the current <span class="code">UNUserNotificationCenter</span>
 and stores it in a constant called <span class="code">center</span>
 . The <em>notification center</em>
 is used to schedule and manage the notifications that you send from your app. In this chapter, we’ll use three methods from the <span class="code">UNUserNotificationCenter</span>
 class:</p>
<p class="hang">
<span class="code">
<span class="codestrong">requestAuthorization(options:completionHandler:)</span>
</span>
 asks the user for permission to send notifications.</p>
<p class="hang">
<span class="code">
<span class="codestrong">add(_:withCompletionHandler:)</span>
</span>
 requests to add a new notification to send to the user.</p>
<p class="hang">
<span class="code">
<span class="codestrong">removePendingNotificationRequests(withIdentifiers:)</span>
</span>
 removes an existing notification.</p>
<p class="indent">We use the first of these methods at <span class="ent">➋</span>
 to ask the user to grant permission for the app to send notifications. We’ll use the other two methods later in this chapter.</p>
<p class="indent"><span id="page_193"></span>
 The method <span class="code">requestAuthorization(options:completionHandler:)</span>
 takes two parameters: <span class="code">options</span>
 and <span class="code">completionHandler</span>
 . In the <span class="code">options</span>
 parameter, you pass in an array of the <span class="code">UNAuthorizationOptions</span>
 that you want to be available on your notifications. There are four types of <span class="code">UNAuthorizationOptions</span>
 that you can use for your notifications: <span class="code">badge</span>
 , <span class="code">sound</span>
 , <span class="code">alert</span>
 , and <span class="code">carPlay</span>
 . The <span class="code">badge</span>
 option adds a badge on your app icon so the user can quickly see when there’s something new in your app. This is typically a number indicating how many new or waiting notifications are in the app. The <span class="code">sound</span>
 option adds a sound to be played when your notification is sent to the phone. The <span class="code">alert</span>
 option displays a notification as either an alert that pops up in the middle of the screen or a banner that comes in at the top of the screen. You, the app developer, don’t get to decide how the notification will appear or if the user will turn on the sound for their notifications. This is something that the user controls in their Settings app. The fourth option, <span class="code">carPlay</span>
 , allows notifications on a CarPlay-enabled device in a car.</p>
<div class="image"><img src="Image00259.jpg" />
</div>
<p class="indent">We want to display the notifications as alerts for the user and play a sound when each notification comes in, so we pass in <span class="code">[.alert, .sound]</span>
 for our options <span class="ent">➌</span>
 . The <span class="code">completionHandler</span>
 parameter is a closure that is passed in and called after the user either grants or denies permission for the app to send notifications. The <span class="code">completionHandler</span>
 closure has two parameters, <span class="code">granted</span>
 and <span class="code">error</span>
 <span class="ent">➍</span>
 . The <span class="code">granted</span>
 parameter is a Boolean value that lets you know if permission was granted (in which case it would be <span class="code">true</span>
 ) or denied (<span class="code">false</span>
 ). We’re not going to change the behavior of our app if the user refuses to let us send notifications, but we’ll print a statement in the console <span class="ent">➎</span>
 so you can see if permission was granted or denied when you test the app. The second parameter, <span class="code">error</span>
 , is the <span class="code">Error</span>
 class type and lets you know if there was an error of some sort.</p>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent">The line at <span class="ent">➊</span>
 gets the current <span class="code">UNUserNotificationCenter</span>
 and stores it in a constant called <span class="code">center</span>
 . The <em>notification center</em>
 is used to schedule and manage the notifications that you send from your app. In this chapter, we’ll use three methods from the <span class="code">UNUserNotificationCenter</span>
 class:</p>
<p class="hang">
<span class="code">
<span class="codestrong">requestAuthorization(options:completionHandler:)</span>
</span>
 asks the user for permission to send notifications.</p>
<p class="hang">
<span class="code">
<span class="codestrong">add(_:withCompletionHandler:)</span>
</span>
 requests to add a new notification to send to the user.</p>
<p class="hang">
<span class="code">
<span class="codestrong">removePendingNotificationRequests(withIdentifiers:)</span>
</span>
 removes an existing notification.</p>
<p class="indent">We use the first of these methods at <span class="ent">➋</span>
 to ask the user to grant permission for the app to send notifications. We’ll use the other two methods later in this chapter.</p>
<p class="indent"><span id="page_193"></span>
 The method <span class="code">requestAuthorization(options:completionHandler:)</span>
 takes two parameters: <span class="code">options</span>
 and <span class="code">completionHandler</span>
 . In the <span class="code">options</span>
 parameter, you pass in an array of the <span class="code">UNAuthorizationOptions</span>
 that you want to be available on your notifications. There are four types of <span class="code">UNAuthorizationOptions</span>
 that you can use for your notifications: <span class="code">badge</span>
 , <span class="code">sound</span>
 , <span class="code">alert</span>
 , and <span class="code">carPlay</span>
 . The <span class="code">badge</span>
 option adds a badge on your app icon so the user can quickly see when there’s something new in your app. This is typically a number indicating how many new or waiting notifications are in the app. The <span class="code">sound</span>
 option adds a sound to be played when your notification is sent to the phone. The <span class="code">alert</span>
 option displays a notification as either an alert that pops up in the middle of the screen or a banner that comes in at the top of the screen. You, the app developer, don’t get to decide how the notification will appear or if the user will turn on the sound for their notifications. This is something that the user controls in their Settings app. The fourth option, <span class="code">carPlay</span>
 , allows notifications on a CarPlay-enabled device in a car.</p>
<div class="image"><img src="Image00259.jpg" />
</div>
<p class="indent">We want to display the notifications as alerts for the user and play a sound when each notification comes in, so we pass in <span class="code">[.alert, .sound]</span>
 for our options <span class="ent">➌</span>
 . The <span class="code">completionHandler</span>
 parameter is a closure that is passed in and called after the user either grants or denies permission for the app to send notifications. The <span class="code">completionHandler</span>
 closure has two parameters, <span class="code">granted</span>
 and <span class="code">error</span>
 <span class="ent">➍</span>
 . The <span class="code">granted</span>
 parameter is a Boolean value that lets you know if permission was granted (in which case it would be <span class="code">true</span>
 ) or denied (<span class="code">false</span>
 ). We’re not going to change the behavior of our app if the user refuses to let us send notifications, but we’ll print a statement in the console <span class="ent">➎</span>
 so you can see if permission was granted or denied when you test the app. The second parameter, <span class="code">error</span>
 , is the <span class="code">Error</span>
 class type and lets you know if there was an error of some sort.</p>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="hang">
<span class="code">
<span class="codestrong">requestAuthorization(options:completionHandler:)</span>
</span>
 asks the user for permission to send notifications.</p>
<p class="hang">
<span class="code">
<span class="codestrong">add(_:withCompletionHandler:)</span>
</span>
 requests to add a new notification to send to the user.</p>
<p class="hang">
<span class="code">
<span class="codestrong">removePendingNotificationRequests(withIdentifiers:)</span>
</span>
 removes an existing notification.</p>
<p class="indent">We use the first of these methods at <span class="ent">➋</span>
 to ask the user to grant permission for the app to send notifications. We’ll use the other two methods later in this chapter.</p>
<p class="indent"><span id="page_193"></span>
 The method <span class="code">requestAuthorization(options:completionHandler:)</span>
 takes two parameters: <span class="code">options</span>
 and <span class="code">completionHandler</span>
 . In the <span class="code">options</span>
 parameter, you pass in an array of the <span class="code">UNAuthorizationOptions</span>
 that you want to be available on your notifications. There are four types of <span class="code">UNAuthorizationOptions</span>
 that you can use for your notifications: <span class="code">badge</span>
 , <span class="code">sound</span>
 , <span class="code">alert</span>
 , and <span class="code">carPlay</span>
 . The <span class="code">badge</span>
 option adds a badge on your app icon so the user can quickly see when there’s something new in your app. This is typically a number indicating how many new or waiting notifications are in the app. The <span class="code">sound</span>
 option adds a sound to be played when your notification is sent to the phone. The <span class="code">alert</span>
 option displays a notification as either an alert that pops up in the middle of the screen or a banner that comes in at the top of the screen. You, the app developer, don’t get to decide how the notification will appear or if the user will turn on the sound for their notifications. This is something that the user controls in their Settings app. The fourth option, <span class="code">carPlay</span>
 , allows notifications on a CarPlay-enabled device in a car.</p>
<div class="image"><img src="Image00259.jpg" />
</div>
<p class="indent">We want to display the notifications as alerts for the user and play a sound when each notification comes in, so we pass in <span class="code">[.alert, .sound]</span>
 for our options <span class="ent">➌</span>
 . The <span class="code">completionHandler</span>
 parameter is a closure that is passed in and called after the user either grants or denies permission for the app to send notifications. The <span class="code">completionHandler</span>
 closure has two parameters, <span class="code">granted</span>
 and <span class="code">error</span>
 <span class="ent">➍</span>
 . The <span class="code">granted</span>
 parameter is a Boolean value that lets you know if permission was granted (in which case it would be <span class="code">true</span>
 ) or denied (<span class="code">false</span>
 ). We’re not going to change the behavior of our app if the user refuses to let us send notifications, but we’ll print a statement in the console <span class="ent">➎</span>
 so you can see if permission was granted or denied when you test the app. The second parameter, <span class="code">error</span>
 , is the <span class="code">Error</span>
 class type and lets you know if there was an error of some sort.</p>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="hang">
<span class="code">
<span class="codestrong">add(_:withCompletionHandler:)</span>
</span>
 requests to add a new notification to send to the user.</p>
<p class="hang">
<span class="code">
<span class="codestrong">removePendingNotificationRequests(withIdentifiers:)</span>
</span>
 removes an existing notification.</p>
<p class="indent">We use the first of these methods at <span class="ent">➋</span>
 to ask the user to grant permission for the app to send notifications. We’ll use the other two methods later in this chapter.</p>
<p class="indent"><span id="page_193"></span>
 The method <span class="code">requestAuthorization(options:completionHandler:)</span>
 takes two parameters: <span class="code">options</span>
 and <span class="code">completionHandler</span>
 . In the <span class="code">options</span>
 parameter, you pass in an array of the <span class="code">UNAuthorizationOptions</span>
 that you want to be available on your notifications. There are four types of <span class="code">UNAuthorizationOptions</span>
 that you can use for your notifications: <span class="code">badge</span>
 , <span class="code">sound</span>
 , <span class="code">alert</span>
 , and <span class="code">carPlay</span>
 . The <span class="code">badge</span>
 option adds a badge on your app icon so the user can quickly see when there’s something new in your app. This is typically a number indicating how many new or waiting notifications are in the app. The <span class="code">sound</span>
 option adds a sound to be played when your notification is sent to the phone. The <span class="code">alert</span>
 option displays a notification as either an alert that pops up in the middle of the screen or a banner that comes in at the top of the screen. You, the app developer, don’t get to decide how the notification will appear or if the user will turn on the sound for their notifications. This is something that the user controls in their Settings app. The fourth option, <span class="code">carPlay</span>
 , allows notifications on a CarPlay-enabled device in a car.</p>
<div class="image"><img src="Image00259.jpg" />
</div>
<p class="indent">We want to display the notifications as alerts for the user and play a sound when each notification comes in, so we pass in <span class="code">[.alert, .sound]</span>
 for our options <span class="ent">➌</span>
 . The <span class="code">completionHandler</span>
 parameter is a closure that is passed in and called after the user either grants or denies permission for the app to send notifications. The <span class="code">completionHandler</span>
 closure has two parameters, <span class="code">granted</span>
 and <span class="code">error</span>
 <span class="ent">➍</span>
 . The <span class="code">granted</span>
 parameter is a Boolean value that lets you know if permission was granted (in which case it would be <span class="code">true</span>
 ) or denied (<span class="code">false</span>
 ). We’re not going to change the behavior of our app if the user refuses to let us send notifications, but we’ll print a statement in the console <span class="ent">➎</span>
 so you can see if permission was granted or denied when you test the app. The second parameter, <span class="code">error</span>
 , is the <span class="code">Error</span>
 class type and lets you know if there was an error of some sort.</p>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="hang">
<span class="code">
<span class="codestrong">removePendingNotificationRequests(withIdentifiers:)</span>
</span>
 removes an existing notification.</p>
<p class="indent">We use the first of these methods at <span class="ent">➋</span>
 to ask the user to grant permission for the app to send notifications. We’ll use the other two methods later in this chapter.</p>
<p class="indent"><span id="page_193"></span>
 The method <span class="code">requestAuthorization(options:completionHandler:)</span>
 takes two parameters: <span class="code">options</span>
 and <span class="code">completionHandler</span>
 . In the <span class="code">options</span>
 parameter, you pass in an array of the <span class="code">UNAuthorizationOptions</span>
 that you want to be available on your notifications. There are four types of <span class="code">UNAuthorizationOptions</span>
 that you can use for your notifications: <span class="code">badge</span>
 , <span class="code">sound</span>
 , <span class="code">alert</span>
 , and <span class="code">carPlay</span>
 . The <span class="code">badge</span>
 option adds a badge on your app icon so the user can quickly see when there’s something new in your app. This is typically a number indicating how many new or waiting notifications are in the app. The <span class="code">sound</span>
 option adds a sound to be played when your notification is sent to the phone. The <span class="code">alert</span>
 option displays a notification as either an alert that pops up in the middle of the screen or a banner that comes in at the top of the screen. You, the app developer, don’t get to decide how the notification will appear or if the user will turn on the sound for their notifications. This is something that the user controls in their Settings app. The fourth option, <span class="code">carPlay</span>
 , allows notifications on a CarPlay-enabled device in a car.</p>
<div class="image"><img src="Image00259.jpg" />
</div>
<p class="indent">We want to display the notifications as alerts for the user and play a sound when each notification comes in, so we pass in <span class="code">[.alert, .sound]</span>
 for our options <span class="ent">➌</span>
 . The <span class="code">completionHandler</span>
 parameter is a closure that is passed in and called after the user either grants or denies permission for the app to send notifications. The <span class="code">completionHandler</span>
 closure has two parameters, <span class="code">granted</span>
 and <span class="code">error</span>
 <span class="ent">➍</span>
 . The <span class="code">granted</span>
 parameter is a Boolean value that lets you know if permission was granted (in which case it would be <span class="code">true</span>
 ) or denied (<span class="code">false</span>
 ). We’re not going to change the behavior of our app if the user refuses to let us send notifications, but we’ll print a statement in the console <span class="ent">➎</span>
 so you can see if permission was granted or denied when you test the app. The second parameter, <span class="code">error</span>
 , is the <span class="code">Error</span>
 class type and lets you know if there was an error of some sort.</p>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent">We use the first of these methods at <span class="ent">➋</span>
 to ask the user to grant permission for the app to send notifications. We’ll use the other two methods later in this chapter.</p>
<p class="indent"><span id="page_193"></span>
 The method <span class="code">requestAuthorization(options:completionHandler:)</span>
 takes two parameters: <span class="code">options</span>
 and <span class="code">completionHandler</span>
 . In the <span class="code">options</span>
 parameter, you pass in an array of the <span class="code">UNAuthorizationOptions</span>
 that you want to be available on your notifications. There are four types of <span class="code">UNAuthorizationOptions</span>
 that you can use for your notifications: <span class="code">badge</span>
 , <span class="code">sound</span>
 , <span class="code">alert</span>
 , and <span class="code">carPlay</span>
 . The <span class="code">badge</span>
 option adds a badge on your app icon so the user can quickly see when there’s something new in your app. This is typically a number indicating how many new or waiting notifications are in the app. The <span class="code">sound</span>
 option adds a sound to be played when your notification is sent to the phone. The <span class="code">alert</span>
 option displays a notification as either an alert that pops up in the middle of the screen or a banner that comes in at the top of the screen. You, the app developer, don’t get to decide how the notification will appear or if the user will turn on the sound for their notifications. This is something that the user controls in their Settings app. The fourth option, <span class="code">carPlay</span>
 , allows notifications on a CarPlay-enabled device in a car.</p>
<div class="image"><img src="Image00259.jpg" />
</div>
<p class="indent">We want to display the notifications as alerts for the user and play a sound when each notification comes in, so we pass in <span class="code">[.alert, .sound]</span>
 for our options <span class="ent">➌</span>
 . The <span class="code">completionHandler</span>
 parameter is a closure that is passed in and called after the user either grants or denies permission for the app to send notifications. The <span class="code">completionHandler</span>
 closure has two parameters, <span class="code">granted</span>
 and <span class="code">error</span>
 <span class="ent">➍</span>
 . The <span class="code">granted</span>
 parameter is a Boolean value that lets you know if permission was granted (in which case it would be <span class="code">true</span>
 ) or denied (<span class="code">false</span>
 ). We’re not going to change the behavior of our app if the user refuses to let us send notifications, but we’ll print a statement in the console <span class="ent">➎</span>
 so you can see if permission was granted or denied when you test the app. The second parameter, <span class="code">error</span>
 , is the <span class="code">Error</span>
 class type and lets you know if there was an error of some sort.</p>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent"><span id="page_193"></span>
 The method <span class="code">requestAuthorization(options:completionHandler:)</span>
 takes two parameters: <span class="code">options</span>
 and <span class="code">completionHandler</span>
 . In the <span class="code">options</span>
 parameter, you pass in an array of the <span class="code">UNAuthorizationOptions</span>
 that you want to be available on your notifications. There are four types of <span class="code">UNAuthorizationOptions</span>
 that you can use for your notifications: <span class="code">badge</span>
 , <span class="code">sound</span>
 , <span class="code">alert</span>
 , and <span class="code">carPlay</span>
 . The <span class="code">badge</span>
 option adds a badge on your app icon so the user can quickly see when there’s something new in your app. This is typically a number indicating how many new or waiting notifications are in the app. The <span class="code">sound</span>
 option adds a sound to be played when your notification is sent to the phone. The <span class="code">alert</span>
 option displays a notification as either an alert that pops up in the middle of the screen or a banner that comes in at the top of the screen. You, the app developer, don’t get to decide how the notification will appear or if the user will turn on the sound for their notifications. This is something that the user controls in their Settings app. The fourth option, <span class="code">carPlay</span>
 , allows notifications on a CarPlay-enabled device in a car.</p>
<div class="image"><img src="Image00259.jpg" />
</div>
<p class="indent">We want to display the notifications as alerts for the user and play a sound when each notification comes in, so we pass in <span class="code">[.alert, .sound]</span>
 for our options <span class="ent">➌</span>
 . The <span class="code">completionHandler</span>
 parameter is a closure that is passed in and called after the user either grants or denies permission for the app to send notifications. The <span class="code">completionHandler</span>
 closure has two parameters, <span class="code">granted</span>
 and <span class="code">error</span>
 <span class="ent">➍</span>
 . The <span class="code">granted</span>
 parameter is a Boolean value that lets you know if permission was granted (in which case it would be <span class="code">true</span>
 ) or denied (<span class="code">false</span>
 ). We’re not going to change the behavior of our app if the user refuses to let us send notifications, but we’ll print a statement in the console <span class="ent">➎</span>
 so you can see if permission was granted or denied when you test the app. The second parameter, <span class="code">error</span>
 , is the <span class="code">Error</span>
 class type and lets you know if there was an error of some sort.</p>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<div class="image"><img src="Image00259.jpg" />
</div>
<p class="indent">We want to display the notifications as alerts for the user and play a sound when each notification comes in, so we pass in <span class="code">[.alert, .sound]</span>
 for our options <span class="ent">➌</span>
 . The <span class="code">completionHandler</span>
 parameter is a closure that is passed in and called after the user either grants or denies permission for the app to send notifications. The <span class="code">completionHandler</span>
 closure has two parameters, <span class="code">granted</span>
 and <span class="code">error</span>
 <span class="ent">➍</span>
 . The <span class="code">granted</span>
 parameter is a Boolean value that lets you know if permission was granted (in which case it would be <span class="code">true</span>
 ) or denied (<span class="code">false</span>
 ). We’re not going to change the behavior of our app if the user refuses to let us send notifications, but we’ll print a statement in the console <span class="ent">➎</span>
 so you can see if permission was granted or denied when you test the app. The second parameter, <span class="code">error</span>
 , is the <span class="code">Error</span>
 class type and lets you know if there was an error of some sort.</p>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent">We want to display the notifications as alerts for the user and play a sound when each notification comes in, so we pass in <span class="code">[.alert, .sound]</span>
 for our options <span class="ent">➌</span>
 . The <span class="code">completionHandler</span>
 parameter is a closure that is passed in and called after the user either grants or denies permission for the app to send notifications. The <span class="code">completionHandler</span>
 closure has two parameters, <span class="code">granted</span>
 and <span class="code">error</span>
 <span class="ent">➍</span>
 . The <span class="code">granted</span>
 parameter is a Boolean value that lets you know if permission was granted (in which case it would be <span class="code">true</span>
 ) or denied (<span class="code">false</span>
 ). We’re not going to change the behavior of our app if the user refuses to let us send notifications, but we’ll print a statement in the console <span class="ent">➎</span>
 so you can see if permission was granted or denied when you test the app. The second parameter, <span class="code">error</span>
 , is the <span class="code">Error</span>
 class type and lets you know if there was an error of some sort.</p>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent">Now that you have requested authorization for notifications, the first time the user runs the app, it will display an alert dialog asking if they want to allow it to send notifications, as shown in <a href="text00024.html#ch13fig1">Figure 13-1</a>
 .</p>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<div class="image"><img src="Image00260.jpg" />
</div>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="figcap"><a id="ch13fig1"></a>
 <em>Figure 13-1: The app will ask permission from the user to deliver notifications.</em>
</p>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent"><span id="page_194"></span>
 If the user selects the Don’t Allow option here, they won’t receive any notifications on people’s birthdays. If they select Allow, they will receive notifications. The user will only be asked this the first time the app is run after a fresh installation. However, they can change the notifications settings at any time in the Settings app.</p>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent">When the user opens the Settings app and scrolls to the apps section, they’ll see a listing for the BirthdayTracker app, labeled <em>Birthdays</em>
 , at the bottom of the list (<a href="text00024.html#ch13fig2">Figure 13-2</a>
 ). You can also see this in the simulator.</p>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent">Drilling down into the BirthdayTracker app settings will lead the user to the Notifications settings screen (<a href="text00024.html#ch13fig3">Figure 13-3</a>
 ).</p>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<div class="image"><img src="Image00261.jpg" />
</div>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="figcap"><a id="ch13fig2"></a>
 <em>Figure 13-2: From the Settings app, the user can drill down to specify notification settings for their apps.</em>
</p>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<div class="image"><img src="Image00262.jpg" />
</div>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="figcap"><a id="ch13fig3"></a>
 <em>Figure 13-3: Notification settings for our app</em>
</p>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent">On this screen, the user can specify whether they want to see notifications for the app and what kind of notifications they want (banner or alert).</p>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<h4 class="h4" id="ch13lev2sec2">
<strong>SCHEDULING A NOTIFICATION</strong>
</h4>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="noindent">Each time we create a birthday, we’ll want to schedule a notification to be sent to us every year on the birthday person’s birthdate. To do this, we’ll add some code to the <span class="code">saveTapped(_:)</span>
 method in the <span class="code">AddBirthdayViewController</span>
 class.</p>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent"><span id="page_195"></span>
 In that method, first we need to create a message string to be sent in the notification. Our message will be a string that says, <span class="code">"Wish</span>
 <span class="code">
<span class="italic">firstName lastName</span>
</span>
 <span class="code">a Happy Birthday today!"</span>
 Add the following code right after a birthday is saved in the <span class="code">saveTapped(_:)</span>
 method in <em>AddBirthdayViewController.swift</em>
 :</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">try context.save()</span>
<br />
    <span class="pink">let</span>
 message = <span class="red">"Wish</span>
 \<span class="red">(</span>
 firstName<span class="red">)</span>
 \<span class="red">(</span>
 lastName<span class="red">) a Happy Birthday today!"</span>
<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print ("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent">Now that we have our message, we need to create and schedule the notification that will be sent to the user’s device on their friend’s birthday. First, make sure that <span class="code">import UserNotifications</span>
 is at the top of the file. Then add the following right under the <span class="code">message</span>
 constant you just wrote:</p>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<div class="box">
<pre>   <span class="ash">let message = "Wish \(firstName) + \(lastName) a Happy Birthday today!"</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">let</span>
 content = <span class="violet">UNMutableNotificationContent</span>
 ()<br />
 <span class="ent">➋</span>
 content.<span class="violet">body</span>
 = message<br />
 <span class="ent">➌</span>
 content.<span class="violet">sound</span>
 = <span class="violet">UNNotificationSound</span>
 .<span class="blue">default</span>
 ()<br />
<span class="ash">} catch let error {</span>
<br />
    <span class="ash">print("Could not save because of \(error).")</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent">The line at <span class="ent">➊</span>
 creates a <span class="code">UNMutableNotificationContent</span>
 that is stored into a constant called <span class="code">content</span>
 . A <span class="code">UNMutableNotificationContent</span>
 contains data for a user notification, such as a message or sound. At <span class="ent">➋</span>
 , we set the <span class="code">content.body</span>
 property to the birthday reminder message called <span class="code">message</span>
 . Then, at <span class="ent">➌</span>
 , we set <span class="code">content.sound</span>
 to be the default notification sound, which is the same sound that occurs when you receive a text message.</p>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent">After we create the content of the notification, we need to create the notification’s <em>trigger</em>
 . Triggers are of the <span class="code">UNCalendarNotificationTrigger</span>
 class and let the app know when and how often to send the notification. We’ll schedule the birthday notification to be sent at 8 <span class="smallcaps">AM</span>
 every year on the person’s birthday. Swift lets us get just the month and day of the <span class="code">triggerDate</span>
 by using the <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes.</p>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent">Add the following code to create a trigger after setting <span class="code">content.sound</span>
 :</p>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<div class="box">
<pre>   <span class="ash">let content = UNMutableNotificationContent()</span>
<br />
   <span class="ash">content.body = message</span>
<br />
   <span class="ash">content.sound = UNNotificationSound.default()</span>
<br />
 <span class="ent">➊</span>
 <span class="pink">var</span>
 dateComponents = <span class="violet">Calendar</span>
 .<span class="violet">current</span>
 .<span class="blue">dateComponents</span>
 ([.<span class="blue">month</span>
 , .<span class="blue">day</span>
 ], <img class="inline" src="Image00093.jpg" />
<br />
       from: birthdate)<br />
 <span class="ent">➋</span>
 dateComponents.<span class="violet">hour</span>
 = <span class="blue1">8</span>
<br />
 <span class="ent">➌</span>
 <span class="pink">let</span>
 trigger = <span class="violet">UNCalendarNotificationTrigger</span>
 (dateMatching: dateComponents, <img class="inline" src="Image00093.jpg" />
<br />
        repeats: <span class="pink">true</span>
 )<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent"><span id="page_196"></span>
 To do this, first we get the month and the day <span class="code">DateComponents</span>
 from <span class="code">birthDate</span>
 by using the <span class="code">Calendar</span>
 method <span class="code">dateComponents(_:from:)</span>
 . We pass in just <span class="code">[.month, .day]</span>
 for the components <span class="ent">➊</span>
 , and not the year. This is because we want the trigger to go off every year, not just on the year the person was born—which is in the past, so it would never happen anyway! We want to send the birthdate notification at 8 <span class="smallcaps">AM</span>
 , so next we set <span class="code">dateComponents .hour</span>
 to <span class="code">8</span>
 <span class="ent">➋</span>
 .</p>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent">At <span class="ent">➌</span>
 , we create the <span class="code">UNCalendarNotificationTrigger</span>
 with its initializer. This initializer takes two parameters: the <span class="code">dateComponents</span>
 and a Boolean that says whether you want the trigger to be repeated or not. We want the trigger to be repeated every year, so we pass in <span class="code">true</span>
 . Swift is smart about how often you want a trigger to be repeated. If you passed in <span class="code">DateComponents</span>
 that were just an hour and a minute, for example, it would fire the notification every day at that hour and minute. Because we passed in a month and a day, the trigger will repeat every year.</p>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<div class="image"><img src="Image00263.jpg" />
</div>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<div class="box1">
<p class="box-title">
<strong>THE CALENDAR AND DATECOMPONENTS CLASSES</strong>
</p>
<p class="box-p">The <span class="code">Calendar</span>
 and <span class="code">DateComponents</span>
 classes make it super easy to create dates and times. <span class="code">DateComponents</span>
 has integer properties that you can set for the year, month, day, hour, minute, and second of a date and time, or a time interval. The <span class="code">Calendar</span>
 class has methods to convert <span class="code">DateComponents</span>
 into a <span class="code">Date</span>
 or vice versa. To try creating a date, open your Swift playground. We’ll create a date and time of May 10, 1971, at 8:23 <span class="smallcaps">AM</span>
 :</p>
<div class="image"><img src="Image00264.jpg" />
</div>
<p class="box-pi"><span id="page_197"></span>
 First, we create a variable called <span class="code">myDateComponents</span>
 <span class="ent">➊</span>
 , which we’ll use to create our date. After creating <span class="code">myDateComponents</span>
 , we can set integers for its various properties. The months of the year are all represented by integers in numeric order, from <span class="code">1</span>
 for January to <span class="code">12</span>
 for December. For May, we set <span class="code">myDateComponents.month</span>
 to <span class="code">5</span>
 <span class="ent">➋</span>
 . For 8 <span class="smallcaps">AM</span>
 , we use <span class="code">8</span>
 for <span class="code">myDateComponents.hour</span>
 <span class="ent">➌</span>
 . The <span class="code">myDateComponents</span>
 properties use a 24-hour clock so that each hour of a 24-hour day is labeled in numeric order, starting with <span class="code">0</span>
 for midnight. So all the hours before noon would be the same as on a 12-hour clock, but for 2 <span class="smallcaps">PM</span>
 , which is two hours after noon, we would count two hours past 12 and set <span class="code">myDateComponents</span>
 to <span class="code">14</span>
 . For another example, 11 <span class="smallcaps">PM</span>
 would be <span class="code">23</span>
 . Finally, we can make a date from <span class="code">myDateComponents</span>
 by using the <span class="code">date(from:)</span>
 method on the <span class="code">Calendar</span>
 class <span class="ent">➍</span>
 . To use this method, we first need a <span class="code">Calendar</span>
 instance. We use <span class="code">Calendar.current</span>
 , which returns the type of calendar being used by the device. In most Western countries, this is the Gregorian calendar, which has 12 months and a 7-day week.</p>
<div class="image"><img src="Image00265.jpg" />
</div>
<p class="box-pi">To get <span class="code">DateComponents</span>
 out of a <span class="code">Date</span>
 , we use the <span class="code">Calendar</span>
 method <span class="code">myDateComponents(_:from:)</span>
 . This method takes two parameters: the first is an array of the <span class="code">DateComponents</span>
 that you want out of the <span class="code">Date</span>
 , and the second is the <span class="code">Date</span>
 itself. The <span class="code">myDateComponents(_:from:)</span>
 method is useful if you want to create a new <span class="code">Date</span>
 object that is today’s date, but at 8 <span class="smallcaps">AM</span>
 , for example.</p>
<p class="box-pi">Write the following in your playground:</p>
<div class="image"><img src="Image00266.jpg" />
</div>
<p class="box-pi">The line at <span class="ent">➊</span>
 creates the current date and time and assigns it to a constant called <span class="code">today</span>
 . Next, we get the <span class="code">myDateComponents</span>
 for the month, day, and year out of <span class="code">today</span>
 <span class="ent">➋</span>
 . Note that we pass in only the <span class="code">DateComponents</span>
 properties that we care about. We don’t need the hour, minutes, or seconds, for example. We make <span class="code">myDateComponents</span>
 a variable instead of a constant because we are going to set the <span class="code">hour</span>
 property, which we do at <span class="ent">➌</span>
 . Finally, we create a new date called <span class="code">todayEightAm</span>
 using <span class="code">myDateComponents</span>
 <span class="ent">➍</span>
 . You should see that the new <span class="code">Date</span>
 is the same as today, except the time is 8:00 <span class="smallcaps">AM</span>
 .</p>
</div>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent"><span id="page_198"></span>
 Now that we have our notification content and trigger, we are almost ready to create a <span class="code">UNNotificationRequest</span>
 object to schedule the notification. But to create a <span class="code">UNNotificationRequest</span>
 , first we need an identifier. This is a string that can be used to identify the notification.</p>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent">We’ll also use this identifier to remove a scheduled notification if we delete a birthday from the app. After all, you wouldn’t want to be getting notifications for birthdays that you deleted!</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , we added a <span class="code">birthdayId</span>
 property to <span class="code">Birthday</span>
 , so we’ll use <span class="code">birthdayId</span>
 as the identifier of our notification. First, we need to unwrap the optional <span class="code">birthdayId</span>
 property and store it in a constant called <span class="code">identifier</span>
 . Then, we can create a notification request using the <span class="code">identifier</span>
 and the <span class="code">trigger</span>
 . Add the following code right after <span class="code">trigger</span>
 is created:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<div class="box">
<pre>
<span class="ash">do {</span>
<br />
    <span class="ash">--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
    <span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
        <span class="ash">repeats: true)</span>
<br />
    <span class="pink">if let</span>
 identifier = newBirthday.<span class="green1">birthdayId</span>
 {<br />
<br />
     <span class="ent">➊</span>
 <span class="pink">let</span>
 request = <span class="violet">UNNotificationRequest</span>
 (identifier: identifier,<img class="inline" src="Image00093.jpg" />
<br />
           content: content, trigger: trigger)<br />
     <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
     <span class="ent">➌</span>
 center.<span class="violet">add</span>
 (request, withCompletionHandler: <span class="pink">nil</span>
 )<br />
    }<br />
<span class="ash">} catch let error {</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent">At <span class="ent">➊</span>
 , we create the <span class="code">UNNotificationRequest</span>
 using the <span class="code">identifier</span>
 , <span class="code">content</span>
 , and <span class="code">trigger</span>
 . After <span class="code">request</span>
 is created, it must be added to the <span class="code">UNUserNotificationCenter</span>
 . To do this, we create a constant called <span class="code">center</span>
 <span class="ent">➋</span>
 , which is the current <span class="code">UNUserNotificationCenter</span>
 of the app. Then we use the method <span class="code">add(_:withCompletionHandler:)</span>
 to add the request for our scheduled notification <span class="ent">➌</span>
 . This method takes two parameters, a <span class="code">UNNotificationRequest</span>
 and a closure as a <span class="code">completionHandler</span>
 that performs some action after the notification has been added. We pass in our request for the first parameter, and since we don’t need to do anything when the request has been added, we pass in <span class="code">nil</span>
 for the <span class="code">completionHandler</span>
 .</p>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent">Whew! We’ve just finished writing the method to schedule a notification! Now if you run your app and create <span class="code">Birthday</span>
 objects, you’ll receive a notification when it’s someone’s birthday!</p>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent">To test your notifications, you’d need to add a birthday for the next day and wait until 8 <span class="smallcaps">AM</span>
 for your notification to appear. But waiting a whole day to test your code is too long! To test your code right now, tweak it to make the notification go off much sooner. Set the hour and minute of <span class="code">myDateComponents</span>
 to be 10 minutes from the present time. So if it’s 1:35 <span class="smallcaps">PM</span>
 , change the code that you just wrote to the following:</p>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<div class="box">
<pre>
<span class="ash">var dateComponents = Calendar.current.dateComponents([.month, .day],</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">from: birthDate)</span>
<br />
<span id="page_199"></span>
<br />
dateComponents.<span class="violet">hour</span>
 = <span class="blue1">13</span>
<br />
dateComponents.<span class="violet">minute</span>
 = <span class="blue1">45</span>
<br />
<br />
<span class="ash">let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents,</span>
 <img class="inline" src="Image00184.jpg" />
<br />
    <span class="ash">repeats: true)<br />
--</span>
 <span class="ash">
<em>snip</em>
</span>
 <span class="ash">--</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent">Then run the app, add a birthday with today’s date, turn off the app by clicking the stop button (but keep the simulated iPhone’s window open), and wait 10 minutes. You should see a notification appear like the one in <a href="text00024.html#ch13fig4">Figure 13-4</a>
 . After testing, don’t forget to change your code back so that the notifications go off first thing in the morning!</p>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<div class="image"><img src="Image00267.jpg" />
</div>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="figcap"><a id="ch13fig4"></a>
 <em>Figure 13-4: A banner-style birthday notification</em>
</p>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<h4 class="h4" id="ch13lev2sec3">
<strong>REMOVING A NOTIFICATION</strong>
</h4>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="noindent">When we remove a birthday from the app, we’ll also want to cancel its corresponding notification, which we can do in the <span class="code">BirthdaysTableViewController</span>
 by adding some code. A good place to do this is right after the user selects a birthday to delete, in <span class="code">tableView(_:commitEditingStyle:forRowAtIndexPath:)</span>
 . Add the following lines to that method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<div class="box">
<pre>  <span class="ash">let birthday = birthdays[indexPath.row]</span>
<br />
<br />
  <span class="green">// Remove notification</span>
<br />
<span class="ent">➊</span>
 <span class="pink">if let</span>
 identifier = birthday.<span class="green1">birthdayId</span>
 {<br />
    <span class="ent">➋</span>
 <span class="pink">let</span>
 center = <span class="violet">UNUserNotificationCenter</span>
 .<span class="blue">current</span>
 ()<br />
    <span class="ent">➌</span>
 center.<span class="blue">removePendingNotificationRequests</span>
 (withIdentifiers: [identifier])<br />
   }<br />
<br />
  <span class="ash">let appDelegate = UIApplication.sharedApplication().delegate as! AppDelegate</span>
<br />
  <span class="ash">let context = appDelegate.managedObjectContext</span>
</pre>
</div>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent">To remove the notification for a birthday, first we unwrap the <span class="code">birthdayId</span>
 to use it as an <span class="code">identifier</span>
 <span class="ent">➊</span>
 . Next, we get the <span class="code">UNUserNotificationCenter</span>
 <span class="ent">➋</span>
 and remove the notification <span class="ent">➌</span>
 . The remove method takes an array of identifiers so that you can remove more than one notification at a time, but since we want to remove only one, we pass it <span class="code">[identifier]</span>
 , which is an array but has only one value.</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>The BirthdayTracker app is now complete! Remember that the final project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>, so you can compare yours to double-check that everything is in the right place.</em>
</p>
</div>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<h3 class="h3" id="ch13lev1sec2"><span id="page_200"></span>
 <strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="noindent">In this chapter, we showed you how to use the User Notifications framework to ping your users on their friends’ birthdays. You learned how to add a notification that will be sent at a specific time every year and also how to remove that notification if the user removes a birthday from the app.</p>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<p class="indent">In <a href="text00025.html#part03">Part 3</a>
 , you’ll build another exciting app—a game called Schoolhouse Skateboarder, which features graphics, sounds, and more!</p>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
<div class="image"><img src="Image00268.jpg" />
</div>
</body>
</html>
</body></html>