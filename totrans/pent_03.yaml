- en: Chapter 1. Setting Up Your Virtual Lab
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As you work through this book, you’ll get hands-on experience using different
    tools and techniques for penetration testing by working in a virtual lab running
    in the VMware virtualization software. I’ll walk you through setting up your lab
    to run multiple operating systems inside your base operating system in order to
    simulate an entire network using just one physical machine. We’ll use our lab
    to attack target systems throughout this book.
  prefs: []
  type: TYPE_NORMAL
- en: Installing VMware
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As the first step in setting up your virtual lab, download and install a desktop
    VMware product. VMware Player is available free for personal use for Microsoft
    Windows and Linux operating systems (*[http://www.vmware.com/products/player/](http://www.vmware.com/products/player/)*).
    VMware also offers VMware Workstation (*[http://www.vmware.com/products/workstation/](http://www.vmware.com/products/workstation/)*)
    for Windows and Linux, which includes additional features such as the ability
    to take snapshots of the virtual machine that you can revert to in case you break
    something. VMware Workstation is available for free for 30 days, but after that,
    you will need to buy it or switch back to using VMware Player.
  prefs: []
  type: TYPE_NORMAL
- en: Mac users can run a trial version of VMware Fusion (*[http://www.vmware.com/products/fusion/](http://www.vmware.com/products/fusion/)*)
    free for 30 days, and it costs only about $50 after that. As a Mac user, I’ll
    use VMware Fusion throughout the book, but setup instructions are also included
    for VMware Player.
  prefs: []
  type: TYPE_NORMAL
- en: Download the version of VMware that matches your operating system and architecture
    (32- or 64-bit). If you encounter any problems installing VMware, you’ll find
    plenty of support at the VMware website.
  prefs: []
  type: TYPE_NORMAL
- en: Setting Up Kali Linux
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Kali Linux is a Debian-based Linux distribution that comes with a wide variety
    of preinstalled security tools that we’ll use throughout this book. This book
    is written for Kali 1.0.6, the current version as of this writing. You’ll find
    a link to a torrent containing a copy of Kali 1.0.6 at this book’s website (*[http://nostarch.com/pentesting/](http://nostarch.com/pentesting/)*).
    As time passes, newer versions of Kali will be released. If you would like, feel
    free to download the latest version of Kali Linux from *[http://www.kali.org/](http://www.kali.org/)*.
    Keep in mind, though, that many of the tools we’ll use in this book are in active
    development, so if you use a newer version of Kali, some of the exercises may
    differ from the walkthroughs in this book. If you prefer everything to work as
    written, I recommend using the version of Kali 1.0.6 provided in the torrent (a
    file called *kali-linux-1.0.6-vm-i486.7z*), which is a prebuilt VMware image compressed
    with 7-Zip.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You can find 7-Zip programs for Windows and Linux platforms at *[http://www.7-zip.org/download.html](http://www.7-zip.org/download.html)*.
    For Mac users, I recommend Ez7z from *[http://ez7z.en.softonic.com/mac/](http://ez7z.en.softonic.com/mac/)*.
  prefs: []
  type: TYPE_NORMAL
- en: Once the 7-Zip archive is decompressed, in VMware go to **File** ▸ **Open**
    and direct it to the file *Kali Linux 1.0.6 32 bit.vmx* in the decompressed *Kali
    Linux 1.0.6 32 bit* folder.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once the virtual machine opens, click the **Play** button and, when prompted
    as shown in [Figure 1-1](ch01.xhtml#opening_the_kali_linux_virtual_machine "Figure 1-1. Opening
    the Kali Linux virtual machine"), choose **I copied it**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: As Kali Linux boots up, you will be prompted as shown in [Figure 1-2](ch01.xhtml#booting_kali_linux
    "Figure 1-2. Booting Kali Linux"). Choose the top (default) highlighted option.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Opening the Kali Linux virtual machine](httpatomoreillycomsourcenostarchimages2030194.png.jpg)Figure 1-1. Opening
    the Kali Linux virtual machine![Booting Kali Linux](httpatomoreillycomsourcenostarchimages2030196.png.jpg)Figure 1-2. Booting
    Kali Linux'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Once Kali Linux boots, you will be presented with a login screen like the one
    shown in [Figure 1-3](ch01.xhtml#kali_login_screen "Figure 1-3. Kali login screen").
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Kali login screen](httpatomoreillycomsourcenostarchimages2030198.png.jpg)Figure 1-3. Kali
    login screen'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Click **Other** and enter the default credentials for Kali Linux, *root:toor*,
    as shown in [Figure 1-4](ch01.xhtml#logging_into_kali "Figure 1-4. Logging into
    Kali"). Then click the **Log In** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Logging into Kali](httpatomoreillycomsourcenostarchimages2030200.png.jpg)Figure 1-4. Logging
    into Kali'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: You will be presented with a screen like the one shown in [Figure 1-5](ch01.xhtml#kali_linux_gui
    "Figure 1-5. The Kali Linux GUI").
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![The Kali Linux GUI](httpatomoreillycomsourcenostarchimages2030202.png.jpg)Figure 1-5. The
    Kali Linux GUI'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Configuring the Network for Your Virtual Machine
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Because we’ll be using Kali Linux to attack our target systems over a network,
    we need to place all our virtual machines on the same virtual network (we will
    see an example of moving between networks in [Chapter 13](ch13.xhtml "Chapter 13. Post
    Exploitation"), which covers post exploitation). VMware offers three options for
    virtual network connections: bridged, NAT, and host only. You should choose the
    bridged option, but here’s a bit of information about each:'
  prefs: []
  type: TYPE_NORMAL
- en: The *bridged network* connects the virtual machine directly to the local network
    using the same connection as the host system. As far as the local network is concerned,
    our virtual machine is just another node on the network with its own IP address.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*NAT*, short for *network address translation*, sets up a private network on
    the host machine. The private network translates outgoing traffic from the virtual
    machine to the local network. On the local network, traffic from the virtual machine
    will appear to come from the host machine’s IP address.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The *host-only* network limits the virtual machine to a local private network
    on the host. The virtual machine will be able to communicate with other virtual
    machines in the host-only network as well as the host machine itself, but it will
    not be able to send or receive any traffic with the local network or the Internet.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Because our target virtual machines will have multiple known security vulnerabilities,
    use caution when attaching them to your local network because anyone else on that
    network can also attack these machines. For this reason, I do not recommend working
    through this book on a public network where you do not trust the other users.
  prefs: []
  type: TYPE_NORMAL
- en: By default, the Kali Linux virtual machine network adapter is set to NAT. Here’s
    how to change that option on both Windows and Mac OS.
  prefs: []
  type: TYPE_NORMAL
- en: VMware Player on Microsoft Windows
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: To change the virtual network on VMware Player for Windows, start VMware Player
    and then click your Kali Linux virtual machine. Choose **Edit virtual machine
    settings**, as shown in [Figure 1-6](ch01.xhtml#changing_the_vmware_network_adapter
    "Figure 1-6. Changing the VMware network adapter"). (If you’re still running Kali
    Linux in VMware Player, choose **Player** ▸ **Manage** ▸ **Virtual machine settings**.)
  prefs: []
  type: TYPE_NORMAL
- en: '![Changing the VMware network adapter](httpatomoreillycomsourcenostarchimages2030204.png.jpg)Figure 1-6. Changing
    the VMware network adapter'
  prefs: []
  type: TYPE_NORMAL
- en: On the next screen, choose **Network Adapter** in the Hardware tab and choose
    the **Bridged** option in the **Network connection** section, as shown in [Figure 1-7](ch01.xhtml#changing_the_network_adapter_settings
    "Figure 1-7. Changing the network adapter settings").
  prefs: []
  type: TYPE_NORMAL
- en: '![Changing the network adapter settings](httpatomoreillycomsourcenostarchimages2030206.png.jpg)Figure 1-7. Changing
    the network adapter settings'
  prefs: []
  type: TYPE_NORMAL
- en: Now click the **Configure Adapters** button and check the network adapter that
    you’re using with your host operating system. As you can see in [Figure 1-8](ch01.xhtml#selecting_a_network_adapter
    "Figure 1-8. Selecting a network adapter"), I’ve selected only the Realtek wireless
    adapter. Once you’ve made your selection, press **OK**.
  prefs: []
  type: TYPE_NORMAL
- en: '![Selecting a network adapter](httpatomoreillycomsourcenostarchimages2030208.png.jpg)Figure 1-8. Selecting
    a network adapter'
  prefs: []
  type: TYPE_NORMAL
- en: VMware Fusion on Mac OS
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: To change the virtual network connection in VMware Fusion, go to **Virtual Machine**
    ▸ **Network Adapter** and change from NAT to Bridged, as shown in [Figure 1-9](ch01.xhtml#changing_the_network_adapter
    "Figure 1-9. Changing the network adapter").
  prefs: []
  type: TYPE_NORMAL
- en: '![Changing the network adapter](httpatomoreillycomsourcenostarchimages2030210.png.jpg)Figure 1-9. Changing
    the network adapter'
  prefs: []
  type: TYPE_NORMAL
- en: Connecting the Virtual Machine to the Network
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Kali Linux should automatically pull an IP address from the Bridged network
    once you make the switch. To verify your IP address, open a Linux terminal by
    clicking the terminal icon(a black rectangle with the symbols >_) at the top left
    of the Kali screen (or choose **Applications** ▸ **Accessories** ▸ **Terminal**).
    Then run the command `ifconfig` to see your network information, as shown in [Example 1-1](ch01.xhtml#networking_information
    "Example 1-1. Networking information").
  prefs: []
  type: TYPE_NORMAL
- en: Example 1-1. Networking information
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The prompt `root@kali:~#` is the superuser (root) prompt. We will learn more
    about this and the other Linux commands we use for setup in [Chapter 2](ch02.xhtml
    "Chapter 2. Using Kali Linux").
  prefs: []
  type: TYPE_NORMAL
- en: The IPv4 address for this virtual machine is 192.168.20.9, as highlighted in
    bold in [Example 1-1](ch01.xhtml#networking_information "Example 1-1. Networking
    information"). (The IP address for your machine will likely differ.)
  prefs: []
  type: TYPE_NORMAL
- en: Testing Your Internet Access
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Now let’s make sure that Kali Linux can connect to the Internet. We’ll use the
    ping network utility to see if we can reach Google. Make sure your computer is
    connected to the Internet, open a Linux terminal, and enter the following.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: If you see something like the following in response, you’re online. (We’ll learn
    more about the `ping` command in [Chapter 3](ch03.xhtml "Chapter 3. Programming").)
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: If you do not receive a response, make sure that you have set your network adapter
    to Bridged, that Kali Linux has an IP address, and, of course, that your host
    system currently has Internet access.
  prefs: []
  type: TYPE_NORMAL
- en: Installing Nessus
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Although Kali Linux has just about every tool we’ll need, we do need to install
    a few additional programs. First, we’ll install Tenable Security’s Nessus Home
    vulnerability scanner. This scanner is free for home use only (you’ll see a description
    of limitations on the Nessus website). Note that Nessus is very actively developed,
    so the current version as well as its GUI may have changed a bit since this book
    went to press.
  prefs: []
  type: TYPE_NORMAL
- en: 'Use the following steps to install Nessus Home from within Kali:'
  prefs: []
  type: TYPE_NORMAL
- en: Open **Applications** ▸ **Internet** ▸ **Iceweasel Web Browser** and enter *[http://www.tenable.com/products/nessus-home/](http://www.tenable.com/products/nessus-home/)*
    in the address bar. Complete the Register for an Activation Code information and
    click **Register**. (Use a real email address—you’ll need the activation code
    later.)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once you reach the Downloads page, choose the latest version of Nessus for the
    Linux Debian 32-bit platform (*Nessus-5.2.5-debian6_i386.deb* as of this writing)
    and download it to your root directory (the default download location).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open a Linux terminal (click the terminal icon at the top of the Kali screen)
    to open a root prompt.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter **`ls`** to see a list of the files in your root directory. You should
    see the Nessus file that you just downloaded.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter **`dpkg -i`** followed by the name of the file you downloaded (you can
    type the first letter of the filename and press tab to use tab completion) and
    press enter to begin the install process. Installation may take a while as Nessus
    processes various plugins. Progress is shown by a line of hash symbols (`#`).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Once you’re returned to the root prompt with no errors, Nessus should be installed,
    and you should see a message like this.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Now enter the following to start Nessus.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Open the URL *https://kali:8834/* in the Iceweasel web browser. You should see
    a SSL certificate warning, similar to that in [Figure 1-10](ch01.xhtml#invalid_ssl_certificate_warning
    "Figure 1-10. Invalid SSL certificate warning").
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: If you access Nessus from outside the Iceweasel browser in Kali, you will need
    to go to *https://<ipaddressofKali>:8834* instead.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![Invalid SSL certificate warning](httpatomoreillycomsourcenostarchimages2030212.png.jpg)Figure 1-10. Invalid
    SSL certificate warning'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Expand **I Understand the Risks** and click **Add Exception**. Then click **Confirm
    Security Exception**, as shown in [Figure 1-11](ch01.xhtml#confirming_the_security_exception
    "Figure 1-11. Confirming the security exception").
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Confirming the security exception](httpatomoreillycomsourcenostarchimages2030214.png.jpg)Figure 1-11. Confirming
    the security exception'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Click **Get Started** at the bottom left of the opening Nessus page and enter
    a username and password on the following page. I’ve chosen *georgia:password*
    for my example. If you choose something else, remember it because we’ll use Nessus
    in [Chapter 6](ch06.xhtml "Chapter 6. Finding Vulnerabilities"). (Note that I
    use poor passwords throughout this book, as will many clients you encounter. In
    production, you should use much better passwords than *password*.)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: At the next page, enter the activation code you received via email from Tenable
    Security.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once registered with Tenable Security, choose the option to download plugins
    (downloading will take some time). Once Nessus processes the plugins, it will
    initialize.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When Nessus finishes downloading plugins and configuring the software, you should
    see the Nessus login screen, as shown in [Figure 1-12](ch01.xhtml#login_screen_of_the_nessus_web_interface
    "Figure 1-12. Login screen of the Nessus web interface"). You should be able to
    use the credentials for the account you created during setup to log in.
  prefs: []
  type: TYPE_NORMAL
- en: '![Login screen of the Nessus web interface](httpatomoreillycomsourcenostarchimages2030216.png.jpg)Figure 1-12. Login
    screen of the Nessus web interface'
  prefs: []
  type: TYPE_NORMAL
- en: To close Nessus, just close its tab in the browser. We will come back to Nessus
    in [Chapter 6](ch06.xhtml "Chapter 6. Finding Vulnerabilities").
  prefs: []
  type: TYPE_NORMAL
- en: Installing Additional Software
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: We’re not done yet. Follow these instructions to complete your Kali Linux install.
  prefs: []
  type: TYPE_NORMAL
- en: The Ming C Compiler
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: We need to install a cross compiler so we can compile C code to run on Microsoft
    Windows systems. The Ming compiler is included in the Kali Linux repositories
    but is not installed by default. Install it with this command.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: Hyperion
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: We’ll use the Hyperion encryption program to bypass antivirus software. Hyperion
    is not currently included in the Kali repositories. Download Hyperion with `wget`,
    unzip it, and compile it with the Ming cross compiler you installed in the previous
    step, as shown in [Example 1-2](ch01.xhtml#installing_hyperion "Example 1-2. Installing
    Hyperion").
  prefs: []
  type: TYPE_NORMAL
- en: Example 1-2. Installing Hyperion
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: Veil-Evasion
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Veil-Evasion is a tool that generates payload executables you can use to bypass
    common antivirus solutions. Install Veil-Evasion Kali (see [Example 1-3](ch01.xhtml#installing_veil-evasion
    "Example 1-3. Installing Veil-Evasion")) by first downloading it with the command
    `wget`. Next, unzip the downloaded file *master.zip* and change to the *Veil-master/setup*
    directory. Finally, enter **`./setup.sh`** and follow the default prompts.
  prefs: []
  type: TYPE_NORMAL
- en: Example 1-3. Installing Veil-Evasion
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: Ettercap
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Ettercap is a tool for performing man-in-the-middle attacks. Before running
    it for the first time, we need to make a couple of changes to its configuration
    file at /*etc/ettercap/etter.conf*. Open its configuration file from a Kali root
    prompt in the nano editor.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: First change the `userid` and `groupid` values to **`0`** so Ettercap can run
    with root privileges. Scroll down to where you see the following lines in the
    file. Replace whatever values you see following the equal signs (`=`) with a `0`.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: Now scroll down to the `Linux` section of the file and uncomment (remove the
    leading `#` characters) before the two lines shown at ❶ and ❷ in [Example 1-4](ch01.xhtml#ettercap_configuration_file
    "Example 1-4. Ettercap configuration file") to set Iptables firewall rules to
    redirect the traffic.
  prefs: []
  type: TYPE_NORMAL
- en: Example 1-4. Ettercap configuration file
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: Save and exit the file by pressing ctrl-X and then Y to save the changes.
  prefs: []
  type: TYPE_NORMAL
- en: Setting Up Android Emulators
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Now we’ll set up three Android emulators on Kali to use for mobile testing in
    [Chapter 20](ch20.xhtml "Chapter 20. Using the Smartphone Pentest Framework").
    First we’ll need to download the Android SDK.
  prefs: []
  type: TYPE_NORMAL
- en: Open the Iceweasel web browser from within Kali and visit *[https://developer.android.com/sdk/index.html](https://developer.android.com/sdk/index.html)*.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Download the current version of the ADT bundle for 32-bit Linux and save it
    to your root directory.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open a terminal, list the files there (`ls`), and extract the compressed archive
    that you just downloaded with unzip (the *x*’s represent the name of your file,
    as versions may have changed since this was written).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Now use `cd` to go into the new directory (with the same name as the file without
    the *.zip* extension).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: The Android SDK Manager should open, as shown in [Figure 1-13](ch01.xhtml#android_sdk_manager
    "Figure 1-13. The Android SDK Manager").
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![The Android SDK Manager](httpatomoreillycomsourcenostarchimages2030218.png.jpg)Figure 1-13. The
    Android SDK Manager'
  prefs: []
  type: TYPE_NORMAL
- en: We’ll download any updates to the Android SDK tools and Android SDK platform
    tools (checked by default), as well as Android 4.3 and a couple of older versions
    of Android with specific vulnerabilities, Android 2.2 and Android 2.1\. Select
    the boxes to the left of each Android version. Then (leaving Updates/New and Installed
    checked) click **Install packages**, as shown in [Figure 1-14](ch01.xhtml#installing_android_software
    "Figure 1-14. Installing Android software"). Accept the license agreement, and
    the Android SDK should download and install the chosen packages. Installation
    will likely take several minutes.
  prefs: []
  type: TYPE_NORMAL
- en: '![Installing Android software](httpatomoreillycomsourcenostarchimages2030220.png.jpg)Figure 1-14. Installing
    Android software'
  prefs: []
  type: TYPE_NORMAL
- en: Now it’s time to set up our Android virtual devices. Open the Android SDK Manager
    and choose **Tools** ▸ **Manage AVDs**. You should see the window shown in [Figure 1-15](ch01.xhtml#android_virtual_device_manager
    "Figure 1-15. Android Virtual Device Manager").
  prefs: []
  type: TYPE_NORMAL
- en: '![Android Virtual Device Manager](httpatomoreillycomsourcenostarchimages2030222.png.jpg)Figure 1-15. Android
    Virtual Device Manager'
  prefs: []
  type: TYPE_NORMAL
- en: We’ll create three Android emulators based on Android 4.3, 2.2, and 2.1, as
    shown in [Figure 1-16](ch01.xhtml#creating_an_android_emulator "Figure 1-16. Creating
    an Android emulator"). Use the values shown in the figure for each emulator but
    set the value of Target to the Android version of the emulator you would like
    to build (the Google API versions of Android 4.3 [Google APIs version 18], 2.2
    [Google APIs version 8], and 2.1 [Google APIs version 7]). Fill the AVD Name field
    with a descriptive value. Add a small SD Card value (100MB should be more than
    sufficient) so you can download files to your Android emulators. Set Device to
    **Nexus 4** and Skin to **Skin with dynamic hardware controls**. Leave the rest
    of the options at their defaults.
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating an Android emulator](httpatomoreillycomsourcenostarchimages2030224.png.jpg)Figure 1-16. Creating
    an Android emulator'
  prefs: []
  type: TYPE_NORMAL
- en: Once you’ve built all three emulators, your AVD Manager should look like [Figure 1-17](ch01.xhtml#android_emulators_created_in_android_vir
    "Figure 1-17. Android emulators created in Android Virtual Device Manager") (device
    names may be different of course).
  prefs: []
  type: TYPE_NORMAL
- en: '![Android emulators created in Android Virtual Device Manager](httpatomoreillycomsourcenostarchimages2030226.png.jpg)Figure 1-17. Android
    emulators created in Android Virtual Device Manager'
  prefs: []
  type: TYPE_NORMAL
- en: To start an emulator, highlight it and click **Start**. Then click **Launch**
    in the pop-up, as shown in [Figure 1-18](ch01.xhtml#launching_an_android_emulator
    "Figure 1-18. Launching an Android emulator").
  prefs: []
  type: TYPE_NORMAL
- en: '![Launching an Android emulator](httpatomoreillycomsourcenostarchimages2030228.png.jpg)Figure 1-18. Launching
    an Android emulator'
  prefs: []
  type: TYPE_NORMAL
- en: It may take a few minutes for the emulator to boot up for the first time, but
    once it does, you should have something that looks and feels much like a real
    Android device. The Android 4.3 emulator is shown in [Figure 1-19](ch01.xhtml#android_4dot3_emulator
    "Figure 1-19. Android 4.3 emulator").
  prefs: []
  type: TYPE_NORMAL
- en: '![Android 4.3 emulator](httpatomoreillycomsourcenostarchimages2030230.png.jpg)Figure 1-19. Android
    4.3 emulator'
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: To run the Android emulators in Kali, you will likely need to increase the performance
    of your virtual machine by increasing its RAM and CPU cores. I am able to run
    all three emulators with 3GB RAM and two CPU cores allocated to Kali. You can
    make these changes in the virtual machine settings in your VMware product. The
    amount of power you can give to Kali will, of course, depend on the resources
    available on your host machine. As an alternative, instead of running the Android
    emulators on Kali Linux, you can install Android and the emulators on your host
    system or even another system on the local network. The exercises in [Chapter 20](ch20.xhtml
    "Chapter 20. Using the Smartphone Pentest Framework") will work as long as the
    emulators can communicate with Kali.
  prefs: []
  type: TYPE_NORMAL
- en: Smartphone Pentest Framework
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Next, download and install the Smartphone Pentest Framework (SPF), which we’ll
    use for mobile attacks. Use `git` to download the source code. Change to the downloaded
    *Smartphone-Pentest-Framework* directory as shown here.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: Now open the file *kaliinstall* in the nano text editor. The first few lines
    are shown in [Example 1-5](ch01.xhtml#installing_smartphone_pentest_framework
    "Example 1-5. Installing Smartphone Pentest Framework"). Note the lines that refer
    to */root/adt-bundle-linux-x86-20131030/sdk/tools/android*. If the name of your
    ADT bundle folder is different (due to the release of a subsequent version), change
    this value to match the correct place where you installed the Android ADT in the
    previous section.
  prefs: []
  type: TYPE_NORMAL
- en: Example 1-5. Installing Smartphone Pentest Framework
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: Now run the *kaliinstall* script, as shown here.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: This will set up the SPF, which we’ll use in [Chapter 20](ch20.xhtml "Chapter 20. Using
    the Smartphone Pentest Framework").
  prefs: []
  type: TYPE_NORMAL
- en: Finally, we need to make one more change to the configuration file for SPF.
    Change directories to *Smartphone-Pentest-Framework/frameworkconsole* and open
    the file *config* in nano. Look for the option `#LOCATION OF ANDROID` `SDK`. If
    your ADT bundle folder name has changed since the version current at the time
    of this writing, change it accordingly in the line that begins with `ANDROIDSDK=`.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: Target Virtual Machines
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We’ll use three custom-built target machines to simulate vulnerabilities often
    found in client environments: Ubuntu 8.10, Windows XP SP3, and Windows 7 SP1.'
  prefs: []
  type: TYPE_NORMAL
- en: You’ll find a link to a torrent containing the Ubuntu virtual machine at *[http://www.nostarch.com/pentesting/](http://www.nostarch.com/pentesting/)*.
    The target system is compressed using the 7-Zip archive, and *1stPentestBook?!*
    is the password for the archive. You can use 7-Zip programs to open the archives
    for all platforms. For the Windows and Linux packages, use *[http://www.7-zip.org/download.html](http://www.7-zip.org/download.html)*;
    for Mac OS, use Ez7z at *[http://ez7z.en.softonic.com/mac/](http://ez7z.en.softonic.com/mac/)*.
    The archive is ready for use as soon as it is unzipped.
  prefs: []
  type: TYPE_NORMAL
- en: To set up the Windows virtual machines, you’ll need to install and configure
    Windows XP SP3 and 32-bit Windows 7 SP1\. Sources for the installation media include
    TechNet and MSDN (the Microsoft Developer Network), among others. (You should
    be able to use your Windows virtual machines on a trial basis for 30 days without
    a license key.)
  prefs: []
  type: TYPE_NORMAL
- en: Creating the Windows XP Target
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Your Windows XP target should be a base installation of Windows XP SP3 with
    no additional security updates. (Visit my website at *[http://www.bulbsecurity.com/](http://www.bulbsecurity.com/)*
    for more information about finding a copy of Windows XP.) Once you have a copy
    of Windows XP SP3, here’s how to install it on Microsoft Windows or Mac OS.
  prefs: []
  type: TYPE_NORMAL
- en: VMware Player on Microsoft Windows
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To install Windows XP on VMware Player for Windows:'
  prefs: []
  type: TYPE_NORMAL
- en: Choose **Create A New Virtual Machine** in VMware Player and point the New Virtual
    Machine Wizard to the Windows XP installation disk or ISO image. Depending on
    your source disk or image, you may be offered the option to use Easy Install (if
    you’re installing a version with a license key), or you may see a yellow triangle
    warning, “Could not detect which operating system is in this disc image. You will
    need to specify which operating system will be installed.” In the latter case,
    just press **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the Select a Guest Operating System dialog, select **Microsoft Windows**
    in the Guest operating system section and your version of Windows XP in the drop-down
    box, as shown in [Figure 1-20](ch01.xhtml#selecting_your_version_of_windows_xp
    "Figure 1-20. Selecting your version of Windows XP"), and press **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Selecting your version of Windows XP](httpatomoreillycomsourcenostarchimages2030232.png.jpg)Figure 1-20. Selecting
    your version of Windows XP'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: In the next dialog, enter **`Bookxp XP SP3`** as the name of your virtual machine
    and press **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the Specify Disk Capacity dialog, accept the recommended hard disk size for
    your virtual machine of 40GB and check the box for **Store virtual disk as a single
    file**, as shown in [Figure 1-21](ch01.xhtml#specifying_the_disk_capacity "Figure 1-21. Specifying
    the disk capacity"), and press **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Specifying the disk capacity](httpatomoreillycomsourcenostarchimages2030234.png.jpg)Figure 1-21. Specifying
    the disk capacity'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: The Virtual Machine will not take up the entire 40GB; it will only take up space
    on your hard drive as needed. This is just a maximum value.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: In the Ready to Create Virtual Machine dialog, shown in [Figure 1-22](ch01.xhtml#customizing_your_hardware
    "Figure 1-22. Customizing your hardware"), click **Customize Hardware**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Customizing your hardware](httpatomoreillycomsourcenostarchimages2030236.png.jpg)Figure 1-22. Customizing
    your hardware'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'In the Hardware dialog, choose **Network Adapter**, and in the Network Connection
    field that appears, select **Bridged: Connected directly to the physical network**.
    Next, click **Configure Adapters** and select the adapter you’re using to connect
    to the Internet, as shown in [Figure 1-23](ch01.xhtml#configuring_your_network_adapter_as_brid
    "Figure 1-23. Configuring your network adapter as bridged"). Then press **OK**,
    **Close**, and **Finish**.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Configuring your network adapter as bridged](httpatomoreillycomsourcenostarchimages2030238.png.jpg)Figure 1-23. Configuring
    your network adapter as bridged'
  prefs: []
  type: TYPE_NORMAL
- en: You should now be able to play your Windows XP virtual machine. Continue to
    the instructions for installing and activating Windows XP in [Installing and Activating
    Windows](ch01.xhtml#installing_and_activating_windows "Installing and Activating
    Windows").
  prefs: []
  type: TYPE_NORMAL
- en: VMware Fusion on Mac OS
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In VMware Fusion, go to **File** ▸ **New** ▸ **Import from disk or image** and
    point it to the Windows XP installation disk or image, as shown in [Figure 1-24](ch01.xhtml#creating_a_new_virtual_machine
    "Figure 1-24. Creating a new virtual machine").
  prefs: []
  type: TYPE_NORMAL
- en: Follow the prompts to create a fresh installation of Windows XP SP3.
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a new virtual machine](httpatomoreillycomsourcenostarchimages2030240.png.jpg)Figure 1-24. Creating
    a new virtual machine'
  prefs: []
  type: TYPE_NORMAL
- en: Installing and Activating Windows
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: As part of the installation process, you will be prompted for a Windows license
    key. If you have one, enter it here. If not, you should be able to use the virtual
    machine on a trial basis for 30 days. To continue without entering a license key,
    click **Next** when prompted for the key. A pop-up will warn you that entering
    a license key is recommended and ask if you would like to enter one now, as shown
    in [Figure 1-25](ch01.xhtml#license_key_dialog "Figure 1-25. License key dialog").
    Just click **No**.
  prefs: []
  type: TYPE_NORMAL
- en: '![License key dialog](httpatomoreillycomsourcenostarchimages2030242.png.jpg)Figure 1-25. License
    key dialog'
  prefs: []
  type: TYPE_NORMAL
- en: As shown in [Figure 1-26](ch01.xhtml#setting_the_computer_name_and_administra
    "Figure 1-26. Setting the computer name and Administrator password"), when prompted,
    set **Computer name** to **`Bookxp`**. Set **Administrator password** to **`password`**.
  prefs: []
  type: TYPE_NORMAL
- en: '![Setting the computer name and Administrator password](httpatomoreillycomsourcenostarchimages2030244.png.jpg)Figure 1-26. Setting
    the computer name and Administrator password'
  prefs: []
  type: TYPE_NORMAL
- en: You can leave the date/time and TCP/IP settings at their defaults when prompted.
    Likewise, leave the Windows XP target as part of the workgroup WORKGROUP instead
    of joining it to a domain, as shown in [Figure 1-27](ch01.xhtml#workgroup_settings
    "Figure 1-27. Workgroup settings").
  prefs: []
  type: TYPE_NORMAL
- en: '![Workgroup settings](httpatomoreillycomsourcenostarchimages2030246.png.jpg)Figure 1-27. Workgroup
    settings'
  prefs: []
  type: TYPE_NORMAL
- en: Tell Windows not to automatically install security updates, as shown in [Figure 1-28](ch01.xhtml#turning_off_automatic_security_updates
    "Figure 1-28. Turning off automatic security updates"). This step is important,
    because some of the exploits we will run rely on missing Windows patches.
  prefs: []
  type: TYPE_NORMAL
- en: '![Turning off automatic security updates](httpatomoreillycomsourcenostarchimages2030248.png.jpg)Figure 1-28. Turning
    off automatic security updates'
  prefs: []
  type: TYPE_NORMAL
- en: You will then be prompted to activate Windows. If you entered a license key,
    go ahead and activate it. Otherwise you can choose **No, remind me every few days**,
    as shown in [Figure 1-29](ch01.xhtml#activating_windows "Figure 1-29. Activating
    Windows").
  prefs: []
  type: TYPE_NORMAL
- en: '![Activating Windows](httpatomoreillycomsourcenostarchimages2030250.png.jpg)Figure 1-29. Activating
    Windows'
  prefs: []
  type: TYPE_NORMAL
- en: Now create user accounts *georgia* and *secret*, as shown in [Figure 1-30](ch01.xhtml#adding_users
    "Figure 1-30. Adding users"). We will create passwords for these users after setup
    is finished.
  prefs: []
  type: TYPE_NORMAL
- en: '![Adding users](httpatomoreillycomsourcenostarchimages2030252.png.jpg)Figure 1-30. Adding
    users'
  prefs: []
  type: TYPE_NORMAL
- en: When Windows starts up, log in as the user *georgia* with no password.
  prefs: []
  type: TYPE_NORMAL
- en: Installing VMware Tools
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Now install VMware Tools, which will make it easier to use your virtual machine
    by, for example, letting you copy/paste and drag programs onto the virtual machine
    from the host system.
  prefs: []
  type: TYPE_NORMAL
- en: VMware Player on Microsoft Windows
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: In VMware Player, install VMware Tools from **Player** ▸ **Manage** ▸ **Install
    VMware Tools**, as shown in [Figure 1-31](ch01.xhtml#installing_vmware_tools_in_vmware_player
    "Figure 1-31. Installing VMware Tools in VMware Player"). The VMware Tools installer
    should automatically run in Windows XP.
  prefs: []
  type: TYPE_NORMAL
- en: '![Installing VMware Tools in VMware Player](httpatomoreillycomsourcenostarchimages2030254.png.jpg)Figure 1-31. Installing
    VMware Tools in VMware Player'
  prefs: []
  type: TYPE_NORMAL
- en: VMware Fusion on Mac OS
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Install VMware Tools from **Virtual Machines** ▸ **Install VMware Tools**, as
    shown in [Figure 1-32](ch01.xhtml#installing_vmware_tools_in_vmware_fusion "Figure 1-32. Installing
    VMware Tools in VMware Fusion"). The VMware Tools installer should automatically
    run in Windows XP.
  prefs: []
  type: TYPE_NORMAL
- en: '![Installing VMware Tools in VMware Fusion](httpatomoreillycomsourcenostarchimages2030256.png.jpg)Figure 1-32. Installing
    VMware Tools in VMware Fusion'
  prefs: []
  type: TYPE_NORMAL
- en: Turning Off Windows Firewall
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Now open the Control Panel from the Windows Start menu. Click **Security Center**
    ▸ **Windows Firewall** to turn off the Windows Firewall, as shown in [Figure 1-33](ch01.xhtml#turning_off_the_windows_firewall
    "Figure 1-33. Turning off the Windows firewall").
  prefs: []
  type: TYPE_NORMAL
- en: '![Turning off the Windows firewall](httpatomoreillycomsourcenostarchimages2030258.png.jpg)Figure 1-33. Turning
    off the Windows firewall'
  prefs: []
  type: TYPE_NORMAL
- en: Setting User Passwords
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Again in the Control Panel, go to User Accounts. Click the user **georgia**
    and then select **Create a password**. Set *georgia*’s password to **`password`**,
    as shown in [Figure 1-34](ch01.xhtml#setting_a_user_password "Figure 1-34. Setting
    a user password"). Do the same thing for the user *secret*, but set *secret*’s
    password to **`Password123`**.
  prefs: []
  type: TYPE_NORMAL
- en: '![Setting a user password](httpatomoreillycomsourcenostarchimages2030260.png.jpg)Figure 1-34. Setting
    a user password'
  prefs: []
  type: TYPE_NORMAL
- en: Setting a Static IP Address
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Next, set a static IP address so your networking information won’t change as
    you work through the book. But first we need to figure out the address of our
    default gateway.
  prefs: []
  type: TYPE_NORMAL
- en: Ensure that your Windows XP system is set to use bridged networking in VMware.
    By default, your virtual machine will automatically pull an IP address using DHCP.
  prefs: []
  type: TYPE_NORMAL
- en: To find the default gateway, open a Windows command prompt by going to **Start**
    ▸ **Run**, entering **`cmd`**, and clicking **OK**. In the command prompt, enter
    **`ipconfig`**. This will show you the networking information, including the default
    gateway.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: In my case, the IP address is 192.168.20.10, the subnet mask is 255.255.255.0,
    and the default gateway is 192.168.20.1.
  prefs: []
  type: TYPE_NORMAL
- en: In the Control Panel, go to **Network and Internet Connections** and click **Network
    Connections** at the bottom of the screen.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Right-click **Local Area Connection** and then select **Properties**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Highlight **Internet Protocol (TCP/IP)** and select **Properties**. Now enter
    a static IP address and set the Subnet mask and Default gateway to match the data
    you found with the `ipconfig` command, as shown in [Figure 1-35](ch01.xhtml#setting_a_static_ip_address-id00006
    "Figure 1-35. Setting a static IP address"). Set the Preferred DNS server to your
    default gateway as well.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now it’s time to see if our virtual machines can communicate. Once you’re sure
    that the settings match, return to the Kali virtual machine (start it if you had
    shut it down) and enter **`ping <`**`static` `ip address of your Windows XP virtual
    machine`**`>`**, as shown here.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: My IP address is 192.168.20.10\. Throughout the book, you should replace this
    value with the IP address of your systems.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: '![Setting a static IP address](httpatomoreillycomsourcenostarchimages2030262.png.jpg)Figure 1-35. Setting
    a static IP address'
  prefs: []
  type: TYPE_NORMAL
- en: Enter ctrl-C to stop the `ping` command. If you see output beginning with `64
    bytes from <`*`ip address of XP`*`>`, as shown previously, your virtual machines
    are able to communicate. Congratulations! You’ve set up a network of virtual machines.
  prefs: []
  type: TYPE_NORMAL
- en: 'If instead you see a message including the text `Destination Host` `Unreachable`,
    troubleshoot your networking: Make sure your virtual machines are on the same
    bridged virtual network, check that your default gateway is correct, and so on.'
  prefs: []
  type: TYPE_NORMAL
- en: Making XP Act Like It’s a Member of a Windows Domain
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Finally, we need to modify a setting in Windows XP so that it will behave as
    if it were a member of a Windows domain, as many of your clients will be. I’m
    not having you set up an entire Windows domain here, but during post exploitation,
    a couple of exercises will simulate a domain environment. Return to your XP virtual
    machine and follow these steps.
  prefs: []
  type: TYPE_NORMAL
- en: Select **Start** ▸ **Run** and enter **`secpol.msc`** to open the Local Security
    Settings panel.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Expand **Local Policies** on the left and double-click **Security Options**
    on the right.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'In the Policy list in the pane on the right, double-click **Network access:
    Sharing and security model for local accounts** and choose **Classic - local users
    authenticate as themselves** from the drop-down list, as shown in [Figure 1-36](ch01.xhtml#changing_a_local_security_setting_to_mak
    "Figure 1-36. Changing a local security setting to make your target act like a
    member of a Windows domain").'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Changing a local security setting to make your target act like a member of
    a Windows domain](httpatomoreillycomsourcenostarchimages2030264.png.jpg)Figure 1-36. Changing
    a local security setting to make your target act like a member of a Windows domain'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Click **Apply** and then **OK**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Close any open windows in your virtual machine.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Installing Vulnerable Software
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In this section we’ll install some vulnerable software on our Windows XP virtual
    machine. We’ll be attacking this software in later chapters. Open your Windows
    XP virtual machine and, while still logged in as user *georgia*, follow the directions
    to install each of the packages listed here.
  prefs: []
  type: TYPE_NORMAL
- en: Zervit 0.4
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Download Zervit version 0.4 from *[http://www.exploit-db.com/exploits/12582/](http://www.exploit-db.com/exploits/12582/)*.
    (Click the Vulnerable App option to download the files.) Unzip the downloaded
    archive and double-click the Zervit program to open and run it. Then enter port
    number **`3232`** in the console when the software starts. Answer **`Y`** to allowing
    directory listing, as shown in [Figure 1-37](ch01.xhtml#starting_zervit_0dot4
    "Figure 1-37. Starting Zervit 0.4"). Zervit will not automatically restart when
    you reboot Windows XP, so you will need to restart it if you reboot.
  prefs: []
  type: TYPE_NORMAL
- en: '![Starting Zervit 0.4](httpatomoreillycomsourcenostarchimages2030266.png)Figure 1-37. Starting
    Zervit 0.4'
  prefs: []
  type: TYPE_NORMAL
- en: SLMail 5.5
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Download and run SLMail version 5.5 from *[http://www.exploit-db.com/exploits/638/](http://www.exploit-db.com/exploits/638/)*,
    using the default options when prompted. Just click **Next** for all of the options
    and don’t change anything. If you get a warning about a domain name, just ignore
    it and click **OK**. We don’t really need to deliver any email here.
  prefs: []
  type: TYPE_NORMAL
- en: Once SLMail is installed, restart your virtual machine. Then open **Start**
    ▸ **All Programs** ▸ **SL Products** ▸ **SLMail** ▸ **SLMail Configuration**.
    In the Users tab (default), right-click the **SLMail Configuration** window and
    choose **New** ▸ **User**, as shown in [Figure 1-38](ch01.xhtml#adding_a_user_in_slmail
    "Figure 1-38. Adding a user in SLMail").
  prefs: []
  type: TYPE_NORMAL
- en: '![Adding a user in SLMail](httpatomoreillycomsourcenostarchimages2030268.png)Figure 1-38. Adding
    a user in SLMail'
  prefs: []
  type: TYPE_NORMAL
- en: Click the newly created user icon, enter username **georgia**, and fill in the
    information for the user, as shown in [Figure 1-39](ch01.xhtml#setting_the_user_information_in_slmail
    "Figure 1-39. Setting the user information in SLMail"). The mailbox name should
    be *georgia* with password *password*. Keep the defaults and press **OK** once
    you’ve finished.
  prefs: []
  type: TYPE_NORMAL
- en: '![Setting the user information in SLMail](httpatomoreillycomsourcenostarchimages2030270.png.jpg)Figure 1-39. Setting
    the user information in SLMail'
  prefs: []
  type: TYPE_NORMAL
- en: 3Com TFTP 2.0.1
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Next, download 3Com TFTP version 2.0.1 as a zipped file from *[http://www.exploit-db.com/exploits/3388/](http://www.exploit-db.com/exploits/3388/)*.
    Extract the files and copy *3CTftpSvcCtrl* and *3CTftpSvc* to the directory *C:\Windows*,
    as shown in [Figure 1-40](ch01.xhtml#copying_3com_tftp_to_cslashwindows "Figure 1-40. Copying
    3Com TFTP to C:\Windows").
  prefs: []
  type: TYPE_NORMAL
- en: '![Copying 3Com TFTP to C:\Windows](httpatomoreillycomsourcenostarchimages2030272.png.jpg)Figure 1-40. Copying
    3Com TFTP to C:\Windows'
  prefs: []
  type: TYPE_NORMAL
- en: Then open *3CTftpSvcCtrl* (the blue *3* icon) and click **Install Service**,
    as shown in [Figure 1-41](ch01.xhtml#installing_3com_tftp "Figure 1-41. Installing
    3Com TFTP").
  prefs: []
  type: TYPE_NORMAL
- en: '![Installing 3Com TFTP](httpatomoreillycomsourcenostarchimages2030274.png.jpg)Figure 1-41. Installing
    3Com TFTP'
  prefs: []
  type: TYPE_NORMAL
- en: Click **Start Service** to start 3Com TFTP for the first time. From now on,
    it will automatically start when you boot up the computer. Press **Quit** to exit.
  prefs: []
  type: TYPE_NORMAL
- en: XAMPP 1.7.2
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Now we’ll install an older version of the XAMPP software, version 1.7.2, from
    *[http://www.oldapps.com/xampp.php?old_xampp=45/](http://www.oldapps.com/xampp.php?old_xampp=45/)*.
    (The older version of Internet Explorer on Windows XP seems to have some trouble
    opening this page. If you have trouble, download the software from your host system
    and copy it onto Windows XP’s desktop.)
  prefs: []
  type: TYPE_NORMAL
- en: Run the installer and accept the default options as they’re presented to you.
    When installation is finished, choose option **`1\. start XAMPP Control Panel`**,
    as shown in [Figure 1-42](ch01.xhtml#starting_xampp_control_panel "Figure 1-42. Starting
    XAMPP Control Panel").
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Starting XAMPP Control Panel](httpatomoreillycomsourcenostarchimages2030276.png)Figure 1-42. Starting
    XAMPP Control Panel'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: In the XAMPP Control Panel, install the Apache, MySQL, and FileZilla services
    (select the **Svc** checkbox to the left of the service name). Then click the
    **Start** button for each service. Your screen should look like the one shown
    in [Figure 1-43](ch01.xhtml#installing_and_starting_xampp_services "Figure 1-43. Installing
    and starting XAMPP services").
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Installing and starting XAMPP services](httpatomoreillycomsourcenostarchimages2030278.png.jpg)Figure 1-43. Installing
    and starting XAMPP services'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Click the **Admin** button for FileZilla in the XAMPP Control Panel. The Admin
    panel is shown in [Figure 1-44](ch01.xhtml#filezilla_admin_panel "Figure 1-44. FileZilla
    Admin panel").
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![FileZilla Admin panel](httpatomoreillycomsourcenostarchimages2030280.png)Figure 1-44. FileZilla
    Admin panel'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Go to **Edit** ▸ **Users** to open the Users dialog, shown in [Figure 1-45](ch01.xhtml#adding_an_ftp_user
    "Figure 1-45. Adding an FTP user").
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Add** button on the right of the dialog box.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the Add User Account dialog box, enter **`georgia`** and press **OK**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Adding an FTP user](httpatomoreillycomsourcenostarchimages2030282.png.jpg)Figure 1-45. Adding
    an FTP user'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: With *georgia* highlighted, check the **Password** box under Account Settings
    and enter **`password`**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click **OK**. When prompted to share a folder, browse to the *georgia’*s *Documents*
    folder on Windows and select it to share it, as shown in [Figure 1-46](ch01.xhtml#sharing_a_folder_via_ftp
    "Figure 1-46. Sharing a folder via FTP"). Leave the defaults for all other checkboxes,
    as shown in the figure. Click **OK** once you’ve finished and exit the various
    open windows.
  prefs: []
  type: TYPE_NORMAL
- en: '![Sharing a folder via FTP](httpatomoreillycomsourcenostarchimages2030284.png.jpg)Figure 1-46. Sharing
    a folder via FTP'
  prefs: []
  type: TYPE_NORMAL
- en: Adobe Acrobat Reader
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Now we’ll install Adobe Acrobat Reader version 8.1.2 from *[http://www.oldapps.com/adobe_reader.php?old_adobe=17/](http://www.oldapps.com/adobe_reader.php?old_adobe=17/)*.
    Follow the default prompts to install it. Click **Finish** once you’re done. (Here
    again you may need to download the file to your host system and copy it to Windows
    XP’s desktop.)
  prefs: []
  type: TYPE_NORMAL
- en: War-FTP
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Next, download and install War-FTP version 1.65 from *[http://www.exploit-db.com/exploits/3570/](http://www.exploit-db.com/exploits/3570/)*.
    Download the executable from *exploit-db.com* to *georgia*’s desktop and run the
    downloaded executable to install. You do not need to start the FTP service; we
    will turn it on when we discuss exploit development in [Chapter 16](ch16.xhtml
    "Chapter 16. A Stack-Based Buffer Overflow in Linux") through [Chapter 19](ch19.xhtml
    "Chapter 19. Fuzzing, Porting Exploits, and Metasploit Modules").
  prefs: []
  type: TYPE_NORMAL
- en: WinSCP
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Download and install the latest version of WinSCP from *[http://winscp.net/](http://winscp.net/)*.
    Choose the **Typical Installation** option. You can uncheck the additional add-ons.
    Click **Finish** once you’re done.
  prefs: []
  type: TYPE_NORMAL
- en: Installing Immunity Debugger and Mona
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Now we’ll finish up the Windows XP virtual machine by installing a debugger,
    a tool that helps detect errors in computer programs. We’ll be using the debugger
    in the exploit development chapters. Visit the Immunity Debugger registration
    page at *[http://debugger.immunityinc.com/ID_register.py](http://debugger.immunityinc.com/ID_register.py)*.
    Complete the registration and then press the **Download** button. Run the installer.
  prefs: []
  type: TYPE_NORMAL
- en: When asked if you want to install Python, click **Yes**. Accept the license
    agreement and follow the default installation prompts. When you close the installer,
    the Python installation will automatically run. Use the default installation values.
  prefs: []
  type: TYPE_NORMAL
- en: Once Immunity Debugger and Python have been installed, download *mona.py* from
    *[http://redmine.corelan.be/projects/mona/repository/raw/mona.py/](http://redmine.corelan.be/projects/mona/repository/raw/mona.py/)*.
    Copy *mona.py* to *C:\Program Files\Immunity Inc\Immunity Debugger\PyCommands*,
    as shown in [Figure 1-47](ch01.xhtml#installing_mona "Figure 1-47. Installing
    Mona").
  prefs: []
  type: TYPE_NORMAL
- en: Open Immunity Debugger, and at the command prompt at the bottom of the window,
    enter **`!mona config -set workingfolder c:\logs\%p`**, as shown in [Figure 1-48](ch01.xhtml#setting_up_monaapostrophes_logs
    "Figure 1-48. Setting up Mona’s logs"). This command tells mona to log its output
    to *C:\logs\<program name>*, where *<program name>* is the program Immunity Debugger
    is currently debugging.
  prefs: []
  type: TYPE_NORMAL
- en: Now our Windows XP target is set up and ready to go.
  prefs: []
  type: TYPE_NORMAL
- en: '![Installing Mona](httpatomoreillycomsourcenostarchimages2030286.png.jpg)Figure 1-47. Installing
    Mona![Setting up Mona’s logs](httpatomoreillycomsourcenostarchimages2030288.png)Figure 1-48. Setting
    up Mona’s logs'
  prefs: []
  type: TYPE_NORMAL
- en: Setting Up the Ubuntu 8.10 Target
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Because Linux is open source, you can simply download the Linux virtual machine
    as part of the torrent for this book. Unzip the 7-Zip archive *BookUbuntu.7zip*
    and use the password *1stPentestBook?!* to open the archive. Open the *.vmx* file
    in VMware. If you are prompted with a message that says the virtual machine appears
    to be in use, click **Take Ownership** and, as with Kali, select **I copied it**.
    The username and password for the virtual machine itself are *georgia:password*.
  prefs: []
  type: TYPE_NORMAL
- en: Once you have the Ubuntu virtual machine loaded, make sure the network interface
    is set to Bridged in VMware and click the networking icon (two computers) at the
    top right of the screen to attach the virtual machine to the network. Do not install
    any updates if prompted. As with Windows XP, we will exploit out-of-date software
    on this system. Now this virtual machine is all set up. (I’ll show you how to
    set a static IP address in Linux in [Chapter 2](ch02.xhtml "Chapter 2. Using Kali
    Linux").)
  prefs: []
  type: TYPE_NORMAL
- en: Creating the Windows 7 Target
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'As with Windows XP, you’ll need to install a copy of Windows 7 SP1 in VMware
    by loading your image or DVD. A 30-day trial version of 32-bit Windows 7 Professional
    SP1 will work fine, but you’ll need to activate it after 30 days if you wish to
    continue using it. To find a legal version of Windows 7 SP1, try one of the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Visit *[http://www.softpedia.com/get/System/OS-Enhancements/Windows-7.shtml](http://www.softpedia.com/get/System/OS-Enhancements/Windows-7.shtml)*.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Visit *[http://technet.microsoft.com/en-us/evalcenter/dn407368](http://technet.microsoft.com/en-us/evalcenter/dn407368)*.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Your school or workplace may have access to programs like DreamSpark or BizSpark
    that give you access to Windows operating systems. You can also check my website
    (*[http://www.bulbsecurity.com/](http://www.bulbsecurity.com/)*) for more resources.
  prefs: []
  type: TYPE_NORMAL
- en: Creating a User Account
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: After installing Windows 7 Professional SP1, opt out of security updates and
    create user *Georgia Weidman* as an administrator with a password of *password*,
    as shown in [Figure 1-49](ch01.xhtml#setting_a_username "Figure 1-49. Setting
    a username") and [Figure 1-50](ch01.xhtml#setting_a_password_for_the_user_georgia
    "Figure 1-50. Setting a password for the user Georgia Weidman").
  prefs: []
  type: TYPE_NORMAL
- en: Again opt out of automatic updates. When prompted, set the computer’s current
    location to a work network. Once the installation has finished, log in to the
    account *Georgia Weidman*. Leave the Windows Firewall enabled. VMware will reboot
    Windows 7 a few times as it installs everything.
  prefs: []
  type: TYPE_NORMAL
- en: Now tell VMware to install VMware Tools, as you did in the Windows XP section.
    After instructing VMware to install VMware Tools in the virtual machine, if the
    installer does not automatically run, go to My Computer and run the VMware Tools
    installer from the virtual machine’s DVD drive, as shown in [Figure 1-51](ch01.xhtml#installing_vmware_tools-id00007
    "Figure 1-51. Installing VMware Tools").
  prefs: []
  type: TYPE_NORMAL
- en: '![Setting a username](httpatomoreillycomsourcenostarchimages2030290.png.jpg)Figure 1-49. Setting
    a username![Setting a password for the user Georgia Weidman](httpatomoreillycomsourcenostarchimages2030292.png.jpg)Figure 1-50. Setting
    a password for the user Georgia Weidman![Installing VMware Tools](httpatomoreillycomsourcenostarchimages2030294.png.jpg)Figure 1-51. Installing
    VMware Tools'
  prefs: []
  type: TYPE_NORMAL
- en: Opting Out of Automatic Updates
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Though our attacks on Windows 7 will largely rely on flaws in third-party software
    rather than missing Windows patches, let’s once again opt out of Windows updates
    for this virtual machine. To do this, go to **Start** ▸ **Control Panel** ▸ **System
    and Security**. Then under Windows Update, click **Turn Automatic Updating On
    or Off**. Set Important updates to **Never check for updates (not recommended)**
    as shown in [Figure 1-52](ch01.xhtml#opting_out_of_automatic_updates-id00008 "Figure 1-52. Opting
    out of automatic updates"). Click **OK**.
  prefs: []
  type: TYPE_NORMAL
- en: '![Opting out of automatic updates](httpatomoreillycomsourcenostarchimages2030296.png.jpg)Figure 1-52. Opting
    out of automatic updates'
  prefs: []
  type: TYPE_NORMAL
- en: Setting a Static IP Address
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Set a static IP address by choosing **Start** ▸ **Control Panel** ▸ **Network
    and Internet** ▸ **Network and Sharing Center** ▸ **Change Adapter Settings**
    ▸ **Local Area Network**. Now right-click and choose **Properties** ▸ **Internet
    Protocol Version 4 (TCP/IPv4)** ▸ **Properties**. Set these values as you did
    for Windows XP (discussed in [Setting a Static IP Address](ch01.xhtml#setting_a_static_ip_address
    "Setting a Static IP Address")), but use a different value for the Windows 7 IP
    address, as shown in [Figure 1-53](ch01.xhtml#setting_a_static_ip_address-id00010
    "Figure 1-53. Setting a static IP address"). If asked whether to configure this
    network as Home, Work, or Public, choose **Work**. (Be sure that your virtual
    machine network setting is configured to use a bridged adapter.)
  prefs: []
  type: TYPE_NORMAL
- en: '![Setting a static IP address](httpatomoreillycomsourcenostarchimages2030298.png.jpg)Figure 1-53. Setting
    a static IP address'
  prefs: []
  type: TYPE_NORMAL
- en: Because the Windows firewall is turned on, Windows 7 won’t respond to a ping
    from our Kali system. Therefore, we’ll ping our Kali system from Windows 7\. Start
    your Kali Linux virtual machine, and from your Windows 7 virtual machine, click
    the **Start** button. Then enter **`cmd`** in the Run dialog to open a Windows
    command prompt. At the prompt, enter the following.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: If everything is working, you should see replies to the ping request as in [Setting
    a Static IP Address](ch01.xhtml#setting_a_static_ip_address "Setting a Static
    IP Address").
  prefs: []
  type: TYPE_NORMAL
- en: Adding a Second Network Interface
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Now shut down your Windows 7 virtual machine. We’re going to add a second network
    interface to the Windows 7 virtual machine that will allow the Windows 7 system
    to be part of two networks. We’ll use this setup during post exploitation to simulate
    attacking additional systems on a second network.
  prefs: []
  type: TYPE_NORMAL
- en: In VMware Player on Microsoft Windows, choose **Player** ▸ **Manage** ▸ **Virtual
    Machine Settings** ▸ **Add**, select **Network Adapter**, and press **Next**.
    This adapter will be Network Adapter 2\. In VMware Fusion on Mac OS, go to **Virtual
    Machine Settings**, select **Add a Device**, and select a network adapter. Set
    this new adapter to the Host Only network. Press **OK**, and the virtual machine
    should restart. (We do not need to set a static IP address for Network Adapter
    2.) When the virtual machine restarts, open Virtual Machine Settings again, and
    you should see the two network adapters listed. Both should be connected when
    your computer powers on.
  prefs: []
  type: TYPE_NORMAL
- en: Installing Additional Software
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Now install the following software in your Windows 7 virtual machine, using
    default settings across the board:'
  prefs: []
  type: TYPE_NORMAL
- en: Java 7 Update 6, an out-of-date version of Java, from *[http://www.oldapps.com/java.php?old_java=8120/](http://www.oldapps.com/java.php?old_java=8120/).*
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Winamp version 5.55 from *[http://www.oldapps.com/winamp.php?old_winamp=247/](http://www.oldapps.com/winamp.php?old_winamp=247/).*
    (Uncheck the changes to your search engine and so on.)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The latest version of Mozilla Firefox from *[http://www.mozilla.org/](http://www.mozilla.org/).*
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Microsoft Security Essentials from *[http://windows.microsoft.com/en-us/windows/security-essentials-download/](http://windows.microsoft.com/en-us/windows/security-essentials-download/)*.
    (Download the latest antivirus signatures, making sure to download the correct
    version for your 32-bit Windows install. Don’t turn on automatic sample submission
    or scan on install. Also, disable real-time protection for now. We will enable
    this feature when we study bypassing antivirus software in [Chapter 12](ch12.xhtml
    "Chapter 12. Bypassing Antivirus Applications"). This setting can be found on
    the Settings tab under Real-time Protection. Uncheck **Turn on real-time protection
    (recommended)**, as shown in [Figure 1-54](ch01.xhtml#turning_off_real-time_protection
    "Figure 1-54. Turning off real-time protection"). Click **Save changes**.)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![Turning off real-time protection](httpatomoreillycomsourcenostarchimages2030300.png.jpg)Figure 1-54. Turning
    off real-time protection'
  prefs: []
  type: TYPE_NORMAL
- en: Finally, install the *BookApp* custom web application found in the torrent for
    this book. (*1stPentestBook?!* is the password for the archive.) Drag and drop
    the *BookApp* folder on the Windows 7 virtual machine. Then follow the instructions
    in *InstallApp.pdf* detailing how to install BookApp. Here is a high-level overview
    of the instructions.
  prefs: []
  type: TYPE_NORMAL
- en: Run *Step1-install-iis.bat* as an administrator by right-clicking the *.bat*
    file and choosing **Run as administrator**. (Once install finishes, you can close
    any DOS windows that are still up.)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Navigate to the *SQL* folder and run *SQLEXPRWT_x86_ENU.EXE*. Detailed instructions
    with screenshots are included in the InstallApp PDF.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Install Service Pack 3 by running *SQLServer2008SP3-KB2546951-x86-ENU.exe*.
    When warned that program has known compatibility issues, click **OK** to run it
    and complete the install. Choose to accept any changes.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Using SQL Server Configuration Manager, enable **Named Pipes**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Navigate back to the main app folder and run *Step2-Modify-FW.bat* as an administrator.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Install XML support for MS SQL with *sqlxml_x86-v4.exe* from the SQL folder.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Run *Step3-Install-App.bat* as an administrator from the main app folder.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Use MS SQL Management Studio to run *db.sql* from the SQL folder, as described
    in detail in the InstallApp PDF.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Finally, change the user permissions on the *AuthInfo.xml* file in the book
    app folder to give full permissions to IIS_USERS.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We set up our virtual environment, downloaded and customized Kali Linux for
    attacks, configured our virtual network, and configured our target operating systems—Windows
    XP, Windows 7, and Ubuntu.
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we will get used to working with the Linux command line,
    and we’ll be on our way to learning how to use the many pentesting tools and techniques
    in this book.
  prefs: []
  type: TYPE_NORMAL
