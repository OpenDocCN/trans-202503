<html><head></head><body>
<div id="sbo-rt-content" class="calibre1"><h2 class="h1" id="appc"><span epub:type="pagebreak" id="page_225" class="calibre2"/><strong class="calibre3"><span class="big">C</span><br class="calibre18"/>MATRICES, DATA FRAMES, AND FACTOR CONVERSIONS</strong></h2>
<p class="noindent">It is a fact of life in the R world that R’s wonderful flexibility in terms of data types also means that serious use needs some skill in converting between types. This appendix will ensure that the reader has this skill.</p>
<h3 class="h2" id="levc_1">C.1 Matrices</h3>
<p class="noindent">Although the R <em class="calibre13">matrix</em> class might be viewed as more fundamental than data frames, some R users these days are unaware of it. Since any serious usage of ML in R requires knowledge of this class, this appendix will present a brief tutorial.</p>
<p class="indent">In keeping with the theme of this book limiting the use of mathematical tools, we will not discuss the mathematical properties of matrices.</p>
<p class="indent">An R matrix is essentially a data frame in which all columns are numeric. It uses the same [i,j] notation. Conversions can be made between the two types. Here are some examples:</p>
<pre class="calibre16">&gt; <span class="codestrong">library(regtools)</span>
&gt; <span class="codestrong">data(mlb)</span>
&gt; <span class="codestrong">head(mlb)</span>
             Name Team       Position Height Weight   Age PosCategory
1   Adam_Donachie  BAL        Catcher     74    180 22.99     Catcher
2       Paul_Bako  BAL        Catcher     74    215 34.69     Catcher
3 Ramon_Hernandez  BAL        Catcher     72    210 30.78     Catcher
4    Kevin_Millar  BAL  First_Baseman     72    210 35.43   Infielder</pre>
<h3 class="h2" id="levc_2"><span epub:type="pagebreak" id="page_226" class="calibre2"/>C.2 Conversions: Between R Factors and Dummy Variables, Between Data Frames and Matrices</h3>
<p class="noindent">In R, a categorical variable has a formal class: <em class="calibre13">factor</em>. It actually is one of the most useful aspects of R, but one must be adept at switching back and forth between factors and the corresponding dummy variables.</p>
<p class="indent">Similarly, though we mostly work with data frames in this book, there are some algorithms that need matrices, say, because they calculate distances between rows and do matrix multiplication and inversion. You do not need to know what matrix inversion is and so on, but some software packages will require you to present only matrix inputs and not data frames. There is a brief tutorial on matrices at the beginning of this appendix.</p>
<p class="indent">Some highly popular R ML packages automatically generate dummies from factors, but others do not. For example, <code>glmnet</code> for LASSO models requires that categorical features be in the form of dummies, while <code>ranger</code>, for random forests, accepts factors.</p>
<p class="indent">So it’s important to be able to generate dummy variables ourselves. The <code>regtools</code> functions <code>factorToDummies()</code> and <code>factorsToDummies()</code> do this. We discuss the <code>factorToDummies()</code> function in <a href="ch01.xhtml#ch01lev9" class="calibre12">Section 1.9</a>. We use dummy variables throughout the book, including in this appendix.</p>
<p class="indent">We also use the built-in R function <code>as.matrix()</code> to convert from data frames to matrices.</p>
<pre class="calibre16">5     Chris_Gomez  BAL  First_Baseman     73    188 35.71   Infielder
6   Brian_Roberts  BAL Second_Baseman     69    176 29.39   Infielder
&gt; <span class="codestrong">hwa &lt;- mlb[,4:6]</span>
&gt; <span class="codestrong">head(hwa)</span>
  Height Weight   Age
1     74    180 22.99
2     74    215 34.69
3     72    210 30.78
4     72    210 35.43
5     73    188 35.71
6     69    176 29.39
&gt; <span class="codestrong">class(hwa)</span>
[1] "data.frame"
&gt; <span class="codestrong">hwam &lt;- as.matrix(hwa)</span>
&gt; <span class="codestrong">class(hwam)</span>
[1] "matrix" "array"
&gt; <span class="codestrong">head(hwam)</span>
  Height Weight   Age
1     74    180 22.99
2     74    215 34.69
3     72    210 30.78
4     72    210 35.43
5     73    188 35.71
6     69    176 29.39
&gt; <span class="codestrong">hwam[2,3]</span>
[1] 34.69
&gt; <span class="codestrong">mean(hwam[,3])</span>  # mean age
[1] 28.70835
&gt; <span class="codestrong">mean(hwam$age)</span>  # illegal
Error in hwam$age : $ operator is invalid for atomic vectors
# rbind(), "row bind", combines rows
&gt; m <span class="codestrong">&lt;- rbind(3:5,c(5,12,13))</span>
&gt; m
     [,1] [,2] [,3]
[1,]    3    4    5
[2,]    5   12   13
&gt; <span class="codestrong">class(m)</span>
[1] "matrix" "array"
&gt; <span class="codestrong">m[2,3]</span>
[1] 13
&gt; <span class="codestrong">md &lt;- as.data.frame(m)</span>
&gt; <span class="codestrong">md</span>
  V1 V2 V3
1  3  4  5
2  5 12 13
&gt; <span class="codestrong">class(md)</span>
[1] "data.frame"
&gt; <span class="codestrong">md[2,3]</span>
[1] 13
# the apply() function can be a nice shortcut
&gt; <span class="codestrong">apply(m,1,sum)</span>  # apply sum() to each row (argument 1) of m
[1] 12 30
&gt; <span class="codestrong">apply(m,2,sum)</span>  # apply sum() to each column (argument 2) of m
[1]  8 16 18</pre>
<p class="indent"><span epub:type="pagebreak" id="page_227"/>In math, we draw matrices as rectangular arrays. For the matrix <code>m</code> above, for instance:</p>
<p class="center"><img alt="Image" src="../images/app03equ01.jpg" class="calibre109"/><span epub:type="pagebreak" id="page_228"/></p>
</div></body></html>