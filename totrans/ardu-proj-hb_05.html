<html><head></head><body>
<h1 class="part" id="part04"><span epub:type="pagebreak" id="page_101"/><strong>PART 4</strong><br/><img alt="image" class="middle" src="../images/common-01.jpg"/><br/><span class="big"><strong>LCDS</strong></span></h1>&#13;


<h2 class="h2a" id="ch12"><span epub:type="pagebreak" id="page_102"/>PROJECT 12: LCD SCREEN WRITER</h2>&#13;
<p class="h2sub"><strong><span class="orange">NOT ONLY IS THERE SOMETHING VERY SATISFYING ABOUT HAVING AN LCD SCREEN DISPLAY YOUR OWN MESSAGES, BUT IT’S ALSO VERY USEFUL.</span></strong></p>&#13;
<div class="image2"><img alt="image" src="../images/f0102-01.jpg"/></div>&#13;
<div class="image2"><span epub:type="pagebreak" id="page_103"/><img alt="image" src="../images/f0103-01.jpg"/></div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="orange"><strong>PARTS REQUIRED</strong></span></p>&#13;
<p class="bull">• Arduino board</p>&#13;
<p class="bull">• Breadboard</p>&#13;
<p class="bull">• Jumper wires</p>&#13;
<p class="bull">• 16×2 LCD screen (Hitachi HD44780 compatible)</p>&#13;
<p class="bull">• 50k-ohm potentiometer</p>&#13;
</div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="orange"><strong>LIBRARIES REQUIRED</strong></span></p>&#13;
<p class="bull">• LiquidCrystal</p>&#13;
</div>&#13;
<h3 class="h3" id="ch12lev1sec01"><span epub:type="pagebreak" id="page_104"/><span class="orange"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">An LCD (liquid crystal display) screen is made of two sheets of polarizing material with a liquid crystal solution between them. Current passing through the solution creates an image or, in this case, characters. For this project, you’ll need an LCD screen that’s compatible with the Hitachi HD44780 driver for it to work with the Arduino—there are lots of them out there and you can usually identify them by their 16-pin interface.</p>&#13;
<p class="indent">We’ll use the LiquidCrystal library to send characters to the LCD screen. The LiquidCrystal library maps the characters and uses the <code>print.lcd</code> commands to copy the message from the sketch to the screen.</p>&#13;
<p class="indent">Before you start, you need to prepare your LCD screen.</p>&#13;
<h3 class="h3" id="ch12lev1sec02"><span class="orange"><strong>PREPARING THE LCD SCREEN</strong></span></h3>&#13;
<p class="noindent">The LCD screen will probably require a bit of assembly. Your screen should come with 16 holes (as shown in <a href="ch12.xhtml#ch12fig1">Figure 12-1</a>) and a separate strip of header pins.</p>&#13;
<p class="figcaption"><a id="ch12fig1"/><strong>FIGURE 12-1:</strong><br/>The LCD screen has 16 pins running along the top.</p>&#13;
<div class="image"><img alt="image" src="../images/f12-01.jpg"/></div>&#13;
<p class="indent">Take the strip of pins and break off a row of 16 pins. Insert the shorter side of the pins into the 16 LCD holes. You’ll need to solder these in place: solder the far-right and far-left pins first to hold the strip in place and wait a moment for them to set. Then solder each pin in turn, holding the solder and soldering iron to each pin. Holding the iron to the pins for too long will damage them; you only need to solder them for a couple of seconds. (If you’ve never soldered before, see the “<a href="ch00.xhtml#ch00lev1sec07">Quick Soldering Guide</a>” on <a href="ch00.xhtml#page_18">page 18</a>.)</p>&#13;
<h3 class="h3" id="ch12lev1sec03"><span epub:type="pagebreak" id="page_105"/><span class="orange"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindenta">Place your LCD screen in the breadboard, inserting the header pins into the breadboard holes. Also place the potentiometer in the breadboard, and use the breadboard and jumper wires to connect your LCD screen, Arduino, and potentiometer as shown in the following table and in <a href="ch12.xhtml#ch12fig2">Figure 12-2</a>. There are three GND connections from the LCD module, so use the breadboard GND rail to make those connections.</p>&#13;
<p class="figcaption"><a id="ch12fig2"/><strong>FIGURE 12-2:</strong><br/>Connections between the LCD screen and the Arduino. LCD screen pins 15 and 16 are the power and ground for the backlight of the screen.</p>&#13;
<div class="image"><img alt="image" src="../images/f12-02.jpg"/></div>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-o" style="vertical-align: middle;"><p class="tablec"><strong>LCD SCREEN</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">1 VSS</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">2 VDD</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">3 VO contrast</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Potentiometer center pin</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">4 RS</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 7</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">5 R/W</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">6 Enable</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 8</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">7 D0</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Not used</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">8 D1</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Not used</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">9 D2</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Not used</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">10 D3</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Not used</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">11 D4</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 9</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span epub:type="pagebreak" id="page_106"/><span class="orange">12 D5</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 10</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">13 D6</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 11</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">14 D7</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 12</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">15 A BcL+</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">16 K BcL–</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="orange">GND</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">The center pin of the 50k-ohm potentiometer is connected to LCD pin 3 (VO). The potentiometer controls the screen contrast. Turn it until you can clearly see the characters on the screen. Now connect one of the outer pins to GND and the other to +5V.</p></li>&#13;
<li><p class="noindenta">Backlit LCD screens (see <a href="ch12.xhtml#ch12fig3">Figure 12-3</a>) will have resistors built in, but if you have a non-backlit LCD screen, you should insert a 220-ohm resistor between LCD 15 and +5V. (The screen’s packaging will say whether it is backlit or not.)</p>&#13;
<p class="figcaption"><a id="ch12fig3"/><strong>FIGURE 12-3:</strong><br/>A backlit LCD screen</p>&#13;
<div class="image"><img alt="image" src="../images/f12-03.jpg"/></div></li>&#13;
<li><p class="noindenta">Your setup should look like <a href="ch12.xhtml#ch12fig4">Figure 12-4</a>. Check your work against the circuit diagram in <a href="ch12.xhtml#ch12fig5">Figure 12-5</a>, and then upload the code in “<a href="ch12.xhtml#ch12lev1sec04">The Sketch</a>” on <a href="ch12.xhtml#page_107">page 107</a>.</p>&#13;
<p class="figcaption"><a id="ch12fig4"/><strong>FIGURE 12-4:</strong><br/>The complete setup</p>&#13;
<div class="image"><img alt="image" src="../images/f12-04.jpg"/></div>&#13;
<p class="figcaption"><a id="ch12fig5"/><strong>FIGURE 12-5:</strong><br/>The circuit diagram for the LCD screen writer</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_107"/><img alt="image" src="../images/f12-05.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch12lev1sec04"><span class="orange"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">This sketch is included in your IDE examples. Load it from the IDE by going to <strong>File <img alt="image" src="../images/arrow.jpg"/> Examples <img alt="image" src="../images/arrow.jpg"/> LiquidCrystal</strong> and then clicking <strong>Scroll</strong>. The sketch uses the LiquidCrystal library that’s built into the Arduino IDE to send messages from the Arduino to the LCD screen. You can change the message by replacing <code>"Arduino Sketch"</code> at <span class="ent">➋</span>.</p>&#13;
<p class="indent">To use this circuit setup with the example sketches in the Arduino IDE, we also change the LCD pins in the sketch (12, 11, 5, 4, 3, 2) at <span epub:type="pagebreak" id="page_108"/><span class="ent">➊</span> to 7, 8, 9, 10, 11, 12, as these are the pins we’ve assigned. I’ve re-created the sketch here as you’ll see it in the IDE, but with those changes made.</p>&#13;
<pre>   <span class="ash">/*</span><br/>   <span class="ash">Library originally added 18 Apr 2008 by David A. Mellis</span><br/>     <span class="ash">library modified 5 Jul 2009 by Limor Fried (http://www.ladyada.net)</span><br/>     <span class="ash">example added 9 Jul 2009 by Tom Igoe</span><br/>     <span class="ash">modified 22 Nov 2010 by Tom Igoe</span><br/>     <span class="ash">This example code is in the public domain.</span><br/>     <span class="ash">http://www.arduino.cc/en/Tutorial/LiquidCrystal</span><br/><br/>   <span class="ash">LiquidCrystal Library - scrollDisplayLeft() and scrollDisplayRight()</span><br/><br/>   <span class="ash">Demonstrates the use of a 16x2 LCD display. The LiquidCrystal</span><br/>   <span class="ash">library works with all LCD displays that are compatible with the</span><br/>   <span class="ash">Hitachi HD44780 driver. There are many of them out there, and you</span><br/>   <span class="ash">can usually tell them by the 16-pin interface.</span><br/><br/>   <span class="ash">This sketch prints "Arduino Sketch" to the LCD and uses the</span><br/>   <span class="ash">scrollDisplayLeft() and scrollDisplayRight() methods to scroll</span><br/>   <span class="ash">the text.</span><br/>   <span class="ash">*/</span><br/><br/>   <span class="ash">// Include the library code</span><br/>   #include &lt;<span class="orange1">LiquidCrystal</span>.h&gt;<br/><br/>   <span class="ash">// Initialize the library with the numbers of the interface pins</span><br/><span class="ent">➊</span> LiquidCrystal lcd(7, 8, 9, 10, 11, 12);<br/><br/>   <span class="green2">void</span> <span class="green3">setup</span>() {<br/>     <span class="ash">// Set up the LCD's number of columns and rows</span><br/>     lcd.<span class="orange1">begin</span>(16, 2);<br/>     <span class="ash">// Print a message to the LCD</span><br/><span class="ent">➋</span>   lcd.<span class="orange1">print</span>(<span class="green2">"Arduino Sketch"</span>);<br/>     <span class="orange1">delay</span>(1000);<br/>   }<br/><br/>   <span class="green2">void</span> <span class="green3">loop</span>() {<br/>     <span class="ash">// Scroll 13 positions (string length) to the left</span><br/>     <span class="ash">// to move it offscreen left</span><br/>     <span class="green3">for</span> (<span class="green2">int</span> positionCounter = 0; positionCounter &lt; 13;<br/>   positionCounter++) {<br/>       <span class="ash">// Scroll one position left</span><br/>       lcd.<span class="orange1">scrollDisplayLeft</span>();<br/>       <span class="ash">// Wait a bit</span><br/>       <span class="orange1">delay</span>(150);<br/>     }<br/>     <span epub:type="pagebreak" id="page_109"/><span class="ash">// Scroll 29 positions (string length + display length) to the right</span><br/>     <span class="ash">// to move it offscreen right</span><br/>     <span class="green3">for</span> (<span class="green2">int</span> positionCounter = 0; positionCounter &lt; 29;<br/>   positionCounter++) {<br/>       <span class="ash">// Scroll one position right</span><br/>       lcd.<span class="orange1">scrollDisplayRight</span>();<br/>       <span class="ash">// Wait a bit</span><br/>       <span class="orange1">delay</span>(150);<br/>     }<br/>     <span class="ash">// Scroll 16 positions (display length + string length) to the left</span><br/>     <span class="ash">// to move it back to center</span><br/>     <span class="green3">for</span> (<span class="green2">int</span> positionCounter = 0; positionCounter &lt; 16;<br/>   positionCounter++) {<br/>       <span class="ash">// Scroll one position left</span><br/>       lcd.<span class="orange1">scrollDisplayLeft</span>();<br/>       <span class="ash">// Wait a bit</span><br/>       <span class="orange1">delay</span>(150);<br/>     }<br/>     <span class="ash">// Delay at the end of the full loop</span><br/>     <span class="orange1">delay</span>(1000);<br/>   }</pre>&#13;


<h2 class="h2a" id="ch13"><span epub:type="pagebreak" id="page_110"/>PROJECT 13: WEATHER STATION</h2>&#13;
<p class="h2sub"><strong><span class="orange">IN THIS PROJECT YOU’LL SET UP A WEATHER STATION TO MEASURE TEMPERATURE AND HUMIDITY, AND DISPLAY THE VALUES ON AN LCD SCREEN.</span></strong></p>&#13;
<div class="image2"><img alt="image" src="../images/f0110-01.jpg"/></div>&#13;
<div class="image2"><span epub:type="pagebreak" id="page_111"/><img alt="image" src="../images/f0111-01.jpg"/></div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="orange"><strong>PARTS REQUIRED</strong></span></p>&#13;
<p class="bull">• Arduino board</p>&#13;
<p class="bull">• Breadboard</p>&#13;
<p class="bull">• Jumper wires</p>&#13;
<p class="bull">• 50k-ohm potentiometer</p>&#13;
<p class="bull">• 16x2 LCD screen (Hitachi HD44780 compatible)</p>&#13;
<p class="bull">• DHT11 humidity sensor</p>&#13;
</div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="orange"><strong>LIBRARIES REQUIRED</strong></span></p>&#13;
<p class="bull">• LiquidCrystal</p>&#13;
<p class="bull">• DHT</p>&#13;
</div>&#13;
<h3 class="h3" id="ch13lev1sec01"><span epub:type="pagebreak" id="page_112"/><span class="orange"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">The humidity sensor used in this project is the relatively cheap DHT11, shown in <a href="ch13.xhtml#ch13fig1">Figure 13-1</a>, which measures both humidity and temperature. It uses a capacitive humidity sensor and resistive-type temperature sensor to take a reading from its environment. It sends this reading to the Arduino as voltage, and the Arduino converts this to readable values displayed on the screen. For best results, you should mount your sensor on an outside wall with a decent amount of open space. You’ll want to mount your LCD screen indoors or seal it carefully in a clear, waterproof bag or casing to keep it protected from the elements.</p>&#13;
<p class="figcaption"><a id="ch13fig1"/><strong>FIGURE 13-1:</strong><br/>The DHT11 measures both temperature and humidity.</p>&#13;
<div class="image"><img alt="image" src="../images/f13-01.jpg"/></div>&#13;
<p class="indent">The DHT11 comes with either four pins or three pins. The sensor shown in <a href="ch13.xhtml#ch13fig1">Figure 13-1</a> has four pins, but you can use either version for this project, because you won’t be using pin 3. Check the retailers at the beginning of the book for ideas on where to buy a DHT11.</p>&#13;
<h3 class="h3" id="ch13lev1sec02"><span class="orange"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindenta">First, prepare the LCD screen as per the soldering instructions in “<a href="ch12.xhtml#ch12lev1sec02">Preparing the LCD Screen</a>” on <a href="ch12.xhtml#page_104">page 104</a>. Insert the DHT11 sensor into your breadboard. The DHT11 pins are numbered 1 to 4 (or 3) from the left, when the front is facing you. Connect pin 1 to the +5V rail, connect pin 2 directly to Arduino pin 8, and connect pin 4 (or 3) to GND.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-o" style="vertical-align: middle;"><p class="tablec"><span epub:type="pagebreak" id="page_113"/><strong>DHT11</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 1</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 2</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 8</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 3</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Not used</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 4</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="orange">GND</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Insert the LCD screen into the breadboard and connect the pins to the Arduino as shown in the following table and in <a href="ch13.xhtml#ch13fig2">Figure 13-2</a>. The GND and +5V rails will have multiple connections.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-o" style="vertical-align: middle;"><p class="tablec"><strong>LCD SCREEN</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">1 VSS</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">2 VDD</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">3 VO contrast</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Potentiometer center pin</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">4 RS</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 12</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">5 R/W</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">6 Enable</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 11</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">7 D0</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Not used</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">8 D1</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Not used</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">9 D2</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Not used</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">10 D3</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Not used</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">11 D4</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 5</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">12 D5</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 4</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">13 D6</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 3</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">14 D7</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 2</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">15 A BcL +</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">16 K BcL –</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="orange">GND</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="figcaption"><a id="ch13fig2"/><strong>FIGURE 13-2:</strong><br/>Inserting the LCD screen into the breadboard</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_114"/><img alt="image" src="../images/f13-02.jpg"/></div></li>&#13;
<li><p class="noindenta">Insert a potentiometer into the breadboard as shown in <a href="ch13.xhtml#ch13fig3">Figure 13-3</a> and connect the center pin to LCD pin 3. Connect one outer pin to the +5V rail and the other to the GND rail.</p>&#13;
<p class="figcaption"><a id="ch13fig3"/><strong>FIGURE 13-3:</strong><br/>Inserting the potentiometer into the breadboard</p>&#13;
<div class="image"><img alt="image" src="../images/f13-03.jpg"/></div></li>&#13;
<li><p class="noindenta">Remember to connect the power rails of the breadboard to Arduino GND and +5V. Confirm that your setup matches the circuit diagram in <a href="ch13.xhtml#ch13fig4">Figure 13-4</a>, and upload the code in “<a href="ch13.xhtml#ch13lev1sec03">The Sketch</a>” on <a href="ch13.xhtml#page_116">page 116</a>.</p>&#13;
<p class="figcaption"><a id="ch13fig4"/><strong>FIGURE 13-4:</strong><br/>The circuit diagram for the weather station</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_115"/><img alt="image" src="../images/f13-04.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch13lev1sec03"><span epub:type="pagebreak" id="page_116"/><span class="orange"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">This sketch uses the LiquidCrystal library, which comes with the Arduino IDE, and the DHT library, which you will need to download and install from <em><a href="http://nostarch.com/arduinohandbook/">http://nostarch.com/arduinohandbook/</a></em> (see “<a href="ch00.xhtml#ch00lev2sec07">Libraries</a>” on <a href="ch00.xhtml#page_7">page 7</a>). The DHT library controls the function of the sensor, and the LCD library displays the readings on the screen.</p>&#13;
<pre><span class="ash">/* Example testing sketch for various DHT humidity/temperature</span><br/><span class="ash">sensors. Written by ladyada, public domain. */</span><br/><br/>#include &lt;<span class="orange1">LiquidCrystal</span>.h&gt;<br/>#include <span class="green2">"DHT.h"</span> <span class="ash">// Call the DHT library</span><br/>#define DHTPIN 8 <span class="ash">// Pin connected to DHT</span><br/><span class="orange1">LiquidCrystal</span> lcd(12, 11, 5, 4, 3, 2);<br/>#define DHTTYPE DHT11  <span class="ash">// Define the type of DHT module</span><br/>DHT dht(DHTPIN, DHTTYPE); <span class="ash">// Command to the DHT.h library</span><br/><br/><span class="green2">void</span> <span class="green3">setup</span>() {<br/>  dht.<span class="orange1">begin</span>(); <span class="ash">// Start the sensor</span><br/>  lcd.<span class="orange1">begin</span>(16, 2); <span class="ash">// LCD screen is 16 characters by 2 lines</span><br/>}<br/><br/><span class="green2">void</span> <span class="green3">loop</span>() {<br/>  <span class="green2">float</span> h = dht.readHumidity(); <span class="ash">// Value for humidity</span><br/>  <span class="green2">float</span> t = dht.<span class="orange1">readTemperature</span>(); <span class="ash">// Value for temperature</span><br/>  t = t * 9 / 5 + 32; <span class="ash">// Change reading from Celsius to Fahrenheit</span><br/>  <span class="green3">if</span> (isnan(t) || isnan(h)) { <span class="ash">// Check that DHT sensor is working</span><br/>    lcd.<span class="orange1">setCursor</span>(0, 0);<br/>    lcd.<span class="orange1">print</span>(<span class="green2">"Failed to read from DHT"</span>);  <span class="ash">// If DHT is not working,</span><br/>                                           <span class="ash">// display this</span><br/>  } <span class="green3">else</span> { <span class="ash">// Otherwise show the readings on the screen</span><br/>    lcd.<span class="orange1">clear</span>();<br/>    lcd.<span class="orange1">setCursor</span>(0, 0);<br/>    lcd.<span class="orange1">print</span>(<span class="green2">"Humidity: "</span>);<br/>    lcd.<span class="orange1">print</span>(h);<br/>    lcd.<span class="orange1">print</span>(<span class="green2">"%"</span>);<br/>    lcd.<span class="orange1">setCursor</span>(0, 1);<br/>    lcd.<span class="orange1">print</span>(<span class="green2">"Temp: "</span>);<br/>    lcd.<span class="orange1">print</span>(t);<br/>    lcd.<span class="orange1">print</span>(<span class="green2">"f"</span>);<br/>  }<br/>}</pre>&#13;


<h2 class="h2a" id="ch14"><span epub:type="pagebreak" id="page_117"/>PROJECT 14: FORTUNE TELLER</h2>&#13;
<p class="h2sub"><strong><span class="orange">IN THIS PROJECT, WE’LL CREATE AN ELECTRONIC VERSION OF A CLASSIC FORTUNE-TELLING DEVICE: THE MAGIC 8 BALL.</span></strong></p>&#13;
<div class="image2"><img alt="image" src="../images/f0117-01.jpg"/></div>&#13;
<div class="image2"><span epub:type="pagebreak" id="page_118"/><img alt="image" src="../images/f0118-01.jpg"/></div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="orange"><strong>PARTS REQUIRED</strong></span></p>&#13;
<p class="bull">• Arduino board</p>&#13;
<p class="bull">• Breadboard</p>&#13;
<p class="bull">• Jumper wires</p>&#13;
<p class="bull">• 16x2 LCD screen (Hitachi HD44780 compatible)</p>&#13;
<p class="bull">• Tilt ball switch</p>&#13;
<p class="bull">• 50k-ohm potentiometer</p>&#13;
<p class="bull">• 1k-ohm resistor</p>&#13;
</div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="orange"><strong>LIBRARIES REQUIRED</strong></span></p>&#13;
<p class="bull">• LiquidCrystal</p>&#13;
</div>&#13;
<h3 class="h3" id="ch14lev1sec01"><span epub:type="pagebreak" id="page_119"/><span class="orange"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">The Magic 8 Ball, a novelty toy created in the 1950s, is made of a hollow sphere in which a 20-sided die floated in alcohol. When you ask the ball a question and shake it, one side of the die floats up and displays your answer in the ball’s window.</p>&#13;
<p class="indent">For this project, you’ll use a tilt ball switch, shown in <a href="ch14.xhtml#ch14fig1">Figure 14-1</a>. The tilt ball switch is composed of a metal ball inside a metal casing that makes a connection when the switch is in an upright position. If you tilt the switch, the ball shifts and the connection is broken. There are lots of tilt switches available, and all do the same job. In this project, you’ll ask a question and shake the switch. When the switch settles upright again, it connects to the Arduino, which then randomly selects a response from eight preset answers and displays it on the LCD screen.</p>&#13;
<p class="figcaption"><a id="ch14fig1"/><strong>FIGURE 14-1:</strong><br/>Tilt ball switch inserted in the breadboard</p>&#13;
<div class="image"><img alt="image" src="../images/f14-01.jpg"/></div>&#13;
<p class="indent">The potentiometer controls the contrast of the LCD screen.</p>&#13;
<h3 class="h3" id="ch14lev1sec02"><span class="orange"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindenta">Prepare the LCD screen as per the soldering instructions in “<a href="ch12.xhtml#ch12lev1sec02">Preparing the LCD Screen</a>” on <a href="ch12.xhtml#page_104">page 104</a>.</p></li>&#13;
<li><p class="noindenta">Place your LCD screen in the breadboard, inserting the header pins into the breadboard holes. Also place the potentiometer in the breadboard, and use the breadboard and jumper wires to connect your LCD screen, Arduino, and potentiometer.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-o" style="vertical-align: middle;"><p class="tablec"><strong>LCD SCREEN</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">1 VSS</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">2 VDD</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">3 VO contrast</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Potentiometer center pin</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span epub:type="pagebreak" id="page_120"/><span class="orange">4 RS</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 12</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">5 R/W</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">6 Enable</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 11</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">7 D0</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Not used</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">8 D1</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Not used</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">9 D2</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Not used</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">10 D3</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Not used</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">11 D4</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 5</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">12 D5</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 4</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">13 D6</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 3</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">14 D7</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 2</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">15 A BcL +</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">16 K BcL –</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="orange">GND</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Remember to use a breadboard rail to make the multiple connections to the Arduino GND pin, as shown in <a href="ch14.xhtml#ch14fig2">Figure 14-2</a>.</p>&#13;
<p class="figcaption"><a id="ch14fig2"/><strong>FIGURE 14-2:</strong><br/>The LCD screen is connected to the Arduino.</p>&#13;
<div class="image"><img alt="image" src="../images/f14-02.jpg"/></div></li>&#13;
<li><p class="noindenta">You should have already connected the center pin of the 10k-ohm potentiometer to LCD pin 3 (VO). Now connect one of the outer pins to GND and the other to +5V. This controls the contrast of your LCD screen.</p></li>&#13;
<li><p class="noindenta">Insert the tilt switch into your breadboard and attach one side to Arduino pin 6 via a 1k-ohm resistor and the other side to GND.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-o" style="vertical-align: middle;"><p class="tablec"><span epub:type="pagebreak" id="page_121"/><strong>TILT BALL SWITCH</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">Leg 1</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 6 via 1k-ohm resistor</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">Leg 2</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="orange">GND</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Connect your breadboard rails to the Arduino +5V and GND for power.</p></li>&#13;
<li><p class="noindenta">Confirm that your setup matches <a href="ch14.xhtml#ch14fig3">Figure 14-3</a>, and upload the code in “<a href="ch14.xhtml#ch14lev1sec03">The Sketch</a>” on <a href="ch14.xhtml#page_122">page 122</a>.</p>&#13;
<p class="figcaption"><a id="ch14fig3"/><strong>FIGURE 14-3:</strong><br/>The circuit diagram for the fortune teller</p>&#13;
<div class="image"><img alt="image" src="../images/f14-03.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch14lev1sec03"><span epub:type="pagebreak" id="page_122"/><span class="orange"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">The code for this project is fairly simple. When you switch on the Arduino, the LCD screen displays the message <code>Ask a Question</code>. Shaking the tilt switch activates the sketch, and the Arduino chooses a random answer from the eight available answers (cases 0–7).</p>&#13;
<p class="indent">Here’s the line in the code that does this:</p>&#13;
<p class="programs1">reply = <span class="orange1">random</span>(8);</p>&#13;
<p class="indent">To add in your own responses, change the value <code>8</code> to the number of possible responses, and then add your responses (or cases) in the same style as the others:</p>&#13;
<p class="programs2"><span class="green3">case</span> 8:<br/>  lcd.<span class="orange1">print</span>(<span class="green2">"You betcha"</span>);<br/>  <span class="green3">break</span>;</p>&#13;
<p class="indent">Here’s the full sketch:</p>&#13;
<pre><span class="ash">/* Created 13 September 2012 by Scott Fitzgerald</span><br/>   <span class="ash">http://arduino.cc/starterKit</span><br/>   <span class="ash">This example code is part of the public domain</span><br/><span class="ash">*/</span><br/><br/>#include &lt;<span class="orange1">LiquidCrystal</span>.h&gt;<br/><br/><span class="orange1">LiquidCrystal</span> lcd(12, 11, 5, 4, 3, 2); <span class="ash">// Pins attached to LCD screen</span><br/><br/><span class="green2">const int</span> switchPin = 6; <span class="ash">// Pin attached to tilt switch</span><br/><span class="green2">int</span> switchState = 0;<br/><span class="green2">int</span> prevSwitchState = 0;<br/><span class="green2">int</span> reply;<br/><br/><span class="green2">void</span> <span class="green3">setup</span>() {<br/>  lcd.<span class="orange1">begin</span>(16, 2);<br/>  <span class="orange1">pinMode</span>(switchPin, <span class="green2">INPUT</span>);   <span class="ash">// Set tilt switch pin as an input</span><br/>  lcd.<span class="orange1">print</span>(<span class="green2">"FORTUNE TELLER"</span>); <span class="ash">// Print this on line 1</span><br/>  lcd.<span class="orange1">setCursor</span>(0, 1);<br/>  lcd.<span class="orange1">print</span>(<span class="green2">"Ask a Question"</span>); <span class="ash">// Print this on line 2</span><br/>}<br/><br/><span class="green2">void</span> <span class="green3">loop</span>() {<br/>  switchState = <span class="orange1">digitalRead</span>(switchPin); <span class="ash">// Read tilt switch pin</span><br/>  <span class="green3">if</span> (switchState != prevSwitchState) {<br/>    <span class="green3">if</span> (switchState == <span class="green2">LOW</span>) { <span class="ash">// If circuit is broken, give answer</span><br/>      reply = <span class="orange1">random</span>(8); <span class="ash">// Reply is 1 of 8 random cases as below</span><br/>      lcd.<span class="orange1">clear</span>();<br/>      lcd.<span class="orange1">setCursor</span>(0, 0);<br/>      lcd.<span class="orange1">print</span>(<span class="green2">"The answer is: "</span>); <span class="ash">// Print this to the screen</span><br/>      lcd.<span class="orange1">setCursor</span>(0, 1);<br/><br/>      <span epub:type="pagebreak" id="page_123"/><span class="green3">switch</span> (reply) { <span class="ash">// Reply will be one of the following cases</span><br/>        <span class="green3">case</span> 0:<br/>          lcd.<span class="orange1">print</span>(<span class="green3">"Yes"</span>);<br/>          <span class="ash">break</span>;<br/><br/>        <span class="green3">case</span> 1:<br/>          lcd.<span class="orange1">print</span>(<span class="green2">"Probably"</span>);<br/>          <span class="green3">break</span>;<br/><br/>        <span class="green3">case</span> 2:<br/>          lcd.<span class="orange1">print</span>(<span class="green2">"Definitely"</span>);<br/>          <span class="green3">break</span>;<br/><br/>        <span class="green3">case</span> 3:<br/>          lcd.<span class="orange1">print</span>(<span class="green2">"Don't be silly"</span>);<br/>          <span class="green3">break</span>;<br/><br/>        <span class="green3">case</span> 4:<br/>          lcd.<span class="orange1">print</span>(<span class="green2">"Of course"</span>);<br/>          <span class="green3">break</span>;<br/><br/>        <span class="green3">case</span> 5:<br/>          lcd.<span class="orange1">print</span>(<span class="green2">"Ask again"</span>);<br/>          <span class="green3">break</span>;<br/><br/>        <span class="green3">case</span> 6:<br/>          lcd.<span class="orange1">print</span>(<span class="green2">"Doubtful"</span>);<br/>          <span class="green3">break</span>;<br/><br/>        <span class="green3">case</span> 7:<br/>          lcd.<span class="orange1">print</span>(<span class="green2">"No"</span>);<br/>          <span class="green3">break</span>;<br/>      }<br/>    }<br/>  }<br/>   prevSwitchState = switchState; <span class="ash">// Reset the switch</span><br/>}</pre>&#13;


<h2 class="h2a" id="ch15"><span epub:type="pagebreak" id="page_124"/>PROJECT 15: REACTION TIMER GAME</h2>&#13;
<p class="h2sub"><strong><span class="orange">IN THIS PROJECT, LET’S COMBINE OUR LCD SCREEN WITH AN RGB LED AND A PIEZO BUZZER TO MAKE A REACTION TIMER GAME.</span></strong></p>&#13;
<div class="image2"><img alt="image" src="../images/f0124-01.jpg"/></div>&#13;
<div class="image2"><span epub:type="pagebreak" id="page_125"/><img alt="image" src="../images/f0125-01.jpg"/></div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="orange"><strong>PARTS REQUIRED</strong></span></p>&#13;
<p class="bull">• Arduino board</p>&#13;
<p class="bull">• Breadboard</p>&#13;
<p class="bull">• Jumper wires</p>&#13;
<p class="bull">• 16x2 LCD screen (Hitachi HD44780 compatible)</p>&#13;
<p class="bull">• RGB LED module</p>&#13;
<p class="bull">• Piezo buzzer</p>&#13;
<p class="bull">• Momentary tactile four-pin pushbutton</p>&#13;
<p class="bull">• 50k-ohm potentiometer</p>&#13;
<p class="bull">• 220-ohm resistor</p>&#13;
</div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="orange"><strong>LIBRARIES REQUIRED</strong></span></p>&#13;
<p class="bull">• LiquidCrystal</p>&#13;
</div>&#13;
<h3 class="h3" id="ch15lev1sec01"><span epub:type="pagebreak" id="page_126"/><span class="orange"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">You start the game by holding down the pushbutton. The RGB LED lights up and fades through some random colors. Your aim is to react as quickly as possible when it turns red and release the pushbutton. The LCD screen shows your reaction time in milliseconds, from when the LED turned red to when you released the button (see <a href="ch15.xhtml#ch15fig1">Figure 15-1</a>).</p>&#13;
<p class="figcaption"><a id="ch15fig1"/><strong>FIGURE 15-1:</strong><br/>After you release the pushbutton, your reaction time will be shown on the LED screen.</p>&#13;
<div class="image"><img alt="image" src="../images/f15-01.jpg"/></div>&#13;
<p class="indent">The piezo buzzer tries to distract you by making random sounds. If you release the button too soon, the LCD screen displays a message saying so, and you’ll have to start over.</p>&#13;
<p class="indent">As its name implies, an RGB LED is actually three LEDs in one: red, green, and blue (see <a href="ch15.xhtml#ch15fig2">Figure 15-2</a>).</p>&#13;
<p class="figcaption"><a id="ch15fig2"/><strong>FIGURE 15-2:</strong><br/>An RGB LED can be red, green, or blue.</p>&#13;
<div class="image"><img alt="image" src="../images/f15-02.jpg"/></div>&#13;
<p class="indent">RGB is an <em>additive</em> color model, which means that by combining the light of two or more colors we can create other colors. Red, green, and blue are the additive primary colors usually used as the base for other colors, as shown in <a href="ch15.xhtml#ch15fig3">Figure 15-3</a>.</p>&#13;
<p class="figcaption"><a id="ch15fig3"/><strong>FIGURE 15-3:</strong><br/>The RGB color model is additive.</p>&#13;
<div class="image"><img alt="image" src="../images/f15-03.jpg"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_127"/>Let’s take a look at an RGB LED in a bit more detail. <a href="ch15.xhtml#ch15fig4">Figure 15-4</a> shows a clear common-cathode LED. Note that the LED has four legs instead of the usual two: one each for red, green, and blue, and the final one is either the cathode or anode. In this case the longest pin is the cathode, and it connects to ground (GND).</p>&#13;
<p class="figcaption"><a id="ch15fig4"/><strong>FIGURE 15-4:</strong><br/>An RGB LED has four legs instead of the usual two.</p>&#13;
<div class="image"><img alt="image" src="../images/f15-04.jpg"/></div>&#13;
<p class="indent">The RGB LED used in this project is on a module with built-in resistors, which allows us to save space on our breadboard.</p>&#13;
<h3 class="h3" id="ch15lev1sec02"><span class="orange"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindenta">Prepare the LCD screen as per the soldering instructions in “<a href="ch12.xhtml#ch12lev1sec02">Preparing the LCD Screen</a>” on <a href="ch12.xhtml#page_104">page 104</a>.</p></li>&#13;
<li><p class="noindenta">Place your LCD screen in the breadboard, inserting the header pins into the breadboard holes. Also place the potentiometer in the breadboard, and use the breadboard and jumper wires to connect your LCD screen, Arduino, and potentiometer.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-o" style="vertical-align: middle;"><p class="tablec"><strong>LCD SCREEN</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">1 VSS</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">2 VDD</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">3 VO contrast</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Potentiometer center pin</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">4 RS</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 11</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">5 R/W</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">6 Enable</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 12</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">7 D0</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Not used</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">8 D1</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Not used</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">9 D2</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Not used</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">10 D3</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Not used</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">11 D4</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 5</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span epub:type="pagebreak" id="page_128"/><span class="orange">12 D5</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 4</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">13 D6</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 3</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">14 D7</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 2</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">15 A BcL +</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">16 K BcL –</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="orange">GND</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">You should have already connected the center pin of the 50-kilohm potentiometer to LCD pin 3 (VO). Now connect one of the outer pins to GND and the other to +5V. This controls the contrast of your LCD screen.</p></li>&#13;
<li><p class="noindenta">Insert the pushbutton into the breadboard so that it straddles the break in the center. We’ll label the pins as shown in <a href="ch15.xhtml#ch15fig5">Figure 15-5</a>.</p>&#13;
<p class="figcaption"><a id="ch15fig5"/><strong>FIGURE 15-5:</strong><br/>The pushbutton straddles the center break.</p>&#13;
<div class="image"><img alt="image" src="../images/f15-05.jpg"/></div>&#13;
<p class="indent">Connect pin A to ground via a 220-ohm resistor, pin C to Arduino pin 9, and pin D to +5V (see <a href="ch01.xhtml#ch01">Project 1</a> for more on how the pushbutton works).</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-o" style="vertical-align: middle;"><p class="tablec"><strong>PUSHBUTTON</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin A</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">GND via 220-ohm resistor</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin C</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 9</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin D</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="orange">+5V</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Insert the RGB module and connect the red pin to Arduino pin 8, green to pin 6, blue to pin 7, and + to +5V.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-o" style="vertical-align: middle;"><p class="tablec"><strong>RGB LED</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">Red</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 8</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">Green</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 6</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">Blue</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 7</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">+</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="orange">+5V</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta"><span epub:type="pagebreak" id="page_129"/>Connect the piezo buzzer’s red wire directly to Arduino pin 13 and its black wire to GND.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-o" style="vertical-align: middle;"><p class="tablec"><strong>PIEZO</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">Red wire</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="orange">Pin 13</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-o" style="vertical-align: middle;"><p class="tablec"><span class="orange">Black wire</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="orange">GND</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Check your build against Figure 15-7, and then upload the code in “<a href="ch15.xhtml#ch15lev1sec03">The Sketch</a>” on <a href="ch15.xhtml#page_130">page 130</a> to start playing!</p>&#13;
<p class="figcaption"><a id="ch15fig6"/><strong>FIGURE 15-6:</strong><br/>Circuit diagram for the reaction timer game. You’ll probably find that it’s easier to add all the GND and +5V wires before the data wires.</p>&#13;
<div class="image"><img alt="image" src="../images/f15-06.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch15lev1sec03"><span epub:type="pagebreak" id="page_130"/><span class="orange"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">When you press and hold the pushbutton, the LED flashes random colors and eventually turns red. The duration of time for which each color shows is set to random, as is the duration of the pauses between lights. This means you can’t learn the sequence of the colors and predict when the LED might turn red.</p>&#13;
<p class="indent">You can make the game more difficult by increasing the duration of the intervals in the following line of the sketch:</p>&#13;
<pre>PSE = <span class="orange1">random</span>(500, 1200);</pre>&#13;
<p class="indent">The full sketch is as follows:</p>&#13;
<pre><span class="ash">// Created by Steven De Lannoy and reproduced with kind permission</span><br/><span class="ash">// http://www.wingbike.nl</span><br/><span class="ash">// Used an RGB LED with a common anode (3 cathodes: R, G, B)</span><br/>#include &lt;<span class="orange1">LiquidCrystal</span>.h&gt;<br/><span class="orange1">LiquidCrystal</span> lcd(12, 11, 5, 4, 3, 2);<br/><span class="green2">int</span> LEDR = 8;   <span class="ash">// Pin connected to red LED</span><br/><span class="green2">int</span> LEDB = 7;   <span class="ash">// Pin connected to blue LED</span><br/><span class="green2">int</span> LEDGr = 6;  <span class="ash">// Pin connected to green LED</span><br/><span class="green2">int</span> Button = 9; <span class="ash">// Pin connected to pushbutton</span><br/><span class="green2">int</span> COLOR;      <span class="ash">// Variable color</span><br/><span class="green2">int</span> Beep;<br/><span class="green2">int</span> PSE;        <span class="ash">// Variable pause</span><br/><span class="green2">int</span> TME;        <span class="ash">// Time</span><br/><span class="green2">int</span> RTME = 0;   <span class="ash">// Reaction time</span><br/><br/><span class="green2">void</span> <span class="green3">setup</span>() {<br/>  lcd.<span class="orange1">begin</span>(16, 2);<br/>  <span class="orange1">pinMode</span>(LEDR, <span class="green2">OUTPUT</span>);   <span class="ash">// Set LED pins as output</span><br/>  <span class="orange1">pinMode</span>(LEDB, <span class="green2">OUTPUT</span>);<br/>  <span class="orange1">pinMode</span>(LEDGr, <span class="green2">OUTPUT</span>);<br/>  <span class="orange1">pinMode</span>(Button, <span class="green2">INPUT</span>);  <span class="ash">// Set pushbutton as input</span><br/>  <span class="orange1">digitalWrite</span>(LEDR, <span class="green2">LOW</span>); <span class="ash">// Switch on all LED colors</span><br/>  <span class="orange1">digitalWrite</span>(LEDB, <span class="green2">LOW</span>);<br/>  <span class="orange1">digitalWrite</span>(LEDGr, <span class="green2">LOW</span>);<br/>}<br/><br/><span class="green2">void</span> <span class="green3">loop</span>() {<br/>  lcd.<span class="orange1">clear</span>(); <span class="ash">// Clear screen</span><br/>  lcd.<span class="orange1">print</span>(<span class="green2">"Hold Button to"</span>); <span class="ash">// Display message on LCD screen</span><br/>  lcd.<span class="orange1">setCursor</span>(0, 1); <span class="ash">// Move to second line</span><br/>  lcd.<span class="orange1">print</span>(<span class="green2">"start."</span>);<br/>  <span class="green3">while</span> (<span class="orange1">digitalRead</span>(Button) == <span class="green2">LOW</span>) { <span class="ash">// Test does not start until</span><br/>                                       <span class="ash">// button is pushed (and held)</span><br/>    <span class="orange1">tone</span>(13, 1200, 30);<br/>    <span class="orange1">delay</span>(1400);<br/>    <span class="orange1">noTone</span>(13);<br/>  }<br/><span epub:type="pagebreak" id="page_131"/><br/>  lcd.<span class="orange1">clear</span>();<br/>  <span class="orange1">digitalWrite</span>(LEDR, <span class="green2">HIGH</span>); <span class="ash">// Switch off start light</span><br/>  <span class="orange1">digitalWrite</span>(LEDB, <span class="green2">HIGH</span>);<br/>  <span class="orange1">digitalWrite</span>(LEDGr, <span class="green2">HIGH</span>);<br/>  <span class="orange1">randomSeed</span>(<span class="orange1">analogRead</span>(0)); <span class="ash">// Random noise from pin 0</span><br/>  COLOR = <span class="orange1">random</span>(1, 4); <span class="ash">// Generate random color</span><br/>  PSE = <span class="orange1">random</span>(500, 1200); <span class="ash">// Set random pause duration between lights</span><br/>  <span class="ash">// Repeat this loop while color is green or blue AND pushbutton</span><br/>  <span class="ash">// is held</span><br/>  <span class="green3">while</span> (COLOR != 1 &amp;&amp; <span class="orange1">digitalRead</span>(Button) == <span class="green2">HIGH</span>) {<br/>    <span class="orange1">digitalWrite</span>(LEDGr, <span class="green2">HIGH</span>);<br/>    <span class="orange1">digitalWrite</span>(LEDB, <span class="green2">HIGH</span>);<br/>    <span class="orange1">delay</span>(PSE);<br/>    <span class="orange1">randomSeed</span>(<span class="orange1">analogRead</span>(0));<br/>    Beep = <span class="orange1">random</span>(1, 4); <span class="ash">// Select random beep from buzzer</span><br/>                         <span class="ash">// (buzzer beeps 1 in 3 times)</span><br/>    PSE = <span class="orange1">random</span>(750, 1200); <span class="ash">// Select random pause duration between</span><br/>                             <span class="ash">// lights (to increase surprise effect)</span><br/>    <span class="green3">if</span> (Beep == 1) {<br/>      <span class="orange1">tone</span>(13, 1600, 350);<br/>      <span class="orange1">delay</span>(750);<br/>      <span class="orange1">noTone</span>(13);<br/>    }<br/>    <span class="green3">if</span> (COLOR == 2) {<br/>      <span class="orange1">digitalWrite</span>(LEDGr, <span class="green2">LOW</span>);<br/>    }<br/>    <span class="green3">if</span> (COLOR == 3) {<br/>      <span class="orange1">digitalWrite</span>(LEDB, <span class="green2">LOW</span>);<br/>    }<br/>    <span class="orange1">delay</span>(PSE);<br/>    <span class="orange1">randomSeed</span>(<span class="orange1">analogRead</span>(0));<br/>    COLOR = <span class="orange1">random</span>(1, 4); <span class="ash">// Select random color</span><br/>  }<br/>  <span class="ash">// Execute this loop if color is red</span><br/>  <span class="green3">if</span> (COLOR == 1 &amp;&amp; <span class="orange1">digitalRead</span>(Button) == <span class="green2">HIGH</span>) {<br/>    <span class="orange1">digitalWrite</span>(LEDGr, <span class="green2">HIGH</span>);<br/>    <span class="orange1">digitalWrite</span>(LEDB, <span class="green2">HIGH</span>);<br/>    <span class="orange1">delay</span>(PSE);<br/>    TME = <span class="orange1">millis</span>(); <span class="ash">// Record time since program has started</span><br/>    <span class="orange1">digitalWrite</span>(LEDR, <span class="green2">LOW</span>);<br/>    <span class="green3">while</span> (<span class="orange1">digitalRead</span>(Button) == <span class="green2">HIGH</span>) { <span class="ash">// Runs until button is</span><br/>                                          <span class="ash">// released, recording the</span><br/>                                          <span class="ash">// reaction time</span><br/>      <span class="orange1">delay</span>(1);<br/>    }<br/>    lcd.<span class="orange1">display</span>();<br/>    RTME = <span class="orange1">millis</span>() - TME; <span class="ash">// Reaction time in ms</span><br/>    lcd.<span class="orange1">print</span>(<span class="green2">"Reaction Time:"</span>); <span class="ash">// Display on LCD screen</span><br/>    lcd.<span class="orange1">setCursor</span>(0, 1);<br/>    lcd.<span class="orange1">print</span>(RTME);<br/>  }<br/><br/>  <span epub:type="pagebreak" id="page_132"/><span class="ash">// Execute if color is NOT red but the pushbutton is released</span><br/>  <span class="green3">if</span> (COLOR != 1) {<br/>    lcd.<span class="orange1">print</span>(<span class="green2">"Released too"</span>);<br/>    lcd.<span class="orange1">setCursor</span>(0, 1); <span class="ash">// Move to second line</span><br/>    lcd.<span class="orange1">print</span>(<span class="green2">"soon!!!"</span>);<br/>    <span class="orange1">tone</span>(13, 3000, 1500);<br/>    <span class="orange1">delay</span>(500);<br/>    <span class="orange1">noTone</span>(13);<br/>  }<br/>  <span class="ash">// Test does not restart until the button is pushed once</span><br/>  <span class="green3">while</span> (<span class="orange1">digitalRead</span>(Button) == <span class="green2">LOW</span>) {<br/>    <span class="orange1">delay</span>(10);<br/>  }<br/>  <span class="orange1">digitalWrite</span>(LEDR, <span class="green2">LOW</span>); <span class="ash">// Reset all lights to begin again</span><br/>  <span class="orange1">digitalWrite</span>(LEDB, <span class="green2">LOW</span>);<br/>  <span class="orange1">digitalWrite</span>(LEDGr, <span class="green2">LOW</span>);<br/>  lcd.<span class="orange1">clear</span>();<br/>  lcd.<span class="orange1">print</span>(<span class="green2">"Hold Button to"</span>);<br/>  lcd.<span class="orange1">setCursor</span>(0, 1);<br/>  lcd.<span class="orange1">print</span>(<span class="green2">"start."</span>);<br/>  <span class="green2">int</span> Time = 0;<br/>  <span class="orange1">delay</span>(1000);<br/>}</pre>&#13;
</body></html>