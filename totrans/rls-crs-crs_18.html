<html><head></head><body><div class="appendix" title="Appendix&#xA0;A.&#xA0;Solutions"><div class="titlepage"><div><div><h1 class="title"><a id="solutions"/>Appendix A. Solutions</h1></div></div></div><div class="sect1" title="Chapter 1"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_1"/>Chapter 1</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Exercise 1 is about learning to read a file and exploring the array methods using
            the contents of the file. I’d expect to see something like this in the console
            after completing the exercise:</p><a id="pro_id00501"/><pre class="programlisting">irb(main):001:0&gt; <span class="strong"><strong>file = File.read("test.txt")</strong></span>
 =&gt; "Call me Ishmael..."
irb(main):002:0&gt; <span class="strong"><strong>puts file.split</strong></span>
Call
me
Ishmael
--<span class="emphasis"><em>snip</em></span>--
 =&gt; nil
irb(main):003:0&gt; <span class="strong"><strong>puts file.split.length</strong></span>
 =&gt; 198
irb(main):004:0&gt; <span class="strong"><strong>puts file.split.uniq.length</strong></span>
 =&gt; 140</pre><p>The output depends on the text you used.</p></li><li class="listitem"><p>The second exercise requires writing a little code. The following sample solves the
            problem using only methods covered so far:</p><a id="pro_id00502"/><pre class="programlisting">file = File.read("test.txt")
counts = {}
file.split.each do |word|
  if counts[word]
    counts[word] = counts[word] + 1
  else
    counts[word] = 1
  end
end
puts counts</pre><p>This solution should print something like this:</p><a id="pro_id00503"/><pre class="programlisting">=&gt; {"Call"=&gt;1, "me"=&gt;3, "Ishmael."=&gt;1, ...</pre><p>The word “Call” appears once in the paragraph; the word “me”
            appears three times; and so on.</p></li><li class="listitem"><p>Using the sample code provided in Exercise 3, the complete solution looks like
            this:</p><a id="pro_id00504"/><pre class="programlisting">class WordCounter
  def initialize(file_name)
    @file = File.read(file_name)
  end

  def count
    @file.split.length
  end

  def uniq_count
    @file.split.uniq.length
  end

  def frequency
    counts = {}
    @file.split.each do |w|
      if counts[w]
        counts[w] = counts[w] + 1
      else
        counts[w] = 1
      end
    end
  end
end</pre></li></ol></div><p>This combines the solutions to the first two exercises, wrapping them in a Ruby
        class.</p></div><div class="sect1" title="Chapter 2"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_2"/>Chapter 2</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p><a class="indexterm" id="iddle1114"/><a class="indexterm" id="iddle2303"/>The first exercise is about familiarizing yourself with a simple Rails
            application and the functionality provided by default. The address of the home page is
              <span class="emphasis"><em>http://localhost:3000/posts</em></span>. As you move around the application,
            that address changes. The new post form is at <span class="emphasis"><em>/posts/new</em></span>; the first
            post is at <span class="emphasis"><em>/posts/1</em></span>; and the form for editing the first post is at
              <span class="emphasis"><em>/posts/1/edit</em></span>. These paths and their meaning are covered in <a class="xref" href="ch04.html" title="Chapter 4. Controllers">Chapter 4</a>.</p></li><li class="listitem"><p>If you’ve never worked on a large application before, the number of files in a
            typical Rails application can seem daunting. Most editors contain some type of project
            list for opening files, as well as keyboard shortcuts for quickly searching for files by
            name. These features are invaluable when working on larger projects.</p></li></ol></div></div><div class="sect1" title="Chapter 3"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_3"/>Chapter 3</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>The following commands generate and run the migration to add an email address to
            comments:</p><a id="pro_id00505"/><pre class="programlisting">$ <span class="strong"><strong>bin/rails g migration add_email_to_comments email:string</strong></span>
    invoke  active_record
    create    db/migrate/20140404225418_add_email_to_comments.rb
$ <span class="strong"><strong>bin/rake db:migrate</strong></span>
== 20140404225418 AddEmailToComments: migrating...
--<span class="emphasis"><em>snip</em></span>--</pre><p>You can then launch a Rails console with <code class="literal">bin/rails console</code> and
            create a new comment with an email address.</p></li><li class="listitem"><p>Open <span class="emphasis"><em>app/models/comment.rb</em></span> and add the validation as shown
            here:</p><a id="pro_id00506"/><pre class="programlisting">class Comment &lt; ActiveRecord::Base
  belongs_to :post
  <span class="strong"><strong>validates :author, :body, presence: true</strong></span>
end</pre><p>Note that I added the validation for both fields on a single line. You could do
            this, however, with two separate calls to the <code class="literal">validates</code>
            method.</p></li><li class="listitem"><p>You can’t write a single query to determine the number of comments for each
            post, but you can iterate over all posts and count the comments. Enter something like
            this in the Rails console:</p><a id="pro_id00507"/><pre class="programlisting">2.1.0 :001 &gt; <span class="strong"><strong>Post.all.each do |post|</strong></span>
2.1.0 :002 *   <span class="strong"><strong>puts post.comments.count</strong></span>
2.1.0 :003 &gt; <span class="strong"><strong>end</strong></span></pre></li></ol></div><p>This code first finds all of the posts and then makes a count query on the comments
        table for each one.</p></div><div class="sect1" title="Chapter 4"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_4"/>Chapter 4</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p><a class="indexterm" id="iddle1341"/><a class="indexterm" id="iddle1551"/>Open the file <span class="emphasis"><em>app/controllers/comments_controller.rb</em></span>,
            and find the <code class="literal">create</code> method.</p><a id="pro_id00508"/><pre class="programlisting">class CommentsController &lt; ApplicationController
  def create
    @post = Post.find(params[:post_id])

    if @post.comments.create(comment_params) ➊
      redirect_to @post,
                  notice: 'Comment was successfully created.'
    else
      redirect_to @post,
                  alert: 'Error creating comment.'
    end
  end
--<span class="emphasis"><em>snip</em></span>--</pre><p>Note that it currently uses @post.comments.create(comment_params) ➊ to
            initialize and save the new comment as part of the if statement. You need to store the
            new comment in a variable so you can use the errors method to get a list of errors when
            the save fails. Update the create method as shown here:</p><a id="pro_id00509"/><pre class="programlisting">class CommentsController &lt; ApplicationController
  def create
    @post = Post.find(params[:post_id])
    <span class="strong"><strong>@comment = @post.comments.build(comment_params)</strong></span>

    if <span class="strong"><strong>@comment.save</strong></span>
      redirect_to @post,
                  notice: 'Comment was successfully created.'
    else
      redirect_to @post,
                  alert: 'Error creating comment. ' <span class="strong"><strong>+</strong></span>
                    <span class="strong"><strong>@comment.errors.full_messages.to_sentence</strong></span> ➊
    end
  end
--<span class="emphasis"><em>snip</em></span>--</pre><p>This code adds the errors to the existing alert. Notice I used the to_sentence
            method ➊ to convert the array of error messages to a sentence like this:
            “Author can’t be blank and Body can’t be blank.”</p></li><li class="listitem"><p>Edit <span class="emphasis"><em>app/controllers/comments_controller.rb</em></span>, and find the
            comment_params method. Add :email to the call to the permit method:</p><a id="pro_id00510"/><pre class="programlisting">class CommentsController &lt; ApplicationController
--<span class="emphasis"><em>snip</em></span>--

  private
  def comment_params
    params.require(:comment).permit(:author, :body<span class="strong"><strong>, :email</strong></span>)
  end
end</pre></li></ol></div><p><a class="indexterm" id="iddle1141"/>Now if a user enters an email address when adding a new comment, the address
        should be stored in the database. Without this change, the <code class="literal">email</code> field is
        simply ignored.</p></div><div class="sect1" title="Chapter 5"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_5"/>Chapter 5</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Remove the <code class="literal">h1</code> element from
              <span class="emphasis"><em>app/views/posts/index.html.erb</em></span> and update
              <span class="emphasis"><em>app/views/layouts/application.html.erb,</em></span> as shown here:</p><a id="pro_id00511"/><pre class="programlisting">--<span class="emphasis"><em>snip</em></span>--
&lt;body&gt;
<span class="strong"><strong>&lt;h1&gt;Listing posts&lt;/h1&gt;</strong></span>

&lt;%= yield %&gt;

&lt;/body&gt;
&lt;/html&gt;</pre><p>Also change the headings in <span class="emphasis"><em>app/views/posts/new.html.erb</em></span> and
              <span class="emphasis"><em>app/ views/posts/edit.html.erb</em></span> to <code class="literal">h2</code>
            headings:</p><a id="pro_id00512"/><pre class="programlisting"><span class="strong"><strong>&lt;h2&gt;New post&lt;/h2&gt;</strong></span>

&lt;%= render 'form' %&gt;

&lt;%= link_to 'Back', posts_path %&gt;</pre></li><li class="listitem"><p>First, add a label and text field for <code class="literal">:author</code> to the
              <span class="emphasis"><em>app/views/posts/ _form.html.erb</em></span> partial:</p><a id="pro_id00513"/><pre class="programlisting">--<span class="emphasis"><em>snip</em></span>--
  &lt;div class="field"&gt;
    &lt;%= f.label :title %&gt;&lt;br&gt;
    &lt;%= f.text_field :title %&gt;
  &lt;/div&gt;
  <span class="strong"><strong>&lt;div class="field"&gt;</strong></span>
    <span class="strong"><strong>&lt;%= f.label :author %&gt;&lt;br&gt;</strong></span>
    <span class="strong"><strong>&lt;%= f.text_field :author %&gt;</strong></span>
  <span class="strong"><strong>&lt;/div&gt;</strong></span>
  &lt;div class="field"&gt;
    &lt;%= f.label :body %&gt;&lt;br&gt;
    &lt;%= f.text_area :body %&gt;
  &lt;/div&gt;
--<span class="emphasis"><em>snip</em></span>--</pre><p><a class="indexterm" id="iddle1085"/><a class="indexterm" id="iddle1637"/><a class="indexterm" id="iddle2056"/>Then add <code class="literal">:author</code> to the list of permitted parameters in
            the <code class="literal">post_ params</code> method at the bottom of
              <span class="emphasis"><em>app/controllers/posts_controller.rb</em></span>:</p><a id="pro_id00514"/><pre class="programlisting">--<span class="emphasis"><em>snip</em></span>--
    def post_params
      params.require(:post).permit(:title, <span class="strong"><strong>:author,</strong></span> :body)
    end
end</pre></li><li class="listitem"><p>Make the changes to <span class="emphasis"><em>config/routes.rb</em></span> and
              <span class="emphasis"><em>app/views/comments/_comment.html.erb</em></span> as described in the
            question. Here is how I would write the <code class="literal">destroy</code> action in
              <span class="emphasis"><em>app/controllers/comments_controller.rb</em></span>:</p><a id="pro_id00515"/><pre class="programlisting">--<span class="emphasis"><em>snip</em></span>--
  <span class="strong"><strong>def destroy</strong></span>
    <span class="strong"><strong>@post = Post.find(params[:post_id])</strong></span>
    <span class="strong"><strong>@comment = @post.comments.find(params[:id])</strong></span>

    <span class="strong"><strong>@comment.destroy</strong></span>
    <span class="strong"><strong>respond_to do |format|</strong></span>
      <span class="strong"><strong>format.html { redirect_to @post }</strong></span>
      <span class="strong"><strong>format.json { head :no_content }</strong></span>
    <span class="strong"><strong>end</strong></span>
  <span class="strong"><strong>end</strong></span>
--<span class="emphasis"><em>snip</em></span>--</pre></li></ol></div></div><div class="sect1" title="Chapter 6"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_6"/>Chapter 6</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>After editing files in your application, stage your changes in Git with <span class="strong"><strong><code class="literal">git add .</code></strong></span>, then commit these changes with
              <span class="strong"><strong><code class="literal">git commit -m "</code></strong></span>
            <span class="emphasis"><em><span class="strong"><strong><code class="literal">Commit
              Message"</code></strong></span></em></span>, and finally push the changes to Heroku with
              <span class="strong"><strong><code class="literal">git push heroku master</code></strong></span>.</p></li><li class="listitem"><p>If you don’t already have a GitHub account, go to <span class="emphasis"><em><a class="ulink" href="https://github.com/">https://github.com/</a></em></span> and complete the sign-up form. Next
            you’ll need to choose a plan. The free plan includes unlimited public
            repositories. Once you finish the sign-up process, you should see the GitHub Bootcamp
            screen. Follow the instructions there to create a repository and upload your
            application.</p></li><li class="listitem"><p>Create your new application in the <span class="emphasis"><em>code</em></span> directory you created
            in <a class="xref" href="ch02.html" title="Chapter 2. Rails Fundamentals">Chapter 2</a>, not inside the <span class="emphasis"><em>blog</em></span>
            directory. Use the <code class="literal">rails new</code> command followed by the name of your new
            application. For example, to create an application to track your record collection, type
            this command:</p><a id="pro_id00516"/><pre class="programlisting">$ <span class="strong"><strong>rails new vinyl</strong></span></pre><p><a class="indexterm" id="iddle1291"/><a class="indexterm" id="iddle1998"/><a class="indexterm" id="iddle2058"/>Next think about the models your application needs. In this case, you
            probably need a <code class="literal">Record</code> or <code class="literal">Album</code> model. The model
            needs fields such as <code class="literal">title</code>, <code class="literal">artist</code>, and
              <code class="literal">release_date</code>. Move to the <span class="emphasis"><em>vinyl</em></span> directory, and
            use the <code class="literal">rails scaffold</code> command to generate some code to get
            started:</p><a id="pro_id00517"/><pre class="programlisting">$ <span class="strong"><strong>cd vinyl</strong></span>
$ <span class="strong"><strong>bin/rails generate scaffold Album title artist release_date:datetime</strong></span></pre></li></ol></div><p>Now start the Rails server and work with your new application.</p></div><div class="sect1" title="Chapter 7"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_7"/>Chapter 7</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>In my version of Rails, the <code class="literal">Post</code> class has 58 ancestors.</p><a id="pro_id00518"/><pre class="programlisting">irb(main):001:0&gt; Post.ancestors.count
=&gt; 58</pre><p>Using the Ruby pretty-print method (<code class="literal">pp)</code>, you can list each
            ancestor on a separate line:</p><a id="pro_id00519"/><pre class="programlisting">irb(main):012:0&gt; pp Post.ancestors
[Post(id: integer, title: string, body: text, created_at: datetime,
updated_at: datetime, author: string),
 Post::GeneratedFeatureMethods,
 #&lt;Module:0x007fabc21bafd8&gt;,
 ActiveRecord::Base,
 --<span class="emphasis"><em>snip</em></span>--
 ActiveRecord::Validations,
 --<span class="emphasis"><em>snip</em></span>--
 Kernel,
 BasicObject]</pre><p>As you scroll through the list of ancestors, you should see some names you
            recognize, such as <code class="literal">ActiveRecord::Associations</code> and
              <code class="literal">ActiveRecord::Validations</code>. Also, notice that
              <code class="literal">Post</code> inherits from <code class="literal">BasicObject</code>, just like every
            other class in Ruby.</p></li><li class="listitem"><p>The
              <code class="literal">cannot_</code><span class="emphasis"><em><code class="literal">feature</code></em></span><code class="literal">!</code>
            method should be the same as the
                <code class="literal">can_</code><span class="emphasis"><em><code class="literal">feature</code></em></span><code class="literal">!</code>
            method except it assigns <code class="literal">false</code> to the <code class="literal">@features[f]</code>
            instead of <code class="literal">true</code>.</p><a id="pro_id00520"/><pre class="programlisting">class User
  FEATURES = ['create', 'update', 'delete']

  FEATURES.each do |f|
    define_method "can_#{f}!" do
      @features[f] = true
    end

    <span class="strong"><strong>define_method "cannot_#{f}!" do</strong></span>
      <span class="strong"><strong>@features[f] = false</strong></span>
    <span class="strong"><strong>end</strong></span>

    define_method "can_#{f}?" do
      !!@features[f]
    end
  end

  def initialize
    @features = {}
  end
end</pre><p><a class="indexterm" id="iddle1525"/><a class="indexterm" id="iddle2291"/>After adding this method, create another instance of the
              <code class="literal">User</code> class and make sure the new method works as expected:</p><a id="pro_id00521"/><pre class="programlisting">irb(main):001:0&gt; <span class="strong"><strong>user = User.new</strong></span>
 =&gt; #&lt;User:0x007fc01b95abe0 @features={}&gt;
irb(main):002:0&gt; <span class="strong"><strong>user.can_create!</strong></span>
 =&gt; true
irb(main):003:0&gt; <span class="strong"><strong>user.can_create?</strong></span>
 =&gt; true
irb(main):004:0&gt; <span class="strong"><strong>user.cannot_create!</strong></span>
 =&gt; false
irb(main):005:0&gt; <span class="strong"><strong>user.can_create?</strong></span>
 =&gt; false</pre></li><li class="listitem"><p>First, look at the instance methods defined by the <code class="literal">Element</code>
            class:</p><a id="pro_id00522"/><pre class="programlisting">irb(main):001:0&gt; <span class="strong"><strong>Element.instance_methods(false)</strong></span>
 =&gt; [:name, :name=]</pre><p>The methods <code class="literal">name</code> and <code class="literal">name=</code> are defined as
            expected. Now reopen the <code class="literal">Element</code> class and add a call to
              <code class="literal">accessor :symbol:</code></p><a id="pro_id00523"/><pre class="programlisting">irb(main):002:0&gt; <span class="strong"><strong>class Element</strong></span>
irb(main):003:1&gt; <span class="strong"><strong>accessor :symbol</strong></span>
irb(main):004:1&gt; <span class="strong"><strong>end</strong></span>
 =&gt; :symbol=</pre><p>This should create two new methods named <code class="literal">symbol</code> and
              <code class="literal">symbol=</code>. You can verify that the methods were created by calling
              <code class="literal">instance_methods</code> again:</p><a id="pro_id00524"/><pre class="programlisting">irb(main):005:0&gt; <span class="strong"><strong>Element.instance_methods(false)</strong></span>
 =&gt; [:name, :name=, :symbol, :symbol=]</pre></li></ol></div><p>You can verify that the methods work as expected by creating an instance of the
          <code class="literal">Element</code> class and assigning a symbol with <code class="literal">e.symbol =
          "Au"</code>.</p></div><div class="sect1" title="Chapter 8"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_8"/>Chapter 8</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p><a class="indexterm" id="iddle1231"/><a class="indexterm" id="iddle1241"/><a class="indexterm" id="iddle1339"/><a class="indexterm" id="iddle1491"/><a class="indexterm" id="iddle2045"/>Specifying <code class="literal">dependent: :destroy</code> on the
              <code class="literal">belongs_to</code> side of the association causes the parent model to be
            destroyed when any child model is destroyed. In this example, destroying any
              <code class="literal">Post</code> also destroys the associated <code class="literal">User</code>. This
            mistake is fairly common.</p></li><li class="listitem"><p>The completed <code class="literal">Comment</code> model should look like this:</p><a id="pro_id00525"/><pre class="programlisting">class Comment &lt; ActiveRecord::Base
  belongs_to :post
  belongs_to :user

  <span class="strong"><strong>validates :post_id, presence: true</strong></span>
  <span class="strong"><strong>validates :user_id, presence: true</strong></span>
end</pre><p>The Rails generator adds <code class="literal">belongs_to</code> associations automatically,
            but it does not add validations.</p></li><li class="listitem"><p>Launch the Rails console with <span class="strong"><strong><code class="literal">bin/rails
                console</code></strong></span>. Create a new <code class="literal">User</code>,
              <code class="literal">TextPost</code>, and <code class="literal">Comment</code>. Verify that all of the
            models were created. Then call <code class="literal">destroy</code> on the new
              <code class="literal">User</code> and verify that the associated <code class="literal">TextPost</code> and
              <code class="literal">Comment</code> records are also destroyed.</p><a id="pro_id00526"/><pre class="programlisting">irb(main):001:0&gt; <span class="strong"><strong>carol = User.create name: "Carol"</strong></span>
 =&gt; #&lt;User id: 3, name: "Carol", ...&gt;
irb(main):002:0&gt; <span class="strong"><strong>post = TextPost.create user: carol, body: "Testing"</strong></span>
 =&gt; #&lt;TextPost id: 3, body: "Testing", ...&gt;
irb(main):003:0&gt; <span class="strong"><strong>comment = Comment.create post: post, user: carol, \</strong></span>
                                <span class="strong"><strong>body: "Hello"</strong></span>
 =&gt; #&lt;Comment id: 1, body: "Hello", ...&gt;
irb(main):004:0&gt; <span class="strong"><strong>carol.posts.count</strong></span>
 =&gt; 1
irb(main):005:0&gt; <span class="strong"><strong>carol.comments.count</strong></span>
 =&gt; 1
irb(main):006:0&gt; <span class="strong"><strong>carol.destroy</strong></span> ➊
--<span class="emphasis"><em>snip</em></span>--
 =&gt; #&lt;User id: 3, name: "Carol", ...&gt;
irb(main):007:0&gt; <span class="strong"><strong>carol.posts.count</strong></span>
 =&gt; 0
irb(main):008:0&gt; <span class="strong"><strong>carol.comments.count</strong></span>
 =&gt; 0
irb(main):009:0&gt; <span class="strong"><strong>carol.reload</strong></span> ➋
ActiveRecord::RecordNotFound: Couldn't find User with id=3
--<span class="emphasis"><em>snip</em></span>--</pre></li></ol></div><p>Note that calling <code class="literal">destroy</code> on the model does not remove it from memory
        ➊. The variable <code class="literal">carol</code> still refers to the model even though it has
        been deleted from the database. Attempting to reload the model from the database raises an
          <code class="literal">ActiveRecord::RecordNotFound</code> exception because the record for carol has
        been deleted ➋.</p></div><div class="sect1" title="Chapter 9"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_9"/>Chapter 9</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p><a class="indexterm" id="iddle1083"/><a class="indexterm" id="iddle1124"/><a class="indexterm" id="iddle1132"/><a class="indexterm" id="iddle1156"/><a class="indexterm" id="iddle1224"/><a class="indexterm" id="iddle2251"/>First, edit the text post partial at
              <span class="emphasis"><em>app/views/text_posts/_text_post.html.erb,</em></span> as shown here:</p><a id="pro_id00527"/><pre class="programlisting">&lt;div class="panel panel-default"&gt;
  &lt;div class="panel-heading"&gt;
    &lt;h3 class="panel-title"&gt;
      &lt;%= text_post.title %&gt;
    &lt;/h3&gt;
    <span class="strong"><strong>&lt;%= link_to(</strong></span>
          <span class="strong"><strong>"#{time_ago_in_words text_post.created_at} ago",</strong></span>
          <span class="strong"><strong>post_path(text_post)) %&gt;</strong></span>
  &lt;/div&gt;
--<span class="emphasis"><em>snip</em></span>--</pre><p>This creates a link to the text_post with the time in words such as “5 days
            ago.” Edit the image post partial at <span class="emphasis"><em>app/views/image_posts/
              _image_post.html.erb</em></span> with a similar change.</p><a id="pro_id00528"/><pre class="programlisting">--<span class="emphasis"><em>snip</em></span>--
  &lt;/h3&gt;
  <span class="strong"><strong>&lt;%= link_to "#{time_ago_in_words image_post.created_at} ago",</strong></span>
        <span class="strong"><strong>post_path(image_post) %&gt;</strong></span>
&lt;/div&gt;
--<span class="emphasis"><em>snip</em></span>--</pre><p>The only difference here is the word text_post is replaced with image_post. Now load
            the posts index page and make sure the links work correctly.</p></li><li class="listitem"><p>The most important part of this exercise is restricting access to the controller to
            authenticated users. Add <code class="literal">before_action :authenticate_user!</code> in
              <span class="emphasis"><em>app/controllers/comments_controller.rb,</em></span> as shown here:</p><a id="pro_id00529"/><pre class="programlisting">class CommentsController &lt; ApplicationController
  <span class="strong"><strong>before_action :authenticate_user!</strong></span>

  --<span class="emphasis"><em>snip</em></span>--
end</pre><p>The comment partial at <span class="emphasis"><em>app/views/comments/_comment.html.erb</em></span>
            shows the <code class="literal">name</code> of the user that created the comment and the
              <code class="literal">body</code> of the comment.</p><a id="pro_id00530"/><pre class="programlisting"><span class="strong"><strong>&lt;p&gt;&lt;em&gt;&lt;%= comment.user.name %&gt; said:&lt;/em&gt;&lt;/p&gt;</strong></span>
<span class="strong"><strong>&lt;p&gt;&lt;%= comment.body %&gt;&lt;/p&gt;</strong></span></pre><p>This partial is rendered once for each comment by <code class="literal">render
              @post.comments</code> in the post <code class="literal">show</code> view.</p></li><li class="listitem"><p><a class="indexterm" id="iddle1133"/><a class="indexterm" id="iddle1159"/><a class="indexterm" id="iddle1221"/><a class="indexterm" id="iddle1242"/>First, start a Rails console with <span class="strong"><strong><code class="literal">bin/rails
                console</code></strong></span> to see the <span class="strong"><strong><code class="literal">password_digest</code></strong></span> for a user.</p><a id="pro_id00531"/><pre class="programlisting">irb(main):001:0&gt; <span class="strong"><strong>alice = User.find 1</strong></span>
  User Load ...
 =&gt; #&lt;User id: 1, name: "Alice", ...&gt;
irb(main):002:0&gt; <span class="strong"><strong>alice.password_digest</strong></span>
 =&gt; "$2a$10$NBjrpHtfLJN14c6kVjG7sety1N4ifyuto7GD5qX7xHdVmbtweL1Ny"</pre></li></ol></div><p>The value of <code class="literal">alice.password_digest</code> that you see will be different.
        Bcrypt automatically adds a salt to the password before generating the hash digest. I
        can’t tell the password for <code class="literal">alice</code> by looking at that value. Bcrypt
        seems pretty secure!</p><p>You can see the cookies for a site by looking at resources in your browser’s
        Developer Tools or Page Info. According to the Chrome developer tools, my current
          <code class="literal">_social_session</code> cookie is 465 bytes of alphanumeric digits like this
          <code class="literal">"M2xkVmNTaGpVaFd..."</code>. Again, I’m not able to decipher that
        information.</p></div><div class="sect1" title="Chapter 10"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_10"/>Chapter 10</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Open the <code class="literal">TextPost</code> partial at
              <span class="emphasis"><em>app/views/text_posts/_text_post.html.erb</em></span>. It already displays the
            user’s <code class="literal">name</code>. Add a call to the <code class="literal">link_to</code>
            helper method before the <code class="literal">text_post.user.name</code> and also pass the
              <code class="literal">text_post.user</code> to the helper:</p><a id="pro_id00532"/><pre class="programlisting">--<span class="emphasis"><em>snip</em></span>--
&lt;div class="panel-body"&gt;
  &lt;p&gt;&lt;em&gt;By <span class="strong"><strong>&lt;%= link_to text_post.user.name, text_post.user %&gt;</strong></span>&lt;/em&gt;&lt;/p&gt;

  &lt;%= text_post.body %&gt;
&lt;/div&gt;
--<span class="emphasis"><em>snip</em></span>--</pre><p>Then update the <code class="literal">ImagePost</code> partial at
              <span class="emphasis"><em>app/views/image_posts/_image _post.html.erb</em></span>:</p><a id="pro_id00533"/><pre class="programlisting">--<span class="emphasis"><em>snip</em></span>--
&lt;div class="panel-body"&gt;
  &lt;p&gt;&lt;em&gt;By <span class="strong"><strong>&lt;%= link_to image_post.user.name, image_post.user %&gt;</strong></span>&lt;/em&gt;&lt;/p&gt;

  &lt;%= image_tag image_post.url, class: "img-responsive" %&gt;

  &lt;%= image_post.body %&gt;
&lt;/div&gt;
--<span class="emphasis"><em>snip</em></span>--</pre><p><a class="indexterm" id="iddle1087"/><a class="indexterm" id="iddle1101"/><a class="indexterm" id="iddle1139"/><a class="indexterm" id="iddle1203"/><a class="indexterm" id="iddle1711"/><a class="indexterm" id="iddle1715"/>Finally, update the application layout at
              <span class="emphasis"><em>app/views/layouts/application.html.erb</em></span>:</p><a id="pro_id00534"/><pre class="programlisting">--<span class="emphasis"><em>snip</em></span>--
&lt;div class="pull-right"&gt;
  &lt;% if current_user %&gt;
    <span class="strong"><strong>&lt;%= link_to 'Profile', current_user %&gt;</strong></span>
    &lt;%= link_to 'Log Out', logout_path %&gt;
  &lt;% else %&gt;
--<span class="emphasis"><em>snip</em></span>--</pre><p>The application layout already has a check for <code class="literal">current_user</code>. Add
            the <span class="emphasis"><em>Profile</em></span> link inside this conditional.</p></li><li class="listitem"><p>Open <code class="literal">UsersController</code> at
              <span class="emphasis"><em>app/controllers/users_controller.rb</em></span>. Requiring authentication
            before the follow action is a one-line change using the authenticate_user! method you
            wrote in <a class="xref" href="ch09.html" title="Chapter 9. Authentication">Chapter 9</a>.</p><a id="pro_id00535"/><pre class="programlisting">class UsersController &lt; ApplicationController
  <span class="strong"><strong>before_action :authenticate_user!, only: :follow</strong></span>

--<span class="emphasis"><em>snip</em></span>--</pre><p>The only: <code class="literal">:follow</code> option means anonymous users can still access
            the <code class="literal">show, new</code>, and <code class="literal">create</code> actions. Now update the
            user <code class="literal">show</code> view at <span class="emphasis"><em>app/
            views/users/show.html.erb</em></span>. I used two if statements to first verify that
              <code class="literal">current_user</code> is not nil, and then to verify that
              <code class="literal">current_user</code> is not equal to or already following the user being
            displayed.</p><a id="pro_id00536"/><pre class="programlisting">--<span class="emphasis"><em>snip</em></span>--
&lt;p class="lead"&gt;&lt;%= @user.name %&gt;&lt;/p&gt;

<span class="strong"><strong>&lt;% if current_user %&gt;</strong></span>
  <span class="strong"><strong>&lt;% if current_user != @user &amp;&amp; !current_user.following?(@user) %&gt;</strong></span>
    &lt;%= link_to "Follow", follow_user_path(@user),
             class: "btn btn-default" %&gt;
  <span class="strong"><strong>&lt;% end %&gt;</strong></span>
<span class="strong"><strong>&lt;% end %&gt;</strong></span>

&lt;h3&gt;Posts&lt;/h3&gt;
--<span class="emphasis"><em>snip</em></span>--</pre><p>You could have also done this with a single if combining all three of the
            conditional statements.</p></li><li class="listitem"><p>First, open <span class="emphasis"><em>app/controllers/image_posts_controller.rb</em></span>, and add
            methods for the new and create actions and the private image_post_params method. These
            are similar to the corresponding methods in TextPostsController.</p><a id="pro_id00537"/><pre class="programlisting">class ImagePostsController &lt; ApplicationController
  <span class="strong"><strong>def new</strong></span>
    <span class="strong"><strong>@image_post = ImagePost.new</strong></span>
  <span class="strong"><strong>end</strong></span>
  <span class="strong"><strong>def create</strong></span>
    <span class="strong"><strong>@image_post = current_user.image_posts.build(image_post_params)</strong></span>
    <span class="strong"><strong>if @image_post.save</strong></span>
      <span class="strong"><strong>redirect_to post_path(@image_post),</strong></span>
                    <span class="strong"><strong>notice: "Post created!"</strong></span>
    <span class="strong"><strong>else</strong></span>
      <span class="strong"><strong>render :new, alert: "Error creating post."</strong></span>
    <span class="strong"><strong>end</strong></span>
  <span class="strong"><strong>end</strong></span>

  <span class="strong"><strong>private</strong></span>

  <span class="strong"><strong>def image_post_params</strong></span>
    <span class="strong"><strong>params.require(:image_post).permit(:title, :url, :body)</strong></span>
  <span class="strong"><strong>end</strong></span>
end</pre><p><a class="indexterm" id="iddle1128"/><a class="indexterm" id="iddle1134"/><a class="indexterm" id="iddle1875"/>Next, add the new view at
              <span class="emphasis"><em>app/views/image_posts/new.html.erb</em></span>:</p><a id="pro_id00538"/><pre class="programlisting">&lt;div class="page-header"&gt;
  &lt;h1&gt;New Image Post&lt;/h1&gt;
&lt;/div&gt;

&lt;%= render 'form' %&gt;</pre><p>Then add the form partial at
              <span class="emphasis"><em>app/views/image_posts/_form.html.erb</em></span>:</p><a id="pro_id00539"/><pre class="programlisting">&lt;%= form_for @image_post do |f| %&gt;
  &lt;div class="form-group"&gt;
    &lt;%= f.label :title %&gt;
    &lt;%= f.text_field :title, class: "form-control" %&gt;
  &lt;/div&gt;
  &lt;div class="form-group"&gt;
    &lt;%= f.label :url %&gt;
    &lt;%= f.text_field :url, class: "form-control" %&gt;
  &lt;/div&gt;
  &lt;div class="form-group"&gt;
    &lt;%= f.label :body %&gt;
    &lt;%= f.text_area :body, class: "form-control" %&gt;
  &lt;/div&gt;

  &lt;%= f.submit class: "btn btn-primary" %&gt;
  &lt;%= link_to 'Cancel', :back, class: "btn btn-default" %&gt;
&lt;% end %&gt;</pre><p>Finally, add a button to the home page at <span class="emphasis"><em>app/views/posts/index.html.
              erb</em></span> that links to the New Image Post form:</p><a id="pro_id00540"/><pre class="programlisting">--<span class="emphasis"><em>snip</em></span>--
&lt;p&gt;
  &lt;%= link_to "New Text Post", new_text_post_path,
        class: "btn btn-default" %&gt;
  <span class="strong"><strong>&lt;%= link_to "New Image Post", new_image_post_path,</strong></span>
        <span class="strong"><strong>class: "btn btn-default" %&gt;</strong></span>
&lt;/p&gt;
--<span class="emphasis"><em>snip</em></span>--</pre></li></ol></div><p><a class="indexterm" id="iddle1088"/>Refer back to <a class="xref" href="ch10.html#create_post" title="Create Post">Create Post</a> if you have any questions about
        these actions or views.</p></div><div class="sect1" title="Chapter 11"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_11"/>Chapter 11</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>First, add methods for the <code class="literal">edit</code> and <code class="literal">update</code>
            actions to the <code class="literal">ImagePostsController</code> at
              <span class="emphasis"><em>app/controllers/image_posts_controller.rb,</em></span> as shown here:</p><a id="pro_id00541"/><pre class="programlisting">--<span class="emphasis"><em>snip</em></span>--

<span class="strong"><strong>def edit</strong></span>

  <span class="strong"><strong>@image_post = current_user.image_posts.find(params[:id])</strong></span>
<span class="strong"><strong>end</strong></span>

  <span class="strong"><strong>def update</strong></span>
    <span class="strong"><strong>@image_post = current_user.image_posts.find(params[:id])</strong></span>
    <span class="strong"><strong>if @image_post.update(image_post_params)</strong></span>
      <span class="strong"><strong>redirect_to post_path(@image_post), notice: "Post updated!"</strong></span>
    <span class="strong"><strong>else</strong></span>
      <span class="strong"><strong>render :edit, alert: "Error updating post."</strong></span>
    <span class="strong"><strong>end</strong></span>
  <span class="strong"><strong>end</strong></span>

  private

  def image_post_params
    params.require(:image_post).permit(:title, :body, :url)
  end
end</pre><p>Next, create the <code class="literal">edit</code> view at
              <span class="emphasis"><em>app/views/image_posts/edit.html.erb</em></span>:</p><a id="pro_id00542"/><pre class="programlisting">&lt;div class="page-header"&gt;
  &lt;h1&gt;Edit Image Post&lt;/h1&gt; &lt;/div&gt;
&lt;%= render 'form' %&gt;</pre><p>This view uses the form partial you created in <a class="xref" href="ch10.html" title="Chapter 10. Testing">Chapter 10</a>. Finally,
            add a link to the <code class="literal">edit</code> action in the <code class="literal">ImagePost</code>
            partial at <span class="emphasis"><em>app/views/image _posts/_image_post.html.erb</em></span>:</p><a id="pro_id00543"/><pre class="programlisting">--<span class="emphasis"><em>snip</em></span>--
&lt;%= image_post.body %&gt;
    <span class="strong"><strong>&lt;% if image_post.user == current_user %&gt;</strong></span>
      <span class="strong"><strong>&lt;p&gt;</strong></span>
      <span class="strong"><strong>&lt;%= link_to 'Edit', edit_image_post_path(image_post),</strong></span>
            <span class="strong"><strong>class: "btn btn-default" %&gt;</strong></span>
      <span class="strong"><strong>&lt;/p&gt;</strong></span>
    <span class="strong"><strong>&lt;% end %&gt;</strong></span>
  &lt;/div&gt;
&lt;/div&gt;</pre><p><a class="indexterm" id="iddle1084"/><a class="indexterm" id="iddle1094"/><a class="indexterm" id="iddle1125"/><a class="indexterm" id="iddle1488"/>This link is wrapped in a conditional so it only appears if this image post
            was created by the current user.</p></li><li class="listitem"><p>Update the <code class="literal">PostsController</code> at
              <span class="emphasis"><em>app/controllers/posts_controller.rb,</em></span> as shown in the
            question.</p><a id="pro_id00544"/><pre class="programlisting">  --<span class="emphasis"><em>snip</em></span>--

  def show
    @post = Post.find(params[:id])
    <span class="strong"><strong>@can_moderate = (current_user == @post.user)</strong></span>
  end
end</pre><p>Now edit the comment partial at
              <span class="emphasis"><em>app/views/comments/_comment.html.erb</em></span> and add a link to destroy
            the comment when the <code class="literal">@can_moderate</code> instance variable is
              <code class="literal">true</code>:</p><a id="pro_id00545"/><pre class="programlisting">&lt;p&gt;&lt;em&gt;&lt;%= comment.user.name %&gt; said:&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;%= comment.body %&gt;&lt;/p&gt;
&lt;% if @can_moderate %&gt;
  <span class="strong"><strong>&lt;p&gt;</strong></span>
  <span class="strong"><strong>&lt;%= link_to 'Destroy', comment_path(comment),</strong></span>
        <span class="strong"><strong>method: :delete, class: "btn btn-default" %&gt;</strong></span>
  <span class="strong"><strong>&lt;/p&gt;</strong></span>
<span class="strong"><strong>&lt;% end %&gt;</strong></span></pre><p>Be sure to add <code class="literal">method: :delete</code> to the link so the
              <code class="literal">destroy</code> action is called. Finally, add the
              <code class="literal">destroy</code> action to the <code class="literal">CommentsController</code> at
              <span class="emphasis"><em>app/ controllers/comments_controller.rb</em></span>:</p><a id="pro_id00546"/><pre class="programlisting">--<span class="emphasis"><em>snip</em></span>--

<span class="strong"><strong>def destroy</strong></span>
  <span class="strong"><strong>@comment = Comment.find(params[:id])</strong></span>

  <span class="strong"><strong>if @comment.destroy</strong></span>
    <span class="strong"><strong>redirect_to post_path(@comment.post_id),</strong></span>
                <span class="strong"><strong>notice: 'Comment successfully destroyed.'</strong></span>
  <span class="strong"><strong>else</strong></span>
    <span class="strong"><strong>redirect_to post_path(@comment.post_id),</strong></span>
                <span class="strong"><strong>alert: 'Error destroying comment.'</strong></span>
  <span class="strong"><strong>end</strong></span>
<span class="strong"><strong>end</strong></span>
  private

  def comment_params
    params.require(:comment).permit(:body, :post_id)
  end
end</pre><p><a class="indexterm" id="iddle1347"/><a class="indexterm" id="iddle1369"/><a class="indexterm" id="iddle2161"/>This method finds the comment, calls <code class="literal">destroy</code>, and
            redirects back to the post with a message indicating success or failure.</p></li><li class="listitem"><p>Open the routes file at <span class="emphasis"><em>config/routes.rb</em></span> and edit at the
              <code class="literal">logout</code> route:</p><a id="pro_id00547"/><pre class="programlisting">  --<span class="emphasis"><em>snip</em></span>--
  get 'login', to: 'sessions#new', as: 'login'
  <span class="strong"><strong>delete</strong></span> 'logout', to: 'sessions#destroy', as: 'logout'

  root 'posts#index'
end</pre><p>Edit the application layout at
              <span class="emphasis"><em>app/views/layouts/application.html.erb</em></span> and add <code class="literal">method:
              :delete</code> to the <span class="emphasis"><em>Log Out</em></span> link.</p><a id="pro_id00548"/><pre class="programlisting">--<span class="emphasis"><em>snip</em></span>--

&lt;div class="pull-right"&gt;
  &lt;% if current_user %&gt;
    &lt;%= link_to 'Profile', current_user %&gt;
    &lt;%= link_to 'Log Out', logout_path<span class="strong"><strong>, method: :delete</strong></span> %&gt;
  &lt;% else %&gt;
--<span class="emphasis"><em>snip</em></span>--</pre></li></ol></div><p>Now the link issues a DELETE request to log out of the application.</p></div><div class="sect1" title="Chapter 12"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_12"/>Chapter 12</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>The show page loads the collection of comments to render and then loads the owner of
            each comment individually as the comments are rendered. You can eager load the comments
            and the owners for a post by adding <code class="literal">includes(comments: [:user])</code> in
            the <code class="literal">show</code> method in the <code class="literal">PostsController</code> at
              <span class="emphasis"><em>app/controllers/posts_controller.rb:</em></span></p><a id="pro_id00549"/><pre class="programlisting">--<span class="emphasis"><em>snip</em></span>--

  def show
    @post = Post<span class="strong"><strong>.includes(comments: [:user])</strong></span>.find(params[:id]) ➊
    @can_moderate = (current_user == @post.user)
  end
end</pre><p>Adding <code class="literal">includes(comments: [:user])</code> tells Rails to eager load the
            comments for this post and all users associated with those comments.</p></li><li class="listitem"><p><a class="indexterm" id="iddle1126"/><a class="indexterm" id="iddle1157"/><a class="indexterm" id="iddle1280"/>Open the <code class="literal">Comment</code> partial at
              <span class="emphasis"><em>app/views/comments/_comment.html.erb</em></span> and add the cache
            block:</p><a id="pro_id00550"/><pre class="programlisting">&lt;% cache [comment, @can_moderate] do %&gt; ➊
  &lt;p&gt;&lt;em&gt;&lt;%= comment.user.name %&gt; said:&lt;/em&gt;&lt;/p&gt;
  &lt;p&gt;&lt;%= comment.body %&gt;&lt;/p&gt;
  &lt;% if @can_moderate %&gt;
    &lt;p&gt;
      &lt;%= link_to 'Destroy', comment_path(comment),
            method: :delete, class: "btn btn-default" %&gt;
    &lt;/p&gt;
  &lt;% end %&gt;
<span class="strong"><strong>&lt;% end %&gt;</strong></span></pre><p>Passing an array to the <code class="literal">cache</code> method creates a cache key that
            combines the elements in the array ➊. In this case, the cache key contains the
            values of the comment’s <code class="literal">id</code> and <code class="literal">updated_at</code>
            fields and the value of <code class="literal">@can_moderate</code>, either true or false.</p></li><li class="listitem"><p>Open the show page at <span class="emphasis"><em>app/views/posts/show.html.erb</em></span> and add the
              <code class="literal">cache</code> block.</p><a id="pro_id00551"/><pre class="programlisting">--<span class="emphasis"><em>snip</em></span>--

&lt;h3&gt;Comments&lt;/h3&gt;
<span class="strong"><strong>&lt;% cache [@post, 'comments', @can_moderate] do %&gt;</strong></span> ➊
  &lt;%= render @post.comments %&gt;
<span class="strong"><strong>&lt;% end %&gt;</strong></span>

<span class="emphasis"><em>--snip--</em></span></pre><p>This creates a cache key that is a combination of the cache key for
              <code class="literal">@post</code>, the word “comments,” and the value of
              <code class="literal">@can_moderate</code> ➊. Now the comments collection is displayed
            after a single read from the cache.</p></li></ol></div></div><div class="sect1" title="Chapter 13"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_13"/>Chapter 13</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>You need to update the view partials for both types of posts for this exercise.
            First, edit the file <span class="emphasis"><em>app/views/text_posts/_text_post.html.erb</em></span> and
            add a <code class="literal">debug</code> call near the bottom, as shown here:</p><a id="pro_id00552"/><pre class="programlisting">&lt;div class="panel panel-default"&gt;
  --<span class="emphasis"><em>snip</em></span>--

    &lt;%= debug text_post %&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre><p><a class="indexterm" id="iddle1091"/><a class="indexterm" id="iddle1095"/><a class="indexterm" id="iddle1142"/><a class="indexterm" id="iddle1463"/>Then edit <span class="emphasis"><em>app/views/link_posts/_link_post.html.erb</em></span> and
            add a <code class="literal">debug</code> call near the bottom:</p><a id="pro_id00553"/><pre class="programlisting">&lt;div class="panel panel-default"&gt;
  --<span class="emphasis"><em>snip</em></span>--

    &lt;%= debug link_post %&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre></li><li class="listitem"><p>The easiest way to add the id and type of each post to the log is by iterating over
            the contents of the <code class="literal">@posts</code> instance variable. Edit
              <span class="emphasis"><em>app/controllers/ posts_controller.rb</em></span> and update the
              <code class="literal">index</code> action.</p><a id="pro_id00554"/><pre class="programlisting">class PostsController &lt; ApplicationController
  before_action :authenticate_user!

  def index
    user_ids = current_user.timeline_user_ids
    @posts = Post.includes(:user).where(user_id: user_ids)
               .paginate(page: params[:page], per_page: 5)
               .order("created_at DESC")

    <span class="strong"><strong>@posts.each do |post|</strong></span>
      <span class="strong"><strong>logger.debug "Post #{post.id} is a #{post.type}"</strong></span>
    <span class="strong"><strong>end</strong></span>
  end
--<span class="emphasis"><em>snip</em></span>--</pre><p>Now when you refresh the posts index page, you should see five lines similar to
            “Post 5 is a TextPost” in the log.</p></li><li class="listitem"><p>To debug what happens when a user logs in to the application, you need to add a
              <code class="literal">debugger</code> call to the create action in <span class="emphasis"><em>app/controllers/
              sessions_controller.rb</em></span>:</p><a id="pro_id00555"/><pre class="programlisting">class SessionsController &lt; ApplicationController
  --<span class="emphasis"><em>snip</em></span>--

  def create
    <span class="strong"><strong>debugger</strong></span>
    user = User.find_by(email: params[:email])
    if user &amp;&amp; user.authenticate(params[:password])
      session[:user_id] = user.id
      redirect_to root_url, :notice =&gt; "Logged in!"
    else
      flash.now.alert = "Invalid email or password"
      render "new"
    end
  end

  --<span class="emphasis"><em>snip</em></span>--</pre></li></ol></div><p><a class="indexterm" id="iddle1078"/><a class="indexterm" id="iddle1416"/>With this line in place, you can examine the <code class="literal">params</code> sent to
        this action, the current contents of the <code class="literal">session</code>, and the value of
          <code class="literal">user</code> as you move through this action.</p></div><div class="sect1" title="Chapter 14"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_14"/>Chapter 14</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>This <code class="literal">curl</code> command is the same one you used earlier to create a
            new post, except I replaced the <span class="emphasis"><em>token</em></span> with the word
              <code class="literal">fake</code>.</p><a id="pro_id00556"/><pre class="programlisting">$ <span class="strong"><strong>curl -i \</strong></span>
       <span class="strong"><strong>-d '{"text_post":{"title":"Test","body":"Hello"}}' \</strong></span>
       <span class="strong"><strong>-H "Content-Type: application/json" \</strong></span>
       <span class="strong"><strong>-H "Authorization: Token fake" \</strong></span>
       <span class="strong"><strong>http://localhost:3000/api/text_posts</strong></span>

HTTP/1.1 401 Unauthorized
--<span class="emphasis"><em>snip</em></span>--

HTTP Token: Access denied.</pre><p>Note that the status code is <span class="emphasis"><em>401 Unauthorized</em></span> and the body
            contains the text <code class="literal">"HTTP Token: Access denied."</code></p></li><li class="listitem"><p>Text posts validate the presence of a body, so use <code class="literal">curl</code> to
            attempt to create a text post without specifying a body.</p><a id="pro_id00557"/><pre class="programlisting">$ <span class="strong"><strong>curl -i \</strong></span>
       <span class="strong"><strong>-d '{"text_post":{"title":"Test"}}' \</strong></span>
       <span class="strong"><strong>-H "Content-Type: application/json" \</strong></span>
       <span class="strong"><strong>-H "Authorization: Token <span class="emphasis"><em>token"</em></span> \</strong></span>
       <span class="strong"><strong>http://localhost:3000/api/text_posts</strong></span>
HTTP/1.1 422 Unprocessable Entity
--<span class="emphasis"><em>snip</em></span>--

{"errors":{"body":["can't be blank"]}}</pre><p>Note that the status code is <span class="emphasis"><em>422 Unprocessable Entity</em></span> and the
            body contains a JSON representation of the errors.</p></li><li class="listitem"><p>Add the <code class="literal">show</code> method to
              <span class="emphasis"><em>app/controllers/api/posts_controller.rb</em></span>:</p><a id="pro_id00558"/><pre class="programlisting">module Api
  class PostsController &lt; ApplicationController
    respond_to :json

    --<span class="emphasis"><em>snip</em></span>--

    <span class="strong"><strong>def show</strong></span>
      <span class="strong"><strong>@post = Post.find(params[:id])</strong></span>
      <span class="strong"><strong>respond_with @post</strong></span>
    <span class="strong"><strong>end</strong></span>
  end
end</pre><p>This method finds the requested post and assigns it to the <code class="literal">@post</code>
            instance variable and then responds with that post. The following
              <code class="literal">curl</code> command verifies that this action is working:</p><a id="pro_id00559"/><pre class="programlisting">$ <span class="strong"><strong>curl http://localhost:3000/api/posts/1</strong></span>
{
  "id":1,
  "title":"First Post",
  "body":"Hello, World!",
  "url":null,
  "user_id":1,
  "created_at":"2014-04-22T00:56:48.188Z",
  "updated_at":"2014-04-22T00:56:48.188Z"
}</pre></li></ol></div><p>Because you didn’t create a jbuilder view for this action, the default JSON
        representation for posts is returned.</p></div><div class="sect1" title="Chapter 15"><div class="titlepage"><div><div><h1 class="title"><a id="chapter_15"/>Chapter 15</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Edit the file <span class="emphasis"><em>app/views/layouts/application.html.erb</em></span> to change
            the title of each page:</p><a id="pro_id00560"/><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;<span class="strong"><strong>My Awesome Site</strong></span>&lt;/title&gt;
  --<span class="emphasis"><em>snip</em></span>--</pre><p>After you save this change, add it to your local Git repositories staging area, and
            then commit the change with an appropriate <code class="literal">commit</code> message.</p><a id="pro_id00561"/><pre class="programlisting">$ <span class="strong"><strong>git add .</strong></span>
$ <span class="strong"><strong>git commit -m "Update title"</strong></span></pre><p>Now deploy your change by entering <span class="strong"><strong><code class="literal">bin/cap
                production deploy</code></strong></span> in your terminal.</p></li><li class="listitem"><p>The Ruby Toolbox at <span class="emphasis"><em><a class="ulink" href="https://www.ruby-toolbox.com/">https://www.ruby-toolbox.com/</a></em></span> lists hundreds of gems you can use to add features to your application.
            For example, you can let users upload files to your application. Check the Rails File
            Uploads category to find several choices, including Paperclip and CarrierWave. From
            there, you can visit the website, read the documentation, and see the source code for
            each project.</p></li><li class="listitem"><p>Go to <span class="emphasis"><em><a class="ulink" href="https://github.com/rails/rails/">https://github.com/rails/rails/</a></em></span> to join
            the discussion on open issues and pull requests, and see previous commits. Ruby on Rails
            has a page at <span class="emphasis"><em><a class="ulink" href="http://rubyonrails.org/community/">http://rubyonrails.org/community/</a></em></span> for
            those looking to get involved online. You can learn about upcoming Ruby and Rails
            conferences at <span class="emphasis"><em><a class="ulink" href="http://rubyconf.org/">http://rubyconf.org/</a></em></span> and
                <span class="emphasis"><em><a class="ulink" href="http://railsconf.com,/">http://railsconf.com,/</a></em></span> respectively. I hope to
            see you there!<a class="indexterm" id="iddle1140"/><a class="indexterm" id="iddle1240"/><a class="indexterm" id="iddle1606"/><a class="indexterm" id="iddle2129"/><a class="indexterm" id="iddle2130"/><a class="indexterm" id="iddle2332"/></p></li></ol></div></div></div></body></html>