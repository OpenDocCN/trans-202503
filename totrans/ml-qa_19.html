<html><head></head><body>
<div id="book-content">
<div id="sbo-rt-content"><h2 class="h2" id="ch16"><span epub:type="pagebreak" id="page_99"/><strong><span class="big">16</span><br/>SELF-ATTENTION</strong></h2>&#13;
<div class="image1"><img src="../images/common.jpg" alt="Image" width="252" height="252"/></div>&#13;
<p class="noindent">Where does self-attention get its name, and how is it different from previously developed attention mechanisms?</p>&#13;
<p class="indent"><em>Self-attention</em> enables a neural network to refer to other portions of the input while focusing on a particular segment, essentially allowing each part the ability to “attend” to the whole input. The original attention mechanism developed for recurrent neural networks (RNNs) is applied between two different sequences: the encoder and the decoder embeddings. Since the attention mechanisms used in transformer-based large language models is designed to work on all elements of the same set, it is known as <em>self</em>-attention.</p>&#13;
<p class="indent">This chapter first discusses an earlier attention mechanism developed for RNNs, the Bahdanau mechanism, in order to illustrate the motivation behind developing attention mechanism. We then compare the Bahdanau mechanism to the self-attention mechanism prevalent in transformer architectures today.</p>&#13;
<h3 class="h3" id="ch00lev80"><strong>Attention in RNNs</strong></h3>&#13;
<p class="noindent">One example of an attention mechanism used in RNNs to handle long sequences is <em>Bahdanau attention</em>. Bahdanau attention was developed to make machine learning models, particularly those used in translating languages, better at understanding long sentences. Before this type of attention, the <span epub:type="pagebreak" id="page_100"/>whole input (such as a sentence in English) was squashed into a single chunk of information, and important details could get lost, especially if the sentence was long.</p>&#13;
<p class="indent">To understand the difference between regular attention and self-attention, let’s begin with the illustration of the Bahdanau attention mechanism in <a href="ch16.xhtml#ch16fig1">Figure 16-1</a>.</p>&#13;
<div class="image"><img id="ch16fig1" src="../images/16fig01.jpg" alt="Image" width="451" height="507"/></div>&#13;
<p class="figcap"><em>Figure 16-1: The Bahdanau mechanism uses a separate RNN to compute attention weights.</em></p>&#13;
<p class="indent">In <a href="ch16.xhtml#ch16fig1">Figure 16-1</a>, the <em>α</em> values represent the attention weights for the second sequence element and each other element in the sequence from 1 to <em>T</em>. Furthermore, this original attention mechanism involves two RNNs. The RNN at the bottom, computing the attention weights, represents the encoder, while the RNN at the top, producing the output sequence, is a decoder.</p>&#13;
<p class="indent">In short, the original attention mechanism developed for RNNs is applied between two different sequences: the encoder and decoder embeddings. For each generated output sequence element, the decoder RNN at the top is based on a hidden state plus a context vector generated by the encoder. This context vector involves <em>all</em> elements of the input sequence and is a weighted sum of all input elements where the attention scores (<em>α</em>’s) represent the weighting coefficients. This allows the decoder to access all input sequence elements (the context) at each step. The key idea is that the attention weights (and context) may differ and change dynamically at each step.</p>&#13;
<p class="indent">The motivation behind this complicated encoder-decoder design is that we cannot translate sentences word by word. This would result in grammatically incorrect outputs, as illustrated by the RNN architecture (a) in <a href="ch16.xhtml#ch16fig2">Figure 16-2</a>.<span epub:type="pagebreak" id="page_101"/></p>&#13;
<div class="image"><img id="ch16fig2" src="../images/16fig02.jpg" alt="Image" width="1003" height="444"/></div>&#13;
<p class="figcap"><em>Figure 16-2: Two RNN architecture designs for translating text</em></p>&#13;
<p class="indent"><a href="ch16.xhtml#ch16fig2">Figure 16-2</a> shows two different sequence-to-sequence RNN designs for sentence translation. <a href="ch16.xhtml#ch16fig2">Figure 16-2</a>(a) represents a regular sequence-to-sequence RNN that may be used to translate a sentence from German to English word by word. <a href="ch16.xhtml#ch16fig2">Figure 16-2</a>(b) depicts an encoder-decoder RNN that first reads the whole sentence before translating it.</p>&#13;
<p class="indent">RNN architecture (a) is best suited for time series tasks in which we want to make one prediction at a time, such as predicting a given stock price day by day. For tasks like language translation, we typically opt for an encoder-decoder RNN, as in architecture (b) in <a href="ch16.xhtml#ch16fig2">Figure 16-2</a>. Here, the RNN encodes the input sentence, stores it in an intermediate hidden representation, and generates the output sentence. However, this creates a bottleneck where the RNN has to memorize the whole input sentence via a single hidden state, which does not work well for longer sequences.</p>&#13;
<p class="indent">The bottleneck depicted in architecture (b) prompted the Bahdanau attention mechanism’s original design, allowing the decoder to access all elements in the input sentence at each time step. The attention scores also give different weights to the different input elements depending on the current word that the decoder generates. For example, when generating the word <em>help</em> in the output sequence, the word <em>helfen</em> in the German input sentence may get a large attention weight, as it’s highly relevant in this context.</p>&#13;
<h3 class="h3" id="ch00lev81"><strong>The Self-Attention Mechanism</strong></h3>&#13;
<p class="noindent">The Bahdanau attention mechanism relies on a somewhat complicated encoder-decoder design to model long-term dependencies in sequence-to-sequence language modeling tasks. Approximately three years after the Bahdanau mechanism, researchers worked on simplifying sequence-to-sequence modeling architectures by asking whether the RNN backbone was even needed to achieve good language translation performance. This led to the design of the original transformer architecture and self-attention mechanism.<span epub:type="pagebreak" id="page_102"/></p>&#13;
<p class="indent">In self-attention, the attention mechanism is applied between all elements in the same sequence (as opposed to involving two sequences), as depicted in the simplified attention mechanism in <a href="ch16.xhtml#ch16fig3">Figure 16-3</a>. Similar to the attention mechanism for RNNs, the context vector is an attention-weighted sum over the input sequence elements.</p>&#13;
<div class="image"><img id="ch16fig3" src="../images/16fig03.jpg" alt="Image" width="645" height="382"/></div>&#13;
<p class="figcap"><em>Figure 16-3: A simple self-attention mechanism without weight matrices</em></p>&#13;
<p class="indent">While <a href="ch16.xhtml#ch16fig3">Figure 16-3</a> doesn’t include weight matrices, the self-attention mechanism used in transformers typically involves multiple weight matrices to compute the attention weights.</p>&#13;
<p class="indent">This chapter laid the groundwork for understanding the inner workings of transformer models and the attention mechanism. The next chapter covers the different types of transformer architectures in more detail.<span epub:type="pagebreak" id="page_103"/></p>&#13;
<h3 class="h3" id="ch00lev82"><strong>Exercises</strong></h3>&#13;
<p class="number1"><strong>16-1.</strong> Considering that self-attention compares each sequence element with itself, what is the time and memory complexity of self-attention?</p>&#13;
<p class="number1"><strong>16-2.</strong> We discussed self-attention in the context of natural language processing. Could this mechanism be useful for computer vision applications as well?</p>&#13;
<h3 class="h3" id="ch00lev83"><strong>References</strong></h3>&#13;
<ul>&#13;
<li class="noindent">The paper introducing the original self-attention mechanism, also known as <em>scaled dot-product</em> attention: Ashish Vaswani et al., “Attention Is All You Need” (2017), <em><a href="https://arxiv.org/abs/1706.03762">https://arxiv.org/abs/1706.03762</a></em>.</li>&#13;
<li class="noindent">The Bahdanau attention mechanism for RNNs: Dzmitry Bahdanau, Kyunghyun Cho, and Yoshua Bengio, “Neural Machine Translation by Jointly Learning to Align and Translate” (2014), <em><a href="https://arxiv.org/abs/1409.0473">https://arxiv.org/abs/1409.0473</a></em>.</li>&#13;
<li class="noindent">For more about the parameterized self-attention mechanism, check out my blog post: “Understanding and Coding the Self-Attention Mechanism of Large Language Models from Scratch” at <em><a href="https://sebastianraschka.com/blog/2023/self-attention-from-scratch.html">https://sebastianraschka.com/blog/2023/self-attention-from-scratch.html</a></em>.<span epub:type="pagebreak" id="page_104"/></li>&#13;
</ul>&#13;
</div>
</div>
</body></html>