<html><head></head><body>
<h2 class="h2" id="ch04"><span epub:type="pagebreak" id="page_59"/><strong><span class="big">4</span><br/>MULTIPLICATION STATION: MAKING DECISIONS WITH CODE</strong></h2>
<div class="imagel"><img alt="Image" src="../images/common.jpg"/></div>
<p class="noindent">In programming, you can use three structures to control the flow of a program: sequence, selection, and repetition. With the <em>sequence structure</em>, which is the default and simplest of the three options, code is executed in order, line by line. So far you’ve been using the sequence structure to create apps.</p>
<p class="indent">Unlike the sequence structure, the <em>selection</em> or <em>conditional structure</em> enables an app to make decisions by testing for a condition with a Boolean expression. A Boolean expression evaluates to a Boolean value, using <em>relational</em> or <em>comparison</em> operators like =, ≤, and ≥, to test the conditions. Because a Boolean value can only be either true or false, we execute one sequence of code if the condition is true and another if it’s false.</p>
<p class="indent">The <em>repetition structure</em> also tests a Boolean condition and runs a sequence of code repeatedly while the condition is true, which is called <em>looping</em>. We’ll use the repetition structure in <a href="ch06.xhtml#ch06">Chapter 6</a>.</p>
<h3 class="h3" id="ch00lev1sec26"><span epub:type="pagebreak" id="page_60"/><strong>THE SELECTION CONTROL STRUCTURE</strong></h3>
<p class="noindent">In this chapter, we’ll program apps to make decisions by comparing conditions using the <span class="literal">if then</span> blocks in the Control blocks drawer. We’ll combine them with comparison operator blocks from the Logic and Math drawers to compare values. Then, we’ll execute different blocks of code depending on whether the comparisons are true or false.</p>
<h4 class="h4" id="ch00lev2sec26"><strong>USING AN IF THEN BLOCK IN THE “FRUIT LOOT” GAME</strong></h4>
<p class="noindent">In the “Fruit Loot” game in <a href="ch03.xhtml#ch03">Chapter 3</a>, we could have used an <span class="literal">if then</span> block to streamline some of our code. Remember that we programmed the action the app should take when an <span class="literal">ImageSprite</span> hits the picker, as shown here.</p>
<div class="image"><img alt="Image" src="../images/f0060-01.jpg"/></div>
<p class="indent">We should have included code in this event handler to make any sprite that collided with the picker disappear. But we couldn’t, because we didn’t yet know how to use the selection control structure to figure out exactly which sprite hit the picker and hide it.</p>
<p class="indent">Instead, we repeated <span class="literal">CollidedWith</span> event handlers for each fruit <span class="literal">ImageSprite</span>.</p>
<div class="image"><img alt="Image" src="../images/f0060-02.jpg"/></div>
<p class="indent">That’s a lot of blocks! With the selection control structure, however, we don’t have to use three duplicate fruit <span class="literal">ImageSprite CollidedWith</span> event handlers to figure out which fruit <span class="literal">ImageSprite</span> hit the picker and make it disappear.</p>
<p class="indent"><span epub:type="pagebreak" id="page_61"/>Here is the <em>pseudocode</em>, or simple, plain English version of the code that determines which sprite hit the picker:</p>
<p class="programs">If <span class="red">(the sprite that hit PickerSprite is FruitSprite1)</span><br/>    then <span class="blue">(hide FruitSprite1)</span>.<br/>If not, if <span class="red">(the sprite that hit PickerSprite is FruitSprite2)</span><br/>    then <span class="blue">(hide FruitSprite2)</span>.<br/>If not,<br/>    <span class="green1">(hide FruitSprite3)</span>.</p>
<p class="indent">To re-create this pseudocode, we’ll add an <span class="literal">if then</span> block to the picker <span class="literal">ImageSprite</span>’s <span class="literal">CollidedWith</span> event handler, as shown in <a href="ch04.xhtml#ch4fig1">Figure 4-1</a>.</p>
<div class="image" id="ch4fig1"><img alt="Image" src="../images/04fig01.jpg"/></div>
<p class="figcap"><em>Figure 4-1: “Fruit Loot” blocks to find and hide the <span class="codeitalic">ImageSprite</span> that hits the picker</em></p>
<p class="indent">To add the new blocks, go to the “Fruit Loot” game Blocks Editor and place the <span class="codestrong">if then</span> block <span class="ent">➊</span> inside the <span class="codestrong">whenPickerSprite.CollidedWith</span> block next to the word <span class="literal">do</span>.</p>
<p class="indent">You should see that the default <span class="literal">if then</span> block allows only one <span class="literal">if</span> and one <span class="literal">then</span> input. To add more inputs, click the blue mutator icon to the left of <span class="literal">if</span>, as shown in <a href="ch04.xhtml#ch4fig2">Figure 4-2</a>.</p>
<div class="image" id="ch4fig2"><img alt="Image" src="../images/04fig02.jpg"/></div>
<p class="figcap"><em>Figure 4-2: Adding <span class="codeitalic">else if</span> and <span class="codeitalic">else</span> sockets to the <span class="codeitalic">if then</span> block</em></p>
<p class="indent">In the dialog that opens, drag an <span class="codestrong">else if</span> block and then an <span class="codestrong">else</span> block into the <span class="codestrong">if</span> block.</p>
<h5 class="h5" id="ch00lev3sec32"><span epub:type="pagebreak" id="page_62"/><strong>Checking Whether Colliding Fruit Is FruitSprite1</strong></h5>
<p class="noindent">The <span class="literal">PickerSprite</span>’s <span class="literal">CollidedWith</span> event handler provides the <span class="literal">other</span> event parameter, which represents the fruit <span class="literal">ImageSprite</span> that collided with the picker. Whenever an <span class="literal">ImageSprite</span> hits the picker, you compare <span class="literal">other</span> to <span class="literal">FruitSprite1</span> to determine if <span class="literal">FruitSprite1</span> is the sprite that hit the picker. If so, the blocks set the <span class="literal">Visible</span> property of <span class="literal">FruitSprite1</span> to <span class="literal">false</span> to make it disappear.</p>
<p class="indent">To place the blocks for this behavior, from the Logic blocks drawer, drag in an <span class="codestrong">=</span> comparison operator block <span class="ent">➋</span> next to the word <span class="literal">if</span>. To fill the <span class="literal">=</span> block’s operand sockets, mouse over the <span class="literal">other</span> event parameter above the mutator icon until you see a <span class="literal">get other</span> block <span class="ent">➌</span>, then drag that block into the left socket. Then click <span class="codestrong">FruitSprite1</span> in the Blocks pane and drag the <span class="codestrong">FruitSprite1</span> block <span class="ent">➍</span> into the right socket. Next, in the Blocks pane, click <span class="codestrong">FruitSprite1</span> again and drag in the <span class="codestrong">setFruitSprite1.Visibleto</span> block <span class="ent">➎</span> next to the word <span class="literal">then</span>. Finally, snap a <span class="codestrong">false</span> block <span class="ent">➏</span> from the Logic blocks drawer to the right of the <span class="codestrong">setFruitSprite1.Visibleto</span> block.</p>
<h5 class="h5" id="ch00lev3sec33"><strong>Checking Whether Colliding Fruit Is FruitSprite2</strong></h5>
<p class="noindent">If <span class="literal">FruitSprite1</span> is not the fruit that hit the picker, we check for our second condition by comparing <span class="literal">other</span> to <span class="literal">FruitSprite2</span>. Copy the blocks at <span class="ent">➋</span> through <span class="ent">➍</span> in <a href="ch04.xhtml#ch4fig1">Figure 4-1</a>, place the duplicate blocks next to the words <span class="literal">else if</span>, and use the drop-down arrow to change <span class="codestrong">FruitSprite1</span> to <span class="codestrong">FruitSprite2</span> in the right operand socket of the duplicate <span class="literal">=</span> comparison operator block.</p>
<p class="indent">Then copy the blocks at <span class="ent">➎</span> and <span class="ent">➏</span>, place the duplicate blocks next to the word <span class="literal">then</span>, and use the drop-down arrow to change <span class="codestrong">FruitSprite1</span> to <span class="codestrong">FruitSprite2</span> in the duplicate setter block. Now, when an <span class="literal">ImageSprite</span> other than <span class="literal">FruitSprite1</span> hits the picker, these blocks compare <span class="literal">other</span> to <span class="literal">FruitSprite2</span> to determine if <span class="literal">FruitSprite2</span> is the sprite that hit the picker. If so, these blocks set its <span class="literal">Visible</span> property to <span class="literal">false</span> to make it disappear.</p>
<h5 class="h5" id="ch00lev3sec34"><strong>Checking Whether Colliding Fruit Is FruitSprite3</strong></h5>
<p class="noindent">Finally, copy the blocks at <span class="ent">➎</span> and <span class="ent">➏</span> again, place the duplicate blocks next to the word <span class="literal">else</span>, and use the drop-down arrow to change <span class="codestrong">FruitSprite1</span> to <span class="codestrong">FruitSprite3</span> in the duplicate setter block. These last two blocks should execute only if neither <span class="literal">FruitSprite1</span> nor <span class="literal">FruitSprite2</span> matches <span class="literal">other</span> as the fruit <span class="literal">ImageSprite</span> that collided with the picker. In that case, <span class="literal">FruitSprite3</span>, the only sprite left, must have hit the picker and will disappear.</p>
<p class="indent">Instead of creating three different <span class="literal">CollidedWith</span> event handlers for the fruit <span class="literal">ImageSprite</span>s, we refactor our code and use one <span class="literal">if then</span> block to handle multiple conditions. You now can delete the three original <span class="literal">CollidedWith</span> event handlers for the fruit <span class="literal">ImageSprites</span>, and, when you test the “Fruit Loot” app, it should work exactly the same.</p>
<h3 class="h3" id="ch00lev1sec27"><strong>BUILDING THE “MULTIPLICATION STATION” APP</strong></h3>
<p class="noindent">Now that you’ve seen how <span class="literal">if then</span> blocks work, let’s create the “Multiplication Station” quiz app. To build the app, you’ll use <span class="literal">if then</span> blocks, along with the <span epub:type="pagebreak" id="page_63"/><span class="literal">Clock</span> timer, random numbers, and arithmetic operators to generate multiplication problems. You’ll also learn how to create an app that has more than one screen and experiment with the <span class="literal">TextToSpeech</span> and <span class="literal">Notifier</span> components to communicate with app users.</p>
<p class="indent">Log into App Inventor, create a new project, name it <span class="codestrong">MultiplicationStation</span>, and click <strong>OK</strong>.</p>
<h3 class="h3" id="ch00lev1sec28"><strong>DECOMPOSING “MULTIPLICATION STATION”</strong></h3>
<p class="noindent">We can decompose the “Multiplication Station” app into five steps:</p>
<ol>
<li><p class="noindent">When the user opens the app, play a welcome message and show the start button.</p></li>
<li><p class="noindent">When the user clicks the start button, open the practice screen.</p></li>
<li><p class="noindent">When the <span class="literal">Clock</span> timer fires, display a random multiplication problem and an empty text box for the user to input the answer, and add 1 to the total number of problems.</p></li>
<li><p class="noindent">When the user clicks the check answer button, check the answer and indicate whether it’s right or wrong if an answer exists. If no answer exists, display an alert.</p></li>
<li><p class="noindent">When the user clicks the end button, stop displaying problems and change the user interface to show only the final numeric and percentage practice scores.</p></li>
</ol>
<p class="indent">You’ll need the following components:</p>
<ul>
<li><p class="noindent"><span class="codestrong">Button</span> (3) for the user to click to manually start and end practice and check answers</p></li>
<li><p class="noindent"><span class="codestrong">Clock</span> to fire after the user clicks the start button to display math problems at a 5-second interval</p></li>
<li><p class="noindent"><span class="codestrong">HorizontalArrangement</span> to hold the answer <span class="literal">TextBox</span>, the check answer button, and the answer result <span class="literal">Label</span></p></li>
<li><p class="noindent"><span class="codestrong">Label</span> (3) to display math problems, answer results, and scores</p></li>
<li><p class="noindent"><span class="codestrong">Notifier</span> to display an alert to the user</p></li>
<li><p class="noindent"><span class="codestrong">Screen</span> (2) for the welcome screen and the practice screen</p></li>
<li><p class="noindent"><span class="codestrong">TextBox</span> for the user to input answers</p></li>
<li><p class="noindent"><span class="codestrong">TextToSpeech</span> (2) to say the welcome message and declare answers right or wrong</p></li>
<li><p class="noindent">Variable (7) to store problems, answers, and scores</p></li>
<li><p class="noindent"><span class="codestrong">VerticalArrangement</span> to hold all practice screen user interface components</p></li>
</ul>
<p class="indent">Now let’s lay out the app in the Designer.</p>
<h3 class="h3" id="ch00lev1sec29"><span epub:type="pagebreak" id="page_64"/><strong>LAYING OUT “MULTIPLICATION STATION” IN THE DESIGNER</strong></h3>
<p class="noindent">Rather than briefly showing and hiding our introductory information like we did in <a href="ch02.xhtml#ch02">Chapter 2</a>’s “Practice Makes Perfect” app, we’ll use two different screens in this app: one to welcome the user and the other to display problems and evaluate the user’s answers.</p>
<h4 class="h4" id="ch00lev2sec27"><strong>SETTING UP THE WELCOME SCREEN</strong></h4>
<p class="noindent">To lay out <span class="literal">Screen1</span>, the welcome screen, drag a <span class="codestrong">Button</span> from the User Interface drawer and a non-visible <span class="codestrong">TextToSpeech</span> component from the Media drawer.</p>
<p class="indent"><a href="ch04.xhtml#ch4fig3">Figure 4-3</a> shows what the welcome screen should look like.</p>
<div class="image" id="ch4fig3"><img alt="Image" src="../images/04fig03.jpg"/></div>
<p class="figcap"><em>Figure 4-3: The Viewer, Component, and Media panes after laying out <span class="codeitalic">Screen1</span> of “Multiplication Station”</em></p>
<p class="indent">In the Components pane click <span class="codestrong">Screen1</span>. Then, in the Properties pane, adjust its vertical alignment so the <span class="literal">Button</span> sits at the bottom of the screen by clicking the drop-down arrow under <span class="codestrong">AlignVertical</span> and selecting <strong>Bottom: 3</strong>. <span epub:type="pagebreak" id="page_65"/>Then add a background image to the screen by clicking the text box under <span class="codestrong">BackgroundImage</span> and following the image upload instructions outlined in “Uploading a Picture” on <a href="ch02.xhtml#page_27">page 27</a>. Finally, remove the check marks under <span class="codestrong">ShowStatusBar</span> and <span class="codestrong">TitleVisible</span> to hide the status bar and the title of the screen, <span class="literal">Screen1</span>, when the app runs.</p>
<p class="indent">Now, let’s style the <span class="literal">Button</span> that starts the app. Click <span class="codestrong">Button1</span> in the Components pane. Then, in the Properties pane, change the background color to black by clicking <strong>Default</strong> under <span class="codestrong">BackgroundColor</span> and then clicking <strong>Black</strong> when the color list dialog opens. Next, bold its text by clicking the checkbox under <span class="codestrong">FontBold</span>, and change its shape by clicking the drop-down arrow under <span class="codestrong">Shape</span> and selecting <strong>rounded</strong>. Next, input <span class="codestrong">Start Practicing</span> in the text box under <strong>Text</strong>. To make the text white, click <strong>Default</strong> under <span class="codestrong">TextColor</span> and then <strong>White</strong> when the color list dialog opens.</p>
<p class="indent">Now let’s create <span class="literal">Screen2</span>, where most of your app’s action will happen.</p>
<h4 class="h4" id="ch00lev2sec28"><strong>CREATING THE PRACTICE SCREEN</strong></h4>
<p class="noindent">To create <span class="literal">Screen2</span>, click the <strong>Add Screen…</strong> button above the Viewer. When the New Screen dialog opens, click <strong>OK</strong>, and you’ll be taken to a brand new screen.</p>
<p class="indent">Now, in the Properties pane, we’ll center <span class="literal">Screen2</span> horizontally and vertically so that all components we place on it will be centered. To do this, click the drop-down arrows under both <span class="codestrong">AlignHorizontal</span> and <span class="codestrong">AlignVertical</span> and select <strong>Center</strong>. Next, add a background image to the screen by clicking the text box under <span class="codestrong">BackgroundImage</span> and following the image upload procedure. Finally, click the checkbox under <span class="codestrong">TitleVisible</span> to remove the check mark and keep the title of the screen from showing at the top of the app when it runs.</p>
<h5 class="h5" id="ch00lev3sec35"><strong>Problem Display</strong></h5>
<p class="noindent">Now let’s set up the components the user can see and interact with, by dragging the components from the Palette pane in the order that we want them to appear onscreen. Let’s also adjust these components as we add them.</p>
<p class="indent">First, drag a <span class="codestrong">VerticalArrangement</span> from the Layout drawer, and center its contents horizontally and vertically by clicking the drop-down arrows under both <span class="codestrong">AlignHorizontal</span> and <span class="codestrong">AlignVertical</span> and selecting <strong>Center</strong>. Then, change the height of <span class="literal">VerticalArrangement1</span> so it takes up half the vertical screen. To do so, click the text box under <strong>Height</strong>, and, when the dialog opens, input <span class="codestrong">50</span> in the text box next to the word <span class="literal">percent</span> and click <strong>OK</strong>. Finally, set its <strong>Width</strong> to <strong>Fill parent</strong>.</p>
<p class="indent">Now we’ll drag all of the remaining visible components into <span class="literal">VerticalArrangement1</span>. Drag a <span class="codestrong">Label</span> from the User Interface drawer into <span class="codestrong">VerticalArrangement1</span>, click the <strong>Rename</strong> button to rename it as <span class="codestrong">ProblemLbl</span>, and click <strong>OK</strong>. Next, click the <strong>FontBold</strong> checkbox to make the text on <span class="literal">ProblemLbl</span> bold, input <span class="codestrong">25</span> in the <strong>FontSize</strong> text box to make the text larger, and replace the default <span class="literal">Text for Label1</span> by inputting <span class="codestrong">Problems appear here</span> in the <strong>Text</strong> text box.</p>
<h5 class="h5" id="ch00lev3sec36"><span epub:type="pagebreak" id="page_66"/><strong>Answer Text Box and Check Answer Button</strong></h5>
<p class="noindent">Next, drag a <span class="codestrong">HorizontalArrangement</span> from the Layout drawer into <span class="codestrong">VerticalArrangement1</span> under <span class="literal">ProblemLbl</span>. Select <strong>Center</strong> in both its <span class="codestrong">AlignHorizontal</span> and <span class="codestrong">AlignVertical</span> drop-down boxes and set its <strong>Width</strong> to <strong>Fill parent</strong>.</p>
<p class="indent">Now, drag three components from the User Interface drawer into <span class="codestrong">HorizontalArrangement1</span>. First, drag in a <span class="codestrong">TextBox</span> and rename it <span class="codestrong">AnswerBox</span>. Make its width 100 pixels by clicking the text box under <strong>Width</strong>, inputting <span class="codestrong">100</span> in the text box to the left of the word <span class="literal">pixels</span>, and clicking <strong>OK</strong>. Next, replace the <span class="literal">Hint for TextBox1</span> in the <strong>Hint</strong> text box by entering <span class="codestrong">Type your answer</span>. Although you can’t see this text in the Viewer, the user should see the hint in <span class="literal">AnswerBox</span> on the screen. Finally, click the checkbox under <span class="codestrong">NumbersOnly</span>, which will allow users to enter only numbers into <span class="literal">AnswerBox</span>.</p>
<p class="indent">Drag a <span class="codestrong">Button</span> into <span class="codestrong">HorizontalArrangement1</span> to the right of <span class="codestrong">AnswerBox</span> and rename it <span class="codestrong">CheckAnswerBtn</span>. Then replace the default <span class="literal">Text for Button1</span> on <span class="literal">CheckAnswerBtn</span> by inputting <span class="codestrong">Check Answer</span> in the <strong>Text</strong> text box. This is the button users will click to check their answers.</p>
<p class="indent">Finally, drag a <span class="codestrong">Label</span> into <span class="codestrong">HorizontalArrangement1</span> to the right of <span class="codestrong">CheckAnswerBtn</span>, rename it <span class="codestrong">ResultLbl</span>, and delete the default <span class="literal">Text for Label1</span> from its <strong>Text</strong> text box. This label will remain invisible until it displays “Correct!” or “Incorrect” answer results.</p>
<h5 class="h5" id="ch00lev3sec37"><strong>End and Score Button</strong></h5>
<p class="noindent">To display the score and percentage of answers correct, place a <span class="codestrong">Label</span> into <span class="codestrong">VerticalArrangement1</span> under <span class="literal">HorizontalArrangement1</span>, and rename it <span class="codestrong">ScoreLbl</span>. Make the text bold and italic by clicking the checkboxes under <span class="codestrong">FontBold</span> and <span class="codestrong">FontItalic</span> and larger by entering <span class="codestrong">20</span> in the <strong>FontSize</strong> text box. Also, delete the default <span class="literal">Text for Label1</span> from the <strong>Text</strong> text box so no text will show when the screen opens.</p>
<p class="indent">To create a button users can click to stop practicing and see their final scores, drag another <span class="codestrong">Button</span> into <span class="codestrong">VerticalArrangement1</span> under <span class="literal">ScoreLbl</span> and rename it <span class="codestrong">EndBtn</span>. Style it exactly like <span class="literal">Button1</span> on <span class="literal">Screen1</span>. Change the background color to black by selecting <strong>Black</strong> under <span class="codestrong">BackgroundColor</span>, make its text bold by clicking the checkbox under <span class="codestrong">FontBold</span>, and change its shape by clicking the drop-down arrow under <span class="codestrong">Shape</span> and selecting <strong>rounded</strong>. Then, enter <span class="codestrong">End + Get Percentage</span> in the text box under <strong>Text</strong>, and make the text white by selecting <strong>White</strong> under <span class="codestrong">TextColor</span>.</p>
<p class="indent">Finally, let’s drag in the non-visible components: a <span class="codestrong">Notifier</span> component from the User Interface drawer, another <span class="codestrong">TextToSpeech</span> component from the Media drawer, and a <span class="codestrong">Clock</span> component from the Sensors drawer. Change the <span class="literal">Clock</span>’s timer interval to 5 seconds by replacing the default <span class="literal">1000</span> with <span class="codestrong">5000</span> in the <strong>TimerInterval</strong> text box so a new problem will display every 5 seconds.</p>
<p class="indent">Now, in the Viewer pane, all visible components should show on <span class="literal">Screen2</span>, and the non-visible components—<span class="literal">Notifier1</span>, <span class="literal">TextToSpeech1</span>, and <span class="literal">Clock1</span>—should show under the screen. In the Components and Media panes, you should see a list of all components and images added, as shown in <a href="ch04.xhtml#ch4fig4">Figure 4-4</a>.</p>
<div class="image" id="ch4fig4"><span epub:type="pagebreak" id="page_67"/><img alt="Image" src="../images/04fig04.jpg"/></div>
<p class="figcap"><em>Figure 4-4: The Viewer, Component, and Media panes after laying out <span class="codeitalic">Screen2</span> of “Multiplication Station”</em></p>
<p class="indent">Now that you’ve laid out all components, you’re ready to program the app!</p>
<h3 class="h3" id="ch00lev1sec30"><strong>PROGRAMMING “MULTIPLICATION STATION”</strong></h3>
<p class="noindent">For “Multiplication Station,” we’ll need five event handlers for the two screens. Three respond to events generated by the user’s button clicks. One directs the app’s action after a timer goes off at the time interval we’ve set. The other triggers action when the screen initializes or opens. We’ll also create seven variables to store important information, and we’ll use an <span class="literal">if then</span> block that has another <span class="literal">if then</span> block nested within it.</p>
<p class="indent">Click the <strong>Blocks</strong> button to switch to the Blocks Editor to begin programming.</p>
<h4 class="h4" id="ch00lev2sec29"><strong>STEP 1: PLAYING THE WELCOME MESSAGE</strong></h4>
<p class="noindent">Let’s start by telling the app what to do when <span class="literal">Screen1</span> opens—namely, we want the <span class="literal">TextToSpeech</span> component to say the app’s welcome message. The following code shows the event handler to program this behavior in step 1.</p>
<div class="image"><span epub:type="pagebreak" id="page_68"/><img alt="Image" src="../images/f0068-01.jpg"/></div>
<p class="indent">Switch back to <span class="literal">Screen1</span> by selecting <span class="codestrong">Screen1</span> in the drop-down box to the right of the project’s name. In the Blocks pane, click <span class="codestrong">Screen1</span> and drag the <span class="codestrong">whenScreen1.Initialize</span> event handler block <span class="ent">➊</span> to the Viewer. Then, click <span class="codestrong">TextToSpeech1</span> in the Blocks pane and drag its <span class="codestrong">callTextToSpeech1.Speak</span> built-in method block <span class="ent">➋</span> next to the word <span class="literal">do</span>. Next, in the Blocks pane, click the <strong>Text</strong> blocks drawer and drag an empty string block <span class="ent">➌</span> (the first block in the drawer), next to the word <span class="literal">message</span>, into the socket for the method’s <span class="literal">message</span> parameter.</p>
<p class="indent">The <span class="literal">message</span> parameter is required by the <span class="literal">TextToSpeech1 Speak</span> method in order for the app to speak. Add that <span class="literal">message</span> by clicking the empty string block’s text area and entering the following: <span class="codestrong">Welcome to Multiplication Station! You will have 5 seconds to answer each problem. Click the Start Practicing button to begin.</span> Altogether, these blocks program step 1 of the app, greeting the user with a spoken welcome message when the app opens.</p>
<h4 class="h4" id="ch00lev2sec30"><strong>STEP 2: MOVING TO THE PRACTICE SCREEN</strong></h4>
<p class="noindent">In addition to hearing the welcome message, users should see <span class="literal">Button1</span>, which they can click to display the multiplication problems in <span class="literal">Screen2</span>. The following blocks handle this step.</p>
<div class="image"><img alt="Image" src="../images/f0068-02.jpg"/></div>
<p class="indent">Click <span class="codestrong">Button1</span> in the Blocks pane and drag the <span class="codestrong">whenButton1.Click</span> block <span class="ent">➊</span> to the Viewer. Place the <span class="codestrong">open another screen</span> block <span class="ent">➋</span> inside the <span class="codestrong">whenButton1.Click</span> block next to the word <span class="literal">do</span>. From the Text blocks drawer, drag in another empty string block <span class="ent">➌</span> and snap it onto the <span class="codestrong">open another screen</span> block. Enter <span class="codestrong">Screen2</span> (the exact name of the screen we want to open) inside the empty string block. Now when the user clicks <span class="literal">Button1</span>, the app should open <span class="literal">Screen2</span> just like we planned.</p>
<p class="indent">To see how these blocks work, switch back to <span class="codestrong">Screen1</span> and let’s live-test with a device, as outlined in “Live-Testing Your Apps” on <a href="intro.xhtml#page_xxii">page xxii</a>. Once you click <strong>Connect</strong> <span class="ent">▸</span> <strong>AI Companion</strong> in the top menu bar and scan the QR code with your phone’s AI2 Companion app, the “Multiplication Station” app should open on your phone. As long as the blocks are placed correctly, you should hear the welcome message and, after clicking <span class="literal">Button1</span>, you should see <span class="literal">Screen2</span>. For now, nothing else should happen. Close AI2 Companion for now, and we’ll reconnect when we test again.</p>
<h4 class="h4" id="ch00lev2sec31"><span epub:type="pagebreak" id="page_69"/><strong>STEP 3: DISPLAYING RANDOM MULTIPLICATION PROBLEMS</strong></h4>
<p class="noindent">Let’s now program step 3 of the app, where we display a random multiplication problem every 5 seconds. When this happens, we’ll count each problem to keep a running total. Make sure you’re in the Blocks Editor for <span class="literal">Screen2</span> to program this step.</p>
<h5 class="h5" id="ch00lev3sec38"><strong>Setting Global Variables</strong></h5>
<p class="noindent">We’ll use three global variables in this step: <span class="literal">a</span> and <span class="literal">b</span> to store the numbers in the multiplication problems and <span class="literal">problems</span> to store the total number of problems. We’ll create and initialize the global variables as shown here.</p>
<div class="image"><img alt="Image" src="../images/f0069-01.jpg"/></div>
<p class="indent">For each variable, click the <strong>Variables</strong> block drawer and drag an <span class="codestrong">initialize global name</span> block <span class="ent">➊</span> to the Viewer, click <span class="codestrong">name</span>, and replace it with the name of the variable. Then drag a <span class="codestrong">0</span> number block <span class="ent">➋</span> from the Math drawer and snap it onto the <span class="codestrong">initialize global</span> block. Because all three variables are global, they can be used by all our event handlers and they stand alone in our code, outside of all our event handler blocks.</p>
<h5 class="h5" id="ch00lev3sec39"><strong>Choosing Random Numbers to Multiply</strong></h5>
<p class="noindent">Next, we’ll program the <span class="literal">Clock</span>’s timer. Because we kept the default setting for the <span class="literal">Clock</span>’s <span class="literal">TimerEnabled</span> property in the Designer, the timer should automatically begin firing at 5-second intervals once <span class="literal">Screen2</span> opens. The following event handler blocks tell the app what to do each time the timer fires.</p>
<div class="image"><img alt="Image" src="../images/f0069-02.jpg"/></div>
<p class="indent">In the Blocks pane, click <span class="codestrong">Clock1</span> and, when the blocks for the component appear, drag the <span class="codestrong">whenClock1.Timer</span> block <span class="ent">➊</span> to the Viewer. Next, in the Blocks pane, click the <strong>Variables</strong> blocks drawer, drag the <span class="codestrong">set global a to</span> block <span class="ent">➋</span> to <span epub:type="pagebreak" id="page_70"/>the Viewer, and snap it inside the <span class="codestrong">whenClock1.Timer</span> block next to the word <span class="literal">do</span>. Then click the <strong>Math</strong> blocks drawer and drag a <span class="codestrong">random integer</span> block <span class="ent">➌</span> to the right of the <span class="codestrong">set global a to</span> block.</p>
<p class="indent">The random integer block will generate a random integer between a specified range of numbers. To set this range, leave the <span class="literal">1</span> in the left socket of the random integer block as is <span class="ent">➍</span>, click the <span class="codestrong">100</span> in the right socket, and replace it by entering <span class="codestrong">12</span> <span class="ent">➎</span>.</p>
<p class="indent">So far we’ve set the value for variable <span class="literal">a</span>, the random number on the left side of each multiplication problem that will show in the app. To set the number for variable <span class="literal">b</span>, the right side of the multiplication problems, copy the blocks at <span class="ent">➋</span> through <span class="ent">➎</span>, place the duplicate blocks under the original, and use the drop-down arrow to change <span class="codestrong">a</span> to <span class="codestrong">b</span> <span class="ent">➏</span> in the duplicate <span class="codestrong">set global</span> block.</p>
<h5 class="h5" id="ch00lev3sec40"><strong>Displaying the Problems</strong></h5>
<p class="noindent">Now we’ll add the blocks to the <span class="literal">Timer</span> event handler that display the multiplication problems to the user in <span class="literal">ProbemLbl</span>.</p>
<div class="image"><img alt="Image" src="../images/f0070-01.jpg"/></div>
<p class="indent">In the Blocks pane, click <span class="codestrong">ProbemLbl</span>, drag the <span class="codestrong">setProblemLbl.Textto</span> block <span class="ent">➊</span> to the Viewer, and snap it inside the <span class="codestrong">whenClock1.Timer</span> block under the <span class="literal">set global b to</span> block. Then click the <strong>Text</strong> blocks drawer, drag a <span class="codestrong">join</span> block <span class="ent">➋</span> to the Viewer, and snap it to the right of the <span class="codestrong">setProblemLbl.Textto</span> block. This allows us to join the random number values of the <span class="literal">a</span> and <span class="literal">b</span> variables and the multiplication operator, ×, into one string. For example, if <span class="literal">a</span> = 3 and <span class="literal">b</span> = 6, we want to join them with the operator to display 3 × 6.</p>
<p class="indent">First, we’ll add another string input to the two default inputs in the <span class="literal">join</span> block. To do this, click the blue mutator icon to the left of the word <span class="literal">join</span>, and drag one additional string block to the <span class="codestrong">join</span> block in the dialog that opens.</p>
<p class="indent">Then, for the <span class="literal">join</span> block’s top input, click the <strong>Variables</strong> blocks drawer and drag in the <span class="codestrong">get global a</span> block <span class="ent">➌</span>. For the <span class="literal">join</span> block’s second input, drag in an empty string block <span class="ent">➍</span> from the Text blocks drawer, click the empty string block’s text area, and enter <span class="codestrong">x</span> (with spaces before and after the <span class="literal">x</span>). Then, for the <span class="literal">join</span> block’s bottom input, click the <strong>Variables</strong> blocks drawer again and drag in the <span class="codestrong">get global b</span> block <span class="ent">➎</span>. Now, every 5 seconds, these blocks will get new random values for <span class="literal">a</span> and <span class="literal">b</span>, join them with the multiplication operator, and display the multiplication problem in <span class="literal">ProbemLbl</span>.</p>
<h5 class="h5" id="ch00lev3sec41"><strong>Counting the Number of Problems Displayed</strong></h5>
<p class="noindent">To keep a running total of the number of problems, we need the app to count each problem as it’s displayed. The next blocks in the <span class="literal">Timer</span> event handler program this.</p>
<div class="image"><img alt="Image" src="../images/f0070-02.jpg"/></div>
<p class="indent"><span epub:type="pagebreak" id="page_71"/>Click the <strong>Variables</strong> blocks drawer, drag the <span class="codestrong">set global problems to</span> block <span class="ent">➊</span> to the Viewer, and snap it inside the <span class="codestrong">whenClock1.Timer</span> block under the <span class="literal">setProblemLbl.Textto</span> block. Then drag an addition operator block <span class="ent">➋</span> from the Math drawer and snap it to the right of the <span class="codestrong">set global problems to</span> block. Now click the <strong>Variables</strong> blocks drawer again and drag the <span class="codestrong">get global problems</span> block <span class="ent">➌</span> into the addition block’s left operand socket and a <span class="codestrong">1</span> number block <span class="ent">➍</span> from the Math drawer into its right operand socket. These blocks keep a running total of the problems displayed by adding 1 to the current value of the <span class="literal">problems</span> variable every 5 seconds, each time a new multiplication problem appears onscreen.</p>
<h5 class="h5" id="ch00lev3sec42"><strong>Refreshing the AnswerBox, ResultLbl, and CheckAnswerBtn</strong></h5>
<p class="noindent">We need the app to do three more things each time the <span class="literal">Timer</span> fires and it displays a new math problem:</p>
<ol>
<li><p class="noindent">Erase any text left in <span class="literal">AnswerBox</span> so the user has a clean box to input answers</p></li>
<li><p class="noindent">Remove the “Correct!” or “Incorrect” text displayed in response to any prior answer</p></li>
<li><p class="noindent">Enable the <span class="literal">CheckAnswerBtn</span>, which we’ll later program the app to temporarily disable after the user clicks it</p></li>
</ol>
<p class="indent">The following blocks accomplish these three tasks.</p>
<div class="image"><img alt="Image" src="../images/f0071-01.jpg"/></div>
<p class="indent">Let’s prepare the app to accept an answer to a new problem and equip its <span class="literal">CheckAnswerBtn</span> to check that answer. Click <span class="codestrong">AnswerBox</span> in the Blocks pane, drag its <span class="codestrong">setAnswerBox.Textto</span> block <span class="ent">➊</span> to the Viewer, and snap it inside the <span class="codestrong">whenClock1.Timer</span> block under the <span class="literal">set global problems to</span> block. Then click the <strong>Text</strong> blocks drawer, drag in an empty string block <span class="ent">➋</span>, and snap it to the right of the <span class="codestrong">setAnswerBox.Textto</span> block.</p>
<p class="indent">Click <span class="codestrong">ResultLbl</span> in the Blocks pane, drag its <span class="codestrong">setResultLbl.Textto</span> block <span class="ent">➌</span> to the Viewer, and snap it inside the <span class="codestrong">whenClock1.Timer</span> block under the <span class="literal">setAnswerBox.Textto</span> block. Then click the <strong>Text</strong> blocks drawer, drag in another empty string block <span class="ent">➍</span>, and snap it to the right of the <span class="codestrong">setResultLbl.Textto</span> block.</p>
<p class="indent">Click <span class="codestrong">CheckAnswerBtn</span> in the Blocks pane, drag its <span class="codestrong">setCheckAnswerBtn.Enabledto</span> block <span class="ent">➎</span> to the Viewer, and snap it inside the <span class="codestrong">whenClock1.Timer</span> block under the <span class="literal">setResultLbl.Textto</span> block. Then click the <strong>Logic</strong> blocks drawer, drag in a <span class="codestrong">true</span> block <span class="ent">➏</span>, and snap it to the right of the <span class="codestrong">setCheckAnswerBtn.Enabledto</span> block.</p>
<p class="indent">Now live-test to see how these blocks work. If the AI2 Companion button is grayed out when you attempt to reconnect the AI2 Companion app, click <strong>Connect</strong> <span class="ent">▸</span> <strong>Reset Connection</strong> in the top menu bar. Then, click <strong>Connect</strong> <span class="ent">▸</span> <strong>AI</strong> <span epub:type="pagebreak" id="page_72"/><strong>Companion</strong> and scan the QR code with your device’s AI2 Companion app. You should still see <span class="literal">Screen2</span> since you’re connecting AI2 Companion while working on your <span class="literal">Screen2</span> blocks.</p>
<p class="indent">Five seconds after the app opens, you should see a multiplication problem appear in place of “Problems appear here” and then see a new problem every 5 seconds after that. Also, if you enter numbers in <span class="literal">AnswerBox</span>, they should disappear after 5 seconds. If you don’t see any multiplication problems, the problems don’t show as desired, or the answers don’t disappear after each 5-second interval, debug your code and test again.</p>
<p class="indent">Next, we’ll tell the app what to do when the user clicks the Check Answer button.</p>
<h4 class="h4" id="ch00lev2sec32"><strong>STEP 4: CHECKING ANSWERS</strong></h4>
<p class="noindent">Let’s program step 4 of the app, where the user clicks <span class="literal">CheckAnswerBtn</span>. First, we want to determine whether the user has entered anything into <span class="literal">AnswerBox</span>. If so, we’ll program the app to evaluate the answer and indicate whether it’s wrong or right by speaking and displaying the result in a label. If the answer’s right, the app increases the score by 1. If, on the other hand, the user clicks <span class="literal">CheckAnswerBtn</span> without entering anything into <span class="literal">AnswerBox</span>, the app displays an alert. In this step, you’re <em>validating</em> user input, which means checking whether the user has entered the type of data required. Programmers commonly validate user form input and use it only if it’s valid or notify the user if it’s not.</p>
<p class="indent">We’ll start our code for this step by creating and initializing three more global variables. Create the variables <span class="literal">answer</span>, <span class="literal">c</span>, and <span class="literal">score</span>. Then initialize <span class="literal">answer</span> to the value of an empty string block from the Text blocks drawer, and <span class="literal">c</span> and <span class="literal">score</span> to the value of <span class="literal">0</span>. The variables should look as shown here.</p>
<div class="image"><img alt="Image" src="../images/f0072-01.jpg"/></div>
<p class="indent">We’ll use these variables to store the user’s answer (<span class="literal">answer</span>), the correct answer (<span class="literal">c</span>), and the user’s score (<span class="literal">score</span>).</p>
<h5 class="h5" id="ch00lev3sec43"><strong>Testing Our First Condition: Checking Whether an Answer Exists</strong></h5>
<p class="noindent">Let’s now program the <span class="literal">CheckAnswerBtn</span> event handler, which includes two <span class="literal">if then</span> blocks, one nested within the <span class="literal">then</span> socket of the other. This means that if the first <span class="literal">if then</span> condition is true, the app will need to test another condition. The first <span class="literal">if then</span> block tests whether the user has entered any numbers into <span class="literal">AnswerBox</span>, providing one set of instructions for the app to follow if the user has entered numbers and different instructions if the box is empty.</p>
<p class="indent">If the user has entered an answer, the second <span class="literal">if then</span> block tests the answer and then tells the app what to do depending on whether it is right or wrong. Here is the code for programming this nested conditional.</p>
<div class="image"><span epub:type="pagebreak" id="page_73"/><img alt="Image" src="../images/f0073-01.jpg"/></div>
<p class="indent">To place the blocks that test whether the user has entered an answer, click <span class="codestrong">CheckAnswerBtn</span> in the Blocks pane and drag the <span class="codestrong">whenCheckAnswerBtn.Click</span> block <span class="ent">➊</span> to the Viewer. Then, in the Blocks pane, click the <strong>Control</strong> blocks drawer, drag an <span class="codestrong">if then</span> block <span class="ent">➋</span> to the Viewer, and snap it inside the <span class="codestrong">whenCheckAnswerBtn.Click</span> block next to the word <span class="literal">do</span>. Since we’ll need an <span class="literal">else</span> statement for this conditional, click the <span class="literal">if then</span> block’s blue mutator icon, and drag an <span class="codestrong">else</span> block into the <span class="codestrong">if then</span> block in the dialog that opens.</p>
<p class="indent">Then, from the Logic blocks drawer, drag in an <span class="codestrong">=</span> comparison operator block <span class="ent">➌</span> next to the word <span class="literal">if</span>, and click the drop-down arrow by the <span class="literal">=</span> sign to select the not equal sign, <span class="codestrong">≠</span>. To fill the <span class="codestrong">≠</span> block’s operand sockets, click <span class="codestrong">AnswerBox</span> in the Blocks pane and drag its <span class="codestrong">AnswerBox.Text</span> block <span class="ent">➍</span> into the left socket, then click the <strong>Text</strong> blocks drawer and drag an empty string block <span class="ent">➎</span> into the right socket. We’ve now set up the test condition that checks whether <span class="literal">AnswerBox</span> is empty.</p>
<h5 class="h5" id="ch00lev3sec44"><strong>Preparing to Evaluate the User’s Answers</strong></h5>
<p class="noindent">Now we’ll tell the app what to do if <span class="literal">AnswerBox</span> isn’t blank (we’ll program what the app should do if it is blank later in this chapter). If <span class="literal">AnswerBox</span> isn’t blank, we want the app to disable <span class="literal">CheckAnswerBtn</span> so the user can’t click it again while the app’s checking the current answer. Then we want the app to set the value of the global <span class="literal">answer</span> variable to the number the user has entered into <span class="literal">AnswerBox</span> so the app can check it later, and to set the value of the global <span class="literal">c</span> variable to the value of global <span class="literal">a</span> multiplied by global <span class="literal">b</span>, which is the current problem’s correct answer. The following blocks program these three actions.</p>
<div class="image"><span epub:type="pagebreak" id="page_74"/><img alt="Image" src="../images/f0074-01.jpg"/></div>
<p class="indent">Click <span class="codestrong">CheckAnswerBtn</span> in the Blocks pane, drag its <span class="codestrong">setCheckAnswerBtn.Enabledto</span> block <span class="ent">➊</span> to the Viewer, and snap it into the <span class="codestrong">if then</span> block next to the word <span class="literal">then</span>. Then click the <strong>Logic</strong> blocks drawer, drag in a <span class="codestrong">false</span> block <span class="ent">➋</span>, and snap it to the right of the <span class="codestrong">setCheckAnswerBtn.Enabledto</span> block. This prevents the user from clicking <span class="literal">CheckAnswerBtn</span> again while the app’s checking an answer.</p>
<p class="indent">Next, click the <strong>Variables</strong> blocks drawer and drag the <span class="codestrong">set global answer to</span> block <span class="ent">➌</span> into the <span class="codestrong">if then</span> block under the <span class="literal">setCheckAnswerBtn.Enabledto</span> block. Then click <span class="codestrong">AnswerBox</span> in the Blocks pane, drag in its <span class="codestrong">AnswerBox.Text</span> block <span class="ent">➍</span>, and snap it to the right of the <span class="codestrong">set global answer to</span> block. This sets the value of the <span class="literal">answer</span> variable to the number the user entered into <span class="literal">AnswerBox</span> so we can compare that number with the correct answer.</p>
<p class="indent">Now, click the <strong>Variables</strong> blocks drawer and drag the <span class="codestrong">set global c to</span> block <span class="ent">➎</span> into the <span class="codestrong">if then</span> block under the <span class="literal">set global answer to</span> block. Then click the <strong>Math</strong> blocks drawer, drag in the multiplication operator block <span class="ent">➏</span>, and snap it to the right of the <span class="codestrong">set global c to</span> block. To fill the multiplication block’s operand sockets, click the <strong>Variables</strong> blocks drawer and drag the <span class="codestrong">get global a</span> block <span class="ent">➐</span> into the left socket and the <span class="codestrong">get global b</span> block <span class="ent">➑</span> into the right socket. These blocks set the value of variable <span class="literal">c</span> to the value of variable <span class="literal">a</span> multiplied by the value of variable <span class="literal">b</span>, which is the correct answer to the problem.</p>
<p class="indent">So far, the blocks say: if <span class="literal">AnswerBox</span> isn’t blank, disable <span class="literal">CheckAnswerBtn</span>, then set the value of <span class="literal">answer</span> to the number entered by the user, and set the value of <span class="literal">c</span> to the correct answer.</p>
<h5 class="h5" id="ch00lev3sec45"><strong>Testing Our Second Condition: Evaluating the Answers</strong></h5>
<p class="noindent">Now we’ll tell the app to compare <span class="literal">answer</span> and <span class="literal">c</span> and then do one thing if they are equal, which means the user’s answer to the problem is correct, and another thing if they aren’t equal, which means the user’s answer is wrong.</p>
<p class="indent">We’ll start by placing the blocks that set up the second test condition.</p>
<div class="image"><img alt="Image" src="../images/f0074-02.jpg"/></div>
<p class="indent">In the Blocks pane, click the <strong>Control</strong> blocks drawer and drag another <span class="codestrong">if then</span> block <span class="ent">➊</span> to the Viewer inside the first <span class="codestrong">if then</span> block under the <span class="literal">set global c to</span> block. Then, click this new <span class="literal">if then</span> block’s blue mutator icon to the left of the word <span class="literal">if</span>, and drag an <span class="codestrong">else</span> block into the <span class="codestrong">if then</span> block in the dialog that opens.</p>
<p class="indent">Then, from the Math blocks drawer, drag in an <span class="codestrong">=</span> comparison operator block <span class="ent">➋</span> next to the word <span class="literal">if</span>. To fill the <span class="literal">=</span> block’s operand sockets, click the <strong>Variables</strong> blocks drawer and drag the <span class="codestrong">get global answer</span> block <span class="ent">➌</span> into the left socket and the <span class="codestrong">get global c</span> block <span class="ent">➍</span> into the right socket. These blocks set up our second test condition and check whether the user’s answer matches the correct answer.</p>
<h5 class="h5" id="ch00lev3sec46"><span epub:type="pagebreak" id="page_75"/><strong>Handling Correct Answers</strong></h5>
<p class="noindent">The next blocks tell the app what to do if the value of the two variables is the same, meaning the user’s answer is correct.</p>
<div class="image"><img alt="Image" src="../images/f0075-01.jpg"/></div>
<p class="indent">Click <span class="codestrong">TextToSpeech1</span> in the Blocks pane and drag its <span class="codestrong">callTextToSpeech1.Speak</span> block <span class="ent">➊</span> into the second <span class="codestrong">if then</span> block next to the word <span class="literal">then</span>. Set the argument for its <span class="literal">message</span> parameter to <span class="literal">Right</span> by snapping an empty string block <span class="ent">➋</span> from the Text drawer next to the word <span class="literal">message</span>, clicking the string block’s text area, and entering <span class="codestrong">Right</span>.</p>
<p class="indent">Next, click <span class="codestrong">ResultLbl</span> in the Blocks plane and drag its <span class="codestrong">setResultLbl.TextColorto</span> block <span class="ent">➌</span> into the second <span class="codestrong">if then</span> block under the <span class="literal">callTextToSpeech1.Speak</span> block. Then click the <strong>Colors</strong> blocks drawer, drag in the green color block <span class="ent">➍</span>, and snap it to the right of the <span class="codestrong">setResultLbl.TextColorto</span> block.</p>
<p class="indent">Now click <span class="codestrong">ResultLbl</span> in the Blocks plane again and drag its <span class="codestrong">setResultLbl.Textto</span> block <span class="ent">➎</span> into the second <span class="codestrong">if then</span> block under the <span class="literal">setResultLbl.TextColorto</span> block. Click the <strong>Text</strong> blocks drawer, drag in an empty text string block <span class="ent">➏</span>, snap it to the right of the <span class="codestrong">setResultLbl.Textto</span> block, and enter <span class="codestrong">Correct!</span> into the text string block’s text area. If the user’s answer is correct, these blocks direct the app to say so and show the result in green in the <span class="literal">Label</span>.</p>
<p class="indent">Let’s pause now to live-test again. If you’ve placed the blocks as shown, after you enter correct answers to problems and click <span class="literal">CheckAnswerBtn</span>, you should hear the device say “Right” and see the word “Correct!” in green text to the right of <span class="literal">CheckAnswerBtn</span>. Also, if you try to click <span class="literal">CheckAnswerBtn</span> again before the app checks your answer, the button shouldn’t work. Nothing should happen yet when you enter an incorrect answer. Make sure this part of the app is working correctly before continuing.</p>
<h5 class="h5" id="ch00lev3sec47"><strong>Increasing the Score</strong></h5>
<p class="noindent">The next blocks increment and display the user’s score, which means we first need the app to count each answer the user gets right.</p>
<div class="image"><img alt="Image" src="../images/f0075-02.jpg"/></div>
<p class="indent">To program this, click the <strong>Variables</strong> blocks drawer, drag the <span class="codestrong">set global score to</span> block <span class="ent">➊</span> to the Viewer, and snap it inside the second <span class="codestrong">if then</span> block under the <span class="literal">setResultLbl.Textto</span> block. Then drag an addition operator block <span class="ent">➋</span> from the Math drawer and snap it to the right of the <span class="codestrong">set global score to</span> block. Now click the <strong>Variables</strong> blocks drawer again, and drag the <span class="codestrong">get global score</span> block <span class="ent">➌</span> into the addition block’s left operand socket and a <span class="codestrong">1</span> number <span epub:type="pagebreak" id="page_76"/>block from the <strong>Math</strong> drawer <span class="ent">➍</span> into its right operand socket. These blocks add 1 to the current value of the <span class="literal">score</span> variable each time the user answers a problem correctly.</p>
<p class="indent">The next blocks display the user’s score in <span class="literal">ScoreLbl</span>. In the Blocks pane, click <span class="codestrong">ScoreLbl</span>, drag the <span class="codestrong">setScoreLbl.Textto</span> block <span class="ent">➎</span> to the Viewer, and snap it inside the second <span class="codestrong">if then</span> block under the <span class="literal">set global score to</span> block. Then click the <strong>Text</strong> blocks drawer, drag a <span class="codestrong">join</span> block <span class="ent">➏</span> to the Viewer, and snap it to the right of the <span class="codestrong">setScoreLbl.Textto</span> block.</p>
<p class="indent">For the <span class="literal">join</span> block’s top input, drag in an empty string block <span class="ent">➐</span> from the Text blocks drawer, click the string block’s text area, and enter <span class="codestrong">Your Score:</span> (including a space after the colon). Then, for the <span class="literal">join</span> block’s bottom input, click the <strong>Variables</strong> blocks drawer and drag in the <span class="codestrong">get global score</span> block <span class="ent">➑</span>.</p>
<p class="indent">Let’s pause here to live-test again. If you’ve placed the blocks as shown, after you enter correct answers to problems and click <span class="literal">CheckAnswerBtn</span>, you should see the score display under <span class="literal">AnswerBox</span> in <span class="literal">ScoreLbl</span>. Nothing should happen yet when you enter an incorrect answer. Make sure this part of the app is working correctly before you move on.</p>
<h5 class="h5" id="ch00lev3sec48"><strong>Handling Incorrect Answers</strong></h5>
<p class="noindent">The blocks in the prior section told the app what to do when the user answers a problem correctly. The blocks shown here complete the <span class="literal">else</span> portion of the second <span class="literal">if then else</span> block and guide the app’s behavior when the user’s answer is wrong.</p>
<div class="image"><img alt="Image" src="../images/f0076-01.jpg"/></div>
<p class="indent">First we’ll place the blocks that make the app speak to tell the user the answer is wrong. Click <span class="codestrong">TextToSpeech1</span> in the Blocks pane and drag its <span class="codestrong">callTextToSpeech1.Speak</span> block <span class="ent">➊</span> into the second <span class="codestrong">if then</span> block next to the word <span class="literal">else</span>. Set its message to “Wrong” by snapping an empty string block <span class="ent">➋</span> from the Text drawer next to the word <span class="literal">message</span>, clicking the string block’s text area, and entering <span class="codestrong">Wrong</span>.</p>
<p class="indent">Next, click <span class="codestrong">ResultLbl</span> in the Blocks plane and drag its <span class="codestrong">setResultLbl.TextColorto</span> block <span class="ent">➌</span> into the second <span class="codestrong">if then</span> block under the second <span class="literal">callTextToSpeech1.Speak</span> block. Then click the <strong>Colors</strong> blocks drawer, drag in the pink color block <span class="ent">➍</span>, and snap it to the right of the <span class="codestrong">setResultLbl.TextColorto</span> block.</p>
<p class="indent">Then click <span class="codestrong">ResultLbl</span> in the Blocks pane again and drag its <span class="codestrong">setResultLbl.Textto</span> block <span class="ent">➎</span> into the second <span class="codestrong">if then</span> block under the second <span class="literal">setResultLbl.TextColorto</span> block. Now click the <strong>Text</strong> blocks drawer and drag in an empty text string block <span class="ent">➏</span>, snap it to the right of the <span class="codestrong">setResultLbl.Textto</span> block, and enter <span class="codestrong">Incorrect</span> into the text string block’s text area. If the user’s answer is incorrect, these blocks have the app say so and show that result in pink in <span class="literal">ResultLbl</span>.</p>
<p class="indent"><span epub:type="pagebreak" id="page_77"/>Try live-testing now by entering an incorrect answer and clicking <span class="codestrong">CheckAnswerBtn</span>. If you’ve placed the blocks as shown, you should now hear the device say “Wrong” and see the word “Incorrect” in pink text to the right of <span class="literal">CheckAnswerBtn</span>. Make sure this part of the app is working correctly before continuing.</p>
<h5 class="h5" id="ch00lev3sec49"><strong>Handling an Empty Answer Box</strong></h5>
<p class="noindent">Until now, the blocks for this step have told the app what to do when the user clicks the <span class="literal">CheckAnswerBtn</span> after entering a number into <span class="literal">AnswerBox</span>. Now, with the following blocks, we tell the app what to do when the user clicks <span class="literal">CheckAnswerBtn</span> when <span class="literal">AnswerBox</span> is empty.</p>
<div class="image"><img alt="Image" src="../images/f0077-01.jpg"/></div>
<p class="indent">Click <span class="codestrong">Notifier1</span> and drag its <span class="codestrong">callNotifier1.ShowAlert</span> built-in method block <span class="ent">➊</span> into the second <span class="literal">else</span> socket. Then, in the Blocks pane, click the <strong>Text</strong> blocks drawer and drag an empty string block <span class="ent">➋</span> into the socket for the method’s <span class="literal">notice</span> parameter.</p>
<p class="indent">This <span class="literal">notice</span> parameter holds information the method needs in order to show an alert. Add that <span class="literal">notice</span> by clicking the string block’s text area and entering <span class="codestrong">No answer/Too late!</span>. These blocks direct the app to display a small pop-up notice when the user clicks <span class="literal">CheckAnswerBtn</span> without entering an answer.</p>
<p class="indent">Now that you’ve fully programmed <span class="literal">CheckAnswerBtn</span>, let’s live-test again. If you’ve placed the blocks as shown, once you’ve entered an answer and clicked <span class="literal">CheckAnswerBtn</span>, you should hear and see whether it’s right or wrong, and you should see the score displayed under <span class="literal">AnswerBox</span> in <span class="literal">ScoreLbl</span>. If you click <span class="literal">CheckAnswerBtn</span> and haven’t entered an answer in time, you should see a pop-up alert. If any part of this action is working incorrectly, debug your program. Once the Check Answer button is working correctly, close the AI2 Companion on your device, and let’s move on to program the last part of the app: the event handler for <span class="literal">EndBtn</span>.</p>
<h4 class="h4" id="ch00lev2sec33"><strong>STEP 5: ENDING PRACTICE AND SHOWING THE FINAL SCORE</strong></h4>
<p class="noindent">Let’s now program step 5 of the app, where the user presses <span class="literal">EndBtn</span> to stop practicing and see the final score as well as the percentage of problems answered correctly. We’ll create one additional global variable for this part, <span class="literal">percentage</span>, which you can initialize to the value of <span class="literal">0</span>.</p>
<div class="image"><img alt="Image" src="../images/f0077-02.jpg"/></div>
<p class="indent">Now we can program the <span class="literal">EndBtn</span> event handler as shown here.</p>
<div class="image"><span epub:type="pagebreak" id="page_78"/><img alt="Image" src="../images/f0078-01.jpg"/></div>
<p class="indent">Once the user clicks the button, the first thing we need to do is stop new problems from showing every 5 seconds. To do this, click <span class="codestrong">EndBtn</span> in the Blocks pane and drag the <span class="codestrong">whenEndBtn.Click</span> block <span class="ent">➊</span> to the Viewer. Then click <span class="codestrong">Clock1</span> in the Blocks pane, drag the <span class="codestrong">setClock1.TimerEnabledto</span> block <span class="ent">➋</span> to the Viewer, and snap it inside the <span class="codestrong">whenEndBtn.Click</span> block next to the word <span class="literal">do</span>. Then, in the Blocks pane, click the <strong>Logic</strong> blocks drawer, drag the <span class="codestrong">false</span> block <span class="ent">➌</span> to the Viewer, and snap it to the right side of the <span class="codestrong">setClock1.TimerEnabledto</span> block. These blocks disable the <span class="literal">Clock</span>’s timer so the app stops displaying new problems.</p>
<h5 class="h5" id="ch00lev3sec50"><strong>Hiding Elements We Don’t Need</strong></h5>
<p class="noindent">We also want <span class="literal">ProblemLbl</span>, <span class="literal">HorizontalArrangement1</span> (which contains <span class="literal">AnswerBox</span>, <span class="literal">CheckAnswerBtn</span>, and <span class="literal">ResultLbl</span>), and <span class="literal">EndBtn</span> to disappear, since we no longer need them on the screen. Here are the blocks that hide components the user no longer needs.</p>
<div class="image"><img alt="Image" src="../images/f0078-02.jpg"/></div>
<p class="indent">To program this behavior, click <span class="codestrong">ProblemLbl</span> in the Blocks pane, drag the <span class="codestrong">setProblemLbl.Visibleto</span> block <span class="ent">➊</span> to the Viewer, and snap it inside the <span class="codestrong">whenEndBtn.Click</span> block under the <span class="literal">setClock1.TimerEnabledto</span> block. Then, in the Blocks pane, click the <strong>Logic</strong> blocks drawer, drag the <span class="codestrong">false</span> block <span class="ent">➋</span> to the Viewer, and snap it to the right side of the <span class="codestrong">setProblemLbl.Visibleto</span> block.</p>
<p class="indent">These blocks reset the <span class="literal">Visible</span> property for <span class="literal">ProblemLbl</span> to <span class="literal">false</span> so that no problem shows after the user clicks <span class="literal">EndBtn</span>. Now place the blocks at <span class="ent">➌</span>, <span class="ent">➍</span>, <span class="ent">➎</span>, and <span class="ent">➏</span> to do the same for <span class="literal">HorizontalArrangement1</span> and <span class="literal">EndBtn</span>, so that after clicking <span class="literal">EndBtn</span>, all the user will see on the screen is the score and percentage correct.</p>
<h5 class="h5" id="ch00lev3sec51"><span epub:type="pagebreak" id="page_79"/><strong>Calculating the Percentage of Correct Answers</strong></h5>
<p class="noindent">The app needs to compute the percentage of correct answers before displaying it. The following blocks tell the app how to compute and store the user’s percentage.</p>
<div class="image"><img alt="Image" src="../images/f0079-01.jpg"/></div>
<p class="indent">Click the <strong>Variables</strong> blocks drawer, drag the <span class="codestrong">set global percentage to</span> block <span class="ent">➊</span> to the Viewer, and snap it inside the <span class="codestrong">whenEndBtn.Click</span> block under the <span class="literal">setEndBtn.Visibleto</span> block. Then drag a multiplication operator block <span class="ent">➋</span> from the Math drawer and snap it to the right of the <span class="codestrong">set global percentage to</span> block.</p>
<p class="indent">Now click the <strong>Math</strong> drawer again, drag a division operator block <span class="ent">➌</span> into the multiplication block’s first operand socket, and drag a <span class="codestrong">100</span> number block <span class="ent">➍</span> into the multiplication block’s second operand socket. Return to the Variables blocks drawer and drag the <span class="codestrong">get global score</span> block <span class="ent">➎</span> into the division block’s left operand socket and the <span class="codestrong">get global problems</span> block <span class="ent">➏</span> into its right operand socket. These blocks compute the percentage of problems answered correctly by dividing the user’s score by the total number of problems and multiplying that result by 100.</p>
<h5 class="h5" id="ch00lev3sec52"><strong>Showing the Percentage of Correct Answers</strong></h5>
<p class="noindent">Now we’ll display that percentage for the user with the blocks shown here.</p>
<div class="image"><img alt="Image" src="../images/f0079-02.jpg"/></div>
<p class="indent">In the Blocks pane, click <span class="codestrong">ScoreLbl</span>, drag the <span class="codestrong">setScoreLbl.Textto</span> block <span class="ent">➊</span> to the Viewer, and snap it inside the <span class="codestrong">whenEndBtn.Click</span> block under the <span class="literal">set global percentage to</span> block. Then click the <strong>Text</strong> blocks drawer, drag a <span class="codestrong">join</span> block <span class="ent">➋</span> to the Viewer, and snap it to the right of the <span class="codestrong">setScoreLbl.Textto</span> block. Now click the <span class="literal">join</span> block’s mutator icon to add another four string input sockets.</p>
<p class="indent">For the <span class="literal">join</span> block’s first input, click <span class="codestrong">ScoreLbl</span> and drag in its <span class="codestrong">ScoreLbl.Text</span> block <span class="ent">➌</span>. For the <span class="literal">join</span> block’s second input, drag in an empty string block <span class="ent">➍</span> from the Text blocks drawer, click the string block’s text area, and enter <span class="codestrong">out of</span> (including spaces before the word <span class="literal">out</span> and after the word <span class="literal">of</span>). For the <span class="literal">join</span> block’s third input, click the <strong>Variables</strong> blocks drawer and drag in the <span class="codestrong">get global problems</span> block <span class="ent">➎</span>.</p>
<p class="indent"><span epub:type="pagebreak" id="page_80"/>For its fourth input, drag in another empty string block <span class="ent">➏</span> from the Text blocks drawer, click the string block’s text area, and enter <span class="codestrong">(</span>, including a space before the parenthesis. For the fifth input, click the <strong>Variables</strong> blocks drawer again and drag in the <span class="codestrong">get global percentage</span> block <span class="ent">➐</span>. Finally, for the <span class="literal">join</span> block’s bottom input, drag in an empty string block <span class="ent">➑</span> from the Text blocks drawer, click the string block’s text area, and enter <span class="codestrong">%)</span>.</p>
<p class="indent">These blocks display the user’s score and percentage correct onscreen. For instance, if the user’s score is 20 and the total number of problems is 100, <span class="literal">ScoreLbl</span> should display “Your Score: 20 out of 100 (20%)”.</p>
<h3 class="h3" id="ch00lev1sec31"><strong>TESTING THE APP</strong></h3>
<p class="noindent">Now we can test the completed app! First, move back to <span class="literal">Screen1</span> by selecting it in the drop-down above the Blocks Viewer. Then, reset the connection to AI2 Companion by clicking <strong>Connect</strong> <span class="ent">▸</span> <strong>Reset Connection</strong> in the top menu bar and then <strong>Connect</strong> <span class="ent">▸</span> <strong>AI Companion</strong>. Next, scan the QR code with your device’s AI2 Companion app.</p>
<p class="indent">When the app opens on your device, you should hear the welcome message. Click <strong>Start Practicing</strong> to move to the next screen. There you should see a new problem appear every 5 seconds and, when you click Check Answer, if your answer <span class="literal">TextBox</span> is not empty, you should hear and see whether your answer’s right or wrong, and see the score displayed under <span class="literal">AnswerBox</span>. If you click Check Answer and haven’t typed an answer, you should see a pop-up alert.</p>
<p class="indent">Now click <span class="codestrong">EndBtn</span> and all components should disappear from the screen except for <span class="literal">ScoreLbl</span>, which should correctly display your score and percentage of problems correct. If you placed the blocks correctly, the app should work as expected. You’ve successfully created the “Multiplication Station” quiz app!</p>
<h3 class="h3" id="ch00lev1sec32"><strong>SUMMARY</strong></h3>
<p class="noindent">In this chapter, you built the “Multiplication Station” quiz app, where users answer random, timed multiplication problems, learn whether their answers are correct, earn points for correct answers, and view the score and percentage of correctly answered problems.</p>
<p class="indent">In the process of building this app, you learned how to use the sophisticated selection control structure, which controls the flow of a program by evaluating conditions and making decisions. To do this, you used App Inventor’s Control blocks along with its pseudorandom number generator and Math and Logic operator blocks. You also created and manipulated data stored in several variables and learned to use the <span class="literal">TextToSpeech</span> and <span class="literal">Notifier</span> components to communicate with app users.</p>
<p class="indent">In the next chapter, you’ll learn how to create and process lists using Lists blocks as we build the “Beat the Bus” app, which uses your device’s GPS and location-sensing capabilities to display your school bus’s location and text your friends or family with periodic updates along the route.</p>
<h3 class="h3" id="ch00lev1sec33"><span epub:type="pagebreak" id="page_81"/><strong>ON YOUR OWN</strong></h3>
<p class="noindent">Save new versions of “Multiplication Station” as you modify and extend it for the following exercises. You can find solutions online at <em><a href="https://nostarch.com/programwithappinventor/">https://nostarch.com/programwithappinventor/</a></em>.</p>
<ol>
<li><p class="noindent">Change the app so that if a user’s answer is incorrect, new problems stop appearing and the app displays the correct answer, after which the user may continue the practice session. Where will the app display the correct answer? How will the user resume practice, if desired? Will you need another <span class="literal">if then</span> block, additional components, or more variables?</p></li>
<li><p class="noindent">Extend the app so that the user can choose to practice multiplication or division. How will your algorithm change? What components and blocks will you need to add and modify?<span epub:type="pagebreak" id="page_82"/></p></li>
</ol>
</body></html>