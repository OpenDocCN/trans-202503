<html><head></head><body>
<h2 class="h2" id="ch08"><span epub:type="pagebreak" id="page_147"/><span class="big"><strong>8</strong></span><br/><strong>READING AND WRITING FILES</strong></h2>&#13;
<div class="image"><img src="../images/common-01.jpg" alt="image"/></div>&#13;
<p class="noindent">Now I’ll cover one more fundamental aspect of working with R: loading and saving data in an active workspace by reading and writing files. Typically, to work with a large data set, you’ll need to read in the data from an external file, whether it’s stored as plain text, in a spreadsheet file, or on a website. R provides command line functions you can use to import these data sets, usually as a data frame object. You can also export data frames from R by writing a new file on your computer, plus you can save any plots you create as image files. In this chapter, I’ll go over some useful command-based read and write operations for importing and exporting data.</p>&#13;
<h3 class="h3" id="ch08lev1sec27"><strong>8.1 R-Ready Data Sets</strong></h3>&#13;
<p class="noindent">First, let’s take a brief look at some of the data sets that are built into the software or are part of user-contributed packages. These data sets are useful samples to practice with and to experiment with functionality.</p>&#13;
<p class="indent">Enter <code>data()</code> at the prompt to bring up a window listing these ready-to-use data sets along with a one-line description. These data sets are organized in alphabetical order by name and grouped by package (the exact list that <span epub:type="pagebreak" id="page_148"/>appears will depend on what contributed packages have been installed from CRAN; see <a href="app01.xhtml#app01lev1sec97">Section A.2</a>).</p>&#13;
<h4 class="h4" id="ch08lev2sec71"><strong><em>8.1.1 Built-in Data Sets</em></strong></h4>&#13;
<p class="noindent">There are a number of data sets contained within the built-in, automatically loaded package <code>datasets</code>. To see a summary of the data sets contained in the package, you can use the <code>library</code> function as follows:</p>&#13;
<pre>R&gt; library(help="datasets")</pre>&#13;
<p class="indent">R-ready data sets have a corresponding help file where you can find important details about the data and how it’s organized. For example, one of the built-in data sets is named <code>ChickWeight</code>. If you enter <code>?ChickWeight</code> at the prompt, you’ll see the window in <a href="ch08.xhtml#ch8fig1">Figure 8-1</a>.</p>&#13;
<div class="image"><img src="../images/f08-01.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch8fig1"/>Figure 8-1: The help file for the</em> <code>ChickWeight</code> <em>data set</em></p>&#13;
<p class="indent">As you can see, this file explains the variables and their values; it notes that the data are stored in a data frame with 578 rows and 4 columns. Since the objects in <code>datasets</code> are built in, all you have to do to access <code>ChickWeight</code> is enter its name at the prompt. Let’s look at the first 15 records.</p>&#13;
<pre>R&gt; ChickWeight[1:15,]<br/>   weight Time Chick Diet<br/>1      42    0     1    1<br/>2      51    2     1    1<br/>3      59    4     1    1<br/>4      64    6     1    1<br/>5      76    8     1    1<br/><span epub:type="pagebreak" id="page_149"/>6      93   10     1    1<br/>7     106   12     1    1<br/>8     125   14     1    1<br/>9     149   16     1    1<br/>10    171   18     1    1<br/>11    199   20     1    1<br/>12    205   21     1    1<br/>13     40    0     2    1<br/>14     49    2     2    1<br/>15     58    4     2    1</pre>&#13;
<p class="indent">You can treat this data set like any other data frame you’ve created in R—note the use of <code>[1:15,]</code> to access the desired rows from such an object, as detailed in <a href="ch05.xhtml#ch05lev2sec52">Section 5.2.1</a>.</p>&#13;
<h4 class="h4" id="ch08lev2sec72"><strong><em>8.1.2 Contributed Data Sets</em></strong></h4>&#13;
<p class="noindent">There are many more R-ready data sets that come as part of contributed packages. To access them, first install and load the relevant package. Consider the data set <code>ice.river</code>, which is in the contributed package <code>tseries</code> by Trapletti and Hornik (<a href="ref.xhtml#ref67">2013</a>). First, you have to install the package, which you can do by running the line <code>install.packages("tseries")</code> at the prompt. Then, to access the components of the package, load it using <code>library</code>:</p>&#13;
<pre>R&gt; library("tseries")<br/><br/>    'tseries' version: 0.10-32<br/><br/>    'tseries' is a package for time series analysis and computational finance.<br/><br/>    See 'library(help="tseries")' for details.</pre>&#13;
<p class="indent">Now you can enter <code>library(help="tseries")</code> to see the list of data sets in this package, and you can enter <code>?ice.river</code> to find more details about the data set you want to work with here. The help file describes <code>ice.river</code> as a “time series object” comprised of river flow, precipitation, and temperature measurements—data initially reported in Tong (<a href="ref.xhtml#ref66">1990</a>). To access this object itself, you must explicitly load it using the <code>data</code> function. Then you can work with <code>ice.river</code> in your workspace as usual. Here are the first five records:</p>&#13;
<pre>R&gt; data(ice.river)<br/>R&gt; ice.river[1:5,]<br/>      flow.vat flow.jok prec temp<br/>[1,]     16.10     30.2  8.1  0.9<br/>[2,]     19.20     29.0  4.4  1.6<br/>[3,]     14.50     28.4  7.0  0.1<br/>[4,]     11.00     27.8  0.0  0.6<br/>[5,]     13.60     27.8  0.0  2.0</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_150"/>The availability and convenience of these R-ready data sets make it easy to test code, and I’ll use them in subsequent chapters for demonstrations. To analyze your own data, however, you’ll often have to import them from some external file. Let’s see how to do that.</p>&#13;
<h3 class="h3" id="ch08lev1sec28"><strong>8.2 Reading in External Data Files</strong></h3>&#13;
<p class="noindent">R has a variety of functions for reading characters from stored files and making sense of them. You’ll look at how to read <em>table-format</em> files, which are among the easiest for R to read and import.</p>&#13;
<h4 class="h4" id="ch08lev2sec73"><strong><em>8.2.1 The Table Format</em></strong></h4>&#13;
<p class="noindentb">Table-format files are best thought of as plain-text files with three key features that fully define how R should read the data.</p>&#13;
<p class="noindenth"><strong>Header</strong> If a <em>header</em> is present, it’s always the first line of the file. This optional feature is used to provide names for each column of data. When importing a file into R, you need to tell the software whether a header is present so that it knows whether to treat the first line as variable names or, alternatively, observed data values.</p>&#13;
<p class="noindenth"><strong>Delimiter</strong> The all-important <em>delimiter</em> is a character used to separate the entries in each line. The delimiter character cannot be used for anything else in the file. This tells R when a specific entry begins and ends (in other words, its exact position in the table).</p>&#13;
<p class="noindenth"><strong>Missing value</strong> This is another unique character string used exclusively to denote a missing value. When reading the file, R will turn these entries into the form it recognizes: <code>NA</code>.</p>&#13;
<p class="indentt">Typically, these files have a <em>.txt</em> extension (highlighting the plain-text style) or <em>.csv</em> (for <em>comma-separated values</em>).</p>&#13;
<p class="indent">Let’s try an example, using a variation on the data frame <code>mydata</code> as defined at the end of <a href="ch05.xhtml#ch05lev2sec53">Section 5.2.2</a>. <a href="ch08.xhtml#ch8fig2">Figure 8-2</a> shows an appropriate table-format file called <em>mydatafile.txt</em>, which has the data from that data frame with a few values now marked as missing. This data file can be found on the book’s website at <em><a href="https://www.nostarch.com/bookofr/">https://www.nostarch.com/bookofr/</a></em>, or you can create it yourself from <a href="ch08.xhtml#ch8fig2">Figure 8-2</a> using a text editor.</p>&#13;
<div class="image"><img src="../images/f08-02.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch8fig2"/>Figure 8-2: A plain-text table-format file</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_151"/>Note that the first line is the header, the values are delimited with a single space, and missing values are denoted with an asterisk (<code>*</code>). Also, note that each new record is required to start on a new line. Suppose you’re handed this plain-text file for data analysis in R. The ready-to-use command <code>read.table</code> imports table-format files, producing a data frame object, as follows:</p>&#13;
<pre>R&gt; mydatafile &lt;- read.table(file="/Users/tdavies/mydatafile.txt",<br/>                            header=TRUE,sep=" ",na.strings="*",<br/>                            stringsAsFactors=FALSE)<br/>R&gt; mydatafile<br/>  person age sex funny age.mon<br/>1  Peter  NA   M  High     504<br/>2   Lois  40   F  &lt;NA&gt;     480<br/>3    Meg  17   F   Low     204<br/>4  Chris  14   M   Med     168<br/>5 Stewie   1   M  High      NA<br/>6  Brian  NA   M   Med      NA</pre>&#13;
<p class="indent">In a call to <code>read.table</code>, <code>file</code> takes a character string with the filename and folder location (using forward slashes), <code>header</code> is a logical value telling R whether <code>file</code> has a header (<code>TRUE</code> in this case), <code>sep</code> takes a character string providing the delimiter (a single space, <code>" "</code>, in this case), and <code>na.strings</code> requests the characters used to denote missing values (<code>"*"</code> in this case).</p>&#13;
<p class="indent">If you’re reading in multiple files and don’t want to type the entire folder location each time, it’s possible to first set your working directory via <code>setwd</code> (<a href="ch01.xhtml#ch01lev2sec08">Section 1.2.3</a>) and then simply use the filename and its extension as the character string supplied to the <code>file</code> argument. However, both approaches require you to know exactly where your file is located when you’re working at the R prompt. Fortunately, R possesses some useful additional tools should you forget your file’s precise location. You can view textual output of the contents of any folder by using <code>list.files</code>. The following example betrays the messiness of my local user directory.</p>&#13;
<pre>R&gt; list.files("/Users/tdavies")<br/> [1] "bands-SCHIST1L200.txt" "Brass"                 "Desktop"<br/> [4] "Documents"             "DOS Games"             "Downloads"<br/> [7] "Dropbox"               "Exercise2-20Data.txt"  "Google Drive"<br/>[10] "iCloud"                "Library"               "log.txt"<br/>[13] "Movies"                "Music"                 "mydatafile.txt"<br/>[16] "OneDrive"              "peritonitis.sav"       "peritonitis.txt"<br/>[19] "Personal9414"          "Pictures"              "Public"<br/>[22] "Research"              "Rintro.tex"            "Rprofile.txt"<br/>[25] "Rstartup.R"            "spreadsheetfile.csv"   "spreadsheetfile.xlsx"<br/>[28] "TakeHome_template.tex" "WISE-P2L"              "WISE-P2S.txt"<br/>[31] "WISE-SCHIST1L200.txt"</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_152"/>One important feature to note here, though, is that it can be difficult to distinguish between files and folders. Files will typically have an extension, and folders won’t; however, <code>WISE-P2L</code> is a file that happens to have no extension and looks no different from any of the listed folders.</p>&#13;
<p class="indent">You can also find files interactively from R. The <code>file.choose</code> command opens your filesystem viewer directly from the R prompt—just as any other program does when you want to open something. Then, you can navigate to the folder of interest, and after you select your file (see <a href="ch08.xhtml#ch8fig3">Figure 8-3</a>), only a character string is returned.</p>&#13;
<pre>R&gt; file.choose()<br/>[1] "/Users/tdavies/mydatafile.txt"</pre>&#13;
<div class="image"><img src="../images/f08-03.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch8fig3"/>Figure 8-3: My local file navigator opened as the result of a call to</em> <code>file.choose</code><em>. When the file of interest is opened, the R command returns the full file path to that file as a character string.</em></p>&#13;
<p class="indent">This command is particularly useful, as it returns the character string of the directory in precisely the format that’s required for a command such as <code>read.table</code>. So, calling the following line and selecting <em>mydatafile.txt</em>, as in <a href="ch08.xhtml#ch8fig3">Figure 8-3</a>, will produce an identical result to the explicit use of the file path in <code>file</code>, shown earlier:</p>&#13;
<pre>R&gt; mydatafile &lt;- read.table(file=file.choose(),header=TRUE,sep=" ",<br/>                            na.strings="*",stringsAsFactors=FALSE)</pre>&#13;
<p class="indent">If your file has been successfully loaded, you should be returned to the R prompt without receiving any error messages. You can check this with a call to <code>mydatafile</code>, which should return the data frame. When importing data into data frames, keep in mind the difference between character string observations and factor observations. No factor attribute information is <span epub:type="pagebreak" id="page_153"/>stored in the plain-text file, but <code>read.table</code> will convert non-numeric values into factors by default. Here, you want to keep some of your data saved as strings, so set <code>stringsAsFactors=FALSE</code>, which prevents R from treating all non-numeric elements as factors. This way, <code>person</code>, <code>sex</code>, and <code>funny</code> are all stored as character strings.</p>&#13;
<p class="indent">You can then overwrite <code>sex</code> and <code>funny</code> with factor versions of themselves if you want them as that data type.</p>&#13;
<pre>R&gt; mydatafile$sex &lt;- as.factor(mydatafile$sex)<br/>R&gt; mydatafile$funny &lt;- factor(x=mydatafile$funny,levels=c("Low","Med","High"))</pre>&#13;
<h4 class="h4" id="ch08lev2sec74"><strong><em>8.2.2 Spreadsheet Workbooks</em></strong></h4>&#13;
<p class="noindent">Next, let’s examine some ubiquitous spreadsheet software file formats. The standard file format for Microsoft Office Excel is <em>.xls</em> or <em>.xlsx</em>. In general, these files are not directly compatible with R. There are some contributed package functions that attempt to bridge this gap—see, for example, <code>gdata</code> by Warnes et al. (<a href="ref.xhtml#ref71">2014</a>) or <code>XLConnect</code> by Mirai Solutions GmbH (<a href="ref.xhtml#ref47">2014</a>)—but it’s generally preferable to first export the spreadsheet file to a table format, such as CSV. Consider the hypothetical data from <a href="ch07.xhtml#ch7exc1">Exercise 7.1</a> (b), which has been stored in an Excel file called <em>spreadsheetfile.xlsx</em>, shown in <a href="ch08.xhtml#ch8fig4">Figure 8-4</a>.</p>&#13;
<div class="image"><img src="../images/f08-04.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch8fig4"/>Figure 8-4: A spreadsheet file of the data from <a href="ch07.xhtml#ch7exc1">Exercise 7.1</a> (b)</em></p>&#13;
<p class="indent">To read this spreadsheet with R, you should first convert it to a table format. In Excel, File → Save As... provides a wealth of options. Save the spreadsheet as a comma-separated file, called <em>spreadsheet.csv</em>. R has a shortcut version of <code>read.table</code>, <code>read.csv</code>, for these files.</p>&#13;
<pre>R&gt; spread &lt;- read.csv(file="/Users/tdavies/spreadsheetfile.csv",<br/>                      header=FALSE,stringsAsFactors=TRUE)<br/>R&gt; spread<br/>   V1  V2     V3<br/>1  55 161 female<br/>2  85 185   male<br/>3  75 174   male<br/>4  42 154 female<br/>5  93 188   male<br/>6  63 178   male<br/>7  58 170 female<br/>8  75 167   male<br/>9  89 181   male<br/>10 67 178 female</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_154"/>Here, the <code>file</code> argument again specifies the desired file, which has no header, so <code>header=FALSE</code>. You set <code>stringsAsFactors=TRUE</code> because you do want to treat the <code>sex</code> variable (the only non-numeric variable) as a factor. There are no missing values, so you don’t need to specify <code>na.strings</code> (though if there were, this argument is simply used in the same way as earlier), and by definition, <em>.csv</em> files are comma-delimited, which <code>read.csv</code> correctly implements by default, so you don’t need the <code>sep</code> argument. The resulting data frame, <code>spread</code>, can then be printed in your R console.</p>&#13;
<p class="indent">As you can see, reading tabular data into R is fairly straightforward—you just need to be aware of how the data file is headed and delimited and how missing entries are identified. The simple table format is a natural and common way for data sets to be stored, but if you need to read in a file with a more complicated structure, R and its contributed packages make available some more sophisticated functions. See, for example, the documentation for the <code>scan</code> and <code>readLines</code> functions, which provide advanced control over how to parse a file. You can also find documentation on <code>read.table</code> and <code>read.csv</code> by accessing <code>?read.table</code> from the prompt.</p>&#13;
<h4 class="h4" id="ch08lev2sec75"><strong><em>8.2.3 Web-Based Files</em></strong></h4>&#13;
<p class="noindent">With an Internet connection, R can read in files from a website with the same <code>read.table</code> command. All the same rules concerning headers, delimiters, and missing values remain in place; you just have to specify the URL address of the file instead of a local folder location.</p>&#13;
<p class="indent">As an example, you’ll use the online repository of data sets made available by the <em>Journal of Statistics Education (JSE)</em> through the American Statistical Association at <em><a href="http://www.amstat.org/publications/jse/jse_data_archive.htm">http://www.amstat.org/publications/jse/jse_data_archive.htm</a></em>.</p>&#13;
<p class="indent">One of the first files linked to at the top of this page is the table-format data set <em>4cdata.txt</em> (<em><a href="http://www.amstat.org/publications/jse/v9n2/4cdata.txt">http://www.amstat.org/publications/jse/v9n2/4cdata.txt</a></em>), which contains data on the characteristics of 308 diamonds from an analysis by Chu (<a href="ref.xhtml#ref13">2001</a>) based on an advertisement in a Singaporean newspaper. <a href="ch08.xhtml#ch8fig5">Figure 8-5</a> shows the data.</p>&#13;
<p class="indent">You can look at the documentation file (<em>4c.txt</em>) and the accompanying article linked from the JSE site for details on what is recorded in this table. Note that of the five columns, the first and fifth are numeric, and the others would be well represented by factors. The delimiter is blank whitespace, there’s no header, and there are no missing values (so you don’t have to specify a value used to represent them).</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_155"/><img src="../images/f08-05.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch8fig5"/>Figure 8-5: A table-format data file found online</em></p>&#13;
<p class="indent">With this in mind, you can create a data frame directly from the R prompt simply with the following lines:</p>&#13;
<pre>R&gt; dia.url &lt;- "http://www.amstat.org/publications/jse/v9n2/4cdata.txt"<br/>R&gt; diamonds &lt;- read.table(dia.url)</pre>&#13;
<p class="indent">Note that you haven’t supplied any extra values in this call to <code>read.table</code> because the defaults all work just fine. Because there’s no header in the table, you can leave the default <code>header</code> value <code>FALSE</code>. The default value for <code>sep</code> is <code>""</code>, meaning whitespace (not to be confused with <code>" "</code>, meaning an explicit space character), which is exactly what this table uses. The default value for <code>stringsAsFactors</code> is <code>TRUE</code>, which is what you want for your character string columns. Following the import, you can supply names (based on the information in the documentation) to each column as follows:</p>&#13;
<pre>R&gt; names(diamonds) &lt;- c("Carat","Color","Clarity","Cert","Price")<br/>R&gt; diamonds[1:5,]<br/>  Carat Color Clarity Cert Price<br/>1  0.30     D     VS2  GIA  1302<br/>2  0.30     E     VS1  GIA  1510<br/>3  0.30     G    VVS1  GIA  1510<br/>4  0.30     G     VS1  GIA  1260<br/>5  0.31     D     VS1  GIA  1641</pre>&#13;
<p class="indent">Viewing the first five records shows that the data frame is displayed as you intended.</p>&#13;
<h4 class="h4" id="ch08lev2sec76"><strong><em>8.2.4 Other File Formats</em></strong></h4>&#13;
<p class="noindent">There are other file formats besides <em>.txt</em> or <em>.csv</em> files that can be read into R, such as the data file format <em>.dat</em>. These files can also be imported using <code>read.table</code>, though they may contain extra information at the top that must be skipped using the optional <code>skip</code> argument. The <code>skip</code> argument asks for <span epub:type="pagebreak" id="page_156"/>the number of lines at the top of the file that should be ignored before R begins the import.</p>&#13;
<p class="indent">As mentioned in <a href="ch08.xhtml#ch08lev2sec74">Section 8.2.2</a>, there are also contributed packages that can cope with other statistical software files; however, if there are multiple worksheets within a file it can complicate things. The R package <code>foreign</code> (<a href="ref.xhtml#ref52">R Core Team, 2015</a>), available from CRAN, provides support for reading data files used by statistical programs such as Stata, SAS, Minitab, and SPSS.</p>&#13;
<p class="indent">Other contributed packages on CRAN can help R handle files from various database management systems (DBMSs). For example, the <code>RODBC</code> package (<a href="ref.xhtml#ref54">Ripley and Lapsley, 2013</a>) lets you query Microsoft Access databases and return the results as a data frame object. Other interfaces include the packages <code>RMySQL</code> (<a href="ref.xhtml#ref35">James and DebRoy, 2012</a>) and <code>RJDBC</code> (<a href="ref.xhtml#ref68">Urbanek, 2013</a>).</p>&#13;
<h3 class="h3" id="ch08lev1sec29"><strong>8.3 Writing Out Data Files and Plots</strong></h3>&#13;
<p class="noindent">Writing out new files from data frame objects with R is just as easy as reading in files. R’s vector-oriented behavior is a fast and convenient way to recode data sets, so it’s perfect for reading in data, restructuring it, and writing it back out to a file.</p>&#13;
<h4 class="h4" id="ch08lev2sec77"><strong><em>8.3.1 Data Sets</em></strong></h4>&#13;
<p class="noindent">The function for writing table-format files to your computer is <code>write.table</code>. You supply a data frame object as <code>x</code>, and this function writes its contents to a new file with a specified name, delimiter, and missing value string. For example, the following line takes the <code>mydatafile</code> object from <a href="ch08.xhtml#ch08lev1sec28">Section 8.2</a> and writes it to a file:</p>&#13;
<pre>R&gt; write.table(x=mydatafile,file="/Users/tdavies/somenewfile.txt",<br/>               sep="@",na="??",quote=FALSE,row.names=FALSE)</pre>&#13;
<p class="indent">You provide <code>file</code> with the folder location, ending in the filename you want for your new data file. This command creates a new table-format file called <em>somenewfile.txt</em> in the specified folder location, delimited by <code>@</code> and with missing values denoted with <code>??</code> (because you’re actually creating a new file, the <code>file.choose</code> command doesn’t tend to be used here). Since <code>mydatafile</code> has variable names, these are automatically written to the file as a header. The optional logical argument <code>quote</code> determines whether to encapsulate each non-numeric entry in double quotes (if you explicitly need them in your file for, say, formatting requirements of other software); request no quotes by setting the argument to <code>FALSE</code>. Another optional logical argument, <code>row.names</code>, asks whether to include the row names of <code>mydatafile</code> (in this example, this would just be the numbers <code>1</code> to <code>6</code>), which you also omit with <code>FALSE</code>. The resulting file, shown in <a href="ch08.xhtml#ch8fig6">Figure 8-6</a>, can be opened in a text editor.</p>&#13;
<p class="indent">Like <code>read.csv</code>, <code>write.csv</code> is a shortcut version of the <code>write.table</code> function designed specifically for <em>.csv</em> files.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_157"/><img src="../images/f08-06.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch8fig6"/>Figure 8-6: The contents of</em> somenewfile.txt</p>&#13;
<h4 class="h4" id="ch08lev2sec78"><strong><em>8.3.2 Plots and Graphics Files</em></strong></h4>&#13;
<p class="noindent">Plots can also be written directly to a file. In <a href="ch07.xhtml#ch07">Chapter 7</a>, you created and displayed plots in an active graphics device. This graphics device needn’t be a screen window; it can be a specified file. Instead of displaying the plot immediately on the screen, you can have R follow these steps: open a “file” graphics device, run any plotting commands to create the final plot, and close the device. R supports direct writing to <em>.jpeg</em>, <em>.bmp</em>, <em>.png</em>, and <em>.tiff</em> files using functions of the same names. For example, the following code uses these three steps to create a <em>.jpeg</em> file:</p>&#13;
<pre>R&gt; jpeg(filename="/Users/tdavies/myjpegplot.jpeg",width=600,height=600)<br/>R&gt; plot(1:5,6:10,ylab="a nice ylab",xlab="here's an xlab",<br/>        main="a saved .jpeg plot")<br/>R&gt; points(1:5,10:6,cex=2,pch=4,col=2)<br/>R&gt; dev.off()<br/>null device<br/>          1</pre>&#13;
<p class="indent">The file graphics device is opened by a call to <code>jpeg</code>, where you provide the intended name of the file and its folder location as <code>filename</code>. By default, the dimensions of the device are set to 480 × 480 pixels, but here you change them to 600 × 600. You could also set these dimensions by supplying other units (inches, centimeters, or millimeters) to <code>width</code> and <code>height</code> and by specifying the unit with an optional <code>units</code> argument. Once the file is opened, you execute any R plotting commands you need in order to create the image—this example plots some points and then includes some additional points with a second command. The final graphical result is silently written to the specified file just as it would have been displayed on the screen. When you’ve finished plotting, you must explicitly close the file device with a call to <code>dev.off()</code>, which prints information on the remaining active device (here, “null device” can be loosely interpreted as “nothing is left open”). If <code>dev.off()</code> isn’t called, then R will continue to output any subsequent plotting commands to the file, and possibly overwrite what you have there. The left plot in <a href="ch08.xhtml#ch8fig7">Figure 8-7</a> shows the resulting file created in this example.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_158"/><img src="../images/f08-07.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch8fig7"/>Figure 8-7: R plots that have been written directly to disk: a</em> .jpeg <em>version (left) and a</em> .pdf <em>version (right) of the same plotting commands</em></p>&#13;
<p class="indent">You can also store R plots as other file types, such as PDFs (using the <code>pdf</code> function) and EPS files (using the <code>postscript</code> function). Though some argument names and default values are different for these functions, they follow the same basic premise. You specify a folder location, a filename, and width and height dimensions; enter your plotting commands; and then close the device with <code>dev.off()</code>. The right panel of <a href="ch08.xhtml#ch8fig7">Figure 8-7</a> shows the <em>.pdf</em> file created with the following code:</p>&#13;
<pre>R&gt; pdf(file="/Users/tdavies/mypdfplot.pdf",width=5,height=5)<br/>R&gt; plot(1:5,6:10,ylab="a nice ylab",xlab="here's an xlab",<br/>        main="a saved .pdf plot")<br/>R&gt; points(1:5,10:6,cex=2,pch=4,col=2)<br/>R&gt; dev.off()<br/>null device<br/>          1</pre>&#13;
<p class="indent">Here, you use the same plotting commands as before, and there are just a few minor differences in the code. The argument for the file is <code>file</code> (as opposed to <code>filename</code>), and the units for <code>width</code> and <code>height</code> default to inches in <code>pdf</code>. The difference of appearance between the two images in <a href="ch08.xhtml#ch8fig7">Figure 8-7</a> results primarily from these differences in width and height.</p>&#13;
<p class="indent">This same process also works for <code>ggplot2</code> images. True to style, however, <code>ggplot2</code> provides a convenient alternative. The <code>ggsave</code> function can be used to write the most recently plotted <code>ggplot2</code> graphic to file and performs the device open/close action in one line.</p>&#13;
<p class="indent">For example, the following code creates and displays a <code>ggplot2</code> object from a simple data set.</p>&#13;
<pre>R&gt; foo &lt;- c(1.1,2,3.5,3.9,4.2)<br/>R&gt; bar &lt;- c(2,2.2,-1.3,0,0.2)<br/><span epub:type="pagebreak" id="page_159"/>R&gt; qplot(foo,bar,geom="blank")<br/>         + geom_point(size=3,shape=8,color="darkgreen")<br/>         + geom_line(color="orange",linetype=4)</pre>&#13;
<p class="indent">Now, to save this plot to a file, all you need is the following line:</p>&#13;
<pre>R&gt; ggsave(filename="/Users/tdavies/mypngqplot.png")<br/>Saving 7 x 7 in image</pre>&#13;
<p class="indent">This writes the image to a <em>.png</em> file in the specified <code>filename</code> directory. (Note that dimensions are reported if you don’t explicitly set them using <code>width</code> and <code>height</code>; these will vary depending on the size of your graphics device.) The result is shown in <a href="ch08.xhtml#ch8fig8">Figure 8-8</a>.</p>&#13;
<div class="image"><img src="../images/f08-08.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch8fig8"/>Figure 8-8: The</em> .png <em>file created using</em> <code>ggplot2</code><em>’s</em> <code>ggsave</code> <em>command</em></p>&#13;
<p class="indent">Beyond just being concise, <code>ggsave</code> is convenient in a few other ways. For one, you can use the same command to create a variety of image file types—the type is simply determined by the extension you supply in the <code>filename</code> argument. Also, <code>ggsave</code> has a range of optional arguments if you want to control the size of the image and the quality or scaling of the graphic.</p>&#13;
<p class="indent">For more details on saving images from base R graphics, see the <code>?jpeg</code>, <code>?pdf</code>, and <code>?postscript</code> help files. You can consult <code>?ggsave</code> for more on saving images with <code>ggplot2</code>.</p>&#13;
<h3 class="h3" id="ch08lev1sec30"><span epub:type="pagebreak" id="page_160"/><strong>8.4 Ad Hoc Object Read/Write Operations</strong></h3>&#13;
<p class="noindent">For the typical R user, the most common input/output operations will probably revolve around data sets and plot images. But if you need to read or write other kinds of R objects, such as lists or arrays, you’ll need the <code>dput</code> and <code>dget</code> commands, which can handle objects in a more ad hoc style.</p>&#13;
<p class="indent">Suppose, for example, you create this list in the current session:</p>&#13;
<pre>R&gt; somelist &lt;- list(foo=c(5,2,45),<br/>                    bar=matrix(data=c(T,T,F,F,F,F,T,F,T),nrow=3,ncol=3),<br/>                    baz=factor(c(1,2,2,3,1,1,3),levels=1:3,ordered=T))<br/>R&gt; somelist<br/>$foo<br/>[1]  5  2 45<br/><br/>$bar<br/>      [,1]  [,2]  [,3]<br/>[1,]  TRUE FALSE  TRUE<br/>[2,]  TRUE FALSE FALSE<br/>[3,] FALSE FALSE  TRUE<br/><br/>$baz<br/>[1] 1 2 2 3 1 1 3<br/>Levels: 1 &lt; 2 &lt; 3</pre>&#13;
<p class="indent">This object can itself be written to a file, which is useful if you want to pass it to a colleague or open it in a new R session elsewhere. Using <code>dput</code>, the following line stores the object as a plain-text file that is interpretable by R:</p>&#13;
<pre>R&gt; dput(x=somelist,file="/Users/tdavies/myRobject.txt")</pre>&#13;
<p class="indent">In technical terms, this command creates an American Standard Code for Information Interchange (ASCII) representation of the object. As you call <code>dput</code>, the object you want to write is specified as <code>x</code>, and the folder location and name of the new plain-text file are passed to <code>file</code>. <a href="ch08.xhtml#ch8fig9">Figure 8-9</a> shows the contents of the resulting file.</p>&#13;
<div class="image"><img src="../images/f08-09.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch8fig9"/>Figure 8-9:</em> myRobject.txt <em>created by using</em> <code>dput</code> <em>on</em> <code>somelist</code></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_161"/>Notice that <code>dput</code> stores all of the members of the object plus any other relevant information, such as attributes. The third element of <code>somelist</code>, for example, is an ordered factor, so it isn’t enough to simply represent it in the text file as a stand-alone vector.</p>&#13;
<p class="indent">Now, let’s say you want to import this list into an R workspace. If a file has been created with <code>dput</code>, then it can be read into any other workspace using <code>dget</code>.</p>&#13;
<pre>R&gt; newobject &lt;- dget(file="/Users/tdavies/myRobject.txt")<br/>R&gt; newobject<br/>$foo<br/>[1]  5  2 45<br/><br/>$bar<br/><br/>      [,1]  [,2]  [,3]<br/>[1,]  TRUE FALSE  TRUE<br/>[2,]  TRUE FALSE FALSE<br/>[3,] FALSE FALSE  TRUE<br/><br/>$baz<br/>[1] 1 2 2 3 1 1 3<br/>Levels: 1 &lt; 2 &lt; 3</pre>&#13;
<p class="indent">You read the object from the <em>myRobject.txt</em> file using <code>dget</code> and assign it to <code>newobject</code>. This object is the same as the original R object <code>somelist</code>, with all structures and attributes present.</p>&#13;
<p class="indent">There are some drawbacks to using these commands. For starters, <code>dput</code> is not as reliable a command as <code>write.table</code> because it’s sometimes quite difficult for R to create the necessary plain-text representation for an object (fundamental object classes typically cause no problems, but complex user-defined classes can). Also, because they need to store structural information, files created using <code>dput</code> are relatively inefficient both in terms of required space and in terms of how long it takes to execute read and write operations. This becomes more noticeable for objects that contain a lot of data. Nevertheless, <code>dput</code> and <code>dget</code> are useful ways to store or transfer specific objects without having to save an entire workspace.</p>&#13;
<div class="ex">&#13;
<p class="ext"><a id="ch8exc1"/><strong>Exercise 8.1</strong></p>&#13;
<ol type="a">&#13;
<li><p class="noindents">In R’s built-in <code>datasets</code> library is the data frame <code>quakes</code>. Make sure you can access this object and view the corresponding help file to get an idea of what this data represents. Then, do the following:</p>&#13;
<ol type="i">&#13;
<li><p class="noindent">Select only those records that correspond to a magnitude (<code>mag</code>) of greater than or equal to <code>5</code> and write them to a table-format file called <em>q5.txt</em> in an existing folder on your <span epub:type="pagebreak" id="page_162"/>machine. Use a delimiting character of <code>!</code> and do not include any row names.</p></li>&#13;
<li><p class="noindent">Read the file back into your R workspace, naming the object <code>q5.dframe</code>.</p></li>&#13;
</ol></li>&#13;
<li><p class="noindents">In the contributed package <code>car</code>, there’s a data frame called <code>Duncan</code>, which provides historical data on perceived job prestige in 1950. Install the <code>car</code> package and access the <code>Duncan</code> data set and its help file. Then, do the following:</p>&#13;
<ol type="i">&#13;
<li><p class="noindent">Write R code that will plot <code>education</code> on the <em>x</em>-axis and <code>income</code> on the <em>y</em>-axis, with both <em>x</em>- and <em>y</em>-axis limits fixed to be [0,100]. Provide appropriate axis labels. For jobs with a <code>prestige</code> value of less than or equal to <code>80</code>, use a black <span class="ent">○</span> as the point character. For jobs with <code>prestige</code> greater than 80, use a blue •.</p></li>&#13;
<li><p class="noindent">Add a legend explaining the difference between the two types of points and then save a 500 × 500 pixel <em>.png</em> file of the image.</p></li>&#13;
</ol></li>&#13;
<li><p class="noindents">Create a list called <code>exer</code> that contains the three data sets <code>quakes</code>, <code>q5.dframe</code>, and <code>Duncan</code>. Then, do the following:</p>&#13;
<ol type="i">&#13;
<li><p class="noindent">Write the list object directly to disk, calling it <em>Exercise8-1.txt</em>. Briefly inspect the contents of the file in a text editor.</p></li>&#13;
<li><p class="noindent">Read <em>Exercise8-1.txt</em> back into your workspace; call the resulting object <code>list.of.dataframes</code>. Check that <code>list.of.dataframes</code> does indeed contain the three data frame objects.</p></li>&#13;
</ol></li>&#13;
<li><p class="noindents">In <a href="ch07.xhtml#ch07lev2sec70">Section 7.4.3</a>, you created a <code>ggplot2</code> graphic of 20 observations displayed as the bottom image of <a href="ch07.xhtml#ch7fig11">Figure 7-11</a> on <a href="ch07.xhtml#page_144">page 144</a>. Use <code>ggsave</code> to save a copy of this plot as a <em>.tiff</em> file.</p></li>&#13;
</ol>&#13;
</div>&#13;
<h5 class="h5" id="ch08lev3sec18"><strong>Important Code in This Chapter</strong></h5>&#13;
<table class="topbot">&#13;
<thead>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table_th"><p class="table"><strong>Function/operator</strong></p></td>&#13;
<td style="vertical-align: top;" class="table_th"><p class="table"><strong>Brief description</strong></p></td>&#13;
<td style="vertical-align: top;" class="table_th"><p class="table"><strong>First occurrence</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>data</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Load contributed data set</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch08.xhtml#ch08lev2sec72">Section 8.1.2</a>, <a href="ch08.xhtml#page_149">p. 149</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>read.table</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Import table-format data file</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch08.xhtml#ch08lev2sec73">Section 8.2.1</a>, <a href="ch08.xhtml#page_151">p. 151</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>list.files</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Print specific folder contents</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch08.xhtml#ch08lev2sec73">Section 8.2.1</a>, <a href="ch08.xhtml#page_151">p. 151</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>file.choose</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Interactive file selection</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch08.xhtml#ch08lev2sec73">Section 8.2.1</a>, <a href="ch08.xhtml#page_152">p. 152</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>read.csv</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Import comma-delimited file</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch08.xhtml#ch08lev2sec74">Section 8.2.2</a>, <a href="ch08.xhtml#page_153">p. 153</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>write.table</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Write table-format file to disk</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch08.xhtml#ch08lev2sec77">Section 8.3.1</a>, <a href="ch08.xhtml#page_156">p. 156</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>jpeg</code>, <code>bmp</code>, <code>png</code>, <code>tiff</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Write image/plot file to disk</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch08.xhtml#ch08lev2sec78">Section 8.3.2</a>, <a href="ch08.xhtml#page_157">p. 157</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>dev.off</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Close file graphics device</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch08.xhtml#ch08lev2sec78">Section 8.3.2</a>, <a href="ch08.xhtml#page_157">p. 157</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>pdf</code>, <code>postscript</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Write image/plot file to disk</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch08.xhtml#ch08lev2sec78">Section 8.3.2</a>, <a href="ch08.xhtml#page_158">p. 158</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>ggsave</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Write <code>ggplot2</code> plot file to disk</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch08.xhtml#ch08lev2sec78">Section 8.3.2</a>, <a href="ch08.xhtml#page_159">p. 159</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>dput</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Write R object to file (ASCII)</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch08.xhtml#ch08lev1sec30">Section 8.4</a>, <a href="ch08.xhtml#page_160">p. 160</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>dget</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Import ASCII object file</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch08.xhtml#ch08lev1sec30">Section 8.4</a>, <a href="ch08.xhtml#page_161">p. 161</a></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
</body></html>