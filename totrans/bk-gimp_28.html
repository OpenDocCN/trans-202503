<html><head></head><body><div class="chapter" title="Chapter&#xA0;21.&#xA0;Scripts and Plug-ins"><div class="titlepage"><div><div><h1 class="title"><a id="scripts_and_plug-ins"/>Chapter 21. Scripts and Plug-ins</h1></div></div></div><p><a id="iddle1839" class="indexterm"/><a id="iddle1978" class="indexterm"/><a id="iddle3054" class="indexterm"/><a id="iddle4232" class="indexterm"/><a id="iddle4369" class="indexterm"/><a id="iddle4420" class="indexterm"/><a id="iddle4504" class="indexterm"/><a id="iddle4836" class="indexterm"/><a id="iddle4897" class="indexterm"/><a id="iddle4901" class="indexterm"/>GIMP is not a monolithic program. Much of it is made up of plug-ins, components that are not part of the core of the system. In fact, most of the tools found in the <span class="strong"><strong>Image: Filters</strong></span> menu are plug-ins, as are many of the tools in the <span class="strong"><strong>Image: Colors</strong></span> menu. Besides these built-in plug-ins, many third-party plug-ins are available; some of these are quite large, like the GIMP Animation Package (GAP; discussed in <a class="xref" href="ch18.html" title="Chapter 18. Animation Tools">Chapter 18</a>). Other, much smaller ones, are used for simple tasks.</p><p>Scripts and plug-ins are very similar. One difference is that they are stored in different places. When you open the F<span class="smaller">OLDER</span> entry in the <span class="strong"><strong>Image: Edit &gt; Preferences</strong></span> dialog, you’ll see the <code class="literal">Plug-Ins</code> and <code class="literal">Scripts</code> folders.</p></div>
<div class="sect1" title="21.1 About Scripts and Plug-ins"><div class="titlepage"><div><div><h1 class="title"><a id="two1dot1_about_scripts_and_plug-ins"/>21.1 About Scripts and Plug-ins</h1></div></div></div><p>In this chapter, we explain the concepts underlying GIMP scripts and plug-ins and show you how to find and install new ones. Then we briefly describe some important plug-ins that are worth installing. Finally, we show examples of plug-ins written in Python and C, as well as a script written in Scheme.</p><p>Another difference between a script and a plug-in is the programming language in which the components are written. Scripts are written in Scheme (called Script-Fu in GIMP) and stored in the <code class="literal">Scripts</code> folder. Plug-ins are written in Python or C and stored in the <code class="literal">Plug-Ins</code> folder.</p><div class="sect2" title="Scheme, Python, and C"><div class="titlepage"><div><div><h2 class="title"><a id="schemecomma_pythoncomma_and_c"/>Scheme, Python, and C</h2></div></div></div><p><span class="emphasis"><em>Scheme</em></span> is a very simple and rather old language, directly interpreted without any translation needed. GIMP includes an interpreter for a subset of Scheme, so Scheme scripts are always operational. In fact, many of the predefined plug-ins you’ve used so far (for example in <a class="xref" href="ch12.html" title="Chapter 12. Color">Chapter 12</a> or in <a class="xref" href="ch17.html" title="Chapter 17. Filters">Chapter 17</a>) are in fact scripts programmed in Scheme. Scheme is a functional language that uses only parentheses and whitespace for syntactic punctuation.</p><p><span class="emphasis"><em>Python</em></span>, also directly interpreted, is more powerful than Scheme. It has become popular in the last few years and is probably progressively replacing another scripting language, Perl, because of its much more pleasant syntax and its wider range of capabilities. Python’s interpreter is not part of GIMP and needs to be installed separately on Windows. (It comes packaged with Linux and Mac operating systems.)</p><p><span class="emphasis"><em>C</em></span> is the language in which the core of GIMP is programmed, as well as most of the GNU/Linux <a id="iddle1442" class="indexterm"/><a id="iddle1595" class="indexterm"/><a id="iddle1868" class="indexterm"/><a id="iddle3053" class="indexterm"/><a id="iddle4505" class="indexterm"/><a id="iddle4837" class="indexterm"/>operating system. An old language, C is extremely well supported because it allows programs to use all the capabilities of the computer efficiently. Programs written in C cannot be directly executed but must first be translated into machine language and then loaded. You do this with a <span class="emphasis"><em>compiler</em></span>. In order to write a C plug-in, you must have a C compiler and development environment on your computer. A compiler is easy to set up on GNU/Linux and Mac OS but a bit trickier on Windows.</p><div class="figure"><a id="plug-in_browsercomma_list_view"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01647"/><img src="httpatomoreillycomsourcenostarchimages1457332.png.jpg" alt="The Plug-in Browser, List view"/></div></div><p class="title">Figure 21-1. The Plug-in Browser, List view</p></div><div class="figure"><a id="looking_for_specific_plug-ins"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01648"/><img src="httpatomoreillycomsourcenostarchimages1457334.png.jpg" alt="Looking for specific plug-ins"/></div></div><p class="title">Figure 21-2. Looking for specific plug-ins</p></div><p>GIMP plug-ins can be written in other programming languages, especially if the language is compiled. Perl used to be the language of choice for writing GIMP plug-ins but is used less frequently today. For this reason, we consider only Scheme, Python, and C. To write your own plug-in, you need some knowledge of at least one of these languages; a complete introduction to programming in each language is beyond the scope of this book.</p></div><div class="sect2" title="Installed Plug-ins"><div class="titlepage"><div><div><h2 class="title"><a id="installed_plug-ins"/>Installed Plug-ins</h2></div></div></div><p>To find out which plug-ins are already a part of your GIMP installation, use the Plug-in Browser (<span class="strong"><strong>Image: Help &gt; Plug-in Browser</strong></span>), as shown in <a class="xref" href="ch21s01.html#plug-in_browsercomma_list_view" title="Figure 21-1. The Plug-in Browser, List view">Figure 21-1</a>. As you can see, this installation has 345 plug-ins. The first tab on the left lists them alphabetically.</p><p>When you begin typing in the S<span class="smaller">EARCH</span> field at the top left of the Plug-in Browser, the plug-ins list is automatically filtered to the names that contain this substring, as shown in <a class="xref" href="ch21s01.html#looking_for_specific_plug-ins" title="Figure 21-2. Looking for specific plug-ins">Figure 21-2</a>. Click the broom at the top right to clear the filter.</p><p>The second tab offers a tree view of all plugins, which can be useful for searching plug-ins by category. In <a class="xref" href="ch21s01.html#plug-in_browsercomma_tree_view" title="Figure 21-3. The Plug-in Browser, Tree view">Figure 21-3</a>, we’ve enlarged this view by clicking and dragging its right boundary. As you can see, this view shows the image types accepted by each plug-in, as well as the <a id="iddle1102" class="indexterm"/><a id="iddle2959" class="indexterm"/><a id="iddle3015" class="indexterm"/><a id="iddle3034" class="indexterm"/>installation date. In the image types, the letter <span class="emphasis"><em>A</em></span> means that there is an Alpha channel, and the star is a wildcard. For example, <span class="emphasis"><em>RGB*</em></span> means that the Alpha channel may or may not be present.</p><div class="figure"><a id="plug-in_browsercomma_tree_view"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01649"/><img src="httpatomoreillycomsourcenostarchimages1457336.png.jpg" alt="The Plug-in Browser, Tree view"/></div></div><p class="title">Figure 21-3. The Plug-in Browser, Tree view</p></div><div class="figure"><a id="plug-in_browsercomma_plug-in_description"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01650"/><img src="httpatomoreillycomsourcenostarchimages1457338.png.jpg" alt="The Plug-in Browser, plug-in description"/></div></div><p class="title">Figure 21-4. The Plug-in Browser, plug-in description</p></div><p>The right part of the dialog describes the plug-in selected at the left. For example, in <a class="xref" href="ch21s01.html#plug-in_browsercomma_plug-in_description" title="Figure 21-4. The Plug-in Browser, plug-in description">Figure 21-4</a>, you see the description of the Antialias tool, which is found in <span class="strong"><strong>Image: Filters &gt; Enhance</strong></span>.</p></div><div class="sect2" title="Finding New Plug-ins"><div class="titlepage"><div><div><h2 class="title"><a id="finding_new_plug-ins"/>Finding New Plug-ins</h2></div></div></div><p>The main source of existing GIMP plug-ins is the GIMP Plugin Registry at <span class="emphasis"><em><a class="ulink" href="http://registry.gimp.org/">http://registry.gimp.org/</a></em></span>. Here you’ll find plug-in descriptions, links to the plug-in itself or to its home page, and tags that help in searching. Click a tag for a list of all matching plug-ins.</p><div class="figure"><a id="beginning_of_the_tag_cloud"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01651"/><img src="httpatomoreillycomsourcenostarchimages1457340.png.jpg" alt="The beginning of the tag cloud"/></div></div><p class="title">Figure 21-5. The beginning of the tag cloud</p></div><p>One convenient way to browse the registry is the <span class="emphasis"><em>Content by tags view</em></span> (also called <span class="emphasis"><em>tag cloud view</em></span>), which shows a list of all the tags with a font size proportional to their frequency, as shown in <a class="xref" href="ch21s01.html#beginning_of_the_tag_cloud" title="Figure 21-5. The beginning of the tag cloud">Figure 21-5</a>. The tags are clickable, so browsing all the plug-ins related to a given tag is easy.</p><p>Most plug-ins have a very detailed and complete home page, explaining how they work and how to install them.</p></div></div>
<div class="sect1" title="21.2 Noteworthy Plug-ins"><div class="titlepage"><div><div><h1 class="title"><a id="two1dot2_noteworthy_plug-ins"/>21.2 Noteworthy Plug-ins</h1></div></div></div><p>The following sections describe some interesting plug-ins available on the GIMP Plugin Registry. This selection is obviously subjective, and we’ve excluded a couple of plug-ins that we’ve already discussed, like GAP, presented in <a class="xref" href="ch18.html" title="Chapter 18. Animation Tools">Chapter 18</a>, <a id="iddle2053" class="indexterm"/><a id="iddle2501" class="indexterm"/><a id="iddle3040" class="indexterm"/><a id="iddle3042" class="indexterm"/><a id="iddle3048" class="indexterm"/><a id="iddle3716" class="indexterm"/><a id="iddle4259" class="indexterm"/>and UFRaw, presented in <a class="xref" href="ch19s03.html#handling_raw_photographs" title="Handling Raw Photographs">Handling Raw Photographs</a>.</p><div class="figure"><a id="initial_image_left_parenthesisleftright"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01652"/><img src="httpatomoreillycomsourcenostarchimages1457342.png.jpg" alt="The initial image (left); after applying the Wrap Effect tool (middle); after applying the ev_crayon_full preset"/></div></div><p class="title">Figure 21-6. The initial image (left); after applying the Wrap Effect tool (middle); after applying the ev_crayon_full preset</p></div><div class="sect2" title="Photo Effects"><div class="titlepage"><div><div><h2 class="title"><a id="photo_effects"/>Photo Effects</h2></div></div></div><p>Photo Effects is a set of plug-ins that you can use to add artistic effects to photos. You can find it by searching for <code class="literal">photo effects</code> at <span class="emphasis"><em><a class="ulink" href="http://registry.gimp.org/">http://registry.gimp.org/</a></em></span>. Once it’s installed, you’ll see a menu called P<span class="smaller">HOTO</span> E<span class="smaller">FFECTS</span> in the <span class="strong"><strong>Image: Filters &gt; Decor</strong></span> menu. Let’s use <a class="xref" href="ch21s02.html#initial_image_left_parenthesisleftright" title="Figure 21-6. The initial image (left); after applying the Wrap Effect tool (middle); after applying the ev_crayon_full preset">Figure 21-6</a> (left) as an example. When we apply the Wrap Effect tool, found in <span class="strong"><strong>Image: Filters &gt; Decor &gt; Photo effects &gt; Artist</strong></span>, we get the result shown in <a class="xref" href="ch21s02.html#initial_image_left_parenthesisleftright" title="Figure 21-6. The initial image (left); after applying the Wrap Effect tool (middle); after applying the ev_crayon_full preset">Figure 21-6</a> (middle).</p><p>Photo Effects also comes with 22 predefined presets for the GIMPressionist filter (see <a class="xref" href="ch17s10.html#gimpressionist" title="GIMPressionist">GIMPressionist</a>). <a class="xref" href="ch21s02.html#initial_image_left_parenthesisleftright" title="Figure 21-6. The initial image (left); after applying the Wrap Effect tool (middle); after applying the ev_crayon_full preset">Figure 21-6</a> (right) shows the result of applying the <code class="literal">ev_crayon_full</code> preset.</p></div><div class="sect2" title="G’MIC"><div class="titlepage"><div><div><h2 class="title"><a id="gapostrophemic"/>G’MIC</h2></div></div></div><p>G’MIC (<span class="emphasis"><em><a class="ulink" href="http://gmic.sourceforge.net/gimp.shtml">http://gmic.sourceforge.net/gimp.shtml</a></em></span>) is a huge collection of filters (229 as this book goes to press) and effects. It operates as a single entry in the <span class="strong"><strong>Image: Filters</strong></span> menu, which opens the dialog shown in <a class="xref" href="ch21s02.html#gapostrophemic_dialog" title="Figure 21-7. The G’MIC dialog">Figure 21-7</a>.</p><p>The G’MIC’s preview is updated as soon as you select a filter. When you click the A<span class="smaller">PPLY</span> button, the filter is immediately applied to the image, allowing you to transform it using several filters in sequence. Because we can’t demonstrate all these filters, we’ve chosen a random sample here and will demonstrate them using the default settings.</p><p><a class="xref" href="ch21s02.html#after_applying_the_local_normalization_f" title="Figure 21-8. After applying the Local normalization filter (left), the B &amp; W pencil filter (middle), and the Anisotropic smoothing filter (right)">Figure 21-8</a> (left) shows the result of applying the Local normalization filter found in the Colors submenu to our sample image. <a class="xref" href="ch21s02.html#after_applying_the_local_normalization_f" title="Figure 21-8. After applying the Local normalization filter (left), the B &amp; W pencil filter (middle), and the Anisotropic smoothing filter (right)">Figure 21-8</a> (middle) shows the result of applying the B &amp; W pencil filter found in the Artistic submenu. <a class="xref" href="ch21s02.html#after_applying_the_local_normalization_f" title="Figure 21-8. After applying the Local normalization filter (left), the B &amp; W pencil filter (middle), and the Anisotropic smoothing filter (right)">Figure 21-8</a> (right) shows the same photograph after applying the Anisotropic smoothing filter, which is found in the Enhancement submenu.</p><p>G’MIC is a complex plug-in, and these examples give only a taste of its capabilities.</p></div><div class="sect2" title="Liquid Rescale"><div class="titlepage"><div><div><h2 class="title"><a id="liquid_rescale"/>Liquid Rescale</h2></div></div></div><p>Liquid Rescale (<span class="emphasis"><em><a class="ulink" href="http://liquidrescale.wikidot.com/">http://liquidrescale.wikidot.com/</a></em></span>) is a powerful tool that allows you to stretch or squeeze an image without changing the shape of objects. You’ll find the tool in the <span class="strong"><strong>Image: Layer</strong></span> menu. In <a class="xref" href="ch21s02.html#liquid_rescale_dialog" title="Figure 21-9. The Liquid Rescale dialog">Figure 21-9</a>, a 2000 × 1333 photograph is shown in the preview window. We’ll make it more panoramic by stretching it horizontally.</p><div class="figure"><a id="gapostrophemic_dialog"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01653"/><img src="httpatomoreillycomsourcenostarchimages1457344.png.jpg" alt="The G’MIC dialog"/></div></div><p class="title">Figure 21-7. The G’MIC dialog</p></div><div class="figure"><a id="after_applying_the_local_normalization_f"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01654"/><img src="httpatomoreillycomsourcenostarchimages1457346.png.jpg" alt="After applying the Local normalization filter (left), the B &amp; W pencil filter (middle), and the Anisotropic smoothing filter (right)"/></div></div><p class="title">Figure 21-8. After applying the Local normalization filter (left), the B &amp; W pencil filter (middle), and the Anisotropic smoothing filter (right)</p></div><p><a id="iddle1589" class="indexterm"/><a id="iddle2714" class="indexterm"/><a id="iddle3966" class="indexterm"/>If we simply change the canvas width to 3000 pixels using Liquid Rescale, the result (shown in <a class="xref" href="ch21s02.html#result_of_resizing_without_preservation" title="Figure 21-10. The result of resizing without preservation">Figure 21-10</a>) is unsatisfactory because the person’s head is misshapen. To fix this, check the N<span class="smaller">EW</span> button at the right of the tool dialog, in the F<span class="smaller">EATURE PRESERVATION MASK</span> section, to activate the P<span class="smaller">RESERVE FEATURES</span> button. Doing so creates a new layer with 50% opacity and temporarily changes the foreground color to a vivid green. Now we can paint the man and, as you can see in <a class="xref" href="ch21s02.html#defining_the_preservation_mask" title="Figure 21-11. Defining the preservation mask">Figure 21-11</a>, we don’t need to be very precise.</p><p>After painting the subject, return the width to 3000 pixels to get the result shown in <a class="xref" href="ch21s02.html#result_of_resizing_with_preservation" title="Figure 21-12. The result of resizing with preservation">Figure 21-12</a>. Admittedly, the ship is a bit too stretched, but we could have preserved its aspect ratio if we’d painted it as well.</p><p>You can also use Liquid Rescale to discard certain features in an image. For example, <a id="iddle2715" class="indexterm"/><a id="iddle4620" class="indexterm"/>suppose that in <a class="xref" href="ch21s02.html#initial_image-id00200" title="Figure 21-13. Initial image">Figure 21-13</a> we want to discard the potted plants on both sides of the peacock. To do this, we click the N<span class="smaller">EW</span> button in the F<span class="smaller">EATURE DISCARD MASK</span> tool dialog. The D<span class="smaller">ISCARD FEATURES</span> button is automatically checked, a new layer is created, and the foreground color changes to a vivid red.</p><div class="figure"><a id="liquid_rescale_dialog"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01655"/><img src="httpatomoreillycomsourcenostarchimages1457348.png.jpg" alt="The Liquid Rescale dialog"/></div></div><p class="title">Figure 21-9. The Liquid Rescale dialog</p></div><div class="figure"><a id="result_of_resizing_without_preservation"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01656"/><img src="httpatomoreillycomsourcenostarchimages1457350.png.jpg" alt="The result of resizing without preservation"/></div></div><p class="title">Figure 21-10. The result of resizing without preservation</p></div><p>Next, we paint the mask shown in <a class="xref" href="ch21s02.html#defining_the_discard_mask" title="Figure 21-14. Defining the discard mask">Figure 21-14</a>, which is a bit more challenging than before because the peacock tail is very close to the left pot. Then, we click the W<span class="smaller">IDTH</span> button to the right of A<span class="smaller">UTO SIZE</span> to get a width of 1103 pixels. The final result, shown in <a class="xref" href="ch21s02.html#resizing_with_the_discard_feature" title="Figure 21-15. Resizing with the Discard feature">Figure 21-15</a>, needs some retouching, but you should get the idea.</p><div class="figure"><a id="defining_the_preservation_mask"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01657"/><img src="httpatomoreillycomsourcenostarchimages1457352.png.jpg" alt="Defining the preservation mask"/></div></div><p class="title">Figure 21-11. Defining the preservation mask</p></div><div class="figure"><a id="result_of_resizing_with_preservation"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01658"/><img src="httpatomoreillycomsourcenostarchimages1457354.png.jpg" alt="The result of resizing with preservation"/></div></div><p class="title">Figure 21-12. The result of resizing with preservation</p></div><p>As described on its home page, the Liquid Rescale tool offers many other possibilities, including an interactive mode, the ability to output a seam map (which shows how the image was resized), and so on. For example, <a class="xref" href="ch21s02.html#seam_maps_when_shrinking_a_portrait" title="Figure 21-16. The seam maps when shrinking a portrait">Figure 21-16</a> shows the seam maps when we make a portrait narrower (80% original width) and <a class="xref" href="ch21s02.html#seam_maps_when_enlarging_a_portrait" title="Figure 21-17. The seam maps when enlarging a portrait">Figure 21-17</a> shows the seam maps when we make it wider (120% original width). On the Output tab, we checked O<span class="smaller">UTPUT ON A NEW LAYER</span>, O<span class="smaller">UTPUT THE</span> <span class="smaller">SEAMS</span>, and S<span class="smaller">CALE BACK TO THE ORIGINAL SIZE</span>. In both cases, the rescaling left the eyes and most of the mouth intact but changed the rest of the face in an unnatural and unpleasant way.</p><div class="figure"><a id="initial_image-id00200"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01659"/><img src="httpatomoreillycomsourcenostarchimages1457356.png.jpg" alt="Initial image"/></div></div><p class="title">Figure 21-13. Initial image</p></div><div class="figure"><a id="defining_the_discard_mask"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01660"/><img src="httpatomoreillycomsourcenostarchimages1457358.png.jpg" alt="Defining the discard mask"/></div></div><p class="title">Figure 21-14. Defining the discard mask</p></div><div class="figure"><a id="resizing_with_the_discard_feature"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01661"/><img src="httpatomoreillycomsourcenostarchimages1457360.png.jpg" alt="Resizing with the Discard feature"/></div></div><p class="title">Figure 21-15. Resizing with the Discard feature</p></div><div class="figure"><a id="seam_maps_when_shrinking_a_portrait"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01662"/><img src="httpatomoreillycomsourcenostarchimages1457362.png.jpg" alt="The seam maps when shrinking a portrait"/></div></div><p class="title">Figure 21-16. The seam maps when shrinking a portrait</p></div><div class="figure"><a id="seam_maps_when_enlarging_a_portrait"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01663"/><img src="httpatomoreillycomsourcenostarchimages1457364.png.jpg" alt="The seam maps when enlarging a portrait"/></div></div><p class="title">Figure 21-17. The seam maps when enlarging a portrait</p></div></div><div class="sect2" title="Elsamuko Scripts"><div class="titlepage"><div><div><h2 class="title"><a id="elsamuko_scripts"/>Elsamuko Scripts</h2></div></div></div><p>The Elsamuko collection of scripts offers a wide variety of ways to transform or improve pictures. The collection can be found at <span class="emphasis"><em><a class="ulink" href="http://sites.google.com/site/elsamuko/gimp/">http://sites.google.com/site/elsamuko/gimp/</a></em></span> and is part of the <code class="literal">gimp-plugin-registry</code> Debian package (usable on Debian and Ubuntu). This site also contains many other plug-ins and scripts.</p><div class="figure"><a id="after_applying_the_national_geographic_f"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01664"/><img src="httpatomoreillycomsourcenostarchimages1457366.png.jpg" alt="After applying the National Geographic filter (left), the Obama Hope filter (middle), and the Lomo filter (right)"/></div></div><p class="title">Figure 21-18. After applying the National Geographic filter (left), the Obama Hope filter (middle), and the Lomo filter (right)</p></div><p><a id="iddle1754" class="indexterm"/><a id="iddle2113" class="indexterm"/><a id="iddle4498" class="indexterm"/><a id="iddle4838" class="indexterm"/>We’ll demonstrate only three of the Elsamuko scripts, using the same photograph as before. These scripts generally require lots of computing power, and most build an image with numerous layers and layer masks.</p><p><a class="xref" href="ch21s02.html#after_applying_the_national_geographic_f" title="Figure 21-18. After applying the National Geographic filter (left), the Obama Hope filter (middle), and the Lomo filter (right)">Figure 21-18</a> (left) shows the result of applying the <span class="strong"><strong>Image: Filters &gt; Generic &gt; National Geographic</strong></span> filter, designed to generate high-quality portraits like those found in the celebrated magazine.</p><p><a class="xref" href="ch21s02.html#after_applying_the_national_geographic_f" title="Figure 21-18. After applying the National Geographic filter (left), the Obama Hope filter (middle), and the Lomo filter (right)">Figure 21-18</a> (middle) shows the result of applying the <span class="strong"><strong>Image: Filters &gt; Artistic &gt; Obama Hope</strong></span> filter, inspired by the famous Obama “HOPE” poster.</p><p><a class="xref" href="ch21s02.html#after_applying_the_national_geographic_f" title="Figure 21-18. After applying the National Geographic filter (left), the Obama Hope filter (middle), and the Lomo filter (right)">Figure 21-18</a> (right) shows the result of applying the <span class="strong"><strong>Image: Filters &gt; Light and Shadow &gt; Lomo</strong></span> filter, designed to simulate the results of using a Lomo camera, an inexpensive Russian model from the early 1990s.</p></div></div>
<div class="sect1" title="21.3 Writing Plug-ins"><div class="titlepage"><div><div><h1 class="title"><a id="two1dot3_writing_plug-ins"/>21.3 Writing Plug-ins</h1></div></div></div><p>Using predefined plug-ins is convenient, but you won’t always find exactly what you need, and if you have a little programming experience, writing your own plug-ins can be more fun anyway. After you have written the first three or four, you’ll find writing them easy. In this section, we present plug-ins written in the three main programming languages: Scheme, Python, and C.</p><div class="sect2" title="Scheme"><div class="titlepage"><div><div><h2 class="title"><a id="scheme"/>Scheme</h2></div></div></div><p>Scripts written in Scheme are called Script-Fu. Take, for example, the script for <span class="strong"><strong>Image: Colors &gt; Map &gt; Colormap</strong></span>. This script includes the function <code class="literal">script-fu-makecmap-array</code>, which returns an array containing the colors for a specified palette. This function can be used in other scripts that need color palette information.</p><p>The function is written in Scheme, and the code is shown in <a class="xref" href="ch21s03.html#script-fu_example_the_cmap_array_functio" title="Figure 21-19. A Script-Fu example: the cmap array function from the Set Colormap script">Figure 21-19</a>. Scheme is written as a sequence of embedded expressions in parentheses. Briefly, a Scheme function definition takes the form of <code class="literal">(define (name parameters) (expr) (expr) ...)</code>. This snippet of code defines the function <code class="literal">name</code> whose value is that of the last expression. An expression calls a function, whose name or symbol appears as the first element in the expression, along with any arguments that follow the function. An argument itself can be an expression that calls functions.</p><div class="figure"><a id="script-fu_example_the_cmap_array_functio"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01665"/><img src="httpatomoreillycomsourcenostarchimages1457368.png.jpg" alt="A Script-Fu example: the cmap array function from the Set Colormap script"/></div></div><p class="title">Figure 21-19. A Script-Fu example: the cmap array function from the Set Colormap script</p></div><p>For example, on line 29 in <a class="xref" href="ch21s03.html#script-fu_example_the_cmap_array_functio" title="Figure 21-19. A Script-Fu example: the cmap array function from the Set Colormap script">Figure 21-19</a>, the function <code class="literal">*</code> (multiplication) is called with two arguments. The first argument is an expression that calls the function <code class="literal">car</code>, and the second argument is the number <code class="literal">3</code>. The call to function <code class="literal">*</code> is actually the second argument to the call to <code class="literal">gimp-image-set-colormap</code> that appears on the previous line. The first argument is the first function parameter, and the third argument is the result of the <code class="literal">script-fu-make-cmap-array</code> function with the third function parameter as an argument.</p><p>Select <span class="strong"><strong>Image: Help &gt; Procedure Browser</strong></span> to learn about a function’s arguments and their purpose. For example, in <a class="xref" href="ch21s03.html#procedure_browser_dialog" title="Figure 21-20. The Procedure Browser dialog">Figure 21-20</a>, we enter <code class="literal">colormap</code> in the Search field and then select a function from the list. At the right of the dialog, we see the type and meaning of the parameters for the chosen function, as well as a detailed comment.</p><p>Lines 9 to 14 of <a class="xref" href="ch21s03.html#script-fu_example_the_cmap_array_functio" title="Figure 21-19. A Script-Fu example: the cmap array function from the Set Colormap script">Figure 21-19</a> contain the declaration and initialization of the local variables of function <code class="literal">script-fu-make-cmap-array</code>. We can use these variables in the function body.</p><div class="figure"><a id="procedure_browser_dialog"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01666"/><img src="httpatomoreillycomsourcenostarchimages1457370.png.jpg" alt="The Procedure Browser dialog"/></div></div><p class="title">Figure 21-20. The Procedure Browser dialog</p></div><p><a id="iddle4499" class="indexterm"/><a id="iddle4506" class="indexterm"/><a id="iddle4508" class="indexterm"/><a id="iddle4898" class="indexterm"/><a id="iddle5858" class="indexterm"/>One of the most important parts of any Script-Fu is the script registration, as shown in lines 34 to 44 of <a class="xref" href="ch21s03.html#script-fu_example_the_cmap_array_functio" title="Figure 21-19. A Script-Fu example: the cmap array function from the Set Colormap script">Figure 21-19</a>. The script registration gives GIMP all the information it needs to integrate the script into GIMP. The various parameters of <code class="literal">script-fu-register</code> provide this information in the following order.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Entry in the menu, with an underscore (<code class="literal">_</code>) before the character used as an abbreviation</p></li><li class="listitem"><p>Contents of the tool tip</p></li><li class="listitem"><p>Author name</p></li><li class="listitem"><p>Copyright notice</p></li><li class="listitem"><p>Copyright date</p></li><li class="listitem"><p>Type of image to be handled</p></li><li class="listitem"><p>Description of the type, name, and initial value parameters</p></li></ul></div><p>Finally, calling <code class="literal">script-fu-menu-register</code> places the Script-Fu in the GIMP menus.</p><p>Testing Script-Fu is easy, thanks to <span class="strong"><strong>Image: Filters &gt; Script-Fu &gt; Console</strong></span>, which opens the dialog shown in <a class="xref" href="ch21s03.html#script-fu_console" title="Figure 21-21. The Script-Fu console">Figure 21-21</a>. All you need to do is enter the Scheme expressions in the bottom field and press <span class="inlinemediaobject"><a id="inline_id00552"/><img src="httpatomoreillycomsourcenostarchimages1453866.png.jpg" alt=""/></span>. The expressions are evaluated immediately, with the result shown in the main dialog window.</p><p>The B<span class="smaller">ROWSE</span> button opens the Procedure Browser dialog. When you choose a specific procedure and click A<span class="smaller">PPLY</span>, a call to this procedure is inserted in the Script-Fu console field, and then you simply need to enter your parameters.</p><div class="figure"><a id="script-fu_console"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01667"/><img src="httpatomoreillycomsourcenostarchimages1457372.png.jpg" alt="The Script-Fu console"/></div></div><p class="title">Figure 21-21. The Script-Fu console</p></div><p>You’ll find many Script-Fus on the Web. Some are well advertised on the GIMP Plugin Registry, whereas others are available on independent websites and blogs. See, for example, <span class="emphasis"><em><a class="ulink" href="http://gimpfx-foundry.sourceforge.net/">http://gimpfx-foundry.sourceforge.net/</a></em></span> or <span class="emphasis"><em><a class="ulink" href="http://gimpscripts.com/">http://gimpscripts.com/</a></em></span>.</p></div><div class="sect2" title="Python"><div class="titlepage"><div><div><h2 class="title"><a id="python"/>Python</h2></div></div></div><p>Like the name <span class="emphasis"><em>Script-Fu</em></span> coined for Scheme scripts, <span class="emphasis"><em>Python-Fu</em></span> is what Python plug-ins are called. <a class="xref" href="ch21s03.html#python-fu_example_a_fog-rendering_filter" title="Figure 21-22. A Python-Fu example: a fog-rendering filter">Figure 21-22</a> shows a sample Python program, the <span class="strong"><strong>Image: Filters &gt; Render &gt; Clouds &gt; Fog</strong></span> filter. In lines 4 to 6, the contents of the <code class="literal">gimpfu</code> module are imported, the <code class="literal">time</code> module is imported, and the <code class="literal">gettext</code> function is used to internationalize all the text in the program.</p><div class="figure"><a id="python-fu_example_a_fog-rendering_filter"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01668"/><img src="httpatomoreillycomsourcenostarchimages1457374.png.jpg" alt="A Python-Fu example: a fog-rendering filter"/></div></div><p class="title">Figure 21-22. A Python-Fu example: a fog-rendering filter</p></div><p><a id="iddle1596" class="indexterm"/><a id="iddle1979" class="indexterm"/><a id="iddle4500" class="indexterm"/><a id="iddle4509" class="indexterm"/><a id="iddle4839" class="indexterm"/>The Python-Fu body of the Render Clouds plug-in, shown from lines 8 to 36, is a good example of a Python program. Statements end when the line ends, except when they are within parentheses, as in line 17. Embedding is denoted by indentation, as shown in lines 13 through 17. Some Python syntax is inspired by the C language, with <code class="literal">=</code> used for assignment and <code class="literal">==</code> for comparison. The workings of this particular function are easy to follow once you know the meaning of GIMP’s predefined functions.</p><p>Python-Fu is registered in GIMP in the same way as Script-Fu (lines 38 to 59), except for some slight differences in the arguments of the <code class="literal">register</code> function, especially in the description of the Python-Fu arguments.</p><p>Selecting <span class="strong"><strong>Image: Filters &gt; Python-Fu &gt; Console</strong></span> opens a dialog similar to the Script-Fu Console. You can use this dialog to enter Python statements directly and test their effect. The Procedure Browser is used in a similar way, allowing you to insert typed code into the proper function call.</p></div><div class="sect2" title="C"><div class="titlepage"><div><div><h2 class="title"><a id="c"/>C</h2></div></div></div><p>By nature, a C program is longer than its equivalent in Scheme or in Python because it is programmed in a lower-level language. You’ll find a good three-part tutorial about building a C plugin for GIMP at <span class="emphasis"><em><a class="ulink" href="http://developer.gimp.org/plug-ins.html">http://developer.gimp.org/plug-ins.html</a></em></span>.</p><p>The shortest C plug-in is the Semi-Flatten plug-in, found in the <span class="strong"><strong>Image: Filters &gt; Web</strong></span> menu. We removed as many blank lines as possible but still had to cut it into two parts (<a class="xref" href="ch21s03.html#c_plug-in_example_semi-flatten_left_pare" title="Figure 21-23. A C plug-in example: Semi-Flatten (part 1)">Figure 21-23</a> and <a class="xref" href="ch21s03.html#c_plug-in_example_semi-flatten_l-id00201" title="Figure 21-24. A C plug-in example: Semi-Flatten (part 2)">Figure 21-24</a>) to display the full program. The file’s heading is shown in lines 1 to 20, along with its declaration of three visible functions, some static variables, and one constant.</p><p>This C plug-in contains four function definitions. Because none of these functions returns a result, their type is always <code class="literal">static void</code>. The <code class="literal">query</code> function (lines 23 to 48) has no parameter and is called the first time the plug-in is used. It calls <code class="literal">gimp_install_procedure</code> to register the plug-in (in a similar way to a Python plug-in). Note that the <code class="literal">semiflatten</code> plug-in is installed both in the <span class="strong"><strong>Image: Filters &gt; Web</strong></span> and in the <span class="strong"><strong>Image: Layer &gt; Transparency</strong></span> menus.</p><p>The <code class="literal">semiflatten_func</code> function (lines 50 to 60) is a simple auxiliary function called indirectly by <code class="literal">semiflatten</code> (lines 61 to 69), itself an auxiliary function. The <code class="literal">run</code> function (lines 71 to 111) is called when we call the plug-in and makes the actual changes. Note that Semi-Flatten does not open a dialog.</p><p>The most crucial point in the plug-in definition is the <code class="literal">GimpPlugInInfo PLUG_IN_INFO</code> structure, declared in the heading. This definition declares the <code class="literal">query</code> and <code class="literal">run</code> functions. The call to <code class="literal">MAIN()</code> shown on line 21 is a C macro that initializes the arguments and calls <code class="literal">PLUG_IN_INFO</code>. These sorts of definitions are required for all C plug-ins.</p><p>Although a casual programmer with a good knowledge of GIMP should be able to program a short Script-Fu or Python-Fu plug-in, using the Procedure Browser to search in the GIMP procedural database, most likely only a serious C programmer will be able to build even a simple C plug-in.</p><p>Moreover, installing a C plug-in is nontrivial and requires a C compiling environment. The <code class="literal">libgimp</code> headers must be installed on the computer to provide all needed declarations, and a tool called <code class="literal">gimptool</code> is also needed to compile and install the plug-in (see <span class="emphasis"><em><a class="ulink" href="http://developer.gimp.org/plug-ins.html">http://developer.gimp.org/plug-ins.html</a></em></span> for more information).</p><div class="figure"><a id="c_plug-in_example_semi-flatten_left_pare"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01669"/><img src="httpatomoreillycomsourcenostarchimages1457376.png.jpg" alt="A C plug-in example: Semi-Flatten (part 1)"/></div></div><p class="title">Figure 21-23. A C plug-in example: Semi-Flatten (part 1)</p></div><div class="figure"><a id="c_plug-in_example_semi-flatten_l-id00201"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01670"/><img src="httpatomoreillycomsourcenostarchimages1457378.png.jpg" alt="A C plug-in example: Semi-Flatten (part 2)"/></div></div><p class="title">Figure 21-24. A C plug-in example: Semi-Flatten (part 2)</p></div></div></div></body></html>